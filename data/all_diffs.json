[
  {
    "commit": "00194f5fe462123f70b0bae7987317b52898b868",
    "files": [
      {
        "file": "src/media_tools/media_export.c",
        "changes": [
          {
            "type": "context",
            "line": "index b89936f83..968818da3 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/media_tools/media_export.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/media_tools/media_export.c"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tesd = gf_media_map_esd(dumper->file, track_num, 0);"
          },
          {
            "type": "context",
            "line": " \t\tsample_count = gf_isom_get_sample_count(dumper->file, dumper->trackID);"
          },
          {
            "type": "delete",
            "line": "\t\tif (esd) {"
          },
          {
            "type": "add",
            "line": "\t\tif (esd && esd->decoderConfig) {"
          },
          {
            "type": "context",
            "line": " \t\t\tif (esd->decoderConfig->objectTypeIndication<GF_CODECID_LAST_MPEG4_MAPPING) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tcodec_id = gf_codecid_from_oti(esd->decoderConfig->streamType, esd->decoderConfig->objectTypeIndication);"
          },
          {
            "type": "context",
            "line": " #ifndef GPAC_DISABLE_AV_PARSERS"
          }
        ]
      }
    ]
  },
  {
    "commit": "002886be0998c74c386e04f0b43688a8a45d7a96",
    "files": [
      {
        "file": "liBaser/Model/BcAppModel.php",
        "changes": [
          {
            "type": "context",
            "line": "index b7f967bb6..c6158a5d1 100755"
          },
          {
            "type": "context",
            "line": "--- a/lib/Baser/Model/BcAppModel.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Baser/Model/BcAppModel.php"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// 更新時の文字列チェック"
          },
          {
            "type": "delete",
            "line": "\t\tif (is_string($file)) {"
          },
          {
            "type": "add",
            "line": "\t\tif (!empty($file) && is_string($file)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$ext = pathinfo($file, PATHINFO_EXTENSION);"
          },
          {
            "type": "context",
            "line": " \t\t\tif (!in_array($ext, $exts)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn false;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0031c41be5c529f8329e327b63cde92ba1284842",
    "files": [
      {
        "file": "drivers/gpu/drm/radeon/atombios.h",
        "changes": [
          {
            "type": "context",
            "line": "index 6732b5dd8ff4..27e2c715be11 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/radeon/atombios.h"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/radeon/atombios.h"
          },
          {
            "type": "context",
            "line": "   UCHAR                    ucTV_BootUpDefaultStandard;"
          },
          {
            "type": "context",
            "line": "   UCHAR                    ucExt_TV_ASIC_ID;"
          },
          {
            "type": "context",
            "line": "   UCHAR                    ucExt_TV_ASIC_SlaveAddr;"
          },
          {
            "type": "delete",
            "line": "  ATOM_DTD_FORMAT          aModeTimings[MAX_SUPPORTED_TV_TIMING];"
          },
          {
            "type": "add",
            "line": "  ATOM_DTD_FORMAT          aModeTimings[MAX_SUPPORTED_TV_TIMING_V1_2];"
          },
          {
            "type": "context",
            "line": " }ATOM_ANALOG_TV_INFO_V1_2;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " typedef struct _ATOM_DPCD_INFO"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/radeon/radeon_atombios.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5673665ff216..9916d825401c 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/radeon/radeon_atombios.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/radeon/radeon_atombios.c"
          },
          {
            "type": "context",
            "line": " \tswitch (crev) {"
          },
          {
            "type": "context",
            "line": " \tcase 1:"
          },
          {
            "type": "context",
            "line": " \t\ttv_info = (ATOM_ANALOG_TV_INFO *)(mode_info->atom_context->bios + data_offset);"
          },
          {
            "type": "delete",
            "line": "\t\tif (index > MAX_SUPPORTED_TV_TIMING)"
          },
          {
            "type": "add",
            "line": "\t\tif (index >= MAX_SUPPORTED_TV_TIMING)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn false;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tmode->crtc_htotal = le16_to_cpu(tv_info->aModeTimings[index].usCRTC_H_Total);"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase 2:"
          },
          {
            "type": "context",
            "line": " \t\ttv_info_v1_2 = (ATOM_ANALOG_TV_INFO_V1_2 *)(mode_info->atom_context->bios + data_offset);"
          },
          {
            "type": "delete",
            "line": "\t\tif (index > MAX_SUPPORTED_TV_TIMING_V1_2)"
          },
          {
            "type": "add",
            "line": "\t\tif (index >= MAX_SUPPORTED_TV_TIMING_V1_2)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn false;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tdtd_timings = &tv_info_v1_2->aModeTimings[index];"
          }
        ]
      }
    ]
  },
  {
    "commit": "0048b4837affd153897ed1222283492070027aa9",
    "files": [
      {
        "file": "block/blk-flush.c",
        "changes": [
          {
            "type": "context",
            "line": "index 20badd7b9d1b..9c423e53324a 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/blk-flush.c"
          },
          {
            "type": "context",
            "line": "+++ b/block/blk-flush.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #include \"blk.h\""
          },
          {
            "type": "context",
            "line": " #include \"blk-mq.h\""
          },
          {
            "type": "add",
            "line": "#include \"blk-mq-tag.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* FLUSH/FUA sequences */"
          },
          {
            "type": "context",
            "line": " enum {"
          },
          {
            "type": "context",
            "line": " \tstruct blk_flush_queue *fq = blk_get_flush_queue(q, flush_rq->mq_ctx);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (q->mq_ops) {"
          },
          {
            "type": "add",
            "line": "\t\tstruct blk_mq_hw_ctx *hctx;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t/* release the tag's ownership to the req cloned from */"
          },
          {
            "type": "context",
            "line": " \t\tspin_lock_irqsave(&fq->mq_flush_lock, flags);"
          },
          {
            "type": "add",
            "line": "\t\thctx = q->mq_ops->map_queue(q, flush_rq->mq_ctx->cpu);"
          },
          {
            "type": "add",
            "line": "\t\tblk_mq_tag_set_rq(hctx, flush_rq->tag, fq->orig_rq);"
          },
          {
            "type": "context",
            "line": " \t\tflush_rq->tag = -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * Borrow tag from the first request since they can't"
          },
          {
            "type": "delete",
            "line": "\t * be in flight at the same time."
          },
          {
            "type": "add",
            "line": "\t * be in flight at the same time. And acquire the tag's"
          },
          {
            "type": "add",
            "line": "\t * ownership for flush req."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tif (q->mq_ops) {"
          },
          {
            "type": "add",
            "line": "\t\tstruct blk_mq_hw_ctx *hctx;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tflush_rq->mq_ctx = first_rq->mq_ctx;"
          },
          {
            "type": "context",
            "line": " \t\tflush_rq->tag = first_rq->tag;"
          },
          {
            "type": "add",
            "line": "\t\tfq->orig_rq = first_rq;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\thctx = q->mq_ops->map_queue(q, first_rq->mq_ctx->cpu);"
          },
          {
            "type": "add",
            "line": "\t\tblk_mq_tag_set_rq(hctx, first_rq->tag, flush_rq);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tflush_rq->cmd_type = REQ_TYPE_FS;"
          }
        ]
      },
      {
        "file": "block/blk-mq-tag.c",
        "changes": [
          {
            "type": "context",
            "line": "index 9b6e28830b82..9115c6d59948 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/blk-mq-tag.c"
          },
          {
            "type": "context",
            "line": "+++ b/block/blk-mq-tag.c"
          },
          {
            "type": "context",
            "line": " \t\tfor (bit = find_first_bit(&bm->word, bm->depth);"
          },
          {
            "type": "context",
            "line": " \t\t     bit < bm->depth;"
          },
          {
            "type": "context",
            "line": " \t\t     bit = find_next_bit(&bm->word, bm->depth, bit + 1)) {"
          },
          {
            "type": "delete",
            "line": "\t\t     \trq = blk_mq_tag_to_rq(hctx->tags, off + bit);"
          },
          {
            "type": "add",
            "line": "\t\t\trq = hctx->tags->rqs[off + bit];"
          },
          {
            "type": "context",
            "line": " \t\t\tif (rq->q == hctx->queue)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tfn(hctx, rq, data, reserved);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tfor (bit = find_first_bit(&bm->word, bm->depth);"
          },
          {
            "type": "context",
            "line": " \t\t     bit < bm->depth;"
          },
          {
            "type": "context",
            "line": " \t\t     bit = find_next_bit(&bm->word, bm->depth, bit + 1)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\trq = blk_mq_tag_to_rq(tags, off + bit);"
          },
          {
            "type": "add",
            "line": "\t\t\trq = tags->rqs[off + bit];"
          },
          {
            "type": "context",
            "line": " \t\t\tfn(rq, data, reserved);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "block/blk-mq-tag.h",
        "changes": [
          {
            "type": "context",
            "line": "index 75893a34237d..9eb2cf4f01cb 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/blk-mq-tag.h"
          },
          {
            "type": "context",
            "line": "+++ b/block/blk-mq-tag.h"
          },
          {
            "type": "context",
            "line": " \t__blk_mq_tag_idle(hctx);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " * This helper should only be used for flush request to share tag"
          },
          {
            "type": "add",
            "line": " * with the request cloned from, and both the two requests can't be"
          },
          {
            "type": "add",
            "line": " * in flight at the same time. The caller has to make sure the tag"
          },
          {
            "type": "add",
            "line": " * can't be freed."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static inline void blk_mq_tag_set_rq(struct blk_mq_hw_ctx *hctx,"
          },
          {
            "type": "add",
            "line": "\t\tunsigned int tag, struct request *rq)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\thctx->tags->rqs[tag] = rq;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " #endif"
          }
        ]
      },
      {
        "file": "block/blk-mq.c",
        "changes": [
          {
            "type": "context",
            "line": "index 81edbd95bda8..f2d67b4047a0 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/blk-mq.c"
          },
          {
            "type": "context",
            "line": "+++ b/block/blk-mq.c"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(blk_mq_abort_requeue_list);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static inline bool is_flush_request(struct request *rq,"
          },
          {
            "type": "delete",
            "line": "\t\tstruct blk_flush_queue *fq, unsigned int tag)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "\treturn ((rq->cmd_flags & REQ_FLUSH_SEQ) &&"
          },
          {
            "type": "delete",
            "line": "\t\t\tfq->flush_rq->tag == tag);"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct request *blk_mq_tag_to_rq(struct blk_mq_tags *tags, unsigned int tag)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tstruct request *rq = tags->rqs[tag];"
          },
          {
            "type": "delete",
            "line": "\t/* mq_ctx of flush rq is always cloned from the corresponding req */"
          },
          {
            "type": "delete",
            "line": "\tstruct blk_flush_queue *fq = blk_get_flush_queue(rq->q, rq->mq_ctx);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!is_flush_request(rq, fq, tag))"
          },
          {
            "type": "delete",
            "line": "\t\treturn rq;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\treturn fq->flush_rq;"
          },
          {
            "type": "add",
            "line": "\treturn tags->rqs[tag];"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(blk_mq_tag_to_rq);"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "block/blk.h",
        "changes": [
          {
            "type": "context",
            "line": "index 026d9594142b..838188b35a83 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/blk.h"
          },
          {
            "type": "context",
            "line": "+++ b/block/blk.h"
          },
          {
            "type": "context",
            "line": " \tstruct list_head\tflush_queue[2];"
          },
          {
            "type": "context",
            "line": " \tstruct list_head\tflush_data_in_flight;"
          },
          {
            "type": "context",
            "line": " \tstruct request\t\t*flush_rq;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * flush_rq shares tag with this rq, both can't be active"
          },
          {
            "type": "add",
            "line": "\t * at the same time"
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tstruct request\t\t*orig_rq;"
          },
          {
            "type": "context",
            "line": " \tspinlock_t\t\tmq_flush_lock;"
          },
          {
            "type": "context",
            "line": " };"
          }
        ]
      }
    ]
  },
  {
    "commit": "005145378c9ad7575a01b6ce1ba118fb427f583a",
    "files": [
      {
        "file": "drivers/media/usdvb-usb-v2/dvb_usb_core.c",
        "changes": [
          {
            "type": "context",
            "line": "index 298c91a6f1f9..955fb0d07507 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/media/usb/dvb-usb-v2/dvb_usb_core.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/media/usb/dvb-usb-v2/dvb_usb_core.c"
          },
          {
            "type": "context",
            "line": " void dvb_usbv2_disconnect(struct usb_interface *intf)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct dvb_usb_device *d = usb_get_intfdata(intf);"
          },
          {
            "type": "delete",
            "line": "\tconst char *name = d->name;"
          },
          {
            "type": "delete",
            "line": "\tstruct device dev = d->udev->dev;"
          },
          {
            "type": "add",
            "line": "\tconst char *devname = kstrdup(dev_name(&d->udev->dev), GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tconst char *drvname = d->name;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdev_dbg(&d->udev->dev, \"%s: bInterfaceNumber=%d\\n\", __func__,"
          },
          {
            "type": "context",
            "line": " \t\t\tintf->cur_altsetting->desc.bInterfaceNumber);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdvb_usbv2_exit(d);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tdev_info(&dev, \"%s: '%s' successfully deinitialized and disconnected\\n\","
          },
          {
            "type": "delete",
            "line": "\t\t\tKBUILD_MODNAME, name);"
          },
          {
            "type": "add",
            "line": "\tpr_info(\"%s: '%s:%s' successfully deinitialized and disconnected\\n\","
          },
          {
            "type": "add",
            "line": "\t\tKBUILD_MODNAME, drvname, devname);"
          },
          {
            "type": "add",
            "line": "\tkfree(devname);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(dvb_usbv2_disconnect);"
          }
        ]
      }
    ]
  },
  {
    "commit": "00532d9f1404287cf3ec3a05056640d809516006",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-api/src/main/java/org/xwiki/rendering/async/internal/block/BlockAsyncRendererConfiguration.java",
        "changes": [
          {
            "type": "context",
            "line": "index 3edb17a2ffe..82a33c07978 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-api/src/main/java/org/xwiki/rendering/async/internal/block/BlockAsyncRendererConfiguration.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-api/src/main/java/org/xwiki/rendering/async/internal/block/BlockAsyncRendererConfiguration.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private boolean inline;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private boolean resricted;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private BlockAsyncRendererDecorator decorator;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private Set<EntityReference> references;"
          },
          {
            "type": "context",
            "line": "         this.inline = inline;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @return indicator of whether the transformation context is restricted or not"
          },
          {
            "type": "add",
            "line": "     * @since 14.9"
          },
          {
            "type": "add",
            "line": "     * @since 14.4.6"
          },
          {
            "type": "add",
            "line": "     * @since 13.10.10"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    public boolean isResricted()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return this.resricted;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @param resricted indicator of whether the transformation context is restricted or not"
          },
          {
            "type": "add",
            "line": "     * @since 14.9"
          },
          {
            "type": "add",
            "line": "     * @since 14.4.6"
          },
          {
            "type": "add",
            "line": "     * @since 13.10.10"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    public void setResricted(boolean resricted)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        this.resricted = resricted;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * @return the decorator"
          },
          {
            "type": "context",
            "line": "      */"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-api/src/main/java/org/xwiki/rendering/async/internal/block/DefaultBlockAsyncRenderer.java",
        "changes": [
          {
            "type": "context",
            "line": "index d9e1328a268..8e6a0d9917c 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-api/src/main/java/org/xwiki/rendering/async/internal/block/DefaultBlockAsyncRenderer.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-api/src/main/java/org/xwiki/rendering/async/internal/block/DefaultBlockAsyncRenderer.java"
          },
          {
            "type": "context",
            "line": "     private Block tranform(XDOM xdom, Block block) throws RenderingException"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         TransformationContext transformationContext ="
          },
          {
            "type": "delete",
            "line": "            new TransformationContext(xdom, this.configuration.getDefaultSyntax(), false);"
          },
          {
            "type": "add",
            "line": "            new TransformationContext(xdom, this.configuration.getDefaultSyntax(), this.configuration.isResricted());"
          },
          {
            "type": "context",
            "line": "         transformationContext.setTargetSyntax(this.configuration.getTargetSyntax());"
          },
          {
            "type": "context",
            "line": "         transformationContext.setId(this.configuration.getTransformationId());"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/main/java/org/xwiki/rendering/async/internal/AbstractExecutedContentMacro.java",
        "changes": [
          {
            "type": "context",
            "line": "index 8a40f51ca5e..57c6a076830 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/main/java/org/xwiki/rendering/async/internal/AbstractExecutedContentMacro.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/main/java/org/xwiki/rendering/async/internal/AbstractExecutedContentMacro.java"
          },
          {
            "type": "context",
            "line": "         // Set the transformation id"
          },
          {
            "type": "context",
            "line": "         configuration.setTransformationId(context.getTransformationContext().getId());"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Indicate if we are in a restricted mode"
          },
          {
            "type": "add",
            "line": "        configuration.setResricted(context.getTransformationContext().isRestricted());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return configuration;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/async/AsyncMacroTest.java",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..d9a567666c5"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/async/AsyncMacroTest.java"
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " * See the NOTICE file distributed with this work for additional"
          },
          {
            "type": "add",
            "line": " * information regarding copyright ownership."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This is free software; you can redistribute it and/or modify it"
          },
          {
            "type": "add",
            "line": " * under the terms of the GNU Lesser General Public License as"
          },
          {
            "type": "add",
            "line": " * published by the Free Software Foundation; either version 2.1 of"
          },
          {
            "type": "add",
            "line": " * the License, or (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This software is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU"
          },
          {
            "type": "add",
            "line": " * Lesser General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU Lesser General Public"
          },
          {
            "type": "add",
            "line": " * License along with this software; if not, write to the Free"
          },
          {
            "type": "add",
            "line": " * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA"
          },
          {
            "type": "add",
            "line": " * 02110-1301 USA, or see the FSF site: http://www.fsf.org."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "package org.xwiki.rendering.async;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import java.util.Arrays;"
          },
          {
            "type": "add",
            "line": "import java.util.Collections;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import org.junit.jupiter.api.BeforeEach;"
          },
          {
            "type": "add",
            "line": "import org.junit.jupiter.api.Test;"
          },
          {
            "type": "add",
            "line": "import org.mockito.ArgumentCaptor;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.async.internal.AsyncMacro;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.async.internal.block.BlockAsyncRendererConfiguration;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.async.internal.block.BlockAsyncRendererExecutor;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.block.MacroBlock;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.block.WordBlock;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.block.XDOM;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.listener.MetaData;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.macro.MacroContentParser;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.syntax.Syntax;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.transformation.MacroTransformationContext;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.TestEnvironment;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.annotation.ComponentList;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.junit5.mockito.ComponentTest;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.junit5.mockito.InjectComponentManager;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.junit5.mockito.InjectMockComponents;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.junit5.mockito.MockComponent;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.test.mockito.MockitoComponentManager;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.ArgumentMatchers.any;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.ArgumentMatchers.eq;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.ArgumentMatchers.same;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.Mockito.verify;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.Mockito.when;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Unit tests for {@link AsyncMacro}."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @version $Id$"
          },
          {
            "type": "add",
            "line": " * @since 8.3RC1"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "@ComponentTest"
          },
          {
            "type": "add",
            "line": "@ComponentList(TestEnvironment.class)"
          },
          {
            "type": "add",
            "line": "class AsyncMacroTest"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    @InjectMockComponents"
          },
          {
            "type": "add",
            "line": "    private AsyncMacro macro;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @InjectComponentManager"
          },
          {
            "type": "add",
            "line": "    private MockitoComponentManager componentManager;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @MockComponent"
          },
          {
            "type": "add",
            "line": "    private MacroContentParser parser;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private BlockAsyncRendererExecutor executor;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @BeforeEach"
          },
          {
            "type": "add",
            "line": "    public void beforeEach() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        this.executor = this.componentManager.getInstance(BlockAsyncRendererExecutor.class);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void executeInRestrictedMode() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        MacroBlock macroBlock = new MacroBlock(\"async\", Collections.<String, String>emptyMap(), false);"
          },
          {
            "type": "add",
            "line": "        MetaData metadata = new MetaData();"
          },
          {
            "type": "add",
            "line": "        metadata.addMetaData(MetaData.SOURCE, \"source\");"
          },
          {
            "type": "add",
            "line": "        XDOM pageXDOM = new XDOM(Arrays.asList(macroBlock), metadata);"
          },
          {
            "type": "add",
            "line": "        MacroTransformationContext macroContext = new MacroTransformationContext();"
          },
          {
            "type": "add",
            "line": "        macroContext.setSyntax(Syntax.XWIKI_2_0);"
          },
          {
            "type": "add",
            "line": "        macroContext.setCurrentMacroBlock(macroBlock);"
          },
          {
            "type": "add",
            "line": "        macroContext.setXDOM(pageXDOM);"
          },
          {
            "type": "add",
            "line": "        macroContext.getTransformationContext().setRestricted(true);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        XDOM contentXDOM = new XDOM(Arrays.asList(new WordBlock(\"test\")), metadata);"
          },
          {
            "type": "add",
            "line": "        when(this.parser.parse(eq(\"\"), same(macroContext), eq(false), eq(false))).thenReturn(contentXDOM);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        when(this.executor.execute(any())).thenReturn(new WordBlock(\"result\"));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.macro.execute(new AsyncMacroParameters(), \"\", macroContext);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        ArgumentCaptor<BlockAsyncRendererConfiguration> configurationCaptor ="
          },
          {
            "type": "add",
            "line": "            ArgumentCaptor.forClass(BlockAsyncRendererConfiguration.class);"
          },
          {
            "type": "add",
            "line": "        verify(this.executor).execute(configurationCaptor.capture());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        BlockAsyncRendererConfiguration configuration = configurationCaptor.getValue();"
          },
          {
            "type": "add",
            "line": "        assertTrue(configuration.isResricted());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/async/IntegrationTests.java",
        "changes": [
          {
            "type": "context",
            "line": "similarity index 98%"
          },
          {
            "type": "context",
            "line": "rename from xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/macro/box/IntegrationTests.java"
          },
          {
            "type": "context",
            "line": "rename to xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/async/IntegrationTests.java"
          },
          {
            "type": "context",
            "line": "index 9c53df163b1..5db46cbc3b2 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/macro/box/IntegrationTests.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-async/xwiki-platform-rendering-async-macro/src/test/java/org/xwiki/rendering/async/IntegrationTests.java"
          },
          {
            "type": "context",
            "line": "  * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA"
          },
          {
            "type": "context",
            "line": "  * 02110-1301 USA, or see the FSF site: http://www.fsf.org."
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "delete",
            "line": "package org.xwiki.rendering.macro.box;"
          },
          {
            "type": "add",
            "line": "package org.xwiki.rendering.async;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import java.util.List;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import org.xwiki.model.reference.EntityReference;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.observation.ObservationManager;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.observation.event.Event;"
          },
          {
            "type": "delete",
            "line": "import org.xwiki.rendering.async.AsyncContext;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.rendering.async.internal.AsyncRendererJobRequest;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.rendering.async.internal.AsyncRendererJobStatus;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.rendering.test.integration.RenderingTestSuite;"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-macros/xwiki-platform-rendering-macro-context/src/test/java/org/xwiki/rendering/internal/macro/context/ContextMacroTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 0dbb2f87910..bdfef96a71f 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-macros/xwiki-platform-rendering-macro-context/src/test/java/org/xwiki/rendering/internal/macro/context/ContextMacroTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-macros/xwiki-platform-rendering-macro-context/src/test/java/org/xwiki/rendering/internal/macro/context/ContextMacroTest.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Test"
          },
          {
            "type": "context",
            "line": "     void executeOk() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        execute(false);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void executeInRestrictedMode() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        execute(true);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private void execute(boolean restricted) throws Exception"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         MacroBlock macroBlock = new MacroBlock(\"context\", Collections.<String, String>emptyMap(), false);"
          },
          {
            "type": "context",
            "line": "         MetaData metadata = new MetaData();"
          },
          {
            "type": "context",
            "line": "         macroContext.setSyntax(Syntax.XWIKI_2_0);"
          },
          {
            "type": "context",
            "line": "         macroContext.setCurrentMacroBlock(macroBlock);"
          },
          {
            "type": "context",
            "line": "         macroContext.setXDOM(pageXDOM);"
          },
          {
            "type": "add",
            "line": "        macroContext.getTransformationContext().setRestricted(restricted);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         DocumentModelBridge dmb = mock(DocumentModelBridge.class);"
          },
          {
            "type": "context",
            "line": "         when(this.dab.getTranslatedDocumentInstance(TARGET_REFERENCE)).thenReturn(dmb);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         XDOM contentXDOM = new XDOM(Arrays.asList(new WordBlock(\"test\")), metadata);"
          },
          {
            "type": "delete",
            "line": "        when(this.parser.parse(eq(\"\"), same(macroContext), eq(false), any(MetaData.class), eq(false))).thenReturn(contentXDOM);"
          },
          {
            "type": "add",
            "line": "        when(this.parser.parse(eq(\"\"), same(macroContext), eq(false), any(MetaData.class), eq(false)))"
          },
          {
            "type": "add",
            "line": "            .thenReturn(contentXDOM);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         ContextMacroParameters parameters = new ContextMacroParameters();"
          },
          {
            "type": "context",
            "line": "         parameters.setDocument(\"target\");"
          },
          {
            "type": "context",
            "line": "         assertEquals(AUTHOR, configuration.getSecureAuthorReference());"
          },
          {
            "type": "context",
            "line": "         assertEquals(SOURCE_REFERENCE, configuration.getSecureDocumentReference());"
          },
          {
            "type": "context",
            "line": "         assertSame(pageXDOM, configuration.getXDOM());"
          },
          {
            "type": "add",
            "line": "        assertEquals(restricted, configuration.isResricted());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "008ba2a13f2d04c947adc536d19debb8fe66f110",
    "files": [
      {
        "file": "net/packet/af_packet.c",
        "changes": [
          {
            "type": "context",
            "line": "index c26172995511..d288f52c53f7 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/packet/af_packet.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/packet/af_packet.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&fanout_mutex);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\terr = -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\tif (!po->running)"
          },
          {
            "type": "delete",
            "line": "\t\tgoto out;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \terr = -EALREADY;"
          },
          {
            "type": "context",
            "line": " \tif (po->fanout)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out;"
          },
          {
            "type": "context",
            "line": " \t\tlist_add(&match->list, &fanout_list);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \terr = -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\tif (match->type == type &&"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tspin_lock(&po->bind_lock);"
          },
          {
            "type": "add",
            "line": "\tif (po->running &&"
          },
          {
            "type": "add",
            "line": "\t    match->type == type &&"
          },
          {
            "type": "context",
            "line": " \t    match->prot_hook.type == po->prot_hook.type &&"
          },
          {
            "type": "context",
            "line": " \t    match->prot_hook.dev == po->prot_hook.dev) {"
          },
          {
            "type": "context",
            "line": " \t\terr = -ENOSPC;"
          },
          {
            "type": "context",
            "line": " \t\t\terr = 0;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": "\tspin_unlock(&po->bind_lock);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (err && !refcount_read(&match->sk_ref)) {"
          },
          {
            "type": "add",
            "line": "\t\tlist_del(&match->list);"
          },
          {
            "type": "add",
            "line": "\t\tkfree(match);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " out:"
          },
          {
            "type": "context",
            "line": " \tif (err && rollover) {"
          },
          {
            "type": "context",
            "line": " \t\tkfree(rollover);"
          }
        ]
      }
    ]
  },
  {
    "commit": "00b5f37189d24ac3ed46cb7f11742094778c46ce",
    "files": [
      {
        "file": "arch/x86/kvm/lapic.c",
        "changes": [
          {
            "type": "context",
            "line": "index 80a2020c4db4..66b0eb0bda94 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/kvm/lapic.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/kvm/lapic.c"
          },
          {
            "type": "context",
            "line": " \t*r = -1;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (irq->shorthand == APIC_DEST_SELF) {"
          },
          {
            "type": "add",
            "line": "\t\tif (KVM_BUG_ON(!src, kvm)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t*r = 0;"
          },
          {
            "type": "add",
            "line": "\t\t\treturn true;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t*r = kvm_apic_set_irq(src->vcpu, irq, dest_map);"
          },
          {
            "type": "context",
            "line": " \t\treturn true;"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "00e8181bd97c834fe60751b0c511d4bb97875f78",
    "files": [
      {
        "file": "libavcodec/ac3_parser.c",
        "changes": [
          {
            "type": "context",
            "line": "index f4618bf215..1e203ae6ac 100644"
          },
          {
            "type": "context",
            "line": "--- a/libavcodec/ac3_parser.c"
          },
          {
            "type": "context",
            "line": "+++ b/libavcodec/ac3_parser.c"
          },
          {
            "type": "context",
            "line": "         return AVERROR(ENOMEM);"
          },
          {
            "type": "context",
            "line": "     hdr = *phdr;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_get_bits8(&gb, buf, size);"
          },
          {
            "type": "add",
            "line": "    err = init_get_bits8(&gb, buf, size);"
          },
          {
            "type": "add",
            "line": "    if (err < 0)"
          },
          {
            "type": "add",
            "line": "        return AVERROR_INVALIDDATA;"
          },
          {
            "type": "context",
            "line": "     err = ff_ac3_parse_header(&gb, hdr);"
          },
          {
            "type": "context",
            "line": "     if (err < 0)"
          },
          {
            "type": "context",
            "line": "         return AVERROR_INVALIDDATA;"
          }
        ]
      }
    ]
  },
  {
    "commit": "01075081cbcd9130a72115cdb50ee61fc394edc1",
    "files": [
      {
        "file": "htdocs/admin/tools/dolibarr_export.php",
        "changes": [
          {
            "type": "context",
            "line": "index 55be556afb9..231699dc636 100644"
          },
          {
            "type": "context",
            "line": "--- a/htdocs/admin/tools/dolibarr_export.php"
          },
          {
            "type": "context",
            "line": "+++ b/htdocs/admin/tools/dolibarr_export.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " if ($action == 'delete')"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\t$file=$conf->admin->dir_output.'/'.GETPOST('urlfile');"
          },
          {
            "type": "add",
            "line": "\t$file=$conf->admin->dir_output.'/backup/'.basename(GETPOST('urlfile', 'alpha'));"
          },
          {
            "type": "context",
            "line": "     $ret=dol_delete_file($file, 1);"
          },
          {
            "type": "context",
            "line": "     if ($ret) setEventMessages($langs->trans(\"FileWasRemoved\", GETPOST('urlfile')), null, 'mesgs');"
          },
          {
            "type": "context",
            "line": "     else setEventMessages($langs->trans(\"ErrorFailToDeleteFile\", GETPOST('urlfile')), null, 'errors');"
          }
        ]
      },
      {
        "file": "htdocs/admin/tools/export.php",
        "changes": [
          {
            "type": "context",
            "line": "index 5bfacc6c4f0..5697e48e07f 100644"
          },
          {
            "type": "context",
            "line": "--- a/htdocs/admin/tools/export.php"
          },
          {
            "type": "context",
            "line": "+++ b/htdocs/admin/tools/export.php"
          },
          {
            "type": "context",
            "line": "         dol_syslog(\"Command are restricted to \".$dolibarr_main_restrict_os_commands.\". We check that one of this command is inside \".$cmddump);"
          },
          {
            "type": "context",
            "line": "         foreach($arrayofallowedcommand as $allowedcommand)"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            if (preg_match('/'.preg_quote($allowedcommand,'/').'/', $cmddump))"
          },
          {
            "type": "add",
            "line": "            $basenamecmddump=basename($cmddump);"
          },
          {
            "type": "add",
            "line": "            if (preg_match('/^'.preg_quote($allowedcommand,'/').'$/', $basenamecmddump)) // the provided command $cmddump must be an allowed command"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "context",
            "line": "                 $ok=1;"
          },
          {
            "type": "context",
            "line": "                 break;"
          }
        ]
      },
      {
        "file": "htdocs/core/class/utils.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 8c051c85b33..3d43a319e51 100644"
          },
          {
            "type": "context",
            "line": "--- a/htdocs/core/class/utils.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/htdocs/core/class/utils.class.php"
          },
          {
            "type": "context",
            "line": " \t\t\tdol_mkdir($conf->admin->dir_output.'/backup');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t// Parameteres execution"
          },
          {
            "type": "delete",
            "line": "\t\t\t$command=$cmddump;"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (preg_match(\"/\\s/\",$command)) $command=escapeshellarg($command);\t// Use quotes on command"
          },
          {
            "type": "add",
            "line": "\t\t\t$command = $cmddump;"
          },
          {
            "type": "add",
            "line": "\t\t\t$command = preg_replace('/(\\$|%)/', '', $command);                  // We removed chars that can be used to inject vars that contains space inside path of command without seeing there is a space to bypass the escapeshellarg."
          },
          {
            "type": "add",
            "line": "\t\t\tif (preg_match(\"/\\s/\",$command)) $command=escapeshellarg($command);\t// If there is spaces, we add quotes on command to be sure $command is only a program and not a program+parameters"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t//$param=escapeshellarg($dolibarr_main_db_name).\" -h \".escapeshellarg($dolibarr_main_db_host).\" -u \".escapeshellarg($dolibarr_main_db_user).\" -p\".escapeshellarg($dolibarr_main_db_pass);"
          },
          {
            "type": "context",
            "line": " \t\t\t$param=$dolibarr_main_db_name.\" -h \".$dolibarr_main_db_host;"
          },
          {
            "type": "context",
            "line": " \t\t\t$param.=\" -u \".$dolibarr_main_db_user;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (! empty($dolibarr_main_db_port)) $param.=\" -P \".$dolibarr_main_db_port;"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (! GETPOST(\"use_transaction\"))    $param.=\" -l --single-transaction\";"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (GETPOST(\"disable_fk\") || $usedefault) $param.=\" -K\";"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (GETPOST(\"sql_compat\") && GETPOST(\"sql_compat\") != 'NONE') $param.=\" --compatible=\".escapeshellarg(GETPOST(\"sql_compat\",\"alpha\"));"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (GETPOST(\"drop_database\"))        $param.=\" --add-drop-database\";"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (GETPOST(\"sql_structure\") || $usedefault)"
          },
          {
            "type": "add",
            "line": "\t\t\tif (! GETPOST(\"use_transaction\", \"alpha\"))    $param.=\" -l --single-transaction\";"
          },
          {
            "type": "add",
            "line": "\t\t\tif (GETPOST(\"disable_fk\", \"alpha\") || $usedefault) $param.=\" -K\";"
          },
          {
            "type": "add",
            "line": "\t\t\tif (GETPOST(\"sql_compat\", \"alpha\") && GETPOST(\"sql_compat\", \"alpha\") != 'NONE') $param.=\" --compatible=\".escapeshellarg(GETPOST(\"sql_compat\", \"alpha\"));"
          },
          {
            "type": "add",
            "line": "\t\t\tif (GETPOST(\"drop_database\", \"alpha\"))        $param.=\" --add-drop-database\";"
          },
          {
            "type": "add",
            "line": "\t\t\tif (GETPOST(\"sql_structure\", \"alpha\") || $usedefault)"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (GETPOST(\"drop\") || $usedefault)\t$param.=\" --add-drop-table=TRUE\";"
          },
          {
            "type": "delete",
            "line": "\t\t\t\telse \t\t\t\t\t\t\t    $param.=\" --add-drop-table=FALSE\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (GETPOST(\"drop\", \"alpha\") || $usedefault)\t$param.=\" --add-drop-table=TRUE\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\telse \t\t\t\t       \t         \t\t    $param.=\" --add-drop-table=FALSE\";"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$param.=\" -t\";"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (GETPOST(\"disable-add-locks\")) $param.=\" --add-locks=FALSE\";"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (GETPOST(\"sql_data\") || $usedefault)"
          },
          {
            "type": "add",
            "line": "\t\t\tif (GETPOST(\"disable-add-locks\", \"alpha\")) $param.=\" --add-locks=FALSE\";"
          },
          {
            "type": "add",
            "line": "\t\t\tif (GETPOST(\"sql_data\", \"alpha\") || $usedefault)"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$param.=\" --tables\";"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (GETPOST(\"showcolumns\") || $usedefault)\t $param.=\" -c\";"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (GETPOST(\"extended_ins\") || $usedefault) $param.=\" -e\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (GETPOST(\"showcolumns\", \"alpha\") || $usedefault)\t $param.=\" -c\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (GETPOST(\"extended_ins\", \"alpha\") || $usedefault) $param.=\" -e\";"
          },
          {
            "type": "context",
            "line": " \t\t\t\telse $param.=\" --skip-extended-insert\";"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (GETPOST(\"delayed\"))\t \t $param.=\" --delayed-insert\";"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (GETPOST(\"sql_ignore\"))\t $param.=\" --insert-ignore\";"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (GETPOST(\"hexforbinary\") || $usedefault) $param.=\" --hex-blob\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (GETPOST(\"delayed\", \"alpha\"))\t \t $param.=\" --delayed-insert\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (GETPOST(\"sql_ignore\", \"alpha\"))\t $param.=\" --insert-ignore\";"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (GETPOST(\"hexforbinary\", \"alpha\") || $usedefault) $param.=\" --hex-blob\";"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tdol_mkdir($conf->admin->dir_output.'/backup');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t// Parameteres execution"
          },
          {
            "type": "delete",
            "line": "\t\t\t$command=$cmddump;"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (preg_match(\"/\\s/\",$command)) $command=escapeshellarg($command);\t// Use quotes on command"
          },
          {
            "type": "add",
            "line": "\t\t\t$command = $cmddump;"
          },
          {
            "type": "add",
            "line": "\t\t\t$command = preg_replace('/(\\$|%)/', '', $command);                  // We removed chars that can be used to inject vars that contains space inside path of command without seeing there is a space to bypass the escapeshellarg."
          },
          {
            "type": "add",
            "line": "\t\t\tif (preg_match(\"/\\s/\",$command)) $command=escapeshellarg($command);\t// If there is spaces, we add quotes on command to be sure $command is only a program and not a program+parameters"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t//$param=escapeshellarg($dolibarr_main_db_name).\" -h \".escapeshellarg($dolibarr_main_db_host).\" -u \".escapeshellarg($dolibarr_main_db_user).\" -p\".escapeshellarg($dolibarr_main_db_pass);"
          },
          {
            "type": "context",
            "line": " \t\t\t//$param=\"-F c\";"
          }
        ]
      }
    ]
  },
  {
    "commit": "01120163a6b4d905029d416e7305575df31df8af",
    "files": [
      {
        "file": "app/Controller/UsersController.php",
        "changes": [
          {
            "type": "context",
            "line": "index 186a27aa0..6f3f5f289 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/Controller/UsersController.php"
          },
          {
            "type": "context",
            "line": "+++ b/app/Controller/UsersController.php"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "delete",
            "line": "            if (!$abortPost && !$this->_isRest()) {"
          },
          {
            "type": "add",
            "line": "            if (!$abortPost && (!$this->_isRest() || empty($this->request->header('Authorization')))) {"
          },
          {
            "type": "context",
            "line": "                 if (Configure::read('Security.require_password_confirmation')) {"
          },
          {
            "type": "context",
            "line": "                     if (!empty($this->request->data['User']['current_password'])) {"
          },
          {
            "type": "context",
            "line": "                         $hashed = $this->User->verifyPassword($this->Auth->user('id'), $this->request->data['User']['current_password']);"
          },
          {
            "type": "context",
            "line": "                 $this->request->data['User'] = $this->request->data;"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             $abortPost = false;"
          },
          {
            "type": "delete",
            "line": "            if (!$this->_isRest()) {"
          },
          {
            "type": "add",
            "line": "            if (!$this->_isRest() || empty($this->request->header('Authorization'))) {"
          },
          {
            "type": "context",
            "line": "                 if (Configure::read('Security.require_password_confirmation')) {"
          },
          {
            "type": "context",
            "line": "                     if (!empty($this->request->data['User']['current_password'])) {"
          },
          {
            "type": "context",
            "line": "                         $hashed = $this->User->verifyPassword($this->Auth->user('id'), $this->request->data['User']['current_password']);"
          }
        ]
      }
    ]
  },
  {
    "commit": "012555c1cef35601b543cde67bff8726de97eb39",
    "files": [
      {
        "file": "INSTALL",
        "changes": [
          {
            "type": "context",
            "line": "index 67c0c05c2..0087a4106 100644"
          },
          {
            "type": "context",
            "line": "--- a/INSTALL"
          },
          {
            "type": "context",
            "line": "+++ b/INSTALL"
          },
          {
            "type": "context",
            "line": " \tphp_value       upload_max_filesize     2M"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "SECURE YOUR INSTALLATION"
          },
          {
            "type": "add",
            "line": "========================"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Access through the webserver to the following directories should be denied:"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  /config"
          },
          {
            "type": "add",
            "line": "  /temp"
          },
          {
            "type": "add",
            "line": "  /logs"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Roundcube uses .htaccess files to protect these directories, so be sure to"
          },
          {
            "type": "add",
            "line": "allow override of the Limit directives to get them taken into account. The"
          },
          {
            "type": "add",
            "line": "package also ships a .htaccess file in the root directory which defines some"
          },
          {
            "type": "add",
            "line": "rewrite rules. In order to properly secure your installation, please enable"
          },
          {
            "type": "add",
            "line": "mod_rewrite for Apache webserver and double check access to the above listed"
          },
          {
            "type": "add",
            "line": "directories and their contents is denied."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " UPGRADING"
          },
          {
            "type": "context",
            "line": " ========="
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "config/.htaccess",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..896e680ba"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/config/.htaccess"
          },
          {
            "type": "add",
            "line": "# deny webserver access to this directory"
          },
          {
            "type": "add",
            "line": "Deny from all"
          }
        ]
      },
      {
        "file": "logs/.htaccess",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..896e680ba"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/logs/.htaccess"
          },
          {
            "type": "add",
            "line": "# deny webserver access to this directory"
          },
          {
            "type": "add",
            "line": "Deny from all"
          }
        ]
      },
      {
        "file": "temp/.htaccess",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..896e680ba"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/temp/.htaccess"
          },
          {
            "type": "add",
            "line": "# deny webserver access to this directory"
          },
          {
            "type": "add",
            "line": "Deny from all"
          }
        ]
      }
    ]
  },
  {
    "commit": "0143fc5e9f6f5aad4764801015bc8d4b4a278200",
    "files": [
      {
        "file": "fs/udf/namei.c",
        "changes": [
          {
            "type": "context",
            "line": "index 18024178ac4c..c31deb382afd 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/udf/namei.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/udf/namei.c"
          },
          {
            "type": "context",
            "line": " \t*lenp = 3;"
          },
          {
            "type": "context",
            "line": " \tfid->udf.block = location.logicalBlockNum;"
          },
          {
            "type": "context",
            "line": " \tfid->udf.partref = location.partitionReferenceNum;"
          },
          {
            "type": "add",
            "line": "\tfid->udf.parent_partref = 0;"
          },
          {
            "type": "context",
            "line": " \tfid->udf.generation = inode->i_generation;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (parent) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "01521d614cb578de75a406394b4f0426f6036ba7",
    "files": [
      {
        "file": "app/View/SharingGroups/view.ctp",
        "changes": [
          {
            "type": "context",
            "line": "index 6500f7b21..67014a47c 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/View/SharingGroups/view.ctp"
          },
          {
            "type": "context",
            "line": "+++ b/app/View/SharingGroups/view.ctp"
          },
          {
            "type": "context",
            "line": " <div class=\"roles view\">"
          },
          {
            "type": "delete",
            "line": "<h2><?= __('Sharing Group %s', $sg['SharingGroup']['name']);?></h2>"
          },
          {
            "type": "add",
            "line": "<h2><?= __('Sharing Group %s', h($sg['SharingGroup']['name']));?></h2>"
          },
          {
            "type": "context",
            "line": " <div class=\"row-fluid\"><div class=\"span8\" style=\"margin:0\">"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " $tableData = ["
          }
        ]
      }
    ]
  },
  {
    "commit": "0185604c2d82c560dab2f2933a18f797e74ab5a8",
    "files": [
      {
        "file": "arch/x86/kvm/x86.c",
        "changes": [
          {
            "type": "context",
            "line": "index b84ba4b17757..7ffc224bbe41 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/kvm/x86.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/kvm/x86.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int kvm_vm_ioctl_set_pit(struct kvm *kvm, struct kvm_pit_state *ps)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "\tint i;"
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&kvm->arch.vpit->pit_state.lock);"
          },
          {
            "type": "context",
            "line": " \tmemcpy(&kvm->arch.vpit->pit_state, ps, sizeof(struct kvm_pit_state));"
          },
          {
            "type": "delete",
            "line": "\tkvm_pit_load_count(kvm, 0, ps->channels[0].count, 0);"
          },
          {
            "type": "add",
            "line": "\tfor (i = 0; i < 3; i++)"
          },
          {
            "type": "add",
            "line": "\t\tkvm_pit_load_count(kvm, i, ps->channels[i].count, 0);"
          },
          {
            "type": "context",
            "line": " \tmutex_unlock(&kvm->arch.vpit->pit_state.lock);"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " static int kvm_vm_ioctl_set_pit2(struct kvm *kvm, struct kvm_pit_state2 *ps)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tint start = 0;"
          },
          {
            "type": "add",
            "line": "\tint i;"
          },
          {
            "type": "context",
            "line": " \tu32 prev_legacy, cur_legacy;"
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&kvm->arch.vpit->pit_state.lock);"
          },
          {
            "type": "context",
            "line": " \tprev_legacy = kvm->arch.vpit->pit_state.flags & KVM_PIT_FLAGS_HPET_LEGACY;"
          },
          {
            "type": "context",
            "line": " \tmemcpy(&kvm->arch.vpit->pit_state.channels, &ps->channels,"
          },
          {
            "type": "context",
            "line": " \t       sizeof(kvm->arch.vpit->pit_state.channels));"
          },
          {
            "type": "context",
            "line": " \tkvm->arch.vpit->pit_state.flags = ps->flags;"
          },
          {
            "type": "delete",
            "line": "\tkvm_pit_load_count(kvm, 0, kvm->arch.vpit->pit_state.channels[0].count, start);"
          },
          {
            "type": "add",
            "line": "\tfor (i = 0; i < 3; i++)"
          },
          {
            "type": "add",
            "line": "\t\tkvm_pit_load_count(kvm, i, kvm->arch.vpit->pit_state.channels[i].count, start);"
          },
          {
            "type": "context",
            "line": " \tmutex_unlock(&kvm->arch.vpit->pit_state.lock);"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "01924cd948dbceb8391be671dab672e9f4a0ffe8",
    "files": [
      {
        "file": "app/View/Events/resolved_attributes.ctp",
        "changes": [
          {
            "type": "context",
            "line": "index 0243dc5a0..809ea8300 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/View/Events/resolved_attributes.ctp"
          },
          {
            "type": "context",
            "line": "+++ b/app/View/Events/resolved_attributes.ctp"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t<?php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\tif (!empty($item['types'])) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t\tforeach ($item['types'] as $type) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\t\techo '<option value=\"' . $type . '\" ';"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\t\techo ($type == $item['default_type'] ? 'selected=\"selected\"' : '') . '>' . $type . '</option>';"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\techo '<option value=\"' . h($type) . '\" ';"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\techo ($type == $item['default_type'] ? 'selected=\"selected\"' : '') . '>' . h($type) . '</option>';"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t?>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t<select id = \"<?php echo 'Attribute' . $k . 'SharingGroupId'; ?>\" class='sgToggle' style='padding:0px;height:20px;margin-top:3px;margin-bottom:0px;'>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t<?php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t\tforeach ($sgs as $sgKey => $sgValue) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\t\techo '<option value=\"' . $sgKey . '\">' . $sgValue . '</option>';"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\techo '<option value=\"' . h($sgKey) . '\">' . h($sgValue) . '</option>';"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t?>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t</select>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t</div>"
          },
          {
            "type": "context",
            "line": " \t\t\t</td>"
          },
          {
            "type": "context",
            "line": " \t\t\t<td class=\"short\">"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t<input type=\"text\" class=\"freetextCommentField\" id=\"<?php echo 'Attribute' . $k . 'Comment'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\" placeholder=\"<?php echo h($importComment); ?>\" <?php if (isset($item['comment']) && $item['comment'] !== false) echo 'value=\"' . $item['comment'] . '\"'?>/>"
          },
          {
            "type": "add",
            "line": "\t\t\t\t<input type=\"text\" class=\"freetextCommentField\" id=\"<?php echo 'Attribute' . $k . 'Comment'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\" placeholder=\"<?php echo h($importComment); ?>\" <?php if (isset($item['comment']) && $item['comment'] !== false) echo 'value=\"' . h($item['comment']) . '\"'?>/>"
          },
          {
            "type": "context",
            "line": " \t\t\t</td>"
          },
          {
            "type": "context",
            "line": " \t\t\t<td class=\"short\">"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t<input type=\"text\" class=\"freetextTagField\" id=\"<?php echo 'Attribute' . $k . 'Tags'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\"<?php if (isset($item['tags']) && $item['tags'] !== false) echo 'value=\"' . htmlspecialchars(implode(\",\",$item['tags'])) . '\"'?>/>"
          },
          {
            "type": "add",
            "line": "\t\t\t\t<input type=\"text\" class=\"freetextTagField\" id=\"<?php echo 'Attribute' . $k . 'Tags'; ?>\" style=\"padding:0px;height:20px;margin-bottom:0px;\"<?php if (isset($item['tags']) && $item['tags'] !== false) echo 'value=\"' . h(implode(\",\",$item['tags'])) . '\"'?>/>"
          },
          {
            "type": "context",
            "line": " \t\t\t</td>"
          },
          {
            "type": "context",
            "line": " \t\t\t<td class=\"action short\">"
          },
          {
            "type": "context",
            "line": " \t\t\t\t<span class=\"icon-remove pointer\" title=\"<?php echo __('Remove resolved attribute');?>\" role=\"button\" tabindex=\"0\" aria-label=\"<?php echo __('Remove resolved attribute');?>\" onClick=\"freetextRemoveRow('<?php echo $k; ?>', '<?php echo $event['Event']['id']; ?>');\"></span>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t<?php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\tforeach (array_keys($optionsRearranged) as $fromElement):"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t?>"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\t<option><?php echo $fromElement; ?></option>"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t<option><?php echo h($fromElement); ?></option>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t<?php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\tendforeach;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t?>"
          }
        ]
      }
    ]
  },
  {
    "commit": "01ca667133d019edc9f0a1f70a272447c84ec41f",
    "files": [
      {
        "file": "drivers/net/ethernet/intel/fm10k/fm10k_main.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5a0419421511..ecef949f3baa 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/ethernet/intel/fm10k/fm10k_main.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/ethernet/intel/fm10k/fm10k_main.c"
          },
          {
            "type": "context",
            "line": " \t/* create driver workqueue */"
          },
          {
            "type": "context",
            "line": " \tfm10k_workqueue = alloc_workqueue(\"%s\", WQ_MEM_RECLAIM, 0,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t  fm10k_driver_name);"
          },
          {
            "type": "add",
            "line": "\tif (!fm10k_workqueue)"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOMEM;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfm10k_dbg_init();"
          }
        ]
      }
    ]
  },
  {
    "commit": "027424c2c6c0991cb9c22f9511478229c9b17e5d",
    "files": [
      {
        "file": "channels/drive/client/drive_file.c",
        "changes": [
          {
            "type": "context",
            "line": "index 305438593..1ea4ab9da 100644"
          },
          {
            "type": "context",
            "line": "--- a/channels/drive/client/drive_file.c"
          },
          {
            "type": "context",
            "line": "+++ b/channels/drive/client/drive_file.c"
          },
          {
            "type": "context",
            "line": " \t} while (0)"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void drive_file_fix_path(WCHAR* path)"
          },
          {
            "type": "add",
            "line": "static BOOL drive_file_fix_path(WCHAR* path, size_t length)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tsize_t i;"
          },
          {
            "type": "delete",
            "line": "\tsize_t length = _wcslen(path);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif ((length == 0) || (length > UINT32_MAX))"
          },
          {
            "type": "add",
            "line": "\t\treturn FALSE;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tWINPR_ASSERT(path);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfor (i = 0; i < length; i++)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " #ifdef WIN32"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif ((length == 3) && (path[1] == L':') && (path[2] == L'/'))"
          },
          {
            "type": "delete",
            "line": "\t\treturn;"
          },
          {
            "type": "add",
            "line": "\t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #else"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif ((length == 1) && (path[0] == L'/'))"
          },
          {
            "type": "delete",
            "line": "\t\treturn;"
          },
          {
            "type": "add",
            "line": "\t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif ((length > 0) && (path[length - 1] == L'/'))"
          },
          {
            "type": "context",
            "line": " \t\tpath[length - 1] = L'\\0';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn TRUE;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static WCHAR* drive_file_combine_fullpath(const WCHAR* base_path, const WCHAR* path,"
          },
          {
            "type": "delete",
            "line": "                                          size_t PathLength)"
          },
          {
            "type": "add",
            "line": "                                          size_t PathWCharLength)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tWCHAR* fullpath;"
          },
          {
            "type": "delete",
            "line": "\tsize_t base_path_length;"
          },
          {
            "type": "add",
            "line": "\tBOOL ok = FALSE;"
          },
          {
            "type": "add",
            "line": "\tWCHAR* fullpath = NULL;"
          },
          {
            "type": "add",
            "line": "\tsize_t length;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!base_path || (!path && (PathLength > 0)))"
          },
          {
            "type": "delete",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "add",
            "line": "\tif (!base_path || (!path && (PathWCharLength > 0)))"
          },
          {
            "type": "add",
            "line": "\t\tgoto fail;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tbase_path_length = _wcslen(base_path) * 2;"
          },
          {
            "type": "delete",
            "line": "\tfullpath = (WCHAR*)calloc(1, base_path_length + PathLength + sizeof(WCHAR));"
          },
          {
            "type": "add",
            "line": "\tconst size_t base_path_length = _wcsnlen(base_path, MAX_PATH);"
          },
          {
            "type": "add",
            "line": "\tlength = base_path_length + PathWCharLength + 1;"
          },
          {
            "type": "add",
            "line": "\tfullpath = (WCHAR*)calloc(length, sizeof(WCHAR));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!fullpath)"
          },
          {
            "type": "add",
            "line": "\t\tgoto fail;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tCopyMemory(fullpath, base_path, base_path_length * sizeof(WCHAR));"
          },
          {
            "type": "add",
            "line": "\tif (path)"
          },
          {
            "type": "add",
            "line": "\t\tCopyMemory(&fullpath[base_path_length], path, PathWCharLength * sizeof(WCHAR));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (!drive_file_fix_path(fullpath, length))"
          },
          {
            "type": "add",
            "line": "\t\tgoto fail;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* Ensure the path does not contain sequences like '..' */"
          },
          {
            "type": "add",
            "line": "\tconst WCHAR dotdot[] = { '.', '.', '\\0' };"
          },
          {
            "type": "add",
            "line": "\tif (_wcsstr(&fullpath[base_path_length], dotdot))"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tWLog_ERR(TAG, \"malloc failed!\");"
          },
          {
            "type": "delete",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "add",
            "line": "\t\tchar abuffer[MAX_PATH] = { 0 };"
          },
          {
            "type": "add",
            "line": "\t\tConvertFromUnicode(CP_UTF8, 0, &fullpath[base_path_length], -1, (char**)&abuffer,"
          },
          {
            "type": "add",
            "line": "\t\t                   ARRAYSIZE(abuffer) - 1, NULL, NULL);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tWLog_WARN(TAG, \"[rdpdr] received invalid file path '%s' from server, aborting!\","
          },
          {
            "type": "add",
            "line": "\t\t          &abuffer[base_path_length]);"
          },
          {
            "type": "add",
            "line": "\t\tgoto fail;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tCopyMemory(fullpath, base_path, base_path_length);"
          },
          {
            "type": "delete",
            "line": "\tif (path)"
          },
          {
            "type": "delete",
            "line": "\t\tCopyMemory((char*)fullpath + base_path_length, path, PathLength);"
          },
          {
            "type": "delete",
            "line": "\tdrive_file_fix_path(fullpath);"
          },
          {
            "type": "add",
            "line": "\tok = TRUE;"
          },
          {
            "type": "add",
            "line": "fail:"
          },
          {
            "type": "add",
            "line": "\tif (!ok)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tfree(fullpath);"
          },
          {
            "type": "add",
            "line": "\t\tfullpath = NULL;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \treturn fullpath;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static BOOL drive_file_remove_dir(const WCHAR* path)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tWIN32_FIND_DATAW findFileData;"
          },
          {
            "type": "add",
            "line": "\tWIN32_FIND_DATAW findFileData = { 0 };"
          },
          {
            "type": "context",
            "line": " \tBOOL ret = TRUE;"
          },
          {
            "type": "delete",
            "line": "\tHANDLE dir;"
          },
          {
            "type": "delete",
            "line": "\tWCHAR* fullpath;"
          },
          {
            "type": "delete",
            "line": "\tWCHAR* path_slash;"
          },
          {
            "type": "delete",
            "line": "\tsize_t base_path_length;"
          },
          {
            "type": "add",
            "line": "\tHANDLE dir = INVALID_HANDLE_VALUE;"
          },
          {
            "type": "add",
            "line": "\tWCHAR* fullpath = NULL;"
          },
          {
            "type": "add",
            "line": "\tWCHAR* path_slash = NULL;"
          },
          {
            "type": "add",
            "line": "\tsize_t base_path_length = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!path)"
          },
          {
            "type": "context",
            "line": " \t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tbase_path_length = _wcslen(path) * 2;"
          },
          {
            "type": "delete",
            "line": "\tpath_slash = (WCHAR*)calloc(1, base_path_length + sizeof(WCHAR) * 3);"
          },
          {
            "type": "add",
            "line": "\tbase_path_length = _wcslen(path);"
          },
          {
            "type": "add",
            "line": "\tpath_slash = (WCHAR*)calloc(base_path_length + 3, sizeof(WCHAR));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!path_slash)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tCopyMemory(path_slash, path, base_path_length);"
          },
          {
            "type": "delete",
            "line": "\tpath_slash[base_path_length / 2] = L'/';"
          },
          {
            "type": "delete",
            "line": "\tpath_slash[base_path_length / 2 + 1] = L'*';"
          },
          {
            "type": "add",
            "line": "\tCopyMemory(path_slash, path, base_path_length * sizeof(WCHAR));"
          },
          {
            "type": "add",
            "line": "\tpath_slash[base_path_length] = L'/';"
          },
          {
            "type": "add",
            "line": "\tpath_slash[base_path_length + 1] = L'*';"
          },
          {
            "type": "context",
            "line": " \tDEBUG_WSTR(\"Search in %s\", path_slash);"
          },
          {
            "type": "context",
            "line": " \tdir = FindFirstFileW(path_slash, &findFileData);"
          },
          {
            "type": "delete",
            "line": "\tpath_slash[base_path_length / 2 + 1] = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (dir == INVALID_HANDLE_VALUE)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdo"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tsize_t len = _wcslen(findFileData.cFileName);"
          },
          {
            "type": "add",
            "line": "\t\tconst size_t len = _wcsnlen(findFileData.cFileName, ARRAYSIZE(findFileData.cFileName));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif ((len == 1 && findFileData.cFileName[0] == L'.') ||"
          },
          {
            "type": "context",
            "line": " \t\t    (len == 2 && findFileData.cFileName[0] == L'.' && findFileData.cFileName[1] == L'.'))"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tfullpath = drive_file_combine_fullpath(path_slash, findFileData.cFileName, len * 2);"
          },
          {
            "type": "add",
            "line": "\t\tfullpath = drive_file_combine_fullpath(path_slash, findFileData.cFileName, len);"
          },
          {
            "type": "context",
            "line": " \t\tDEBUG_WSTR(\"Delete %s\", fullpath);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (findFileData.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)"
          },
          {
            "type": "context",
            "line": " \treturn file->file_handle != INVALID_HANDLE_VALUE;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "DRIVE_FILE* drive_file_new(const WCHAR* base_path, const WCHAR* path, UINT32 PathLength, UINT32 id,"
          },
          {
            "type": "delete",
            "line": "                           UINT32 DesiredAccess, UINT32 CreateDisposition, UINT32 CreateOptions,"
          },
          {
            "type": "delete",
            "line": "                           UINT32 FileAttributes, UINT32 SharedAccess)"
          },
          {
            "type": "add",
            "line": "DRIVE_FILE* drive_file_new(const WCHAR* base_path, const WCHAR* path, UINT32 PathWCharLength,"
          },
          {
            "type": "add",
            "line": "                           UINT32 id, UINT32 DesiredAccess, UINT32 CreateDisposition,"
          },
          {
            "type": "add",
            "line": "                           UINT32 CreateOptions, UINT32 FileAttributes, UINT32 SharedAccess)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tDRIVE_FILE* file;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!base_path || (!path && (PathLength > 0)))"
          },
          {
            "type": "add",
            "line": "\tif (!base_path || (!path && (PathWCharLength > 0)))"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfile = (DRIVE_FILE*)calloc(1, sizeof(DRIVE_FILE));"
          },
          {
            "type": "context",
            "line": " \tfile->CreateDisposition = CreateDisposition;"
          },
          {
            "type": "context",
            "line": " \tfile->CreateOptions = CreateOptions;"
          },
          {
            "type": "context",
            "line": " \tfile->SharedAccess = SharedAccess;"
          },
          {
            "type": "delete",
            "line": "\tdrive_file_set_fullpath(file, drive_file_combine_fullpath(base_path, path, PathLength));"
          },
          {
            "type": "add",
            "line": "\tdrive_file_set_fullpath(file, drive_file_combine_fullpath(base_path, path, PathWCharLength));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!drive_file_init(file))"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tfullpath = drive_file_combine_fullpath(file->basepath, (WCHAR*)Stream_Pointer(input),"
          },
          {
            "type": "delete",
            "line": "\t\t\t                                       FileNameLength);"
          },
          {
            "type": "add",
            "line": "\t\t\t                                       FileNameLength / sizeof(WCHAR));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tif (!fullpath)"
          },
          {
            "type": "delete",
            "line": "\t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tWLog_ERR(TAG, \"drive_file_combine_fullpath failed!\");"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn FALSE;"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #ifdef _WIN32"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " BOOL drive_file_query_directory(DRIVE_FILE* file, UINT32 FsInformationClass, BYTE InitialQuery,"
          },
          {
            "type": "delete",
            "line": "                                const WCHAR* path, UINT32 PathLength, wStream* output)"
          },
          {
            "type": "add",
            "line": "                                const WCHAR* path, UINT32 PathWCharLength, wStream* output)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tsize_t length;"
          },
          {
            "type": "context",
            "line": " \tWCHAR* ent_path;"
          },
          {
            "type": "context",
            "line": " \t\tif (file->find_handle != INVALID_HANDLE_VALUE)"
          },
          {
            "type": "context",
            "line": " \t\t\tFindClose(file->find_handle);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tent_path = drive_file_combine_fullpath(file->basepath, path, PathLength);"
          },
          {
            "type": "add",
            "line": "\t\tent_path = drive_file_combine_fullpath(file->basepath, path, PathWCharLength);"
          },
          {
            "type": "context",
            "line": " \t\t/* open new search handle and retrieve the first entry */"
          },
          {
            "type": "context",
            "line": " \t\tfile->find_handle = FindFirstFileW(ent_path, &file->find_data);"
          },
          {
            "type": "context",
            "line": " \t\tfree(ent_path);"
          }
        ]
      },
      {
        "file": "channels/drive/client/drive_file.h",
        "changes": [
          {
            "type": "context",
            "line": "index ed789d6f0..6d3bd7045 100644"
          },
          {
            "type": "context",
            "line": "--- a/channels/drive/client/drive_file.h"
          },
          {
            "type": "context",
            "line": "+++ b/channels/drive/client/drive_file.h"
          },
          {
            "type": "context",
            "line": " \tUINT32 CreateOptions;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "DRIVE_FILE* drive_file_new(const WCHAR* base_path, const WCHAR* path, UINT32 PathLength, UINT32 id,"
          },
          {
            "type": "delete",
            "line": "                           UINT32 DesiredAccess, UINT32 CreateDisposition, UINT32 CreateOptions,"
          },
          {
            "type": "delete",
            "line": "                           UINT32 FileAttributes, UINT32 SharedAccess);"
          },
          {
            "type": "add",
            "line": "DRIVE_FILE* drive_file_new(const WCHAR* base_path, const WCHAR* path, UINT32 PathWCharLength,"
          },
          {
            "type": "add",
            "line": "                           UINT32 id, UINT32 DesiredAccess, UINT32 CreateDisposition,"
          },
          {
            "type": "add",
            "line": "                           UINT32 CreateOptions, UINT32 FileAttributes, UINT32 SharedAccess);"
          },
          {
            "type": "context",
            "line": " BOOL drive_file_free(DRIVE_FILE* file);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " BOOL drive_file_open(DRIVE_FILE* file);"
          },
          {
            "type": "context",
            "line": " BOOL drive_file_set_information(DRIVE_FILE* file, UINT32 FsInformationClass, UINT32 Length,"
          },
          {
            "type": "context",
            "line": "                                 wStream* input);"
          },
          {
            "type": "context",
            "line": " BOOL drive_file_query_directory(DRIVE_FILE* file, UINT32 FsInformationClass, BYTE InitialQuery,"
          },
          {
            "type": "delete",
            "line": "                                const WCHAR* path, UINT32 PathLength, wStream* output);"
          },
          {
            "type": "add",
            "line": "                                const WCHAR* path, UINT32 PathWCharLength, wStream* output);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #endif /* FREERDP_CHANNEL_DRIVE_FILE_H */"
          }
        ]
      },
      {
        "file": "channels/drive/client/drive_main.c",
        "changes": [
          {
            "type": "context",
            "line": "index 35dc704e0..b6cf2ad32 100644"
          },
          {
            "type": "context",
            "line": "--- a/channels/drive/client/drive_main.c"
          },
          {
            "type": "context",
            "line": "+++ b/channels/drive/client/drive_main.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tpath = (const WCHAR*)Stream_Pointer(irp->input);"
          },
          {
            "type": "context",
            "line": " \tFileId = irp->devman->id_sequence++;"
          },
          {
            "type": "delete",
            "line": "\tfile = drive_file_new(drive->path, path, PathLength, FileId, DesiredAccess, CreateDisposition,"
          },
          {
            "type": "delete",
            "line": "\t                      CreateOptions, FileAttributes, SharedAccess);"
          },
          {
            "type": "add",
            "line": "\tfile = drive_file_new(drive->path, path, PathLength / sizeof(WCHAR), FileId, DesiredAccess,"
          },
          {
            "type": "add",
            "line": "\t                      CreateDisposition, CreateOptions, FileAttributes, SharedAccess);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!file)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tirp->IoStatus = STATUS_UNSUCCESSFUL;"
          },
          {
            "type": "context",
            "line": " \t\tStream_Write_UINT32(irp->output, 0); /* Length */"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\telse if (!drive_file_query_directory(file, FsInformationClass, InitialQuery, path, PathLength,"
          },
          {
            "type": "delete",
            "line": "\t                                     irp->output))"
          },
          {
            "type": "add",
            "line": "\telse if (!drive_file_query_directory(file, FsInformationClass, InitialQuery, path,"
          },
          {
            "type": "add",
            "line": "\t                                     PathLength / sizeof(WCHAR), irp->output))"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tirp->IoStatus = drive_map_windows_err(GetLastError());"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "027ef6c87853b0a9df53175063028edb4950d476",
    "files": [
      {
        "file": "arch/x86/include/asm/pgtable.h",
        "changes": [
          {
            "type": "context",
            "line": "index fc9948465293..a1f780d45f76 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/include/asm/pgtable.h"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/include/asm/pgtable.h"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static inline int pmd_large(pmd_t pte)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\treturn (pmd_flags(pte) & (_PAGE_PSE | _PAGE_PRESENT)) =="
          },
          {
            "type": "delete",
            "line": "\t\t(_PAGE_PSE | _PAGE_PRESENT);"
          },
          {
            "type": "add",
            "line": "\treturn pmd_flags(pte) & _PAGE_PSE;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #ifdef CONFIG_TRANSPARENT_HUGEPAGE"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static inline int pmd_present(pmd_t pmd)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\treturn pmd_flags(pmd) & _PAGE_PRESENT;"
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * Checking for _PAGE_PSE is needed too because"
          },
          {
            "type": "add",
            "line": "\t * split_huge_page will temporarily clear the present bit (but"
          },
          {
            "type": "add",
            "line": "\t * the _PAGE_PSE flag will remain set at all times while the"
          },
          {
            "type": "add",
            "line": "\t * _PAGE_PRESENT bit is clear)."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\treturn pmd_flags(pmd) & (_PAGE_PRESENT | _PAGE_PROTNONE | _PAGE_PSE);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static inline int pmd_none(pmd_t pmd)"
          }
        ]
      }
    ]
  },
  {
    "commit": "0305cd5f7fca85dae392b9ba85b116896eb7c1c7",
    "files": [
      {
        "file": "fs/btrfs/inode.c",
        "changes": [
          {
            "type": "context",
            "line": "index 208db4e835f0..cbb4286490a1 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/inode.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/inode.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "static int truncate_inline_extent(struct inode *inode,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  struct btrfs_path *path,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  struct btrfs_key *found_key,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  const u64 item_end,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  const u64 new_size)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tstruct extent_buffer *leaf = path->nodes[0];"
          },
          {
            "type": "add",
            "line": "\tint slot = path->slots[0];"
          },
          {
            "type": "add",
            "line": "\tstruct btrfs_file_extent_item *fi;"
          },
          {
            "type": "add",
            "line": "\tu32 size = (u32)(new_size - found_key->offset);"
          },
          {
            "type": "add",
            "line": "\tstruct btrfs_root *root = BTRFS_I(inode)->root;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfi = btrfs_item_ptr(leaf, slot, struct btrfs_file_extent_item);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (btrfs_file_extent_compression(leaf, fi) != BTRFS_COMPRESS_NONE) {"
          },
          {
            "type": "add",
            "line": "\t\tloff_t offset = new_size;"
          },
          {
            "type": "add",
            "line": "\t\tloff_t page_end = ALIGN(offset, PAGE_CACHE_SIZE);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t * Zero out the remaining of the last page of our inline extent,"
          },
          {
            "type": "add",
            "line": "\t\t * instead of directly truncating our inline extent here - that"
          },
          {
            "type": "add",
            "line": "\t\t * would be much more complex (decompressing all the data, then"
          },
          {
            "type": "add",
            "line": "\t\t * compressing the truncated data, which might be bigger than"
          },
          {
            "type": "add",
            "line": "\t\t * the size of the inline extent, resize the extent, etc)."
          },
          {
            "type": "add",
            "line": "\t\t * We release the path because to get the page we might need to"
          },
          {
            "type": "add",
            "line": "\t\t * read the extent item from disk (data not in the page cache)."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\tbtrfs_release_path(path);"
          },
          {
            "type": "add",
            "line": "\t\treturn btrfs_truncate_page(inode, offset, page_end - offset, 0);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbtrfs_set_file_extent_ram_bytes(leaf, fi, size);"
          },
          {
            "type": "add",
            "line": "\tsize = btrfs_file_extent_calc_inline_size(size);"
          },
          {
            "type": "add",
            "line": "\tbtrfs_truncate_item(root, path, size, 1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (test_bit(BTRFS_ROOT_REF_COWS, &root->state))"
          },
          {
            "type": "add",
            "line": "\t\tinode_sub_bytes(inode, item_end + 1 - new_size);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  * this can truncate away extent items, csum items and directory items."
          },
          {
            "type": "context",
            "line": "  * It starts at a high offset and removes keys until it can't find"
          },
          {
            "type": "context",
            "line": " \t\t\t * special encodings"
          },
          {
            "type": "context",
            "line": " \t\t\t */"
          },
          {
            "type": "context",
            "line": " \t\t\tif (!del_item &&"
          },
          {
            "type": "delete",
            "line": "\t\t\t    btrfs_file_extent_compression(leaf, fi) == 0 &&"
          },
          {
            "type": "context",
            "line": " \t\t\t    btrfs_file_extent_encryption(leaf, fi) == 0 &&"
          },
          {
            "type": "context",
            "line": " \t\t\t    btrfs_file_extent_other_encoding(leaf, fi) == 0) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tu32 size = new_size - found_key.offset;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (test_bit(BTRFS_ROOT_REF_COWS, &root->state))"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tinode_sub_bytes(inode, item_end + 1 -"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\tnew_size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t\t/*"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t * update the ram bytes to properly reflect"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t * the new size of our item"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * Need to release path in order to truncate a"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * compressed extent. So delete any accumulated"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * extent items so far."
          },
          {
            "type": "context",
            "line": " \t\t\t\t */"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tbtrfs_set_file_extent_ram_bytes(leaf, fi, size);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tsize ="
          },
          {
            "type": "delete",
            "line": "\t\t\t\t    btrfs_file_extent_calc_inline_size(size);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tbtrfs_truncate_item(root, path, size, 1);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (btrfs_file_extent_compression(leaf, fi) !="
          },
          {
            "type": "add",
            "line": "\t\t\t\t    BTRFS_COMPRESS_NONE && pending_del_nr) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\terr = btrfs_del_items(trans, root, path,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t      pending_del_slot,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t      pending_del_nr);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tif (err) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\tbtrfs_abort_transaction(trans,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\t\troot,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\t\terr);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\tgoto error;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tpending_del_nr = 0;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\terr = truncate_inline_extent(inode, path,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t     &found_key,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t     item_end,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t     new_size);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (err) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tbtrfs_abort_transaction(trans,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\troot, err);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tgoto error;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t} else if (test_bit(BTRFS_ROOT_REF_COWS,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t    &root->state)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tinode_sub_bytes(inode, item_end + 1 -"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\tfound_key.offset);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tinode_sub_bytes(inode, item_end + 1 - new_size);"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " delete:"
          }
        ]
      }
    ]
  },
  {
    "commit": "030e2c78d3a91dd0d27fef37e91950dde333eba1",
    "files": [
      {
        "file": "sound/core/seq/seq_clientmgr.c",
        "changes": [
          {
            "type": "context",
            "line": "index b64f20deba90..13cfa815732d 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/core/seq/seq_clientmgr.c"
          },
          {
            "type": "context",
            "line": "+++ b/sound/core/seq/seq_clientmgr.c"
          },
          {
            "type": "context",
            "line": " \t\t * No restrictions so for a user client we can clear"
          },
          {
            "type": "context",
            "line": " \t\t * the whole fifo"
          },
          {
            "type": "context",
            "line": " \t\t */"
          },
          {
            "type": "delete",
            "line": "\t\tif (client->type == USER_CLIENT)"
          },
          {
            "type": "add",
            "line": "\t\tif (client->type == USER_CLIENT && client->data.user.fifo)"
          },
          {
            "type": "context",
            "line": " \t\t\tsnd_seq_fifo_clear(client->data.user.fifo);"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "04038bf3633c4b909b5ded3072dc88c8c419bf16",
    "files": [
      {
        "file": "src/plugins/kdldap/libkdb_ldap/ldap_principal2.c",
        "changes": [
          {
            "type": "context",
            "line": "index 3e560d997..10b5982f1 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/plugins/kdb/ldap/libkdb_ldap/ldap_principal2.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/plugins/kdb/ldap/libkdb_ldap/ldap_principal2.c"
          },
          {
            "type": "context",
            "line": "     int num_versions = 1;"
          },
          {
            "type": "context",
            "line": "     int i, j, last;"
          },
          {
            "type": "context",
            "line": "     krb5_error_code err = 0;"
          },
          {
            "type": "delete",
            "line": "    krb5_key_data *key_data;"
          },
          {
            "type": "add",
            "line": "    krb5_key_data *key_data = NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (n_key_data <= 0)"
          },
          {
            "type": "add",
            "line": "    if (n_key_data < 0)"
          },
          {
            "type": "context",
            "line": "         return NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* Make a shallow copy of the key data so we can alter it. */"
          },
          {
            "type": "context",
            "line": "     key_data = k5calloc(n_key_data, sizeof(*key_data), &err);"
          },
          {
            "type": "delete",
            "line": "    if (key_data_in == NULL)"
          },
          {
            "type": "add",
            "line": "    if (key_data == NULL)"
          },
          {
            "type": "context",
            "line": "         goto cleanup;"
          },
          {
            "type": "context",
            "line": "     memcpy(key_data, key_data_in, n_key_data * sizeof(*key_data));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     free(key_data);"
          },
          {
            "type": "context",
            "line": "     if (err != 0) {"
          },
          {
            "type": "context",
            "line": "         if (ret != NULL) {"
          },
          {
            "type": "delete",
            "line": "            for (i = 0; i <= num_versions; i++)"
          },
          {
            "type": "delete",
            "line": "                if (ret[i] != NULL)"
          },
          {
            "type": "delete",
            "line": "                    free (ret[i]);"
          },
          {
            "type": "add",
            "line": "            for (i = 0; ret[i] != NULL; i++)"
          },
          {
            "type": "add",
            "line": "                free (ret[i]);"
          },
          {
            "type": "context",
            "line": "             free (ret);"
          },
          {
            "type": "context",
            "line": "             ret = NULL;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         bersecretkey = krb5_encode_krbsecretkey (entry->key_data,"
          },
          {
            "type": "context",
            "line": "                                                  entry->n_key_data, mkvno);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if ((st=krb5_add_ber_mem_ldap_mod(&mods, \"krbprincipalkey\","
          },
          {
            "type": "delete",
            "line": "                                          LDAP_MOD_REPLACE | LDAP_MOD_BVALUES, bersecretkey)) != 0)"
          },
          {
            "type": "add",
            "line": "        if (bersecretkey == NULL) {"
          },
          {
            "type": "add",
            "line": "            st = ENOMEM;"
          },
          {
            "type": "context",
            "line": "             goto cleanup;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        /* An empty list of bervals is only accepted for modify operations,"
          },
          {
            "type": "add",
            "line": "         * not add operations. */"
          },
          {
            "type": "add",
            "line": "        if (bersecretkey[0] != NULL || !create_standalone_prinicipal) {"
          },
          {
            "type": "add",
            "line": "            st = krb5_add_ber_mem_ldap_mod(&mods, \"krbprincipalkey\","
          },
          {
            "type": "add",
            "line": "                                           LDAP_MOD_REPLACE | LDAP_MOD_BVALUES,"
          },
          {
            "type": "add",
            "line": "                                           bersecretkey);"
          },
          {
            "type": "add",
            "line": "            if (st != 0)"
          },
          {
            "type": "add",
            "line": "                goto cleanup;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!(entry->mask & KADM5_PRINCIPAL)) {"
          },
          {
            "type": "context",
            "line": "             memset(strval, 0, sizeof(strval));"
          }
        ]
      }
    ]
  },
  {
    "commit": "040757f738e13caaa9c5078bca79aa97e11dde88",
    "files": [
      {
        "file": "include/linux/user_namespace.h",
        "changes": [
          {
            "type": "context",
            "line": "index be765234c0a2..32354b4b4b2b 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/user_namespace.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/user_namespace.h"
          },
          {
            "type": "context",
            "line": " \tstruct hlist_node node;"
          },
          {
            "type": "context",
            "line": " \tstruct user_namespace *ns;"
          },
          {
            "type": "context",
            "line": " \tkuid_t uid;"
          },
          {
            "type": "delete",
            "line": "\tatomic_t count;"
          },
          {
            "type": "add",
            "line": "\tint count;"
          },
          {
            "type": "context",
            "line": " \tatomic_t ucount[UCOUNT_COUNTS];"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "kernel/ucount.c",
        "changes": [
          {
            "type": "context",
            "line": "index 62630a40ab3a..b4eeee03934f 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/ucount.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/ucount.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tnew->ns = ns;"
          },
          {
            "type": "context",
            "line": " \t\tnew->uid = uid;"
          },
          {
            "type": "delete",
            "line": "\t\tatomic_set(&new->count, 0);"
          },
          {
            "type": "add",
            "line": "\t\tnew->count = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tspin_lock_irq(&ucounts_lock);"
          },
          {
            "type": "context",
            "line": " \t\tucounts = find_ucounts(ns, uid, hashent);"
          },
          {
            "type": "context",
            "line": " \t\t\tucounts = new;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tif (!atomic_add_unless(&ucounts->count, 1, INT_MAX))"
          },
          {
            "type": "add",
            "line": "\tif (ucounts->count == INT_MAX)"
          },
          {
            "type": "context",
            "line": " \t\tucounts = NULL;"
          },
          {
            "type": "add",
            "line": "\telse"
          },
          {
            "type": "add",
            "line": "\t\tucounts->count += 1;"
          },
          {
            "type": "context",
            "line": " \tspin_unlock_irq(&ucounts_lock);"
          },
          {
            "type": "context",
            "line": " \treturn ucounts;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tunsigned long flags;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (atomic_dec_and_test(&ucounts->count)) {"
          },
          {
            "type": "delete",
            "line": "\t\tspin_lock_irqsave(&ucounts_lock, flags);"
          },
          {
            "type": "add",
            "line": "\tspin_lock_irqsave(&ucounts_lock, flags);"
          },
          {
            "type": "add",
            "line": "\tucounts->count -= 1;"
          },
          {
            "type": "add",
            "line": "\tif (!ucounts->count)"
          },
          {
            "type": "context",
            "line": " \t\thlist_del_init(&ucounts->node);"
          },
          {
            "type": "delete",
            "line": "\t\tspin_unlock_irqrestore(&ucounts_lock, flags);"
          },
          {
            "type": "add",
            "line": "\telse"
          },
          {
            "type": "add",
            "line": "\t\tucounts = NULL;"
          },
          {
            "type": "add",
            "line": "\tspin_unlock_irqrestore(&ucounts_lock, flags);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tkfree(ucounts);"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tkfree(ucounts);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static inline bool atomic_inc_below(atomic_t *v, int u)"
          }
        ]
      }
    ]
  },
  {
    "commit": "04197b341f23b908193308b8d63d17ff23232598",
    "files": [
      {
        "file": "fs/xfs/xfs_aops.c",
        "changes": [
          {
            "type": "context",
            "line": "index 3e57a56cf829..2693ba84ec25 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/xfs/xfs_aops.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/xfs/xfs_aops.c"
          },
          {
            "type": "context",
            "line": " \tif (error)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out_unlock;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * The only time we can ever safely find delalloc blocks on direct I/O"
          },
          {
            "type": "add",
            "line": "\t * is a dio write to post-eof speculative preallocation. All other"
          },
          {
            "type": "add",
            "line": "\t * scenarios are indicative of a problem or misuse (such as mixing"
          },
          {
            "type": "add",
            "line": "\t * direct and mapped I/O)."
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * The file may be unmapped by the time we get here so we cannot"
          },
          {
            "type": "add",
            "line": "\t * reliably fail the I/O based on mapping. Instead, fail the I/O if this"
          },
          {
            "type": "add",
            "line": "\t * is a read or a write within eof. Otherwise, carry on but warn as a"
          },
          {
            "type": "add",
            "line": "\t * precuation if the file happens to be mapped."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tif (direct && imap.br_startblock == DELAYSTARTBLOCK) {"
          },
          {
            "type": "add",
            "line": "\t\tif (!create || offset < i_size_read(VFS_I(ip))) {"
          },
          {
            "type": "add",
            "line": "\t\t\tWARN_ON_ONCE(1);"
          },
          {
            "type": "add",
            "line": "\t\t\terror = -EIO;"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto out_unlock;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tWARN_ON_ONCE(mapping_mapped(VFS_I(ip)->i_mapping));"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* for DAX, we convert unwritten extents directly */"
          },
          {
            "type": "context",
            "line": " \tif (create &&"
          },
          {
            "type": "context",
            "line": " \t    (!nimaps ||"
          },
          {
            "type": "context",
            "line": " \t     (new || ISUNWRITTEN(&imap))))"
          },
          {
            "type": "context",
            "line": " \t\tset_buffer_new(bh_result);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tBUG_ON(direct && imap.br_startblock == DELAYSTARTBLOCK);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " out_unlock:"
          }
        ]
      }
    ]
  },
  {
    "commit": "0449641130f5652b344ef6fa39fa019d7e94660a",
    "files": [
      {
        "file": "fs/ext4/super.c",
        "changes": [
          {
            "type": "context",
            "line": "index 35bd0206bbb3..551cb8e2110c 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ext4/super.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ext4/super.c"
          },
          {
            "type": "context",
            "line": " \tget_random_bytes(&sbi->s_next_generation, sizeof(u32));"
          },
          {
            "type": "context",
            "line": " \tspin_lock_init(&sbi->s_next_gen_lock);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tinit_timer(&sbi->s_err_report);"
          },
          {
            "type": "add",
            "line": "\tsbi->s_err_report.function = print_daily_error_info;"
          },
          {
            "type": "add",
            "line": "\tsbi->s_err_report.data = (unsigned long) sb;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \terr = percpu_counter_init(&sbi->s_freeblocks_counter,"
          },
          {
            "type": "context",
            "line": " \t\t\text4_count_free_blocks(sb));"
          },
          {
            "type": "context",
            "line": " \tif (!err) {"
          },
          {
            "type": "context",
            "line": " \t\t \"Opts: %s%s%s\", descr, sbi->s_es->s_mount_opts,"
          },
          {
            "type": "context",
            "line": " \t\t *sbi->s_es->s_mount_opts ? \"; \" : \"\", orig_data);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tinit_timer(&sbi->s_err_report);"
          },
          {
            "type": "delete",
            "line": "\tsbi->s_err_report.function = print_daily_error_info;"
          },
          {
            "type": "delete",
            "line": "\tsbi->s_err_report.data = (unsigned long) sb;"
          },
          {
            "type": "context",
            "line": " \tif (es->s_error_count)"
          },
          {
            "type": "context",
            "line": " \t\tmod_timer(&sbi->s_err_report, jiffies + 300*HZ); /* 5 minutes */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tsbi->s_journal = NULL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " failed_mount3:"
          },
          {
            "type": "add",
            "line": "\tdel_timer(&sbi->s_err_report);"
          },
          {
            "type": "context",
            "line": " \tif (sbi->s_flex_groups) {"
          },
          {
            "type": "context",
            "line": " \t\tif (is_vmalloc_addr(sbi->s_flex_groups))"
          },
          {
            "type": "context",
            "line": " \t\t\tvfree(sbi->s_flex_groups);"
          }
        ]
      }
    ]
  },
  {
    "commit": "045a31b95509c8f25f5f04ec5e0dec5cd09f2c5f",
    "files": [
      {
        "file": "drivers/phy/tegra/xusb.c",
        "changes": [
          {
            "type": "context",
            "line": "index 963de5913e50..aa5237eacd29 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/phy/tegra/xusb.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/phy/tegra/xusb.c"
          },
          {
            "type": "context",
            "line": " \tname = kasprintf(GFP_KERNEL, \"%s-%u\", type, index);"
          },
          {
            "type": "context",
            "line": " \tif (!name) {"
          },
          {
            "type": "context",
            "line": " \t\tof_node_put(ports);"
          },
          {
            "type": "delete",
            "line": "\t\treturn ERR_PTR(-ENOMEM);"
          },
          {
            "type": "add",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tnp = of_get_child_by_name(ports, name);"
          },
          {
            "type": "context",
            "line": " \tkfree(name);"
          }
        ]
      }
    ]
  },
  {
    "commit": "047ce9fa4a7c13f3883438aaf54fc50f287a7e8e",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-wexwiki-platform-web-templates/src/main/resources/templates/viewattachrev.vm",
        "changes": [
          {
            "type": "context",
            "line": "index 63b45b51e74..3d7b5eacef8 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/viewattachrev.vm"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/viewattachrev.vm"
          },
          {
            "type": "context",
            "line": " #template(\"startpage.vm\")"
          },
          {
            "type": "context",
            "line": " <div class=\"main layoutsubsection\">"
          },
          {
            "type": "context",
            "line": " <div id=\"mainContentArea\">"
          },
          {
            "type": "delete",
            "line": "<h3>$services.localization.render(\"core.viewers.attachments.revisions\", [$attachment.filename])</h3>"
          },
          {
            "type": "add",
            "line": "<h3>$services.localization.render(\"core.viewers.attachments.revisions\", [$escapetool.xml($attachment.filename)])</h3>"
          },
          {
            "type": "context",
            "line": " #if (\"$tdoc.realLocale\" != '')"
          },
          {
            "type": "context",
            "line": " #set($lang = \"&language=${tdoc.realLocale}\")"
          },
          {
            "type": "context",
            "line": " #else"
          },
          {
            "type": "context",
            "line": "   #set($url = $doc.getAttachmentRevisionURL(\"${attachment.filename}\", ${version.toString()}))"
          },
          {
            "type": "context",
            "line": " #end"
          },
          {
            "type": "context",
            "line": " #if ($attachment.isImage())"
          },
          {
            "type": "delete",
            "line": "        <td><img src=\"${url}\" alt=\"${attachment.filename}\" width=\"80\" />"
          },
          {
            "type": "add",
            "line": "        <td><img src=\"${url}\" alt=\"${escapetool.xml($attachment.filename)}\" width=\"80\" />"
          },
          {
            "type": "context",
            "line": " #else"
          },
          {
            "type": "context",
            "line": "         <td class=\"mime\">#mimetypeimg($attachment.getMimeType().toLowerCase() $attachment.getFilename().toLowerCase())"
          },
          {
            "type": "context",
            "line": " #end"
          }
        ]
      }
    ]
  },
  {
    "commit": "04bcef2a83f40c6db24222b27a52892cba39dffb",
    "files": [
      {
        "file": "net/netfilter/ipvs/ip_vs_ctl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6bde12da2fe0..c37ac2d7bec4 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/netfilter/ipvs/ip_vs_ctl.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/netfilter/ipvs/ip_vs_ctl.c"
          },
          {
            "type": "context",
            "line": " \tif (!capable(CAP_NET_ADMIN))"
          },
          {
            "type": "context",
            "line": " \t\treturn -EPERM;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (cmd < IP_VS_BASE_CTL || cmd > IP_VS_SO_SET_MAX)"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": "\tif (len < 0 || len >  MAX_ARG_LEN)"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": " \tif (len != set_arglen[SET_CMDID(cmd)]) {"
          },
          {
            "type": "context",
            "line": " \t\tpr_err(\"set_ctl: len %u != %u\\n\","
          },
          {
            "type": "context",
            "line": " \t\t       len, set_arglen[SET_CMDID(cmd)]);"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tunsigned char arg[128];"
          },
          {
            "type": "context",
            "line": " \tint ret = 0;"
          },
          {
            "type": "add",
            "line": "\tunsigned int copylen;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!capable(CAP_NET_ADMIN))"
          },
          {
            "type": "context",
            "line": " \t\treturn -EPERM;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (cmd < IP_VS_BASE_CTL || cmd > IP_VS_SO_GET_MAX)"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (*len < get_arglen[GET_CMDID(cmd)]) {"
          },
          {
            "type": "context",
            "line": " \t\tpr_err(\"get_ctl: len %u < %u\\n\","
          },
          {
            "type": "context",
            "line": " \t\t       *len, get_arglen[GET_CMDID(cmd)]);"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (copy_from_user(arg, user, get_arglen[GET_CMDID(cmd)]) != 0)"
          },
          {
            "type": "add",
            "line": "\tcopylen = get_arglen[GET_CMDID(cmd)];"
          },
          {
            "type": "add",
            "line": "\tif (copylen > 128)"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (copy_from_user(arg, user, copylen) != 0)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EFAULT;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (mutex_lock_interruptible(&__ip_vs_mutex))"
          }
        ]
      }
    ]
  },
  {
    "commit": "04bf464a5dfd9ade0dda918e44366c2c61fce80b",
    "files": [
      {
        "file": "drivers/staging/ozwpan/ozusbsvc1.c",
        "changes": [
          {
            "type": "context",
            "line": "index b573ad3e9674..7b13dc910172 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/staging/ozwpan/ozusbsvc1.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/staging/ozwpan/ozusbsvc1.c"
          },
          {
            "type": "context",
            "line": " \t\t\tstruct oz_multiple_fixed *body ="
          },
          {
            "type": "context",
            "line": " \t\t\t\t(struct oz_multiple_fixed *)data_hdr;"
          },
          {
            "type": "context",
            "line": " \t\t\tu8 *data = body->data;"
          },
          {
            "type": "delete",
            "line": "\t\t\tint n = (len - sizeof(struct oz_multiple_fixed)+1)"
          },
          {
            "type": "add",
            "line": "\t\t\tint n;"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!body->unit_size)"
          },
          {
            "type": "add",
            "line": "\t\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t\t\tn = (len - sizeof(struct oz_multiple_fixed)+1)"
          },
          {
            "type": "context",
            "line": " \t\t\t\t/ body->unit_size;"
          },
          {
            "type": "context",
            "line": " \t\t\twhile (n--) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\toz_hcd_data_ind(usb_ctx->hport, body->endpoint,"
          }
        ]
      }
    ]
  },
  {
    "commit": "04c305396458508a31d03d44afea07b1c620d7cd",
    "files": [
      {
        "file": "reposerver/repository/repository.go",
        "changes": [
          {
            "type": "context",
            "line": "index 1545be651..8a53ba6c5 100644"
          },
          {
            "type": "context",
            "line": "--- a/reposerver/repository/repository.go"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/repository.go"
          },
          {
            "type": "context",
            "line": " \t\treturn err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif err := loadFileIntoIfExists(filepath.Join(appPath, \"values.yaml\"), &res.Helm.Values); err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\treturn err"
          },
          {
            "type": "add",
            "line": "\tif resolvedValuesPath, _, err := pathutil.ResolveFilePath(appPath, repoRoot, \"values.yaml\", []string{}); err == nil {"
          },
          {
            "type": "add",
            "line": "\t\tif err := loadFileIntoIfExists(resolvedValuesPath, &res.Helm.Values); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn err"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t} else {"
          },
          {
            "type": "add",
            "line": "\t\tlog.Warnf(\"Values file %s is not allowed: %v\", filepath.Join(appPath, \"values.yaml\"), err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tvar resolvedSelectedValueFiles []pathutil.ResolvedFilePath"
          },
          {
            "type": "context",
            "line": " \t// drop not allowed values files"
          },
          {
            "type": "context",
            "line": " \t\tif resolvedFile, _, err := pathutil.ResolveFilePath(appPath, repoRoot, file, q.GetValuesFileSchemes()); err == nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tresolvedSelectedValueFiles = append(resolvedSelectedValueFiles, resolvedFile)"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\tlog.Debugf(\"Values file %s is not allowed: %v\", file, err)"
          },
          {
            "type": "add",
            "line": "\t\t\tlog.Warnf(\"Values file %s is not allowed: %v\", file, err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tparams, err := h.GetParameters(resolvedSelectedValueFiles)"
          },
          {
            "type": "add",
            "line": "\tparams, err := h.GetParameters(resolvedSelectedValueFiles, appPath, repoRoot)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "func loadFileIntoIfExists(path string, destination *string) error {"
          },
          {
            "type": "delete",
            "line": "\tinfo, err := os.Stat(path)"
          },
          {
            "type": "add",
            "line": "func loadFileIntoIfExists(path pathutil.ResolvedFilePath, destination *string) error {"
          },
          {
            "type": "add",
            "line": "\tstringPath := string(path)"
          },
          {
            "type": "add",
            "line": "\tinfo, err := os.Stat(stringPath)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif err == nil && !info.IsDir() {"
          },
          {
            "type": "delete",
            "line": "\t\tif bytes, err := ioutil.ReadFile(path); err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\t\t*destination = string(bytes)"
          },
          {
            "type": "delete",
            "line": "\t\t} else {"
          },
          {
            "type": "add",
            "line": "\t\tbytes, err := ioutil.ReadFile(stringPath);"
          },
          {
            "type": "add",
            "line": "\t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn err"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": "\t\t*destination = string(bytes)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn nil"
          }
        ]
      },
      {
        "file": "reposerver/repository/repository_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index f2402044b..723bfe1aa 100644"
          },
          {
            "type": "context",
            "line": "--- a/reposerver/repository/repository_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/repository_test.go"
          },
          {
            "type": "context",
            "line": " \t\t\"app-parameters/single-app-only\": \"Kustomize\","
          },
          {
            "type": "context",
            "line": " \t\t\"app-parameters/single-global\":   \"Kustomize\","
          },
          {
            "type": "context",
            "line": " \t\t\"invalid-helm\":                   \"Helm\","
          },
          {
            "type": "add",
            "line": "\t\t\"in-bounds-values-file-link\":     \"Helm\","
          },
          {
            "type": "context",
            "line": " \t\t\"invalid-kustomize\":              \"Kustomize\","
          },
          {
            "type": "context",
            "line": " \t\t\"kustomization_yaml\":             \"Kustomize\","
          },
          {
            "type": "context",
            "line": " \t\t\"kustomization_yml\":              \"Kustomize\","
          },
          {
            "type": "context",
            "line": " \t\t\"my-chart\":                       \"Helm\","
          },
          {
            "type": "context",
            "line": " \t\t\"my-chart-2\":                     \"Helm\","
          },
          {
            "type": "add",
            "line": "\t\t\"out-of-bounds-values-file-link\": \"Helm\","
          },
          {
            "type": "context",
            "line": " \t\t\"values-files\":                   \"Helm\","
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tassert.Equal(t, expectedApps, res.Apps)"
          },
          {
            "type": "context",
            "line": " \tassert.Len(t, res.Helm.Parameters, 3)"
          },
          {
            "type": "context",
            "line": " \tassert.Len(t, res.Helm.ValueFiles, 4)"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func Test_populateHelmAppDetails_values_symlinks(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tt.Run(\"inbound\", func(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\t\tres := apiclient.RepoAppDetailsResponse{}"
          },
          {
            "type": "add",
            "line": "\t\tq := apiclient.RepoServerAppDetailsQuery{Repo: &argoappv1.Repository{}, Source: &argoappv1.ApplicationSource{}}"
          },
          {
            "type": "add",
            "line": "\t\terr := populateHelmAppDetails(&res, \"./testdata/in-bounds-values-file-link/\", \"./testdata/in-bounds-values-file-link/\", &q)"
          },
          {
            "type": "add",
            "line": "\t\trequire.NoError(t, err)"
          },
          {
            "type": "add",
            "line": "\t\tassert.NotEmpty(t, res.Helm.Values)"
          },
          {
            "type": "add",
            "line": "\t\tassert.NotEmpty(t, res.Helm.Parameters)"
          },
          {
            "type": "add",
            "line": "\t})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tt.Run(\"out of bounds\", func(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\t\tres := apiclient.RepoAppDetailsResponse{}"
          },
          {
            "type": "add",
            "line": "\t\tq := apiclient.RepoServerAppDetailsQuery{Repo: &argoappv1.Repository{}, Source: &argoappv1.ApplicationSource{}}"
          },
          {
            "type": "add",
            "line": "\t\terr := populateHelmAppDetails(&res, \"./testdata/out-of-bounds-values-file-link/\", \"./testdata/out-of-bounds-values-file-link/\", &q)"
          },
          {
            "type": "add",
            "line": "\t\trequire.NoError(t, err)"
          },
          {
            "type": "add",
            "line": "\t\tassert.Empty(t, res.Helm.Values)"
          },
          {
            "type": "add",
            "line": "\t\tassert.Empty(t, res.Helm.Parameters)"
          },
          {
            "type": "add",
            "line": "\t})"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "reposerver/repository/testdata/in-bounds-values-file-link/Chart.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..f01dd5407"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/testdata/in-bounds-values-file-link/Chart.yaml"
          },
          {
            "type": "add",
            "line": "name: my-chart"
          },
          {
            "type": "add",
            "line": "version: 1.1.0"
          }
        ]
      },
      {
        "file": "reposerver/repository/testdata/in-bounds-values-file-link/values-2.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..aad07b2bf"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/testdata/in-bounds-values-file-link/values-2.yaml"
          },
          {
            "type": "add",
            "line": "some: yaml"
          }
        ]
      },
      {
        "file": "reposerver/repository/testdata/in-bounds-values-file-link/values.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 120000"
          },
          {
            "type": "context",
            "line": "index 000000000..d86089195"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/testdata/in-bounds-values-file-link/values.yaml"
          },
          {
            "type": "add",
            "line": "values-2.yaml"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "reposerver/repository/testdata/out-of-bounds-values-file-link/Chart.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..f01dd5407"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/testdata/out-of-bounds-values-file-link/Chart.yaml"
          },
          {
            "type": "add",
            "line": "name: my-chart"
          },
          {
            "type": "add",
            "line": "version: 1.1.0"
          }
        ]
      },
      {
        "file": "reposerver/repository/testdata/out-of-bounds-values-file-link/values.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 120000"
          },
          {
            "type": "context",
            "line": "index 000000000..4e034a194"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/testdata/out-of-bounds-values-file-link/values.yaml"
          },
          {
            "type": "add",
            "line": "../out-of-bounds.yaml"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "reposerver/repository/testdata/out-of-bounds.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..aad07b2bf"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/reposerver/repository/testdata/out-of-bounds.yaml"
          },
          {
            "type": "add",
            "line": "some: yaml"
          }
        ]
      },
      {
        "file": "util/helm/helm.go",
        "changes": [
          {
            "type": "context",
            "line": "index 6b6e109d1..8b83881fe 100644"
          },
          {
            "type": "context",
            "line": "--- a/util/helm/helm.go"
          },
          {
            "type": "context",
            "line": "+++ b/util/helm/helm.go"
          },
          {
            "type": "context",
            "line": " \t\"net/url\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t\"os/exec\""
          },
          {
            "type": "add",
            "line": "\t\"path/filepath\""
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"github.com/ghodss/yaml\""
          },
          {
            "type": "add",
            "line": "\tlog \"github.com/sirupsen/logrus\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"github.com/argoproj/argo-cd/v2/util/config\""
          },
          {
            "type": "context",
            "line": " \texecutil \"github.com/argoproj/argo-cd/v2/util/exec\""
          },
          {
            "type": "context",
            "line": " \t// Template returns a list of unstructured objects from a `helm template` command"
          },
          {
            "type": "context",
            "line": " \tTemplate(opts *TemplateOpts) (string, error)"
          },
          {
            "type": "context",
            "line": " \t// GetParameters returns a list of chart parameters taking into account values in provided YAML files."
          },
          {
            "type": "delete",
            "line": "\tGetParameters(valuesFiles []pathutil.ResolvedFilePath) (map[string]string, error)"
          },
          {
            "type": "add",
            "line": "\tGetParameters(valuesFiles []pathutil.ResolvedFilePath, appPath, repoRoot string) (map[string]string, error)"
          },
          {
            "type": "context",
            "line": " \t// DependencyBuild runs `helm dependency build` to download a chart's dependencies"
          },
          {
            "type": "context",
            "line": " \tDependencyBuild() error"
          },
          {
            "type": "context",
            "line": " \t// Init runs `helm init --client-only`"
          },
          {
            "type": "context",
            "line": " \treturn strings.TrimSpace(version), nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "func (h *helm) GetParameters(valuesFiles []pathutil.ResolvedFilePath) (map[string]string, error) {"
          },
          {
            "type": "delete",
            "line": "\tout, err := h.cmd.inspectValues(\".\")"
          },
          {
            "type": "delete",
            "line": "\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\treturn nil, err"
          },
          {
            "type": "add",
            "line": "func (h *helm) GetParameters(valuesFiles []pathutil.ResolvedFilePath, appPath, repoRoot string) (map[string]string, error) {"
          },
          {
            "type": "add",
            "line": "\tvar values []string"
          },
          {
            "type": "add",
            "line": "\t// Don't load values.yaml if it's an out-of-bounds link."
          },
          {
            "type": "add",
            "line": "\tif resolved, _, err := pathutil.ResolveFilePath(appPath, repoRoot, \"values.yaml\", []string{}); err == nil {"
          },
          {
            "type": "add",
            "line": "\t\tfmt.Println(resolved)"
          },
          {
            "type": "add",
            "line": "\t\tout, err := h.cmd.inspectValues(\".\")"
          },
          {
            "type": "add",
            "line": "\t\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn nil, err"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tvalues = append(values, out)"
          },
          {
            "type": "add",
            "line": "\t} else {"
          },
          {
            "type": "add",
            "line": "\t\tlog.Warnf(\"Values file %s is not allowed: %v\", filepath.Join(appPath, \"values.yaml\"), err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tvalues := []string{out}"
          },
          {
            "type": "context",
            "line": " \tfor i := range valuesFiles {"
          },
          {
            "type": "context",
            "line": " \t\tfile := string(valuesFiles[i])"
          },
          {
            "type": "context",
            "line": " \t\tvar fileValues []byte"
          },
          {
            "type": "context",
            "line": " \toutput := map[string]string{}"
          },
          {
            "type": "context",
            "line": " \tfor _, file := range values {"
          },
          {
            "type": "context",
            "line": " \t\tvalues := map[string]interface{}{}"
          },
          {
            "type": "delete",
            "line": "\t\tif err = yaml.Unmarshal([]byte(file), &values); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tif err := yaml.Unmarshal([]byte(file), &values); err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn nil, fmt.Errorf(\"failed to parse values: %s\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tflatVals(values, output)"
          }
        ]
      },
      {
        "file": "util/helm/helm_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 400b1132c..bee3cdbdd 100644"
          },
          {
            "type": "context",
            "line": "--- a/util/helm/helm_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/util/helm/helm_test.go"
          },
          {
            "type": "context",
            "line": " \trequire.NoError(t, err)"
          },
          {
            "type": "context",
            "line": " \th, err := NewHelmApp(repoRootAbs, nil, false, \"\", \"\", false)"
          },
          {
            "type": "context",
            "line": " \tassert.NoError(t, err)"
          },
          {
            "type": "delete",
            "line": "\tparams, err := h.GetParameters(nil)"
          },
          {
            "type": "add",
            "line": "\tparams, err := h.GetParameters(nil, repoRootAbs, repoRootAbs)"
          },
          {
            "type": "context",
            "line": " \tassert.Nil(t, err)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tslaveCountParam := params[\"cluster.slaveCount\"]"
          },
          {
            "type": "context",
            "line": " \tassert.NoError(t, err)"
          },
          {
            "type": "context",
            "line": " \tvaluesPath, _, err := path.ResolveFilePath(repoRootAbs, repoRootAbs, \"values-production.yaml\", nil)"
          },
          {
            "type": "context",
            "line": " \trequire.NoError(t, err)"
          },
          {
            "type": "delete",
            "line": "\tparams, err := h.GetParameters([]path.ResolvedFilePath{valuesPath})"
          },
          {
            "type": "add",
            "line": "\tparams, err := h.GetParameters([]path.ResolvedFilePath{valuesPath}, repoRootAbs, repoRootAbs)"
          },
          {
            "type": "context",
            "line": " \tassert.Nil(t, err)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tslaveCountParam := params[\"cluster.slaveCount\"]"
          },
          {
            "type": "context",
            "line": " \trequire.NoError(t, err)"
          },
          {
            "type": "context",
            "line": " \tvaluesProductionPath, _, err := path.ResolveFilePath(repoRootAbs, repoRootAbs, \"values-production.yaml\", nil)"
          },
          {
            "type": "context",
            "line": " \trequire.NoError(t, err)"
          },
          {
            "type": "delete",
            "line": "\tparams, err := h.GetParameters([]path.ResolvedFilePath{valuesMissingPath, valuesProductionPath})"
          },
          {
            "type": "add",
            "line": "\tparams, err := h.GetParameters([]path.ResolvedFilePath{valuesMissingPath, valuesProductionPath}, repoRootAbs, repoRootAbs)"
          },
          {
            "type": "context",
            "line": " \tassert.Nil(t, err)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tslaveCountParam := params[\"cluster.slaveCount\"]"
          }
        ]
      }
    ]
  },
  {
    "commit": "04d4fbca1017c11381e7d82acea21dd741e748bc",
    "files": [
      {
        "file": "net/l2tp/l2tp_ip6.c",
        "changes": [
          {
            "type": "context",
            "line": "index 35e1e4bde587..927547171bc7 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/l2tp/l2tp_ip6.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/l2tp/l2tp_ip6.c"
          },
          {
            "type": "context",
            "line": " \tlsa->l2tp_family = AF_INET6;"
          },
          {
            "type": "context",
            "line": " \tlsa->l2tp_flowinfo = 0;"
          },
          {
            "type": "context",
            "line": " \tlsa->l2tp_scope_id = 0;"
          },
          {
            "type": "add",
            "line": "\tlsa->l2tp_unused = 0;"
          },
          {
            "type": "context",
            "line": " \tif (peer) {"
          },
          {
            "type": "context",
            "line": " \t\tif (!lsk->peer_conn_id)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn -ENOTCONN;"
          }
        ]
      }
    ]
  },
  {
    "commit": "04dbf08bff4d61948bab80c3f9096ecc60c7f302",
    "files": [
      {
        "file": "src/media_tools/av_parsers.c",
        "changes": [
          {
            "type": "context",
            "line": "index 0cc096d1a..2a819da12 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/media_tools/av_parsers.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/media_tools/av_parsers.c"
          },
          {
            "type": "context",
            "line": " \t\tsps->offset_for_top_to_bottom_field = gf_bs_read_se_log(bs, \"offset_for_top_to_bottom_field\");"
          },
          {
            "type": "context",
            "line": " \t\tsps->poc_cycle_length = gf_bs_read_ue_log(bs, \"poc_cycle_length\");"
          },
          {
            "type": "context",
            "line": " \t\tif (sps->poc_cycle_length > GF_ARRAY_LENGTH(sps->offset_for_ref_frame)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tsps->poc_cycle_length = 255;"
          },
          {
            "type": "context",
            "line": " \t\t\tGF_LOG(GF_LOG_ERROR, GF_LOG_CODING, (\"[avc-h264] offset_for_ref_frame overflow from poc_cycle_length\\n\"));"
          },
          {
            "type": "context",
            "line": " \t\t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "04e5a89d2879b160cdfaea846024d3d9c1a525e6",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/pom.xml",
        "changes": [
          {
            "type": "context",
            "line": "index e771d6ca29e..945349e8000 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/pom.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/pom.xml"
          },
          {
            "type": "context",
            "line": "     <dependency>"
          },
          {
            "type": "context",
            "line": "       <groupId>com.google.guava</groupId>"
          },
          {
            "type": "context",
            "line": "       <artifactId>guava-testlib</artifactId>"
          },
          {
            "type": "add",
            "line": "      <scope>test</scope>"
          },
          {
            "type": "context",
            "line": "     </dependency>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     <dependency>"
          }
        ]
      }
    ]
  },
  {
    "commit": "04f5866e41fb70690e28397487d8bd8eea7d712a",
    "files": [
      {
        "file": "drivers/infiniband/core/uverbs_main.c",
        "changes": [
          {
            "type": "context",
            "line": "index 70b7d80431a9..f2e7ffe6fc54 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/infiniband/core/uverbs_main.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/infiniband/core/uverbs_main.c"
          },
          {
            "type": "context",
            "line": " \t\t * will only be one mm, so no big deal."
          },
          {
            "type": "context",
            "line": " \t\t */"
          },
          {
            "type": "context",
            "line": " \t\tdown_write(&mm->mmap_sem);"
          },
          {
            "type": "add",
            "line": "\t\tif (!mmget_still_valid(mm))"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto skip_mm;"
          },
          {
            "type": "context",
            "line": " \t\tmutex_lock(&ufile->umap_lock);"
          },
          {
            "type": "context",
            "line": " \t\tlist_for_each_entry_safe (priv, next_priv, &ufile->umaps,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t  list) {"
          },
          {
            "type": "context",
            "line": " \t\t\tvma->vm_flags &= ~(VM_SHARED | VM_MAYSHARE);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tmutex_unlock(&ufile->umap_lock);"
          },
          {
            "type": "add",
            "line": "\tskip_mm:"
          },
          {
            "type": "context",
            "line": " \t\tup_write(&mm->mmap_sem);"
          },
          {
            "type": "context",
            "line": " \t\tmmput(mm);"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      },
      {
        "file": "fs/proc/task_mmu.c",
        "changes": [
          {
            "type": "context",
            "line": "index 92a91e7816d8..95ca1fe7283c 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/proc/task_mmu.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/proc/task_mmu.c"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tcount = -EINTR;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tgoto out_mm;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * Avoid to modify vma->vm_flags"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * without locked ops while the"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * coredump reads the vm_flags."
          },
          {
            "type": "add",
            "line": "\t\t\t\t */"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (!mmget_still_valid(mm)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * Silently return \"count\""
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * like if get_task_mm()"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * failed. FIXME: should this"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * function have returned"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * -ESRCH if get_task_mm()"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * failed like if"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t * get_proc_task() fails?"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t */"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tup_write(&mm->mmap_sem);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tgoto out_mm;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\tfor (vma = mm->mmap; vma; vma = vma->vm_next) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tvma->vm_flags &= ~VM_SOFTDIRTY;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tvma_set_page_prot(vma);"
          }
        ]
      },
      {
        "file": "fs/userfaultfd.c",
        "changes": [
          {
            "type": "context",
            "line": "index 89800fc7dc9d..f5de1e726356 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/userfaultfd.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/userfaultfd.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/* the various vma->vm_userfaultfd_ctx still points to it */"
          },
          {
            "type": "context",
            "line": " \t\tdown_write(&mm->mmap_sem);"
          },
          {
            "type": "add",
            "line": "\t\t/* no task can run (and in turn coredump) yet */"
          },
          {
            "type": "add",
            "line": "\t\tVM_WARN_ON(!mmget_still_valid(mm));"
          },
          {
            "type": "context",
            "line": " \t\tfor (vma = mm->mmap; vma; vma = vma->vm_next)"
          },
          {
            "type": "context",
            "line": " \t\t\tif (vma->vm_userfaultfd_ctx.ctx == release_new_ctx) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tvma->vm_userfaultfd_ctx = NULL_VM_UFFD_CTX;"
          },
          {
            "type": "context",
            "line": " \t * taking the mmap_sem for writing."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tdown_write(&mm->mmap_sem);"
          },
          {
            "type": "add",
            "line": "\tif (!mmget_still_valid(mm))"
          },
          {
            "type": "add",
            "line": "\t\tgoto skip_mm;"
          },
          {
            "type": "context",
            "line": " \tprev = NULL;"
          },
          {
            "type": "context",
            "line": " \tfor (vma = mm->mmap; vma; vma = vma->vm_next) {"
          },
          {
            "type": "context",
            "line": " \t\tcond_resched();"
          },
          {
            "type": "context",
            "line": " \t\tvma->vm_flags = new_flags;"
          },
          {
            "type": "context",
            "line": " \t\tvma->vm_userfaultfd_ctx = NULL_VM_UFFD_CTX;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": "skip_mm:"
          },
          {
            "type": "context",
            "line": " \tup_write(&mm->mmap_sem);"
          },
          {
            "type": "context",
            "line": " \tmmput(mm);"
          },
          {
            "type": "context",
            "line": " wakeup:"
          },
          {
            "type": "context",
            "line": " \t\tgoto out;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdown_write(&mm->mmap_sem);"
          },
          {
            "type": "add",
            "line": "\tif (!mmget_still_valid(mm))"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_unlock;"
          },
          {
            "type": "context",
            "line": " \tvma = find_vma_prev(mm, start, &prev);"
          },
          {
            "type": "context",
            "line": " \tif (!vma)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out_unlock;"
          },
          {
            "type": "context",
            "line": " \t\tgoto out;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdown_write(&mm->mmap_sem);"
          },
          {
            "type": "add",
            "line": "\tif (!mmget_still_valid(mm))"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_unlock;"
          },
          {
            "type": "context",
            "line": " \tvma = find_vma_prev(mm, start, &prev);"
          },
          {
            "type": "context",
            "line": " \tif (!vma)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out_unlock;"
          }
        ]
      },
      {
        "file": "include/linux/sched/mm.h",
        "changes": [
          {
            "type": "context",
            "line": "index 0cd9f10423fb..a3fda9f024c3 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/sched/mm.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/sched/mm.h"
          },
          {
            "type": "context",
            "line": " \t\t__mmdrop(mm);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " * This has to be called after a get_task_mm()/mmget_not_zero()"
          },
          {
            "type": "add",
            "line": " * followed by taking the mmap_sem for writing before modifying the"
          },
          {
            "type": "add",
            "line": " * vmas or anything the coredump pretends not to change from under it."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * NOTE: find_extend_vma() called from GUP context is the only place"
          },
          {
            "type": "add",
            "line": " * that can modify the \"mm\" (notably the vm_start/end) under mmap_sem"
          },
          {
            "type": "add",
            "line": " * for reading and outside the context of the process, so it is also"
          },
          {
            "type": "add",
            "line": " * the only case that holds the mmap_sem for reading that must call"
          },
          {
            "type": "add",
            "line": " * this function. Generally if the mmap_sem is hold for reading"
          },
          {
            "type": "add",
            "line": " * there's no need of this check after get_task_mm()/mmget_not_zero()."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This function can be obsoleted and the check can be removed, after"
          },
          {
            "type": "add",
            "line": " * the coredump code will hold the mmap_sem for writing before"
          },
          {
            "type": "add",
            "line": " * invoking the ->core_dump methods."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static inline bool mmget_still_valid(struct mm_struct *mm)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\treturn likely(!mm->core_state);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": "  * mmget() - Pin the address space associated with a &struct mm_struct."
          },
          {
            "type": "context",
            "line": "  * @mm: The address space to pin."
          }
        ]
      },
      {
        "file": "mm/mmap.c",
        "changes": [
          {
            "type": "context",
            "line": "index 41eb48d9b527..bd7b9f293b39 100644"
          },
          {
            "type": "context",
            "line": "--- a/mm/mmap.c"
          },
          {
            "type": "context",
            "line": "+++ b/mm/mmap.c"
          },
          {
            "type": "context",
            "line": " #include <linux/moduleparam.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/pkeys.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/oom.h>"
          },
          {
            "type": "add",
            "line": "#include <linux/sched/mm.h>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #include <linux/uaccess.h>"
          },
          {
            "type": "context",
            "line": " #include <asm/cacheflush.h>"
          },
          {
            "type": "context",
            "line": " \tvma = find_vma_prev(mm, addr, &prev);"
          },
          {
            "type": "context",
            "line": " \tif (vma && (vma->vm_start <= addr))"
          },
          {
            "type": "context",
            "line": " \t\treturn vma;"
          },
          {
            "type": "delete",
            "line": "\tif (!prev || expand_stack(prev, addr))"
          },
          {
            "type": "add",
            "line": "\t/* don't alter vm_end if the coredump is running */"
          },
          {
            "type": "add",
            "line": "\tif (!prev || !mmget_still_valid(mm) || expand_stack(prev, addr))"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "context",
            "line": " \tif (prev->vm_flags & VM_LOCKED)"
          },
          {
            "type": "context",
            "line": " \t\tpopulate_vma_page_range(prev, addr, prev->vm_end, NULL);"
          },
          {
            "type": "context",
            "line": " \t\treturn vma;"
          },
          {
            "type": "context",
            "line": " \tif (!(vma->vm_flags & VM_GROWSDOWN))"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "add",
            "line": "\t/* don't alter vm_start if the coredump is running */"
          },
          {
            "type": "add",
            "line": "\tif (!mmget_still_valid(mm))"
          },
          {
            "type": "add",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "context",
            "line": " \tstart = vma->vm_start;"
          },
          {
            "type": "context",
            "line": " \tif (expand_stack(vma, addr))"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          }
        ]
      }
    ]
  },
  {
    "commit": "050d26383d4e264966fb83428e72d5d48f402d35",
    "files": [
      {
        "file": "crypto/poly1305/asm/poly1305-ppc.pl",
        "changes": [
          {
            "type": "context",
            "line": "index 9f86134d92..2e601bb9c2 100755"
          },
          {
            "type": "context",
            "line": "--- a/crypto/poly1305/asm/poly1305-ppc.pl"
          },
          {
            "type": "context",
            "line": "+++ b/crypto/poly1305/asm/poly1305-ppc.pl"
          },
          {
            "type": "context",
            "line": " my $LOCALS= 6*$SIZE_T;"
          },
          {
            "type": "context",
            "line": " my $VSXFRAME = $LOCALS + 6*$SIZE_T;"
          },
          {
            "type": "context",
            "line": "    $VSXFRAME += 128;\t# local variables"
          },
          {
            "type": "delete",
            "line": "   $VSXFRAME += 13*16;\t# v20-v31 offload"
          },
          {
            "type": "add",
            "line": "   $VSXFRAME += 12*16;\t# v20-v31 offload"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " my $BIG_ENDIAN = ($flavour !~ /le/) ? 4 : 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv22,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv23,r10,$sp"
          },
          {
            "type": "delete",
            "line": "\taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv24,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv23,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv25,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv24,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "add",
            "line": "\tstvx\tv25,r11,$sp"
          },
          {
            "type": "add",
            "line": "\taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv26,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv27,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv22,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv23,r10,$sp"
          },
          {
            "type": "delete",
            "line": "\taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv24,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv23,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv25,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv24,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "add",
            "line": "\tstvx\tv25,r11,$sp"
          },
          {
            "type": "add",
            "line": "\taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv26,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv27,r11,$sp"
          },
          {
            "type": "context",
            "line": " \tmtspr\t256,r12\t\t\t\t# restore vrsave"
          },
          {
            "type": "context",
            "line": " \tlvx\tv20,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv21,r10,$sp"
          },
          {
            "type": "delete",
            "line": "\taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv22,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv21,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv23,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv22,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv24,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv23,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv25,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv24,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv26,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv25,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv27,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv26,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv28,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv27,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv29,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv28,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv30,r11,$sp"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv31,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv29,r11,$sp"
          },
          {
            "type": "add",
            "line": "\taddi\tr11,r11,32"
          },
          {
            "type": "add",
            "line": "\tlvx\tv30,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv31,r11,$sp"
          },
          {
            "type": "context",
            "line": " \t$POP\tr27,`$VSXFRAME-$SIZE_T*5`($sp)"
          },
          {
            "type": "context",
            "line": " \t$POP\tr28,`$VSXFRAME-$SIZE_T*4`($sp)"
          },
          {
            "type": "context",
            "line": " \t$POP\tr29,`$VSXFRAME-$SIZE_T*3`($sp)"
          }
        ]
      }
    ]
  },
  {
    "commit": "050fad7c4534c13c8eb1d9c2ba66012e014773cb",
    "files": [
      {
        "file": "kernel/bpf/core.c",
        "changes": [
          {
            "type": "context",
            "line": "index ba03ec39efb3..6ef6746a7871 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/bpf/core.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/bpf/core.c"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void bpf_adj_branches(struct bpf_prog *prog, u32 pos, u32 delta)"
          },
          {
            "type": "add",
            "line": "static int bpf_adj_delta_to_imm(struct bpf_insn *insn, u32 pos, u32 delta,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tu32 curr, const bool probe_pass)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "\tconst s64 imm_min = S32_MIN, imm_max = S32_MAX;"
          },
          {
            "type": "add",
            "line": "\ts64 imm = insn->imm;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (curr < pos && curr + imm + 1 > pos)"
          },
          {
            "type": "add",
            "line": "\t\timm += delta;"
          },
          {
            "type": "add",
            "line": "\telse if (curr > pos + delta && curr + imm + 1 <= pos + delta)"
          },
          {
            "type": "add",
            "line": "\t\timm -= delta;"
          },
          {
            "type": "add",
            "line": "\tif (imm < imm_min || imm > imm_max)"
          },
          {
            "type": "add",
            "line": "\t\treturn -ERANGE;"
          },
          {
            "type": "add",
            "line": "\tif (!probe_pass)"
          },
          {
            "type": "add",
            "line": "\t\tinsn->imm = imm;"
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "static int bpf_adj_delta_to_off(struct bpf_insn *insn, u32 pos, u32 delta,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tu32 curr, const bool probe_pass)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tconst s32 off_min = S16_MIN, off_max = S16_MAX;"
          },
          {
            "type": "add",
            "line": "\ts32 off = insn->off;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (curr < pos && curr + off + 1 > pos)"
          },
          {
            "type": "add",
            "line": "\t\toff += delta;"
          },
          {
            "type": "add",
            "line": "\telse if (curr > pos + delta && curr + off + 1 <= pos + delta)"
          },
          {
            "type": "add",
            "line": "\t\toff -= delta;"
          },
          {
            "type": "add",
            "line": "\tif (off < off_min || off > off_max)"
          },
          {
            "type": "add",
            "line": "\t\treturn -ERANGE;"
          },
          {
            "type": "add",
            "line": "\tif (!probe_pass)"
          },
          {
            "type": "add",
            "line": "\t\tinsn->off = off;"
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "static int bpf_adj_branches(struct bpf_prog *prog, u32 pos, u32 delta,"
          },
          {
            "type": "add",
            "line": "\t\t\t    const bool probe_pass)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tu32 i, insn_cnt = prog->len + (probe_pass ? delta : 0);"
          },
          {
            "type": "context",
            "line": " \tstruct bpf_insn *insn = prog->insnsi;"
          },
          {
            "type": "delete",
            "line": "\tu32 i, insn_cnt = prog->len;"
          },
          {
            "type": "delete",
            "line": "\tbool pseudo_call;"
          },
          {
            "type": "delete",
            "line": "\tu8 code;"
          },
          {
            "type": "delete",
            "line": "\tint off;"
          },
          {
            "type": "add",
            "line": "\tint ret = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfor (i = 0; i < insn_cnt; i++, insn++) {"
          },
          {
            "type": "add",
            "line": "\t\tu8 code;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t/* In the probing pass we still operate on the original,"
          },
          {
            "type": "add",
            "line": "\t\t * unpatched image in order to check overflows before we"
          },
          {
            "type": "add",
            "line": "\t\t * do any other adjustments. Therefore skip the patchlet."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\tif (probe_pass && i == pos) {"
          },
          {
            "type": "add",
            "line": "\t\t\ti += delta + 1;"
          },
          {
            "type": "add",
            "line": "\t\t\tinsn++;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\tcode = insn->code;"
          },
          {
            "type": "delete",
            "line": "\t\tif (BPF_CLASS(code) != BPF_JMP)"
          },
          {
            "type": "delete",
            "line": "\t\t\tcontinue;"
          },
          {
            "type": "delete",
            "line": "\t\tif (BPF_OP(code) == BPF_EXIT)"
          },
          {
            "type": "add",
            "line": "\t\tif (BPF_CLASS(code) != BPF_JMP ||"
          },
          {
            "type": "add",
            "line": "\t\t    BPF_OP(code) == BPF_EXIT)"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue;"
          },
          {
            "type": "add",
            "line": "\t\t/* Adjust offset of jmps if we cross patch boundaries. */"
          },
          {
            "type": "context",
            "line": " \t\tif (BPF_OP(code) == BPF_CALL) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (insn->src_reg == BPF_PSEUDO_CALL)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tpseudo_call = true;"
          },
          {
            "type": "delete",
            "line": "\t\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t\tif (insn->src_reg != BPF_PSEUDO_CALL)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tcontinue;"
          },
          {
            "type": "add",
            "line": "\t\t\tret = bpf_adj_delta_to_imm(insn, pos, delta, i,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t   probe_pass);"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\tpseudo_call = false;"
          },
          {
            "type": "add",
            "line": "\t\t\tret = bpf_adj_delta_to_off(insn, pos, delta, i,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t   probe_pass);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\toff = pseudo_call ? insn->imm : insn->off;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t/* Adjust offset of jmps if we cross boundaries. */"
          },
          {
            "type": "delete",
            "line": "\t\tif (i < pos && i + off + 1 > pos)"
          },
          {
            "type": "delete",
            "line": "\t\t\toff += delta;"
          },
          {
            "type": "delete",
            "line": "\t\telse if (i > pos + delta && i + off + 1 <= pos + delta)"
          },
          {
            "type": "delete",
            "line": "\t\t\toff -= delta;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (pseudo_call)"
          },
          {
            "type": "delete",
            "line": "\t\t\tinsn->imm = off;"
          },
          {
            "type": "delete",
            "line": "\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t\tinsn->off = off;"
          },
          {
            "type": "add",
            "line": "\t\tif (ret)"
          },
          {
            "type": "add",
            "line": "\t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn ret;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct bpf_prog *bpf_patch_insn_single(struct bpf_prog *prog, u32 off,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t       const struct bpf_insn *patch, u32 len)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tu32 insn_adj_cnt, insn_rest, insn_delta = len - 1;"
          },
          {
            "type": "add",
            "line": "\tconst u32 cnt_max = S16_MAX;"
          },
          {
            "type": "context",
            "line": " \tstruct bpf_prog *prog_adj;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Since our patchlet doesn't expand the image, we're done. */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tinsn_adj_cnt = prog->len + insn_delta;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* Reject anything that would potentially let the insn->off"
          },
          {
            "type": "add",
            "line": "\t * target overflow when we have excessive program expansions."
          },
          {
            "type": "add",
            "line": "\t * We need to probe here before we do any reallocation where"
          },
          {
            "type": "add",
            "line": "\t * we afterwards may not fail anymore."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tif (insn_adj_cnt > cnt_max &&"
          },
          {
            "type": "add",
            "line": "\t    bpf_adj_branches(prog, off, insn_delta, true))"
          },
          {
            "type": "add",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Several new instructions need to be inserted. Make room"
          },
          {
            "type": "context",
            "line": " \t * for them. Likely, there's no need for a new allocation as"
          },
          {
            "type": "context",
            "line": " \t * last page could have large enough tailroom."
          },
          {
            "type": "context",
            "line": " \t\tsizeof(*patch) * insn_rest);"
          },
          {
            "type": "context",
            "line": " \tmemcpy(prog_adj->insnsi + off, patch, sizeof(*patch) * len);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tbpf_adj_branches(prog_adj, off, insn_delta);"
          },
          {
            "type": "add",
            "line": "\t/* We are guaranteed to not fail at this point, otherwise"
          },
          {
            "type": "add",
            "line": "\t * the ship has sailed to reverse to the original state. An"
          },
          {
            "type": "add",
            "line": "\t * overflow cannot happen at this point."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tBUG_ON(bpf_adj_branches(prog_adj, off, insn_delta, false));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn prog_adj;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "net/core/filter.c",
        "changes": [
          {
            "type": "context",
            "line": "index e77c30ca491d..201ff36b17a8 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/core/filter.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/core/filter.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define BPF_EMIT_JMP\t\t\t\t\t\t\t\\"
          },
          {
            "type": "context",
            "line": " \tdo {\t\t\t\t\t\t\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\tconst s32 off_min = S16_MIN, off_max = S16_MAX;\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\ts32 off;\t\t\t\t\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\t\t\t\\"
          },
          {
            "type": "context",
            "line": " \t\tif (target >= len || target < 0)\t\t\t\\"
          },
          {
            "type": "context",
            "line": " \t\t\tgoto err;\t\t\t\t\t\\"
          },
          {
            "type": "delete",
            "line": "\t\tinsn->off = addrs ? addrs[target] - addrs[i] - 1 : 0;\t\\"
          },
          {
            "type": "add",
            "line": "\t\toff = addrs ? addrs[target] - addrs[i] - 1 : 0;\t\t\\"
          },
          {
            "type": "context",
            "line": " \t\t/* Adjust pc relative offset for 2nd or 3rd insn. */\t\\"
          },
          {
            "type": "delete",
            "line": "\t\tinsn->off -= insn - tmp_insns;\t\t\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\toff -= insn - tmp_insns;\t\t\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\t/* Reject anything not fitting into insn->off. */\t\\"
          },
          {
            "type": "add",
            "line": "\t\tif (off < off_min || off > off_max)\t\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto err;\t\t\t\t\t\\"
          },
          {
            "type": "add",
            "line": "\t\tinsn->off = off;\t\t\t\t\t\\"
          },
          {
            "type": "context",
            "line": " \t} while (0)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tcase BPF_JMP | BPF_JA:"
          }
        ]
      }
    ]
  },
  {
    "commit": "051824924c709bd6162a378f746fb859454c674e",
    "files": [
      {
        "file": "src/http/RegisteredHeaders.cc",
        "changes": [
          {
            "type": "context",
            "line": "index a4f96db2b..84f177af2 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/http/RegisteredHeaders.cc"
          },
          {
            "type": "context",
            "line": "+++ b/src/http/RegisteredHeaders.cc"
          },
          {
            "type": "context",
            "line": " const HeaderTableRecord&"
          },
          {
            "type": "context",
            "line": " HeaderLookupTable_t::lookup (const char *buf, const std::size_t len) const {"
          },
          {
            "type": "context",
            "line": "     const HeaderTableRecord *r = HttpHeaderHashTable::lookup(buf, len);"
          },
          {
            "type": "delete",
            "line": "    if (!r)"
          },
          {
            "type": "add",
            "line": "    if (!r || r->id == Http::HdrType::OTHER)"
          },
          {
            "type": "context",
            "line": "         return BadHdr;"
          },
          {
            "type": "context",
            "line": "     return *r;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "051ae669e4505abbe05165bebf6be7922de11f41",
    "files": [
      {
        "file": "drivers/net/wireless/microchip/wilc1000/cfg80211.c",
        "changes": [
          {
            "type": "context",
            "line": "index 9bbfff803357..aedf0e8b69b9 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/wireless/microchip/wilc1000/cfg80211.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/wireless/microchip/wilc1000/cfg80211.c"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \twhile (index + sizeof(*e) <= len) {"
          },
          {
            "type": "add",
            "line": "\t\tu16 attr_size;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\te = (struct wilc_attr_entry *)&buf[index];"
          },
          {
            "type": "add",
            "line": "\t\tattr_size = le16_to_cpu(e->attr_len);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif (index + sizeof(*e) + attr_size > len)"
          },
          {
            "type": "add",
            "line": "\t\t\treturn;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (e->attr_type == IEEE80211_P2P_ATTR_CHANNEL_LIST)"
          },
          {
            "type": "context",
            "line": " \t\t\tch_list_idx = index;"
          },
          {
            "type": "delete",
            "line": "\t\telse if (e->attr_type == IEEE80211_P2P_ATTR_OPER_CHANNEL)"
          },
          {
            "type": "add",
            "line": "\t\telse if (e->attr_type == IEEE80211_P2P_ATTR_OPER_CHANNEL &&"
          },
          {
            "type": "add",
            "line": "\t\t\t attr_size == (sizeof(struct wilc_attr_oper_ch) - sizeof(*e)))"
          },
          {
            "type": "context",
            "line": " \t\t\top_ch_idx = index;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (ch_list_idx && op_ch_idx)"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "delete",
            "line": "\t\tindex += le16_to_cpu(e->attr_len) + sizeof(*e);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tindex += sizeof(*e) + attr_size;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (ch_list_idx) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "053cc9534d174dc89daba36724ed2dcb36755b90",
    "files": [
      {
        "file": "django/contriadmindocs/views.py",
        "changes": [
          {
            "type": "context",
            "line": "index 0474c38fd4..5986717d95 100644"
          },
          {
            "type": "context",
            "line": "--- a/django/contrib/admindocs/views.py"
          },
          {
            "type": "context",
            "line": "+++ b/django/contrib/admindocs/views.py"
          },
          {
            "type": "context",
            "line": " from django.http import Http404"
          },
          {
            "type": "context",
            "line": " from django.template.engine import Engine"
          },
          {
            "type": "context",
            "line": " from django.urls import get_mod_func, get_resolver, get_urlconf"
          },
          {
            "type": "add",
            "line": "from django.utils._os import safe_join"
          },
          {
            "type": "context",
            "line": " from django.utils.decorators import method_decorator"
          },
          {
            "type": "context",
            "line": " from django.utils.inspect import ("
          },
          {
            "type": "context",
            "line": "     func_accepts_kwargs, func_accepts_var_args, get_func_full_args,"
          },
          {
            "type": "context",
            "line": "         else:"
          },
          {
            "type": "context",
            "line": "             # This doesn't account for template loaders (#24128)."
          },
          {
            "type": "context",
            "line": "             for index, directory in enumerate(default_engine.dirs):"
          },
          {
            "type": "delete",
            "line": "                template_file = Path(directory) / template"
          },
          {
            "type": "add",
            "line": "                template_file = Path(safe_join(directory, template))"
          },
          {
            "type": "context",
            "line": "                 if template_file.exists():"
          },
          {
            "type": "context",
            "line": "                     with template_file.open() as f:"
          },
          {
            "type": "context",
            "line": "                         template_contents = f.read()"
          }
        ]
      },
      {
        "file": "docs/releases/2.2.24.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 5b71d9939f..9bcf7037c4 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/releases/2.2.24.txt"
          },
          {
            "type": "context",
            "line": "+++ b/docs/releases/2.2.24.txt"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Django 2.2.24 fixes two security issues in 2.2.23."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "..."
          },
          {
            "type": "add",
            "line": "CVE-2021-33203: Potential directory traversal via ``admindocs``"
          },
          {
            "type": "add",
            "line": "==============================================================="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Staff members could use the :mod:`~django.contrib.admindocs`"
          },
          {
            "type": "add",
            "line": "``TemplateDetailView`` view to check the existence of arbitrary files."
          },
          {
            "type": "add",
            "line": "Additionally, if (and only if) the default admindocs templates have been"
          },
          {
            "type": "add",
            "line": "customized by the developers to also expose the file contents, then not only"
          },
          {
            "type": "add",
            "line": "the existence but also the file contents would have been exposed."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "As a mitigation, path sanitation is now applied and only files within the"
          },
          {
            "type": "add",
            "line": "template root directories can be loaded."
          }
        ]
      },
      {
        "file": "tests/admin_docs/test_views.py",
        "changes": [
          {
            "type": "context",
            "line": "index bcadff7d8a..dc6d3c127b 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/admin_docs/test_views.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/admin_docs/test_views.py"
          },
          {
            "type": "context",
            "line": "         self.assertContains(response, 'View documentation')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "@unittest.skipUnless(utils.docutils_is_available, 'no docutils installed.')"
          },
          {
            "type": "add",
            "line": "class AdminDocViewDefaultEngineOnly(TestDataMixin, AdminDocsTestCase):"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def setUp(self):"
          },
          {
            "type": "add",
            "line": "        self.client.force_login(self.superuser)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_template_detail_path_traversal(self):"
          },
          {
            "type": "add",
            "line": "        cases = ['/etc/passwd', '../passwd']"
          },
          {
            "type": "add",
            "line": "        for fpath in cases:"
          },
          {
            "type": "add",
            "line": "            with self.subTest(path=fpath):"
          },
          {
            "type": "add",
            "line": "                response = self.client.get("
          },
          {
            "type": "add",
            "line": "                    reverse('django-admindocs-templates', args=[fpath]),"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "                self.assertEqual(response.status_code, 400)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " @override_settings(TEMPLATES=[{"
          },
          {
            "type": "context",
            "line": "     'NAME': 'ONE',"
          },
          {
            "type": "context",
            "line": "     'BACKEND': 'django.template.backends.django.DjangoTemplates',"
          }
        ]
      }
    ]
  },
  {
    "commit": "053d957d53f2a543d158f3ab651e390d2728e0b9",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-wexwiki-platform-web-templates/src/main/resources/templates/registerinline.vm",
        "changes": [
          {
            "type": "context",
            "line": "index 2657b2cddf5..b25f72f1e16 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/registerinline.vm"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/registerinline.vm"
          },
          {
            "type": "context",
            "line": "       <div>"
          },
          {
            "type": "context",
            "line": "         <input type=\"hidden\" name=\"form_token\" value=\"$!services.csrf.token\" />"
          },
          {
            "type": "context",
            "line": "         <input type=\"hidden\" name=\"register\" value=\"1\" />"
          },
          {
            "type": "delete",
            "line": "        <input type=\"hidden\" name=\"xredirect\" value=\"$!request.xredirect\" />"
          },
          {
            "type": "add",
            "line": "        <input type=\"hidden\" name=\"xredirect\" value=\"$escapetool.xml($!request.xredirect)\" />"
          },
          {
            "type": "context",
            "line": "         #set ($class = $xwiki.getClass('XWiki.XWikiUsers'))"
          },
          {
            "type": "context",
            "line": "         #set ($obj = $class.newObject())"
          },
          {
            "type": "context",
            "line": "         #set ($serverobj = $class.newObject())"
          }
        ]
      }
    ]
  },
  {
    "commit": "0558f33c06bb910e2879e355192227a8e8f0219d",
    "files": [
      {
        "file": "drivers/scsi/libsas/sas_ata.c",
        "changes": [
          {
            "type": "context",
            "line": "index 70be4425ae0b..2b3637b40dde 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/libsas/sas_ata.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/libsas/sas_ata.c"
          },
          {
            "type": "context",
            "line": " \tif (res)"
          },
          {
            "type": "context",
            "line": " \t\treturn res;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tsas_discover_event(dev->port, DISCE_PROBE);"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "drivers/scsi/libsas/sas_discover.c",
        "changes": [
          {
            "type": "context",
            "line": "index 14f714d05767..e4fd078e4175 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/libsas/sas_discover.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/libsas/sas_discover.c"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void sas_probe_devices(struct work_struct *work)"
          },
          {
            "type": "add",
            "line": "static void sas_probe_devices(struct asd_sas_port *port)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct domain_device *dev, *n;"
          },
          {
            "type": "delete",
            "line": "\tstruct sas_discovery_event *ev = to_sas_discovery_event(work);"
          },
          {
            "type": "delete",
            "line": "\tstruct asd_sas_port *port = ev->port;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tclear_bit(DISCE_PROBE, &port->disc.pending);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* devices must be domain members before link recovery and probe */"
          },
          {
            "type": "context",
            "line": " \tlist_for_each_entry(dev, &port->disco_list, disco_list_node) {"
          },
          {
            "type": "context",
            "line": " \tres = sas_notify_lldd_dev_found(dev);"
          },
          {
            "type": "context",
            "line": " \tif (res)"
          },
          {
            "type": "context",
            "line": " \t\treturn res;"
          },
          {
            "type": "delete",
            "line": "\tsas_discover_event(dev->port, DISCE_PROBE);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \tsas_put_device(dev);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void sas_destruct_devices(struct work_struct *work)"
          },
          {
            "type": "add",
            "line": "void sas_destruct_devices(struct asd_sas_port *port)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct domain_device *dev, *n;"
          },
          {
            "type": "delete",
            "line": "\tstruct sas_discovery_event *ev = to_sas_discovery_event(work);"
          },
          {
            "type": "delete",
            "line": "\tstruct asd_sas_port *port = ev->port;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tclear_bit(DISCE_DESTRUCT, &port->disc.pending);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tlist_for_each_entry_safe(dev, n, &port->destroy_list, disco_list_node) {"
          },
          {
            "type": "context",
            "line": " \t\tlist_del_init(&dev->disco_list_node);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "static void sas_destruct_ports(struct asd_sas_port *port)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tstruct sas_port *sas_port, *p;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tlist_for_each_entry_safe(sas_port, p, &port->sas_port_del_list, del_list) {"
          },
          {
            "type": "add",
            "line": "\t\tlist_del_init(&sas_port->del_list);"
          },
          {
            "type": "add",
            "line": "\t\tsas_port_delete(sas_port);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " void sas_unregister_dev(struct asd_sas_port *port, struct domain_device *dev)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tif (!test_bit(SAS_DEV_DESTROY, &dev->state) &&"
          },
          {
            "type": "context",
            "line": " \tif (!test_and_set_bit(SAS_DEV_DESTROY, &dev->state)) {"
          },
          {
            "type": "context",
            "line": " \t\tsas_rphy_unlink(dev->rphy);"
          },
          {
            "type": "context",
            "line": " \t\tlist_move_tail(&dev->disco_list_node, &port->destroy_list);"
          },
          {
            "type": "delete",
            "line": "\t\tsas_discover_event(dev->port, DISCE_DESTRUCT);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tport->port_dev = NULL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tsas_probe_devices(port);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tSAS_DPRINTK(\"DONE DISCOVERY on port %d, pid:%d, result:%d\\n\", port->id,"
          },
          {
            "type": "context",
            "line": " \t\t    task_pid_nr(current), error);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \t\t    port->id, task_pid_nr(current), res);"
          },
          {
            "type": "context",
            "line": "  out:"
          },
          {
            "type": "context",
            "line": " \tmutex_unlock(&ha->disco_mutex);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tsas_destruct_devices(port);"
          },
          {
            "type": "add",
            "line": "\tsas_destruct_ports(port);"
          },
          {
            "type": "add",
            "line": "\tsas_probe_devices(port);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* ---------- Events ---------- */"
          },
          {
            "type": "context",
            "line": " \tstatic const work_func_t sas_event_fns[DISC_NUM_EVENTS] = {"
          },
          {
            "type": "context",
            "line": " \t\t[DISCE_DISCOVER_DOMAIN] = sas_discover_domain,"
          },
          {
            "type": "context",
            "line": " \t\t[DISCE_REVALIDATE_DOMAIN] = sas_revalidate_domain,"
          },
          {
            "type": "delete",
            "line": "\t\t[DISCE_PROBE] = sas_probe_devices,"
          },
          {
            "type": "context",
            "line": " \t\t[DISCE_SUSPEND] = sas_suspend_devices,"
          },
          {
            "type": "context",
            "line": " \t\t[DISCE_RESUME] = sas_resume_devices,"
          },
          {
            "type": "delete",
            "line": "\t\t[DISCE_DESTRUCT] = sas_destruct_devices,"
          },
          {
            "type": "context",
            "line": " \t};"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdisc->pending = 0;"
          }
        ]
      },
      {
        "file": "drivers/scsi/libsas/sas_expander.c",
        "changes": [
          {
            "type": "context",
            "line": "index a8a57b0593e3..7444d40e261c 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/libsas/sas_expander.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/libsas/sas_expander.c"
          },
          {
            "type": "context",
            "line": " \t\tsas_port_delete_phy(phy->port, phy->phy);"
          },
          {
            "type": "context",
            "line": " \t\tsas_device_set_phy(found, phy->port);"
          },
          {
            "type": "context",
            "line": " \t\tif (phy->port->num_phys == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\tsas_port_delete(phy->port);"
          },
          {
            "type": "add",
            "line": "\t\t\tlist_add_tail(&phy->port->del_list,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t&parent->port->sas_port_del_list);"
          },
          {
            "type": "context",
            "line": " \t\tphy->port = NULL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \tstruct domain_device *dev = NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tres = sas_find_bcast_dev(port_dev, &dev);"
          },
          {
            "type": "delete",
            "line": "\twhile (res == 0 && dev) {"
          },
          {
            "type": "add",
            "line": "\tif (res == 0 && dev) {"
          },
          {
            "type": "context",
            "line": " \t\tstruct expander_device *ex = &dev->ex_dev;"
          },
          {
            "type": "context",
            "line": " \t\tint i = 0, phy_id;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tres = sas_rediscover(dev, phy_id);"
          },
          {
            "type": "context",
            "line": " \t\t\ti = phy_id + 1;"
          },
          {
            "type": "context",
            "line": " \t\t} while (i < ex->num_phys);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tdev = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\tres = sas_find_bcast_dev(port_dev, &dev);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn res;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/scsi/libsas/sas_internal.h",
        "changes": [
          {
            "type": "context",
            "line": "index d8826a747690..50e12d662ffe 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/libsas/sas_internal.h"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/libsas/sas_internal.h"
          },
          {
            "type": "context",
            "line": " void sas_hae_reset(struct work_struct *work);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void sas_free_device(struct kref *kref);"
          },
          {
            "type": "add",
            "line": "void sas_destruct_devices(struct asd_sas_port *port);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " extern const work_func_t sas_phy_event_fns[PHY_NUM_EVENTS];"
          },
          {
            "type": "context",
            "line": " extern const work_func_t sas_port_event_fns[PORT_NUM_EVENTS];"
          }
        ]
      },
      {
        "file": "drivers/scsi/libsas/sas_port.c",
        "changes": [
          {
            "type": "context",
            "line": "index 64722f42b256..f07e55d3aa73 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/libsas/sas_port.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/libsas/sas_port.c"
          },
          {
            "type": "context",
            "line": " \t\trc = sas_notify_lldd_dev_found(dev);"
          },
          {
            "type": "context",
            "line": " \t\tif (rc) {"
          },
          {
            "type": "context",
            "line": " \t\t\tsas_unregister_dev(port, dev);"
          },
          {
            "type": "add",
            "line": "\t\t\tsas_destruct_devices(port);"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (port->num_phys == 1) {"
          },
          {
            "type": "context",
            "line": " \t\tsas_unregister_domain_devices(port, gone);"
          },
          {
            "type": "add",
            "line": "\t\tsas_destruct_devices(port);"
          },
          {
            "type": "context",
            "line": " \t\tsas_port_delete(port->port);"
          },
          {
            "type": "context",
            "line": " \t\tport->port = NULL;"
          },
          {
            "type": "context",
            "line": " \t} else {"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&port->dev_list);"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&port->disco_list);"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&port->destroy_list);"
          },
          {
            "type": "add",
            "line": "\tINIT_LIST_HEAD(&port->sas_port_del_list);"
          },
          {
            "type": "context",
            "line": " \tspin_lock_init(&port->phy_list_lock);"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&port->phy_list);"
          },
          {
            "type": "context",
            "line": " \tport->ha = sas_ha;"
          }
        ]
      },
      {
        "file": "include/scsi/libsas.h",
        "changes": [
          {
            "type": "context",
            "line": "index 6255bb5ed1e4..1cab6f7af425 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/scsi/libsas.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/scsi/libsas.h"
          },
          {
            "type": "context",
            "line": " enum discover_event {"
          },
          {
            "type": "context",
            "line": " \tDISCE_DISCOVER_DOMAIN   = 0U,"
          },
          {
            "type": "context",
            "line": " \tDISCE_REVALIDATE_DOMAIN,"
          },
          {
            "type": "delete",
            "line": "\tDISCE_PROBE,"
          },
          {
            "type": "context",
            "line": " \tDISCE_SUSPEND,"
          },
          {
            "type": "context",
            "line": " \tDISCE_RESUME,"
          },
          {
            "type": "delete",
            "line": "\tDISCE_DESTRUCT,"
          },
          {
            "type": "context",
            "line": " \tDISC_NUM_EVENTS,"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstruct list_head dev_list;"
          },
          {
            "type": "context",
            "line": " \tstruct list_head disco_list;"
          },
          {
            "type": "context",
            "line": " \tstruct list_head destroy_list;"
          },
          {
            "type": "add",
            "line": "\tstruct list_head sas_port_del_list;"
          },
          {
            "type": "context",
            "line": " \tenum   sas_linkrate linkrate;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstruct sas_work work;"
          }
        ]
      },
      {
        "file": "include/scsi/scsi_transport_sas.h",
        "changes": [
          {
            "type": "context",
            "line": "index 62895b405933..05ec927a3c72 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/scsi/scsi_transport_sas.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/scsi/scsi_transport_sas.h"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstruct mutex\t\tphy_list_mutex;"
          },
          {
            "type": "context",
            "line": " \tstruct list_head\tphy_list;"
          },
          {
            "type": "add",
            "line": "\tstruct list_head\tdel_list; /* libsas only */"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define dev_to_sas_port(d) \\"
          }
        ]
      }
    ]
  },
  {
    "commit": "055e547478a11a6360c7ce05e2afc3e366968a12",
    "files": [
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce100/dce100_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1787b9bf800a..76d54885374a 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce100/dce100_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce100/dce100_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce110/dce110_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 318e9c2e2ca8..89620adc81d8 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce110/dce110_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce110/dce110_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce112/dce112_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 83e1878161c9..21a657e79306 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce112/dce112_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce112/dce112_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce120/dce120_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 8b85e5274bba..7c52f7f9196c 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce120/dce120_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce120/dce120_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4625df9f9fd2..643ccb0ade00 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce80/dce80_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dcn10/dcn10_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 59305e411a66..1599bb971111 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dcn20/dcn20_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index b4e3ce22ed52..5a2763daff4d 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_resource.c"
          },
          {
            "type": "context",
            "line": " \t\treturn &clk_src->base;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(clk_src);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "05692d7005a364add85c6e25a6c4447ce08f913a",
    "files": [
      {
        "file": "drivers/vfio/pci/vfio_pci.c",
        "changes": [
          {
            "type": "context",
            "line": "index d624a527777f..031bc08d000d 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/vfio/pci/vfio_pci.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/vfio/pci/vfio_pci.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t} else if (cmd == VFIO_DEVICE_SET_IRQS) {"
          },
          {
            "type": "context",
            "line": " \t\tstruct vfio_irq_set hdr;"
          },
          {
            "type": "add",
            "line": "\t\tsize_t size;"
          },
          {
            "type": "context",
            "line": " \t\tu8 *data = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\tint ret = 0;"
          },
          {
            "type": "add",
            "line": "\t\tint max, ret = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tminsz = offsetofend(struct vfio_irq_set, count);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\treturn -EFAULT;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (hdr.argsz < minsz || hdr.index >= VFIO_PCI_NUM_IRQS ||"
          },
          {
            "type": "add",
            "line": "\t\t    hdr.count >= (U32_MAX - hdr.start) ||"
          },
          {
            "type": "context",
            "line": " \t\t    hdr.flags & ~(VFIO_IRQ_SET_DATA_TYPE_MASK |"
          },
          {
            "type": "context",
            "line": " \t\t\t\t  VFIO_IRQ_SET_ACTION_TYPE_MASK))"
          },
          {
            "type": "context",
            "line": " \t\t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (!(hdr.flags & VFIO_IRQ_SET_DATA_NONE)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tsize_t size;"
          },
          {
            "type": "delete",
            "line": "\t\t\tint max = vfio_pci_get_irq_count(vdev, hdr.index);"
          },
          {
            "type": "add",
            "line": "\t\tmax = vfio_pci_get_irq_count(vdev, hdr.index);"
          },
          {
            "type": "add",
            "line": "\t\tif (hdr.start >= max || hdr.start + hdr.count > max)"
          },
          {
            "type": "add",
            "line": "\t\t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tif (hdr.flags & VFIO_IRQ_SET_DATA_BOOL)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tsize = sizeof(uint8_t);"
          },
          {
            "type": "delete",
            "line": "\t\t\telse if (hdr.flags & VFIO_IRQ_SET_DATA_EVENTFD)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tsize = sizeof(int32_t);"
          },
          {
            "type": "delete",
            "line": "\t\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\tswitch (hdr.flags & VFIO_IRQ_SET_DATA_TYPE_MASK) {"
          },
          {
            "type": "add",
            "line": "\t\tcase VFIO_IRQ_SET_DATA_NONE:"
          },
          {
            "type": "add",
            "line": "\t\t\tsize = 0;"
          },
          {
            "type": "add",
            "line": "\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t\tcase VFIO_IRQ_SET_DATA_BOOL:"
          },
          {
            "type": "add",
            "line": "\t\t\tsize = sizeof(uint8_t);"
          },
          {
            "type": "add",
            "line": "\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t\tcase VFIO_IRQ_SET_DATA_EVENTFD:"
          },
          {
            "type": "add",
            "line": "\t\t\tsize = sizeof(int32_t);"
          },
          {
            "type": "add",
            "line": "\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t\tdefault:"
          },
          {
            "type": "add",
            "line": "\t\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tif (hdr.argsz - minsz < hdr.count * size ||"
          },
          {
            "type": "delete",
            "line": "\t\t\t    hdr.start >= max || hdr.start + hdr.count > max)"
          },
          {
            "type": "add",
            "line": "\t\tif (size) {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (hdr.argsz - minsz < hdr.count * size)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tdata = memdup_user((void __user *)(arg + minsz),"
          }
        ]
      },
      {
        "file": "drivers/vfio/pci/vfio_pci_intrs.c",
        "changes": [
          {
            "type": "context",
            "line": "index c2e60893cd09..1c46045b0e7f 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/vfio/pci/vfio_pci_intrs.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/vfio/pci/vfio_pci_intrs.c"
          },
          {
            "type": "context",
            "line": " \tif (!is_irq_none(vdev))"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tvdev->ctx = kzalloc(nvec * sizeof(struct vfio_pci_irq_ctx), GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tvdev->ctx = kcalloc(nvec, sizeof(struct vfio_pci_irq_ctx), GFP_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tif (!vdev->ctx)"
          },
          {
            "type": "context",
            "line": " \t\treturn -ENOMEM;"
          }
        ]
      }
    ]
  },
  {
    "commit": "057b8945f78f76d0b04eeb5c27cd9225e5e7ad86",
    "files": [
      {
        "file": "drivers/spi/spi-fsl-lpspi.c",
        "changes": [
          {
            "type": "context",
            "line": "index d08e9324140e..3528ed5eea9b 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/spi/spi-fsl-lpspi.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/spi/spi-fsl-lpspi.c"
          },
          {
            "type": "context",
            "line": " \tret = pm_runtime_get_sync(fsl_lpspi->dev);"
          },
          {
            "type": "context",
            "line": " \tif (ret < 0) {"
          },
          {
            "type": "context",
            "line": " \t\tdev_err(fsl_lpspi->dev, \"failed to enable clock\\n\");"
          },
          {
            "type": "delete",
            "line": "\t\treturn ret;"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_controller_put;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ttemp = readl(fsl_lpspi->base + IMX7ULP_PARAM);"
          }
        ]
      }
    ]
  },
  {
    "commit": "05a974efa4bdf6e2a150e3f27dc6fcf0a9ad5655",
    "files": [
      {
        "file": "drivers/net/ieee802154/atusb.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1253f864737a..fa3e8c34b26c 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/ieee802154/atusb.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/ieee802154/atusb.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct usb_device *usb_dev = atusb->usb_dev;"
          },
          {
            "type": "context",
            "line": " \tint ret;"
          },
          {
            "type": "add",
            "line": "\tuint8_t *buffer;"
          },
          {
            "type": "context",
            "line": " \tuint8_t value;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbuffer = kmalloc(1, GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tif (!buffer)"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdev_dbg(&usb_dev->dev, \"atusb: reg = 0x%x\\n\", reg);"
          },
          {
            "type": "context",
            "line": " \tret = atusb_control_msg(atusb, usb_rcvctrlpipe(usb_dev, 0),"
          },
          {
            "type": "context",
            "line": " \t\t\t\tATUSB_REG_READ, ATUSB_REQ_FROM_DEV,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t0, reg, &value, 1, 1000);"
          },
          {
            "type": "delete",
            "line": "\treturn ret >= 0 ? value : ret;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t0, reg, buffer, 1, 1000);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (ret >= 0) {"
          },
          {
            "type": "add",
            "line": "\t\tvalue = buffer[0];"
          },
          {
            "type": "add",
            "line": "\t\tkfree(buffer);"
          },
          {
            "type": "add",
            "line": "\t\treturn value;"
          },
          {
            "type": "add",
            "line": "\t} else {"
          },
          {
            "type": "add",
            "line": "\t\tkfree(buffer);"
          },
          {
            "type": "add",
            "line": "\t\treturn ret;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int atusb_write_subreg(struct atusb *atusb, uint8_t reg, uint8_t mask,"
          },
          {
            "type": "context",
            "line": " static int atusb_get_and_show_revision(struct atusb *atusb)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct usb_device *usb_dev = atusb->usb_dev;"
          },
          {
            "type": "delete",
            "line": "\tunsigned char buffer[3];"
          },
          {
            "type": "add",
            "line": "\tunsigned char *buffer;"
          },
          {
            "type": "context",
            "line": " \tint ret;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbuffer = kmalloc(3, GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tif (!buffer)"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Get a couple of the ATMega Firmware values */"
          },
          {
            "type": "context",
            "line": " \tret = atusb_control_msg(atusb, usb_rcvctrlpipe(usb_dev, 0),"
          },
          {
            "type": "context",
            "line": " \t\t\t\tATUSB_ID, ATUSB_REQ_FROM_DEV, 0, 0,"
          },
          {
            "type": "context",
            "line": " \t\tdev_info(&usb_dev->dev, \"Please update to version 0.2 or newer\");"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(buffer);"
          },
          {
            "type": "context",
            "line": " \treturn ret;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int atusb_get_and_show_build(struct atusb *atusb)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct usb_device *usb_dev = atusb->usb_dev;"
          },
          {
            "type": "delete",
            "line": "\tchar build[ATUSB_BUILD_SIZE + 1];"
          },
          {
            "type": "add",
            "line": "\tchar *build;"
          },
          {
            "type": "context",
            "line": " \tint ret;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbuild = kmalloc(ATUSB_BUILD_SIZE + 1, GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tif (!build)"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tret = atusb_control_msg(atusb, usb_rcvctrlpipe(usb_dev, 0),"
          },
          {
            "type": "context",
            "line": " \t\t\t\tATUSB_BUILD, ATUSB_REQ_FROM_DEV, 0, 0,"
          },
          {
            "type": "context",
            "line": " \t\t\t\tbuild, ATUSB_BUILD_SIZE, 1000);"
          },
          {
            "type": "context",
            "line": " \t\tdev_info(&usb_dev->dev, \"Firmware: build %s\\n\", build);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(build);"
          },
          {
            "type": "context",
            "line": " \treturn ret;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "05ab8f2647e4221cbdb3856dd7d32bd5407316b3",
    "files": [
      {
        "file": "net/core/filter.c",
        "changes": [
          {
            "type": "context",
            "line": "index e08b3822c72a..0e0856f5d708 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/core/filter.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/core/filter.c"
          },
          {
            "type": "context",
            "line": " \tif (skb_is_nonlinear(skb))"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (skb->len < sizeof(struct nlattr))"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (A > skb->len - sizeof(struct nlattr))"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (skb_is_nonlinear(skb))"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (skb->len < sizeof(struct nlattr))"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (A > skb->len - sizeof(struct nlattr))"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tnla = (struct nlattr *) &skb->data[A];"
          },
          {
            "type": "delete",
            "line": "\tif (nla->nla_len > A - skb->len)"
          },
          {
            "type": "add",
            "line": "\tif (nla->nla_len > skb->len - A)"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tnla = nla_find_nested(nla, X);"
          }
        ]
      }
    ]
  },
  {
    "commit": "05b27615481e72e3b338bb12990fb3e0c2ecc2a9",
    "files": [
      {
        "file": "src/testdir/test_visual.vim",
        "changes": [
          {
            "type": "context",
            "line": "index a187aa8e0..72f5388b9 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testdir/test_visual.vim"
          },
          {
            "type": "context",
            "line": "+++ b/src/testdir/test_visual.vim"
          },
          {
            "type": "context",
            "line": "   bwipe!"
          },
          {
            "type": "context",
            "line": " endfunc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\" this was causing an ml_get error"
          },
          {
            "type": "add",
            "line": "func Test_visual_exchange_windows()"
          },
          {
            "type": "add",
            "line": "  enew!"
          },
          {
            "type": "add",
            "line": "  new"
          },
          {
            "type": "add",
            "line": "  call setline(1, ['foo', 'bar'])"
          },
          {
            "type": "add",
            "line": "  exe \"normal G\\<C-V>gg\\<C-W>\\<C-X>OO\\<Esc>\""
          },
          {
            "type": "add",
            "line": "  bwipe!"
          },
          {
            "type": "add",
            "line": "  bwipe!"
          },
          {
            "type": "add",
            "line": "endfunc"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \" vim: shiftwidth=2 sts=2 expandtab"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index 54a9ebee5..e32abbb79 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    4154,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     4153,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      },
      {
        "file": "src/window.c",
        "changes": [
          {
            "type": "context",
            "line": "index 05e85baf3..74257275c 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/window.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/window.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     (void)win_comp_pos();\t\t// recompute window positions"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (wp->w_buffer != curbuf)"
          },
          {
            "type": "add",
            "line": "\treset_VIsual_and_resel();"
          },
          {
            "type": "add",
            "line": "    else if (VIsual_active)"
          },
          {
            "type": "add",
            "line": "\twp->w_cursor = curwin->w_cursor;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     win_enter(wp, TRUE);"
          },
          {
            "type": "context",
            "line": "     redraw_all_later(NOT_VALID);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " win_alloc_lines(win_T *wp)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     wp->w_lines_valid = 0;"
          },
          {
            "type": "delete",
            "line": "    wp->w_lines = ALLOC_CLEAR_MULT(wline_T, Rows );"
          },
          {
            "type": "add",
            "line": "    wp->w_lines = ALLOC_CLEAR_MULT(wline_T, Rows);"
          },
          {
            "type": "context",
            "line": "     if (wp->w_lines == NULL)"
          },
          {
            "type": "context",
            "line": " \treturn FAIL;"
          },
          {
            "type": "context",
            "line": "     return OK;"
          }
        ]
      }
    ]
  },
  {
    "commit": "05bd90f563649f2e9c8f0c85cf5838315a665a02",
    "files": [
      {
        "file": "airflow/config_templates/config.yml",
        "changes": [
          {
            "type": "context",
            "line": "index a252716ed1..f48a569b54 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/config_templates/config.yml"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/config_templates/config.yml"
          },
          {
            "type": "context",
            "line": "       type: float"
          },
          {
            "type": "context",
            "line": "       example: ~"
          },
          {
            "type": "context",
            "line": "       default: \"120.0\""
          },
          {
            "type": "add",
            "line": "    allowed_run_id_pattern:"
          },
          {
            "type": "add",
            "line": "      description: |"
          },
          {
            "type": "add",
            "line": "        The run_id pattern used to verify the validity of user input to the run_id parameter when"
          },
          {
            "type": "add",
            "line": "        triggering a DAG. This pattern cannot change the pattern used by scheduler to generate run_id"
          },
          {
            "type": "add",
            "line": "        for scheduled DAG runs or DAG runs triggered without changing the run_id parameter."
          },
          {
            "type": "add",
            "line": "      version_added: 2.6.3"
          },
          {
            "type": "add",
            "line": "      type: string"
          },
          {
            "type": "add",
            "line": "      example: ~"
          },
          {
            "type": "add",
            "line": "      default: \"^[A-Za-z0-9_.~:+-]+$\""
          },
          {
            "type": "context",
            "line": " triggerer:"
          },
          {
            "type": "context",
            "line": "   description: ~"
          },
          {
            "type": "context",
            "line": "   options:"
          }
        ]
      },
      {
        "file": "airflow/config_templates/default_airflow.cfg",
        "changes": [
          {
            "type": "context",
            "line": "index 4eaab9ae95..c28155ac2c 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/config_templates/default_airflow.cfg"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/config_templates/default_airflow.cfg"
          },
          {
            "type": "context",
            "line": " # longer than `[scheduler] task_queued_timeout`."
          },
          {
            "type": "context",
            "line": " task_queued_timeout_check_interval = 120.0"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "# The run_id pattern used to verify the validity of user input to the run_id parameter when"
          },
          {
            "type": "add",
            "line": "# triggering a DAG. This pattern cannot change the pattern used by scheduler to generate run_id"
          },
          {
            "type": "add",
            "line": "# for scheduled DAG runs or DAG runs triggered without changing the run_id parameter."
          },
          {
            "type": "add",
            "line": "allowed_run_id_pattern = ^[A-Za-z0-9_.~:+-]+$"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " [triggerer]"
          },
          {
            "type": "context",
            "line": " # How many triggers a single Triggerer will run at once, by default."
          },
          {
            "type": "context",
            "line": " default_capacity = 1000"
          }
        ]
      },
      {
        "file": "airflow/models/dag.py",
        "changes": [
          {
            "type": "context",
            "line": "index 31070a7b7c..11468b59ea 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/models/dag.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/models/dag.py"
          },
          {
            "type": "context",
            "line": " import airflow.templates"
          },
          {
            "type": "context",
            "line": " from airflow import settings, utils"
          },
          {
            "type": "context",
            "line": " from airflow.api_internal.internal_api_call import internal_api_call"
          },
          {
            "type": "delete",
            "line": "from airflow.configuration import conf, secrets_backend_list"
          },
          {
            "type": "add",
            "line": "from airflow.configuration import conf as airflow_conf, secrets_backend_list"
          },
          {
            "type": "context",
            "line": " from airflow.exceptions import ("
          },
          {
            "type": "context",
            "line": "     AirflowDagInconsistent,"
          },
          {
            "type": "context",
            "line": "     AirflowException,"
          },
          {
            "type": "context",
            "line": " from airflow.models.baseoperator import BaseOperator"
          },
          {
            "type": "context",
            "line": " from airflow.models.dagcode import DagCode"
          },
          {
            "type": "context",
            "line": " from airflow.models.dagpickle import DagPickle"
          },
          {
            "type": "delete",
            "line": "from airflow.models.dagrun import DagRun"
          },
          {
            "type": "add",
            "line": "from airflow.models.dagrun import RUN_ID_REGEX, DagRun"
          },
          {
            "type": "context",
            "line": " from airflow.models.operator import Operator"
          },
          {
            "type": "context",
            "line": " from airflow.models.param import DagParam, ParamsDict"
          },
          {
            "type": "context",
            "line": " from airflow.models.taskinstance import Context, TaskInstance, TaskInstanceKey, clear_task_instances"
          },
          {
            "type": "context",
            "line": "         user_defined_filters: dict | None = None,"
          },
          {
            "type": "context",
            "line": "         default_args: dict | None = None,"
          },
          {
            "type": "context",
            "line": "         concurrency: int | None = None,"
          },
          {
            "type": "delete",
            "line": "        max_active_tasks: int = conf.getint(\"core\", \"max_active_tasks_per_dag\"),"
          },
          {
            "type": "delete",
            "line": "        max_active_runs: int = conf.getint(\"core\", \"max_active_runs_per_dag\"),"
          },
          {
            "type": "add",
            "line": "        max_active_tasks: int = airflow_conf.getint(\"core\", \"max_active_tasks_per_dag\"),"
          },
          {
            "type": "add",
            "line": "        max_active_runs: int = airflow_conf.getint(\"core\", \"max_active_runs_per_dag\"),"
          },
          {
            "type": "context",
            "line": "         dagrun_timeout: timedelta | None = None,"
          },
          {
            "type": "context",
            "line": "         sla_miss_callback: None | SLAMissCallback | list[SLAMissCallback] = None,"
          },
          {
            "type": "delete",
            "line": "        default_view: str = conf.get_mandatory_value(\"webserver\", \"dag_default_view\").lower(),"
          },
          {
            "type": "delete",
            "line": "        orientation: str = conf.get_mandatory_value(\"webserver\", \"dag_orientation\"),"
          },
          {
            "type": "delete",
            "line": "        catchup: bool = conf.getboolean(\"scheduler\", \"catchup_by_default\"),"
          },
          {
            "type": "add",
            "line": "        default_view: str = airflow_conf.get_mandatory_value(\"webserver\", \"dag_default_view\").lower(),"
          },
          {
            "type": "add",
            "line": "        orientation: str = airflow_conf.get_mandatory_value(\"webserver\", \"dag_orientation\"),"
          },
          {
            "type": "add",
            "line": "        catchup: bool = airflow_conf.getboolean(\"scheduler\", \"catchup_by_default\"),"
          },
          {
            "type": "context",
            "line": "         on_success_callback: None | DagStateChangeCallback | list[DagStateChangeCallback] = None,"
          },
          {
            "type": "context",
            "line": "         on_failure_callback: None | DagStateChangeCallback | list[DagStateChangeCallback] = None,"
          },
          {
            "type": "context",
            "line": "         doc_md: str | None = None,"
          },
          {
            "type": "context",
            "line": "         mark_success=False,"
          },
          {
            "type": "context",
            "line": "         local=False,"
          },
          {
            "type": "context",
            "line": "         executor=None,"
          },
          {
            "type": "delete",
            "line": "        donot_pickle=conf.getboolean(\"core\", \"donot_pickle\"),"
          },
          {
            "type": "add",
            "line": "        donot_pickle=airflow_conf.getboolean(\"core\", \"donot_pickle\"),"
          },
          {
            "type": "context",
            "line": "         ignore_task_deps=False,"
          },
          {
            "type": "context",
            "line": "         ignore_first_depends_on_past=True,"
          },
          {
            "type": "context",
            "line": "         pool=None,"
          },
          {
            "type": "context",
            "line": "                 \"Creating DagRun needs either `run_id` or both `run_type` and `execution_date`\""
          },
          {
            "type": "context",
            "line": "             )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if run_id and \"/\" in run_id:"
          },
          {
            "type": "delete",
            "line": "            warnings.warn("
          },
          {
            "type": "delete",
            "line": "                \"Using forward slash ('/') in a DAG run ID is deprecated. Note that this character \""
          },
          {
            "type": "delete",
            "line": "                \"also makes the run impossible to retrieve via Airflow's REST API.\","
          },
          {
            "type": "delete",
            "line": "                RemovedInAirflow3Warning,"
          },
          {
            "type": "delete",
            "line": "                stacklevel=3,"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        regex = airflow_conf.get(\"scheduler\", \"allowed_run_id_pattern\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if run_id and not re.match(RUN_ID_REGEX, run_id):"
          },
          {
            "type": "add",
            "line": "            if not regex.strip() or not re.match(regex.strip(), run_id):"
          },
          {
            "type": "add",
            "line": "                raise AirflowException("
          },
          {
            "type": "add",
            "line": "                    f\"The provided run ID '{run_id}' is invalid. It does not match either \""
          },
          {
            "type": "add",
            "line": "                    f\"the configured pattern: '{regex}' or the built-in pattern: '{RUN_ID_REGEX}'\""
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # create a copy of params before validating"
          },
          {
            "type": "context",
            "line": "         copied_params = copy.deepcopy(self.params)"
          },
          {
            "type": "context",
            "line": "     def get_default_view(self):"
          },
          {
            "type": "context",
            "line": "         \"\"\"This is only there for backward compatible jinja2 templates.\"\"\""
          },
          {
            "type": "context",
            "line": "         if self.default_view is None:"
          },
          {
            "type": "delete",
            "line": "            return conf.get(\"webserver\", \"dag_default_view\").lower()"
          },
          {
            "type": "add",
            "line": "            return airflow_conf.get(\"webserver\", \"dag_default_view\").lower()"
          },
          {
            "type": "context",
            "line": "         else:"
          },
          {
            "type": "context",
            "line": "             return self.default_view"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     root_dag_id = Column(StringID())"
          },
          {
            "type": "context",
            "line": "     # A DAG can be paused from the UI / DB"
          },
          {
            "type": "context",
            "line": "     # Set this default value of is_paused based on a configuration value!"
          },
          {
            "type": "delete",
            "line": "    is_paused_at_creation = conf.getboolean(\"core\", \"dags_are_paused_at_creation\")"
          },
          {
            "type": "add",
            "line": "    is_paused_at_creation = airflow_conf.getboolean(\"core\", \"dags_are_paused_at_creation\")"
          },
          {
            "type": "context",
            "line": "     is_paused = Column(Boolean, default=is_paused_at_creation)"
          },
          {
            "type": "context",
            "line": "     # Whether the DAG is a subdag"
          },
          {
            "type": "context",
            "line": "     is_subdag = Column(Boolean, default=False)"
          },
          {
            "type": "context",
            "line": "         \"TaskOutletDatasetReference\","
          },
          {
            "type": "context",
            "line": "         cascade=\"all, delete, delete-orphan\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "delete",
            "line": "    NUM_DAGS_PER_DAGRUN_QUERY = conf.getint(\"scheduler\", \"max_dagruns_to_create_per_loop\", fallback=10)"
          },
          {
            "type": "add",
            "line": "    NUM_DAGS_PER_DAGRUN_QUERY = airflow_conf.getint("
          },
          {
            "type": "add",
            "line": "        \"scheduler\", \"max_dagruns_to_create_per_loop\", fallback=10"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def __init__(self, concurrency=None, **kwargs):"
          },
          {
            "type": "context",
            "line": "         super().__init__(**kwargs)"
          },
          {
            "type": "context",
            "line": "                 )"
          },
          {
            "type": "context",
            "line": "                 self.max_active_tasks = concurrency"
          },
          {
            "type": "context",
            "line": "             else:"
          },
          {
            "type": "delete",
            "line": "                self.max_active_tasks = conf.getint(\"core\", \"max_active_tasks_per_dag\")"
          },
          {
            "type": "add",
            "line": "                self.max_active_tasks = airflow_conf.getint(\"core\", \"max_active_tasks_per_dag\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if self.max_active_runs is None:"
          },
          {
            "type": "delete",
            "line": "            self.max_active_runs = conf.getint(\"core\", \"max_active_runs_per_dag\")"
          },
          {
            "type": "add",
            "line": "            self.max_active_runs = airflow_conf.getint(\"core\", \"max_active_runs_per_dag\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if self.has_task_concurrency_limits is None:"
          },
          {
            "type": "context",
            "line": "             # Be safe -- this will be updated later once the DAG is parsed"
          },
          {
            "type": "context",
            "line": "         have a value."
          },
          {
            "type": "context",
            "line": "         \"\"\""
          },
          {
            "type": "context",
            "line": "         # This is for backwards-compatibility with old dags that don't have None as default_view"
          },
          {
            "type": "delete",
            "line": "        return self.default_view or conf.get_mandatory_value(\"webserver\", \"dag_default_view\").lower()"
          },
          {
            "type": "add",
            "line": "        return self.default_view or airflow_conf.get_mandatory_value(\"webserver\", \"dag_default_view\").lower()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @property"
          },
          {
            "type": "context",
            "line": "     def safe_dag_id(self):"
          },
          {
            "type": "context",
            "line": "     user_defined_filters: dict | None = None,"
          },
          {
            "type": "context",
            "line": "     default_args: dict | None = None,"
          },
          {
            "type": "context",
            "line": "     concurrency: int | None = None,"
          },
          {
            "type": "delete",
            "line": "    max_active_tasks: int = conf.getint(\"core\", \"max_active_tasks_per_dag\"),"
          },
          {
            "type": "delete",
            "line": "    max_active_runs: int = conf.getint(\"core\", \"max_active_runs_per_dag\"),"
          },
          {
            "type": "add",
            "line": "    max_active_tasks: int = airflow_conf.getint(\"core\", \"max_active_tasks_per_dag\"),"
          },
          {
            "type": "add",
            "line": "    max_active_runs: int = airflow_conf.getint(\"core\", \"max_active_runs_per_dag\"),"
          },
          {
            "type": "context",
            "line": "     dagrun_timeout: timedelta | None = None,"
          },
          {
            "type": "context",
            "line": "     sla_miss_callback: None | SLAMissCallback | list[SLAMissCallback] = None,"
          },
          {
            "type": "delete",
            "line": "    default_view: str = conf.get_mandatory_value(\"webserver\", \"dag_default_view\").lower(),"
          },
          {
            "type": "delete",
            "line": "    orientation: str = conf.get_mandatory_value(\"webserver\", \"dag_orientation\"),"
          },
          {
            "type": "delete",
            "line": "    catchup: bool = conf.getboolean(\"scheduler\", \"catchup_by_default\"),"
          },
          {
            "type": "add",
            "line": "    default_view: str = airflow_conf.get_mandatory_value(\"webserver\", \"dag_default_view\").lower(),"
          },
          {
            "type": "add",
            "line": "    orientation: str = airflow_conf.get_mandatory_value(\"webserver\", \"dag_orientation\"),"
          },
          {
            "type": "add",
            "line": "    catchup: bool = airflow_conf.getboolean(\"scheduler\", \"catchup_by_default\"),"
          },
          {
            "type": "context",
            "line": "     on_success_callback: None | DagStateChangeCallback | list[DagStateChangeCallback] = None,"
          },
          {
            "type": "context",
            "line": "     on_failure_callback: None | DagStateChangeCallback | list[DagStateChangeCallback] = None,"
          },
          {
            "type": "context",
            "line": "     doc_md: str | None = None,"
          }
        ]
      },
      {
        "file": "airflow/models/dagrun.py",
        "changes": [
          {
            "type": "context",
            "line": "index dab89c12cd..8f3b3a3301 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/models/dagrun.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/models/dagrun.py"
          },
          {
            "type": "context",
            "line": " from datetime import datetime"
          },
          {
            "type": "context",
            "line": " from typing import TYPE_CHECKING, Any, Callable, Iterable, Iterator, NamedTuple, Sequence, TypeVar, overload"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import re2 as re"
          },
          {
            "type": "context",
            "line": " from sqlalchemy import ("
          },
          {
            "type": "context",
            "line": "     Boolean,"
          },
          {
            "type": "context",
            "line": "     Column,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": " from sqlalchemy.exc import IntegrityError"
          },
          {
            "type": "context",
            "line": " from sqlalchemy.ext.associationproxy import association_proxy"
          },
          {
            "type": "delete",
            "line": "from sqlalchemy.orm import Query, Session, declared_attr, joinedload, relationship, synonym"
          },
          {
            "type": "add",
            "line": "from sqlalchemy.orm import Query, Session, declared_attr, joinedload, relationship, synonym, validates"
          },
          {
            "type": "context",
            "line": " from sqlalchemy.sql.expression import false, select, true"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from airflow import settings"
          },
          {
            "type": "context",
            "line": "     CreatedTasks = TypeVar(\"CreatedTasks\", Iterator[\"dict[str, Any]\"], Iterator[TI])"
          },
          {
            "type": "context",
            "line": "     TaskCreator = Callable[[Operator, Iterable[int]], CreatedTasks]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "RUN_ID_REGEX = r\"^(?:manual|scheduled|dataset_triggered)__(?:\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+00:00)$\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class TISchedulingDecision(NamedTuple):"
          },
          {
            "type": "context",
            "line": "     \"\"\"Type of return for DagRun.task_instance_scheduling_decisions.\"\"\""
          },
          {
            "type": "context",
            "line": "             external_trigger=self.external_trigger,"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @validates(\"run_id\")"
          },
          {
            "type": "add",
            "line": "    def validate_run_id(self, key: str, run_id: str) -> str | None:"
          },
          {
            "type": "add",
            "line": "        if not run_id:"
          },
          {
            "type": "add",
            "line": "            return None"
          },
          {
            "type": "add",
            "line": "        regex = airflow_conf.get(\"scheduler\", \"allowed_run_id_pattern\")"
          },
          {
            "type": "add",
            "line": "        if not re.match(regex, run_id) and not re.match(RUN_ID_REGEX, run_id):"
          },
          {
            "type": "add",
            "line": "            raise ValueError("
          },
          {
            "type": "add",
            "line": "                f\"The run_id provided '{run_id}' does not match the pattern '{regex}' or '{RUN_ID_REGEX}'\""
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        return run_id"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @property"
          },
          {
            "type": "context",
            "line": "     def stats_tags(self) -> dict[str, str]:"
          },
          {
            "type": "context",
            "line": "         return prune_dict({\"dag_id\": self.dag_id, \"run_type\": self.run_type})"
          }
        ]
      },
      {
        "file": "airflow/www/views.py",
        "changes": [
          {
            "type": "context",
            "line": "index 607927650b..026f8b5334 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/www/views.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/www/views.py"
          },
          {
            "type": "context",
            "line": " from airflow.models.abstractoperator import AbstractOperator"
          },
          {
            "type": "context",
            "line": " from airflow.models.dag import DAG, get_dataset_triggered_next_run_info"
          },
          {
            "type": "context",
            "line": " from airflow.models.dagcode import DagCode"
          },
          {
            "type": "delete",
            "line": "from airflow.models.dagrun import DagRun, DagRunType"
          },
          {
            "type": "add",
            "line": "from airflow.models.dagrun import RUN_ID_REGEX, DagRun, DagRunType"
          },
          {
            "type": "context",
            "line": " from airflow.models.dataset import DagScheduleDatasetReference, DatasetDagRunQueue, DatasetEvent, DatasetModel"
          },
          {
            "type": "context",
            "line": " from airflow.models.mappedoperator import MappedOperator"
          },
          {
            "type": "context",
            "line": " from airflow.models.operator import Operator"
          },
          {
            "type": "context",
            "line": "     @provide_session"
          },
          {
            "type": "context",
            "line": "     def trigger(self, dag_id: str, session: Session = NEW_SESSION):"
          },
          {
            "type": "context",
            "line": "         \"\"\"Triggers DAG Run.\"\"\""
          },
          {
            "type": "delete",
            "line": "        run_id = request.values.get(\"run_id\", \"\")"
          },
          {
            "type": "add",
            "line": "        run_id = request.values.get(\"run_id\", \"\").replace(\" \", \"+\")"
          },
          {
            "type": "context",
            "line": "         origin = get_safe_url(request.values.get(\"origin\"))"
          },
          {
            "type": "context",
            "line": "         unpause = request.values.get(\"unpause\")"
          },
          {
            "type": "context",
            "line": "         request_conf = request.values.get(\"conf\")"
          },
          {
            "type": "context",
            "line": "             flash(message, \"error\")"
          },
          {
            "type": "context",
            "line": "             return redirect(origin)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        # Flash a warning when slash is used, but still allow it to continue on."
          },
          {
            "type": "delete",
            "line": "        if run_id and \"/\" in run_id:"
          },
          {
            "type": "delete",
            "line": "            flash("
          },
          {
            "type": "delete",
            "line": "                \"Using forward slash ('/') in a DAG run ID is deprecated. Note that this character \""
          },
          {
            "type": "delete",
            "line": "                \"also makes the run impossible to retrieve via Airflow's REST API.\","
          },
          {
            "type": "delete",
            "line": "                \"warning\","
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        regex = conf.get(\"scheduler\", \"allowed_run_id_pattern\")"
          },
          {
            "type": "add",
            "line": "        if run_id and not re.match(RUN_ID_REGEX, run_id):"
          },
          {
            "type": "add",
            "line": "            if not regex.strip() or not re.match(regex.strip(), run_id):"
          },
          {
            "type": "add",
            "line": "                flash("
          },
          {
            "type": "add",
            "line": "                    f\"The provided run ID '{run_id}' is invalid. It does not match either \""
          },
          {
            "type": "add",
            "line": "                    f\"the configured pattern: '{regex}' or the built-in pattern: '{RUN_ID_REGEX}'\","
          },
          {
            "type": "add",
            "line": "                    \"error\","
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "                form = DateTimeForm(data={\"execution_date\": execution_date})"
          },
          {
            "type": "add",
            "line": "                return self.render_template("
          },
          {
            "type": "add",
            "line": "                    \"airflow/trigger.html\","
          },
          {
            "type": "add",
            "line": "                    form_fields=form_fields,"
          },
          {
            "type": "add",
            "line": "                    dag=dag,"
          },
          {
            "type": "add",
            "line": "                    dag_id=dag_id,"
          },
          {
            "type": "add",
            "line": "                    origin=origin,"
          },
          {
            "type": "add",
            "line": "                    conf=request_conf,"
          },
          {
            "type": "add",
            "line": "                    form=form,"
          },
          {
            "type": "add",
            "line": "                    is_dag_run_conf_overrides_params=is_dag_run_conf_overrides_params,"
          },
          {
            "type": "add",
            "line": "                    recent_confs=recent_confs,"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         run_conf = {}"
          },
          {
            "type": "context",
            "line": "         if request_conf:"
          }
        ]
      },
      {
        "file": "tests/models/test_dagrun.py",
        "changes": [
          {
            "type": "context",
            "line": "index 024b9df3a1..5d7db547d3 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/models/test_dagrun.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/models/test_dagrun.py"
          },
          {
            "type": "context",
            "line": " from airflow import settings"
          },
          {
            "type": "context",
            "line": " from airflow.callbacks.callback_requests import DagCallbackRequest"
          },
          {
            "type": "context",
            "line": " from airflow.decorators import setup, task, task_group, teardown"
          },
          {
            "type": "add",
            "line": "from airflow.exceptions import AirflowException"
          },
          {
            "type": "context",
            "line": " from airflow.models import ("
          },
          {
            "type": "context",
            "line": "     DAG,"
          },
          {
            "type": "context",
            "line": "     DagBag,"
          },
          {
            "type": "context",
            "line": " from airflow.utils.types import DagRunType"
          },
          {
            "type": "context",
            "line": " from tests.models import DEFAULT_DATE as _DEFAULT_DATE"
          },
          {
            "type": "context",
            "line": " from tests.test_utils import db"
          },
          {
            "type": "add",
            "line": "from tests.test_utils.config import conf_vars"
          },
          {
            "type": "context",
            "line": " from tests.test_utils.mock_operators import MockOperator"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " DEFAULT_DATE = pendulum.instance(_DEFAULT_DATE)"
          },
          {
            "type": "context",
            "line": "     tis = dr.task_instance_scheduling_decisions(session).tis"
          },
          {
            "type": "context",
            "line": "     tis_for_state = {x.task_id for x in dr._tis_for_dagrun_state(dag=dag, tis=tis)}"
          },
          {
            "type": "context",
            "line": "     assert tis_for_state == expected"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "@pytest.mark.parametrize("
          },
          {
            "type": "add",
            "line": "    \"pattern, run_id, result\","
          },
          {
            "type": "add",
            "line": "    ["
          },
          {
            "type": "add",
            "line": "        [\"^[A-Z]\", \"ABC\", True],"
          },
          {
            "type": "add",
            "line": "        [\"^[A-Z]\", \"abc\", False],"
          },
          {
            "type": "add",
            "line": "        [\"^[0-9]\", \"123\", True],"
          },
          {
            "type": "add",
            "line": "        # The below params tests that user configuration does not affect internally generated"
          },
          {
            "type": "add",
            "line": "        # run_ids"
          },
          {
            "type": "add",
            "line": "        [\"\", \"scheduled__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"manual__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"dataset_triggered__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"scheduled_2023-01-01T00\", False],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"manual_2023-01-01T00\", False],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"dataset_triggered_2023-01-01T00\", False],"
          },
          {
            "type": "add",
            "line": "        [\"^[0-9]\", \"scheduled__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"^[0-9]\", \"manual__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"^[a-z]\", \"dataset_triggered__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "    ],"
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "add",
            "line": "def test_dag_run_id_config(session, dag_maker, pattern, run_id, result):"
          },
          {
            "type": "add",
            "line": "    with conf_vars({(\"scheduler\", \"allowed_run_id_pattern\"): pattern}):"
          },
          {
            "type": "add",
            "line": "        with dag_maker():"
          },
          {
            "type": "add",
            "line": "            ..."
          },
          {
            "type": "add",
            "line": "        if result:"
          },
          {
            "type": "add",
            "line": "            dag_maker.create_dagrun(run_id=run_id)"
          },
          {
            "type": "add",
            "line": "        else:"
          },
          {
            "type": "add",
            "line": "            with pytest.raises(AirflowException):"
          },
          {
            "type": "add",
            "line": "                dag_maker.create_dagrun(run_id=run_id)"
          }
        ]
      },
      {
        "file": "tests/www/views/test_views_trigger_dag.py",
        "changes": [
          {
            "type": "context",
            "line": "index 7cf140ed7c..12f090bc4f 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/www/views/test_views_trigger_dag.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/www/views/test_views_trigger_dag.py"
          },
          {
            "type": "context",
            "line": " from airflow.utils.session import create_session"
          },
          {
            "type": "context",
            "line": " from airflow.utils.types import DagRunType"
          },
          {
            "type": "context",
            "line": " from tests.test_utils.api_connexion_utils import create_test_client"
          },
          {
            "type": "add",
            "line": "from tests.test_utils.config import conf_vars"
          },
          {
            "type": "context",
            "line": " from tests.test_utils.www import check_content_in_response"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         f'<textarea style=\"display: none;\" id=\"json_start\" name=\"json_start\">{expected_dag_conf}</textarea>',"
          },
          {
            "type": "context",
            "line": "         resp,"
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "@pytest.mark.parametrize("
          },
          {
            "type": "add",
            "line": "    \"pattern, run_id, result\","
          },
          {
            "type": "add",
            "line": "    ["
          },
          {
            "type": "add",
            "line": "        [\"^[A-Z]\", \"ABC\", True],"
          },
          {
            "type": "add",
            "line": "        [\"^[A-Z]\", \"abc\", False],"
          },
          {
            "type": "add",
            "line": "        [\"^[0-9]\", \"123\", True],"
          },
          {
            "type": "add",
            "line": "        # The below params tests that user configuration does not affect internally generated"
          },
          {
            "type": "add",
            "line": "        # run_ids. We use manual__ as a prefix for manually triggered DAGs due to a restriction"
          },
          {
            "type": "add",
            "line": "        # in manually triggered DAGs that the run_id must not start with scheduled__."
          },
          {
            "type": "add",
            "line": "        [\"\", \"manual__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"scheduled_2023-01-01T00\", False],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"manual_2023-01-01T00\", False],"
          },
          {
            "type": "add",
            "line": "        [\"\", \"dataset_triggered_2023-01-01T00\", False],"
          },
          {
            "type": "add",
            "line": "        [\"^[0-9]\", \"manual__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "        [\"^[a-z]\", \"manual__2023-01-01T00:00:00+00:00\", True],"
          },
          {
            "type": "add",
            "line": "    ],"
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "add",
            "line": "def test_dag_run_id_pattern(session, admin_client, pattern, run_id, result):"
          },
          {
            "type": "add",
            "line": "    with conf_vars({(\"scheduler\", \"allowed_run_id_pattern\"): pattern}):"
          },
          {
            "type": "add",
            "line": "        test_dag_id = \"example_bash_operator\""
          },
          {
            "type": "add",
            "line": "        admin_client.post(f\"dags/{test_dag_id}/trigger?&run_id={run_id}\")"
          },
          {
            "type": "add",
            "line": "        run = session.query(DagRun).filter(DagRun.dag_id == test_dag_id).first()"
          },
          {
            "type": "add",
            "line": "        if result:"
          },
          {
            "type": "add",
            "line": "            assert run is not None"
          },
          {
            "type": "add",
            "line": "            assert run.run_type == DagRunType.MANUAL"
          },
          {
            "type": "add",
            "line": "        else:"
          },
          {
            "type": "add",
            "line": "            assert run is None"
          }
        ]
      }
    ]
  },
  {
    "commit": "05caadc7eedbef471ac9610809ba683f0c698700",
    "files": [
      {
        "file": "libarchive/archive_read_support_format_rar.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6450aac8..6c49f1a1 100644"
          },
          {
            "type": "context",
            "line": "--- a/libarchive/archive_read_support_format_rar.c"
          },
          {
            "type": "context",
            "line": "+++ b/libarchive/archive_read_support_format_rar.c"
          },
          {
            "type": "context",
            "line": "       rar->range_dec.Stream = &rar->bytein;"
          },
          {
            "type": "context",
            "line": "       __archive_ppmd7_functions.Ppmd7_Construct(&rar->ppmd7_context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "      if (rar->dictionary_size == 0) {"
          },
          {
            "type": "add",
            "line": "\t      archive_set_error(&a->archive, ARCHIVE_ERRNO_FILE_FORMAT,"
          },
          {
            "type": "add",
            "line": "                          \"Invalid zero dictionary size\");"
          },
          {
            "type": "add",
            "line": "\t      return (ARCHIVE_FATAL);"
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       if (!__archive_ppmd7_functions.Ppmd7_Alloc(&rar->ppmd7_context,"
          },
          {
            "type": "context",
            "line": "         rar->dictionary_size, &g_szalloc))"
          },
          {
            "type": "context",
            "line": "       {"
          }
        ]
      }
    ]
  },
  {
    "commit": "0625b4ba1a5d4703c7fb01c497bd6c156908af00",
    "files": [
      {
        "file": "drivers/infiniband/hw/mlx5/qp.c",
        "changes": [
          {
            "type": "context",
            "line": "index 351c2efceb35..6cba2a02d11b 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/infiniband/hw/mlx5/qp.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/infiniband/hw/mlx5/qp.c"
          },
          {
            "type": "context",
            "line": " \tstruct mlx5_ib_resources *devr = &dev->devr;"
          },
          {
            "type": "context",
            "line": " \tint inlen = MLX5_ST_SZ_BYTES(create_qp_in);"
          },
          {
            "type": "context",
            "line": " \tstruct mlx5_core_dev *mdev = dev->mdev;"
          },
          {
            "type": "delete",
            "line": "\tstruct mlx5_ib_create_qp_resp resp;"
          },
          {
            "type": "add",
            "line": "\tstruct mlx5_ib_create_qp_resp resp = {};"
          },
          {
            "type": "context",
            "line": " \tstruct mlx5_ib_cq *send_cq;"
          },
          {
            "type": "context",
            "line": " \tstruct mlx5_ib_cq *recv_cq;"
          },
          {
            "type": "context",
            "line": " \tunsigned long flags;"
          }
        ]
      }
    ]
  },
  {
    "commit": "066f29673ab4030b6b5b90c0c0326f7d3fe7612a",
    "files": [
      {
        "file": "spec/ParseFile.spec.js",
        "changes": [
          {
            "type": "context",
            "line": "index 281ce45c..88d6953e 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/ParseFile.spec.js"
          },
          {
            "type": "context",
            "line": "+++ b/spec/ParseFile.spec.js"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  xdescribe('Gridstore Range tests', () => {"
          },
          {
            "type": "add",
            "line": "  describe_only_db('mongo')('Gridstore Range', () => {"
          },
          {
            "type": "add",
            "line": "    it('supports bytes range out of range', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=15000-18000',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBe('bytes 1212-1212/1212');"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range if end greater than start', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=15000-100',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBe('bytes 100-1212/1212');"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range if end is undefined', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=100-',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBe('bytes 100-1212/1212');"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range if start and end undefined', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=abc-efs',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBeUndefined();"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range if start and end undefined', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBeUndefined();"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range if end is greater than size', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=0-2000',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBe('bytes 0-1212/1212');"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range if end is greater than size', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: repeat('argle bargle', 100),"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=0-2000',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBe('bytes 0-1212/1212');"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('supports bytes range with 0 length', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "add",
            "line": "        method: 'POST',"
          },
          {
            "type": "add",
            "line": "        headers: headers,"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1//files/file.txt ',"
          },
          {
            "type": "add",
            "line": "        body: 'a',"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      const b = response.data;"
          },
          {
            "type": "add",
            "line": "      const file = await request({"
          },
          {
            "type": "add",
            "line": "        url: b.url,"
          },
          {
            "type": "add",
            "line": "        headers: {"
          },
          {
            "type": "add",
            "line": "          'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "add",
            "line": "          'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "          Range: 'bytes=-2000',"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(file.headers['content-range']).toBe('bytes 0-1/1');"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     it('supports range requests', done => {"
          },
          {
            "type": "context",
            "line": "       const headers = {"
          },
          {
            "type": "context",
            "line": "         'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "context",
            "line": "       });"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    xit('supports getting last n bytes', done => {"
          },
          {
            "type": "add",
            "line": "    it('supports getting last n bytes', done => {"
          },
          {
            "type": "context",
            "line": "       const headers = {"
          },
          {
            "type": "context",
            "line": "         'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "context",
            "line": "         'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "context",
            "line": "       });"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    it('fails to stream unknown file', done => {"
          },
          {
            "type": "delete",
            "line": "      request({"
          },
          {
            "type": "add",
            "line": "    it('fails to stream unknown file', async () => {"
          },
          {
            "type": "add",
            "line": "      const response = await request({"
          },
          {
            "type": "context",
            "line": "         url: 'http://localhost:8378/1/files/test/file.txt',"
          },
          {
            "type": "context",
            "line": "         headers: {"
          },
          {
            "type": "context",
            "line": "           'Content-Type': 'application/octet-stream',"
          },
          {
            "type": "context",
            "line": "           'X-Parse-REST-API-Key': 'rest',"
          },
          {
            "type": "context",
            "line": "           Range: 'bytes=13-240',"
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "delete",
            "line": "      }).then(response => {"
          },
          {
            "type": "delete",
            "line": "        expect(response.status).toBe(404);"
          },
          {
            "type": "delete",
            "line": "        const body = response.text;"
          },
          {
            "type": "delete",
            "line": "        expect(body).toEqual('File not found.');"
          },
          {
            "type": "delete",
            "line": "        done();"
          },
          {
            "type": "delete",
            "line": "      });"
          },
          {
            "type": "add",
            "line": "      }).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(response.status).toBe(404);"
          },
          {
            "type": "add",
            "line": "      const body = response.text;"
          },
          {
            "type": "add",
            "line": "      expect(body).toEqual('File not found.');"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/Adapters/Files/GridFSBucketAdapter.js",
        "changes": [
          {
            "type": "context",
            "line": "index 06896e73..8ff4d2b8 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Adapters/Files/GridFSBucketAdapter.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/Adapters/Files/GridFSBucketAdapter.js"
          },
          {
            "type": "context",
            "line": "     const partialstart = parts[0];"
          },
          {
            "type": "context",
            "line": "     const partialend = parts[1];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    const start = parseInt(partialstart, 10);"
          },
          {
            "type": "delete",
            "line": "    const end = partialend ? parseInt(partialend, 10) : files[0].length - 1;"
          },
          {
            "type": "add",
            "line": "    const fileLength = files[0].length;"
          },
          {
            "type": "add",
            "line": "    const fileStart = parseInt(partialstart, 10);"
          },
          {
            "type": "add",
            "line": "    const fileEnd = partialend ? parseInt(partialend, 10) : fileLength;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    res.writeHead(206, {"
          },
          {
            "type": "delete",
            "line": "      'Accept-Ranges': 'bytes',"
          },
          {
            "type": "delete",
            "line": "      'Content-Length': end - start + 1,"
          },
          {
            "type": "delete",
            "line": "      'Content-Range': 'bytes ' + start + '-' + end + '/' + files[0].length,"
          },
          {
            "type": "delete",
            "line": "      'Content-Type': contentType,"
          },
          {
            "type": "delete",
            "line": "    });"
          },
          {
            "type": "add",
            "line": "    let start = Math.min(fileStart || 0, fileEnd, fileLength);"
          },
          {
            "type": "add",
            "line": "    let end = Math.max(fileStart || 0, fileEnd) + 1 || fileLength;"
          },
          {
            "type": "add",
            "line": "    if (isNaN(fileStart)) {"
          },
          {
            "type": "add",
            "line": "      start = fileLength - end + 1;"
          },
          {
            "type": "add",
            "line": "      end = fileLength;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    end = Math.min(end, fileLength);"
          },
          {
            "type": "add",
            "line": "    start = Math.max(start, 0);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    res.status(206);"
          },
          {
            "type": "add",
            "line": "    res.header('Accept-Ranges', 'bytes');"
          },
          {
            "type": "add",
            "line": "    res.header('Content-Length', end - start);"
          },
          {
            "type": "add",
            "line": "    res.header('Content-Range', 'bytes ' + start + '-' + end + '/' + fileLength);"
          },
          {
            "type": "add",
            "line": "    res.header('Content-Type', contentType);"
          },
          {
            "type": "context",
            "line": "     const stream = bucket.openDownloadStreamByName(filename);"
          },
          {
            "type": "context",
            "line": "     stream.start(start);"
          },
          {
            "type": "add",
            "line": "    if (end) {"
          },
          {
            "type": "add",
            "line": "      stream.end(end);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     stream.on('data', chunk => {"
          },
          {
            "type": "context",
            "line": "       res.write(chunk);"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "delete",
            "line": "    stream.on('error', () => {"
          },
          {
            "type": "delete",
            "line": "      res.sendStatus(404);"
          },
          {
            "type": "add",
            "line": "    stream.on('error', (e) => {"
          },
          {
            "type": "add",
            "line": "      res.status(404);"
          },
          {
            "type": "add",
            "line": "      res.send(e.message);"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": "     stream.on('end', () => {"
          },
          {
            "type": "context",
            "line": "       res.end();"
          }
        ]
      },
      {
        "file": "src/Routers/FilesRouter.js",
        "changes": [
          {
            "type": "context",
            "line": "index bdd86ae5..a828f7ad 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Routers/FilesRouter.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/Routers/FilesRouter.js"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " function isFileStreamable(req, filesController) {"
          },
          {
            "type": "delete",
            "line": "  return req.get('Range') && typeof filesController.adapter.handleFileStream === 'function';"
          },
          {
            "type": "add",
            "line": "  const range = (req.get('Range') || '/-/').split('-');"
          },
          {
            "type": "add",
            "line": "  const start = Number(range[0]);"
          },
          {
            "type": "add",
            "line": "  const end = Number(range[1]);"
          },
          {
            "type": "add",
            "line": "  return ("
          },
          {
            "type": "add",
            "line": "    (!isNaN(start) || !isNaN(end)) && typeof filesController.adapter.handleFileStream === 'function'"
          },
          {
            "type": "add",
            "line": "  );"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "068b963bb7afc57f5bdd723de0dd15e7795d5822",
    "files": [
      {
        "file": "crypto/x509v3/v3_addr.c",
        "changes": [
          {
            "type": "context",
            "line": "index ef1d775ac9..c5183a1790 100644"
          },
          {
            "type": "context",
            "line": "--- a/crypto/x509v3/v3_addr.c"
          },
          {
            "type": "context",
            "line": "+++ b/crypto/x509v3/v3_addr.c"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " unsigned int X509v3_addr_get_afi(const IPAddressFamily *f)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    return ((f != NULL &&"
          },
          {
            "type": "delete",
            "line": "             f->addressFamily != NULL && f->addressFamily->data != NULL)"
          },
          {
            "type": "delete",
            "line": "            ? ((f->addressFamily->data[0] << 8) | (f->addressFamily->data[1]))"
          },
          {
            "type": "delete",
            "line": "            : 0);"
          },
          {
            "type": "add",
            "line": "    if (f == NULL"
          },
          {
            "type": "add",
            "line": "            || f->addressFamily == NULL"
          },
          {
            "type": "add",
            "line": "            || f->addressFamily->data == NULL"
          },
          {
            "type": "add",
            "line": "            || f->addressFamily->length < 2)"
          },
          {
            "type": "add",
            "line": "        return 0;"
          },
          {
            "type": "add",
            "line": "    return (f->addressFamily->data[0] << 8) | f->addressFamily->data[1];"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          }
        ]
      }
    ]
  },
  {
    "commit": "06b6a1cf6e776426766298d055bb3991957d90a7",
    "files": [
      {
        "file": "net/rds/recv.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5c6e9f132026..9f0f17cf6bf9 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/rds/recv.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/rds/recv.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \trdsdebug(\"size %zu flags 0x%x timeo %ld\\n\", size, msg_flags, timeo);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tmsg->msg_namelen = 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (msg_flags & MSG_OOB)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tsin->sin_port = inc->i_hdr.h_sport;"
          },
          {
            "type": "context",
            "line": " \t\t\tsin->sin_addr.s_addr = inc->i_saddr;"
          },
          {
            "type": "context",
            "line": " \t\t\tmemset(sin->sin_zero, 0, sizeof(sin->sin_zero));"
          },
          {
            "type": "add",
            "line": "\t\t\tmsg->msg_namelen = sizeof(*sin);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "06bd3c36a733ac27962fea7d6f47168841376824",
    "files": [
      {
        "file": "fs/ext4/inode.c",
        "changes": [
          {
            "type": "context",
            "line": "index 981a1fc30eaa..250c2df04a92 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ext4/inode.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ext4/inode.c"
          },
          {
            "type": "context",
            "line": " \t\tret = check_block_validity(inode, map);"
          },
          {
            "type": "context",
            "line": " \t\tif (ret != 0)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn ret;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t * Inodes with freshly allocated blocks where contents will be"
          },
          {
            "type": "add",
            "line": "\t\t * visible after transaction commit must be on transaction's"
          },
          {
            "type": "add",
            "line": "\t\t * ordered data list."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\tif (map->m_flags & EXT4_MAP_NEW &&"
          },
          {
            "type": "add",
            "line": "\t\t    !(map->m_flags & EXT4_MAP_UNWRITTEN) &&"
          },
          {
            "type": "add",
            "line": "\t\t    !(flags & EXT4_GET_BLOCKS_ZERO) &&"
          },
          {
            "type": "add",
            "line": "\t\t    !IS_NOQUOTA(inode) &&"
          },
          {
            "type": "add",
            "line": "\t\t    ext4_should_order_data(inode)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tret = ext4_jbd2_file_inode(handle, inode);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (ret)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn ret;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn retval;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \tint i_size_changed = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ttrace_ext4_write_end(inode, pos, len, copied);"
          },
          {
            "type": "delete",
            "line": "\tif (ext4_test_inode_state(inode, EXT4_STATE_ORDERED_MODE)) {"
          },
          {
            "type": "delete",
            "line": "\t\tret = ext4_jbd2_file_inode(handle, inode);"
          },
          {
            "type": "delete",
            "line": "\t\tif (ret) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tunlock_page(page);"
          },
          {
            "type": "delete",
            "line": "\t\t\tput_page(page);"
          },
          {
            "type": "delete",
            "line": "\t\t\tgoto errout;"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (ext4_has_inline_data(inode)) {"
          },
          {
            "type": "context",
            "line": " \t\tret = ext4_write_inline_data_end(inode, pos, len,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t copied, page);"
          }
        ]
      }
    ]
  },
  {
    "commit": "06c8173eb92bbfc03a0fe8bb64315857d0badd06",
    "files": [
      {
        "file": "arch/x86/include/asm/xsave.h",
        "changes": [
          {
            "type": "context",
            "line": "index 5fa9770035dc..c9a6d68b8d62 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/include/asm/xsave.h"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/include/asm/xsave.h"
          },
          {
            "type": "context",
            "line": " \tif (boot_cpu_has(X86_FEATURE_XSAVES))"
          },
          {
            "type": "context",
            "line": " \t\tasm volatile(\"1:\"XSAVES\"\\n\\t\""
          },
          {
            "type": "context",
            "line": " \t\t\t\"2:\\n\\t\""
          },
          {
            "type": "delete",
            "line": "\t\t\t: : \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "add",
            "line": "\t\t\t     xstate_fault"
          },
          {
            "type": "add",
            "line": "\t\t\t: \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "context",
            "line": " \t\t\t:   \"memory\");"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\tasm volatile(\"1:\"XSAVE\"\\n\\t\""
          },
          {
            "type": "context",
            "line": " \t\t\t\"2:\\n\\t\""
          },
          {
            "type": "delete",
            "line": "\t\t\t: : \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "add",
            "line": "\t\t\t     xstate_fault"
          },
          {
            "type": "add",
            "line": "\t\t\t: \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "context",
            "line": " \t\t\t:   \"memory\");"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tasm volatile(xstate_fault"
          },
          {
            "type": "delete",
            "line": "\t\t     : \"0\" (0)"
          },
          {
            "type": "delete",
            "line": "\t\t     : \"memory\");"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn err;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (boot_cpu_has(X86_FEATURE_XSAVES))"
          },
          {
            "type": "context",
            "line": " \t\tasm volatile(\"1:\"XRSTORS\"\\n\\t\""
          },
          {
            "type": "context",
            "line": " \t\t\t\"2:\\n\\t\""
          },
          {
            "type": "delete",
            "line": "\t\t\t: : \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "add",
            "line": "\t\t\t     xstate_fault"
          },
          {
            "type": "add",
            "line": "\t\t\t: \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "context",
            "line": " \t\t\t:   \"memory\");"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\tasm volatile(\"1:\"XRSTOR\"\\n\\t\""
          },
          {
            "type": "context",
            "line": " \t\t\t\"2:\\n\\t\""
          },
          {
            "type": "delete",
            "line": "\t\t\t: : \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "add",
            "line": "\t\t\t     xstate_fault"
          },
          {
            "type": "add",
            "line": "\t\t\t: \"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "context",
            "line": " \t\t\t:   \"memory\");"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tasm volatile(xstate_fault"
          },
          {
            "type": "delete",
            "line": "\t\t     : \"0\" (0)"
          },
          {
            "type": "delete",
            "line": "\t\t     : \"memory\");"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn err;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \talternative_input_2("
          },
          {
            "type": "context",
            "line": " \t\t\"1:\"XSAVE,"
          },
          {
            "type": "delete",
            "line": "\t\t\"1:\"XSAVEOPT,"
          },
          {
            "type": "add",
            "line": "\t\tXSAVEOPT,"
          },
          {
            "type": "context",
            "line": " \t\tX86_FEATURE_XSAVEOPT,"
          },
          {
            "type": "delete",
            "line": "\t\t\"1:\"XSAVES,"
          },
          {
            "type": "add",
            "line": "\t\tXSAVES,"
          },
          {
            "type": "context",
            "line": " \t\tX86_FEATURE_XSAVES,"
          },
          {
            "type": "context",
            "line": " \t\t[fx] \"D\" (fx), \"a\" (lmask), \"d\" (hmask) :"
          },
          {
            "type": "context",
            "line": " \t\t\"memory\");"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \talternative_input("
          },
          {
            "type": "context",
            "line": " \t\t\"1: \" XRSTOR,"
          },
          {
            "type": "delete",
            "line": "\t\t\"1: \" XRSTORS,"
          },
          {
            "type": "add",
            "line": "\t\tXRSTORS,"
          },
          {
            "type": "context",
            "line": " \t\tX86_FEATURE_XSAVES,"
          },
          {
            "type": "context",
            "line": " \t\t\"D\" (fx), \"m\" (*fx), \"a\" (lmask), \"d\" (hmask)"
          },
          {
            "type": "context",
            "line": " \t\t: \"memory\");"
          }
        ]
      }
    ]
  },
  {
    "commit": "06deeec77a5a689cc94b21a8a91a76e42176685d",
    "files": [
      {
        "file": "fs/cifs/smbencrypt.c",
        "changes": [
          {
            "type": "context",
            "line": "index 699b7868108f..c12bffefa3c9 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/cifs/smbencrypt.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/cifs/smbencrypt.c"
          },
          {
            "type": "context",
            "line": "    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA."
          },
          {
            "type": "context",
            "line": " */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "#include <crypto/skcipher.h>"
          },
          {
            "type": "add",
            "line": "#include <linux/crypto.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/module.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/slab.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/fs.h>"
          },
          {
            "type": "context",
            "line": " static int"
          },
          {
            "type": "context",
            "line": " smbhash(unsigned char *out, const unsigned char *in, unsigned char *key)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tint rc;"
          },
          {
            "type": "context",
            "line": " \tunsigned char key2[8];"
          },
          {
            "type": "delete",
            "line": "\tstruct crypto_skcipher *tfm_des;"
          },
          {
            "type": "delete",
            "line": "\tstruct scatterlist sgin, sgout;"
          },
          {
            "type": "delete",
            "line": "\tstruct skcipher_request *req;"
          },
          {
            "type": "add",
            "line": "\tstruct crypto_cipher *tfm_des;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstr_to_key(key, key2);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\ttfm_des = crypto_alloc_skcipher(\"ecb(des)\", 0, CRYPTO_ALG_ASYNC);"
          },
          {
            "type": "add",
            "line": "\ttfm_des = crypto_alloc_cipher(\"des\", 0, 0);"
          },
          {
            "type": "context",
            "line": " \tif (IS_ERR(tfm_des)) {"
          },
          {
            "type": "delete",
            "line": "\t\trc = PTR_ERR(tfm_des);"
          },
          {
            "type": "delete",
            "line": "\t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");"
          },
          {
            "type": "delete",
            "line": "\t\tgoto smbhash_err;"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\treq = skcipher_request_alloc(tfm_des, GFP_KERNEL);"
          },
          {
            "type": "delete",
            "line": "\tif (!req) {"
          },
          {
            "type": "delete",
            "line": "\t\trc = -ENOMEM;"
          },
          {
            "type": "context",
            "line": " \t\tcifs_dbg(VFS, \"could not allocate des crypto API\\n\");"
          },
          {
            "type": "delete",
            "line": "\t\tgoto smbhash_free_skcipher;"
          },
          {
            "type": "add",
            "line": "\t\treturn PTR_ERR(tfm_des);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tcrypto_skcipher_setkey(tfm_des, key2, 8);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tsg_init_one(&sgin, in, 8);"
          },
          {
            "type": "delete",
            "line": "\tsg_init_one(&sgout, out, 8);"
          },
          {
            "type": "add",
            "line": "\tcrypto_cipher_setkey(tfm_des, key2, 8);"
          },
          {
            "type": "add",
            "line": "\tcrypto_cipher_encrypt_one(tfm_des, out, in);"
          },
          {
            "type": "add",
            "line": "\tcrypto_free_cipher(tfm_des);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tskcipher_request_set_callback(req, 0, NULL, NULL);"
          },
          {
            "type": "delete",
            "line": "\tskcipher_request_set_crypt(req, &sgin, &sgout, 8, NULL);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\trc = crypto_skcipher_encrypt(req);"
          },
          {
            "type": "delete",
            "line": "\tif (rc)"
          },
          {
            "type": "delete",
            "line": "\t\tcifs_dbg(VFS, \"could not encrypt crypt key rc: %d\\n\", rc);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tskcipher_request_free(req);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "smbhash_free_skcipher:"
          },
          {
            "type": "delete",
            "line": "\tcrypto_free_skcipher(tfm_des);"
          },
          {
            "type": "delete",
            "line": "smbhash_err:"
          },
          {
            "type": "delete",
            "line": "\treturn rc;"
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int"
          }
        ]
      }
    ]
  },
  {
    "commit": "0720a06a7518c9d0c0125bd5d1f3b6264c55c3dd",
    "files": [
      {
        "file": "drivers/hv/hv_kvp.c",
        "changes": [
          {
            "type": "context",
            "line": "index 89f52440fcf4..0e8343f585bb 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/hv/hv_kvp.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/hv/hv_kvp.c"
          },
          {
            "type": "context",
            "line": " \t * The windows host expects the key/value pair to be encoded"
          },
          {
            "type": "context",
            "line": " \t * in utf16."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "delete",
            "line": "\tkeylen = utf8s_to_utf16s(key_name, strlen(key_name),"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t(wchar_t *)kvp_data->data.key);"
          },
          {
            "type": "add",
            "line": "\tkeylen = utf8s_to_utf16s(key_name, strlen(key_name), UTF16_HOST_ENDIAN,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t(wchar_t *) kvp_data->data.key,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tHV_KVP_EXCHANGE_MAX_KEY_SIZE / 2);"
          },
          {
            "type": "context",
            "line": " \tkvp_data->data.key_size = 2*(keylen + 1); /* utf16 encoding */"
          },
          {
            "type": "delete",
            "line": "\tvaluelen = utf8s_to_utf16s(value, strlen(value),"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t(wchar_t *)kvp_data->data.value);"
          },
          {
            "type": "add",
            "line": "\tvaluelen = utf8s_to_utf16s(value, strlen(value), UTF16_HOST_ENDIAN,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t(wchar_t *) kvp_data->data.value,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tHV_KVP_EXCHANGE_MAX_VALUE_SIZE / 2);"
          },
          {
            "type": "context",
            "line": " \tkvp_data->data.value_size = 2*(valuelen + 1); /* utf16 encoding */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tkvp_data->data.value_type = REG_SZ; /* all our values are strings */"
          }
        ]
      },
      {
        "file": "fs/fat/namei_vfat.c",
        "changes": [
          {
            "type": "context",
            "line": "index a87a65663c25..c25cf151b84b 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/fat/namei_vfat.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/fat/namei_vfat.c"
          },
          {
            "type": "context",
            "line": " \tint charlen;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (utf8) {"
          },
          {
            "type": "delete",
            "line": "\t\t*outlen = utf8s_to_utf16s(name, len, (wchar_t *)outname);"
          },
          {
            "type": "add",
            "line": "\t\t*outlen = utf8s_to_utf16s(name, len, UTF16_HOST_ENDIAN,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t(wchar_t *) outname, FAT_LFN_LEN + 2);"
          },
          {
            "type": "context",
            "line": " \t\tif (*outlen < 0)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn *outlen;"
          },
          {
            "type": "context",
            "line": " \t\telse if (*outlen > FAT_LFN_LEN)"
          }
        ]
      },
      {
        "file": "fs/nls/nls_base.c",
        "changes": [
          {
            "type": "context",
            "line": "index 44a88a9fa2c8..0eb059ec6f28 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/nls/nls_base.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/nls/nls_base.c"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(utf32_to_utf8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "int utf8s_to_utf16s(const u8 *s, int len, wchar_t *pwcs)"
          },
          {
            "type": "add",
            "line": "static inline void put_utf16(wchar_t *s, unsigned c, enum utf16_endian endian)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tswitch (endian) {"
          },
          {
            "type": "add",
            "line": "\tdefault:"
          },
          {
            "type": "add",
            "line": "\t\t*s = (wchar_t) c;"
          },
          {
            "type": "add",
            "line": "\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\tcase UTF16_LITTLE_ENDIAN:"
          },
          {
            "type": "add",
            "line": "\t\t*s = __cpu_to_le16(c);"
          },
          {
            "type": "add",
            "line": "\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\tcase UTF16_BIG_ENDIAN:"
          },
          {
            "type": "add",
            "line": "\t\t*s = __cpu_to_be16(c);"
          },
          {
            "type": "add",
            "line": "\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "int utf8s_to_utf16s(const u8 *s, int len, enum utf16_endian endian,"
          },
          {
            "type": "add",
            "line": "\t\twchar_t *pwcs, int maxlen)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tu16 *op;"
          },
          {
            "type": "context",
            "line": " \tint size;"
          },
          {
            "type": "context",
            "line": " \tunicode_t u;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \top = pwcs;"
          },
          {
            "type": "delete",
            "line": "\twhile (*s && len > 0) {"
          },
          {
            "type": "add",
            "line": "\twhile (len > 0 && maxlen > 0 && *s) {"
          },
          {
            "type": "context",
            "line": " \t\tif (*s & 0x80) {"
          },
          {
            "type": "context",
            "line": " \t\t\tsize = utf8_to_utf32(s, len, &u);"
          },
          {
            "type": "context",
            "line": " \t\t\tif (size < 0)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\t\ts += size;"
          },
          {
            "type": "add",
            "line": "\t\t\tlen -= size;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tif (u >= PLANE_SIZE) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (maxlen < 2)"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\t\t\tu -= PLANE_SIZE;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t*op++ = (wchar_t) (SURROGATE_PAIR |"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t((u >> 10) & SURROGATE_BITS));"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t*op++ = (wchar_t) (SURROGATE_PAIR |"
          },
          {
            "type": "add",
            "line": "\t\t\t\tput_utf16(op++, SURROGATE_PAIR |"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t((u >> 10) & SURROGATE_BITS),"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\tendian);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tput_utf16(op++, SURROGATE_PAIR |"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\tSURROGATE_LOW |"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t(u & SURROGATE_BITS));"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t(u & SURROGATE_BITS),"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\tendian);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tmaxlen -= 2;"
          },
          {
            "type": "context",
            "line": " \t\t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t*op++ = (wchar_t) u;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tput_utf16(op++, u, endian);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tmaxlen--;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\ts += size;"
          },
          {
            "type": "delete",
            "line": "\t\t\tlen -= size;"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\t*op++ = *s++;"
          },
          {
            "type": "add",
            "line": "\t\t\tput_utf16(op++, *s++, endian);"
          },
          {
            "type": "context",
            "line": " \t\t\tlen--;"
          },
          {
            "type": "add",
            "line": "\t\t\tmaxlen--;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn op - pwcs;"
          }
        ]
      },
      {
        "file": "include/linux/nls.h",
        "changes": [
          {
            "type": "context",
            "line": "index d47beef08dfd..5dc635f8d79e 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/nls.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/nls.h"
          },
          {
            "type": "context",
            "line": " \tUTF16_BIG_ENDIAN"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "/* nls.c */"
          },
          {
            "type": "add",
            "line": "/* nls_base.c */"
          },
          {
            "type": "context",
            "line": " extern int register_nls(struct nls_table *);"
          },
          {
            "type": "context",
            "line": " extern int unregister_nls(struct nls_table *);"
          },
          {
            "type": "context",
            "line": " extern struct nls_table *load_nls(char *);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " extern int utf8_to_utf32(const u8 *s, int len, unicode_t *pu);"
          },
          {
            "type": "context",
            "line": " extern int utf32_to_utf8(unicode_t u, u8 *s, int maxlen);"
          },
          {
            "type": "delete",
            "line": "extern int utf8s_to_utf16s(const u8 *s, int len, wchar_t *pwcs);"
          },
          {
            "type": "add",
            "line": "extern int utf8s_to_utf16s(const u8 *s, int len,"
          },
          {
            "type": "add",
            "line": "\t\tenum utf16_endian endian, wchar_t *pwcs, int maxlen);"
          },
          {
            "type": "context",
            "line": " extern int utf16s_to_utf8s(const wchar_t *pwcs, int len,"
          },
          {
            "type": "context",
            "line": " \t\tenum utf16_endian endian, u8 *s, int maxlen);"
          }
        ]
      }
    ]
  },
  {
    "commit": "072684e8c58d17e853f8e8b9f6d9ce2e58d2b036",
    "files": [
      {
        "file": "drivers/usgadget/function/f_hid.c",
        "changes": [
          {
            "type": "context",
            "line": "index 75b113a5b25c..f3816a5c861e 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/usb/gadget/function/f_hid.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/usb/gadget/function/f_hid.c"
          },
          {
            "type": "context",
            "line": " \treq->complete = f_hidg_req_complete;"
          },
          {
            "type": "context",
            "line": " \treq->context  = hidg;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tspin_unlock_irqrestore(&hidg->write_spinlock, flags);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstatus = usb_ep_queue(hidg->in_ep, req, GFP_ATOMIC);"
          },
          {
            "type": "context",
            "line": " \tif (status < 0) {"
          },
          {
            "type": "context",
            "line": " \t\tERROR(hidg->func.config->cdev,"
          },
          {
            "type": "context",
            "line": " \t\t\t\"usb_ep_queue error on int endpoint %zd\\n\", status);"
          },
          {
            "type": "delete",
            "line": "\t\tgoto release_write_pending_unlocked;"
          },
          {
            "type": "add",
            "line": "\t\tgoto release_write_pending;"
          },
          {
            "type": "context",
            "line": " \t} else {"
          },
          {
            "type": "context",
            "line": " \t\tstatus = count;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tspin_unlock_irqrestore(&hidg->write_spinlock, flags);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn status;"
          },
          {
            "type": "context",
            "line": " release_write_pending:"
          },
          {
            "type": "context",
            "line": " \tspin_lock_irqsave(&hidg->write_spinlock, flags);"
          },
          {
            "type": "delete",
            "line": "release_write_pending_unlocked:"
          },
          {
            "type": "context",
            "line": " \thidg->write_pending = 0;"
          },
          {
            "type": "context",
            "line": " \tspin_unlock_irqrestore(&hidg->write_spinlock, flags);"
          }
        ]
      }
    ]
  },
  {
    "commit": "073661142369a0a66c25775cc3870582a679ef8b",
    "files": [
      {
        "file": "app/models/topic.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 0d824b5576..d8f458f972 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/models/topic.rb"
          },
          {
            "type": "context",
            "line": "+++ b/app/models/topic.rb"
          },
          {
            "type": "context",
            "line": "     private_message? && all_allowed_users.count > 2"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  def visible_tags(guardian)"
          },
          {
            "type": "add",
            "line": "    tags.reject { |tag| guardian.hidden_tag_names.include?(tag[:name]) }"
          },
          {
            "type": "add",
            "line": "  end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   private"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def invite_to_private_message(invited_by, target_user, guardian)"
          }
        ]
      },
      {
        "file": "app/serializers/concerns/topic_tags_mixin.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 0c001d4633..493ec0f6cc 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/serializers/concerns/topic_tags_mixin.rb"
          },
          {
            "type": "context",
            "line": "+++ b/app/serializers/concerns/topic_tags_mixin.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def all_tags"
          },
          {
            "type": "context",
            "line": "     return @tags if defined?(@tags)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    tags = topic.visible_tags(scope)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # Calling method `pluck` or `order` along with `includes` causing N+1 queries"
          },
          {
            "type": "context",
            "line": "     tags ="
          },
          {
            "type": "context",
            "line": "       ("
          },
          {
            "type": "context",
            "line": "         if SiteSetting.tags_sort_alphabetically"
          },
          {
            "type": "delete",
            "line": "          topic.tags.sort_by(&:name)"
          },
          {
            "type": "add",
            "line": "          tags.sort_by(&:name)"
          },
          {
            "type": "context",
            "line": "         else"
          },
          {
            "type": "context",
            "line": "           topic_count_column = Tag.topic_count_column(scope)"
          },
          {
            "type": "delete",
            "line": "          topic.tags.sort_by { |tag| tag.public_send(topic_count_column) }.reverse"
          },
          {
            "type": "add",
            "line": "          tags.sort_by { |tag| tag.public_send(topic_count_column) }.reverse"
          },
          {
            "type": "context",
            "line": "         end"
          },
          {
            "type": "context",
            "line": "       )"
          },
          {
            "type": "delete",
            "line": "    tags = tags.reject { |tag| scope.hidden_tag_names.include?(tag[:name]) } if !scope.is_staff?"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @tags = tags"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": " end"
          }
        ]
      },
      {
        "file": "app/views/list/list.erb",
        "changes": [
          {
            "type": "context",
            "line": "index e2b6a3471a..e322560d23 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/views/list/list.erb"
          },
          {
            "type": "context",
            "line": "+++ b/app/views/list/list.erb"
          },
          {
            "type": "context",
            "line": "                   </span>"
          },
          {
            "type": "context",
            "line": "                 </a>"
          },
          {
            "type": "context",
            "line": "               <% end %>"
          },
          {
            "type": "delete",
            "line": "              <% if t.tags %>"
          },
          {
            "type": "add",
            "line": "              <% if tags = t.visible_tags(guardian) %>"
          },
          {
            "type": "context",
            "line": "                 <div class=\"discourse-tags\">"
          },
          {
            "type": "delete",
            "line": "                  <% t.tags.each_with_index do |tag, index| %>"
          },
          {
            "type": "add",
            "line": "                  <% tags.each_with_index do |tag, index| %>"
          },
          {
            "type": "context",
            "line": "                     <a href='<%= tag.full_url %>' class='discourse-tag'><%= tag.name %></a>"
          },
          {
            "type": "delete",
            "line": "                    <% if index < t.tags.size - 1 %>,&nbsp;<% end %>"
          },
          {
            "type": "add",
            "line": "                    <% if index < tags.size - 1 %>,&nbsp;<% end %>"
          },
          {
            "type": "context",
            "line": "                   <% end %>"
          },
          {
            "type": "context",
            "line": "                 </div>"
          },
          {
            "type": "context",
            "line": "               <% end %>"
          }
        ]
      },
      {
        "file": "spec/requests/list_controller_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 7a7682dc3f..e332bdfa85 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/requests/list_controller_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/requests/list_controller_spec.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       expect(new_sql_queries_count).to be <= initial_sql_queries_count"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    context \"with topics with tags\" do"
          },
          {
            "type": "add",
            "line": "      let(:tag_group) { Fabricate.build(:tag_group) }"
          },
          {
            "type": "add",
            "line": "      let(:tag_group_permission) { Fabricate.build(:tag_group_permission, tag_group: tag_group) }"
          },
          {
            "type": "add",
            "line": "      let(:restricted_tag) { Fabricate(:tag) }"
          },
          {
            "type": "add",
            "line": "      let(:public_tag) { Fabricate(:tag) }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      before do"
          },
          {
            "type": "add",
            "line": "        tag_group.tag_group_permissions << tag_group_permission"
          },
          {
            "type": "add",
            "line": "        tag_group.save!"
          },
          {
            "type": "add",
            "line": "        tag_group_permission.tag_group.tags << restricted_tag"
          },
          {
            "type": "add",
            "line": "        topic.tags << [public_tag, restricted_tag]"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"does not show hidden tags\" do"
          },
          {
            "type": "add",
            "line": "        get \"/latest\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        expect(response.status).to eq(200)"
          },
          {
            "type": "add",
            "line": "        expect(response.body).to include(public_tag.name)"
          },
          {
            "type": "add",
            "line": "        expect(response.body).not_to include(restricted_tag.name)"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   describe \"categories and X\" do"
          }
        ]
      }
    ]
  },
  {
    "commit": "073931017b49d9458aa351605b43a7e34598caef",
    "files": [
      {
        "file": "fs/9p/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5b6a1743ea17..b3c2cc79c20d 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/9p/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/9p/acl.c"
          },
          {
            "type": "context",
            "line": " \tswitch (handler->flags) {"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "delete",
            "line": "\t\t\tretval = posix_acl_equiv_mode(acl, &mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (retval < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tstruct iattr iattr;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tretval = posix_acl_update_mode(inode, &iattr.ia_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (retval)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tgoto err_out;"
          },
          {
            "type": "delete",
            "line": "\t\t\telse {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tstruct iattr iattr;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (retval == 0) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t/*"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t * ACL can be represented"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t * by the mode bits. So don't"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t * update ACL."
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t */"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tacl = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tvalue = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tsize = 0;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t/* Updte the mode bits */"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tiattr.ia_mode = ((mode & S_IALLUGO) |"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t (inode->i_mode & ~S_IALLUGO));"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tiattr.ia_valid = ATTR_MODE;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t/* FIXME should we update ctime ?"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t * What is the following setxattr update the"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t * mode ?"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!acl) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * ACL can be represented"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * by the mode bits. So don't"
          },
          {
            "type": "add",
            "line": "\t\t\t\t * update ACL."
          },
          {
            "type": "context",
            "line": " \t\t\t\t */"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tv9fs_vfs_setattr_dotl(dentry, &iattr);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tvalue = NULL;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tsize = 0;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\tiattr.ia_valid = ATTR_MODE;"
          },
          {
            "type": "add",
            "line": "\t\t\t/* FIXME should we update ctime ?"
          },
          {
            "type": "add",
            "line": "\t\t\t * What is the following setxattr update the"
          },
          {
            "type": "add",
            "line": "\t\t\t * mode ?"
          },
          {
            "type": "add",
            "line": "\t\t\t */"
          },
          {
            "type": "add",
            "line": "\t\t\tv9fs_vfs_setattr_dotl(dentry, &iattr);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_DEFAULT:"
          }
        ]
      },
      {
        "file": "fs/btrfs/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 53bb7af4e5f0..247b8dfaf6e5 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname = XATTR_NAME_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tret = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ret < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tret = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (ret)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn ret;"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ret == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tret = 0;"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          }
        ]
      },
      {
        "file": "fs/ceph/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4f67227f69a5..d0b6b342dff9 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ceph/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ceph/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname = XATTR_NAME_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tret = posix_acl_equiv_mode(acl, &new_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ret < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tret = posix_acl_update_mode(inode, &new_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (ret)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tgoto out;"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ret == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_DEFAULT:"
          }
        ]
      },
      {
        "file": "fs/ext2/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 42f1d1814083..e725aa0890e0 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ext2/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ext2/acl.c"
          },
          {
            "type": "context",
            "line": " \t\tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\t\tname_index = EXT2_XATTR_INDEX_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\terror = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\t\terror = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (error)"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\treturn error;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\telse {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tinode->i_ctime = CURRENT_TIME_SEC;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tmark_inode_dirty(inode);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tif (error == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\tacl = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t\tinode->i_ctime = CURRENT_TIME_SEC;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tmark_inode_dirty(inode);"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "fs/ext4/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index c6601a476c02..dfa519979038 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ext4/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ext4/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname_index = EXT4_XATTR_INDEX_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\terror = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\terror = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (error)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn error;"
          },
          {
            "type": "delete",
            "line": "\t\t\telse {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tinode->i_ctime = ext4_current_time(inode);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\text4_mark_inode_dirty(handle, inode);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (error == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tacl = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\tinode->i_ctime = ext4_current_time(inode);"
          },
          {
            "type": "add",
            "line": "\t\t\text4_mark_inode_dirty(handle, inode);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "fs/f2fs/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4dcc9e28dc5c..31344247ce89 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/f2fs/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/f2fs/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname_index = F2FS_XATTR_INDEX_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\terror = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\terror = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (error)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn error;"
          },
          {
            "type": "context",
            "line": " \t\t\tset_acl_inode(inode, inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "fs/gfs2/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 363ba9e9d8d0..2524807ee070 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/gfs2/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/gfs2/acl.c"
          },
          {
            "type": "context",
            "line": " \tif (type == ACL_TYPE_ACCESS) {"
          },
          {
            "type": "context",
            "line": " \t\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\terror = posix_acl_equiv_mode(acl, &mode);"
          },
          {
            "type": "delete",
            "line": "\t\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\terror = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\tif (error)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn error;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (error == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\tacl = NULL;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (mode != inode->i_mode) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tinode->i_mode = mode;"
          },
          {
            "type": "add",
            "line": "\t\tif (mode != inode->i_mode)"
          },
          {
            "type": "context",
            "line": " \t\t\tmark_inode_dirty(inode);"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (acl) {"
          }
        ]
      },
      {
        "file": "fs/hfsplus/posix_acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index ab7ea2506b4d..9b92058a1240 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/hfsplus/posix_acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/hfsplus/posix_acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\txattr_name = XATTR_NAME_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\terr = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (err < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\terr = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (err)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn err;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\terr = 0;"
          }
        ]
      },
      {
        "file": "fs/jffs2/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index bc2693d56298..2a0f2a1044c1 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/jffs2/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/jffs2/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\txprefix = JFFS2_XPREFIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "delete",
            "line": "\t\t\trc = posix_acl_equiv_mode(acl, &mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (rc < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tumode_t mode;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\trc = posix_acl_update_mode(inode, &mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (rc)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn rc;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (inode->i_mode != mode) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tstruct iattr attr;"
          },
          {
            "type": "context",
            "line": " \t\t\t\tif (rc < 0)"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\treturn rc;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (rc == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_DEFAULT:"
          }
        ]
      },
      {
        "file": "fs/jfs/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 21fa92ba2c19..3a1e1554a4e3 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/jfs/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/jfs/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tea_name = XATTR_NAME_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\trc = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (rc < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\trc = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (rc)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn rc;"
          },
          {
            "type": "context",
            "line": " \t\t\tinode->i_ctime = CURRENT_TIME;"
          },
          {
            "type": "context",
            "line": " \t\t\tmark_inode_dirty(inode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (rc == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_DEFAULT:"
          }
        ]
      },
      {
        "file": "fs/ocfs2/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 2162434728c0..164307b99405 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ocfs2/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ocfs2/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname_index = OCFS2_XATTR_INDEX_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "delete",
            "line": "\t\t\tret = posix_acl_equiv_mode(acl, &mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ret < 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn ret;"
          },
          {
            "type": "add",
            "line": "\t\t\tumode_t mode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ret == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "add",
            "line": "\t\t\tret = posix_acl_update_mode(inode, &mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (ret)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn ret;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tret = ocfs2_acl_set_mode(inode, di_bh,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t handle, mode);"
          }
        ]
      },
      {
        "file": "fs/orangefs/acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 28f2195cd798..7a3754488312 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/orangefs/acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/orangefs/acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname = XATTR_NAME_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "delete",
            "line": "\t\t\t/*"
          },
          {
            "type": "delete",
            "line": "\t\t\t * can we represent this with the traditional file"
          },
          {
            "type": "delete",
            "line": "\t\t\t * mode permission bits?"
          },
          {
            "type": "delete",
            "line": "\t\t\t */"
          },
          {
            "type": "delete",
            "line": "\t\t\terror = posix_acl_equiv_mode(acl, &mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error < 0) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tgossip_err(\"%s: posix_acl_equiv_mode err: %d\\n\","
          },
          {
            "type": "add",
            "line": "\t\t\tumode_t mode;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\terror = posix_acl_update_mode(inode, &mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (error) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tgossip_err(\"%s: posix_acl_update_mode err: %d\\n\","
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t   __func__,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t   error);"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn error;"
          },
          {
            "type": "context",
            "line": " \t\t\t\tSetModeFlag(orangefs_inode);"
          },
          {
            "type": "context",
            "line": " \t\t\tinode->i_mode = mode;"
          },
          {
            "type": "context",
            "line": " \t\t\tmark_inode_dirty_sync(inode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tacl = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_DEFAULT:"
          }
        ]
      },
      {
        "file": "fs/posix_acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 59d47ab0791a..bfc3ec388322 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/posix_acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/posix_acl.c"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL_GPL(posix_acl_create);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * posix_acl_update_mode  -  update mode in set_acl"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Update the file mode when setting an ACL: compute the new file permission"
          },
          {
            "type": "add",
            "line": " * bits based on the ACL.  In addition, if the ACL is equivalent to the new"
          },
          {
            "type": "add",
            "line": " * file mode, set *acl to NULL to indicate that no ACL should be set."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * As with chmod, clear the setgit bit if the caller is not in the owning group"
          },
          {
            "type": "add",
            "line": " * or capable of CAP_FSETID (see inode_change_ok)."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Called from set_acl inode operations."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "int posix_acl_update_mode(struct inode *inode, umode_t *mode_p,"
          },
          {
            "type": "add",
            "line": "\t\t\t  struct posix_acl **acl)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "add",
            "line": "\tint error;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\terror = posix_acl_equiv_mode(*acl, &mode);"
          },
          {
            "type": "add",
            "line": "\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\treturn error;"
          },
          {
            "type": "add",
            "line": "\tif (error == 0)"
          },
          {
            "type": "add",
            "line": "\t\t*acl = NULL;"
          },
          {
            "type": "add",
            "line": "\tif (!in_group_p(inode->i_gid) &&"
          },
          {
            "type": "add",
            "line": "\t    !capable_wrt_inode_uidgid(inode, CAP_FSETID))"
          },
          {
            "type": "add",
            "line": "\t\tmode &= ~S_ISGID;"
          },
          {
            "type": "add",
            "line": "\t*mode_p = mode;"
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": "EXPORT_SYMBOL(posix_acl_update_mode);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  * Fix up the uids and gids in posix acl extended attributes in place."
          },
          {
            "type": "context",
            "line": "  */"
          }
        ]
      },
      {
        "file": "fs/reiserfs/xattr_acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index dbed42f755e0..27376681c640 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/reiserfs/xattr_acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/reiserfs/xattr_acl.c"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_ACCESS:"
          },
          {
            "type": "context",
            "line": " \t\tname = XATTR_NAME_POSIX_ACL_ACCESS;"
          },
          {
            "type": "context",
            "line": " \t\tif (acl) {"
          },
          {
            "type": "delete",
            "line": "\t\t\terror = posix_acl_equiv_mode(acl, &inode->i_mode);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\terror = posix_acl_update_mode(inode, &inode->i_mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (error)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn error;"
          },
          {
            "type": "delete",
            "line": "\t\t\telse {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (error == 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tacl = NULL;"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase ACL_TYPE_DEFAULT:"
          }
        ]
      },
      {
        "file": "fs/xfs/xfs_acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index b6e527b8eccb..8a0dec89ca56 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/xfs/xfs_acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/xfs/xfs_acl.c"
          },
          {
            "type": "context",
            "line": " \t\treturn error;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (type == ACL_TYPE_ACCESS) {"
          },
          {
            "type": "delete",
            "line": "\t\tumode_t mode = inode->i_mode;"
          },
          {
            "type": "delete",
            "line": "\t\terror = posix_acl_equiv_mode(acl, &mode);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (error <= 0) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tacl = NULL;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tif (error < 0)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn error;"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tumode_t mode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\terror = posix_acl_update_mode(inode, &mode, &acl);"
          },
          {
            "type": "add",
            "line": "\t\tif (error)"
          },
          {
            "type": "add",
            "line": "\t\t\treturn error;"
          },
          {
            "type": "context",
            "line": " \t\terror = xfs_set_mode(inode, mode);"
          },
          {
            "type": "context",
            "line": " \t\tif (error)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn error;"
          }
        ]
      },
      {
        "file": "include/linux/posix_acl.h",
        "changes": [
          {
            "type": "context",
            "line": "index d5d3d741f028..bf1046d0397b 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/posix_acl.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/posix_acl.h"
          },
          {
            "type": "context",
            "line": " extern int posix_acl_chmod(struct inode *, umode_t);"
          },
          {
            "type": "context",
            "line": " extern int posix_acl_create(struct inode *, umode_t *, struct posix_acl **,"
          },
          {
            "type": "context",
            "line": " \t\tstruct posix_acl **);"
          },
          {
            "type": "add",
            "line": "extern int posix_acl_update_mode(struct inode *, umode_t *, struct posix_acl **);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " extern int simple_set_acl(struct inode *, struct posix_acl *, int);"
          },
          {
            "type": "context",
            "line": " extern int simple_acl_create(struct inode *, struct inode *);"
          }
        ]
      }
    ]
  },
  {
    "commit": "073c516ff73557a8f7315066856c04b50383ac34",
    "files": [
      {
        "file": "fs/nsfs.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1656843e87d2..323f492e0822 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/nsfs.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/nsfs.c"
          },
          {
            "type": "context",
            "line": " \t\treturn ERR_PTR(-ENOMEM);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \td_instantiate(dentry, inode);"
          },
          {
            "type": "add",
            "line": "\tdentry->d_flags |= DCACHE_RCUACCESS;"
          },
          {
            "type": "context",
            "line": " \tdentry->d_fsdata = (void *)ns->ops;"
          },
          {
            "type": "context",
            "line": " \td = atomic_long_cmpxchg(&ns->stashed, 0, (unsigned long)dentry);"
          },
          {
            "type": "context",
            "line": " \tif (d) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "07678eca2cf9c9a18584e546c2b2a0d0c9a3150c",
    "files": [
      {
        "file": "drivers/gpu/drm/vmwgfx/vmwgfx_surface.c",
        "changes": [
          {
            "type": "context",
            "line": "index baf03d4d86d2..834bb10973a2 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/vmwgfx/vmwgfx_surface.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/vmwgfx/vmwgfx_surface.c"
          },
          {
            "type": "context",
            "line": " \tstruct ttm_object_file *tfile = vmw_fpriv(file_priv)->tfile;"
          },
          {
            "type": "context",
            "line": " \tint ret;"
          },
          {
            "type": "context",
            "line": " \tuint32_t size;"
          },
          {
            "type": "delete",
            "line": "\tuint32_t backup_handle;"
          },
          {
            "type": "add",
            "line": "\tuint32_t backup_handle = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (req->multisample_count != 0)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": " \t\tret = vmw_user_dmabuf_lookup(tfile, req->buffer_handle,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t     &res->backup,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t     &user_srf->backup_base);"
          },
          {
            "type": "delete",
            "line": "\t\tif (ret == 0 && res->backup->base.num_pages * PAGE_SIZE <"
          },
          {
            "type": "delete",
            "line": "\t\t    res->backup_size) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tDRM_ERROR(\"Surface backup buffer is too small.\\n\");"
          },
          {
            "type": "delete",
            "line": "\t\t\tvmw_dmabuf_unreference(&res->backup);"
          },
          {
            "type": "delete",
            "line": "\t\t\tret = -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\t\t\tgoto out_unlock;"
          },
          {
            "type": "add",
            "line": "\t\tif (ret == 0) {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (res->backup->base.num_pages * PAGE_SIZE <"
          },
          {
            "type": "add",
            "line": "\t\t\t    res->backup_size) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tDRM_ERROR(\"Surface backup buffer is too small.\\n\");"
          },
          {
            "type": "add",
            "line": "\t\t\t\tvmw_dmabuf_unreference(&res->backup);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tret = -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tgoto out_unlock;"
          },
          {
            "type": "add",
            "line": "\t\t\t} else {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tbackup_handle = req->buffer_handle;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t} else if (req->drm_surface_flags & drm_vmw_surface_flag_create_buffer)"
          },
          {
            "type": "context",
            "line": " \t\tret = vmw_user_dmabuf_alloc(dev_priv, tfile,"
          }
        ]
      }
    ]
  },
  {
    "commit": "0773bb9303d24473fe1185d85a424dfe159aff53",
    "files": [
      {
        "file": "libfreerdp/core/nla.c",
        "changes": [
          {
            "type": "context",
            "line": "index 2b4b71992..875c0ae73 100644"
          },
          {
            "type": "context",
            "line": "--- a/libfreerdp/core/nla.c"
          },
          {
            "type": "context",
            "line": "+++ b/libfreerdp/core/nla.c"
          },
          {
            "type": "context",
            "line": " \t\tZeroMemory(&credssp->negoToken, sizeof(SecBuffer));"
          },
          {
            "type": "context",
            "line": " \t\tZeroMemory(&credssp->pubKeyAuth, sizeof(SecBuffer));"
          },
          {
            "type": "context",
            "line": " \t\tZeroMemory(&credssp->authInfo, sizeof(SecBuffer));"
          },
          {
            "type": "add",
            "line": "\t\tSecInvalidateHandle(&credssp->context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (credssp->server)"
          },
          {
            "type": "context",
            "line": " \t\t{"
          }
        ]
      },
      {
        "file": "libfreerdp/core/peer.c",
        "changes": [
          {
            "type": "context",
            "line": "index 3806a736e..eb4ad60ea 100644"
          },
          {
            "type": "context",
            "line": "--- a/libfreerdp/core/peer.c"
          },
          {
            "type": "context",
            "line": "+++ b/libfreerdp/core/peer.c"
          },
          {
            "type": "context",
            "line": " \t\t\t\tsspi_CopyAuthIdentity(&client->identity, &(rdp->nego->transport->credssp->identity));"
          },
          {
            "type": "context",
            "line": " \t\t\t\tIFCALLRET(client->Logon, client->authenticated, client, &client->identity, TRUE);"
          },
          {
            "type": "context",
            "line": " \t\t\t\tcredssp_free(rdp->nego->transport->credssp);"
          },
          {
            "type": "add",
            "line": "\t\t\t\trdp->nego->transport->credssp = NULL;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          }
        ]
      },
      {
        "file": "libfreerdp/core/transport.c",
        "changes": [
          {
            "type": "context",
            "line": "index a9a710511..4afec5a12 100644"
          },
          {
            "type": "context",
            "line": "--- a/libfreerdp/core/transport.c"
          },
          {
            "type": "context",
            "line": "+++ b/libfreerdp/core/transport.c"
          },
          {
            "type": "context",
            "line": " \t\t\t\"If credentials are valid, the NTLMSSP implementation may be to blame.\\n\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tcredssp_free(transport->credssp);"
          },
          {
            "type": "add",
            "line": "\t\ttransport->credssp = NULL;"
          },
          {
            "type": "context",
            "line": " \t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tfprintf(stderr, \"client authentication failure\\n\");"
          },
          {
            "type": "context",
            "line": " \t\tcredssp_free(transport->credssp);"
          },
          {
            "type": "add",
            "line": "\t\ttransport->credssp = NULL;"
          },
          {
            "type": "context",
            "line": " \t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "winpr/libwinpr/sspi/sspi.c",
        "changes": [
          {
            "type": "context",
            "line": "index 8747e3f01..96c959995 100644"
          },
          {
            "type": "context",
            "line": "--- a/winpr/libwinpr/sspi/sspi.c"
          },
          {
            "type": "context",
            "line": "+++ b/winpr/libwinpr/sspi/sspi.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tvoid* pointer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!handle)"
          },
          {
            "type": "add",
            "line": "\tif (!handle || !SecIsValidHandle(handle))"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tpointer = (void*) ~((size_t) handle->dwLower);"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tvoid* pointer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!handle)"
          },
          {
            "type": "add",
            "line": "\tif (!handle || !SecIsValidHandle(handle))"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tpointer = (void*) ~((size_t) handle->dwUpper);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " SECURITY_STATUS SEC_ENTRY DeleteSecurityContext(PCtxtHandle phContext)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tchar* Name;"
          },
          {
            "type": "add",
            "line": "\tchar* Name = NULL;"
          },
          {
            "type": "context",
            "line": " \tSECURITY_STATUS status;"
          },
          {
            "type": "context",
            "line": " \tSecurityFunctionTableA* table;"
          }
        ]
      }
    ]
  },
  {
    "commit": "07d86ca93db7e5cdf4743564d98292042ec21af7",
    "files": [
      {
        "file": "sound/usmidi.c",
        "changes": [
          {
            "type": "context",
            "line": "index cc39f63299ef..007cf5831121 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/usb/midi.c"
          },
          {
            "type": "context",
            "line": "+++ b/sound/usb/midi.c"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\terr = snd_usbmidi_create_endpoints(umidi, endpoints);"
          },
          {
            "type": "context",
            "line": " \tif (err < 0) {"
          },
          {
            "type": "delete",
            "line": "\t\tsnd_usbmidi_free(umidi);"
          },
          {
            "type": "context",
            "line": " \t\treturn err;"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "07f12b26e21ab359261bf75cfcb424fdc7daeb6d",
    "files": [
      {
        "file": "net/ipv6/sit.c",
        "changes": [
          {
            "type": "context",
            "line": "index e8a1dabef803..09e440e8dfae 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/ipv6/sit.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/ipv6/sit.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " err_reg_dev:"
          },
          {
            "type": "context",
            "line": " \tipip6_dev_free(sitn->fb_tunnel_dev);"
          },
          {
            "type": "add",
            "line": "\tfree_netdev(sitn->fb_tunnel_dev);"
          },
          {
            "type": "context",
            "line": " err_alloc_dev:"
          },
          {
            "type": "context",
            "line": " \treturn err;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "07f4d9d74a04aa7c72c5dae0ef97565f28f17b92",
    "files": [
      {
        "file": "include/sound/core.h",
        "changes": [
          {
            "type": "context",
            "line": "index eedda2cdfe57..1df3f2fe5350 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/sound/core.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/sound/core.h"
          },
          {
            "type": "context",
            "line": " \tint user_ctl_count;\t\t/* count of all user controls */"
          },
          {
            "type": "context",
            "line": " \tstruct list_head controls;\t/* all controls for this card */"
          },
          {
            "type": "context",
            "line": " \tstruct list_head ctl_files;\t/* active control files */"
          },
          {
            "type": "add",
            "line": "\tstruct mutex user_ctl_lock;\t/* protects user controls against"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t   concurrent access */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstruct snd_info_entry *proc_root;\t/* root for soundcard specific files */"
          },
          {
            "type": "context",
            "line": " \tstruct snd_info_entry *proc_id;\t/* the card id */"
          }
        ]
      },
      {
        "file": "sound/core/control.c",
        "changes": [
          {
            "type": "context",
            "line": "index f038f5afafe2..00ab034f5fcb 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/core/control.c"
          },
          {
            "type": "context",
            "line": "+++ b/sound/core/control.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct user_element {"
          },
          {
            "type": "context",
            "line": " \tstruct snd_ctl_elem_info info;"
          },
          {
            "type": "add",
            "line": "\tstruct snd_card *card;"
          },
          {
            "type": "context",
            "line": " \tvoid *elem_data;\t\t/* element data */"
          },
          {
            "type": "context",
            "line": " \tunsigned long elem_data_size;\t/* size of element data in bytes */"
          },
          {
            "type": "context",
            "line": " \tvoid *tlv_data;\t\t\t/* TLV data */"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct user_element *ue = kcontrol->private_data;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tmutex_lock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \tmemcpy(&ucontrol->value, ue->elem_data, ue->elem_data_size);"
          },
          {
            "type": "add",
            "line": "\tmutex_unlock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tint change;"
          },
          {
            "type": "context",
            "line": " \tstruct user_element *ue = kcontrol->private_data;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tmutex_lock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \tchange = memcmp(&ucontrol->value, ue->elem_data, ue->elem_data_size) != 0;"
          },
          {
            "type": "context",
            "line": " \tif (change)"
          },
          {
            "type": "context",
            "line": " \t\tmemcpy(ue->elem_data, &ucontrol->value, ue->elem_data_size);"
          },
          {
            "type": "add",
            "line": "\tmutex_unlock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \treturn change;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tnew_data = memdup_user(tlv, size);"
          },
          {
            "type": "context",
            "line": " \t\tif (IS_ERR(new_data))"
          },
          {
            "type": "context",
            "line": " \t\t\treturn PTR_ERR(new_data);"
          },
          {
            "type": "add",
            "line": "\t\tmutex_lock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \t\tchange = ue->tlv_data_size != size;"
          },
          {
            "type": "context",
            "line": " \t\tif (!change)"
          },
          {
            "type": "context",
            "line": " \t\t\tchange = memcmp(ue->tlv_data, new_data, size);"
          },
          {
            "type": "context",
            "line": " \t\tkfree(ue->tlv_data);"
          },
          {
            "type": "context",
            "line": " \t\tue->tlv_data = new_data;"
          },
          {
            "type": "context",
            "line": " \t\tue->tlv_data_size = size;"
          },
          {
            "type": "add",
            "line": "\t\tmutex_unlock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \t} else {"
          },
          {
            "type": "delete",
            "line": "\t\tif (! ue->tlv_data_size || ! ue->tlv_data)"
          },
          {
            "type": "delete",
            "line": "\t\t\treturn -ENXIO;"
          },
          {
            "type": "delete",
            "line": "\t\tif (size < ue->tlv_data_size)"
          },
          {
            "type": "delete",
            "line": "\t\t\treturn -ENOSPC;"
          },
          {
            "type": "add",
            "line": "\t\tint ret = 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tmutex_lock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "add",
            "line": "\t\tif (!ue->tlv_data_size || !ue->tlv_data) {"
          },
          {
            "type": "add",
            "line": "\t\t\tret = -ENXIO;"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto err_unlock;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif (size < ue->tlv_data_size) {"
          },
          {
            "type": "add",
            "line": "\t\t\tret = -ENOSPC;"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto err_unlock;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\tif (copy_to_user(tlv, ue->tlv_data, ue->tlv_data_size))"
          },
          {
            "type": "delete",
            "line": "\t\t\treturn -EFAULT;"
          },
          {
            "type": "add",
            "line": "\t\t\tret = -EFAULT;"
          },
          {
            "type": "add",
            "line": "err_unlock:"
          },
          {
            "type": "add",
            "line": "\t\tmutex_unlock(&ue->card->user_ctl_lock);"
          },
          {
            "type": "add",
            "line": "\t\tif (ret)"
          },
          {
            "type": "add",
            "line": "\t\t\treturn ret;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn change;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \tue = kzalloc(sizeof(struct user_element) + private_size, GFP_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tif (ue == NULL)"
          },
          {
            "type": "context",
            "line": " \t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\tue->card = card;"
          },
          {
            "type": "context",
            "line": " \tue->info = *info;"
          },
          {
            "type": "context",
            "line": " \tue->info.access = 0;"
          },
          {
            "type": "context",
            "line": " \tue->elem_data = (char *)ue + sizeof(*ue);"
          }
        ]
      },
      {
        "file": "sound/core/init.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5ee83845c5de..7bdfd19e24a8 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/core/init.c"
          },
          {
            "type": "context",
            "line": "+++ b/sound/core/init.c"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&card->devices);"
          },
          {
            "type": "context",
            "line": " \tinit_rwsem(&card->controls_rwsem);"
          },
          {
            "type": "context",
            "line": " \trwlock_init(&card->ctl_files_rwlock);"
          },
          {
            "type": "add",
            "line": "\tmutex_init(&card->user_ctl_lock);"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&card->controls);"
          },
          {
            "type": "context",
            "line": " \tINIT_LIST_HEAD(&card->ctl_files);"
          },
          {
            "type": "context",
            "line": " \tspin_lock_init(&card->files_lock);"
          }
        ]
      }
    ]
  },
  {
    "commit": "08247f0a633d8e836ce2e5cd2d53aa19901a1359",
    "files": [
      {
        "file": "liBaser/Model/BcAppModel.php",
        "changes": [
          {
            "type": "context",
            "line": "index ef6eefa95..c6158a5d1 100755"
          },
          {
            "type": "context",
            "line": "--- a/lib/Baser/Model/BcAppModel.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Baser/Model/BcAppModel.php"
          },
          {
            "type": "context",
            "line": " \tpublic function fileExt($check, $exts)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\t$file = $check[key($check)];"
          },
          {
            "type": "add",
            "line": "\t\tif (!is_array($exts)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t$exts = explode(',', $exts);"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// FILES形式のチェック"
          },
          {
            "type": "context",
            "line": " \t\tif (!empty($file['name'])) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (!is_array($exts)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$exts = explode(',', $exts);"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t$ext = decodeContent($file['type'], $file['name']);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (in_array($ext, $exts)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn true;"
          },
          {
            "type": "delete",
            "line": "\t\t\t} else {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!in_array($ext, $exts)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// 更新時の文字列チェック"
          },
          {
            "type": "add",
            "line": "\t\tif (!empty($file) && is_string($file)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t$ext = pathinfo($file, PATHINFO_EXTENSION);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!in_array($ext, $exts)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn false;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "083692d598139228e101b8c521aaef7bcf256e9a",
    "files": [
      {
        "file": "src/message.c",
        "changes": [
          {
            "type": "context",
            "line": "index 02380e917..becb2804d 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/message.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/message.c"
          },
          {
            "type": "context",
            "line": " \t    *sp = str + 1;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     else"
          },
          {
            "type": "delete",
            "line": "\t// single-byte character or illegal byte"
          },
          {
            "type": "delete",
            "line": "\t*sp = str + 1;"
          },
          {
            "type": "add",
            "line": "\t// single-byte character, NUL or illegal byte"
          },
          {
            "type": "add",
            "line": "\t*sp = str + (*str == NUL ? 0 : 1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // Make special keys and C0 control characters in <> form, also <M-Space>."
          },
          {
            "type": "context",
            "line": "     // Use <Space> only for lhs of a mapping."
          }
        ]
      },
      {
        "file": "src/testdir/test_menu.vim",
        "changes": [
          {
            "type": "context",
            "line": "index c867162e5..df717cc8a 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testdir/test_menu.vim"
          },
          {
            "type": "context",
            "line": "+++ b/src/testdir/test_menu.vim"
          },
          {
            "type": "context",
            "line": "   tunmenu Test"
          },
          {
            "type": "context",
            "line": " endfunc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func Test_only_modifier()"
          },
          {
            "type": "add",
            "line": "  exe \"tmenu a.b \\x80\\xfc0\""
          },
          {
            "type": "add",
            "line": "  let exp =<< trim [TEXT]"
          },
          {
            "type": "add",
            "line": "  --- Menus ---"
          },
          {
            "type": "add",
            "line": "  500 a"
          },
          {
            "type": "add",
            "line": "    500 b"
          },
          {
            "type": "add",
            "line": "        t  - <T-2-^@>"
          },
          {
            "type": "add",
            "line": "  [TEXT]"
          },
          {
            "type": "add",
            "line": "  call assert_equal(exp, split(execute('tmenu'), \"\\n\"))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  tunmenu a.b"
          },
          {
            "type": "add",
            "line": "endfunc"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \" vim: shiftwidth=2 sts=2 expandtab"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index ea1cc16c7..003984ab6 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    9,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     8,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "0837e3242c73566fc1c0196b4ec61779c25ffc93",
    "files": [
      {
        "file": "arch/powerpc/include/asm/reg.h",
        "changes": [
          {
            "type": "context",
            "line": "index 125fc1ad665d..7626fa78e1f8 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/powerpc/include/asm/reg.h"
          },
          {
            "type": "context",
            "line": "+++ b/arch/powerpc/include/asm/reg.h"
          },
          {
            "type": "context",
            "line": " #define PV_970\t\t0x0039"
          },
          {
            "type": "context",
            "line": " #define PV_POWER5\t0x003A"
          },
          {
            "type": "context",
            "line": " #define PV_POWER5p\t0x003B"
          },
          {
            "type": "add",
            "line": "#define PV_POWER7\t0x003F"
          },
          {
            "type": "context",
            "line": " #define PV_970FX\t0x003C"
          },
          {
            "type": "context",
            "line": " #define PV_630\t\t0x0040"
          },
          {
            "type": "context",
            "line": " #define PV_630p\t0x0041"
          }
        ]
      },
      {
        "file": "arch/powerpc/kernel/perf_event.c",
        "changes": [
          {
            "type": "context",
            "line": "index ab6f6beadb57..97e0ae414940 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/powerpc/kernel/perf_event.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/powerpc/kernel/perf_event.c"
          },
          {
            "type": "context",
            "line": " \treturn ip;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "static bool pmc_overflow(unsigned long val)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tif ((int)val < 0)"
          },
          {
            "type": "add",
            "line": "\t\treturn true;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * Events on POWER7 can roll back if a speculative event doesn't"
          },
          {
            "type": "add",
            "line": "\t * eventually complete. Unfortunately in some rare cases they will"
          },
          {
            "type": "add",
            "line": "\t * raise a performance monitor exception. We need to catch this to"
          },
          {
            "type": "add",
            "line": "\t * ensure we reset the PMC. In all cases the PMC will be 256 or less"
          },
          {
            "type": "add",
            "line": "\t * cycles from overflow."
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * We only do this if the first pass fails to find any overflowing"
          },
          {
            "type": "add",
            "line": "\t * PMCs because a user might set a period of less than 256 and we"
          },
          {
            "type": "add",
            "line": "\t * don't want to mistakenly reset them."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tif (__is_processor(PV_POWER7) && ((0x80000000 - val) <= 256))"
          },
          {
            "type": "add",
            "line": "\t\treturn true;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn false;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  * Performance monitor interrupt stuff"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " \t\t\tif (is_limited_pmc(i + 1))"
          },
          {
            "type": "context",
            "line": " \t\t\t\tcontinue;"
          },
          {
            "type": "context",
            "line": " \t\t\tval = read_pmc(i + 1);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif ((int)val < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tif (pmc_overflow(val))"
          },
          {
            "type": "context",
            "line": " \t\t\t\twrite_pmc(i + 1, 0);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "0843c046eee54b16ec6a7753c575838212770189",
    "files": [
      {
        "file": "site-content/en_US/account/account.tab",
        "changes": [
          {
            "type": "context",
            "line": "index 4913aec268f..6eb4477bbee 100644"
          },
          {
            "type": "context",
            "line": "--- a/site-content/en_US/account/account.tab"
          },
          {
            "type": "context",
            "line": "+++ b/site-content/en_US/account/account.tab"
          },
          {
            "type": "context",
            "line": " account_preferences\ttext_format\tText"
          },
          {
            "type": "context",
            "line": " #"
          },
          {
            "type": "context",
            "line": " #-----------------------------------------------"
          },
          {
            "type": "delete",
            "line": "# Script: SF/www/account/change_email.php"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "account_change_email\ttitle\tChange Email Address"
          },
          {
            "type": "delete",
            "line": "account_change_email\tmessage\t<P>Changing your email address will require confirmation from your new email address, so that we can ensure we have a good email address on file. <P>Submitting the form below will mail a confirmation URL to the new email address. Visiting this link will complete the email change."
          },
          {
            "type": "delete",
            "line": "account_change_email\tlabel_new\tNew Email Address"
          },
          {
            "type": "delete",
            "line": "account_change_email\tsend_new\tSend Confirmation to New Address"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "#-----------------------------------------------"
          },
          {
            "type": "delete",
            "line": "# Script: SF/www/account/change_email-confirm.php"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "account_change_email-confirm\tmessage\tYou have requested a change of email address on $1.\\nPlease visit the following URL to complete the email change:\\n\\n$2\\n\\n-- The $1 Team"
          },
          {
            "type": "delete",
            "line": "account_change_email-confirm\ttitle\tEmail Change Confirmation"
          },
          {
            "type": "delete",
            "line": "account_change_email-confirm\tmailsent\tAn email has been sent to the new address. Follow the instructions in the email to complete the email change."
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "#-----------------------------------------------"
          },
          {
            "type": "delete",
            "line": "# Script: SF/www/account/change_email-complete.php"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\tinvalid_hash\tInvalid confirmation hash."
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\tduplicate_hash\tThis hash key exists more than once."
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\ttitle\tEmail Change Complete"
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\tmessage\tWelcome, $1.<P>Your email change is complete. Your new email address on file is <B>$2</B>. Mail sent to $3 user $1 (login $4) will now be forwarded to this new email address."
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "#-----------------------------------------------"
          },
          {
            "type": "context",
            "line": " # Script: SF/www/account/change_pw.php"
          },
          {
            "type": "context",
            "line": " #"
          },
          {
            "type": "context",
            "line": " account_change_pw\ttitle_success\tSuccessfully Changed Password"
          }
        ]
      },
      {
        "file": "site-content/fr_FR/LC_MESSAGES/tuleap-core.po",
        "changes": [
          {
            "type": "context",
            "line": "index beca1fa65ca..df902e87671 100644"
          },
          {
            "type": "context",
            "line": "--- a/site-content/fr_FR/LC_MESSAGES/tuleap-core.po"
          },
          {
            "type": "context",
            "line": "+++ b/site-content/fr_FR/LC_MESSAGES/tuleap-core.po"
          },
          {
            "type": "context",
            "line": " \"Content-Type: text/plain; charset=UTF-8\\n\""
          },
          {
            "type": "context",
            "line": " \"Content-Transfer-Encoding: 8bit\\n\""
          },
          {
            "type": "context",
            "line": " \"Plural-Forms: nplurals=2; plural=(n > 1);\\n\""
          },
          {
            "type": "delete",
            "line": "\"X-Generator: Poedit 2.0.3\\n\""
          },
          {
            "type": "add",
            "line": "\"X-Generator: Poedit 1.8.7.1\\n\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #, php-format"
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " msgid \"Already used\""
          },
          {
            "type": "context",
            "line": " msgstr \"Déjà utilisé\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"An email has been sent to the new address. Follow the instructions in the \""
          },
          {
            "type": "add",
            "line": "\"email to complete the email change.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"Un courrier électronique vient d'être envoyé à votre nouvelle adresse e-\""
          },
          {
            "type": "add",
            "line": "\"mail. Suivez les instructions fournies dans ce message pour confirmer \""
          },
          {
            "type": "add",
            "line": "\"définitivement le changement.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " \"An error occured with your upload. Please try again or choose another image.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": " msgid \"Categories\""
          },
          {
            "type": "context",
            "line": " msgstr \"Catégories\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Change email address\""
          },
          {
            "type": "add",
            "line": "msgstr \"Changer l'adresse e-mail\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Changing your email address will require confirmation from your new email \""
          },
          {
            "type": "add",
            "line": "\"address, so that we can ensure we have a good email address on file.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"Le changement d'adresse e-mail nécessite une confirmation depuis votre \""
          },
          {
            "type": "add",
            "line": "\"nouvelle adresse e-mail de façon à s'assurer que nous disposons d'une \""
          },
          {
            "type": "add",
            "line": "\"adresse valide.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Child projects\""
          },
          {
            "type": "context",
            "line": " msgstr \"Projets enfants\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Edit widget\""
          },
          {
            "type": "context",
            "line": " msgstr \"Éditer le widget\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Email change complete\""
          },
          {
            "type": "add",
            "line": "msgstr \"Changement d'e-mail confirmé\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Email change confirmation\""
          },
          {
            "type": "add",
            "line": "msgstr \"Confirmation de changement d'adresse e-mail\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Email format invalid\""
          },
          {
            "type": "add",
            "line": "msgstr \"Le formal de l'e-mail n'est pas valide\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Emergency\""
          },
          {
            "type": "context",
            "line": " msgstr \"Urgent\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Nb members\""
          },
          {
            "type": "context",
            "line": " msgstr \"Nb membres\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"New email address:\""
          },
          {
            "type": "add",
            "line": "msgstr \"Nouvelle adresse e-mail\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"News\""
          },
          {
            "type": "context",
            "line": " msgstr \"Annonces\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"See permissions\""
          },
          {
            "type": "context",
            "line": " msgstr \"Voir les permissions\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Send confirmation to new address\""
          },
          {
            "type": "add",
            "line": "msgstr \"Envoyer la confirmation\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Service news is disabled for this project.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Le service annonces est désactivé pour ce projet.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Style\""
          },
          {
            "type": "context",
            "line": " msgstr \"Style\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Submitting the form below will mail a confirmation URL to the new email \""
          },
          {
            "type": "add",
            "line": "\"address. Visiting this link will complete the email change.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"La soumission de ce formulaire déclenchera l'envoi d'un e-mail à votre \""
          },
          {
            "type": "add",
            "line": "\"nouvelle adresse incluant un lien à visiter pour confirmer définitivement le \""
          },
          {
            "type": "add",
            "line": "\"changement.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"System\""
          },
          {
            "type": "context",
            "line": " msgstr \"Système\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": " \"Il n'est pas possible de supprimer le dernier administrateur du projet.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#, php-format"
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"The mail was not accepted for the delivery. Please contact the administrator \""
          },
          {
            "type": "add",
            "line": "\"at %s.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"L'e-mail n'a pas pu être envoyé. Veuillez contacter les administrateurs à \""
          },
          {
            "type": "add",
            "line": "\"l'adresse %s.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"The name is missing for creating a dashboard.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Il manque le nom pour créer un tableau de bord.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"This group does not have any members yet.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Ce groupe n'a pas encore de membres.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"This hash key exists more than once\""
          },
          {
            "type": "add",
            "line": "msgstr \"Cette clé de confirmation est présente plus d'une fois dans la base.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"This is a system group, you cannot delete it.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Ceci est un groupe système, vous ne pouvez pas le supprimer.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Unable to fetch the latest activities of the project\""
          },
          {
            "type": "context",
            "line": " msgstr \"Impossible de récupérer les dernières activités du projet\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Unauthorized action for anonymous\""
          },
          {
            "type": "add",
            "line": "msgstr \"Cette action n'est pas autorisée pour les anonymes\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Unix name\""
          },
          {
            "type": "context",
            "line": " msgstr \"Now unix\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Welcome message and information for users\""
          },
          {
            "type": "context",
            "line": " msgstr \"Message de bienvenue et informations générales pour les utilisateurs\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Welcome, %s.\""
          },
          {
            "type": "add",
            "line": "msgstr \"Bienvenue, %s\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " \"Why don't you start by editing your dashboard <br> and adding some widgets?\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": " \"Vous êtes sur le point de supprimer le widget \\\"%s\\\". Cette action est \""
          },
          {
            "type": "context",
            "line": " \"irréversible. Merci de confirmer cette suppression.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"You are not the user who asked for email change\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"Vous n'etes pas l'utilisateur à l'origine de la demande de changement d'e-\""
          },
          {
            "type": "add",
            "line": "\"mail\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " \"You can delegate to this group several permissions. All the members of this\\n\""
          },
          {
            "type": "context",
            "line": " \"                        group will take advantage of these permissions.\""
          },
          {
            "type": "context",
            "line": " \"Vous n’avez pas les droits pour mettre à jour des tableaux de bord du projet \""
          },
          {
            "type": "context",
            "line": " \"\\\"%s\\\".\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#, php-format"
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"You have requested a change of email address on %s.\\n\""
          },
          {
            "type": "add",
            "line": "\"Please visit the following URL to complete the email change:\\n\""
          },
          {
            "type": "add",
            "line": "\"\\n\""
          },
          {
            "type": "add",
            "line": "\"%s\\n\""
          },
          {
            "type": "add",
            "line": "\"\\n\""
          },
          {
            "type": "add",
            "line": "\"-- The %s Team\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"Vous avez demandé a changer votre adresse e-mail en %s.\\n\""
          },
          {
            "type": "add",
            "line": "\"Merci de visiter le lien ci-dessous pour confirmer ce changement :\\n\""
          },
          {
            "type": "add",
            "line": "\"\\n\""
          },
          {
            "type": "add",
            "line": "\"%s\\n\""
          },
          {
            "type": "add",
            "line": "\"\\n\""
          },
          {
            "type": "add",
            "line": "\"-- L'équipe %s\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"You must be a project admin to edit this widget.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": " \"Vous devez être administrateur du projet pour pouvoir éditer ce widget.\""
          },
          {
            "type": "context",
            "line": " \"Vous devez supprimer l'utilisateur des administrateurs d'annonces avant de \""
          },
          {
            "type": "context",
            "line": " \"pouvoir l'enlever des rédacteurs\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Your email change is complete. Your new email address is <strong>%s</strong>.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"Votre changement d'adresse e-mail est confirmé. Votre nouvelle adresse e-\""
          },
          {
            "type": "add",
            "line": "\"mail est <strong>%s</strong>\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Your history is empty\""
          },
          {
            "type": "context",
            "line": " msgstr \"Votre historique est vide\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Your platform does not allow restricted users.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Votre plateforme n'authorise pas les utilisateurs restreints\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#, php-format"
          },
          {
            "type": "add",
            "line": "msgid \"[%s] Email change confirmation\""
          },
          {
            "type": "add",
            "line": "msgstr \"[%s] Confirmation de changement d'e-mail\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"back to home page\""
          },
          {
            "type": "add",
            "line": "msgstr \"Retour à la page d'accueil\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"categories\""
          },
          {
            "type": "context",
            "line": " msgstr \"catégories\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "site-content/fr_FR/account/account.tab",
        "changes": [
          {
            "type": "context",
            "line": "index c8405a02862..83a6b5cd0a3 100644"
          },
          {
            "type": "context",
            "line": "--- a/site-content/fr_FR/account/account.tab"
          },
          {
            "type": "context",
            "line": "+++ b/site-content/fr_FR/account/account.tab"
          },
          {
            "type": "context",
            "line": " account_preferences\ttext_format\tTexte"
          },
          {
            "type": "context",
            "line": " #"
          },
          {
            "type": "context",
            "line": " #-----------------------------------------------"
          },
          {
            "type": "delete",
            "line": "# Script: SF/www/account/change_email.php"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "account_change_email\ttitle\tChanger l'adresse e-mail"
          },
          {
            "type": "delete",
            "line": "account_change_email\tmessage\t<P>Le changement d'adresse e-mail nécessite une confirmation depuis votre nouvelle adresse e-mail de façon à s'assurer que nous disposons d'une adresse valide. <P>La soumission de ce formulaire déclenchera l'envoi d'un e-mail à votre nouvelle adresse incluant un lien à visiter pour confirmer définitivement le changement."
          },
          {
            "type": "delete",
            "line": "account_change_email\tlabel_new\tNouvelle adresse e-mail"
          },
          {
            "type": "delete",
            "line": "account_change_email\tsend_new\tEnvoyer la confirmation"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "#-----------------------------------------------"
          },
          {
            "type": "delete",
            "line": "# Script: SF/www/account/change_email-confirm.php"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "account_change_email-confirm\tmessage\tVous avez demandé a changer votre adresse e-mail en $1.\\nMerci de visiter le lien ci-dessous pour confirmer ce changement :\\n\\n$2\\n\\n-- L'équipe $1"
          },
          {
            "type": "delete",
            "line": "account_change_email-confirm\ttitle\tConfirmation de changement d'adresse e-mail"
          },
          {
            "type": "delete",
            "line": "account_change_email-confirm\tmailsent\tUn courrier électronique vient d'être envoyé à votre nouvelle adresse e-mail. Suivez les instructions fournies dans ce message pour confirmer définitivement le changement."
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "#-----------------------------------------------"
          },
          {
            "type": "delete",
            "line": "# Script: SF/www/account/change_email-complete.php"
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\tinvalid_hash\tClé de confirmation invalide."
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\tduplicate_hash\tCette clé de confirmation est présente plus d'une fois dans la base."
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\ttitle\tChangement d'e-mail confirmé"
          },
          {
            "type": "delete",
            "line": "account_change_email-complete\tmessage\tBienvenue, $1.<P>Votre changement d'adresse e-mail est confirmé. Votre nouvelle adresse e-mail est <B>$2</B>. Les courriers électroniques envoyés à $3, utilisateur $1 (compte $4) seront désormais envoyés à cette nouvelle adresse e-mail."
          },
          {
            "type": "delete",
            "line": "#"
          },
          {
            "type": "delete",
            "line": "#-----------------------------------------------"
          },
          {
            "type": "context",
            "line": " # Script: SF/www/account/change_pw.php"
          },
          {
            "type": "context",
            "line": " #"
          },
          {
            "type": "context",
            "line": " account_change_pw\ttitle_success\tMot de passe modifié avec succès"
          }
        ]
      },
      {
        "file": "site-content/tuleap-core.pot",
        "changes": [
          {
            "type": "context",
            "line": "index e9760b56e5f..80f5534fd75 100644"
          },
          {
            "type": "context",
            "line": "--- a/site-content/tuleap-core.pot"
          },
          {
            "type": "context",
            "line": "+++ b/site-content/tuleap-core.pot"
          },
          {
            "type": "context",
            "line": " msgid \"Already used\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"An email has been sent to the new address. Follow the instructions in the \""
          },
          {
            "type": "add",
            "line": "\"email to complete the email change.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " \"An error occured with your upload. Please try again or choose another image.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": " msgid \"Categories\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Change email address\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Changing your email address will require confirmation from your new email \""
          },
          {
            "type": "add",
            "line": "\"address, so that we can ensure we have a good email address on file.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Child projects\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Edit widget\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Email change complete\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Email change confirmation\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Email format invalid\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Emergency\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Nb members\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"New email address:\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"News\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"See permissions\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Send confirmation to new address\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Service news is disabled for this project.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Style\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Submitting the form below will mail a confirmation URL to the new email \""
          },
          {
            "type": "add",
            "line": "\"address. Visiting this link will complete the email change.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"System\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"The last project administrator cannot be removed.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#, php-format"
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"The mail was not accepted for the delivery. Please contact the administrator \""
          },
          {
            "type": "add",
            "line": "\"at %s.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"The name is missing for creating a dashboard.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"This group does not have any members yet.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"This hash key exists more than once\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"This is a system group, you cannot delete it.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Unable to fetch the latest activities of the project\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Unauthorized action for anonymous\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Unix name\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Welcome message and information for users\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"Welcome, %s.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " \"Why don't you start by editing your dashboard <br> and adding some widgets?\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": " \"                This action is irreversible. Please confirm this deletion.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"You are not the user who asked for email change\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"\""
          },
          {
            "type": "context",
            "line": " \"You can delegate to this group several permissions. All the members of this\\n\""
          },
          {
            "type": "context",
            "line": " \"                        group will take advantage of these permissions.\""
          },
          {
            "type": "context",
            "line": " msgid \"You have not rights to update dashboards of the project \\\"%s\\\".\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#, php-format"
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"You have requested a change of email address on %s.\\n\""
          },
          {
            "type": "add",
            "line": "\"Please visit the following URL to complete the email change:\\n\""
          },
          {
            "type": "add",
            "line": "\"\\n\""
          },
          {
            "type": "add",
            "line": "\"%s\\n\""
          },
          {
            "type": "add",
            "line": "\"\\n\""
          },
          {
            "type": "add",
            "line": "\"-- The %s Team\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"You must be a project admin to edit this widget.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \"him from writers.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Your email change is complete. Your new email address is <strong>%s</strong>.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Your history is empty\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Your platform does not allow restricted users.\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#, php-format"
          },
          {
            "type": "add",
            "line": "msgid \"[%s] Email change confirmation\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"back to home page\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"categories\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/common/autoload.php",
        "changes": [
          {
            "type": "context",
            "line": "index 60472ba537d..3a2306e4d5d 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/autoload.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/autoload.php"
          },
          {
            "type": "context",
            "line": " // @codingStandardsIgnoreFile"
          },
          {
            "type": "context",
            "line": " // @codeCoverageIgnoreStart"
          },
          {
            "type": "context",
            "line": " // this is an autogenerated file - do not edit"
          },
          {
            "type": "delete",
            "line": "function autoload5968920175c8826d1e7743c6dd8b7ecc($class) {"
          },
          {
            "type": "add",
            "line": "function autoload98e39cb101b034b8e47fa5f904bbcbfb($class) {"
          },
          {
            "type": "context",
            "line": "     static $classes = null;"
          },
          {
            "type": "context",
            "line": "     if ($classes === null) {"
          },
          {
            "type": "context",
            "line": "         $classes = array("
          },
          {
            "type": "context",
            "line": "             'tuleap\\\\trove\\\\trovecatrouter' => '/trove/TroveCatRouter.php',"
          },
          {
            "type": "context",
            "line": "             'tuleap\\\\trovecat\\\\trovecatlinkdao' => '/trove/TroveCatLinkDao.php',"
          },
          {
            "type": "context",
            "line": "             'tuleap\\\\uri\\\\urimodifier' => '/URI/URIModifier.php',"
          },
          {
            "type": "add",
            "line": "            'tuleap\\\\user\\\\account\\\\changepasswordconfirmpresenter' => '/user/Account/ChangePasswordConfirmPresenter.php',"
          },
          {
            "type": "add",
            "line": "            'tuleap\\\\user\\\\account\\\\changepasswordcontroller' => '/user/Account/ChangePasswordController.php',"
          },
          {
            "type": "add",
            "line": "            'tuleap\\\\user\\\\account\\\\changepasswordpresenter' => '/user/Account/ChangePasswordPresenter.php',"
          },
          {
            "type": "context",
            "line": "             'tuleap\\\\user\\\\admin\\\\pendingprojectbuilder' => '/user/Admin/PendingProjectBuilder.php',"
          },
          {
            "type": "context",
            "line": "             'tuleap\\\\user\\\\admin\\\\pendinguserpresenter' => '/user/Admin/PendingUserPresenter.php',"
          },
          {
            "type": "context",
            "line": "             'tuleap\\\\user\\\\admin\\\\pendinguserscollectionpresenter' => '/user/Admin/PendingUsersCollectionPresenter.php',"
          },
          {
            "type": "context",
            "line": "         require dirname(__FILE__) . $classes[$cn];"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "delete",
            "line": "spl_autoload_register('autoload5968920175c8826d1e7743c6dd8b7ecc');"
          },
          {
            "type": "add",
            "line": "spl_autoload_register('autoload98e39cb101b034b8e47fa5f904bbcbfb');"
          },
          {
            "type": "context",
            "line": " // @codeCoverageIgnoreEnd"
          }
        ]
      },
      {
        "file": "src/common/dao/UserDao.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 77caadd5620..97ccb38146d 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/dao/UserDao.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/dao/UserDao.class.php"
          },
          {
            "type": "context",
            "line": "         $sql = \"UPDATE user SET confirm_hash = null WHERE confirm_hash=$confirm_hash\";"
          },
          {
            "type": "context",
            "line": "         return $this->update($sql);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function setEmailChangeConfirm($user_id, $confirm_hash, $email_new)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $user_id      = $this->da->escapeInt($user_id);"
          },
          {
            "type": "add",
            "line": "        $confirm_hash = $this->da->quoteSmart($confirm_hash);"
          },
          {
            "type": "add",
            "line": "        $email_new    = $this->da->quoteSmart($email_new);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $sql = \"UPDATE user SET confirm_hash=$confirm_hash, email_new=$email_new WHERE user_id=$user_id\";"
          },
          {
            "type": "add",
            "line": "        return $this->update($sql);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "src/common/event/Event.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index ca046dfe856..da500828758 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/event/Event.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/event/Event.class.php"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     const LIST_SSH_KEYS = 'list_ssh_keys';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /**"
          },
          {
            "type": "delete",
            "line": "     * The user has just changed his email address."
          },
          {
            "type": "delete",
            "line": "     *"
          },
          {
            "type": "delete",
            "line": "     * Parameters:"
          },
          {
            "type": "delete",
            "line": "     *  'user_id' => User ID"
          },
          {
            "type": "delete",
            "line": "     *"
          },
          {
            "type": "delete",
            "line": "     * No expected results"
          },
          {
            "type": "delete",
            "line": "     */"
          },
          {
            "type": "delete",
            "line": "    const USER_EMAIL_CHANGED = 'user_email_changed';"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * Force aliases database update."
          },
          {
            "type": "context",
            "line": "      *"
          }
        ]
      },
      {
        "file": "src/common/system_event/SystemEventManager.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 5340c107734..eabdfdab52b 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/system_event/SystemEventManager.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/system_event/SystemEventManager.class.php"
          },
          {
            "type": "context",
            "line": "         $event_manager = $this->_getEventManager();"
          },
          {
            "type": "context",
            "line": "         $events_to_listen = array("
          },
          {
            "type": "context",
            "line": "             Event::SYSTEM_CHECK,"
          },
          {
            "type": "delete",
            "line": "            Event::USER_EMAIL_CHANGED,"
          },
          {
            "type": "context",
            "line": "             Event::PROJECT_RENAME,"
          },
          {
            "type": "context",
            "line": "             Event::USER_RENAME,"
          },
          {
            "type": "context",
            "line": "             Event::COMPUTE_MD5SUM,"
          },
          {
            "type": "context",
            "line": "                                $this->concatParameters($params, array('project_path', 'file_id', 'old_path' )),"
          },
          {
            "type": "context",
            "line": "                                SystemEvent::PRIORITY_HIGH);"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "delete",
            "line": "        case Event::USER_EMAIL_CHANGED:"
          },
          {
            "type": "delete",
            "line": "            $this->createEvent(SystemEvent::TYPE_USER_EMAIL_CHANGED,"
          },
          {
            "type": "delete",
            "line": "                               $params['user_id'],"
          },
          {
            "type": "delete",
            "line": "                               SystemEvent::PRIORITY_LOW);"
          },
          {
            "type": "delete",
            "line": "            break;"
          },
          {
            "type": "context",
            "line": "         case 'approve_pending_project':"
          },
          {
            "type": "context",
            "line": "             $this->createEvent(SystemEvent::TYPE_PROJECT_CREATE,"
          },
          {
            "type": "context",
            "line": "                                $params['group_id'],"
          }
        ]
      },
      {
        "file": "src/common/user/Account/ChangePasswordController.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..0049a0c5e44"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/user/Account/ChangePasswordController.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2018. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\User\\Account;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Tuleap\\Layout\\BaseLayout;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class ChangePasswordController"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    const URL = '/account/change_email.php';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @var \\UserManager"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    private $user_manager;"
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @var \\EventManager"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    private $event_manager;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function __construct(\\UserManager $user_manager, \\EventManager $event_manager)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->user_manager  = $user_manager;"
          },
          {
            "type": "add",
            "line": "        $this->event_manager = $event_manager;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function change(\\HTTPRequest $request, BaseLayout $response)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->processEvent('before_change_email', array());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $current_user = $request->getCurrentUser();"
          },
          {
            "type": "add",
            "line": "        if ($current_user->isAnonymous()) {"
          },
          {
            "type": "add",
            "line": "            $response->addFeedback(\\Feedback::ERROR, _('Unauthorized action for anonymous'));"
          },
          {
            "type": "add",
            "line": "            $response->redirect('/');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $response->header(['title' =>_('Change email address')]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $presenter = new ChangePasswordPresenter("
          },
          {
            "type": "add",
            "line": "            new \\CSRFSynchronizerToken(self::URL),"
          },
          {
            "type": "add",
            "line": "            $current_user->getId()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $renderer = \\TemplateRendererFactory::build()->getRenderer(__DIR__.'/../../../templates/user');"
          },
          {
            "type": "add",
            "line": "        $renderer->renderToPage('change-email', $presenter);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $response->footer(array());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function confirm(\\HTTPRequest $request, BaseLayout $response)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->processEvent('before_change_email-confirm', []);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $token = new \\CSRFSynchronizerToken(self::URL);"
          },
          {
            "type": "add",
            "line": "        $token->check();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $current_user = $request->getCurrentUser();"
          },
          {
            "type": "add",
            "line": "        if ($current_user->isAnonymous()) {"
          },
          {
            "type": "add",
            "line": "            $response->addFeedback(\\Feedback::ERROR, _('Unauthorized action for anonymous'));"
          },
          {
            "type": "add",
            "line": "            $response->redirect('/');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $new_mail = $request->getValidated('form_newemail', new \\Valid_Email(), '');"
          },
          {
            "type": "add",
            "line": "        if ($new_mail === '') {"
          },
          {
            "type": "add",
            "line": "            $response->addFeedback(\\Feedback::ERROR, _('Email format invalid'));"
          },
          {
            "type": "add",
            "line": "            $response->redirect('/change_email.php');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $confirmation_hash = (new \\RandomNumberGenerator())->getNumber();"
          },
          {
            "type": "add",
            "line": "        $this->user_manager->setEmailChangeConfirm($current_user->getId(), $confirmation_hash, $new_mail);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $subject = sprintf("
          },
          {
            "type": "add",
            "line": "            _('[%s] Email change confirmation'),"
          },
          {
            "type": "add",
            "line": "            \\ForgeConfig::get('sys_name')"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "        $message = sprintf("
          },
          {
            "type": "add",
            "line": "            _(\"You have requested a change of email address on %s.\\nPlease visit the following URL to complete the email change:\\n\\n%s\\n\\n-- The %s Team\"),"
          },
          {
            "type": "add",
            "line": "            \\ForgeConfig::get('sys_name'),"
          },
          {
            "type": "add",
            "line": "            $request->getServerUrl().$this->getChangeCompleteUrl($confirmation_hash),"
          },
          {
            "type": "add",
            "line": "            \\ForgeConfig::get('sys_name')"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $mail = new \\Mail();"
          },
          {
            "type": "add",
            "line": "        $mail->setTo($new_mail, true);"
          },
          {
            "type": "add",
            "line": "        $mail->setSubject($subject);"
          },
          {
            "type": "add",
            "line": "        $mail->setBody($message);"
          },
          {
            "type": "add",
            "line": "        $mail->setFrom(\\ForgeConfig::get('sys_noreply'));"
          },
          {
            "type": "add",
            "line": "        if (! $mail->send()) {"
          },
          {
            "type": "add",
            "line": "            $error_message = sprintf(_('The mail was not accepted for the delivery. Please contact the administrator at %s.'), \\ForgeConfig::get('sys_email_admin'));"
          },
          {
            "type": "add",
            "line": "            $response->addFeedback(\\Feedback::ERROR, $error_message);"
          },
          {
            "type": "add",
            "line": "            $response->redirect('/change_email.php');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $response->header(['title' => _('Email change confirmation')]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $renderer = \\TemplateRendererFactory::build()->getRenderer(__DIR__.'/../../../templates/user');"
          },
          {
            "type": "add",
            "line": "        $renderer->renderToPage('change-email-confirm', []);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $response->footer([]);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function complete(\\HTTPRequest $request, BaseLayout $response)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->processEvent('before_change_email-complete', []);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $current_user = $request->getCurrentUser();"
          },
          {
            "type": "add",
            "line": "        if ($current_user->isAnonymous()) {"
          },
          {
            "type": "add",
            "line": "            $url_redirect  = new \\URLRedirect($this->event_manager);"
          },
          {
            "type": "add",
            "line": "            $return_to     = $this->getChangeCompleteUrl($request->getValidated('confirm_hash', 'string', ''));"
          },
          {
            "type": "add",
            "line": "            $response->redirect($url_redirect->makeReturnToUrl('/account/login.php', $return_to));"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $user = $this->user_manager->getUserByConfirmHash("
          },
          {
            "type": "add",
            "line": "            $request->getValidated('confirm_hash', 'string', '')"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if ($user === null) {"
          },
          {
            "type": "add",
            "line": "            $response->addFeedback(\\Feedback::ERROR, _('This hash key exists more than once'));"
          },
          {
            "type": "add",
            "line": "            $response->redirect('/');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if ($user->getId() != $current_user->getId()) {"
          },
          {
            "type": "add",
            "line": "            $response->addFeedback(\\Feedback::ERROR, _('You are not the user who asked for email change'));"
          },
          {
            "type": "add",
            "line": "            $response->redirect('/');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $old_email_user = clone $user;"
          },
          {
            "type": "add",
            "line": "        $user->clearConfirmHash();"
          },
          {
            "type": "add",
            "line": "        $user->setEmail($old_email_user->getEmailNew());"
          },
          {
            "type": "add",
            "line": "        $user->setEmailNew($old_email_user->getEmail());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->user_manager->updateDb($user);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $response->header(['title' => _('Email change complete')]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $renderer = \\TemplateRendererFactory::build()->getRenderer(__DIR__.'/../../../templates/user');"
          },
          {
            "type": "add",
            "line": "        $renderer->renderToPage("
          },
          {
            "type": "add",
            "line": "            'change-email-complete',"
          },
          {
            "type": "add",
            "line": "            ["
          },
          {
            "type": "add",
            "line": "                'realname' => $user->getRealName(),"
          },
          {
            "type": "add",
            "line": "                'email'    => $user->getEmail(),"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $response->footer([]);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private function getChangeCompleteUrl($confirmation_hash)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return '/account/change_email-complete.php?confirm_hash='.$confirmation_hash;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/common/user/Account/ChangePasswordPresenter.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..c7924b4d55b"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/user/Account/ChangePasswordPresenter.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2018. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\User\\Account;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class ChangePasswordPresenter"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @var int"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    public $user_id;"
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @var CSRFSynchronizerToken"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    public $csrf_token;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function __construct(\\CSRFSynchronizerToken $csrf_token, $user_id)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->csrf_token = $csrf_token;"
          },
          {
            "type": "add",
            "line": "        $this->user_id    = $user_id;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/common/user/UserManager.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index e92cf98178c..de62881635d 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/user/UserManager.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/user/UserManager.class.php"
          },
          {
            "type": "context",
            "line": "         $dao = $this->getDao();"
          },
          {
            "type": "context",
            "line": "         $dao->removeConfirmHash($confirm_hash);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function setEmailChangeConfirm($user_id, $confirm_hash, $email_new)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return $this->getDao()->setEmailChangeConfirm($user_id, $confirm_hash, $email_new);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "src/templates/user/change-email-complete.mustache",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..baa681d8c8f"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/templates/user/change-email-complete.mustache"
          },
          {
            "type": "add",
            "line": "<h2>{{# gettext }}Email change complete{{/ gettext}}</h2>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>{{# gettext }}Welcome, %s.| {{ realname }}{{/ gettext }}</p>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>{{# gettext }}Your email change is complete. Your new email address is <strong>%s</strong>. | {{ email }}{{/ gettext}}</p>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>"
          },
          {
            "type": "add",
            "line": "    <a href=\"/\">{{# gettext }}back to home page{{/ gettext }}</a>"
          },
          {
            "type": "add",
            "line": "</p>"
          }
        ]
      },
      {
        "file": "src/templates/user/change-email-confirm.mustache",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..073583897a9"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/templates/user/change-email-confirm.mustache"
          },
          {
            "type": "add",
            "line": "<h2>{{# gettext }}Email change confirmation{{/ gettext}}</h2>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>{{# gettext }}An email has been sent to the new address. Follow the instructions in the email to complete the email change.{{/ gettext}}</p>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>"
          },
          {
            "type": "add",
            "line": "    <a href=\"/\">{{# gettext }}back to home page{{/ gettext }}</a>"
          },
          {
            "type": "add",
            "line": "</p>"
          }
        ]
      },
      {
        "file": "src/templates/user/change-email.mustache",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..3fc24920758"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/templates/user/change-email.mustache"
          },
          {
            "type": "add",
            "line": "<h2>{{# gettext }}Change email address{{/ gettext}}</h2>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>{{# gettext }}Changing your email address will require confirmation from your new email address, so that we can ensure we have a good email address on file.{{/ gettext }}</p>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>{{# gettext }}Submitting the form below will mail a confirmation URL to the new email address. Visiting this link will complete the email change.{{/ gettext }}</p>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<form action=\"change_email-confirm.php\" method=\"post\" class=\"form-inline\">"
          },
          {
            "type": "add",
            "line": "    {{# csrf_token }}"
          },
          {
            "type": "add",
            "line": "        {{> csrf_token_input }}"
          },
          {
            "type": "add",
            "line": "    {{/ csrf_token }}"
          },
          {
            "type": "add",
            "line": "    {{# gettext }}New email address:{{/ gettext }} <input type=\"text\" size=\"30\" name=\"form_newemail\" />"
          },
          {
            "type": "add",
            "line": "    <input class=\"btn btn-primary\" type=\"submit\" name=\"Send Confirmation to New Address\" value=\"{{# gettext }}Send confirmation to new address{{/ gettext }}\">"
          },
          {
            "type": "add",
            "line": "</form>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "<p>"
          },
          {
            "type": "add",
            "line": "    <a href=\"/\">{{# gettext }}back to home page{{/ gettext }}</a>"
          },
          {
            "type": "add",
            "line": "</p>"
          }
        ]
      },
      {
        "file": "src/www/account/change_email-complete.php",
        "changes": [
          {
            "type": "context",
            "line": "index 5475ff70553..e7863facc09 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/account/change_email-complete.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/account/change_email-complete.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "delete",
            "line": "/* SourceForge: Breaking Down the Barriers to Open Source Development"
          },
          {
            "type": "delete",
            "line": " * Copyright (c) Enalean, 2015. All Rights Reserved."
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2018. All rights reserved"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * This file is a part of Tuleap."
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "context",
            "line": "  * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "delete",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the"
          },
          {
            "type": "context",
            "line": "  * GNU General Public License for more details."
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "delete",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "require_once('pre.php');"
          },
          {
            "type": "add",
            "line": "require_once 'pre.php';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$em = EventManager::instance();"
          },
          {
            "type": "delete",
            "line": "$em->processEvent('before_change_email-complete', array());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$hp = Codendi_HTMLPurifier::instance();"
          },
          {
            "type": "delete",
            "line": "$request = HTTPRequest::instance();"
          },
          {
            "type": "delete",
            "line": "$user_manager = UserManager::instance();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "/** @var PFUser */"
          },
          {
            "type": "delete",
            "line": "$user = $user_manager->getUserByConfirmHash($request->getValidated('confirm_hash', 'string', ''));"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "if ($user === null) {"
          },
          {
            "type": "delete",
            "line": "    $GLOBALS['Response']->addFeedback(Feedback::ERROR, $Language->getText('account_change_email-complete', 'duplicate_hash'));"
          },
          {
            "type": "delete",
            "line": "    $GLOBALS['Response']->redirect('/');"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$old_email_user = clone $user;"
          },
          {
            "type": "delete",
            "line": "$user->clearConfirmHash();"
          },
          {
            "type": "delete",
            "line": "$user->setEmail($old_email_user->getEmailNew());"
          },
          {
            "type": "delete",
            "line": "$user->setEmailNew($old_email_user->getEmail());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$user_manager->updateDb($user);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$em->processEvent(Event::USER_EMAIL_CHANGED, $user->getId());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$HTML->header(array('title'=>$Language->getText('account_change_email-complete', 'title')));"
          },
          {
            "type": "delete",
            "line": "?>"
          },
          {
            "type": "delete",
            "line": "<p><b><?php echo $Language->getText('account_change_email-complete', 'title'); ?></b>"
          },
          {
            "type": "delete",
            "line": "<P><?php echo $Language->getText('account_change_email-complete', 'message',"
          },
          {
            "type": "delete",
            "line": "\t\t\t     array(  $hp->purify($user->getRealname(), CODENDI_PURIFIER_CONVERT_HTML) , $user->getEmail(),"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t    $GLOBALS['sys_name'], $user->getUsername())); ?>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<P><A href=\"/\">[ <?php echo $Language->getText('global', 'back_home'); ?> ]</A>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<?php"
          },
          {
            "type": "delete",
            "line": "$HTML->footer(array());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "?>"
          },
          {
            "type": "add",
            "line": "$controller = new \\Tuleap\\User\\Account\\ChangePasswordController(UserManager::instance(), EventManager::instance());"
          },
          {
            "type": "add",
            "line": "$controller->complete(HTTPRequest::instance(), $GLOBALS['Response']);"
          }
        ]
      },
      {
        "file": "src/www/account/change_email-confirm.php",
        "changes": [
          {
            "type": "context",
            "line": "index 70b0c45c4b6..b1705abcfc1 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/account/change_email-confirm.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/account/change_email-confirm.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "delete",
            "line": "//"
          },
          {
            "type": "delete",
            "line": "// SourceForge: Breaking Down the Barriers to Open Source Development"
          },
          {
            "type": "delete",
            "line": "// Copyright 1999-2000 (c) The SourceForge Crew"
          },
          {
            "type": "delete",
            "line": "// http://sourceforge.net"
          },
          {
            "type": "delete",
            "line": "//"
          },
          {
            "type": "delete",
            "line": "//"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "require_once('pre.php');"
          },
          {
            "type": "delete",
            "line": "require_once('common/mail/Mail.class.php');"
          },
          {
            "type": "delete",
            "line": "require_once('common/event/EventManager.class.php');"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$em =& EventManager::instance();"
          },
          {
            "type": "delete",
            "line": "$em->processEvent('before_change_email-confirm', array());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$request =& HTTPRequest::instance();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$confirm_hash = substr(md5($GLOBALS['session_hash'] . time()),0,16);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$res_user = db_query(\"SELECT * FROM user WHERE user_id=\".user_getid());"
          },
          {
            "type": "delete",
            "line": "if (db_numrows($res_user) < 1) exit_error(\"Invalid User\",\"That user does not exist.\");"
          },
          {
            "type": "delete",
            "line": "$row_user = db_fetch_array($res_user);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$mail_is_sent = false;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$form_newemail = $request->get('form_newemail');"
          },
          {
            "type": "delete",
            "line": "if(validate_email($form_newemail)) {"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    db_query(\"UPDATE user SET confirm_hash='\".$confirm_hash.\"',email_new='\".db_es($form_newemail).\"' \""
          },
          {
            "type": "delete",
            "line": "             . \"WHERE user_id=\".$row_user['user_id']);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    $message = stripcslashes($Language->getText('account_change_email-confirm', 'message', array($GLOBALS['sys_name'], get_server_url().\"/account/change_email-complete.php?confirm_hash=\".$confirm_hash)));"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    $mail = new Mail();"
          },
          {
            "type": "delete",
            "line": "    $mail->setTo($form_newemail,true);"
          },
          {
            "type": "delete",
            "line": "    $mail->setSubject($GLOBALS['sys_name'].': '.$Language->getText('account_change_email-confirm', 'title'));"
          },
          {
            "type": "delete",
            "line": "    $mail->setBody($message);"
          },
          {
            "type": "delete",
            "line": "    $mail->setFrom($GLOBALS['sys_noreply']);"
          },
          {
            "type": "delete",
            "line": "    $mail_is_sent = $mail->send();"
          },
          {
            "type": "delete",
            "line": "    if (!$mail_is_sent) {"
          },
          {
            "type": "delete",
            "line": "        $GLOBALS['Response']->addFeedback('error', $GLOBALS['Language']->getText('global', 'mail_failed', array($GLOBALS['sys_email_admin'])));"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "} else {"
          },
          {
            "type": "delete",
            "line": "    $GLOBALS['Response']->addFeedback('error', $GLOBALS['Language']->getText('include_utils', 'invalid_email'));"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": "site_header(array('title'=>$Language->getText('account_change_email-confirm', 'title'))); ?>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<P><B><?php if ($mail_is_sent) { echo $Language->getText('account_change_email-confirm', 'title'); ?></B>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<P><?php echo $Language->getText('account_change_email-confirm', 'mailsent'); ?>."
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<?php"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": "echo '<p><a href=\"/\">['. $Language->getText('global', 'back_home'). ']</a></p>';"
          },
          {
            "type": "delete",
            "line": "site_footer(array());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "?>"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2018. All rights reserved"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "require_once 'pre.php';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "$controller = new \\Tuleap\\User\\Account\\ChangePasswordController(UserManager::instance(), EventManager::instance());"
          },
          {
            "type": "add",
            "line": "$controller->confirm(HTTPRequest::instance(), $GLOBALS['Response']);"
          }
        ]
      },
      {
        "file": "src/www/account/change_email.php",
        "changes": [
          {
            "type": "context",
            "line": "index 74ca78235c3..7caa01b12f7 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/account/change_email.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/account/change_email.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "delete",
            "line": "//"
          },
          {
            "type": "delete",
            "line": "// SourceForge: Breaking Down the Barriers to Open Source Development"
          },
          {
            "type": "delete",
            "line": "// Copyright 1999-2000 (c) The SourceForge Crew"
          },
          {
            "type": "delete",
            "line": "// http://sourceforge.net"
          },
          {
            "type": "delete",
            "line": "//"
          },
          {
            "type": "delete",
            "line": "//"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "require_once('pre.php');"
          },
          {
            "type": "delete",
            "line": "require_once('common/event/EventManager.class.php');"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$em =& EventManager::instance();"
          },
          {
            "type": "delete",
            "line": "$em->processEvent('before_change_email', array());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "session_require(array('isloggedin'=>1));"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "$HTML->header(array('title'=> $Language->getText('account_change_email', 'title')));"
          },
          {
            "type": "delete",
            "line": "$csrf = new CSRFSynchronizerToken('/account/change_email.php');"
          },
          {
            "type": "delete",
            "line": "?>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<h2><?php echo $Language->getText('account_change_email', 'title'); ?></h2>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<?php echo $Language->getText('account_change_email', 'message'); ?>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<FORM action=\"change_email-confirm.php\" method=\"post\" class=\"form-inline\">"
          },
          {
            "type": "delete",
            "line": "<?php"
          },
          {
            "type": "delete",
            "line": "echo $csrf->fetchHTMLInput();"
          },
          {
            "type": "delete",
            "line": "?>"
          },
          {
            "type": "delete",
            "line": "<INPUT type=\"hidden\" name=\"form_user\" value=\"<?php print user_getid(); ?>\">"
          },
          {
            "type": "delete",
            "line": "<BR>"
          },
          {
            "type": "delete",
            "line": "<?php echo $Language->getText('account_change_email', 'label_new'); ?>:"
          },
          {
            "type": "delete",
            "line": "<INPUT type=\"text\" size=\"30\" name=\"form_newemail\">"
          },
          {
            "type": "delete",
            "line": "<INPUT class=\"btn btn-primary\" type=\"submit\" name=\"Send Confirmation to New Address\" value=\"<?php echo $Language->getText('account_change_email', 'send_new'); ?>\">"
          },
          {
            "type": "delete",
            "line": "</FORM>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<A href=\"/\">[<?php echo $Language->getText('global', 'back_home'); ?>]</A>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<?php"
          },
          {
            "type": "delete",
            "line": "$HTML->footer(array());"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "?>"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2018. All rights reserved"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "require_once 'pre.php';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "$controller = new \\Tuleap\\User\\Account\\ChangePasswordController(UserManager::instance(), EventManager::instance());"
          },
          {
            "type": "add",
            "line": "$controller->change(HTTPRequest::instance(), $GLOBALS['Response']);"
          }
        ]
      },
      {
        "file": "src/www/project/admin/editgenericmember.php",
        "changes": [
          {
            "type": "context",
            "line": "index 699197abb3d..1f123ed68fa 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/project/admin/editgenericmember.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/project/admin/editgenericmember.php"
          },
          {
            "type": "context",
            "line": "         '. $generic_user->getRealName() .'"
          },
          {
            "type": "context",
            "line": "     </p>"
          },
          {
            "type": "context",
            "line": "     <p>"
          },
          {
            "type": "delete",
            "line": "        <label for=\"generic_user_email\"><b>'. $Language->getText('account_change_email', 'title') .'</b>:</label><br />"
          },
          {
            "type": "add",
            "line": "        <label for=\"generic_user_email\"><b>'. _('Change email address') .'</b>:</label><br />"
          },
          {
            "type": "context",
            "line": "         <input type=\"email\" name=\"email\" id=\"generic_user_email\" value=\"'."
          },
          {
            "type": "context",
            "line": "             $hp->purify($generic_user->getEmail(), CODENDI_PURIFIER_CONVERT_HTML) .'\" />"
          },
          {
            "type": "context",
            "line": "      </p>"
          }
        ]
      }
    ]
  },
  {
    "commit": "086ba77a6db00ed858ff07451bedee197df868c9",
    "files": [
      {
        "file": "kernel/trace/trace_syscalls.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4dc8b79c5f75..29228c4d5696 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/trace/trace_syscalls.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/trace/trace_syscalls.c"
          },
          {
            "type": "context",
            "line": " \tint size;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tsyscall_nr = trace_get_syscall_nr(current, regs);"
          },
          {
            "type": "delete",
            "line": "\tif (syscall_nr < 0)"
          },
          {
            "type": "add",
            "line": "\tif (syscall_nr < 0 || syscall_nr >= NR_syscalls)"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Here we're inside tp handler's rcu_read_lock_sched (__DO_TRACE) */"
          },
          {
            "type": "context",
            "line": " \tint syscall_nr;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tsyscall_nr = trace_get_syscall_nr(current, regs);"
          },
          {
            "type": "delete",
            "line": "\tif (syscall_nr < 0)"
          },
          {
            "type": "add",
            "line": "\tif (syscall_nr < 0 || syscall_nr >= NR_syscalls)"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Here we're inside tp handler's rcu_read_lock_sched (__DO_TRACE()) */"
          },
          {
            "type": "context",
            "line": " \tint size;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tsyscall_nr = trace_get_syscall_nr(current, regs);"
          },
          {
            "type": "delete",
            "line": "\tif (syscall_nr < 0)"
          },
          {
            "type": "add",
            "line": "\tif (syscall_nr < 0 || syscall_nr >= NR_syscalls)"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          },
          {
            "type": "context",
            "line": " \tif (!test_bit(syscall_nr, enabled_perf_enter_syscalls))"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          },
          {
            "type": "context",
            "line": " \tint size;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tsyscall_nr = trace_get_syscall_nr(current, regs);"
          },
          {
            "type": "delete",
            "line": "\tif (syscall_nr < 0)"
          },
          {
            "type": "add",
            "line": "\tif (syscall_nr < 0 || syscall_nr >= NR_syscalls)"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          },
          {
            "type": "context",
            "line": " \tif (!test_bit(syscall_nr, enabled_perf_exit_syscalls))"
          },
          {
            "type": "context",
            "line": " \t\treturn;"
          }
        ]
      }
    ]
  },
  {
    "commit": "088aaf17aa79300cab14dbee2569c58cfafd7d6e",
    "files": [
      {
        "file": "fs/cifs/smb2pdu.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5d1f8d2d44e4..5d6adc63ad62 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/cifs/smb2pdu.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/cifs/smb2pdu.c"
          },
          {
            "type": "context",
            "line": " \trqst.rq_nvec = 1;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \trc = cifs_send_recv(xid, ses, &rqst, &resp_buftype, flags, &rsp_iov);"
          },
          {
            "type": "delete",
            "line": "\tcifs_small_buf_release(req);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \trsp = (struct smb2_read_rsp *)rsp_iov.iov_base;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (rc) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t    io_parms->tcon->tid, ses->Suid,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t    io_parms->offset, io_parms->length);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tcifs_small_buf_release(req);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t*nbytes = le32_to_cpu(rsp->DataLength);"
          },
          {
            "type": "context",
            "line": " \tif ((*nbytes > CIFS_MAX_MSGSIZE) ||"
          },
          {
            "type": "context",
            "line": " \t    (*nbytes > io_parms->length)) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "089bc0143f489bd3a4578bdff5f4ca68fb26f341",
    "files": [
      {
        "file": "drivers/block/xen-blkback/blkback.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6b14c509f3c7..0e824091a12f 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/block/xen-blkback/blkback.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/block/xen-blkback/blkback.c"
          },
          {
            "type": "context",
            "line": " static void make_response(struct xen_blkif_ring *ring, u64 id,"
          },
          {
            "type": "context",
            "line": " \t\t\t  unsigned short op, int st)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tstruct blkif_response  resp;"
          },
          {
            "type": "add",
            "line": "\tstruct blkif_response *resp;"
          },
          {
            "type": "context",
            "line": " \tunsigned long     flags;"
          },
          {
            "type": "context",
            "line": " \tunion blkif_back_rings *blk_rings;"
          },
          {
            "type": "context",
            "line": " \tint notify;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tresp.id        = id;"
          },
          {
            "type": "delete",
            "line": "\tresp.operation = op;"
          },
          {
            "type": "delete",
            "line": "\tresp.status    = st;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tspin_lock_irqsave(&ring->blk_ring_lock, flags);"
          },
          {
            "type": "context",
            "line": " \tblk_rings = &ring->blk_rings;"
          },
          {
            "type": "context",
            "line": " \t/* Place on the response ring for the relevant domain. */"
          },
          {
            "type": "context",
            "line": " \tswitch (ring->blkif->blk_protocol) {"
          },
          {
            "type": "context",
            "line": " \tcase BLKIF_PROTOCOL_NATIVE:"
          },
          {
            "type": "delete",
            "line": "\t\tmemcpy(RING_GET_RESPONSE(&blk_rings->native, blk_rings->native.rsp_prod_pvt),"
          },
          {
            "type": "delete",
            "line": "\t\t       &resp, sizeof(resp));"
          },
          {
            "type": "add",
            "line": "\t\tresp = RING_GET_RESPONSE(&blk_rings->native,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t blk_rings->native.rsp_prod_pvt);"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase BLKIF_PROTOCOL_X86_32:"
          },
          {
            "type": "delete",
            "line": "\t\tmemcpy(RING_GET_RESPONSE(&blk_rings->x86_32, blk_rings->x86_32.rsp_prod_pvt),"
          },
          {
            "type": "delete",
            "line": "\t\t       &resp, sizeof(resp));"
          },
          {
            "type": "add",
            "line": "\t\tresp = RING_GET_RESPONSE(&blk_rings->x86_32,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t blk_rings->x86_32.rsp_prod_pvt);"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase BLKIF_PROTOCOL_X86_64:"
          },
          {
            "type": "delete",
            "line": "\t\tmemcpy(RING_GET_RESPONSE(&blk_rings->x86_64, blk_rings->x86_64.rsp_prod_pvt),"
          },
          {
            "type": "delete",
            "line": "\t\t       &resp, sizeof(resp));"
          },
          {
            "type": "add",
            "line": "\t\tresp = RING_GET_RESPONSE(&blk_rings->x86_64,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t blk_rings->x86_64.rsp_prod_pvt);"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tdefault:"
          },
          {
            "type": "context",
            "line": " \t\tBUG();"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tresp->id        = id;"
          },
          {
            "type": "add",
            "line": "\tresp->operation = op;"
          },
          {
            "type": "add",
            "line": "\tresp->status    = st;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tblk_rings->common.rsp_prod_pvt++;"
          },
          {
            "type": "context",
            "line": " \tRING_PUSH_RESPONSES_AND_CHECK_NOTIFY(&blk_rings->common, notify);"
          },
          {
            "type": "context",
            "line": " \tspin_unlock_irqrestore(&ring->blk_ring_lock, flags);"
          }
        ]
      },
      {
        "file": "drivers/block/xen-blkback/common.h",
        "changes": [
          {
            "type": "context",
            "line": "index 638597b17a38..ecb35fe8ca8d 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/block/xen-blkback/common.h"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/block/xen-blkback/common.h"
          },
          {
            "type": "context",
            "line": " struct blkif_common_request {"
          },
          {
            "type": "context",
            "line": " \tchar dummy;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "delete",
            "line": "struct blkif_common_response {"
          },
          {
            "type": "delete",
            "line": "\tchar dummy;"
          },
          {
            "type": "delete",
            "line": "};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "/* i386 protocol version */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct blkif_x86_32_request_rw {"
          },
          {
            "type": "context",
            "line": " \tuint8_t        nr_segments;  /* number of segments                   */"
          },
          {
            "type": "context",
            "line": " \t} u;"
          },
          {
            "type": "context",
            "line": " } __attribute__((__packed__));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "/* i386 protocol version */"
          },
          {
            "type": "delete",
            "line": "#pragma pack(push, 4)"
          },
          {
            "type": "delete",
            "line": "struct blkif_x86_32_response {"
          },
          {
            "type": "delete",
            "line": "\tuint64_t        id;              /* copied from request */"
          },
          {
            "type": "delete",
            "line": "\tuint8_t         operation;       /* copied from request */"
          },
          {
            "type": "delete",
            "line": "\tint16_t         status;          /* BLKIF_RSP_???       */"
          },
          {
            "type": "delete",
            "line": "};"
          },
          {
            "type": "delete",
            "line": "#pragma pack(pop)"
          },
          {
            "type": "context",
            "line": " /* x86_64 protocol version */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct blkif_x86_64_request_rw {"
          },
          {
            "type": "context",
            "line": " \t} u;"
          },
          {
            "type": "context",
            "line": " } __attribute__((__packed__));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "struct blkif_x86_64_response {"
          },
          {
            "type": "delete",
            "line": "\tuint64_t       __attribute__((__aligned__(8))) id;"
          },
          {
            "type": "delete",
            "line": "\tuint8_t         operation;       /* copied from request */"
          },
          {
            "type": "delete",
            "line": "\tint16_t         status;          /* BLKIF_RSP_???       */"
          },
          {
            "type": "delete",
            "line": "};"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " DEFINE_RING_TYPES(blkif_common, struct blkif_common_request,"
          },
          {
            "type": "delete",
            "line": "\t\t  struct blkif_common_response);"
          },
          {
            "type": "add",
            "line": "\t\t  struct blkif_response);"
          },
          {
            "type": "context",
            "line": " DEFINE_RING_TYPES(blkif_x86_32, struct blkif_x86_32_request,"
          },
          {
            "type": "delete",
            "line": "\t\t  struct blkif_x86_32_response);"
          },
          {
            "type": "add",
            "line": "\t\t  struct blkif_response __packed);"
          },
          {
            "type": "context",
            "line": " DEFINE_RING_TYPES(blkif_x86_64, struct blkif_x86_64_request,"
          },
          {
            "type": "delete",
            "line": "\t\t  struct blkif_x86_64_response);"
          },
          {
            "type": "add",
            "line": "\t\t  struct blkif_response);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " union blkif_back_rings {"
          },
          {
            "type": "context",
            "line": " \tstruct blkif_back_ring        native;"
          }
        ]
      }
    ]
  },
  {
    "commit": "08a07a38ae81f3b55d81cfcd4501ac1eb1c9c4dc",
    "files": [
      {
        "file": "app/Config/config.default.php",
        "changes": [
          {
            "type": "context",
            "line": "index dea2f9d8a..eee991773 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/Config/config.default.php"
          },
          {
            "type": "context",
            "line": "+++ b/app/Config/config.default.php"
          },
          {
            "type": "context",
            "line": "         'user_monitoring_enabled'           => false,"
          },
          {
            "type": "context",
            "line": "         'authkey_keep_session'              => false,"
          },
          {
            "type": "context",
            "line": "         'disable_local_feed_access'         => false,"
          },
          {
            "type": "add",
            "line": "        'enable_svg_logos'                  => false,"
          },
          {
            "type": "context",
            "line": "         //'auth'                            => array('CertAuth.Certificate'), // additional authentication methods"
          },
          {
            "type": "context",
            "line": "         //'auth'                            => array('ShibbAuth.ApacheShibb'),"
          },
          {
            "type": "context",
            "line": "         //'auth'                            => array('AadAuth.AadAuthenticate'),"
          }
        ]
      },
      {
        "file": "app/Controller/OrganisationsController.php",
        "changes": [
          {
            "type": "context",
            "line": "index 78ca7dc79..7d9f6345d 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/Controller/OrganisationsController.php"
          },
          {
            "type": "context",
            "line": "+++ b/app/Controller/OrganisationsController.php"
          },
          {
            "type": "context",
            "line": "         if ($logo['size'] > 0 && $logo['error'] == 0) {"
          },
          {
            "type": "context",
            "line": "             $extension = pathinfo($logo['name'], PATHINFO_EXTENSION);"
          },
          {
            "type": "context",
            "line": "             $filename = $orgId . '.' . ($extension === 'svg' ? 'svg' : 'png');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if ($extension === 'svg' && !Configure::read('Security.enable_svg_logos')) {"
          },
          {
            "type": "add",
            "line": "                $this->Flash->error(__('Invalid file extension, SVG images are not allowed.'));"
          },
          {
            "type": "add",
            "line": "                return false;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (!empty($logo['tmp_name']) && is_uploaded_file($logo['tmp_name'])) {"
          },
          {
            "type": "context",
            "line": "                 return move_uploaded_file($logo['tmp_name'], APP . 'webroot/img/orgs/' . $filename);"
          },
          {
            "type": "context",
            "line": "             }"
          }
        ]
      },
      {
        "file": "app/Model/Server.php",
        "changes": [
          {
            "type": "context",
            "line": "index 0c05bdf51..9b987bb6a 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/Model/Server.php"
          },
          {
            "type": "context",
            "line": "+++ b/app/Model/Server.php"
          },
          {
            "type": "context",
            "line": "                         'tlsv1_3' => 'TLSv1.3',"
          },
          {
            "type": "context",
            "line": "                     ],"
          },
          {
            "type": "context",
            "line": "                 ],"
          },
          {
            "type": "add",
            "line": "                'enable_svg_logos' => ["
          },
          {
            "type": "add",
            "line": "                    'level' => self::SETTING_OPTIONAL,"
          },
          {
            "type": "add",
            "line": "                    'description' => __('When enabled, orgnisation logos in svg format are allowed.'),"
          },
          {
            "type": "add",
            "line": "                    'value' => false,"
          },
          {
            "type": "add",
            "line": "                    'test' => 'testBool',"
          },
          {
            "type": "add",
            "line": "                    'type' => 'boolean',"
          },
          {
            "type": "add",
            "line": "                    'null' => true"
          },
          {
            "type": "add",
            "line": "                ]"
          },
          {
            "type": "context",
            "line": "             ),"
          },
          {
            "type": "context",
            "line": "             'SecureAuth' => array("
          },
          {
            "type": "context",
            "line": "                 'branch' => 1,"
          }
        ]
      },
      {
        "file": "app/View/Organisations/admin_add.ctp",
        "changes": [
          {
            "type": "context",
            "line": "index 97d51fc43..202745e86 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/View/Organisations/admin_add.ctp"
          },
          {
            "type": "context",
            "line": "+++ b/app/View/Organisations/admin_add.ctp"
          },
          {
            "type": "context",
            "line": "                 'type' => 'file',"
          },
          {
            "type": "context",
            "line": "                 'field' => 'logo',"
          },
          {
            "type": "context",
            "line": "                 'error' => array('escape' => false),"
          },
          {
            "type": "delete",
            "line": "                'label' => __('Logo (48×48 PNG or SVG)'),"
          },
          {
            "type": "add",
            "line": "                'label' => __('Logo (48×48 %s)', Configure::read('Security.enable_svg_logos')? 'PNG or SVG' : 'PNG'),"
          },
          {
            "type": "context",
            "line": "             ],"
          },
          {
            "type": "context",
            "line": "             ["
          },
          {
            "type": "context",
            "line": "                 'field' => 'nationality',"
          }
        ]
      }
    ]
  },
  {
    "commit": "08bd23281ead288de678de666ef43ed6de1899fc",
    "files": [
      {
        "file": "app/Model/AppModel.php",
        "changes": [
          {
            "type": "context",
            "line": "index e82e0723a..2ee10aa84 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/Model/AppModel.php"
          },
          {
            "type": "context",
            "line": "+++ b/app/Model/AppModel.php"
          },
          {
            "type": "context",
            "line": "             foreach ($filters as $f) {"
          },
          {
            "type": "context",
            "line": "                 if ($f === -1) {"
          },
          {
            "type": "context",
            "line": "                     foreach ($keys as $key) {"
          },
          {
            "type": "delete",
            "line": "                        $temp['OR'][$key][] = -1;"
          },
          {
            "type": "add",
            "line": "                        if ($this->checkParam($key)) {"
          },
          {
            "type": "add",
            "line": "                            $temp['OR'][$key][] = -1;"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": "                     continue;"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 // split the filter params into two lists, one for substring searches one for exact ones"
          },
          {
            "type": "context",
            "line": "                 if (is_string($f) && ($f[strlen($f) - 1] === '%' || $f[0] === '%')) {"
          },
          {
            "type": "context",
            "line": "                     foreach ($keys as $key) {"
          },
          {
            "type": "delete",
            "line": "                        if ($operator === 'NOT') {"
          },
          {
            "type": "delete",
            "line": "                            $temp[] = array($key . ' NOT LIKE' => $f);"
          },
          {
            "type": "delete",
            "line": "                        } else {"
          },
          {
            "type": "delete",
            "line": "                            $temp[] = array($key . ' LIKE' => $f);"
          },
          {
            "type": "delete",
            "line": "                            $temp[] = array($key => $f);"
          },
          {
            "type": "add",
            "line": "                        if ($this->checkParam($key)) {"
          },
          {
            "type": "add",
            "line": "                            if ($operator === 'NOT') {"
          },
          {
            "type": "add",
            "line": "                                $temp[] = array($key . ' NOT LIKE' => $f);"
          },
          {
            "type": "add",
            "line": "                            } else {"
          },
          {
            "type": "add",
            "line": "                                $temp[] = array($key . ' LIKE' => $f);"
          },
          {
            "type": "add",
            "line": "                                $temp[] = array($key => $f);"
          },
          {
            "type": "add",
            "line": "                            }"
          },
          {
            "type": "context",
            "line": "                         }"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": "                 } else {"
          },
          {
            "type": "context",
            "line": "                     foreach ($keys as $key) {"
          },
          {
            "type": "delete",
            "line": "                        if ($operator === 'NOT') {"
          },
          {
            "type": "delete",
            "line": "                            $temp[$key . ' !='][] = $f;"
          },
          {
            "type": "delete",
            "line": "                        } else {"
          },
          {
            "type": "delete",
            "line": "                            $temp['OR'][$key][] = $f;"
          },
          {
            "type": "add",
            "line": "                        if ($this->checkParam($key)) {"
          },
          {
            "type": "add",
            "line": "                            if ($operator === 'NOT') {"
          },
          {
            "type": "add",
            "line": "                                $temp[$key . ' !='][] = $f;"
          },
          {
            "type": "add",
            "line": "                            } else {"
          },
          {
            "type": "add",
            "line": "                                $temp['OR'][$key][] = $f;"
          },
          {
            "type": "add",
            "line": "                            }"
          },
          {
            "type": "context",
            "line": "                         }"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": "                 }"
          }
        ]
      }
    ]
  },
  {
    "commit": "08dff7b7d629807dbb1f398c68dd9cd58dd657a1",
    "files": [
      {
        "file": "mm/memory_hotplug.c",
        "changes": [
          {
            "type": "context",
            "line": "index b8731040b9f9..597d371329d3 100644"
          },
          {
            "type": "context",
            "line": "--- a/mm/memory_hotplug.c"
          },
          {
            "type": "context",
            "line": "+++ b/mm/memory_hotplug.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tzone->present_pages += onlined_pages;"
          },
          {
            "type": "context",
            "line": " \tzone->zone_pgdat->node_present_pages += onlined_pages;"
          },
          {
            "type": "delete",
            "line": "\tif (need_zonelists_rebuild)"
          },
          {
            "type": "delete",
            "line": "\t\tbuild_all_zonelists(NULL, zone);"
          },
          {
            "type": "delete",
            "line": "\telse"
          },
          {
            "type": "delete",
            "line": "\t\tzone_pcp_update(zone);"
          },
          {
            "type": "add",
            "line": "\tif (onlined_pages) {"
          },
          {
            "type": "add",
            "line": "\t\tnode_set_state(zone_to_nid(zone), N_HIGH_MEMORY);"
          },
          {
            "type": "add",
            "line": "\t\tif (need_zonelists_rebuild)"
          },
          {
            "type": "add",
            "line": "\t\t\tbuild_all_zonelists(NULL, zone);"
          },
          {
            "type": "add",
            "line": "\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t\tzone_pcp_update(zone);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_unlock(&zonelists_mutex);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tinit_per_zone_wmark_min();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (onlined_pages) {"
          },
          {
            "type": "add",
            "line": "\tif (onlined_pages)"
          },
          {
            "type": "context",
            "line": " \t\tkswapd_run(zone_to_nid(zone));"
          },
          {
            "type": "delete",
            "line": "\t\tnode_set_state(zone_to_nid(zone), N_HIGH_MEMORY);"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tvm_total_pages = nr_free_pagecache_pages();"
          }
        ]
      }
    ]
  },
  {
    "commit": "0926f91083f34d047abc74f1ca4fa6a9c161f7db",
    "files": [
      {
        "file": "drivers/net/mlx4/port.c",
        "changes": [
          {
            "type": "context",
            "line": "index 606aa58afdea..8674ad5764c4 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/mlx4/port.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/mlx4/port.c"
          },
          {
            "type": "context",
            "line": " \t\t\tgoto out;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (free < 0) {"
          },
          {
            "type": "add",
            "line": "\t\terr = -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\t\tgoto out;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmlx4_dbg(dev, \"Free MAC index is %d\\n\", free);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (table->total == table->max) {"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (free < 0) {"
          },
          {
            "type": "add",
            "line": "\t\terr = -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\t\tgoto out;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (table->total == table->max) {"
          },
          {
            "type": "context",
            "line": " \t\t/* No free vlan entries */"
          },
          {
            "type": "context",
            "line": " \t\terr = -ENOSPC;"
          }
        ]
      }
    ]
  },
  {
    "commit": "093019cf1b18dd31b2c3b77acce4e000e2cbc9ce",
    "files": [
      {
        "file": "fs/xfs/xfs_acl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 76e4266d2e7e..ac702a6eab9b 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/xfs/xfs_acl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/xfs/xfs_acl.c"
          },
          {
            "type": "context",
            "line": " \tstruct posix_acl_entry *acl_e;"
          },
          {
            "type": "context",
            "line": " \tstruct posix_acl *acl;"
          },
          {
            "type": "context",
            "line": " \tstruct xfs_acl_entry *ace;"
          },
          {
            "type": "delete",
            "line": "\tint count, i;"
          },
          {
            "type": "add",
            "line": "\tunsigned int count, i;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tcount = be32_to_cpu(aclp->acl_cnt);"
          },
          {
            "type": "context",
            "line": " \tif (count > XFS_ACL_MAX_ENTRIES)"
          }
        ]
      }
    ]
  },
  {
    "commit": "093283e727f396130651280609e687cd4778e0d1",
    "files": [
      {
        "file": "src/isomedia/box_code_adobe.c",
        "changes": [
          {
            "type": "context",
            "line": "index 80be6f33e..eafdabff1 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/isomedia/box_code_adobe.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/isomedia/box_code_adobe.c"
          },
          {
            "type": "context",
            "line": " \tmemset(tmp_str, 0, sizeof(char)*tmp_strsize);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \twhile (tmp_strsize) {"
          },
          {
            "type": "add",
            "line": "\t\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \t\ttmp_str[i] = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\ttmp_strsize--;"
          },
          {
            "type": "context",
            "line": " \t\tif (!tmp_str[i])"
          },
          {
            "type": "context",
            "line": " \t\tptr->movie_identifier = gf_strdup(tmp_str);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \tptr->server_entry_count = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \tfor (i=0; i<ptr->server_entry_count; i++) {"
          },
          {
            "type": "context",
            "line": " \t\tint j=0;"
          },
          {
            "type": "delete",
            "line": "\t\ttmp_strsize=(u32)ptr->size-8;"
          },
          {
            "type": "add",
            "line": "\t\ttmp_strsize=(u32)ptr->size;"
          },
          {
            "type": "context",
            "line": " \t\twhile (tmp_strsize) {"
          },
          {
            "type": "add",
            "line": "\t\t\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \t\t\ttmp_str[j] = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\t\ttmp_strsize--;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (!tmp_str[j])"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \tptr->quality_entry_count = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \tfor (i=0; i<ptr->quality_entry_count; i++) {"
          },
          {
            "type": "context",
            "line": " \t\tint j=0;"
          },
          {
            "type": "delete",
            "line": "\t\ttmp_strsize=(u32)ptr->size-8;"
          },
          {
            "type": "add",
            "line": "\t\ttmp_strsize=(u32)ptr->size;"
          },
          {
            "type": "context",
            "line": " \t\twhile (tmp_strsize) {"
          },
          {
            "type": "add",
            "line": "\t\t\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \t\t\ttmp_str[j] = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\t\ttmp_strsize--;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (!tmp_str[j])"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ti=0;"
          },
          {
            "type": "delete",
            "line": "\ttmp_strsize=(u32)ptr->size-8;"
          },
          {
            "type": "add",
            "line": "\ttmp_strsize=(u32)ptr->size;"
          },
          {
            "type": "context",
            "line": " \twhile (tmp_strsize) {"
          },
          {
            "type": "add",
            "line": "\t\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \t\ttmp_str[i] = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\ttmp_strsize--;"
          },
          {
            "type": "context",
            "line": " \t\tif (!tmp_str[i])"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ti=0;"
          },
          {
            "type": "delete",
            "line": "\ttmp_strsize=(u32)ptr->size-8;"
          },
          {
            "type": "add",
            "line": "\ttmp_strsize=(u32)ptr->size;"
          },
          {
            "type": "context",
            "line": " \twhile (tmp_strsize) {"
          },
          {
            "type": "add",
            "line": "\t\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \t\ttmp_str[i] = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\ttmp_strsize--;"
          },
          {
            "type": "context",
            "line": " \t\tif (!tmp_str[i])"
          },
          {
            "type": "context",
            "line": " \t\tptr->meta_data = gf_strdup(tmp_str);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \tptr->segment_run_table_count = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \tfor (i=0; i<ptr->segment_run_table_count; i++) {"
          },
          {
            "type": "context",
            "line": " \t\tGF_AdobeSegmentRunTableBox *asrt = NULL;"
          },
          {
            "type": "context",
            "line": " \t\tgf_list_add(ptr->segment_run_table_entries, asrt);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tISOM_DECREASE_SIZE(ptr, 1)"
          },
          {
            "type": "context",
            "line": " \tptr->fragment_run_table_count = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \tfor (i=0; i<ptr->fragment_run_table_count; i++) {"
          },
          {
            "type": "context",
            "line": " \t\tGF_AdobeFragmentRunTableBox *afrt = NULL;"
          }
        ]
      }
    ]
  },
  {
    "commit": "096cdc6f52225835ff503f987a0d68ef770bb78e",
    "files": [
      {
        "file": "drivers/platform/chrome/cros_ec_dev.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6d8ee3b15872..8abd80dbcbed 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/platform/chrome/cros_ec_dev.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/platform/chrome/cros_ec_dev.c"
          },
          {
            "type": "context",
            "line": " \t\tgoto exit;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (u_cmd.outsize != s_cmd->outsize ||"
          },
          {
            "type": "add",
            "line": "\t    u_cmd.insize != s_cmd->insize) {"
          },
          {
            "type": "add",
            "line": "\t\tret = -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\tgoto exit;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ts_cmd->command += ec->cmd_offset;"
          },
          {
            "type": "context",
            "line": " \tret = cros_ec_cmd_xfer(ec->ec_dev, s_cmd);"
          },
          {
            "type": "context",
            "line": " \t/* Only copy data to userland if data was received. */"
          },
          {
            "type": "context",
            "line": " \tif (ret < 0)"
          },
          {
            "type": "context",
            "line": " \t\tgoto exit;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (copy_to_user(arg, s_cmd, sizeof(*s_cmd) + u_cmd.insize))"
          },
          {
            "type": "add",
            "line": "\tif (copy_to_user(arg, s_cmd, sizeof(*s_cmd) + s_cmd->insize))"
          },
          {
            "type": "context",
            "line": " \t\tret = -EFAULT;"
          },
          {
            "type": "context",
            "line": " exit:"
          },
          {
            "type": "context",
            "line": " \tkfree(s_cmd);"
          }
        ]
      }
    ]
  },
  {
    "commit": "096fe9eaea40a17e125569f9e657e34cdb6d73bd",
    "files": [
      {
        "file": "security/keys/encrypted-keys/encrypted.c",
        "changes": [
          {
            "type": "context",
            "line": "index 927db9f35ad6..696ccfa08d10 100644"
          },
          {
            "type": "context",
            "line": "--- a/security/keys/encrypted-keys/encrypted.c"
          },
          {
            "type": "context",
            "line": "+++ b/security/keys/encrypted-keys/encrypted.c"
          },
          {
            "type": "context",
            "line": " \tsize_t datalen = prep->datalen;"
          },
          {
            "type": "context",
            "line": " \tint ret = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (test_bit(KEY_FLAG_NEGATIVE, &key->flags))"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOKEY;"
          },
          {
            "type": "context",
            "line": " \tif (datalen <= 0 || datalen > 32767 || !prep->data)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "security/keys/trusted.c",
        "changes": [
          {
            "type": "context",
            "line": "index 903dace648a1..16dec53184b6 100644"
          },
          {
            "type": "context",
            "line": "--- a/security/keys/trusted.c"
          },
          {
            "type": "context",
            "line": "+++ b/security/keys/trusted.c"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " static int trusted_update(struct key *key, struct key_preparsed_payload *prep)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tstruct trusted_key_payload *p = key->payload.data[0];"
          },
          {
            "type": "add",
            "line": "\tstruct trusted_key_payload *p;"
          },
          {
            "type": "context",
            "line": " \tstruct trusted_key_payload *new_p;"
          },
          {
            "type": "context",
            "line": " \tstruct trusted_key_options *new_o;"
          },
          {
            "type": "context",
            "line": " \tsize_t datalen = prep->datalen;"
          },
          {
            "type": "context",
            "line": " \tchar *datablob;"
          },
          {
            "type": "context",
            "line": " \tint ret = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (test_bit(KEY_FLAG_NEGATIVE, &key->flags))"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOKEY;"
          },
          {
            "type": "add",
            "line": "\tp = key->payload.data[0];"
          },
          {
            "type": "context",
            "line": " \tif (!p->migratable)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EPERM;"
          },
          {
            "type": "context",
            "line": " \tif (datalen <= 0 || datalen > 32767 || !prep->data)"
          }
        ]
      },
      {
        "file": "security/keys/user_defined.c",
        "changes": [
          {
            "type": "context",
            "line": "index 28cb30f80256..8705d79b2c6f 100644"
          },
          {
            "type": "context",
            "line": "--- a/security/keys/user_defined.c"
          },
          {
            "type": "context",
            "line": "+++ b/security/keys/user_defined.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (ret == 0) {"
          },
          {
            "type": "context",
            "line": " \t\t/* attach the new data, displacing the old */"
          },
          {
            "type": "delete",
            "line": "\t\tzap = key->payload.data[0];"
          },
          {
            "type": "add",
            "line": "\t\tif (!test_bit(KEY_FLAG_NEGATIVE, &key->flags))"
          },
          {
            "type": "add",
            "line": "\t\t\tzap = key->payload.data[0];"
          },
          {
            "type": "add",
            "line": "\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t\tzap = NULL;"
          },
          {
            "type": "context",
            "line": " \t\trcu_assign_keypointer(key, upayload);"
          },
          {
            "type": "context",
            "line": " \t\tkey->expiry = 0;"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "0971c7a4e537ea120a6bb2195960be8d0815e97b",
    "files": [
      {
        "file": "src/edit.c",
        "changes": [
          {
            "type": "context",
            "line": "index dbfa0ae5f..a8e695c91 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/edit.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/edit.c"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t    // delete characters until we are at or before want_vcol"
          },
          {
            "type": "delete",
            "line": "\t    while (vcol > want_vcol"
          },
          {
            "type": "add",
            "line": "\t    while (vcol > want_vcol && curwin->w_cursor.col > 0"
          },
          {
            "type": "context",
            "line": " \t\t    && (cc = *(ml_get_cursor() - 1), VIM_ISWHITE(cc)))"
          },
          {
            "type": "context",
            "line": " \t\tins_bs_one(&vcol);"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index 9fba35bea..cf2e77d9f 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    5162,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     5161,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "0976c8fad6970b6182e7837bf87de07709407f25",
    "files": [
      {
        "file": "app/helpers/application_helper.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 7e3c903e3d..de0a22b0b1 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/helpers/application_helper.rb"
          },
          {
            "type": "context",
            "line": "+++ b/app/helpers/application_helper.rb"
          },
          {
            "type": "context",
            "line": "     google_universal_analytics_json"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  def self.google_tag_manager_nonce(env)"
          },
          {
            "type": "delete",
            "line": "    env[:discourse_content_security_policy_nonce] ||= SecureRandom.hex"
          },
          {
            "type": "add",
            "line": "  def google_tag_manager_nonce_placeholder"
          },
          {
            "type": "add",
            "line": "    placeholder = \"[[csp_nonce_placeholder_#{SecureRandom.hex}]]\""
          },
          {
            "type": "add",
            "line": "    response.headers[\"Discourse-GTM-Nonce-Placeholder\"] = placeholder"
          },
          {
            "type": "add",
            "line": "    placeholder"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def shared_session_key"
          }
        ]
      },
      {
        "file": "app/views/common/_google_tag_manager_head.html.erb",
        "changes": [
          {
            "type": "context",
            "line": "index 26790ca3db..56a77cfeed 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/views/common/_google_tag_manager_head.html.erb"
          },
          {
            "type": "context",
            "line": "+++ b/app/views/common/_google_tag_manager_head.html.erb"
          },
          {
            "type": "context",
            "line": " <meta id=\"data-google-tag-manager\""
          },
          {
            "type": "context",
            "line": "   data-data-layer=\"<%= google_tag_manager_json %>\""
          },
          {
            "type": "delete",
            "line": "  data-nonce=\"<%= ApplicationHelper.google_tag_manager_nonce(request.env) %>\""
          },
          {
            "type": "add",
            "line": "  data-nonce=\"<%= google_tag_manager_nonce_placeholder %>\""
          },
          {
            "type": "context",
            "line": "   data-container-id=\"<%= SiteSetting.gtm_container_id %>\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " <%= preload_script 'google-tag-manager' %>"
          }
        ]
      },
      {
        "file": "config/application.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 0962bccb6c..9664112df2 100644"
          },
          {
            "type": "context",
            "line": "--- a/config/application.rb"
          },
          {
            "type": "context",
            "line": "+++ b/config/application.rb"
          },
          {
            "type": "context",
            "line": "     config.middleware.swap ActionDispatch::ContentSecurityPolicy::Middleware,"
          },
          {
            "type": "context",
            "line": "                            ContentSecurityPolicy::Middleware"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    require \"middleware/gtm_script_nonce_injector\""
          },
          {
            "type": "add",
            "line": "    config.middleware.insert_after(ActionDispatch::Flash, Middleware::GtmScriptNonceInjector)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     require \"middleware/discourse_public_exceptions\""
          },
          {
            "type": "context",
            "line": "     config.exceptions_app = Middleware::DiscoursePublicExceptions.new(Rails.public_path)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "config/initializers/099-anon-cache.rb",
        "changes": [
          {
            "type": "context",
            "line": "index ee5e240d93..518f3d8685 100644"
          },
          {
            "type": "context",
            "line": "--- a/config/initializers/099-anon-cache.rb"
          },
          {
            "type": "context",
            "line": "+++ b/config/initializers/099-anon-cache.rb"
          },
          {
            "type": "context",
            "line": "   if Rails.configuration.respond_to?(:enable_anon_caching)"
          },
          {
            "type": "context",
            "line": "     Rails.configuration.enable_anon_caching"
          },
          {
            "type": "context",
            "line": "   else"
          },
          {
            "type": "delete",
            "line": "    Rails.env.production?"
          },
          {
            "type": "add",
            "line": "    Rails.env.production? || Rails.env.test?"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " if !ENV[\"DISCOURSE_DISABLE_ANON_CACHE\"] && enabled"
          },
          {
            "type": "context",
            "line": "   # in an ideal world this is position 0, but mobile detection uses ... session and request and params"
          },
          {
            "type": "delete",
            "line": "  Rails.configuration.middleware.insert_after ActionDispatch::Flash, Middleware::AnonymousCache"
          },
          {
            "type": "add",
            "line": "  Rails.configuration.middleware.insert_after Middleware::GtmScriptNonceInjector,"
          },
          {
            "type": "add",
            "line": "                                              Middleware::AnonymousCache"
          },
          {
            "type": "context",
            "line": " end"
          }
        ]
      },
      {
        "file": "licontent_security_policy.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 53cf16d610..107dc0437d 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/content_security_policy.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/content_security_policy.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class ContentSecurityPolicy"
          },
          {
            "type": "context",
            "line": "   class << self"
          },
          {
            "type": "delete",
            "line": "    def policy(theme_id = nil, env: {}, base_url: Discourse.base_url, path_info: \"/\")"
          },
          {
            "type": "delete",
            "line": "      new.build(theme_id, env: env, base_url: base_url, path_info: path_info)"
          },
          {
            "type": "add",
            "line": "    def policy(theme_id = nil, base_url: Discourse.base_url, path_info: \"/\")"
          },
          {
            "type": "add",
            "line": "      new.build(theme_id, base_url: base_url, path_info: path_info)"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  def build(theme_id, env: {}, base_url:, path_info: \"/\")"
          },
          {
            "type": "delete",
            "line": "    builder = Builder.new(base_url: base_url, env: env)"
          },
          {
            "type": "add",
            "line": "  def build(theme_id, base_url:, path_info: \"/\")"
          },
          {
            "type": "add",
            "line": "    builder = Builder.new(base_url: base_url)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     Extension.theme_extensions(theme_id).each { |extension| builder << extension }"
          },
          {
            "type": "context",
            "line": "     Extension.plugin_extensions.each { |extension| builder << extension }"
          }
        ]
      },
      {
        "file": "licontent_security_policy/builder.rb",
        "changes": [
          {
            "type": "context",
            "line": "index ddcb9db67e..e23f55111e 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/content_security_policy/builder.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/content_security_policy/builder.rb"
          },
          {
            "type": "context",
            "line": "       style_src"
          },
          {
            "type": "context",
            "line": "     ].freeze"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def initialize(base_url:, env: {})"
          },
          {
            "type": "delete",
            "line": "      @directives = Default.new(base_url: base_url, env: env).directives"
          },
          {
            "type": "add",
            "line": "    def initialize(base_url:)"
          },
          {
            "type": "add",
            "line": "      @directives = Default.new(base_url: base_url).directives"
          },
          {
            "type": "context",
            "line": "       @base_url = base_url"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "licontent_security_policy/default.rb",
        "changes": [
          {
            "type": "context",
            "line": "index ff3767c51f..a4e6f70aef 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/content_security_policy/default.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/content_security_policy/default.rb"
          },
          {
            "type": "context",
            "line": "   class Default"
          },
          {
            "type": "context",
            "line": "     attr_reader :directives"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def initialize(base_url:, env: {})"
          },
          {
            "type": "add",
            "line": "    def initialize(base_url:)"
          },
          {
            "type": "context",
            "line": "       @base_url = base_url"
          },
          {
            "type": "delete",
            "line": "      @env = env"
          },
          {
            "type": "context",
            "line": "       @directives ="
          },
          {
            "type": "context",
            "line": "         {}.tap do |directives|"
          },
          {
            "type": "context",
            "line": "           directives[:upgrade_insecure_requests] = [] if SiteSetting.force_https"
          },
          {
            "type": "context",
            "line": "         end"
          },
          {
            "type": "context",
            "line": "         if SiteSetting.gtm_container_id.present?"
          },
          {
            "type": "context",
            "line": "           sources << \"https://www.googletagmanager.com/gtm.js\""
          },
          {
            "type": "delete",
            "line": "          sources << \"'nonce-#{ApplicationHelper.google_tag_manager_nonce(@env)}'\""
          },
          {
            "type": "context",
            "line": "         end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         sources << \"'#{SplashScreenHelper.fingerprint}'\" if SiteSetting.splash_screen"
          }
        ]
      },
      {
        "file": "licontent_security_policy/middleware.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 9c729511ca..79ec083427 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/content_security_policy/middleware.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/content_security_policy/middleware.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       headers[\"Content-Security-Policy\"] = policy("
          },
          {
            "type": "context",
            "line": "         theme_id,"
          },
          {
            "type": "delete",
            "line": "        env: env,"
          },
          {
            "type": "context",
            "line": "         base_url: base_url,"
          },
          {
            "type": "context",
            "line": "         path_info: env[\"PATH_INFO\"],"
          },
          {
            "type": "context",
            "line": "       ) if SiteSetting.content_security_policy"
          },
          {
            "type": "context",
            "line": "       headers[\"Content-Security-Policy-Report-Only\"] = policy("
          },
          {
            "type": "context",
            "line": "         theme_id,"
          },
          {
            "type": "delete",
            "line": "        env: env,"
          },
          {
            "type": "context",
            "line": "         base_url: base_url,"
          },
          {
            "type": "context",
            "line": "         path_info: env[\"PATH_INFO\"],"
          },
          {
            "type": "context",
            "line": "       ) if SiteSetting.content_security_policy_report_only"
          }
        ]
      },
      {
        "file": "limiddleware/anonymous_cache.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 7f1fbec9a4..d41069c92e 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/middleware/anonymous_cache.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/middleware/anonymous_cache.rb"
          },
          {
            "type": "context",
            "line": "       env[\"ANON_CACHE_DURATION\"] = duration"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def self.clear_all_cache!"
          },
          {
            "type": "add",
            "line": "      if Rails.env.production?"
          },
          {
            "type": "add",
            "line": "        raise \"for perf reasons, clear_all_cache! cannot be used in production.\""
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "      Discourse.redis.keys(\"ANON_CACHE_*\").each { |k| Discourse.redis.del(k) }"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def self.disable_anon_cache"
          },
          {
            "type": "add",
            "line": "      @@disabled = true"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def self.enable_anon_cache"
          },
          {
            "type": "add",
            "line": "      @@disabled = false"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # This gives us an API to insert anonymous cache segments"
          },
          {
            "type": "context",
            "line": "     class Helper"
          },
          {
            "type": "context",
            "line": "       RACK_SESSION = \"rack.session\""
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       def cacheable?"
          },
          {
            "type": "delete",
            "line": "        !!(!has_auth_cookie? && get? && no_cache_bypass)"
          },
          {
            "type": "add",
            "line": "        !!("
          },
          {
            "type": "add",
            "line": "          GlobalSetting.anon_cache_store_threshold > 0 && !has_auth_cookie? && get? &&"
          },
          {
            "type": "add",
            "line": "            no_cache_bypass"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       def compress(val)"
          },
          {
            "type": "context",
            "line": "     PAYLOAD_INVALID_REQUEST_METHODS = %w[GET HEAD]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def call(env)"
          },
          {
            "type": "add",
            "line": "      return @app.call(env) if defined?(@@disabled) && @@disabled"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       if PAYLOAD_INVALID_REQUEST_METHODS.include?(env[Rack::REQUEST_METHOD]) &&"
          },
          {
            "type": "context",
            "line": "            env[Rack::RACK_INPUT].size > 0"
          },
          {
            "type": "context",
            "line": "         return 413, { \"Cache-Control\" => \"private, max-age=0, must-revalidate\" }, []"
          }
        ]
      },
      {
        "file": "limiddleware/gtm_script_nonce_injector.rb",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..b7fc3fda33"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/lib/middleware/gtm_script_nonce_injector.rb"
          },
          {
            "type": "add",
            "line": "# frozen_string_literal: true"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "module Middleware"
          },
          {
            "type": "add",
            "line": "  class GtmScriptNonceInjector"
          },
          {
            "type": "add",
            "line": "    def initialize(app, settings = {})"
          },
          {
            "type": "add",
            "line": "      @app = app"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def call(env)"
          },
          {
            "type": "add",
            "line": "      status, headers, response = @app.call(env)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      if nonce_placeholder = headers.delete(\"Discourse-GTM-Nonce-Placeholder\")"
          },
          {
            "type": "add",
            "line": "        nonce = SecureRandom.hex"
          },
          {
            "type": "add",
            "line": "        parts = []"
          },
          {
            "type": "add",
            "line": "        response.each { |part| parts << part.to_s.sub(nonce_placeholder, nonce) }"
          },
          {
            "type": "add",
            "line": "        %w[Content-Security-Policy Content-Security-Policy-Report-Only].each do |name|"
          },
          {
            "type": "add",
            "line": "          next if headers[name].blank?"
          },
          {
            "type": "add",
            "line": "          headers[name] = headers[name].sub(\"script-src \", \"script-src 'nonce-#{nonce}' \")"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": "        [status, headers, parts]"
          },
          {
            "type": "add",
            "line": "      else"
          },
          {
            "type": "add",
            "line": "        [status, headers, response]"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": "  end"
          },
          {
            "type": "add",
            "line": "end"
          }
        ]
      },
      {
        "file": "spec/licontent_security_policy_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 87ea671383..338a2e1e08 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/lib/content_security_policy_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/lib/content_security_policy_spec.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       script_srcs = parse(policy)[\"script-src\"]"
          },
          {
            "type": "context",
            "line": "       expect(script_srcs).to include(\"https://www.googletagmanager.com/gtm.js\")"
          },
          {
            "type": "delete",
            "line": "      expect(script_srcs.to_s).to include(\"nonce-\")"
          },
          {
            "type": "add",
            "line": "      # nonce is added by the GtmScriptNonceInjector middleware to prevent the"
          },
          {
            "type": "add",
            "line": "      # nonce from getting cached by AnonymousCache"
          },
          {
            "type": "add",
            "line": "      expect(script_srcs.to_s).not_to include(\"nonce-\")"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     it \"allowlists CDN assets when integrated\" do"
          }
        ]
      },
      {
        "file": "spec/limiddleware/anonymous_cache_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 2369f82104..33b52642da 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/lib/middleware/anonymous_cache_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/lib/middleware/anonymous_cache_spec.rb"
          },
          {
            "type": "context",
            "line": " RSpec.describe Middleware::AnonymousCache do"
          },
          {
            "type": "context",
            "line": "   let(:middleware) { Middleware::AnonymousCache.new(lambda { |_| [200, {}, []] }) }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  before { Middleware::AnonymousCache.enable_anon_cache }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def env(opts = {})"
          },
          {
            "type": "context",
            "line": "     create_request_env(path: opts.delete(:path) || \"http://test.com/path?bla=1\").merge(opts)"
          },
          {
            "type": "context",
            "line": "   end"
          }
        ]
      },
      {
        "file": "spec/limiddleware/request_tracker_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index d3cc4f2798..a2ee21de7d 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/lib/middleware/request_tracker_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/lib/middleware/request_tracker_spec.rb"
          },
          {
            "type": "context",
            "line": "     after { Middleware::RequestTracker.unregister_detailed_request_logger(logger) }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     it \"can report data from anon cache\" do"
          },
          {
            "type": "add",
            "line": "      Middleware::AnonymousCache.enable_anon_cache"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       cache = Middleware::AnonymousCache.new(app([200, {}, [\"i am a thing\"]]))"
          },
          {
            "type": "context",
            "line": "       tracker = Middleware::RequestTracker.new(cache)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "spec/rails_helper.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 947e63b1d0..63e010de11 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/rails_helper.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/rails_helper.rb"
          },
          {
            "type": "context",
            "line": "     BadgeGranter.disable_queue"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     OmniAuth.config.test_mode = false"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    Middleware::AnonymousCache.disable_anon_cache"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": " end"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "spec/requests/application_controller_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index a2f461fe86..a2d8658299 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/requests/application_controller_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/requests/application_controller_spec.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     it \"when GTM is enabled it adds the same nonce to the policy and the GTM tag\" do"
          },
          {
            "type": "context",
            "line": "       SiteSetting.content_security_policy = true"
          },
          {
            "type": "add",
            "line": "      SiteSetting.content_security_policy_report_only = true"
          },
          {
            "type": "context",
            "line": "       SiteSetting.gtm_container_id = \"GTM-ABCDEF\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       get \"/latest\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      expect(response.headers).to include(\"Content-Security-Policy\")"
          },
          {
            "type": "context",
            "line": "       script_src = parse(response.headers[\"Content-Security-Policy\"])[\"script-src\"]"
          },
          {
            "type": "add",
            "line": "      report_only_script_src ="
          },
          {
            "type": "add",
            "line": "        parse(response.headers[\"Content-Security-Policy-Report-Only\"])[\"script-src\"]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       nonce = extract_nonce_from_script_src(script_src)"
          },
          {
            "type": "add",
            "line": "      report_only_nonce = extract_nonce_from_script_src(report_only_script_src)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      expect(nonce).to eq(report_only_nonce)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       gtm_meta_tag = Nokogiri::HTML5.fragment(response.body).css(\"#data-google-tag-manager\").first"
          },
          {
            "type": "context",
            "line": "       expect(gtm_meta_tag[\"data-nonce\"]).to eq(nonce)"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    it \"doesn't reuse CSP nonces between requests\" do"
          },
          {
            "type": "add",
            "line": "    it \"doesn't reuse nonces between requests\" do"
          },
          {
            "type": "add",
            "line": "      global_setting :anon_cache_store_threshold, 1"
          },
          {
            "type": "add",
            "line": "      Middleware::AnonymousCache.enable_anon_cache"
          },
          {
            "type": "add",
            "line": "      Middleware::AnonymousCache.clear_all_cache!"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       SiteSetting.content_security_policy = true"
          },
          {
            "type": "add",
            "line": "      SiteSetting.content_security_policy_report_only = true"
          },
          {
            "type": "context",
            "line": "       SiteSetting.gtm_container_id = \"GTM-ABCDEF\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       get \"/latest\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      expect(response.headers).to include(\"Content-Security-Policy\")"
          },
          {
            "type": "add",
            "line": "      expect(response.headers[\"X-Discourse-Cached\"]).to eq(\"store\")"
          },
          {
            "type": "add",
            "line": "      expect(response.headers).not_to include(\"Discourse-GTM-Nonce-Placeholder\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       script_src = parse(response.headers[\"Content-Security-Policy\"])[\"script-src\"]"
          },
          {
            "type": "add",
            "line": "      report_only_script_src ="
          },
          {
            "type": "add",
            "line": "        parse(response.headers[\"Content-Security-Policy-Report-Only\"])[\"script-src\"]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       first_nonce = extract_nonce_from_script_src(script_src)"
          },
          {
            "type": "add",
            "line": "      first_report_only_nonce = extract_nonce_from_script_src(report_only_script_src)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      expect(first_nonce).to eq(first_report_only_nonce)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       gtm_meta_tag = Nokogiri::HTML5.fragment(response.body).css(\"#data-google-tag-manager\").first"
          },
          {
            "type": "context",
            "line": "       expect(gtm_meta_tag[\"data-nonce\"]).to eq(first_nonce)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       get \"/latest\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      expect(response.headers).to include(\"Content-Security-Policy\")"
          },
          {
            "type": "add",
            "line": "      expect(response.headers[\"X-Discourse-Cached\"]).to eq(\"true\")"
          },
          {
            "type": "add",
            "line": "      expect(response.headers).not_to include(\"Discourse-GTM-Nonce-Placeholder\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       script_src = parse(response.headers[\"Content-Security-Policy\"])[\"script-src\"]"
          },
          {
            "type": "add",
            "line": "      report_only_script_src ="
          },
          {
            "type": "add",
            "line": "        parse(response.headers[\"Content-Security-Policy-Report-Only\"])[\"script-src\"]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       second_nonce = extract_nonce_from_script_src(script_src)"
          },
          {
            "type": "add",
            "line": "      second_report_only_nonce = extract_nonce_from_script_src(report_only_script_src)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      expect(second_nonce).to eq(second_report_only_nonce)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       expect(first_nonce).not_to eq(second_nonce)"
          },
          {
            "type": "context",
            "line": "       gtm_meta_tag = Nokogiri::HTML5.fragment(response.body).css(\"#data-google-tag-manager\").first"
          }
        ]
      }
    ]
  },
  {
    "commit": "0993a7ab3c102f9ac37ffe361a83a3dc302c0e45",
    "files": [
      {
        "file": "xwiki-platform-core/pom.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 075e3c801af..531b17597ad 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/pom.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/pom.xml"
          },
          {
            "type": "context",
            "line": "                 <new>method java.util.Optional&lt;org.xwiki.ratings.Rating&gt; org.xwiki.ratings.script.AbstractScriptRatingsManager::setRating(org.xwiki.model.reference.EntityReference, int) @ org.xwiki.ratings.script.RatingsScriptService</new>"
          },
          {
            "type": "context",
            "line": "                 <justification>Redesign of Ratings API: use new best practices for script service return if type is nullable.</justification>"
          },
          {
            "type": "context",
            "line": "               </item>"
          },
          {
            "type": "delete",
            "line": "                <item>"
          },
          {
            "type": "add",
            "line": "              <item>"
          },
          {
            "type": "context",
            "line": "                 <code>java.method.parameterTypeChanged</code>"
          },
          {
            "type": "context",
            "line": "                 <old>parameter org.xwiki.ratings.script.RatingApi org.xwiki.ratings.script.RatingsScriptService::setRating(===org.xwiki.model.reference.DocumentReference===, org.xwiki.model.reference.DocumentReference, int)</old>"
          },
          {
            "type": "context",
            "line": "                 <new>parameter java.util.Optional&lt;org.xwiki.ratings.Rating&gt; org.xwiki.ratings.script.AbstractScriptRatingsManager::setRating(===org.xwiki.model.reference.EntityReference===, org.xwiki.user.UserReference, int) @ org.xwiki.ratings.script.RatingsScriptService</new>"
          },
          {
            "type": "context",
            "line": "                 <justification>Redesign of Ratings API: allow to set rating for any reference (not only DocumentReference)</justification>"
          },
          {
            "type": "context",
            "line": "               </item>"
          },
          {
            "type": "delete",
            "line": "                <item>"
          },
          {
            "type": "add",
            "line": "              <item>"
          },
          {
            "type": "context",
            "line": "                 <code>java.method.parameterTypeChanged</code>"
          },
          {
            "type": "context",
            "line": "                 <old>parameter org.xwiki.ratings.script.RatingApi org.xwiki.ratings.script.RatingsScriptService::setRating(org.xwiki.model.reference.DocumentReference, ===org.xwiki.model.reference.DocumentReference===, int)</old>"
          },
          {
            "type": "context",
            "line": "                 <new>parameter java.util.Optional&lt;org.xwiki.ratings.Rating&gt; org.xwiki.ratings.script.AbstractScriptRatingsManager::setRating(org.xwiki.model.reference.EntityReference, ===org.xwiki.user.UserReference===, int) @ org.xwiki.ratings.script.RatingsScriptService</new>"
          },
          {
            "type": "context",
            "line": "                 <justification>Redesign of Ratings API: use new best practices for specifying a user by using the UserReference.</justification>"
          },
          {
            "type": "context",
            "line": "               </item>"
          },
          {
            "type": "delete",
            "line": "                <item>"
          },
          {
            "type": "add",
            "line": "              <item>"
          },
          {
            "type": "context",
            "line": "                 <code>java.method.returnTypeChanged</code>"
          },
          {
            "type": "context",
            "line": "                 <old>method org.xwiki.ratings.script.RatingApi org.xwiki.ratings.script.RatingsScriptService::setRating(org.xwiki.model.reference.DocumentReference, org.xwiki.model.reference.DocumentReference, int)</old>"
          },
          {
            "type": "context",
            "line": "                 <new>method java.util.Optional&lt;org.xwiki.ratings.Rating&gt; org.xwiki.ratings.script.AbstractScriptRatingsManager::setRating(org.xwiki.model.reference.EntityReference, org.xwiki.user.UserReference, int) @ org.xwiki.ratings.script.RatingsScriptService</new>"
          },
          {
            "type": "context",
            "line": "                 <justification>Redesign of Ratings API: use new best practices for script service return if type is nullable.</justification>"
          },
          {
            "type": "context",
            "line": "               </item>"
          },
          {
            "type": "add",
            "line": "              <item>"
          },
          {
            "type": "add",
            "line": "                <code>java.method.addedToInterface</code>"
          },
          {
            "type": "add",
            "line": "                <new>method long org.xwiki.like.LikeManager::countUserLikes(org.xwiki.user.UserReference) throws org.xwiki.like.LikeException</new>"
          },
          {
            "type": "add",
            "line": "                <justification>Unstable API.</justification>"
          },
          {
            "type": "add",
            "line": "              </item>"
          },
          {
            "type": "context",
            "line": "             </revapi.ignore>"
          },
          {
            "type": "context",
            "line": "           </analysisConfiguration>"
          },
          {
            "type": "context",
            "line": "         </configuration>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/LikeManager.java",
        "changes": [
          {
            "type": "context",
            "line": "index de89f832194..0dd16bc289e 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/LikeManager.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/LikeManager.java"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     List<EntityReference> getUserLikes(UserReference source, int offset, int limit) throws LikeException;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * Retrieve the total number of likes performed by a user."
          },
          {
            "type": "add",
            "line": "     *"
          },
          {
            "type": "add",
            "line": "     * @param source the user who performs the likes to count."
          },
          {
            "type": "add",
            "line": "     * @return the total number of likes performed."
          },
          {
            "type": "add",
            "line": "     * @throws LikeException in case of problem when getting the information."
          },
          {
            "type": "add",
            "line": "     * @since 12.9RC1"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "add",
            "line": "    long countUserLikes(UserReference source) throws LikeException;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * Retrieve like information a specific entity."
          },
          {
            "type": "context",
            "line": "      *"
          },
          {
            "type": "context",
            "line": "      * @param limit the limit used for pagination."
          },
          {
            "type": "context",
            "line": "      * @return a list of user references of users who liked this page."
          },
          {
            "type": "context",
            "line": "      * @throws LikeException in case of problem for performing the query."
          },
          {
            "type": "add",
            "line": "     * @since 12.9RC1"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "context",
            "line": "     List<UserReference> getLikers(EntityReference target, int offset, int limit) throws LikeException;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/internal/DefaultLikeManager.java",
        "changes": [
          {
            "type": "context",
            "line": "index db28fc869d9..e9560fae162 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/internal/DefaultLikeManager.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/internal/DefaultLikeManager.java"
          },
          {
            "type": "context",
            "line": " import org.xwiki.cache.CacheManager;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.cache.config.LRUCacheConfiguration;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.component.annotation.Component;"
          },
          {
            "type": "delete",
            "line": "import org.xwiki.component.manager.ComponentLifecycleException;"
          },
          {
            "type": "delete",
            "line": "import org.xwiki.component.phase.Disposable;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.component.phase.Initializable;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.component.phase.InitializationException;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.like.LikeConfiguration;"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " @Component"
          },
          {
            "type": "context",
            "line": " @Singleton"
          },
          {
            "type": "delete",
            "line": "public class DefaultLikeManager implements LikeManager, Initializable, Disposable"
          },
          {
            "type": "add",
            "line": "public class DefaultLikeManager implements LikeManager, Initializable"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     private static final int DEFAULT_LIKE_VOTE = 1;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @Override"
          },
          {
            "type": "delete",
            "line": "    public void dispose() throws ComponentLifecycleException"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        //this.authorizationManager."
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private String getExistCacheKey(UserReference source, EntityReference target)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return String.format(\"%s_%s\","
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Override"
          },
          {
            "type": "add",
            "line": "    public long countUserLikes(UserReference source) throws LikeException"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            return this.ratingsManager.countRatings("
          },
          {
            "type": "add",
            "line": "                Collections.singletonMap(RatingsManager.RatingQueryField.USER_REFERENCE, source));"
          },
          {
            "type": "add",
            "line": "        } catch (RatingsException e) {"
          },
          {
            "type": "add",
            "line": "            throw new LikeException("
          },
          {
            "type": "add",
            "line": "                String.format(\"Error when trying to count user likes for user [%s]\", source), e);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": "     public long getEntityLikes(EntityReference target) throws LikeException"
          },
          {
            "type": "context",
            "line": "     {"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/script/LikeScriptService.java",
        "changes": [
          {
            "type": "context",
            "line": "index 6de8f792a11..448ab55ab85 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/script/LikeScriptService.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/java/org/xwiki/like/script/LikeScriptService.java"
          },
          {
            "type": "context",
            "line": "         return Collections.emptyList();"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * Count the number of likes performed by the given user."
          },
          {
            "type": "add",
            "line": "     *"
          },
          {
            "type": "add",
            "line": "     * @param userReference the user for whom to count likes."
          },
          {
            "type": "add",
            "line": "     * @return the number of likes performed."
          },
          {
            "type": "add",
            "line": "     * @since 12.9RC1"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "add",
            "line": "    public Optional<Long> countUserLikes(UserReference userReference)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        Optional<Long> result = Optional.empty();"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            result = Optional.of(this.likeManager.countUserLikes(userReference));"
          },
          {
            "type": "add",
            "line": "        } catch (LikeException e) {"
          },
          {
            "type": "add",
            "line": "            this.logger.warn(\"Error while counting likes for user [{}]\", userReference,"
          },
          {
            "type": "add",
            "line": "                ExceptionUtils.getRootCause(e));"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        return result;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * Determine if the current user already liked the given reference."
          },
          {
            "type": "context",
            "line": "      * @param entityReference the reference for which to check if the current liked it or not already."
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/resources/templates/likers.vm",
        "changes": [
          {
            "type": "context",
            "line": "index d6db7ce62ee..34101f20590 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/resources/templates/likers.vm"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/main/resources/templates/likers.vm"
          },
          {
            "type": "context",
            "line": " ## Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA"
          },
          {
            "type": "context",
            "line": " ## 02110-1301 USA, or see the FSF site: http://www.fsf.org."
          },
          {
            "type": "context",
            "line": " ## ---------------------------------------------------------------------------"
          },
          {
            "type": "delete",
            "line": "#set ($likers = $services.like.getLikers($doc, 0, 50))"
          },
          {
            "type": "delete",
            "line": "<div id=\"document-title\"><h1>$services.localization.render('like.likers.title', [$doc.title])</h1></div>"
          },
          {
            "type": "delete",
            "line": "<div id=\"likers-content\">"
          },
          {
            "type": "delete",
            "line": "    #if ($likers.isEmpty())"
          },
          {
            "type": "delete",
            "line": "        $services.localization.render('like.likers.empty')"
          },
          {
            "type": "add",
            "line": "#if ($request.livetable == \"true\")"
          },
          {
            "type": "add",
            "line": "    #macro (displayUserAliasWithAvatar $userReference $disabled)"
          },
          {
            "type": "add",
            "line": "    <div class=\"user#if ($disabled) disabled#end\" data-reference=\"$escapetool.xml($userReference)\">"
          },
          {
            "type": "add",
            "line": "    <span class=\"user-avatar-wrapper\">"
          },
          {
            "type": "add",
            "line": "      #getUserAvatarURL($userReference $avatarURL 120)"
          },
          {
            "type": "add",
            "line": "      <img class=\"user-avatar\" src=\"$escapetool.xml($avatarURL.url)\" />"
          },
          {
            "type": "add",
            "line": "    </span>"
          },
          {
            "type": "add",
            "line": "      <a href=\"$xwiki.getURL($userReference)\">$escapetool.xml($userReference.name)</a>"
          },
          {
            "type": "add",
            "line": "    </div>"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "    $response.setContentType('application/json')"
          },
          {
            "type": "add",
            "line": "    #set ($documentReference = $doc.documentReference)"
          },
          {
            "type": "add",
            "line": "    ##=============================="
          },
          {
            "type": "add",
            "line": "    ## Offset = item # at which to start displaying data"
          },
          {
            "type": "add",
            "line": "    ##=============================="
          },
          {
            "type": "add",
            "line": "    #set($offset = $numbertool.toNumber($request.get('offset')))"
          },
          {
            "type": "add",
            "line": "    ## offset starts from 0 in velocity and 1 in javascript"
          },
          {
            "type": "add",
            "line": "    #set($offset = $offset - 1)"
          },
          {
            "type": "add",
            "line": "    #if($offset < 0)"
          },
          {
            "type": "add",
            "line": "        #set($offset = 0)"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "    ##=================="
          },
          {
            "type": "add",
            "line": "    ## Limit = # of items to display"
          },
          {
            "type": "add",
            "line": "    ##=================="
          },
          {
            "type": "add",
            "line": "    #set($limit = $numbertool.toNumber($request.get('limit')))"
          },
          {
            "type": "add",
            "line": "    ##=========="
          },
          {
            "type": "add",
            "line": "    ## Sort direction"
          },
          {
            "type": "add",
            "line": "    ##=========="
          },
          {
            "type": "add",
            "line": "    #set($order = \"$!request.sort\")"
          },
          {
            "type": "add",
            "line": "    #if($order != '')"
          },
          {
            "type": "add",
            "line": "        #set($orderDirection = \"$!{request.get('dir').toLowerCase()}\")"
          },
          {
            "type": "add",
            "line": "        #if(\"$!orderDirection\" != '' && \"$!orderDirection\" != 'asc')"
          },
          {
            "type": "add",
            "line": "            #set($orderDirection = 'desc')"
          },
          {
            "type": "add",
            "line": "        #end"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "    #set ($likeRecords = $services.like.getLikers($documentReference, $offset, $limit))"
          },
          {
            "type": "add",
            "line": "    #set ($userRows = [])"
          },
          {
            "type": "add",
            "line": "    #foreach($userReference in $likeRecords)"
          },
          {
            "type": "add",
            "line": "        #set ($grayed = $xcontext.userReference == $userReference.reference)"
          },
          {
            "type": "add",
            "line": "        #set ($userDoc = $xwiki.getDocument($userReference.reference))"
          },
          {
            "type": "add",
            "line": "        #set ($userProperties = $services.user.getProperties($userReference))"
          },
          {
            "type": "add",
            "line": "        #set ($userObject = $user.getObject('XWiki.XWikiUsers'))"
          },
          {
            "type": "add",
            "line": "        #set ($row = {"
          },
          {
            "type": "add",
            "line": "            'grayed': $grayed,"
          },
          {
            "type": "add",
            "line": "            'doc_fullName': $userDoc.fullName,"
          },
          {
            "type": "add",
            "line": "            'doc_wiki': $userDoc.wiki,"
          },
          {
            "type": "add",
            "line": "            'doc_url': $userDoc.getURL(),"
          },
          {
            "type": "add",
            "line": "            'doc_viewable': $services.security.authorization.hasAccess('view', $userDoc.documentReference),"
          },
          {
            "type": "add",
            "line": "            'name': \"#displayUserAliasWithAvatar($userDoc.documentReference $disabled)\","
          },
          {
            "type": "add",
            "line": "            'first_name': $userProperties.firstName,"
          },
          {
            "type": "add",
            "line": "            'last_name': $userProperties.lastName"
          },
          {
            "type": "add",
            "line": "        })"
          },
          {
            "type": "add",
            "line": "        #set ($discard = $userRows.add($row))"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "    ## ==="
          },
          {
            "type": "add",
            "line": "    ## JSON"
          },
          {
            "type": "add",
            "line": "    ## ==="
          },
          {
            "type": "add",
            "line": "    #set ($newOffset = $offset + 1)"
          },
          {
            "type": "add",
            "line": "    #set ($optLikesNumber = $services.like.getLikes($documentReference))"
          },
          {
            "type": "add",
            "line": "    #if ($optLikesNumber.isPresent())"
          },
          {
            "type": "add",
            "line": "      #set ($totalRows = $optLikesNumber.get())"
          },
          {
            "type": "context",
            "line": "     #else"
          },
          {
            "type": "delete",
            "line": "      <p>"
          },
          {
            "type": "delete",
            "line": "          $services.localization.render('like.likers.number', [$likers.size()])"
          },
          {
            "type": "delete",
            "line": "      </p>"
          },
          {
            "type": "delete",
            "line": "      <ul>"
          },
          {
            "type": "delete",
            "line": "          #foreach($liker in $likers)"
          },
          {
            "type": "delete",
            "line": "            <li>#displayUserLink($liker)</li>"
          },
          {
            "type": "delete",
            "line": "          #end"
          },
          {
            "type": "delete",
            "line": "      </ul>"
          },
          {
            "type": "add",
            "line": "      #set ($totalRows = $likeRecords.size())"
          },
          {
            "type": "context",
            "line": "     #end"
          },
          {
            "type": "delete",
            "line": "</div>"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        \"totalrows\": $totalRows,"
          },
          {
            "type": "add",
            "line": "        \"returnedrows\":  $likeRecords.size(),"
          },
          {
            "type": "add",
            "line": "        \"offset\": $newOffset,"
          },
          {
            "type": "add",
            "line": "        \"reqNo\": $numbertool.toNumber($request.reqNo),"
          },
          {
            "type": "add",
            "line": "        \"rows\": $jsontool.serialize($userRows)"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "#else"
          },
          {
            "type": "add",
            "line": "    <h1>$escapetool.xml($services.localization.render('like.likers.title', [$doc.plainTitle]))</h1>"
          },
          {
            "type": "add",
            "line": "    #set($columns = [\"name\", \"first_name\", \"last_name\"])"
          },
          {
            "type": "add",
            "line": "    #set($columnsProperties = {"
          },
          {
            "type": "add",
            "line": "        \"name\" : { \"type\" : \"text\", \"sortable\": false, \"filterable\": false, \"html\": true },"
          },
          {
            "type": "add",
            "line": "        \"first_name\" : { \"type\" : \"text\", \"sortable\": false, \"filterable\": false},"
          },
          {
            "type": "add",
            "line": "        \"last_name\" : { \"type\" : \"text\", \"sortable\": false, \"filterable\": false}"
          },
          {
            "type": "add",
            "line": "    })"
          },
          {
            "type": "add",
            "line": "    #set ($queryParams = {"
          },
          {
            "type": "add",
            "line": "        \"livetable\": \"true\","
          },
          {
            "type": "add",
            "line": "        \"xpage\": \"likers\","
          },
          {
            "type": "add",
            "line": "        \"outputSyntax\": \"plain\""
          },
          {
            "type": "add",
            "line": "    })"
          },
          {
            "type": "add",
            "line": "    ## We rely on the same column name than the Users administration, so we use same translation prefix for now."
          },
          {
            "type": "add",
            "line": "    #set($options = {"
          },
          {
            "type": "add",
            "line": "        'url': $doc.getURL('get', $escapetool.url($queryParams)),"
          },
          {
            "type": "add",
            "line": "        'outputOnlyHtml': true,"
          },
          {
            "type": "add",
            "line": "        'translationPrefix' : \"xe.admin.users.\""
          },
          {
            "type": "add",
            "line": "    })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    #livetable(\"likers\" $columns $columnsProperties $options)"
          },
          {
            "type": "add",
            "line": "#end"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/test/java/org/xwiki/like/internal/DefaultLikeManagerTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index e4a96851613..2b9c9e6dcd9 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/test/java/org/xwiki/like/internal/DefaultLikeManagerTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/test/java/org/xwiki/like/internal/DefaultLikeManagerTest.java"
          },
          {
            "type": "context",
            "line": "         assertEquals(Arrays.asList(userReference1, userReference2, userReference3),"
          },
          {
            "type": "context",
            "line": "             this.defaultLikeManager.getLikers(this.target, 12, 4));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void countUserLikes() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        when(this.ratingsManager.countRatings("
          },
          {
            "type": "add",
            "line": "            Collections.singletonMap(RatingsManager.RatingQueryField.USER_REFERENCE, this.userReference)))"
          },
          {
            "type": "add",
            "line": "            .thenReturn(42L);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(42L, this.defaultLikeManager.countUserLikes(this.userReference));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/test/java/org/xwiki/like/script/LikeScriptServiceTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 877d07219d9..a483dc76251 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/test/java/org/xwiki/like/script/LikeScriptServiceTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-api/src/test/java/org/xwiki/like/script/LikeScriptServiceTest.java"
          },
          {
            "type": "context",
            "line": " package org.xwiki.like.script;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import java.util.Arrays;"
          },
          {
            "type": "add",
            "line": "import java.util.List;"
          },
          {
            "type": "context",
            "line": " import java.util.Locale;"
          },
          {
            "type": "context",
            "line": " import java.util.Optional;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertFalse;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertSame;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.Mockito.mock;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.times;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.verify;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.when;"
          },
          {
            "type": "context",
            "line": "             Locale.ROOT);"
          },
          {
            "type": "context",
            "line": "         verify(this.asyncRendererCache).cleanCache(uixReference);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void countUserLikes() throws LikeException"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        when(this.likeManager.countUserLikes(userReference)).thenReturn(43L);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Optional.of(43L), this.likeScriptService.countUserLikes(this.userReference));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void getUserLikes() throws LikeException"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        List<EntityReference> expectedList = Arrays.asList("
          },
          {
            "type": "add",
            "line": "            mock(EntityReference.class),"
          },
          {
            "type": "add",
            "line": "            mock(EntityReference.class),"
          },
          {
            "type": "add",
            "line": "            mock(EntityReference.class));"
          },
          {
            "type": "add",
            "line": "        when(this.likeManager.getUserLikes(this.userReference, 2, 32)).thenReturn(expectedList);"
          },
          {
            "type": "add",
            "line": "        assertEquals(expectedList, this.likeScriptService.getUserLikes(this.userReference, 2, 32));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.de.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 376ed08cbd3..8307a6a2bf6 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.de.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.de.xml"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_alwaysDisplayButton.hint=Die \"Gefällt mir\" Schaltfläche immer anzeigen - selbst wenn der Nutzer kein Recht hat diese zu benutzen. Anschalten, um die Anzahl der \"Gefällt mir\" immer anzuzeigen."
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity=Cache-Größe"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity.hint=Anzahl der \"Gefällt mir\"-Informationen im Cache. Sie müssen XWiki neustarten, damit veränderte Einstellungen angewendet werden.</content>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " </xwikidoc>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.es.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 8a4e41a063d..0f61f26889f 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.es.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.es.xml"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_alwaysDisplayButton.hint=Mostrar el botón incluso si el usuario no tiene derecho de interaccionar con él.  Úsalo si deseas mostrar siempre el contador de \"Me gusta\"."
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity=Capacidad de la caché"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity.hint=Número de información de \"Me gusta\" guardada en la caché. Ten en cuenta que tienes que reiniciar XWiki para que se activen los cambios de esta opción.</content>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " </xwikidoc>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.fr.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 52d7ba8f517..66edc4df905 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.fr.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.fr.xml"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_alwaysDisplayButton.hint=Afficher le bouton même si l'utilisateur n'a pas les droits pour intéragir avec. Utilisez cette option si vous souhaitez toujours afficher le compteur de J'aime."
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity=Capacité du Cache"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity.hint=Nombre d'information J'aime à conserver dans le cache. Notez que vous devrez redémarrer XWiki pour que cette option soit prise en compte.</content>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " </xwikidoc>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.no.xml",
        "changes": [
          {
            "type": "context",
            "line": "index c59fb6417cb..fabde7fa3f3 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.no.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.no.xml"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_alwaysDisplayButton.hint=Vis knappen selv om brukeren ikke har rettigheter til å bruke den. Bruk hvis du alltid vil vise Liker-telleren."
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity=Hurtigbufferkapasitet"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity.hint=Antall Liker-informasjon som er lagret i hurtigbufferen. Merk at du må starte XWiki på nytt for at dette valget skal aktiveres.</content>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " </xwikidoc>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.ru.xml",
        "changes": [
          {
            "type": "context",
            "line": "index a142505e345..68ac9eca3b4 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.ru.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.ru.xml"
          },
          {
            "type": "context",
            "line": " ### Missing: XWiki.Like.LikeConfigurationClass_alwaysDisplayButton.hint=Display the button even if the user doesn't have the rights to interact with it. Use it if you wish to always display the Likes counter."
          },
          {
            "type": "context",
            "line": " ### Missing: XWiki.Like.LikeConfigurationClass_cacheCapacity=Cache capacity"
          },
          {
            "type": "context",
            "line": " ### Missing: XWiki.Like.LikeConfigurationClass_cacheCapacity.hint=Number of Like information kept in cache. Note that you have to restart XWiki for this option change to be taken into account.</content>"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " </xwikidoc>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.xml",
        "changes": [
          {
            "type": "context",
            "line": "index bfb7bfdb056..f63d8650bd2 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeTranslations.xml"
          },
          {
            "type": "context",
            "line": " like.button.title.unlike=Click to unlike the current page. Number of likes on this page: {0}."
          },
          {
            "type": "context",
            "line": " like.likers.empty=No one likes this page yet."
          },
          {
            "type": "context",
            "line": " like.likers.number={0} person(s) like this page:"
          },
          {
            "type": "delete",
            "line": "like.likers.title=Likes on {0}"
          },
          {
            "type": "add",
            "line": "like.likers.title=Likers of {0}"
          },
          {
            "type": "add",
            "line": "like.livetable.column.title=Title"
          },
          {
            "type": "add",
            "line": "like.livetable.column.location=Location"
          },
          {
            "type": "add",
            "line": "like.livetable.column.likes=Likes"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_alwaysDisplayButton=Always display Like button"
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_alwaysDisplayButton.hint=Display the button even if the user doesn't have the rights to interact with it. Use it if you wish to always display the Likes counter."
          },
          {
            "type": "context",
            "line": " XWiki.Like.LikeConfigurationClass_cacheCapacity=Cache capacity"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeViewersMenuUIX.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 4dfcf2e5eea..f9fbe179fcf 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeViewersMenuUIX.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/LikeViewersMenuUIX.xml"
          },
          {
            "type": "context",
            "line": "       <scope>wiki</scope>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "   </object>"
          },
          {
            "type": "delete",
            "line": "</xwikidoc>"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "</xwikidoc>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/UserProfileUIX.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 8ebb111a62c..f6448d39149 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/UserProfileUIX.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/main/resources/XWiki/Like/UserProfileUIX.xml"
          },
          {
            "type": "context",
            "line": "   <minorEdit>false</minorEdit>"
          },
          {
            "type": "context",
            "line": "   <syntaxId>xwiki/2.1</syntaxId>"
          },
          {
            "type": "context",
            "line": "   <hidden>true</hidden>"
          },
          {
            "type": "delete",
            "line": "  <content/>"
          },
          {
            "type": "add",
            "line": "  <content>{{velocity}}"
          },
          {
            "type": "add",
            "line": "#if ($request.livetable == \"true\")"
          },
          {
            "type": "add",
            "line": "  #template('hierarchy_macros.vm')"
          },
          {
            "type": "add",
            "line": "  #if(\"$!{request.xpage}\" == 'plain')"
          },
          {
            "type": "add",
            "line": "    $response.setContentType('application/json')"
          },
          {
            "type": "add",
            "line": "  #end"
          },
          {
            "type": "add",
            "line": "  #set ($documentReference = $services.model.resolveDocument($request.user))"
          },
          {
            "type": "add",
            "line": "  ##=============================="
          },
          {
            "type": "add",
            "line": "  ## Offset = item # at which to start displaying data"
          },
          {
            "type": "add",
            "line": "  ##=============================="
          },
          {
            "type": "add",
            "line": "  #set($offset = $numbertool.toNumber($request.get('offset')))"
          },
          {
            "type": "add",
            "line": "  ## offset starts from 0 in velocity and 1 in javascript"
          },
          {
            "type": "add",
            "line": "  #set($offset = $offset - 1)"
          },
          {
            "type": "add",
            "line": "  #if($offset &lt; 0)"
          },
          {
            "type": "add",
            "line": "    #set($offset = 0)"
          },
          {
            "type": "add",
            "line": "  #end"
          },
          {
            "type": "add",
            "line": "  ##=================="
          },
          {
            "type": "add",
            "line": "  ## Limit = # of items to display"
          },
          {
            "type": "add",
            "line": "  ##=================="
          },
          {
            "type": "add",
            "line": "  #set($limit = $numbertool.toNumber($request.get('limit')))"
          },
          {
            "type": "add",
            "line": "  #set ($likedPages = $services.like.getUserLikes($documentReference, $offset, $limit))"
          },
          {
            "type": "add",
            "line": "  #set ($optUserLikes = $services.like.countUserLikes($documentReference))"
          },
          {
            "type": "add",
            "line": "  #if ($optUserLikes.isPresent())"
          },
          {
            "type": "add",
            "line": "    #set ($totalRows = $optUserLikes.get())"
          },
          {
            "type": "add",
            "line": "  #else"
          },
          {
            "type": "add",
            "line": "    #set ($totalRows = $likedPages.size())"
          },
          {
            "type": "add",
            "line": "  #end"
          },
          {
            "type": "add",
            "line": "  ##=========="
          },
          {
            "type": "add",
            "line": "  ## Sort direction"
          },
          {
            "type": "add",
            "line": "  ##=========="
          },
          {
            "type": "add",
            "line": "  #set($order = \"$!request.sort\")"
          },
          {
            "type": "add",
            "line": "  #if($order != '')"
          },
          {
            "type": "add",
            "line": "    #set($orderDirection = \"$!{request.get('dir').toLowerCase()}\")"
          },
          {
            "type": "add",
            "line": "    #if(\"$!orderDirection\" != '' &amp;&amp; \"$!orderDirection\" != 'asc')"
          },
          {
            "type": "add",
            "line": "      #set($orderDirection = 'desc')"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "  #end"
          },
          {
            "type": "add",
            "line": "  #set ($pagesRows = [])"
          },
          {
            "type": "add",
            "line": "  #foreach($likedPage in $likedPages)"
          },
          {
            "type": "add",
            "line": "    #set ($likedDoc = $xwiki.getDocument($likedPage))"
          },
          {
            "type": "add",
            "line": "    #set ($optDocumentLikes = $services.like.getLikes($likedPage))"
          },
          {
            "type": "add",
            "line": "    #if ($optDocumentLikes.isPresent())"
          },
          {
            "type": "add",
            "line": "      #set ($documentLikes = $optDocumentLikes.get())"
          },
          {
            "type": "add",
            "line": "    #else"
          },
          {
            "type": "add",
            "line": "      #set ($documentLikes = \"N/A\")"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "    ## code inspired from getdocuments.vm"
          },
          {
            "type": "add",
            "line": "    #set ($viewable = $xwiki.hasAccessLevel('view', $xcontext.user, $services.model.serialize($likedPage, \"default\")))"
          },
          {
            "type": "add",
            "line": "    #set ($row = {'doc_viewable' : $viewable})"
          },
          {
            "type": "add",
            "line": "    #if (!$viewable)"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_fullName', $likedDoc.fullName))"
          },
          {
            "type": "add",
            "line": "    #else"
          },
          {
            "type": "add",
            "line": "      #set ($translatedDoc = $likedDoc.translatedDocument)"
          },
          {
            "type": "add",
            "line": "      #set ($fullname = $services.model.serialize($likedDoc.documentReference, 'default'))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_name', $likedDoc.documentReference.name))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_fullName', $fullname))"
          },
          {
            "type": "add",
            "line": "      #set ($location = \"#hierarchy($likedDoc.documentReference, {'limit': 5, 'plain': false, 'local': true, 'displayTitle': false})\")"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_location', $location))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_space', $likedDoc.space))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_url', $xwiki.getURL($likedDoc)))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_space_url', $xwiki.getURL($services.model.createDocumentReference($!likedDoc.wiki, $!likedDoc.space, 'WebHome'))))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_wiki', $likedDoc.wiki))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_wiki_url', $xwiki.getURL($services.model.resolveDocument('', 'default', $likedDoc.documentReference.extractReference('WIKI')))))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_author_url', $xwiki.getURL($translatedDoc.author)))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_date', $xwiki.formatDate($translatedDoc.date)))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_title', $translatedDoc.plainTitle))"
          },
          {
            "type": "add",
            "line": "      #set ($rawTitle = $translatedDoc.title)"
          },
          {
            "type": "add",
            "line": "      #if ($rawTitle != $row['doc_title'])"
          },
          {
            "type": "add",
            "line": "        #set ($discard = $row.put('doc_title_raw', $rawTitle))"
          },
          {
            "type": "add",
            "line": "      #end"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_author', $xwiki.getUserName($translatedDoc.author, false)))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_creationDate', $xwiki.formatDate($translatedDoc.creationDate)))"
          },
          {
            "type": "add",
            "line": "      #set ($discard = $row.put('doc_creator', $xwiki.getUserName($translatedDoc.creator, false)))"
          },
          {
            "type": "add",
            "line": "    #end"
          },
          {
            "type": "add",
            "line": "    #set ($discard = $row.put('like', $documentLikes))"
          },
          {
            "type": "add",
            "line": "    #set ($discard = $pagesRows.add($row))"
          },
          {
            "type": "add",
            "line": "  #end"
          },
          {
            "type": "add",
            "line": "  #set ($newOffset = $offset + 1)"
          },
          {
            "type": "add",
            "line": "  ## ==="
          },
          {
            "type": "add",
            "line": "  ## JSON"
          },
          {
            "type": "add",
            "line": "  ## ==="
          },
          {
            "type": "add",
            "line": "  {"
          },
          {
            "type": "add",
            "line": "    \"totalrows\": $totalRows,"
          },
          {
            "type": "add",
            "line": "    \"returnedrows\":  $pagesRows.size(),"
          },
          {
            "type": "add",
            "line": "    \"offset\": $newOffset,"
          },
          {
            "type": "add",
            "line": "    \"reqNo\": $numbertool.toNumber($request.reqNo),"
          },
          {
            "type": "add",
            "line": "    \"rows\": $jsontool.serialize($pagesRows)"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "#end"
          },
          {
            "type": "add",
            "line": "{{/velocity}}</content>"
          },
          {
            "type": "context",
            "line": "   <object>"
          },
          {
            "type": "context",
            "line": "     <name>XWiki.Like.UserProfileUIX</name>"
          },
          {
            "type": "context",
            "line": "     <number>0</number>"
          },
          {
            "type": "context",
            "line": "         <cache>0</cache>"
          },
          {
            "type": "context",
            "line": "         <disabled>0</disabled>"
          },
          {
            "type": "context",
            "line": "         <displayType>select</displayType>"
          },
          {
            "type": "add",
            "line": "        <freeText>forbidden</freeText>"
          },
          {
            "type": "add",
            "line": "        <largeStorage>0</largeStorage>"
          },
          {
            "type": "context",
            "line": "         <multiSelect>1</multiSelect>"
          },
          {
            "type": "context",
            "line": "         <name>async_context</name>"
          },
          {
            "type": "context",
            "line": "         <number>4</number>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "     <property>"
          },
          {
            "type": "context",
            "line": "       <async_context>"
          },
          {
            "type": "add",
            "line": "        <value>doc.reference</value>"
          },
          {
            "type": "context",
            "line": "         <value>user</value>"
          },
          {
            "type": "delete",
            "line": "        <value>wiki</value>"
          },
          {
            "type": "context",
            "line": "       </async_context>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "     <property>"
          },
          {
            "type": "delete",
            "line": "      <async_enabled>1</async_enabled>"
          },
          {
            "type": "add",
            "line": "      <async_enabled>0</async_enabled>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "     <property>"
          },
          {
            "type": "context",
            "line": "       <content>{{velocity}}"
          },
          {
            "type": "delete",
            "line": "#set ($likedReferences = $services.like.getUserLikes($services.user.currentUserReference, 0, 50))"
          },
          {
            "type": "delete",
            "line": "|=Page"
          },
          {
            "type": "delete",
            "line": "#foreach ($likeReference in $likedReferences)"
          },
          {
            "type": "delete",
            "line": "  #set ($likedDocument = $xwiki.getDocument($likeReference))"
          },
          {
            "type": "delete",
            "line": "  |[[$likedDocument.title&gt;&gt;$services.model.serialize($likeReference)]]"
          },
          {
            "type": "delete",
            "line": "#end"
          },
          {
            "type": "add",
            "line": "=$escapetool.xml($services.localization.render(\"like.userprofile.menu\"))="
          },
          {
            "type": "add",
            "line": "#set($columns = [\"doc.title\", \"doc.location\", \"like\"])"
          },
          {
            "type": "add",
            "line": "#set ($docTitleDisplayName = $escapetool.xml($services.localization.render('like.livetable.column.title')))"
          },
          {
            "type": "add",
            "line": "#set ($docLocationDisplayName = $escapetool.xml($services.localization.render('like.livetable.column.location')))"
          },
          {
            "type": "add",
            "line": "#set ($likesDisplayName = $escapetool.xml($services.localization.render('like.livetable.column.likes')))"
          },
          {
            "type": "add",
            "line": "#set($columnsProperties = {"
          },
          {
            "type": "add",
            "line": "  \"doc.title\" : { \"displayName\": $docTitleDisplayName, \"type\": \"text\", \"size\": 30, \"link\": \"view\", \"sortable\": false, \"filterable\": false },"
          },
          {
            "type": "add",
            "line": "  \"doc.location\" : { \"displayName\": $docLocationDisplayName, \"type\": \"text\", \"size\": 30, \"html\": true, \"sortable\": false, \"filterable\": false },"
          },
          {
            "type": "add",
            "line": "  \"like\" : { \"displayName\": $likesDisplayName, \"type\" : \"number\", \"sortable\": false, \"filterable\": false }"
          },
          {
            "type": "add",
            "line": "})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#set ($currentUser = $services.model.serialize($doc.documentReference, \"default\"))"
          },
          {
            "type": "add",
            "line": "#set ($pageToCallReference = $services.model.resolveDocument(\"XWiki.Like.UserProfileUIX\"))"
          },
          {
            "type": "add",
            "line": "#set ($pageToCall = $xwiki.getDocument($pageToCallReference))"
          },
          {
            "type": "add",
            "line": "#set ($queryParams = {"
          },
          {
            "type": "add",
            "line": "  \"user\": $currentUser,"
          },
          {
            "type": "add",
            "line": "  \"livetable\": \"true\","
          },
          {
            "type": "add",
            "line": "  \"xpage\": \"plain\","
          },
          {
            "type": "add",
            "line": "  \"outputSyntax\": \"plain\""
          },
          {
            "type": "add",
            "line": "})"
          },
          {
            "type": "add",
            "line": "#set($options = {"
          },
          {
            "type": "add",
            "line": "  'url': $pageToCall.getURL('get', $escapetool.url($queryParams))"
          },
          {
            "type": "add",
            "line": "})"
          },
          {
            "type": "add",
            "line": "#livetable(\"likedPages\" $columns $columnsProperties $options)"
          },
          {
            "type": "context",
            "line": " {{/velocity}}</content>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "     <property>"
          }
        ]
      }
    ]
  },
  {
    "commit": "09b9d4f1994a674c4ec85b4947aa656eda1aed8a",
    "files": [
      {
        "file": "libfreerdp/gdi/graphics.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4afae48d1..159198756 100644"
          },
          {
            "type": "context",
            "line": "--- a/libfreerdp/gdi/graphics.c"
          },
          {
            "type": "context",
            "line": "+++ b/libfreerdp/gdi/graphics.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tUINT32 SrcSize = length;"
          },
          {
            "type": "context",
            "line": " \trdpGdi* gdi = context->gdi;"
          },
          {
            "type": "add",
            "line": "\tUINT32 size = DstWidth * DstHeight;"
          },
          {
            "type": "context",
            "line": " \tbitmap->compressed = FALSE;"
          },
          {
            "type": "context",
            "line": " \tbitmap->format = gdi->dstFormat;"
          },
          {
            "type": "delete",
            "line": "\tbitmap->length = DstWidth * DstHeight * GetBytesPerPixel(bitmap->format);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif ((GetBytesPerPixel(bitmap->format) == 0) ||"
          },
          {
            "type": "add",
            "line": "\t    (DstWidth == 0) || (DstHeight == 0) || (DstWidth > UINT32_MAX / DstHeight) ||"
          },
          {
            "type": "add",
            "line": "\t    (size > (UINT32_MAX / GetBytesPerPixel(bitmap->format))))"
          },
          {
            "type": "add",
            "line": "\t\treturn FALSE;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tsize *= GetBytesPerPixel(bitmap->format);"
          },
          {
            "type": "add",
            "line": "\tbitmap->length = size;"
          },
          {
            "type": "context",
            "line": " \tbitmap->data = (BYTE*) _aligned_malloc(bitmap->length, 16);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!bitmap->data)"
          }
        ]
      }
    ]
  },
  {
    "commit": "09ba3bc9dd150457c506e4661380a6183af651c1",
    "files": [
      {
        "file": "fs/btrfs/dev-replace.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6f0fe3623381..13863354ff9d 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/dev-replace.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/dev-replace.c"
          },
          {
            "type": "context",
            "line": " \tcase BTRFS_IOCTL_DEV_REPLACE_STATE_STARTED:"
          },
          {
            "type": "context",
            "line": " \tcase BTRFS_IOCTL_DEV_REPLACE_STATE_SUSPENDED:"
          },
          {
            "type": "context",
            "line": " \t\tdev_replace->srcdev = btrfs_find_device(fs_info->fs_devices,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\tsrc_devid, NULL, NULL);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\tsrc_devid, NULL, NULL, true);"
          },
          {
            "type": "context",
            "line": " \t\tdev_replace->tgtdev = btrfs_find_device(fs_info->fs_devices,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t\tBTRFS_DEV_REPLACE_DEVID,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\tNULL, NULL);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\tNULL, NULL, true);"
          },
          {
            "type": "context",
            "line": " \t\t/*"
          },
          {
            "type": "context",
            "line": " \t\t * allow 'btrfs dev replace_cancel' if src/tgt device is"
          },
          {
            "type": "context",
            "line": " \t\t * missing"
          }
        ]
      },
      {
        "file": "fs/btrfs/ioctl.c",
        "changes": [
          {
            "type": "context",
            "line": "index fd5f97aeb35c..3f9d7be30bf4 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/ioctl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/ioctl.c"
          },
          {
            "type": "context",
            "line": " \t\tbtrfs_info(fs_info, \"resizing devid %llu\", devid);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tdevice = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL);"
          },
          {
            "type": "add",
            "line": "\tdevice = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL, true);"
          },
          {
            "type": "context",
            "line": " \tif (!device) {"
          },
          {
            "type": "context",
            "line": " \t\tbtrfs_info(fs_info, \"resizer unable to find device %llu\","
          },
          {
            "type": "context",
            "line": " \t\t\t   devid);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \trcu_read_lock();"
          },
          {
            "type": "context",
            "line": " \tdev = btrfs_find_device(fs_info->fs_devices, di_args->devid, s_uuid,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tNULL);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tNULL, true);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!dev) {"
          },
          {
            "type": "context",
            "line": " \t\tret = -ENODEV;"
          }
        ]
      },
      {
        "file": "fs/btrfs/scrub.c",
        "changes": [
          {
            "type": "context",
            "line": "index 72044efc610a..b320910c6740 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/scrub.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/scrub.c"
          },
          {
            "type": "context",
            "line": " \t\treturn PTR_ERR(sctx);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&fs_info->fs_devices->device_list_mutex);"
          },
          {
            "type": "delete",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL);"
          },
          {
            "type": "add",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL, true);"
          },
          {
            "type": "context",
            "line": " \tif (!dev || (test_bit(BTRFS_DEV_STATE_MISSING, &dev->dev_state) &&"
          },
          {
            "type": "context",
            "line": " \t\t     !is_dev_replace)) {"
          },
          {
            "type": "context",
            "line": " \t\tmutex_unlock(&fs_info->fs_devices->device_list_mutex);"
          },
          {
            "type": "context",
            "line": " \tstruct scrub_ctx *sctx = NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&fs_info->fs_devices->device_list_mutex);"
          },
          {
            "type": "delete",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL);"
          },
          {
            "type": "add",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL, true);"
          },
          {
            "type": "context",
            "line": " \tif (dev)"
          },
          {
            "type": "context",
            "line": " \t\tsctx = dev->scrub_ctx;"
          },
          {
            "type": "context",
            "line": " \tif (sctx)"
          }
        ]
      },
      {
        "file": "fs/btrfs/volumes.c",
        "changes": [
          {
            "type": "context",
            "line": "index 74bbfed6428b..7ca31c83e730 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/volumes.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/volumes.c"
          },
          {
            "type": "context",
            "line": " \treturn dev;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "/*"
          },
          {
            "type": "delete",
            "line": " * Find a device specified by @devid or @uuid in the list of @fs_devices, or"
          },
          {
            "type": "delete",
            "line": " * return NULL."
          },
          {
            "type": "delete",
            "line": " *"
          },
          {
            "type": "delete",
            "line": " * If devid and uuid are both specified, the match must be exact, otherwise"
          },
          {
            "type": "delete",
            "line": " * only devid is used."
          },
          {
            "type": "delete",
            "line": " */"
          },
          {
            "type": "delete",
            "line": "static struct btrfs_device *find_device(struct btrfs_fs_devices *fs_devices,"
          },
          {
            "type": "delete",
            "line": "\t\tu64 devid, const u8 *uuid)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "\tstruct btrfs_device *dev;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tlist_for_each_entry(dev, &fs_devices->devices, dev_list) {"
          },
          {
            "type": "delete",
            "line": "\t\tif (dev->devid == devid &&"
          },
          {
            "type": "delete",
            "line": "\t\t    (!uuid || !memcmp(dev->uuid, uuid, BTRFS_UUID_SIZE))) {"
          },
          {
            "type": "delete",
            "line": "\t\t\treturn dev;"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": "\treturn NULL;"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " static noinline struct btrfs_fs_devices *find_fsid("
          },
          {
            "type": "context",
            "line": " \t\tconst u8 *fsid, const u8 *metadata_fsid)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \t\tdevice = NULL;"
          },
          {
            "type": "context",
            "line": " \t} else {"
          },
          {
            "type": "context",
            "line": " \t\tmutex_lock(&fs_devices->device_list_mutex);"
          },
          {
            "type": "delete",
            "line": "\t\tdevice = find_device(fs_devices, devid,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tdisk_super->dev_item.uuid);"
          },
          {
            "type": "add",
            "line": "\t\tdevice = btrfs_find_device(fs_devices, devid,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tdisk_super->dev_item.uuid, NULL, false);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/*"
          },
          {
            "type": "context",
            "line": " \t\t * If this disk has been pulled into an fs devices created by"
          },
          {
            "type": "context",
            "line": " \tdev_uuid = disk_super->dev_item.uuid;"
          },
          {
            "type": "context",
            "line": " \tif (btrfs_fs_incompat(fs_info, METADATA_UUID))"
          },
          {
            "type": "context",
            "line": " \t\tdevice = btrfs_find_device(fs_info->fs_devices, devid, dev_uuid,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t   disk_super->metadata_uuid);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t   disk_super->metadata_uuid, true);"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\tdevice = btrfs_find_device(fs_info->fs_devices, devid, dev_uuid,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t   disk_super->fsid);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t   disk_super->fsid, true);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tbrelse(bh);"
          },
          {
            "type": "context",
            "line": " \tif (!device)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (devid) {"
          },
          {
            "type": "context",
            "line": " \t\tdevice = btrfs_find_device(fs_info->fs_devices, devid, NULL,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t   NULL);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t   NULL, true);"
          },
          {
            "type": "context",
            "line": " \t\tif (!device)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn ERR_PTR(-ENOENT);"
          },
          {
            "type": "context",
            "line": " \t\treturn device;"
          },
          {
            "type": "context",
            "line": " \t\tread_extent_buffer(leaf, fs_uuid, btrfs_device_fsid(dev_item),"
          },
          {
            "type": "context",
            "line": " \t\t\t\t   BTRFS_FSID_SIZE);"
          },
          {
            "type": "context",
            "line": " \t\tdevice = btrfs_find_device(fs_info->fs_devices, devid, dev_uuid,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t   fs_uuid);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t   fs_uuid, true);"
          },
          {
            "type": "context",
            "line": " \t\tBUG_ON(!device); /* Logic error */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (device->fs_devices->seeding) {"
          },
          {
            "type": "context",
            "line": " \treturn BLK_STS_OK;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " * Find a device specified by @devid or @uuid in the list of @fs_devices, or"
          },
          {
            "type": "add",
            "line": " * return NULL."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * If devid and uuid are both specified, the match must be exact, otherwise"
          },
          {
            "type": "add",
            "line": " * only devid is used."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * If @seed is true, traverse through the seed devices."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "context",
            "line": " struct btrfs_device *btrfs_find_device(struct btrfs_fs_devices *fs_devices,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t       u64 devid, u8 *uuid, u8 *fsid)"
          },
          {
            "type": "add",
            "line": "\t\t\t\t       u64 devid, u8 *uuid, u8 *fsid,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t       bool seed)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct btrfs_device *device;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \twhile (fs_devices) {"
          },
          {
            "type": "context",
            "line": " \t\tif (!fsid ||"
          },
          {
            "type": "context",
            "line": " \t\t    !memcmp(fs_devices->metadata_uuid, fsid, BTRFS_FSID_SIZE)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tdevice = find_device(fs_devices, devid, uuid);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (device)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn device;"
          },
          {
            "type": "add",
            "line": "\t\t\tlist_for_each_entry(device, &fs_devices->devices,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t    dev_list) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (device->devid == devid &&"
          },
          {
            "type": "add",
            "line": "\t\t\t\t    (!uuid || memcmp(device->uuid, uuid,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t     BTRFS_UUID_SIZE) == 0))"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\treturn device;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\tfs_devices = fs_devices->seed;"
          },
          {
            "type": "add",
            "line": "\t\tif (seed)"
          },
          {
            "type": "add",
            "line": "\t\t\tfs_devices = fs_devices->seed;"
          },
          {
            "type": "add",
            "line": "\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t\treturn NULL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \t\t\t\t   btrfs_stripe_dev_uuid_nr(chunk, i),"
          },
          {
            "type": "context",
            "line": " \t\t\t\t   BTRFS_UUID_SIZE);"
          },
          {
            "type": "context",
            "line": " \t\tmap->stripes[i].dev = btrfs_find_device(fs_info->fs_devices,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\t\tdevid, uuid, NULL);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t\tdevid, uuid, NULL, true);"
          },
          {
            "type": "context",
            "line": " \t\tif (!map->stripes[i].dev &&"
          },
          {
            "type": "context",
            "line": " \t\t    !btrfs_test_opt(fs_info, DEGRADED)) {"
          },
          {
            "type": "context",
            "line": " \t\t\tfree_extent_map(em);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdevice = btrfs_find_device(fs_info->fs_devices, devid, dev_uuid,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t   fs_uuid);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t   fs_uuid, true);"
          },
          {
            "type": "context",
            "line": " \tif (!device) {"
          },
          {
            "type": "context",
            "line": " \t\tif (!btrfs_test_opt(fs_info, DEGRADED)) {"
          },
          {
            "type": "context",
            "line": " \t\t\tbtrfs_report_missing_device(fs_info, devid,"
          },
          {
            "type": "context",
            "line": " \tint i;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&fs_devices->device_list_mutex);"
          },
          {
            "type": "delete",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, stats->devid, NULL, NULL);"
          },
          {
            "type": "add",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, stats->devid, NULL, NULL,"
          },
          {
            "type": "add",
            "line": "\t\t\t\ttrue);"
          },
          {
            "type": "context",
            "line": " \tmutex_unlock(&fs_devices->device_list_mutex);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!dev) {"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Make sure no dev extent is beyond device bondary */"
          },
          {
            "type": "delete",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL);"
          },
          {
            "type": "add",
            "line": "\tdev = btrfs_find_device(fs_info->fs_devices, devid, NULL, NULL, true);"
          },
          {
            "type": "context",
            "line": " \tif (!dev) {"
          },
          {
            "type": "context",
            "line": " \t\tbtrfs_err(fs_info, \"failed to find devid %llu\", devid);"
          },
          {
            "type": "context",
            "line": " \t\tret = -EUCLEAN;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* It's possible this device is a dummy for seed device */"
          },
          {
            "type": "context",
            "line": " \tif (dev->disk_total_bytes == 0) {"
          },
          {
            "type": "delete",
            "line": "\t\tdev = find_device(fs_info->fs_devices->seed, devid, NULL);"
          },
          {
            "type": "add",
            "line": "\t\tdev = btrfs_find_device(fs_info->fs_devices->seed, devid, NULL,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tNULL, false);"
          },
          {
            "type": "context",
            "line": " \t\tif (!dev) {"
          },
          {
            "type": "context",
            "line": " \t\t\tbtrfs_err(fs_info, \"failed to find seed devid %llu\","
          },
          {
            "type": "context",
            "line": " \t\t\t\t  devid);"
          }
        ]
      },
      {
        "file": "fs/btrfs/volumes.h",
        "changes": [
          {
            "type": "context",
            "line": "index 4b7c049c8c7c..656ea8d85770 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/btrfs/volumes.h"
          },
          {
            "type": "context",
            "line": "+++ b/fs/btrfs/volumes.h"
          },
          {
            "type": "context",
            "line": " int btrfs_grow_device(struct btrfs_trans_handle *trans,"
          },
          {
            "type": "context",
            "line": " \t\t      struct btrfs_device *device, u64 new_size);"
          },
          {
            "type": "context",
            "line": " struct btrfs_device *btrfs_find_device(struct btrfs_fs_devices *fs_devices,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t       u64 devid, u8 *uuid, u8 *fsid);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t       u64 devid, u8 *uuid, u8 *fsid, bool seed);"
          },
          {
            "type": "context",
            "line": " int btrfs_shrink_device(struct btrfs_device *device, u64 new_size);"
          },
          {
            "type": "context",
            "line": " int btrfs_init_new_device(struct btrfs_fs_info *fs_info, const char *path);"
          },
          {
            "type": "context",
            "line": " int btrfs_balance(struct btrfs_fs_info *fs_info,"
          }
        ]
      }
    ]
  },
  {
    "commit": "09ccfd238e5a0e670d8178cf50180ea81ae09ae1",
    "files": [
      {
        "file": "drivers/net/ppp/pptp.c",
        "changes": [
          {
            "type": "context",
            "line": "index fc69e41d0950..597c53e0a2ec 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/ppp/pptp.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/ppp/pptp.c"
          },
          {
            "type": "context",
            "line": " \tstruct pptp_opt *opt = &po->proto.pptp;"
          },
          {
            "type": "context",
            "line": " \tint error = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (sockaddr_len < sizeof(struct sockaddr_pppox))"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tlock_sock(sk);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \topt->src_addr = sp->sa_addr.pptp;"
          },
          {
            "type": "context",
            "line": " \tstruct flowi4 fl4;"
          },
          {
            "type": "context",
            "line": " \tint error = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (sockaddr_len < sizeof(struct sockaddr_pppox))"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (sp->sa_protocol != PX_PROTO_PPTP)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a0b98734479aa5b3c671d5190e86273372cab95",
    "files": [
      {
        "file": "kernel/compat.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6d21894806b4..92d8c98c0f57 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/compat.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/compat.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct compat_timex tx32;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tmemset(txc, 0, sizeof(struct timex));"
          },
          {
            "type": "context",
            "line": " \tif (copy_from_user(&tx32, utp, sizeof(struct compat_timex)))"
          },
          {
            "type": "context",
            "line": " \t\treturn -EFAULT;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a515a06c5ebfa46fee3ac519e418f801e718da4",
    "files": [
      {
        "file": "tools/perf/util/expr.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1d532b9fed29..254601060b39 100644"
          },
          {
            "type": "context",
            "line": "--- a/tools/perf/util/expr.c"
          },
          {
            "type": "context",
            "line": "+++ b/tools/perf/util/expr.c"
          },
          {
            "type": "context",
            "line": " #include \"expr-bison.h\""
          },
          {
            "type": "context",
            "line": " #include \"expr-flex.h\""
          },
          {
            "type": "context",
            "line": " #include \"smt.h\""
          },
          {
            "type": "add",
            "line": "#include <linux/err.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/kernel.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/zalloc.h>"
          },
          {
            "type": "context",
            "line": " #include <ctype.h>"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tctx->ids = hashmap__new(key_hash, key_equal, NULL);"
          },
          {
            "type": "add",
            "line": "\tif (IS_ERR(ctx->ids)) {"
          },
          {
            "type": "add",
            "line": "\t\tfree(ctx);"
          },
          {
            "type": "add",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \tctx->runtime = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn ctx;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a54917c3fc295cb61f3fb52373c173fd3b69f48",
    "files": [
      {
        "file": "drivers/net/wireless/orinoco/wext.c",
        "changes": [
          {
            "type": "context",
            "line": "index 93505f93bf97..e5afabee60d1 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/wireless/orinoco/wext.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/wireless/orinoco/wext.c"
          },
          {
            "type": "context",
            "line": " \t\t */"
          },
          {
            "type": "context",
            "line": " \t\tif (param->value) {"
          },
          {
            "type": "context",
            "line": " \t\t\tpriv->tkip_cm_active = 1;"
          },
          {
            "type": "delete",
            "line": "\t\t\tret = hermes_enable_port(hw, 0);"
          },
          {
            "type": "add",
            "line": "\t\t\tret = hermes_disable_port(hw, 0);"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\tpriv->tkip_cm_active = 0;"
          },
          {
            "type": "delete",
            "line": "\t\t\tret = hermes_disable_port(hw, 0);"
          },
          {
            "type": "add",
            "line": "\t\t\tret = hermes_enable_port(hw, 0);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a5bee9465e627be36bac88edf7d9bbc9626126d",
    "files": [
      {
        "file": "lihandler/redirect.js",
        "changes": [
          {
            "type": "context",
            "line": "index 998a8c23..a464e052 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/handler/redirect.js"
          },
          {
            "type": "context",
            "line": "+++ b/lib/handler/redirect.js"
          },
          {
            "type": "context",
            "line": "   return ("
          },
          {
            "type": "context",
            "line": "     (header.length === 4 && header.toString().toLowerCase() === 'host') ||"
          },
          {
            "type": "context",
            "line": "     (removeContent && header.toString().toLowerCase().indexOf('content-') === 0) ||"
          },
          {
            "type": "delete",
            "line": "    (unknownOrigin && header.length === 13 && header.toString().toLowerCase() === 'authorization')"
          },
          {
            "type": "add",
            "line": "    (unknownOrigin && header.length === 13 && header.toString().toLowerCase() === 'authorization') ||"
          },
          {
            "type": "add",
            "line": "    (unknownOrigin && header.length === 6 && header.toString().toLowerCase() === 'cookie')"
          },
          {
            "type": "context",
            "line": "   )"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "test/redirect-request.js",
        "changes": [
          {
            "type": "context",
            "line": "index 73c8cdbf..930f6512 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/redirect-request.js"
          },
          {
            "type": "context",
            "line": "+++ b/test/redirect-request.js"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithBodyServer,"
          },
          {
            "type": "context",
            "line": "   startRedirectingChainServers,"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithoutLocationServer,"
          },
          {
            "type": "delete",
            "line": "  startRedirectingWithAuthorization"
          },
          {
            "type": "add",
            "line": "  startRedirectingWithAuthorization,"
          },
          {
            "type": "add",
            "line": "  startRedirectingWithCookie"
          },
          {
            "type": "context",
            "line": " } = require('./utils/redirecting-servers')"
          },
          {
            "type": "context",
            "line": " const { createReadable, createReadableStream } = require('./utils/stream')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   t.equal(body, '')"
          },
          {
            "type": "context",
            "line": " })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "t.test('removes cookie header on third party origin', async t => {"
          },
          {
            "type": "add",
            "line": "  t.plan(1)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  const [server1] = await startRedirectingWithCookie(t, 'a=b')"
          },
          {
            "type": "add",
            "line": "  const { body: bodyStream } = await undici.request(`http://${server1}`, {"
          },
          {
            "type": "add",
            "line": "    maxRedirections: 10,"
          },
          {
            "type": "add",
            "line": "    headers: {"
          },
          {
            "type": "add",
            "line": "      cookie: 'a=b'"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "  })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  let body = ''"
          },
          {
            "type": "add",
            "line": "  for await (const b of bodyStream) {"
          },
          {
            "type": "add",
            "line": "    body += b"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  t.equal(body, '')"
          },
          {
            "type": "add",
            "line": "})"
          }
        ]
      },
      {
        "file": "test/redirect-stream.js",
        "changes": [
          {
            "type": "context",
            "line": "index ac60c701..abb778c2 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/redirect-stream.js"
          },
          {
            "type": "context",
            "line": "+++ b/test/redirect-stream.js"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithBodyServer,"
          },
          {
            "type": "context",
            "line": "   startRedirectingChainServers,"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithoutLocationServer,"
          },
          {
            "type": "delete",
            "line": "  startRedirectingWithAuthorization"
          },
          {
            "type": "add",
            "line": "  startRedirectingWithAuthorization,"
          },
          {
            "type": "add",
            "line": "  startRedirectingWithCookie"
          },
          {
            "type": "context",
            "line": " } = require('./utils/redirecting-servers')"
          },
          {
            "type": "context",
            "line": " const { createReadable, createWritable } = require('./utils/stream')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   t.equal(body.length, 0)"
          },
          {
            "type": "context",
            "line": " })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "t.test('removes cookie header on third party origin', async t => {"
          },
          {
            "type": "add",
            "line": "  t.plan(1)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  const body = []"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  const [server1] = await startRedirectingWithCookie(t, 'a=b')"
          },
          {
            "type": "add",
            "line": "  await stream(`http://${server1}`, {"
          },
          {
            "type": "add",
            "line": "    maxRedirections: 10,"
          },
          {
            "type": "add",
            "line": "    opaque: body,"
          },
          {
            "type": "add",
            "line": "    headers: {"
          },
          {
            "type": "add",
            "line": "      cookie: 'a=b'"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "  }, ({ statusCode, headers, opaque }) => createWritable(opaque))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  t.equal(body.length, 0)"
          },
          {
            "type": "add",
            "line": "})"
          }
        ]
      },
      {
        "file": "test/utils/redirecting-servers.js",
        "changes": [
          {
            "type": "context",
            "line": "index 02812a97..4b3f51cd 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/utils/redirecting-servers.js"
          },
          {
            "type": "context",
            "line": "+++ b/test/utils/redirecting-servers.js"
          },
          {
            "type": "context",
            "line": "   return [server1, server2]"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "async function startRedirectingWithCookie (t, cookie) {"
          },
          {
            "type": "add",
            "line": "  const server1 = await startServer(t, (req, res) => {"
          },
          {
            "type": "add",
            "line": "    if (req.headers.cookie !== cookie) {"
          },
          {
            "type": "add",
            "line": "      res.statusCode = 403"
          },
          {
            "type": "add",
            "line": "      res.setHeader('Connection', 'close')"
          },
          {
            "type": "add",
            "line": "      res.end('')"
          },
          {
            "type": "add",
            "line": "      return"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    res.statusCode = 301"
          },
          {
            "type": "add",
            "line": "    res.setHeader('Connection', 'close')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    res.setHeader('Location', `http://${server2}`)"
          },
          {
            "type": "add",
            "line": "    res.end('')"
          },
          {
            "type": "add",
            "line": "  })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  const server2 = await startServer(t, (req, res) => {"
          },
          {
            "type": "add",
            "line": "    res.end(req.headers.cookie || '')"
          },
          {
            "type": "add",
            "line": "  })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  return [server1, server2]"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " async function startRedirectingWithRelativePath (t) {"
          },
          {
            "type": "context",
            "line": "   const server = await startServer(t, (req, res) => {"
          },
          {
            "type": "context",
            "line": "     res.setHeader('Connection', 'close')"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithoutLocationServer,"
          },
          {
            "type": "context",
            "line": "   startRedirectingChainServers,"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithAuthorization,"
          },
          {
            "type": "add",
            "line": "  startRedirectingWithCookie,"
          },
          {
            "type": "context",
            "line": "   startRedirectingWithRelativePath"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a709e2a10b8288a0cc383547924ecfe285cef89",
    "files": [
      {
        "file": "libavcodec/dnxhd_parser.c",
        "changes": [
          {
            "type": "context",
            "line": "index a1f632a620..f1166be100 100644"
          },
          {
            "type": "context",
            "line": "--- a/libavcodec/dnxhd_parser.c"
          },
          {
            "type": "context",
            "line": "+++ b/libavcodec/dnxhd_parser.c"
          },
          {
            "type": "context",
            "line": "                 dctx->w = (state >> 32) & 0xFFFF;"
          },
          {
            "type": "context",
            "line": "             } else if (dctx->cur_byte == 42) {"
          },
          {
            "type": "context",
            "line": "                 int cid = (state >> 32) & 0xFFFFFFFF;"
          },
          {
            "type": "add",
            "line": "                int remaining;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 if (cid <= 0)"
          },
          {
            "type": "context",
            "line": "                     continue;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "                dctx->remaining = avpriv_dnxhd_get_frame_size(cid);"
          },
          {
            "type": "delete",
            "line": "                if (dctx->remaining <= 0) {"
          },
          {
            "type": "delete",
            "line": "                    dctx->remaining = dnxhd_get_hr_frame_size(cid, dctx->w, dctx->h);"
          },
          {
            "type": "delete",
            "line": "                    if (dctx->remaining <= 0)"
          },
          {
            "type": "delete",
            "line": "                        return dctx->remaining;"
          },
          {
            "type": "add",
            "line": "                remaining = avpriv_dnxhd_get_frame_size(cid);"
          },
          {
            "type": "add",
            "line": "                if (remaining <= 0) {"
          },
          {
            "type": "add",
            "line": "                    remaining = dnxhd_get_hr_frame_size(cid, dctx->w, dctx->h);"
          },
          {
            "type": "add",
            "line": "                    if (remaining <= 0)"
          },
          {
            "type": "add",
            "line": "                        continue;"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "add",
            "line": "                dctx->remaining = remaining;"
          },
          {
            "type": "context",
            "line": "                 if (buf_size - i + 47 >= dctx->remaining) {"
          },
          {
            "type": "context",
            "line": "                     int remaining = dctx->remaining;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a85029d694f992f3631e2f249e4999daee15cbf",
    "files": [
      {
        "file": "src/isomedia/avc_ext.c",
        "changes": [
          {
            "type": "context",
            "line": "index a3674510b..0e7d96a96 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/isomedia/avc_ext.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/isomedia/avc_ext.c"
          },
          {
            "type": "context",
            "line": " \t\top->output_layer_set_idx = gf_bs_read_u16(bs);"
          },
          {
            "type": "context",
            "line": " \t\top->max_temporal_id = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\top->layer_count = gf_bs_read_u8(bs);"
          },
          {
            "type": "delete",
            "line": "\t\tif (op->layer_count > GF_ARRAY_LENGTH(op->layers_info))"
          },
          {
            "type": "add",
            "line": "\t\tif (op->layer_count > GF_ARRAY_LENGTH(op->layers_info)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tgf_free(op);"
          },
          {
            "type": "context",
            "line": " \t\t\treturn GF_NON_COMPLIANT_BITSTREAM;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\tfor (j = 0; j < op->layer_count; j++) {"
          },
          {
            "type": "context",
            "line": " \t\t\top->layers_info[j].ptl_idx = gf_bs_read_u8(bs);"
          },
          {
            "type": "context",
            "line": " \t\t\top->layers_info[j].layer_id = gf_bs_read_int(bs, 6);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0a9ab9bdb3e891762553f667066190c1d22ad62b",
    "files": [
      {
        "file": "net/bluetooth/hidp/core.c",
        "changes": [
          {
            "type": "context",
            "line": "index b2bcbe2dc328..a7352ff3fd1e 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/bluetooth/hidp/core.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/bluetooth/hidp/core.c"
          },
          {
            "type": "context",
            "line": " \thid->version = req->version;"
          },
          {
            "type": "context",
            "line": " \thid->country = req->country;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tstrncpy(hid->name, req->name, 128);"
          },
          {
            "type": "add",
            "line": "\tstrncpy(hid->name, req->name, sizeof(req->name) - 1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tsnprintf(hid->phys, sizeof(hid->phys), \"%pMR\","
          },
          {
            "type": "context",
            "line": " \t\t &bt_sk(session->ctrl_sock->sk)->src);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0ab152c6b5d95caa2dc1a30fa96e10258b5f188e",
    "files": [
      {
        "file": "Liftplib.py",
        "changes": [
          {
            "type": "context",
            "line": "index 1f760ed1ce0..7c5a50715f6 100644"
          },
          {
            "type": "context",
            "line": "--- a/Lib/ftplib.py"
          },
          {
            "type": "context",
            "line": "+++ b/Lib/ftplib.py"
          },
          {
            "type": "context",
            "line": "     sock = None"
          },
          {
            "type": "context",
            "line": "     file = None"
          },
          {
            "type": "context",
            "line": "     welcome = None"
          },
          {
            "type": "delete",
            "line": "    passiveserver = 1"
          },
          {
            "type": "add",
            "line": "    passiveserver = True"
          },
          {
            "type": "add",
            "line": "    # Disables https://bugs.python.org/issue43285 security if set to True."
          },
          {
            "type": "add",
            "line": "    trust_server_pasv_ipv4_address = False"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def __init__(self, host='', user='', passwd='', acct='',"
          },
          {
            "type": "context",
            "line": "                  timeout=_GLOBAL_DEFAULT_TIMEOUT, source_address=None, *,"
          },
          {
            "type": "context",
            "line": "         return sock"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def makepasv(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\"Internal: Does the PASV or EPSV handshake -> (address, port)\"\"\""
          },
          {
            "type": "context",
            "line": "         if self.af == socket.AF_INET:"
          },
          {
            "type": "delete",
            "line": "            host, port = parse227(self.sendcmd('PASV'))"
          },
          {
            "type": "add",
            "line": "            untrusted_host, port = parse227(self.sendcmd('PASV'))"
          },
          {
            "type": "add",
            "line": "            if self.trust_server_pasv_ipv4_address:"
          },
          {
            "type": "add",
            "line": "                host = untrusted_host"
          },
          {
            "type": "add",
            "line": "            else:"
          },
          {
            "type": "add",
            "line": "                host = self.sock.getpeername()[0]"
          },
          {
            "type": "context",
            "line": "         else:"
          },
          {
            "type": "context",
            "line": "             host, port = parse229(self.sendcmd('EPSV'), self.sock.getpeername())"
          },
          {
            "type": "context",
            "line": "         return host, port"
          }
        ]
      },
      {
        "file": "Litest/test_ftplib.py",
        "changes": [
          {
            "type": "context",
            "line": "index 2424911c7ac..154dce15e2c 100644"
          },
          {
            "type": "context",
            "line": "--- a/Lib/test/test_ftplib.py"
          },
          {
            "type": "context",
            "line": "+++ b/Lib/test/test_ftplib.py"
          },
          {
            "type": "context",
            "line": "         self.next_retr_data = RETR_DATA"
          },
          {
            "type": "context",
            "line": "         self.push('220 welcome')"
          },
          {
            "type": "context",
            "line": "         self.encoding = encoding"
          },
          {
            "type": "add",
            "line": "        # We use this as the string IPv4 address to direct the client"
          },
          {
            "type": "add",
            "line": "        # to in response to a PASV command.  To test security behavior."
          },
          {
            "type": "add",
            "line": "        # https://bugs.python.org/issue43285/."
          },
          {
            "type": "add",
            "line": "        self.fake_pasv_server_ip = '252.253.254.255'"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def collect_incoming_data(self, data):"
          },
          {
            "type": "context",
            "line": "         self.in_buffer.append(data)"
          },
          {
            "type": "context",
            "line": "     def cmd_pasv(self, arg):"
          },
          {
            "type": "context",
            "line": "         with socket.create_server((self.socket.getsockname()[0], 0)) as sock:"
          },
          {
            "type": "context",
            "line": "             sock.settimeout(TIMEOUT)"
          },
          {
            "type": "delete",
            "line": "            ip, port = sock.getsockname()[:2]"
          },
          {
            "type": "add",
            "line": "            port = sock.getsockname()[1]"
          },
          {
            "type": "add",
            "line": "            ip = self.fake_pasv_server_ip"
          },
          {
            "type": "context",
            "line": "             ip = ip.replace('.', ','); p1 = port / 256; p2 = port % 256"
          },
          {
            "type": "context",
            "line": "             self.push('227 entering passive mode (%s,%d,%d)' %(ip, p1, p2))"
          },
          {
            "type": "context",
            "line": "             conn, addr = sock.accept()"
          },
          {
            "type": "context",
            "line": "         # IPv4 is in use, just make sure send_epsv has not been used"
          },
          {
            "type": "context",
            "line": "         self.assertEqual(self.server.handler_instance.last_received_cmd, 'pasv')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_makepasv_issue43285_security_disabled(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\"Test the opt-in to the old vulnerable behavior.\"\"\""
          },
          {
            "type": "add",
            "line": "        self.client.trust_server_pasv_ipv4_address = True"
          },
          {
            "type": "add",
            "line": "        bad_host, port = self.client.makepasv()"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "                bad_host, self.server.handler_instance.fake_pasv_server_ip)"
          },
          {
            "type": "add",
            "line": "        # Opening and closing a connection keeps the dummy server happy"
          },
          {
            "type": "add",
            "line": "        # instead of timing out on accept."
          },
          {
            "type": "add",
            "line": "        socket.create_connection((self.client.sock.getpeername()[0], port),"
          },
          {
            "type": "add",
            "line": "                                 timeout=TIMEOUT).close()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_makepasv_issue43285_security_enabled_default(self):"
          },
          {
            "type": "add",
            "line": "        self.assertFalse(self.client.trust_server_pasv_ipv4_address)"
          },
          {
            "type": "add",
            "line": "        trusted_host, port = self.client.makepasv()"
          },
          {
            "type": "add",
            "line": "        self.assertNotEqual("
          },
          {
            "type": "add",
            "line": "                trusted_host, self.server.handler_instance.fake_pasv_server_ip)"
          },
          {
            "type": "add",
            "line": "        # Opening and closing a connection keeps the dummy server happy"
          },
          {
            "type": "add",
            "line": "        # instead of timing out on accept."
          },
          {
            "type": "add",
            "line": "        socket.create_connection((trusted_host, port), timeout=TIMEOUT).close()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_with_statement(self):"
          },
          {
            "type": "context",
            "line": "         self.client.quit()"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "Misc/NEWS.d/next/Security/2021-03-13-03-48-14.bpo-43285.g-Hah3.rst",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..8312b7e8854"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/Misc/NEWS.d/next/Security/2021-03-13-03-48-14.bpo-43285.g-Hah3.rst"
          },
          {
            "type": "add",
            "line": ":mod:`ftplib` no longer trusts the IP address value returned from the server"
          },
          {
            "type": "add",
            "line": "in response to the PASV command by default.  This prevents a malicious FTP"
          },
          {
            "type": "add",
            "line": "server from using the response to probe IPv4 address and port combinations"
          },
          {
            "type": "add",
            "line": "on the client network."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Code that requires the former vulnerable behavior may set a"
          },
          {
            "type": "add",
            "line": "``trust_server_pasv_ipv4_address`` attribute on their"
          },
          {
            "type": "add",
            "line": ":class:`ftplib.FTP` instances to ``True`` to re-enable it."
          }
        ]
      }
    ]
  },
  {
    "commit": "0ad646c81b2182f7fa67ec0c8c825e0ee165696d",
    "files": [
      {
        "file": "drivers/net/tun.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5ce580f413b9..e21bf90b819f 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/tun.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/tun.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (!dev)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\t\terr = dev_get_valid_name(net, dev, name);"
          },
          {
            "type": "add",
            "line": "\t\tif (err)"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto err_free_dev;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tdev_net_set(dev, net);"
          },
          {
            "type": "context",
            "line": " \t\tdev->rtnl_link_ops = &tun_link_ops;"
          }
        ]
      },
      {
        "file": "include/linux/netdevice.h",
        "changes": [
          {
            "type": "context",
            "line": "index f535779d9dc1..2eaac7d75af4 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/netdevice.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/netdevice.h"
          },
          {
            "type": "context",
            "line": " \t\t\t\t    unsigned char name_assign_type,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t    void (*setup)(struct net_device *),"
          },
          {
            "type": "context",
            "line": " \t\t\t\t    unsigned int txqs, unsigned int rxqs);"
          },
          {
            "type": "add",
            "line": "int dev_get_valid_name(struct net *net, struct net_device *dev,"
          },
          {
            "type": "add",
            "line": "\t\t       const char *name);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define alloc_netdev(sizeof_priv, name, name_assign_type, setup) \\"
          },
          {
            "type": "context",
            "line": " \talloc_netdev_mqs(sizeof_priv, name, name_assign_type, setup, 1, 1)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "net/core/dev.c",
        "changes": [
          {
            "type": "context",
            "line": "index 588b473194a8..11596a302a26 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/core/dev.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/core/dev.c"
          },
          {
            "type": "context",
            "line": " \treturn ret;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static int dev_get_valid_name(struct net *net,"
          },
          {
            "type": "delete",
            "line": "\t\t\t      struct net_device *dev,"
          },
          {
            "type": "delete",
            "line": "\t\t\t      const char *name)"
          },
          {
            "type": "add",
            "line": "int dev_get_valid_name(struct net *net, struct net_device *dev,"
          },
          {
            "type": "add",
            "line": "\t\t       const char *name)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tBUG_ON(!net);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": "EXPORT_SYMBOL(dev_get_valid_name);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": "  *\tdev_change_name - change name of a device"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b18d0c960c27994dd9870d286f2da3fa5868c06",
    "files": [
      {
        "file": "mod/lesson/format.php",
        "changes": [
          {
            "type": "context",
            "line": "index 02b58d66480..d7c68d695c1 100644"
          },
          {
            "type": "context",
            "line": "--- a/mod/lesson/format.php"
          },
          {
            "type": "context",
            "line": "+++ b/mod/lesson/format.php"
          },
          {
            "type": "context",
            "line": "         // @@PLUGINFILE@@ with a real URL, but it doesn't matter what."
          },
          {
            "type": "context",
            "line": "         // We use http://example.com/."
          },
          {
            "type": "context",
            "line": "         $text = str_replace('@@PLUGINFILE@@/', 'http://example.com/', $question->questiontext);"
          },
          {
            "type": "delete",
            "line": "        return html_to_text(format_text($text,"
          },
          {
            "type": "delete",
            "line": "                $question->questiontextformat, $formatoptions), 0, false);"
          },
          {
            "type": "add",
            "line": "        return s(html_to_text(format_text($text,"
          },
          {
            "type": "add",
            "line": "                $question->questiontextformat, $formatoptions), 0, false));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          }
        ]
      },
      {
        "file": "question/format.php",
        "changes": [
          {
            "type": "context",
            "line": "index 2efb253ad5b..9677c19f083 100644"
          },
          {
            "type": "context",
            "line": "--- a/question/format.php"
          },
          {
            "type": "context",
            "line": "+++ b/question/format.php"
          },
          {
            "type": "context",
            "line": "      * during import to let the user see roughly what is going on."
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     protected function format_question_text($question) {"
          },
          {
            "type": "delete",
            "line": "        return question_utils::to_plain_text($question->questiontext,"
          },
          {
            "type": "delete",
            "line": "                $question->questiontextformat);"
          },
          {
            "type": "add",
            "line": "        return s(question_utils::to_plain_text($question->questiontext,"
          },
          {
            "type": "add",
            "line": "                $question->questiontextformat));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b2945fbd260d37aa0aff2ca1c867d160f76188d",
    "files": [
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index 78ad35bd79f..be7196db43f 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/package.json"
          },
          {
            "type": "context",
            "line": "   \"dependencies\": {"
          },
          {
            "type": "context",
            "line": "     \"@tuleap/tlp-swatch-colors\": \"workspace:*\","
          },
          {
            "type": "context",
            "line": "     \"dompurify\": \"^3.0.0\","
          },
          {
            "type": "delete",
            "line": "    \"escape-string-regexp\": \"^2.0.0\""
          },
          {
            "type": "add",
            "line": "    \"escape-string-regexp\": \"^2.0.0\","
          },
          {
            "type": "add",
            "line": "    \"hybrids\": \"^8.2.1\""
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   \"peerDependencies\": {"
          },
          {
            "type": "context",
            "line": "     \"angular\": \"^1.8.0\","
          },
          {
            "type": "delete",
            "line": "    \"angular-sanitize\": \"^1.8.0\","
          },
          {
            "type": "context",
            "line": "     \"moment\": \"^2.29.1\""
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   \"devDependencies\": {"
          },
          {
            "type": "context",
            "line": "     \"@tuleap/build-system-configurator\": \"workspace:*\","
          },
          {
            "type": "context",
            "line": "     \"@types/dompurify\": \"^2.4.0\","
          },
          {
            "type": "context",
            "line": "     \"angular\": \"^1.8.2\","
          },
          {
            "type": "delete",
            "line": "    \"angular-mocks\": \"^1.8.2\","
          },
          {
            "type": "delete",
            "line": "    \"angular-sanitize\": \"^1.8.2\""
          },
          {
            "type": "add",
            "line": "    \"angular-mocks\": \"^1.8.2\""
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   \"scripts\": {"
          },
          {
            "type": "context",
            "line": "     \"build\": \"vite build\","
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/pnpm-lock.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 45c6d8c42df..80d33857218 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/pnpm-lock.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/pnpm-lock.yaml"
          },
          {
            "type": "context",
            "line": "   escape-string-regexp:"
          },
          {
            "type": "context",
            "line": "     specifier: ^2.0.0"
          },
          {
            "type": "context",
            "line": "     version: 2.0.0"
          },
          {
            "type": "add",
            "line": "  hybrids:"
          },
          {
            "type": "add",
            "line": "    specifier: ^8.2.1"
          },
          {
            "type": "add",
            "line": "    version: 8.2.1"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " devDependencies:"
          },
          {
            "type": "context",
            "line": "   '@tuleap/build-system-configurator':"
          },
          {
            "type": "context",
            "line": "   angular-mocks:"
          },
          {
            "type": "context",
            "line": "     specifier: ^1.8.2"
          },
          {
            "type": "context",
            "line": "     version: 1.8.2"
          },
          {
            "type": "delete",
            "line": "  angular-sanitize:"
          },
          {
            "type": "delete",
            "line": "    specifier: ^1.8.2"
          },
          {
            "type": "delete",
            "line": "    version: 1.8.2"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " packages:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     resolution: {integrity: sha512-I5L3P0l21HPdVsP4A4qWmENt4ePjjbkDFdAzOaM7QiibFySbt14DptPbt2IjeG4vFBr4vSLbhIz8Fk03DISl8Q==}"
          },
          {
            "type": "context",
            "line": "     dev: true"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  /angular-sanitize@1.8.2:"
          },
          {
            "type": "delete",
            "line": "    resolution: {integrity: sha512-OB6Goa+QN3byf5asQ7XRl7DKZejm/F/ZOqa9z1skqYVOWA2hoBxoCmt9E7+i7T/TbxZP5zYzKxNZVVJNu860Hg==}"
          },
          {
            "type": "delete",
            "line": "    dev: true"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "   /angular@1.8.2:"
          },
          {
            "type": "context",
            "line": "     resolution: {integrity: sha512-IauMOej2xEe7/7Ennahkbb5qd/HFADiNuLSESz9Q27inmi32zB0lnAsFeLEWcox3Gd1F6YhNd1CP7/9IukJ0Gw==}"
          },
          {
            "type": "context",
            "line": "     dev: true"
          },
          {
            "type": "context",
            "line": "     resolution: {integrity: sha512-UpzcLCXolUWcNu5HtVMHYdXJjArjsF9C0aNnquZYY4uW/Vu0miy5YoWvbV345HauVvcAUnpRuhMMcqTcGOY2+w==}"
          },
          {
            "type": "context",
            "line": "     engines: {node: '>=8'}"
          },
          {
            "type": "context",
            "line": "     dev: false"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  /hybrids@8.2.1:"
          },
          {
            "type": "add",
            "line": "    resolution: {integrity: sha512-ZIjDLZi6aBOL+Cdry1xtBLJJnMzx99HNwmOCQXEvqdawyYu949z469vxgExyAgq0CA4lSfJsjh1rsiIsGdqXdw==}"
          },
          {
            "type": "add",
            "line": "    engines: {node: '>=18.0.0'}"
          },
          {
            "type": "add",
            "line": "    hasBin: true"
          },
          {
            "type": "add",
            "line": "    dev: false"
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/src/card-fields-service.js",
        "changes": [
          {
            "type": "context",
            "line": "index bbb5842db41..f372234ad0c 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/src/card-fields-service.js"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/src/card-fields-service.js"
          },
          {
            "type": "delete",
            "line": "import moment from \"moment\";"
          },
          {
            "type": "add",
            "line": "import { html } from \"hybrids\";"
          },
          {
            "type": "add",
            "line": "import { highlightFilterElements } from \"./highlight-filter-template\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " export default CardFieldsService;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "CardFieldsService.$inject = [\"$sce\", \"$filter\"];"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "function CardFieldsService($sce, $filter) {"
          },
          {
            "type": "delete",
            "line": "    const highlight = $filter(\"tuleapHighlight\");"
          },
          {
            "type": "add",
            "line": "CardFieldsService.$inject = [\"$sce\"];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "function CardFieldsService($sce) {"
          },
          {
            "type": "context",
            "line": "     return {"
          },
          {
            "type": "context",
            "line": "         cardFieldIsSimpleValue,"
          },
          {
            "type": "context",
            "line": "         cardFieldIsList,"
          },
          {
            "type": "context",
            "line": "         cardFieldIsPermissions,"
          },
          {
            "type": "context",
            "line": "         cardFieldIsUser,"
          },
          {
            "type": "context",
            "line": "         cardFieldIsComputed,"
          },
          {
            "type": "delete",
            "line": "        getCardFieldDateValue,"
          },
          {
            "type": "context",
            "line": "         getCardFieldListValues,"
          },
          {
            "type": "context",
            "line": "         getCardFieldFileValue,"
          },
          {
            "type": "context",
            "line": "         getCardFieldPermissionsValue,"
          },
          {
            "type": "context",
            "line": "             } else if (value.tlp_color) {"
          },
          {
            "type": "context",
            "line": "                 return getValueRenderedWithTlpColor(value, filter_terms);"
          },
          {
            "type": "context",
            "line": "             } else if (value.avatar_url) {"
          },
          {
            "type": "delete",
            "line": "                return getCardFieldUserValue(value, filter_terms);"
          },
          {
            "type": "add",
            "line": "                return getCardFieldUserValueTemplate(value, filter_terms);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            return highlight(value.label, filter_terms);"
          },
          {
            "type": "add",
            "line": "            return highlightFilterElements(value.label, filter_terms);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         function getValueRenderedWithColor(value, filter_terms) {"
          },
          {
            "type": "context",
            "line": "             const r = parseInt(value.color.r, 10);"
          },
          {
            "type": "context",
            "line": "             const g = parseInt(value.color.g, 10);"
          },
          {
            "type": "context",
            "line": "             const b = parseInt(value.color.b, 10);"
          },
          {
            "type": "delete",
            "line": "            const color = $sce.getTrustedHtml(`<span class=\"extra-card-field-color\""
          },
          {
            "type": "delete",
            "line": "                style=\"background: rgb(${r}, ${g}, ${b})\"></span>`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            return color + highlight(value.label, filter_terms);"
          },
          {
            "type": "add",
            "line": "            const styles = {"
          },
          {
            "type": "add",
            "line": "                background: `rgb(${r}, ${g}, ${b})`,"
          },
          {
            "type": "add",
            "line": "            };"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            return html`<span class=\"extra-card-field-color\" style=\"${styles}\"></span"
          },
          {
            "type": "add",
            "line": "                >${highlightFilterElements(value.label, filter_terms)}`;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         function getValueRenderedWithTlpColor({ label, tlp_color }, filter_terms) {"
          },
          {
            "type": "delete",
            "line": "            const color = $sce.getTrustedHtml("
          },
          {
            "type": "delete",
            "line": "                `<span class=\"extra-card-field-color card-field-${tlp_color}\"></span>`"
          },
          {
            "type": "delete",
            "line": "            );"
          },
          {
            "type": "add",
            "line": "            const classlist = [\"extra-card-field-color\", `card-field-${tlp_color}`];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            return color + highlight(label, filter_terms);"
          },
          {
            "type": "add",
            "line": "            return html`<span class=\"${classlist}\"></span>${highlightFilterElements("
          },
          {
            "type": "add",
            "line": "                    label,"
          },
          {
            "type": "add",
            "line": "                    filter_terms"
          },
          {
            "type": "add",
            "line": "                )}`;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return $sce.trustAsHtml(values.map(getValueRendered).join(\", \"));"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    function getCardFieldDateValue(value) {"
          },
          {
            "type": "delete",
            "line": "        return moment(value).fromNow();"
          },
          {
            "type": "add",
            "line": "        return getHTMLStringFromTemplate(renderListItems(values, getValueRendered));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     function getCardFieldFileValue(artifact_id, field_id, file_descriptions, filter_terms) {"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         function getFileLink(file) {"
          },
          {
            "type": "delete",
            "line": "            var file_name = highlight(file.name, filter_terms);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            return ("
          },
          {
            "type": "delete",
            "line": "                '<a data-nodrag=\"true\" href=\"' +"
          },
          {
            "type": "delete",
            "line": "                getFileUrl(file) +"
          },
          {
            "type": "delete",
            "line": "                '\" title=\"' +"
          },
          {
            "type": "delete",
            "line": "                file.description +"
          },
          {
            "type": "delete",
            "line": "                '\"><i class=\"fas fa-paperclip extra-card-field-file-icon\"></i>' +"
          },
          {
            "type": "delete",
            "line": "                file_name +"
          },
          {
            "type": "delete",
            "line": "                \"</a>\""
          },
          {
            "type": "delete",
            "line": "            );"
          },
          {
            "type": "add",
            "line": "            const file_display = html`<i class=\"fas fa-paperclip extra-card-field-file-icon\"></i"
          },
          {
            "type": "add",
            "line": "                >${highlightFilterElements(file.name, filter_terms)}`;"
          },
          {
            "type": "add",
            "line": "            return html`<a data-nodrag=\"true\" href=\"${getFileUrl(file)}\" title=\"${file.description}\""
          },
          {
            "type": "add",
            "line": "                >${file_display}</a"
          },
          {
            "type": "add",
            "line": "            >`;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return file_descriptions.map(getFileLink).join(\", \");"
          },
          {
            "type": "add",
            "line": "        return getHTMLStringFromTemplate(renderListItems(file_descriptions, getFileLink));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    function getCardFieldPermissionsValue(values) {"
          },
          {
            "type": "delete",
            "line": "        return values.join(\", \");"
          },
          {
            "type": "add",
            "line": "    function getCardFieldPermissionsValue(values, filter_terms) {"
          },
          {
            "type": "add",
            "line": "        return getHTMLStringFromTemplate("
          },
          {
            "type": "add",
            "line": "            renderListItems("
          },
          {
            "type": "add",
            "line": "                values,"
          },
          {
            "type": "add",
            "line": "                (value) => html`${highlightFilterElements(value, filter_terms)}`"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    function getCardFieldUserValue(value, filter_terms) {"
          },
          {
            "type": "delete",
            "line": "        let display_name;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "    function getCardFieldUserValueTemplate(value, filter_terms) {"
          },
          {
            "type": "add",
            "line": "        const display_name = highlightFilterElements(value.display_name, filter_terms);"
          },
          {
            "type": "context",
            "line": "         if (value.user_url === null) {"
          },
          {
            "type": "delete",
            "line": "            display_name = highlight(value.display_name, filter_terms);"
          },
          {
            "type": "delete",
            "line": "            return `<div class=\"tlp-avatar-mini\"> </div><span>${display_name}</span>`;"
          },
          {
            "type": "add",
            "line": "            return html`<div class=\"tlp-avatar-mini\"></div>"
          },
          {
            "type": "add",
            "line": "                <span>${display_name}</span>`;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        display_name = highlight(value.display_name, filter_terms);"
          },
          {
            "type": "delete",
            "line": "        return `<a data-nodrag=\"true\" class=\"extra-card-field-user\" href=\"${value.user_url}\">"
          },
          {
            "type": "delete",
            "line": "                            <div class=\"tlp-avatar-mini\"><img src=\"${value.avatar_url}\" /></div><span>${display_name}</span>"
          },
          {
            "type": "delete",
            "line": "                        </a>`;"
          },
          {
            "type": "add",
            "line": "        return html`<a data-nodrag=\"true\" class=\"extra-card-field-user\" href=\"${value.user_url}\">"
          },
          {
            "type": "add",
            "line": "            <div class=\"tlp-avatar-mini\"><img loading=\"lazy\" src=\"${value.avatar_url}\" /></div>"
          },
          {
            "type": "add",
            "line": "            <span>${display_name}</span>"
          },
          {
            "type": "add",
            "line": "        </a>`;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    function getCardFieldUserValue(value, filter_terms) {"
          },
          {
            "type": "add",
            "line": "        return getHTMLStringFromTemplate(getCardFieldUserValueTemplate(value, filter_terms));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     function isListBoundToAValueDifferentFromNone(values) {"
          },
          {
            "type": "context",
            "line": "         return values.find((value) => value.id !== null);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    function renderListItems(items, render_item) {"
          },
          {
            "type": "add",
            "line": "        let templated_content = html``;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        for (const [i, file] of items.entries()) {"
          },
          {
            "type": "add",
            "line": "            if (i === 0) {"
          },
          {
            "type": "add",
            "line": "                templated_content = render_item(file);"
          },
          {
            "type": "add",
            "line": "            } else {"
          },
          {
            "type": "add",
            "line": "                templated_content = html`${templated_content}, ${render_item(file)}`;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return templated_content;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    function getHTMLStringFromTemplate(template) {"
          },
          {
            "type": "add",
            "line": "        const element = document.createElement(\"div\");"
          },
          {
            "type": "add",
            "line": "        template({}, element);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return $sce.trustAsHtml(element.innerHTML);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/src/card-fields.tpl.html",
        "changes": [
          {
            "type": "context",
            "line": "index 0c28abdc49d..2e2cef5d6b3 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/src/card-fields.tpl.html"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/src/card-fields.tpl.html"
          },
          {
            "type": "context",
            "line": "                 ng-if=\"card_ctrl.cardFieldIsPermissions(card_field.type) && card_field.granted_groups.length > 0\""
          },
          {
            "type": "context",
            "line": "         >"
          },
          {
            "type": "context",
            "line": "             <span class=\"extra-card-field-title\">{{ card_field.label }}: </span>"
          },
          {
            "type": "delete",
            "line": "            <span ng-bind-html=\"card_ctrl.getCardFieldPermissionsValue(card_field.granted_groups) | tuleapHighlight:card_ctrl.filter_terms\"></span>"
          },
          {
            "type": "add",
            "line": "            <span ng-bind-html=\"card_ctrl.getCardFieldPermissionsValue(card_field.granted_groups, card_ctrl.filter_terms)\"></span>"
          },
          {
            "type": "context",
            "line": "         </div>"
          },
          {
            "type": "context",
            "line": "         <div"
          },
          {
            "type": "context",
            "line": "                 class=\"extra-card-field-content\""
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/src/highlight-filter-template.test.ts",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..f9bee09bba5"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/src/highlight-filter-template.test.ts"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import { highlightFilterElements } from \"./highlight-filter-template\";"
          },
          {
            "type": "add",
            "line": "import type { UpdateFunctionWithMethods } from \"hybrids\";"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "jest.mock(\"escape-string-regexp\", () => ({"
          },
          {
            "type": "add",
            "line": "    default: jest.requireActual(\"escape-string-regexp\"),"
          },
          {
            "type": "add",
            "line": "}));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "const TEST_PHRASE = \"Prefix Highlight Suffix\";"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "describe(\"highlight-filter-template\", () => {"
          },
          {
            "type": "add",
            "line": "    it(\"should highlight a matching phrase\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(TEST_PHRASE, \"highlight\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              Prefix"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                Highlight"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "               Suffix"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should highlight nothing if no match found\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(TEST_PHRASE, \"no match\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              Prefix Highlight Suffix"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should highlight nothing for the undefined filter\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(TEST_PHRASE, undefined)))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": "              Prefix Highlight Suffix"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should work correctly for number filters\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(\"3210123\", 0)))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              321"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                0"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              123"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should work when the text context is undefined\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(undefined, \"nothing\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should work correctly for number text\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(3210123, \"0\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              321"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                0"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              123"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should highlight nothing if empty filter string passed\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(TEST_PHRASE, \"\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": "              Prefix Highlight Suffix"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should highlight more that one element\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(TEST_PHRASE, \"gh\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              Prefix Hi"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                gh"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              li"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                gh"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              t Suffix"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"highlights each matching search terms\", () => {"
          },
          {
            "type": "add",
            "line": "        expect(getElementFromTemplate(highlightFilterElements(TEST_PHRASE, \"suffix highlight\")))"
          },
          {
            "type": "add",
            "line": "            .toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              Prefix"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                Highlight"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                Suffix"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it(\"should escape regexp search terms\", () => {"
          },
          {
            "type": "add",
            "line": "        expect("
          },
          {
            "type": "add",
            "line": "            getElementFromTemplate("
          },
          {
            "type": "add",
            "line": "                highlightFilterElements(\"Prefix (Highlight) Suffix\", \"(Highlight)\")"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        ).toMatchInlineSnapshot(`"
          },
          {
            "type": "add",
            "line": "            <div>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              Prefix"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "              <span"
          },
          {
            "type": "add",
            "line": "                class=\"highlight\""
          },
          {
            "type": "add",
            "line": "              >"
          },
          {
            "type": "add",
            "line": "                (Highlight)"
          },
          {
            "type": "add",
            "line": "              </span>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "               Suffix"
          },
          {
            "type": "add",
            "line": "            </div>"
          },
          {
            "type": "add",
            "line": "        `);"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": "});"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "function getElementFromTemplate(template: UpdateFunctionWithMethods<unknown>): HTMLElement {"
          },
          {
            "type": "add",
            "line": "    const element = document.createElement(\"div\");"
          },
          {
            "type": "add",
            "line": "    template(document.body, element);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return element;"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/src/highlight-filter-template.ts",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..878edf2461e"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/src/highlight-filter-template.ts"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import type { UpdateFunctionWithMethods } from \"hybrids\";"
          },
          {
            "type": "add",
            "line": "import { html } from \"hybrids\";"
          },
          {
            "type": "add",
            "line": "import { Classifier } from \"./highlight/Classifier\";"
          },
          {
            "type": "add",
            "line": "import { HighlightedText } from \"./highlight/HighlightedText\";"
          },
          {
            "type": "add",
            "line": "export function highlightFilterElements("
          },
          {
            "type": "add",
            "line": "    content: string | number | undefined,"
          },
          {
            "type": "add",
            "line": "    search: string | number | undefined"
          },
          {
            "type": "add",
            "line": "): UpdateFunctionWithMethods<unknown> {"
          },
          {
            "type": "add",
            "line": "    const text_content = content?.toString();"
          },
          {
            "type": "add",
            "line": "    if ("
          },
          {
            "type": "add",
            "line": "        text_content === \"\" ||"
          },
          {
            "type": "add",
            "line": "        text_content === undefined ||"
          },
          {
            "type": "add",
            "line": "        search === \"\" ||"
          },
          {
            "type": "add",
            "line": "        search === undefined"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "add",
            "line": "        return html`${text_content}`;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    const classifier = Classifier(search.toString());"
          },
          {
            "type": "add",
            "line": "    const templates = classifier.classify(text_content).map((highlighted_text) => {"
          },
          {
            "type": "add",
            "line": "        if (!HighlightedText.isHighlight(highlighted_text)) {"
          },
          {
            "type": "add",
            "line": "            return html`${highlighted_text.content}`;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        return html`<span class=\"highlight\">${highlighted_text.content}</span>`;"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": "    return html`${templates}`;"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/src/highlight-filter.js",
        "changes": [
          {
            "type": "context",
            "line": "index 87aca73a73f..eea9d2bcb7a 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/src/highlight-filter.js"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/src/highlight-filter.js"
          },
          {
            "type": "context",
            "line": "  * @license MIT"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import { isNumber } from \"angular\";"
          },
          {
            "type": "delete",
            "line": "import { Classifier } from \"./highlight/Classifier\";"
          },
          {
            "type": "delete",
            "line": "import { HighlightedText } from \"./highlight/HighlightedText\";"
          },
          {
            "type": "add",
            "line": "import { highlightFilterElements } from \"./highlight-filter-template\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " export default TuleapHighlightFilter;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "  * @returns HTML-encoded string"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " function TuleapHighlightFilter() {"
          },
          {
            "type": "delete",
            "line": "    function isTextSearchable(text, search) {"
          },
          {
            "type": "delete",
            "line": "        return text && (search || isNumber(search));"
          },
          {
            "type": "add",
            "line": "    function getHTMLStringFromTemplate(template) {"
          },
          {
            "type": "add",
            "line": "        const element = document.createElement(\"div\");"
          },
          {
            "type": "add",
            "line": "        template({}, element);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return element.innerHTML;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return function (text, search) {"
          },
          {
            "type": "delete",
            "line": "        if (!isTextSearchable(text, search)) {"
          },
          {
            "type": "delete",
            "line": "            return text ? text.toString() : text;"
          },
          {
            "type": "add",
            "line": "        if (text === null) {"
          },
          {
            "type": "add",
            "line": "            return null;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        const classifier = Classifier(String(search));"
          },
          {
            "type": "delete",
            "line": "        const parts = classifier.classify(String(text)).map((highlighted_text) => {"
          },
          {
            "type": "delete",
            "line": "            if (!HighlightedText.isHighlight(highlighted_text)) {"
          },
          {
            "type": "delete",
            "line": "                return highlighted_text.content;"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "            return `<span class=\"highlight\">${highlighted_text.content}</span>`;"
          },
          {
            "type": "delete",
            "line": "        });"
          },
          {
            "type": "delete",
            "line": "        return parts.join(\"\");"
          },
          {
            "type": "add",
            "line": "        return getHTMLStringFromTemplate(highlightFilterElements(text, search));"
          },
          {
            "type": "context",
            "line": "     };"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/src/index.js",
        "changes": [
          {
            "type": "context",
            "line": "index de316991277..7721964da20 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/src/index.js"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/src/index.js"
          },
          {
            "type": "context",
            "line": " import angular from \"angular\";"
          },
          {
            "type": "delete",
            "line": "import ngSanitize from \"angular-sanitize\";"
          },
          {
            "type": "context",
            "line": " import \"../themes/main.scss\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import HighlightFilter from \"./highlight-filter.js\";"
          },
          {
            "type": "context",
            "line": " import cardTextFieldDirective from \"./card-text-field/card-text-field-directive.js\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " export default angular"
          },
          {
            "type": "delete",
            "line": "    .module(\"card-fields\", [ngSanitize])"
          },
          {
            "type": "add",
            "line": "    .module(\"card-fields\", [])"
          },
          {
            "type": "context",
            "line": "     .service(\"CardFieldsService\", CardFieldsService)"
          },
          {
            "type": "context",
            "line": "     .directive(\"cardFields\", CardFieldsDirective)"
          },
          {
            "type": "context",
            "line": "     .directive(\"tuleapSimpleField\", tuleapSimpleFieldDirective)"
          }
        ]
      },
      {
        "file": "plugins/agiledashboard/scripts/licard-fields/vite.config.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 5775aa3ab11..0c9ea5fb3cf 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/agiledashboard/scripts/lib/card-fields/vite.config.ts"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/agiledashboard/scripts/lib/card-fields/vite.config.ts"
          },
          {
            "type": "context",
            "line": "             name: \"PluginAgileDashboardCardFields\","
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "context",
            "line": "         rollupOptions: {"
          },
          {
            "type": "delete",
            "line": "            external: [\"angular\", \"angular-sanitize\", \"moment\"],"
          },
          {
            "type": "add",
            "line": "            external: [\"angular\", \"hybrids\"],"
          },
          {
            "type": "context",
            "line": "             output: {"
          },
          {
            "type": "context",
            "line": "                 globals: {"
          },
          {
            "type": "context",
            "line": "                     angular: \"angular\","
          },
          {
            "type": "delete",
            "line": "                    \"angular-sanitize\": \"angular-sanitize\","
          },
          {
            "type": "delete",
            "line": "                    moment: \"moment\","
          },
          {
            "type": "add",
            "line": "                    hybrids: \"hybrids\","
          },
          {
            "type": "context",
            "line": "                 },"
          },
          {
            "type": "context",
            "line": "             },"
          },
          {
            "type": "context",
            "line": "         },"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b29669c065f60501e7289e1950fa2a618962358",
    "files": [
      {
        "file": "drivers/media/video/videobuf-vmalloc.c",
        "changes": [
          {
            "type": "context",
            "line": "index cd74341c984f..e01259438bb2 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/media/video/videobuf-vmalloc.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/media/video/videobuf-vmalloc.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct videobuf_mapping *map = vma->vm_private_data;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tdprintk(2,\"vm_open %p [count=%d,vma=%08lx-%08lx]\\n\",map,"
          },
          {
            "type": "add",
            "line": "\tdprintk(2,\"vm_open %p [count=%u,vma=%08lx-%08lx]\\n\",map,"
          },
          {
            "type": "context",
            "line": " \t\tmap->count,vma->vm_start,vma->vm_end);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmap->count++;"
          },
          {
            "type": "context",
            "line": " \tstruct videobuf_queue *q = map->q;"
          },
          {
            "type": "context",
            "line": " \tint i;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tdprintk(2,\"vm_close %p [count=%d,vma=%08lx-%08lx]\\n\",map,"
          },
          {
            "type": "add",
            "line": "\tdprintk(2,\"vm_close %p [count=%u,vma=%08lx-%08lx]\\n\",map,"
          },
          {
            "type": "context",
            "line": " \t\tmap->count,vma->vm_start,vma->vm_end);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmap->count--;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* create mapping + update buffer list */"
          },
          {
            "type": "delete",
            "line": "\tmap = q->bufs[first]->map = kmalloc(sizeof(struct videobuf_mapping),GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tmap = q->bufs[first]->map = kzalloc(sizeof(struct videobuf_mapping),GFP_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tif (NULL == map)"
          },
          {
            "type": "context",
            "line": " \t\treturn -ENOMEM;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b732f2ef0224e2aaf10e2e1ef48dbd3fb6e10cd",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/User.java",
        "changes": [
          {
            "type": "context",
            "line": "index c2f55f1b19a..c81b109e4c9 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/User.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/User.java"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     public void setDisabledStatus(boolean disabledStatus)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        this.user.setDisabled(disabledStatus, getXWikiContext());"
          },
          {
            "type": "add",
            "line": "        if (hasAdminRights()) {"
          },
          {
            "type": "add",
            "line": "            this.user.setDisabled(disabledStatus, getXWikiContext());"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b760113a3a155269a3fba93a409c640031dd68f",
    "files": [
      {
        "file": "fs/lockd/clntproc.c",
        "changes": [
          {
            "type": "context",
            "line": "index adb45ec9038c..e374050a911c 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/lockd/clntproc.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/lockd/clntproc.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (task->tk_status < 0) {"
          },
          {
            "type": "context",
            "line": " \t\tdprintk(\"lockd: unlock failed (err = %d)\\n\", -task->tk_status);"
          },
          {
            "type": "delete",
            "line": "\t\tgoto retry_rebind;"
          },
          {
            "type": "add",
            "line": "\t\tswitch (task->tk_status) {"
          },
          {
            "type": "add",
            "line": "\t\tcase -EACCES:"
          },
          {
            "type": "add",
            "line": "\t\tcase -EIO:"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto die;"
          },
          {
            "type": "add",
            "line": "\t\tdefault:"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto retry_rebind;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tif (status == NLM_LCK_DENIED_GRACE_PERIOD) {"
          },
          {
            "type": "context",
            "line": " \t\trpc_delay(task, NLMCLNT_GRACE_WAIT);"
          }
        ]
      },
      {
        "file": "include/linux/sunrpc/sched.h",
        "changes": [
          {
            "type": "context",
            "line": "index f73c482ec9c6..fe2d8e6b923b 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/sunrpc/sched.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/sunrpc/sched.h"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": " \tunsigned char\t\ttk_priority : 2,/* Task priority */"
          },
          {
            "type": "context",
            "line": " \t\t\t\ttk_garb_retry : 2,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\ttk_cred_retry : 2;"
          },
          {
            "type": "add",
            "line": "\t\t\t\ttk_cred_retry : 2,"
          },
          {
            "type": "add",
            "line": "\t\t\t\ttk_rebind_retry : 2;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": " #define tk_xprt\t\t\ttk_client->cl_xprt"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "net/sunrpc/clnt.c",
        "changes": [
          {
            "type": "context",
            "line": "index b84d7395535e..566bcfd067f6 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/sunrpc/clnt.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/sunrpc/clnt.c"
          },
          {
            "type": "context",
            "line": " \t\t\tstatus = -EOPNOTSUPP;"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif (task->tk_rebind_retry == 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t\ttask->tk_rebind_retry--;"
          },
          {
            "type": "context",
            "line": " \t\trpc_delay(task, 3*HZ);"
          },
          {
            "type": "context",
            "line": " \t\tgoto retry_timeout;"
          },
          {
            "type": "context",
            "line": " \tcase -ETIMEDOUT:"
          }
        ]
      },
      {
        "file": "net/sunrpc/sched.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6b43ee7221d5..a27406b1654f 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/sunrpc/sched.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/sunrpc/sched.c"
          },
          {
            "type": "context",
            "line": " \t/* Initialize retry counters */"
          },
          {
            "type": "context",
            "line": " \ttask->tk_garb_retry = 2;"
          },
          {
            "type": "context",
            "line": " \ttask->tk_cred_retry = 2;"
          },
          {
            "type": "add",
            "line": "\ttask->tk_rebind_retry = 2;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ttask->tk_priority = task_setup_data->priority - RPC_PRIORITY_LOW;"
          },
          {
            "type": "context",
            "line": " \ttask->tk_owner = current->tgid;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b79459b482e85cb7426aa7da683a9f2c97aeae1",
    "files": [
      {
        "file": "arch/x86/include/asm/kvm_host.h",
        "changes": [
          {
            "type": "context",
            "line": "index 635a74d22409..4979778cc7fb 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/include/asm/kvm_host.h"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/include/asm/kvm_host.h"
          },
          {
            "type": "context",
            "line": " \tgpa_t time;"
          },
          {
            "type": "context",
            "line": " \tstruct pvclock_vcpu_time_info hv_clock;"
          },
          {
            "type": "context",
            "line": " \tunsigned int hw_tsc_khz;"
          },
          {
            "type": "delete",
            "line": "\tunsigned int time_offset;"
          },
          {
            "type": "delete",
            "line": "\tstruct page *time_page;"
          },
          {
            "type": "add",
            "line": "\tstruct gfn_to_hva_cache pv_time;"
          },
          {
            "type": "add",
            "line": "\tbool pv_time_enabled;"
          },
          {
            "type": "context",
            "line": " \t/* set guest stopped flag in pvclock flags field */"
          },
          {
            "type": "context",
            "line": " \tbool pvclock_set_guest_stopped_request;"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "arch/x86/kvm/x86.c",
        "changes": [
          {
            "type": "context",
            "line": "index 2ade60c25402..f19ac0aca60d 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/kvm/x86.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/kvm/x86.c"
          },
          {
            "type": "context",
            "line": " \tunsigned long flags, this_tsc_khz;"
          },
          {
            "type": "context",
            "line": " \tstruct kvm_vcpu_arch *vcpu = &v->arch;"
          },
          {
            "type": "context",
            "line": " \tstruct kvm_arch *ka = &v->kvm->arch;"
          },
          {
            "type": "delete",
            "line": "\tvoid *shared_kaddr;"
          },
          {
            "type": "context",
            "line": " \ts64 kernel_ns, max_kernel_ns;"
          },
          {
            "type": "context",
            "line": " \tu64 tsc_timestamp, host_tsc;"
          },
          {
            "type": "delete",
            "line": "\tstruct pvclock_vcpu_time_info *guest_hv_clock;"
          },
          {
            "type": "add",
            "line": "\tstruct pvclock_vcpu_time_info guest_hv_clock;"
          },
          {
            "type": "context",
            "line": " \tu8 pvclock_flags;"
          },
          {
            "type": "context",
            "line": " \tbool use_master_clock;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tlocal_irq_restore(flags);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!vcpu->time_page)"
          },
          {
            "type": "add",
            "line": "\tif (!vcpu->pv_time_enabled)"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tvcpu->hv_clock.version += 2;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tshared_kaddr = kmap_atomic(vcpu->time_page);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tguest_hv_clock = shared_kaddr + vcpu->time_offset;"
          },
          {
            "type": "add",
            "line": "\tif (unlikely(kvm_read_guest_cached(v->kvm, &vcpu->pv_time,"
          },
          {
            "type": "add",
            "line": "\t\t&guest_hv_clock, sizeof(guest_hv_clock))))"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* retain PVCLOCK_GUEST_STOPPED if set in guest copy */"
          },
          {
            "type": "delete",
            "line": "\tpvclock_flags = (guest_hv_clock->flags & PVCLOCK_GUEST_STOPPED);"
          },
          {
            "type": "add",
            "line": "\tpvclock_flags = (guest_hv_clock.flags & PVCLOCK_GUEST_STOPPED);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (vcpu->pvclock_set_guest_stopped_request) {"
          },
          {
            "type": "context",
            "line": " \t\tpvclock_flags |= PVCLOCK_GUEST_STOPPED;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tvcpu->hv_clock.flags = pvclock_flags;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tmemcpy(shared_kaddr + vcpu->time_offset, &vcpu->hv_clock,"
          },
          {
            "type": "delete",
            "line": "\t       sizeof(vcpu->hv_clock));"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tkunmap_atomic(shared_kaddr);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tmark_page_dirty(v->kvm, vcpu->time >> PAGE_SHIFT);"
          },
          {
            "type": "add",
            "line": "\tkvm_write_guest_cached(v->kvm, &vcpu->pv_time,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t&vcpu->hv_clock,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tsizeof(vcpu->hv_clock));"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static void kvmclock_reset(struct kvm_vcpu *vcpu)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tif (vcpu->arch.time_page) {"
          },
          {
            "type": "delete",
            "line": "\t\tkvm_release_page_dirty(vcpu->arch.time_page);"
          },
          {
            "type": "delete",
            "line": "\t\tvcpu->arch.time_page = NULL;"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tvcpu->arch.pv_time_enabled = false;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static void accumulate_steal_time(struct kvm_vcpu *vcpu)"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tcase MSR_KVM_SYSTEM_TIME_NEW:"
          },
          {
            "type": "context",
            "line": " \tcase MSR_KVM_SYSTEM_TIME: {"
          },
          {
            "type": "add",
            "line": "\t\tu64 gpa_offset;"
          },
          {
            "type": "context",
            "line": " \t\tkvmclock_reset(vcpu);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tvcpu->arch.time = data;"
          },
          {
            "type": "context",
            "line": " \t\tif (!(data & 1))"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t/* ...but clean it before doing the actual write */"
          },
          {
            "type": "delete",
            "line": "\t\tvcpu->arch.time_offset = data & ~(PAGE_MASK | 1);"
          },
          {
            "type": "add",
            "line": "\t\tgpa_offset = data & ~(PAGE_MASK | 1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/* Check that the address is 32-byte aligned. */"
          },
          {
            "type": "delete",
            "line": "\t\tif (vcpu->arch.time_offset &"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t(sizeof(struct pvclock_vcpu_time_info) - 1))"
          },
          {
            "type": "add",
            "line": "\t\tif (gpa_offset & (sizeof(struct pvclock_vcpu_time_info) - 1))"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tvcpu->arch.time_page ="
          },
          {
            "type": "delete",
            "line": "\t\t\t\tgfn_to_page(vcpu->kvm, data >> PAGE_SHIFT);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (is_error_page(vcpu->arch.time_page))"
          },
          {
            "type": "delete",
            "line": "\t\t\tvcpu->arch.time_page = NULL;"
          },
          {
            "type": "add",
            "line": "\t\tif (kvm_gfn_to_hva_cache_init(vcpu->kvm,"
          },
          {
            "type": "add",
            "line": "\t\t     &vcpu->arch.pv_time, data & ~1ULL))"
          },
          {
            "type": "add",
            "line": "\t\t\tvcpu->arch.pv_time_enabled = false;"
          },
          {
            "type": "add",
            "line": "\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t\tvcpu->arch.pv_time_enabled = true;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " static int kvm_set_guest_paused(struct kvm_vcpu *vcpu)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tif (!vcpu->arch.time_page)"
          },
          {
            "type": "add",
            "line": "\tif (!vcpu->arch.pv_time_enabled)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": " \tvcpu->arch.pvclock_set_guest_stopped_request = true;"
          },
          {
            "type": "context",
            "line": " \tkvm_make_request(KVM_REQ_CLOCK_UPDATE, vcpu);"
          },
          {
            "type": "context",
            "line": " \t\tgoto fail_free_wbinvd_dirty_mask;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tvcpu->arch.ia32_tsc_adjust_msr = 0x0;"
          },
          {
            "type": "add",
            "line": "\tvcpu->arch.pv_time_enabled = false;"
          },
          {
            "type": "context",
            "line": " \tkvm_async_pf_hash_reset(vcpu);"
          },
          {
            "type": "context",
            "line": " \tkvm_pmu_init(vcpu);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0b995602e6e5894ee31625a4dd0e6aa255d2a651",
    "files": [
      {
        "file": "airflow/config_templates/config.yml",
        "changes": [
          {
            "type": "context",
            "line": "index 72672361a5..ee246e1c01 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/config_templates/config.yml"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/config_templates/config.yml"
          },
          {
            "type": "context",
            "line": "       type: boolean"
          },
          {
            "type": "context",
            "line": "       example: ~"
          },
          {
            "type": "context",
            "line": "       default: \"False\""
          },
          {
            "type": "add",
            "line": "    allow_raw_html_descriptions:"
          },
          {
            "type": "add",
            "line": "      description: |"
          },
          {
            "type": "add",
            "line": "        A DAG author is able to provide any raw HTML into ``doc_md`` or params description in"
          },
          {
            "type": "add",
            "line": "        ``description_md`` for text formatting. This is including potentially unsafe javascript."
          },
          {
            "type": "add",
            "line": "        Displaying the DAG or trigger form in web UI provides the DAG author the potential to"
          },
          {
            "type": "add",
            "line": "        inject malicious code into clients browsers. To ensure the web UI is safe by default,"
          },
          {
            "type": "add",
            "line": "        raw HTML is disabled by default. If you trust your DAG authors, you can enable HTML"
          },
          {
            "type": "add",
            "line": "        support in markdown by setting this option to True."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        This parameter also enables the deprecated fields ``description_html`` and"
          },
          {
            "type": "add",
            "line": "        ``custom_html_form`` in DAG params until the feature is removed in a future version."
          },
          {
            "type": "add",
            "line": "      version_added: 2.8.0"
          },
          {
            "type": "add",
            "line": "      type: boolean"
          },
          {
            "type": "add",
            "line": "      example: \"False\""
          },
          {
            "type": "add",
            "line": "      default: \"False\""
          },
          {
            "type": "context",
            "line": " email:"
          },
          {
            "type": "context",
            "line": "   description: |"
          },
          {
            "type": "context",
            "line": "     Configuration email backend and whether to"
          }
        ]
      },
      {
        "file": "airflow/example_dags/example_params_ui_tutorial.py",
        "changes": [
          {
            "type": "context",
            "line": "index 12992c545c..489a4681c9 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/example_dags/example_params_ui_tutorial.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/example_dags/example_params_ui_tutorial.py"
          },
          {
            "type": "context",
            "line": "         \"flag\": False,"
          },
          {
            "type": "context",
            "line": "         \"a_simple_list\": [\"one\", \"two\", \"three\", \"actually one value is made per line\"],"
          },
          {
            "type": "context",
            "line": "         # But of course you might want to have it nicer! Let's add some description to parameters."
          },
          {
            "type": "delete",
            "line": "        # Note if you can add any HTML formatting to the description, you need to use the description_html"
          },
          {
            "type": "add",
            "line": "        # Note if you can add any Markdown formatting to the description, you need to use the description_md"
          },
          {
            "type": "context",
            "line": "         # attribute."
          },
          {
            "type": "context",
            "line": "         \"most_loved_number\": Param("
          },
          {
            "type": "context",
            "line": "             42,"
          },
          {
            "type": "context",
            "line": "             type=\"integer\","
          },
          {
            "type": "context",
            "line": "             title=\"Your favorite number\","
          },
          {
            "type": "delete",
            "line": "            description_html=\"\"\"Everybody should have a favorite number. Not only math teachers."
          },
          {
            "type": "delete",
            "line": "            If you can not think of any at the moment please think of the 42 which is very famous because"
          },
          {
            "type": "delete",
            "line": "            of the book"
          },
          {
            "type": "delete",
            "line": "            <a href='https://en.wikipedia.org/wiki/Phrases_from_The_Hitchhiker%27s_Guide_to_the_Galaxy#"
          },
          {
            "type": "delete",
            "line": "            The_Answer_to_the_Ultimate_Question_of_Life,_the_Universe,_and_Everything_is_42'>"
          },
          {
            "type": "delete",
            "line": "            The Hitchhiker's Guide to the Galaxy</a>\"\"\","
          },
          {
            "type": "add",
            "line": "            description_md=\"Everybody should have a **favorite** number. Not only _math teachers_. \""
          },
          {
            "type": "add",
            "line": "            \"If you can not think of any at the moment please think of the 42 which is very famous because\""
          },
          {
            "type": "add",
            "line": "            \"of the book [The Hitchhiker's Guide to the Galaxy]\""
          },
          {
            "type": "add",
            "line": "            \"(https://en.wikipedia.org/wiki/Phrases_from_The_Hitchhiker%27s_Guide_to_the_Galaxy#\""
          },
          {
            "type": "add",
            "line": "            \"The_Answer_to_the_Ultimate_Question_of_Life,_the_Universe,_and_Everything_is_42).\","
          },
          {
            "type": "context",
            "line": "         ),"
          },
          {
            "type": "context",
            "line": "         # If you want to have a selection list box then you can use the enum feature of JSON schema"
          },
          {
            "type": "context",
            "line": "         \"pick_one\": Param("
          },
          {
            "type": "context",
            "line": "             \"optional text, you can trigger also w/o text\","
          },
          {
            "type": "context",
            "line": "             type=[\"null\", \"string\"],"
          },
          {
            "type": "context",
            "line": "             title=\"Optional text field\","
          },
          {
            "type": "delete",
            "line": "            description_html=\"This field is optional. As field content is JSON schema validated you must \""
          },
          {
            "type": "delete",
            "line": "            \"allow the <code>null</code> type.\","
          },
          {
            "type": "add",
            "line": "            description_md=\"This field is optional. As field content is JSON schema validated you must \""
          },
          {
            "type": "add",
            "line": "            \"allow the `null` type.\","
          },
          {
            "type": "context",
            "line": "         ),"
          },
          {
            "type": "context",
            "line": "         # You can arrange the entry fields in sections so that you can have a better overview for the user"
          },
          {
            "type": "context",
            "line": "         # Therefore you can add the \"section\" attribute."
          },
          {
            "type": "context",
            "line": "             \"length-checked-field\","
          },
          {
            "type": "context",
            "line": "             type=\"string\","
          },
          {
            "type": "context",
            "line": "             title=\"Text field with length check\","
          },
          {
            "type": "delete",
            "line": "            description_html=\"\"\"This field is required. And you need to provide something between 10 and 30"
          },
          {
            "type": "delete",
            "line": "            characters. See the"
          },
          {
            "type": "delete",
            "line": "            <a href='https://json-schema.org/understanding-json-schema/reference/string.html'>"
          },
          {
            "type": "delete",
            "line": "            JSON schema description (string)</a> in for more details\"\"\","
          },
          {
            "type": "add",
            "line": "            description_md=\"\"\"This field is required. And you need to provide something between 10 and 30"
          },
          {
            "type": "add",
            "line": "            characters. See the JSON"
          },
          {
            "type": "add",
            "line": "            [schema description (string)](https://json-schema.org/understanding-json-schema/reference/string.html)"
          },
          {
            "type": "add",
            "line": "            for more details\"\"\","
          },
          {
            "type": "context",
            "line": "             minLength=10,"
          },
          {
            "type": "context",
            "line": "             maxLength=20,"
          },
          {
            "type": "context",
            "line": "             section=\"JSON Schema validation options\","
          },
          {
            "type": "context",
            "line": "             100,"
          },
          {
            "type": "context",
            "line": "             type=\"number\","
          },
          {
            "type": "context",
            "line": "             title=\"Number field with value check\","
          },
          {
            "type": "delete",
            "line": "            description_html=\"\"\"This field is required. You need to provide any number between 64 and 128."
          },
          {
            "type": "delete",
            "line": "            See the <a href='https://json-schema.org/understanding-json-schema/reference/numeric.html'>"
          },
          {
            "type": "delete",
            "line": "            JSON schema description (numbers)</a> in for more details\"\"\","
          },
          {
            "type": "add",
            "line": "            description_md=\"\"\"This field is required. You need to provide any number between 64 and 128."
          },
          {
            "type": "add",
            "line": "            See the JSON"
          },
          {
            "type": "add",
            "line": "            [schema description (numbers)](https://json-schema.org/understanding-json-schema/reference/numeric.html)"
          },
          {
            "type": "add",
            "line": "            for more details\"\"\","
          },
          {
            "type": "context",
            "line": "             minimum=64,"
          },
          {
            "type": "context",
            "line": "             maximum=128,"
          },
          {
            "type": "context",
            "line": "             section=\"JSON Schema validation options\","
          },
          {
            "type": "context",
            "line": "         ),"
          },
          {
            "type": "context",
            "line": "         \"array_of_objects\": Param("
          },
          {
            "type": "context",
            "line": "             [{\"name\": \"account_name\", \"country\": \"country_name\"}],"
          },
          {
            "type": "delete",
            "line": "            \"Array with complex objects and validation rules. \""
          },
          {
            "type": "delete",
            "line": "            \"See <a href='https://json-schema.org/understanding-json-schema\""
          },
          {
            "type": "delete",
            "line": "            \"/reference/array.html#items'>JSON Schema validation options in specs.</a>\","
          },
          {
            "type": "add",
            "line": "            description_md=\"Array with complex objects and validation rules. \""
          },
          {
            "type": "add",
            "line": "            \"See [JSON Schema validation options in specs]\""
          },
          {
            "type": "add",
            "line": "            \"(https://json-schema.org/understanding-json-schema/reference/array.html#items).\","
          },
          {
            "type": "context",
            "line": "             type=\"array\","
          },
          {
            "type": "context",
            "line": "             title=\"JSON array field\","
          },
          {
            "type": "context",
            "line": "             items={"
          },
          {
            "type": "context",
            "line": "         # then you can use the JSON schema option of passing constant values. These parameters"
          },
          {
            "type": "context",
            "line": "         # will not be displayed but passed to the DAG"
          },
          {
            "type": "context",
            "line": "         \"hidden_secret_field\": Param(\"constant value\", const=\"constant value\"),"
          },
          {
            "type": "delete",
            "line": "        # Finally besides the standard provided field generator you can have you own HTML form code"
          },
          {
            "type": "delete",
            "line": "        # injected - but be careful, you can also mess-up the layout!"
          },
          {
            "type": "delete",
            "line": "        \"color_picker\": Param("
          },
          {
            "type": "delete",
            "line": "            \"#FF8800\","
          },
          {
            "type": "delete",
            "line": "            type=\"string\","
          },
          {
            "type": "delete",
            "line": "            title=\"Pick a color\","
          },
          {
            "type": "delete",
            "line": "            description_html=\"\"\"This is a special HTML widget as custom implementation in the DAG code."
          },
          {
            "type": "delete",
            "line": "            It is templated with the following parameter to render proper HTML form fields:"
          },
          {
            "type": "delete",
            "line": "            <ul>"
          },
          {
            "type": "delete",
            "line": "                <li><code>{name}</code>: Name of the HTML input field that is expected.</li>"
          },
          {
            "type": "delete",
            "line": "                <li><code>{value}</code>:"
          },
          {
            "type": "delete",
            "line": "                    (Default) value that should be displayed when showing/loading the form.</li>"
          },
          {
            "type": "delete",
            "line": "                <li>Note: If you have elements changing a value, call <code>updateJSONconf()</code> to update"
          },
          {
            "type": "delete",
            "line": "                    the form data to be posted as <code>dag_run.conf</code>.</li>"
          },
          {
            "type": "delete",
            "line": "            </ul>"
          },
          {
            "type": "delete",
            "line": "            Example: <code>&lt;input name='{name}' value='{value}' onchange='updateJSONconf()' /&gt;</code>"
          },
          {
            "type": "delete",
            "line": "            \"\"\","
          },
          {
            "type": "delete",
            "line": "            custom_html_form=\"\"\""
          },
          {
            "type": "delete",
            "line": "            <table width=\"100%\" cellspacing=\"5\"><tbody><tr><td>"
          },
          {
            "type": "delete",
            "line": "                <label for=\"r_{name}\">Red:</label>"
          },
          {
            "type": "delete",
            "line": "            </td><td width=\"80%\">"
          },
          {
            "type": "delete",
            "line": "                <input id=\"r_{name}\" type=\"range\" min=\"0\" max=\"255\" value=\"0\" onchange=\"u_{name}()\"/>"
          },
          {
            "type": "delete",
            "line": "            </td><td rowspan=\"3\" style=\"padding-left: 10px;\">"
          },
          {
            "type": "delete",
            "line": "                <div id=\"preview_{name}\""
          },
          {
            "type": "delete",
            "line": "                style=\"line-height: 40px; margin-bottom: 7px; width: 100%; background-color: {value};\""
          },
          {
            "type": "delete",
            "line": "                >&nbsp;</div>"
          },
          {
            "type": "delete",
            "line": "                <input class=\"form-control\" type=\"text\" maxlength=\"7\" id=\"{name}\" name=\"{name}\""
          },
          {
            "type": "delete",
            "line": "                value=\"{value}\" onchange=\"v_{name}()\" />"
          },
          {
            "type": "delete",
            "line": "            </td></tr><tr><td>"
          },
          {
            "type": "delete",
            "line": "                <label for=\"g_{name}\">Green:</label>"
          },
          {
            "type": "delete",
            "line": "            </td><td>"
          },
          {
            "type": "delete",
            "line": "                <input id=\"g_{name}\" type=\"range\" min=\"0\" max=\"255\" value=\"0\" onchange=\"u_{name}()\"/>"
          },
          {
            "type": "delete",
            "line": "            </td></tr><tr><td>"
          },
          {
            "type": "delete",
            "line": "                <label for=\"b_{name}\">Blue:</label>"
          },
          {
            "type": "delete",
            "line": "            </td><td>"
          },
          {
            "type": "delete",
            "line": "                <input id=\"b_{name}\" type=\"range\" min=\"0\" max=\"255\" value=\"0\" onchange=\"u_{name}()\"/>"
          },
          {
            "type": "delete",
            "line": "            </td></tr></tbody></table>"
          },
          {
            "type": "delete",
            "line": "            <script lang=\"javascript\">"
          },
          {
            "type": "delete",
            "line": "                const hex_chars = \"0123456789ABCDEF\";"
          },
          {
            "type": "delete",
            "line": "                function i2hex(name) {"
          },
          {
            "type": "delete",
            "line": "                    var i = document.getElementById(name).value;"
          },
          {
            "type": "delete",
            "line": "                    return hex_chars.substr(parseInt(i / 16), 1) + hex_chars.substr(parseInt(i % 16), 1)"
          },
          {
            "type": "delete",
            "line": "                }"
          },
          {
            "type": "delete",
            "line": "                function u_{name}() {"
          },
          {
            "type": "delete",
            "line": "                    var hex_val = \"#\"+i2hex(\"r_{name}\")+i2hex(\"g_{name}\")+i2hex(\"b_{name}\");"
          },
          {
            "type": "delete",
            "line": "                    document.getElementById(\"{name}\").value = hex_val;"
          },
          {
            "type": "delete",
            "line": "                    document.getElementById(\"preview_{name}\").style.background = hex_val;"
          },
          {
            "type": "delete",
            "line": "                    updateJSONconf();"
          },
          {
            "type": "delete",
            "line": "                }"
          },
          {
            "type": "delete",
            "line": "                function hex2i(text) {"
          },
          {
            "type": "delete",
            "line": "                    return hex_chars.indexOf(text.substr(0,1)) * 16 + hex_chars.indexOf(text.substr(1,1));"
          },
          {
            "type": "delete",
            "line": "                }"
          },
          {
            "type": "delete",
            "line": "                function v_{name}() {"
          },
          {
            "type": "delete",
            "line": "                    var value = document.getElementById(\"{name}\").value.toUpperCase();"
          },
          {
            "type": "delete",
            "line": "                    document.getElementById(\"r_{name}\").value = hex2i(value.substr(1,2));"
          },
          {
            "type": "delete",
            "line": "                    document.getElementById(\"g_{name}\").value = hex2i(value.substr(3,2));"
          },
          {
            "type": "delete",
            "line": "                    document.getElementById(\"b_{name}\").value = hex2i(value.substr(5,2));"
          },
          {
            "type": "delete",
            "line": "                    document.getElementById(\"preview_{name}\").style.background = value;"
          },
          {
            "type": "delete",
            "line": "                }"
          },
          {
            "type": "delete",
            "line": "                v_{name}();"
          },
          {
            "type": "delete",
            "line": "            </script>\"\"\","
          },
          {
            "type": "delete",
            "line": "            section=\"Special advanced stuff with form fields\","
          },
          {
            "type": "delete",
            "line": "        ),"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": " ) as dag:"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "airflow/www/utils.py",
        "changes": [
          {
            "type": "context",
            "line": "index 8c2282a31c..5fe8a7ccb7 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/www/utils.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/www/utils.py"
          },
          {
            "type": "context",
            "line": " from sqlalchemy import delete, func, select, types"
          },
          {
            "type": "context",
            "line": " from sqlalchemy.ext.associationproxy import AssociationProxy"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "from airflow.configuration import conf"
          },
          {
            "type": "context",
            "line": " from airflow.exceptions import RemovedInAirflow3Warning"
          },
          {
            "type": "context",
            "line": " from airflow.models import errors"
          },
          {
            "type": "context",
            "line": " from airflow.models.dagrun import DagRun"
          },
          {
            "type": "context",
            "line": " def get_dag_run_conf("
          },
          {
            "type": "context",
            "line": "     dag_run_conf: Any, *, json_encoder: type[json.JSONEncoder] = json.JSONEncoder"
          },
          {
            "type": "context",
            "line": " ) -> tuple[str | None, bool]:"
          },
          {
            "type": "delete",
            "line": "    conf: str | None = None"
          },
          {
            "type": "add",
            "line": "    result: str | None = None"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     conf_is_json: bool = False"
          },
          {
            "type": "context",
            "line": "     if isinstance(dag_run_conf, str):"
          },
          {
            "type": "delete",
            "line": "        conf = dag_run_conf"
          },
          {
            "type": "add",
            "line": "        result = dag_run_conf"
          },
          {
            "type": "context",
            "line": "     elif isinstance(dag_run_conf, (dict, list)) and any(dag_run_conf):"
          },
          {
            "type": "delete",
            "line": "        conf = json.dumps(dag_run_conf, sort_keys=True, cls=json_encoder, ensure_ascii=False)"
          },
          {
            "type": "add",
            "line": "        result = json.dumps(dag_run_conf, sort_keys=True, cls=json_encoder, ensure_ascii=False)"
          },
          {
            "type": "context",
            "line": "         conf_is_json = True"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    return conf, conf_is_json"
          },
          {
            "type": "add",
            "line": "    return result, conf_is_json"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def encode_dag_run("
          },
          {
            "type": "context",
            "line": "     if not dag_run:"
          },
          {
            "type": "context",
            "line": "         return None"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    conf, conf_is_json = get_dag_run_conf(dag_run.conf, json_encoder=json_encoder)"
          },
          {
            "type": "add",
            "line": "    dag_run_conf, conf_is_json = get_dag_run_conf(dag_run.conf, json_encoder=json_encoder)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return {"
          },
          {
            "type": "context",
            "line": "         \"run_id\": dag_run.run_id,"
          },
          {
            "type": "context",
            "line": "         \"run_type\": dag_run.run_type,"
          },
          {
            "type": "context",
            "line": "         \"last_scheduling_decision\": datetime_to_string(dag_run.last_scheduling_decision),"
          },
          {
            "type": "context",
            "line": "         \"external_trigger\": dag_run.external_trigger,"
          },
          {
            "type": "delete",
            "line": "        \"conf\": conf,"
          },
          {
            "type": "add",
            "line": "        \"conf\": dag_run_conf,"
          },
          {
            "type": "context",
            "line": "         \"conf_is_json\": conf_is_json,"
          },
          {
            "type": "context",
            "line": "         \"note\": dag_run.note,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def wrapped_markdown(s, css_class=\"rich_doc\"):"
          },
          {
            "type": "context",
            "line": "     \"\"\"Convert a Markdown string to HTML.\"\"\""
          },
          {
            "type": "delete",
            "line": "    md = MarkdownIt(\"gfm-like\")"
          },
          {
            "type": "add",
            "line": "    md = MarkdownIt(\"gfm-like\", {\"html\": conf.getboolean(\"webserver\", \"allow_raw_html_descriptions\")})"
          },
          {
            "type": "context",
            "line": "     if s is None:"
          },
          {
            "type": "context",
            "line": "         return None"
          },
          {
            "type": "context",
            "line": "     s = textwrap.dedent(s)"
          }
        ]
      },
      {
        "file": "airflow/www/views.py",
        "changes": [
          {
            "type": "context",
            "line": "index 691a11f2d5..3e4ed75a59 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/www/views.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/www/views.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # Prepare form fields with param struct details to render a proper form with schema information"
          },
          {
            "type": "context",
            "line": "         form_fields = {}"
          },
          {
            "type": "add",
            "line": "        allow_raw_html_descriptions = conf.getboolean(\"webserver\", \"allow_raw_html_descriptions\")"
          },
          {
            "type": "add",
            "line": "        form_trust_problems = []"
          },
          {
            "type": "context",
            "line": "         for k, v in dag.params.items():"
          },
          {
            "type": "context",
            "line": "             form_fields[k] = v.dump()"
          },
          {
            "type": "add",
            "line": "            form_field: dict = form_fields[k]"
          },
          {
            "type": "context",
            "line": "             # If no schema is provided, auto-detect on default values"
          },
          {
            "type": "delete",
            "line": "            if \"schema\" not in form_fields[k]:"
          },
          {
            "type": "delete",
            "line": "                form_fields[k][\"schema\"] = {}"
          },
          {
            "type": "delete",
            "line": "            if \"type\" not in form_fields[k][\"schema\"]:"
          },
          {
            "type": "delete",
            "line": "                if isinstance(form_fields[k][\"value\"], bool):"
          },
          {
            "type": "delete",
            "line": "                    form_fields[k][\"schema\"][\"type\"] = \"boolean\""
          },
          {
            "type": "delete",
            "line": "                elif isinstance(form_fields[k][\"value\"], int):"
          },
          {
            "type": "delete",
            "line": "                    form_fields[k][\"schema\"][\"type\"] = [\"integer\", \"null\"]"
          },
          {
            "type": "delete",
            "line": "                elif isinstance(form_fields[k][\"value\"], list):"
          },
          {
            "type": "delete",
            "line": "                    form_fields[k][\"schema\"][\"type\"] = [\"array\", \"null\"]"
          },
          {
            "type": "delete",
            "line": "                elif isinstance(form_fields[k][\"value\"], dict):"
          },
          {
            "type": "delete",
            "line": "                    form_fields[k][\"schema\"][\"type\"] = [\"object\", \"null\"]"
          },
          {
            "type": "delete",
            "line": "            # Mark markup fields as safe"
          },
          {
            "type": "delete",
            "line": "            if ("
          },
          {
            "type": "delete",
            "line": "                \"description_html\" in form_fields[k][\"schema\"]"
          },
          {
            "type": "delete",
            "line": "                and form_fields[k][\"schema\"][\"description_html\"]"
          },
          {
            "type": "delete",
            "line": "            ):"
          },
          {
            "type": "delete",
            "line": "                form_fields[k][\"description\"] = Markup(form_fields[k][\"schema\"][\"description_html\"])"
          },
          {
            "type": "delete",
            "line": "            if \"custom_html_form\" in form_fields[k][\"schema\"]:"
          },
          {
            "type": "delete",
            "line": "                form_fields[k][\"schema\"][\"custom_html_form\"] = Markup("
          },
          {
            "type": "delete",
            "line": "                    form_fields[k][\"schema\"][\"custom_html_form\"]"
          },
          {
            "type": "delete",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            if \"schema\" not in form_field:"
          },
          {
            "type": "add",
            "line": "                form_field[\"schema\"] = {}"
          },
          {
            "type": "add",
            "line": "            form_field_schema: dict = form_field[\"schema\"]"
          },
          {
            "type": "add",
            "line": "            if \"type\" not in form_field_schema:"
          },
          {
            "type": "add",
            "line": "                form_field_value = form_field[\"value\"]"
          },
          {
            "type": "add",
            "line": "                if isinstance(form_field_value, bool):"
          },
          {
            "type": "add",
            "line": "                    form_field_schema[\"type\"] = \"boolean\""
          },
          {
            "type": "add",
            "line": "                elif isinstance(form_field_value, int):"
          },
          {
            "type": "add",
            "line": "                    form_field_schema[\"type\"] = [\"integer\", \"null\"]"
          },
          {
            "type": "add",
            "line": "                elif isinstance(form_field_value, list):"
          },
          {
            "type": "add",
            "line": "                    form_field_schema[\"type\"] = [\"array\", \"null\"]"
          },
          {
            "type": "add",
            "line": "                elif isinstance(form_field_value, dict):"
          },
          {
            "type": "add",
            "line": "                    form_field_schema[\"type\"] = [\"object\", \"null\"]"
          },
          {
            "type": "add",
            "line": "            # Mark HTML fields as safe if allowed"
          },
          {
            "type": "add",
            "line": "            if allow_raw_html_descriptions:"
          },
          {
            "type": "add",
            "line": "                if \"description_html\" in form_field_schema:"
          },
          {
            "type": "add",
            "line": "                    form_field[\"description\"] = Markup(form_field_schema[\"description_html\"])"
          },
          {
            "type": "add",
            "line": "                if \"custom_html_form\" in form_field_schema:"
          },
          {
            "type": "add",
            "line": "                    form_field_schema[\"custom_html_form\"] = Markup(form_field_schema[\"custom_html_form\"])"
          },
          {
            "type": "add",
            "line": "            else:"
          },
          {
            "type": "add",
            "line": "                if \"description_html\" in form_field_schema and \"description_md\" not in form_field_schema:"
          },
          {
            "type": "add",
            "line": "                    form_trust_problems.append(f\"Field {k} uses HTML description\")"
          },
          {
            "type": "add",
            "line": "                    form_field[\"description\"] = form_field_schema.pop(\"description_html\")"
          },
          {
            "type": "add",
            "line": "                if \"custom_html_form\" in form_field_schema:"
          },
          {
            "type": "add",
            "line": "                    form_trust_problems.append(f\"Field {k} uses custom HTML form definition\")"
          },
          {
            "type": "add",
            "line": "                    form_field_schema.pop(\"custom_html_form\")"
          },
          {
            "type": "add",
            "line": "            if \"description_md\" in form_field_schema:"
          },
          {
            "type": "add",
            "line": "                form_field[\"description\"] = wwwutils.wrapped_markdown(form_field_schema[\"description_md\"])"
          },
          {
            "type": "add",
            "line": "        if form_trust_problems:"
          },
          {
            "type": "add",
            "line": "            flash("
          },
          {
            "type": "add",
            "line": "                Markup("
          },
          {
            "type": "add",
            "line": "                    \"At least one field in the trigger form uses a raw HTML form definition. This is not allowed for \""
          },
          {
            "type": "add",
            "line": "                    \"security. Please switch to markdown description via <code>description_md</code>. \""
          },
          {
            "type": "add",
            "line": "                    \"Raw HTML is deprecated and must be enabled via \""
          },
          {
            "type": "add",
            "line": "                    \"<code>webserver.allow_raw_html_descriptions</code> configuration parameter. Using plain text \""
          },
          {
            "type": "add",
            "line": "                    \"as fallback for these fields. \""
          },
          {
            "type": "add",
            "line": "                    f\"<ul><li>{'</li><li>'.join(form_trust_problems)}</li></ul>\""
          },
          {
            "type": "add",
            "line": "                ),"
          },
          {
            "type": "add",
            "line": "                \"warning\","
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        if allow_raw_html_descriptions and any(\"description_html\" in p.schema for p in dag.params.values()):"
          },
          {
            "type": "add",
            "line": "            flash("
          },
          {
            "type": "add",
            "line": "                Markup("
          },
          {
            "type": "add",
            "line": "                    \"The form params use raw HTML in <code>description_html</code> which is deprecated. \""
          },
          {
            "type": "add",
            "line": "                    \"Please migrate to <code>description_md</code>.\""
          },
          {
            "type": "add",
            "line": "                ),"
          },
          {
            "type": "add",
            "line": "                \"warning\","
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        if allow_raw_html_descriptions and any(\"custom_html_form\" in p.schema for p in dag.params.values()):"
          },
          {
            "type": "add",
            "line": "            flash("
          },
          {
            "type": "add",
            "line": "                Markup("
          },
          {
            "type": "add",
            "line": "                    \"The form params use <code>custom_html_form</code> definition. \""
          },
          {
            "type": "add",
            "line": "                    \"This is deprecated with Airflow 2.8.0 and will be removed in a future release.\""
          },
          {
            "type": "add",
            "line": "                ),"
          },
          {
            "type": "add",
            "line": "                \"warning\","
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         ui_fields_defined = any(\"const\" not in f[\"schema\"] for f in form_fields.values())"
          },
          {
            "type": "context",
            "line": "         show_trigger_form_if_no_params = conf.getboolean(\"webserver\", \"show_trigger_form_if_no_params\")"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "docs/apache-airflow/core-concepts/params.rst",
        "changes": [
          {
            "type": "context",
            "line": "index b2b95252ec..72eb058d4b 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/apache-airflow/core-concepts/params.rst"
          },
          {
            "type": "context",
            "line": "+++ b/docs/apache-airflow/core-concepts/params.rst"
          },
          {
            "type": "context",
            "line": " Use Params to Provide a Trigger UI Form"
          },
          {
            "type": "context",
            "line": " ---------------------------------------"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ".. versionadded:: 2.6.0"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " :class:`~airflow.models.dag.DAG` level params are used to render a user friendly trigger form."
          },
          {
            "type": "context",
            "line": " This form is provided when a user clicks on the \"Trigger DAG\" button."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   - The :class:`~airflow.models.param.Param` attribute ``title`` is used to render the form field label of the entry box."
          },
          {
            "type": "context",
            "line": "     If no ``title`` is defined the parameter name/key is used instead."
          },
          {
            "type": "context",
            "line": "   - The :class:`~airflow.models.param.Param` attribute ``description`` is rendered below an entry field as help text in gray color."
          },
          {
            "type": "delete",
            "line": "    If you want to provide HTML tags for special formatting or links you need to use the Param attribute"
          },
          {
            "type": "delete",
            "line": "    ``description_html``, see tutorial DAG ``example_params_ui_tutorial`` for an example."
          },
          {
            "type": "add",
            "line": "    If you want to provide special formatting or links you need to use the Param attribute"
          },
          {
            "type": "add",
            "line": "    ``description_md``. See tutorial DAG ``example_params_ui_tutorial`` for an example."
          },
          {
            "type": "context",
            "line": "   - The :class:`~airflow.models.param.Param` attribute ``type`` influences how a field is rendered. The following types are supported:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       .. list-table::"
          },
          {
            "type": "context",
            "line": "   The ``const`` value must match the default value to pass `JSON Schema validation <https://json-schema.org/understanding-json-schema/reference/generic.html#constant-values>`_."
          },
          {
            "type": "context",
            "line": " - On the bottom of the form the generated JSON configuration can be expanded."
          },
          {
            "type": "context",
            "line": "   If you want to change values manually, the JSON configuration can be adjusted. Changes are overridden when form fields change."
          },
          {
            "type": "delete",
            "line": "- If you want to render custom HTML as form on top of the provided features, you can use the ``custom_html_form`` attribute."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " .. note::"
          },
          {
            "type": "context",
            "line": "     If the field is required the default value must be valid according to the schema as well. If the DAG is defined with"
          },
          {
            "type": "context",
            "line": " .. image:: ../img/trigger-dag-tutorial-form.png"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " .. versionadded:: 2.7.0"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "The trigger form can also be forced to be displayed also if no params are defined using the configuration switch"
          },
          {
            "type": "delete",
            "line": "``webserver.show_trigger_form_if_no_params``."
          },
          {
            "type": "add",
            "line": "    The trigger form can also be forced to be displayed also if no params are defined using the configuration switch"
          },
          {
            "type": "add",
            "line": "    ``webserver.show_trigger_form_if_no_params``."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ".. versionchanged:: 2.8.0"
          },
          {
            "type": "add",
            "line": "    By default custom HTML is not allowed to prevent injection of scripts or other malicious HTML code. If you trust your DAG authors"
          },
          {
            "type": "add",
            "line": "    you can change the trust level of parameter descriptions to allow raw HTML by setting the configuration entry"
          },
          {
            "type": "add",
            "line": "    ``webserver.allow_raw_html_descriptions`` to ``True``. With the default setting all HTML will be displayed as plain text."
          },
          {
            "type": "add",
            "line": "    This relates to the previous feature to enable rich formatting with the attribute ``description_html`` which is now super-seeded"
          },
          {
            "type": "add",
            "line": "    with the attribute ``description_md``."
          },
          {
            "type": "add",
            "line": "    Custom form elements using the attribute ``custom_html_form`` allow a DAG author to specify raw HTML form templates. These"
          },
          {
            "type": "add",
            "line": "    custom HTML form elements are deprecated as of version 2.8.0."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Disabling Runtime Param Modification"
          },
          {
            "type": "context",
            "line": " ------------------------------------"
          }
        ]
      },
      {
        "file": "newsfragments/35460.significant.rst",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..d29481d219"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/newsfragments/35460.significant.rst"
          },
          {
            "type": "add",
            "line": "Raw HTML code in DAG docs and DAG params descriptions is disabled by default"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "To ensure that no malicious javascript can be injected with DAG descriptions or trigger UI forms by DAG authors"
          },
          {
            "type": "add",
            "line": "a new parameter ``webserver.allow_raw_html_descriptions`` was added with default value of ``False``."
          },
          {
            "type": "add",
            "line": "If you trust your DAG authors code and want to allow using raw HTML in DAG descriptions and params, you can restore the previous"
          },
          {
            "type": "add",
            "line": "behavior by setting the configuration value to ``True``."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "To ensure Airflow is secure by default, the raw HTML support in trigger UI has been super-seeded by markdown support via"
          },
          {
            "type": "add",
            "line": "the ``description_md`` attribute. If you have been using ``description_html`` please migrate to ``description_md``."
          },
          {
            "type": "add",
            "line": "The ``custom_html_form`` is now deprecated."
          }
        ]
      },
      {
        "file": "tests/www/test_utils.py",
        "changes": [
          {
            "type": "context",
            "line": "index 19941c15e0..dfd8b563dc 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/www/test_utils.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/www/test_utils.py"
          },
          {
            "type": "context",
            "line": " from airflow.utils import json as utils_json"
          },
          {
            "type": "context",
            "line": " from airflow.www import utils"
          },
          {
            "type": "context",
            "line": " from airflow.www.utils import DagRunCustomSQLAInterface, json_f, wrapped_markdown"
          },
          {
            "type": "add",
            "line": "from tests.test_utils.config import conf_vars"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class TestUtils:"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_wrapped_markdown_with_collapsible_section(self):"
          },
          {
            "type": "delete",
            "line": "        rendered = wrapped_markdown("
          },
          {
            "type": "delete",
            "line": "            \"\"\""
          },
          {
            "type": "add",
            "line": "        with conf_vars({(\"webserver\", \"allow_raw_html_descriptions\"): \"true\"}):"
          },
          {
            "type": "add",
            "line": "            rendered = wrapped_markdown("
          },
          {
            "type": "add",
            "line": "                \"\"\""
          },
          {
            "type": "context",
            "line": " # A collapsible section with markdown"
          },
          {
            "type": "context",
            "line": " <details>"
          },
          {
            "type": "context",
            "line": "   <summary>Click to expand!</summary>"
          },
          {
            "type": "context",
            "line": "      * Sub bullets"
          },
          {
            "type": "context",
            "line": " </details>"
          },
          {
            "type": "context",
            "line": "             \"\"\""
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        assert ("
          },
          {
            "type": "delete",
            "line": "            \"\"\"<div class=\"rich_doc\" ><h1>A collapsible section with markdown</h1>"
          },
          {
            "type": "add",
            "line": "            assert ("
          },
          {
            "type": "add",
            "line": "                \"\"\"<div class=\"rich_doc\" ><h1>A collapsible section with markdown</h1>"
          },
          {
            "type": "context",
            "line": " <details>"
          },
          {
            "type": "context",
            "line": "   <summary>Click to expand!</summary>"
          },
          {
            "type": "context",
            "line": " <h2>Heading</h2>"
          },
          {
            "type": "context",
            "line": " </ol>"
          },
          {
            "type": "context",
            "line": " </details>"
          },
          {
            "type": "context",
            "line": " </div>\"\"\""
          },
          {
            "type": "delete",
            "line": "            == rendered"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "                == rendered"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @pytest.mark.parametrize(\"allow_html\", [False, True])"
          },
          {
            "type": "add",
            "line": "    def test_wrapped_markdown_with_raw_html(self, allow_html):"
          },
          {
            "type": "add",
            "line": "        with conf_vars({(\"webserver\", \"allow_raw_html_descriptions\"): str(allow_html)}):"
          },
          {
            "type": "add",
            "line": "            HTML = \"test <code>raw HTML</code>\""
          },
          {
            "type": "add",
            "line": "            rendered = wrapped_markdown(HTML)"
          },
          {
            "type": "add",
            "line": "            if allow_html:"
          },
          {
            "type": "add",
            "line": "                assert HTML in rendered"
          },
          {
            "type": "add",
            "line": "            else:"
          },
          {
            "type": "add",
            "line": "                from markupsafe import escape"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "                assert escape(HTML) in rendered"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " @pytest.mark.db_test"
          }
        ]
      },
      {
        "file": "tests/www/views/test_views_trigger_dag.py",
        "changes": [
          {
            "type": "context",
            "line": "index c48e053639..65ad8734d5 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/www/views/test_views_trigger_dag.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/www/views/test_views_trigger_dag.py"
          },
          {
            "type": "context",
            "line": " from airflow.utils.types import DagRunType"
          },
          {
            "type": "context",
            "line": " from tests.test_utils.api_connexion_utils import create_test_client"
          },
          {
            "type": "context",
            "line": " from tests.test_utils.config import conf_vars"
          },
          {
            "type": "delete",
            "line": "from tests.test_utils.www import check_content_in_response"
          },
          {
            "type": "add",
            "line": "from tests.test_utils.www import check_content_in_response, check_content_not_in_response"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " pytestmark = pytest.mark.db_test"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "@pytest.mark.parametrize(\"allow_html\", [False, True])"
          },
          {
            "type": "add",
            "line": "def test_trigger_dag_html_allow(admin_client, dag_maker, session, app, monkeypatch, allow_html):"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": "    Test that HTML is escaped per default in description."
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": "    from markupsafe import escape"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    DAG_ID = \"params_dag\""
          },
          {
            "type": "add",
            "line": "    HTML_DESCRIPTION1 = \"HTML <code>raw code</code>.\""
          },
          {
            "type": "add",
            "line": "    HTML_DESCRIPTION2 = \"HTML <code>in md text</code>.\""
          },
          {
            "type": "add",
            "line": "    expect_escape = not allow_html"
          },
          {
            "type": "add",
            "line": "    with conf_vars({(\"webserver\", \"allow_raw_html_descriptions\"): str(allow_html)}):"
          },
          {
            "type": "add",
            "line": "        param1 = Param("
          },
          {
            "type": "add",
            "line": "            42,"
          },
          {
            "type": "add",
            "line": "            description_html=HTML_DESCRIPTION1,"
          },
          {
            "type": "add",
            "line": "            type=\"integer\","
          },
          {
            "type": "add",
            "line": "            minimum=1,"
          },
          {
            "type": "add",
            "line": "            maximum=100,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        param2 = Param("
          },
          {
            "type": "add",
            "line": "            42,"
          },
          {
            "type": "add",
            "line": "            description_md=HTML_DESCRIPTION2,"
          },
          {
            "type": "add",
            "line": "            type=\"integer\","
          },
          {
            "type": "add",
            "line": "            minimum=1,"
          },
          {
            "type": "add",
            "line": "            maximum=100,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        with monkeypatch.context() as m:"
          },
          {
            "type": "add",
            "line": "            with dag_maker("
          },
          {
            "type": "add",
            "line": "                dag_id=DAG_ID, serialized=True, session=session, params={\"param1\": param1, \"param2\": param2}"
          },
          {
            "type": "add",
            "line": "            ):"
          },
          {
            "type": "add",
            "line": "                EmptyOperator(task_id=\"task1\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            m.setattr(app, \"dag_bag\", dag_maker.dagbag)"
          },
          {
            "type": "add",
            "line": "            resp = admin_client.get(f\"dags/{DAG_ID}/trigger\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if expect_escape:"
          },
          {
            "type": "add",
            "line": "            check_content_in_response(escape(HTML_DESCRIPTION1), resp)"
          },
          {
            "type": "add",
            "line": "            check_content_in_response(escape(HTML_DESCRIPTION2), resp)"
          },
          {
            "type": "add",
            "line": "            check_content_in_response("
          },
          {
            "type": "add",
            "line": "                \"At least one field in the trigger form uses a raw HTML form definition.\", resp"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        else:"
          },
          {
            "type": "add",
            "line": "            check_content_in_response(HTML_DESCRIPTION1, resp)"
          },
          {
            "type": "add",
            "line": "            check_content_in_response(HTML_DESCRIPTION2, resp)"
          },
          {
            "type": "add",
            "line": "            check_content_not_in_response("
          },
          {
            "type": "add",
            "line": "                \"At least one field in the trigger form uses a raw HTML form definition.\", resp"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def test_trigger_endpoint_uses_existing_dagbag(admin_client):"
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "context",
            "line": "     Test that Trigger Endpoint uses the DagBag already created in views.py"
          }
        ]
      }
    ]
  },
  {
    "commit": "0bacd29473107d9d7f5b723a15a683449679756d",
    "files": [
      {
        "file": "wagtail/users/tests/test_bulk_actions/test_bulk_delete.py",
        "changes": [
          {
            "type": "context",
            "line": "index 38cfc1ca03..e77655312b 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/users/tests/test_bulk_actions/test_bulk_delete.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/users/tests/test_bulk_actions/test_bulk_delete.py"
          },
          {
            "type": "context",
            "line": " from django.contrib.auth import get_user_model"
          },
          {
            "type": "add",
            "line": "from django.contrib.auth.models import Permission"
          },
          {
            "type": "context",
            "line": " from django.http import HttpRequest, HttpResponse"
          },
          {
            "type": "context",
            "line": " from django.test import TestCase"
          },
          {
            "type": "context",
            "line": " from django.urls import reverse"
          },
          {
            "type": "context",
            "line": "             response, \"wagtailusers/bulk_actions/confirm_bulk_delete.html\""
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_user_permissions_required(self):"
          },
          {
            "type": "add",
            "line": "        # Log in with a user that doesn't have permission to delete users"
          },
          {
            "type": "add",
            "line": "        user = self.create_user(username=\"editor\", password=\"password\")"
          },
          {
            "type": "add",
            "line": "        admin_permission = Permission.objects.get("
          },
          {
            "type": "add",
            "line": "            content_type__app_label=\"wagtailadmin\", codename=\"access_admin\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        user.user_permissions.add(admin_permission)"
          },
          {
            "type": "add",
            "line": "        self.login(username=\"editor\", password=\"password\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = self.client.get(self.url)"
          },
          {
            "type": "add",
            "line": "        self.assertRedirects(response, \"/admin/\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_bulk_delete(self):"
          },
          {
            "type": "context",
            "line": "         response = self.client.post(self.url)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "wagtail/users/views/bulk_actions/user_bulk_action.py",
        "changes": [
          {
            "type": "context",
            "line": "index c862da032b..bda5b22c18 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/users/views/bulk_actions/user_bulk_action.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/users/views/bulk_actions/user_bulk_action.py"
          },
          {
            "type": "context",
            "line": " from django.contrib.auth import get_user_model"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from wagtail.admin.views.bulk_action import BulkAction"
          },
          {
            "type": "add",
            "line": "from wagtail.admin.views.generic.permissions import PermissionCheckedMixin"
          },
          {
            "type": "add",
            "line": "from wagtail.permission_policies import ModelPermissionPolicy"
          },
          {
            "type": "context",
            "line": " from wagtail.users.views.users import get_users_filter_query"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "User = get_user_model()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "class UserBulkAction(BulkAction):"
          },
          {
            "type": "delete",
            "line": "    models = [get_user_model()]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class UserBulkAction(PermissionCheckedMixin, BulkAction):"
          },
          {
            "type": "add",
            "line": "    models = [User]"
          },
          {
            "type": "add",
            "line": "    permission_policy = ModelPermissionPolicy(User)"
          },
          {
            "type": "add",
            "line": "    any_permission_required = [\"add\", \"change\", \"delete\"]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def get_all_objects_in_listing_query(self, parent_id):"
          },
          {
            "type": "context",
            "line": "         listing_objects = self.model.objects.all().values_list(\"pk\", flat=True)"
          }
        ]
      }
    ]
  },
  {
    "commit": "0bb7203b584e771b23536ba065a6efda457161bb",
    "files": [
      {
        "file": "docs/types.rst",
        "changes": [
          {
            "type": "context",
            "line": "index 2c3a1e75..d669e694 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/types.rst"
          },
          {
            "type": "context",
            "line": "+++ b/docs/types.rst"
          },
          {
            "type": "context",
            "line": "     # Returning the value in row 0 column 4 (in this case 14)"
          },
          {
            "type": "context",
            "line": "     return exampleList2D[0][4]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ".. note::"
          },
          {
            "type": "add",
            "line": "    Defining an array in storage whose size is significantly larger than ``2**64`` can result in security vulnerabilities due to risk of overflow."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " .. index:: !dynarrays"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Dynamic Arrays"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " In the ABI, they are represented as ``_Type[]``. For instance, ``DynArray[int128, 3]`` gets represented as ``int128[]``, and ``DynArray[DynArray[int128, 3], 3]`` gets represented as ``int128[][]``."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ".. note::"
          },
          {
            "type": "add",
            "line": "    Defining a dynamic array in storage whose size is significantly larger than ``2**64`` can result in security vulnerabilities due to risk of overflow."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " .. _types-struct:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Structs"
          }
        ]
      },
      {
        "file": "tests/cli/outputs/test_storage_layout_overrides.py",
        "changes": [
          {
            "type": "context",
            "line": "index ff86b0cd..94e0faeb 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/cli/outputs/test_storage_layout_overrides.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/cli/outputs/test_storage_layout_overrides.py"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_overflow():"
          },
          {
            "type": "add",
            "line": "    code = \"\"\""
          },
          {
            "type": "add",
            "line": "x: uint256[2]"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    storage_layout_override = {\"x\": {\"slot\": 2**256 - 1, \"type\": \"uint256[2]\"}}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with pytest.raises("
          },
          {
            "type": "add",
            "line": "        StorageLayoutException, match=f\"Invalid storage slot for var x, out of bounds: {2**256}\\n\""
          },
          {
            "type": "add",
            "line": "    ):"
          },
          {
            "type": "add",
            "line": "        compile_code("
          },
          {
            "type": "add",
            "line": "            code, output_formats=[\"layout\"], storage_layout_override=storage_layout_override"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def test_incomplete_overrides():"
          },
          {
            "type": "context",
            "line": "     code = \"\"\""
          },
          {
            "type": "context",
            "line": " name: public(String[64])"
          }
        ]
      },
      {
        "file": "tests/functional/test_storage_slots.py",
        "changes": [
          {
            "type": "context",
            "line": "index 46536254..d390fe9a 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/functional/test_storage_slots.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/functional/test_storage_slots.py"
          },
          {
            "type": "add",
            "line": "import pytest"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from vyper.exceptions import StorageLayoutException"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " code = \"\"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct StructOne:"
          },
          {
            "type": "context",
            "line": "     assert [c.foo(0, i) for i in range(3)] == [987, 654, 321]"
          },
          {
            "type": "context",
            "line": "     assert [c.foo(1, i) for i in range(3)] == [123, 456, 789]"
          },
          {
            "type": "context",
            "line": "     assert c.h(0) == 123456789"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_allocator_overflow(get_contract):"
          },
          {
            "type": "add",
            "line": "    code = \"\"\""
          },
          {
            "type": "add",
            "line": "x: uint256"
          },
          {
            "type": "add",
            "line": "y: uint256[max_value(uint256)]"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": "    with pytest.raises("
          },
          {
            "type": "add",
            "line": "        StorageLayoutException,"
          },
          {
            "type": "add",
            "line": "        match=f\"Invalid storage slot for var y, tried to allocate slots 1 through {2**256}\\n\","
          },
          {
            "type": "add",
            "line": "    ):"
          },
          {
            "type": "add",
            "line": "        get_contract(code)"
          }
        ]
      },
      {
        "file": "vyper/semantics/analysis/data_positions.py",
        "changes": [
          {
            "type": "context",
            "line": "index 5c1347d5..8270f145 100644"
          },
          {
            "type": "context",
            "line": "--- a/vyper/semantics/analysis/data_positions.py"
          },
          {
            "type": "context",
            "line": "+++ b/vyper/semantics/analysis/data_positions.py"
          },
          {
            "type": "context",
            "line": " from vyper.exceptions import StorageLayoutException"
          },
          {
            "type": "context",
            "line": " from vyper.semantics.analysis.base import CodeOffset, StorageSlot"
          },
          {
            "type": "context",
            "line": " from vyper.typing import StorageLayout"
          },
          {
            "type": "add",
            "line": "from vyper.utils import ceil32"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def set_data_positions("
          },
          {
            "type": "context",
            "line": "         # Expect to find this variable within the storage layout overrides"
          },
          {
            "type": "context",
            "line": "         if node.target.id in storage_layout_overrides:"
          },
          {
            "type": "context",
            "line": "             var_slot = storage_layout_overrides[node.target.id][\"slot\"]"
          },
          {
            "type": "delete",
            "line": "            # Calculate how many storage slots are required"
          },
          {
            "type": "delete",
            "line": "            storage_length = math.ceil(varinfo.typ.size_in_bytes / 32)"
          },
          {
            "type": "add",
            "line": "            storage_length = varinfo.typ.storage_size_in_words"
          },
          {
            "type": "context",
            "line": "             # Ensure that all required storage slots are reserved, and prevents other variables"
          },
          {
            "type": "context",
            "line": "             # from using these slots"
          },
          {
            "type": "context",
            "line": "             reserved_slots.reserve_slot_range(var_slot, storage_length, node.target.id)"
          },
          {
            "type": "context",
            "line": "     return ret"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "class SimpleStorageAllocator:"
          },
          {
            "type": "add",
            "line": "    def __init__(self, starting_slot: int = 0):"
          },
          {
            "type": "add",
            "line": "        self._slot = starting_slot"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def allocate_slot(self, n, var_name):"
          },
          {
            "type": "add",
            "line": "        ret = self._slot"
          },
          {
            "type": "add",
            "line": "        if self._slot + n >= 2**256:"
          },
          {
            "type": "add",
            "line": "            raise StorageLayoutException("
          },
          {
            "type": "add",
            "line": "                f\"Invalid storage slot for var {var_name}, tried to allocate\""
          },
          {
            "type": "add",
            "line": "                f\" slots {self._slot} through {self._slot + n}\""
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        self._slot += n"
          },
          {
            "type": "add",
            "line": "        return ret"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def set_storage_slots(vyper_module: vy_ast.Module) -> StorageLayout:"
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "context",
            "line": "     Parse module-level Vyper AST to calculate the layout of storage variables."
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "context",
            "line": "     # Allocate storage slots from 0"
          },
          {
            "type": "context",
            "line": "     # note storage is word-addressable, not byte-addressable"
          },
          {
            "type": "delete",
            "line": "    storage_slot = 0"
          },
          {
            "type": "add",
            "line": "    allocator = SimpleStorageAllocator()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     ret: Dict[str, Dict] = {}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             type_.set_reentrancy_key_position(StorageSlot(_slot))"
          },
          {
            "type": "context",
            "line": "             continue"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        type_.set_reentrancy_key_position(StorageSlot(storage_slot))"
          },
          {
            "type": "add",
            "line": "        # TODO use one byte - or bit - per reentrancy key"
          },
          {
            "type": "add",
            "line": "        # requires either an extra SLOAD or caching the value of the"
          },
          {
            "type": "add",
            "line": "        # location in memory at entrance"
          },
          {
            "type": "add",
            "line": "        slot = allocator.allocate_slot(1, variable_name)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        type_.set_reentrancy_key_position(StorageSlot(slot))"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # TODO this could have better typing but leave it untyped until"
          },
          {
            "type": "context",
            "line": "         # we nail down the format better"
          },
          {
            "type": "delete",
            "line": "        ret[variable_name] = {\"type\": \"nonreentrant lock\", \"slot\": storage_slot}"
          },
          {
            "type": "add",
            "line": "        ret[variable_name] = {\"type\": \"nonreentrant lock\", \"slot\": slot}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        # TODO use one byte - or bit - per reentrancy key"
          },
          {
            "type": "delete",
            "line": "        # requires either an extra SLOAD or caching the value of the"
          },
          {
            "type": "delete",
            "line": "        # location in memory at entrance"
          },
          {
            "type": "delete",
            "line": "        storage_slot += 1"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     for node in vyper_module.get_children(vy_ast.VariableDecl):"
          },
          {
            "type": "context",
            "line": "         # skip non-storage variables"
          },
          {
            "type": "context",
            "line": "             continue"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         varinfo = node.target._metadata[\"varinfo\"]"
          },
          {
            "type": "delete",
            "line": "        varinfo.set_position(StorageSlot(storage_slot))"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         type_ = varinfo.typ"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        # this could have better typing but leave it untyped until"
          },
          {
            "type": "delete",
            "line": "        # we understand the use case better"
          },
          {
            "type": "delete",
            "line": "        ret[node.target.id] = {\"type\": str(type_), \"slot\": storage_slot}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # CMC 2021-07-23 note that HashMaps get assigned a slot here."
          },
          {
            "type": "context",
            "line": "         # I'm not sure if it's safe to avoid allocating that slot"
          },
          {
            "type": "context",
            "line": "         # for HashMaps because downstream code might use the slot"
          },
          {
            "type": "context",
            "line": "         # ID as a salt."
          },
          {
            "type": "delete",
            "line": "        storage_slot += math.ceil(type_.size_in_bytes / 32)"
          },
          {
            "type": "add",
            "line": "        n_slots = type_.storage_size_in_words"
          },
          {
            "type": "add",
            "line": "        slot = allocator.allocate_slot(n_slots, node.target.id)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        varinfo.set_position(StorageSlot(slot))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # this could have better typing but leave it untyped until"
          },
          {
            "type": "add",
            "line": "        # we understand the use case better"
          },
          {
            "type": "add",
            "line": "        ret[node.target.id] = {\"type\": str(type_), \"slot\": slot}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return ret"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         type_ = varinfo.typ"
          },
          {
            "type": "context",
            "line": "         varinfo.set_position(CodeOffset(offset))"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        len_ = math.ceil(type_.size_in_bytes / 32) * 32"
          },
          {
            "type": "add",
            "line": "        len_ = ceil32(type_.size_in_bytes)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # this could have better typing but leave it untyped until"
          },
          {
            "type": "context",
            "line": "         # we understand the use case better"
          }
        ]
      },
      {
        "file": "vyper/semantics/types/subscriptable.py",
        "changes": [
          {
            "type": "context",
            "line": "index a5ae075b..4aef58ca 100644"
          },
          {
            "type": "context",
            "line": "--- a/vyper/semantics/types/subscriptable.py"
          },
          {
            "type": "context",
            "line": "+++ b/vyper/semantics/types/subscriptable.py"
          },
          {
            "type": "context",
            "line": "         if not 0 < length < 2**256:"
          },
          {
            "type": "context",
            "line": "             raise InvalidType(\"Array length is invalid\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if length >= 2**64:"
          },
          {
            "type": "add",
            "line": "            warnings.warn(\"Use of large arrays can be unsafe!\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         super().__init__(UINT256_T, value_type)"
          },
          {
            "type": "context",
            "line": "         self.length = length"
          }
        ]
      }
    ]
  },
  {
    "commit": "0bd64788d2b4680c04fbef76314a24884d65fed9",
    "files": [
      {
        "file": "app/controllers/admin/backups_controller.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 99bc0ca2d3..7a86b2ef45 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/controllers/admin/backups_controller.rb"
          },
          {
            "type": "context",
            "line": "+++ b/app/controllers/admin/backups_controller.rb"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def create"
          },
          {
            "type": "add",
            "line": "    RateLimiter.new("
          },
          {
            "type": "add",
            "line": "      current_user,"
          },
          {
            "type": "add",
            "line": "      \"max-backups-per-minute\","
          },
          {
            "type": "add",
            "line": "      1,"
          },
          {
            "type": "add",
            "line": "      1.minute,"
          },
          {
            "type": "add",
            "line": "      apply_limit_to_staff: true,"
          },
          {
            "type": "add",
            "line": "    ).performed!"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     opts = {"
          },
          {
            "type": "context",
            "line": "       publish_to_message_bus: true,"
          },
          {
            "type": "context",
            "line": "       with_uploads: params.fetch(:with_uploads) == \"true\","
          }
        ]
      },
      {
        "file": "libackup_restore/backuper.rb",
        "changes": [
          {
            "type": "context",
            "line": "index ef8d019886..a0b6c923af 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/backup_restore/backuper.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/backup_restore/backuper.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " module BackupRestore"
          },
          {
            "type": "context",
            "line": "   class Backuper"
          },
          {
            "type": "delete",
            "line": "    attr_reader :success"
          },
          {
            "type": "add",
            "line": "    attr_reader :success, :store"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def initialize(user_id, opts = {})"
          },
          {
            "type": "context",
            "line": "       @user_id = user_id"
          },
          {
            "type": "context",
            "line": "     rescue Exception => ex"
          },
          {
            "type": "context",
            "line": "       log \"EXCEPTION: \" + ex.message"
          },
          {
            "type": "context",
            "line": "       log ex.backtrace.join(\"\\n\")"
          },
          {
            "type": "delete",
            "line": "      @success = false"
          },
          {
            "type": "context",
            "line": "     else"
          },
          {
            "type": "context",
            "line": "       @success = true"
          },
          {
            "type": "context",
            "line": "       @backup_filename"
          },
          {
            "type": "context",
            "line": "       clean_up"
          },
          {
            "type": "context",
            "line": "       notify_user"
          },
          {
            "type": "context",
            "line": "       log \"Finished!\""
          },
          {
            "type": "delete",
            "line": "      publish_completion(@success)"
          },
          {
            "type": "add",
            "line": "      publish_completion"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     protected"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def upload_archive"
          },
          {
            "type": "delete",
            "line": "      return unless @store.remote?"
          },
          {
            "type": "add",
            "line": "      return unless store.remote?"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       log \"Uploading archive...\""
          },
          {
            "type": "context",
            "line": "       content_type = MiniMime.lookup_by_filename(@backup_filename).content_type"
          },
          {
            "type": "context",
            "line": "       archive_path = File.join(@archive_directory, @backup_filename)"
          },
          {
            "type": "delete",
            "line": "      @store.upload_file(@backup_filename, archive_path, content_type)"
          },
          {
            "type": "add",
            "line": "      store.upload_file(@backup_filename, archive_path, content_type)"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def after_create_hook"
          },
          {
            "type": "context",
            "line": "       return if Rails.env.development?"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       log \"Deleting old backups...\""
          },
          {
            "type": "delete",
            "line": "      @store.delete_old"
          },
          {
            "type": "add",
            "line": "      store.delete_old"
          },
          {
            "type": "context",
            "line": "     rescue => ex"
          },
          {
            "type": "context",
            "line": "       log \"Something went wrong while deleting old backups.\", ex"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def notify_user"
          },
          {
            "type": "delete",
            "line": "      return if @success && @user.id == Discourse::SYSTEM_USER_ID"
          },
          {
            "type": "add",
            "line": "      return if success && @user.id == Discourse::SYSTEM_USER_ID"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       log \"Notifying '#{@user.username}' of the end of the backup...\""
          },
          {
            "type": "delete",
            "line": "      status = @success ? :backup_succeeded : :backup_failed"
          },
          {
            "type": "add",
            "line": "      status = success ? :backup_succeeded : :backup_failed"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       logs = Discourse::Utils.logs_markdown(@logs, user: @user)"
          },
          {
            "type": "context",
            "line": "       post = SystemMessage.create_from_system_user(@user, status, logs: logs)"
          },
          {
            "type": "context",
            "line": "       delete_uploaded_archive"
          },
          {
            "type": "context",
            "line": "       remove_tar_leftovers"
          },
          {
            "type": "context",
            "line": "       mark_backup_as_not_running"
          },
          {
            "type": "delete",
            "line": "      refresh_disk_space"
          },
          {
            "type": "add",
            "line": "      refresh_disk_space if success"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def delete_uploaded_archive"
          },
          {
            "type": "delete",
            "line": "      return unless @store.remote?"
          },
          {
            "type": "add",
            "line": "      return unless store.remote?"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       archive_path = File.join(@archive_directory, @backup_filename)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def refresh_disk_space"
          },
          {
            "type": "context",
            "line": "       log \"Refreshing disk stats...\""
          },
          {
            "type": "delete",
            "line": "      @store.reset_cache"
          },
          {
            "type": "add",
            "line": "      store.reset_cache"
          },
          {
            "type": "context",
            "line": "     rescue => ex"
          },
          {
            "type": "context",
            "line": "       log \"Something went wrong while refreshing disk stats.\", ex"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": "       @logs << \"[#{timestamp}] #{message}\""
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def publish_completion(success)"
          },
          {
            "type": "add",
            "line": "    def publish_completion"
          },
          {
            "type": "context",
            "line": "       if success"
          },
          {
            "type": "context",
            "line": "         log(\"[SUCCESS]\")"
          },
          {
            "type": "context",
            "line": "         DiscourseEvent.trigger(:backup_complete, logs: @logs, ticket: @ticket)"
          }
        ]
      },
      {
        "file": "spec/libackup_restore/backuper_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 1578a44f44..258eedfec4 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/lib/backup_restore/backuper_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/lib/backup_restore/backuper_spec.rb"
          },
          {
            "type": "context",
            "line": " # frozen_string_literal: true"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " RSpec.describe BackupRestore::Backuper do"
          },
          {
            "type": "delete",
            "line": "  it \"returns a non-empty parameterized title when site title contains unicode\" do"
          },
          {
            "type": "delete",
            "line": "    SiteSetting.title = \"Ɣ\""
          },
          {
            "type": "delete",
            "line": "    backuper = BackupRestore::Backuper.new(Discourse.system_user.id)"
          },
          {
            "type": "add",
            "line": "  describe \"#get_parameterized_title\" do"
          },
          {
            "type": "add",
            "line": "    it \"returns a non-empty parameterized title when site title contains unicode\" do"
          },
          {
            "type": "add",
            "line": "      SiteSetting.title = \"Ɣ\""
          },
          {
            "type": "add",
            "line": "      backuper = BackupRestore::Backuper.new(Discourse.system_user.id)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    expect(backuper.send(:get_parameterized_title)).to eq(\"discourse\")"
          },
          {
            "type": "delete",
            "line": "  end"
          },
          {
            "type": "add",
            "line": "      expect(backuper.send(:get_parameterized_title)).to eq(\"discourse\")"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  it \"returns a valid parameterized site title\" do"
          },
          {
            "type": "delete",
            "line": "    SiteSetting.title = \"Coding Horror\""
          },
          {
            "type": "delete",
            "line": "    backuper = BackupRestore::Backuper.new(Discourse.system_user.id)"
          },
          {
            "type": "add",
            "line": "    it \"returns a valid parameterized site title\" do"
          },
          {
            "type": "add",
            "line": "      SiteSetting.title = \"Coding Horror\""
          },
          {
            "type": "add",
            "line": "      backuper = BackupRestore::Backuper.new(Discourse.system_user.id)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    expect(backuper.send(:get_parameterized_title)).to eq(\"coding-horror\")"
          },
          {
            "type": "add",
            "line": "      expect(backuper.send(:get_parameterized_title)).to eq(\"coding-horror\")"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   describe \"#notify_user\" do"
          },
          {
            "type": "context",
            "line": "       )"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  describe \"#run\" do"
          },
          {
            "type": "add",
            "line": "    subject(:run) { backup.run }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    let(:backup) { described_class.new(user.id) }"
          },
          {
            "type": "add",
            "line": "    let(:user) { Discourse.system_user }"
          },
          {
            "type": "add",
            "line": "    let(:store) { backup.store }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    before { backup.stubs(:success).returns(success) }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    context \"when the result isn't successful\" do"
          },
          {
            "type": "add",
            "line": "      let(:success) { false }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"doesn't refresh disk stats\" do"
          },
          {
            "type": "add",
            "line": "        store.expects(:reset_cache).never"
          },
          {
            "type": "add",
            "line": "        run"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    context \"when the result is successful\" do"
          },
          {
            "type": "add",
            "line": "      let(:success) { true }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"refreshes disk stats\" do"
          },
          {
            "type": "add",
            "line": "        store.expects(:reset_cache)"
          },
          {
            "type": "add",
            "line": "        run"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": "  end"
          },
          {
            "type": "context",
            "line": " end"
          }
        ]
      },
      {
        "file": "spec/requests/admin/backups_controller_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index b52278832c..6bb5519c5f 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/requests/admin/backups_controller_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/requests/admin/backups_controller_spec.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   describe \"#create\" do"
          },
          {
            "type": "context",
            "line": "     context \"when logged in as an admin\" do"
          },
          {
            "type": "delete",
            "line": "      before { sign_in(admin) }"
          },
          {
            "type": "add",
            "line": "      before do"
          },
          {
            "type": "add",
            "line": "        sign_in(admin)"
          },
          {
            "type": "add",
            "line": "        BackupRestore.stubs(:backup!)"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       it \"starts a backup\" do"
          },
          {
            "type": "context",
            "line": "         BackupRestore.expects(:backup!).with("
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         expect(response.status).to eq(200)"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      context \"with rate limiting enabled\" do"
          },
          {
            "type": "add",
            "line": "        before do"
          },
          {
            "type": "add",
            "line": "          RateLimiter.clear_all!"
          },
          {
            "type": "add",
            "line": "          RateLimiter.enable"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        after { RateLimiter.disable }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        it \"is rate limited\" do"
          },
          {
            "type": "add",
            "line": "          post \"/admin/backups.json\", params: { with_uploads: false, client_id: \"foo\" }"
          },
          {
            "type": "add",
            "line": "          post \"/admin/backups.json\", params: { with_uploads: false, client_id: \"foo\" }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "          expect(response).to have_http_status :too_many_requests"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     shared_examples \"backups creation not allowed\" do"
          }
        ]
      }
    ]
  },
  {
    "commit": "0bfc0bf38a7758b27c5c446fec5e3b905e5a54ab",
    "files": [
      {
        "file": "app/View/Elements/genericElements/SingleViews/Fields/genericField.ctp",
        "changes": [
          {
            "type": "context",
            "line": "index 748d59c77..6f7a8cb12 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/View/Elements/genericElements/SingleViews/Fields/genericField.ctp"
          },
          {
            "type": "context",
            "line": "+++ b/app/View/Elements/genericElements/SingleViews/Fields/genericField.ctp"
          },
          {
            "type": "context",
            "line": "     $string = $field['raw'];"
          },
          {
            "type": "context",
            "line": " } else {"
          },
          {
            "type": "context",
            "line": "     $value = Hash::extract($data, $field['path']);"
          },
          {
            "type": "delete",
            "line": "    $string = empty($value[0]) ? '' : $value[0];"
          },
          {
            "type": "add",
            "line": "    $string = empty($value[0]) ? '' : h($value[0]);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " if (!empty($field['url'])) {"
          },
          {
            "type": "context",
            "line": "     if (!empty($field['url_vars'])) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "0bfc96cb77224736dfa35c3c555d37b3646ef35e",
    "files": [
      {
        "file": "block/scsi_ioctl.c",
        "changes": [
          {
            "type": "context",
            "line": "index a2c11f330872..260fa80ef575 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/scsi_ioctl.c"
          },
          {
            "type": "context",
            "line": "+++ b/block/scsi_ioctl.c"
          },
          {
            "type": "context",
            "line": " #include <linux/capability.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/completion.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/cdrom.h>"
          },
          {
            "type": "add",
            "line": "#include <linux/ratelimit.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/slab.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/times.h>"
          },
          {
            "type": "context",
            "line": " #include <asm/uaccess.h>"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(scsi_cmd_ioctl);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "int scsi_verify_blk_ioctl(struct block_device *bd, unsigned int cmd)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tif (bd && bd == bd->bd_contains)"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* Actually none of these is particularly useful on a partition,"
          },
          {
            "type": "add",
            "line": "\t * but they are safe."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tswitch (cmd) {"
          },
          {
            "type": "add",
            "line": "\tcase SCSI_IOCTL_GET_IDLUN:"
          },
          {
            "type": "add",
            "line": "\tcase SCSI_IOCTL_GET_BUS_NUMBER:"
          },
          {
            "type": "add",
            "line": "\tcase SCSI_IOCTL_GET_PCI:"
          },
          {
            "type": "add",
            "line": "\tcase SCSI_IOCTL_PROBE_HOST:"
          },
          {
            "type": "add",
            "line": "\tcase SG_GET_VERSION_NUM:"
          },
          {
            "type": "add",
            "line": "\tcase SG_SET_TIMEOUT:"
          },
          {
            "type": "add",
            "line": "\tcase SG_GET_TIMEOUT:"
          },
          {
            "type": "add",
            "line": "\tcase SG_GET_RESERVED_SIZE:"
          },
          {
            "type": "add",
            "line": "\tcase SG_SET_RESERVED_SIZE:"
          },
          {
            "type": "add",
            "line": "\tcase SG_EMULATED_HOST:"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "add",
            "line": "\tcase CDROM_GET_CAPABILITY:"
          },
          {
            "type": "add",
            "line": "\t\t/* Keep this until we remove the printk below.  udev sends it"
          },
          {
            "type": "add",
            "line": "\t\t * and we do not want to spam dmesg about it.   CD-ROMs do"
          },
          {
            "type": "add",
            "line": "\t\t * not have partitions, so we get here only for disks."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\treturn -ENOIOCTLCMD;"
          },
          {
            "type": "add",
            "line": "\tdefault:"
          },
          {
            "type": "add",
            "line": "\t\tbreak;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* In particular, rule out all resets and host-specific ioctls.  */"
          },
          {
            "type": "add",
            "line": "\tprintk_ratelimited(KERN_WARNING"
          },
          {
            "type": "add",
            "line": "\t\t\t   \"%s: sending ioctl %x to a partition!\\n\", current->comm, cmd);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn capable(CAP_SYS_RAWIO) ? 0 : -ENOIOCTLCMD;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": "EXPORT_SYMBOL(scsi_verify_blk_ioctl);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " int scsi_cmd_blk_ioctl(struct block_device *bd, fmode_t mode,"
          },
          {
            "type": "context",
            "line": " \t\t       unsigned int cmd, void __user *arg)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "\tint ret;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tret = scsi_verify_blk_ioctl(bd, cmd);"
          },
          {
            "type": "add",
            "line": "\tif (ret < 0)"
          },
          {
            "type": "add",
            "line": "\t\treturn ret;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn scsi_cmd_ioctl(bd->bd_disk->queue, bd->bd_disk, mode, cmd, arg);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(scsi_cmd_blk_ioctl);"
          }
        ]
      },
      {
        "file": "drivers/scsi/sd.c",
        "changes": [
          {
            "type": "context",
            "line": "index b4d57bb04c72..c691fb50e6cb 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/sd.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/sd.c"
          },
          {
            "type": "context",
            "line": " \tSCSI_LOG_IOCTL(1, sd_printk(KERN_INFO, sdkp, \"sd_ioctl: disk=%s, \""
          },
          {
            "type": "context",
            "line": " \t\t\t\t    \"cmd=0x%x\\n\", disk->disk_name, cmd));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\terror = scsi_verify_blk_ioctl(bdev, cmd);"
          },
          {
            "type": "add",
            "line": "\tif (error < 0)"
          },
          {
            "type": "add",
            "line": "\t\treturn error;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * If we are in the middle of error recovery, don't let anyone"
          },
          {
            "type": "context",
            "line": " \t * else try and use this device.  Also, if error recovery fails, it"
          },
          {
            "type": "context",
            "line": " \t\t\t   unsigned int cmd, unsigned long arg)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct scsi_device *sdev = scsi_disk(bdev->bd_disk)->device;"
          },
          {
            "type": "add",
            "line": "\tint ret;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tret = scsi_verify_blk_ioctl(bdev, cmd);"
          },
          {
            "type": "add",
            "line": "\tif (ret < 0)"
          },
          {
            "type": "add",
            "line": "\t\treturn ret;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * If we are in the middle of error recovery, don't let anyone"
          },
          {
            "type": "context",
            "line": " \t\treturn -ENODEV;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (sdev->host->hostt->compat_ioctl) {"
          },
          {
            "type": "delete",
            "line": "\t\tint ret;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tret = sdev->host->hostt->compat_ioctl(sdev, cmd, (void __user *)arg);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\treturn ret;"
          }
        ]
      },
      {
        "file": "include/linux/blkdev.h",
        "changes": [
          {
            "type": "context",
            "line": "index ca7b869508c7..0ed1eb062313 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/blkdev.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/blkdev.h"
          },
          {
            "type": "context",
            "line": " \t\t\t\t     struct request *rq);"
          },
          {
            "type": "context",
            "line": " extern void blk_delay_queue(struct request_queue *, unsigned long);"
          },
          {
            "type": "context",
            "line": " extern void blk_recount_segments(struct request_queue *, struct bio *);"
          },
          {
            "type": "add",
            "line": "extern int scsi_verify_blk_ioctl(struct block_device *, unsigned int);"
          },
          {
            "type": "context",
            "line": " extern int scsi_cmd_blk_ioctl(struct block_device *, fmode_t,"
          },
          {
            "type": "context",
            "line": " \t\t\t      unsigned int, void __user *);"
          },
          {
            "type": "context",
            "line": " extern int scsi_cmd_ioctl(struct request_queue *, struct gendisk *, fmode_t,"
          }
        ]
      }
    ]
  },
  {
    "commit": "0c17d1d2c61936401f4702e1846e2c19b200f958",
    "files": [
      {
        "file": "kernel/bpf/verifier.c",
        "changes": [
          {
            "type": "context",
            "line": "index c086010ae51e..f716bdf29dd0 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/bpf/verifier.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/bpf/verifier.c"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t   strict);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/* truncate register to smaller size (in bytes)"
          },
          {
            "type": "add",
            "line": " * must be called with size < BPF_REG_SIZE"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static void coerce_reg_to_size(struct bpf_reg_state *reg, int size)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tu64 mask;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* clear high bits in bit representation */"
          },
          {
            "type": "add",
            "line": "\treg->var_off = tnum_cast(reg->var_off, size);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* fix arithmetic bounds */"
          },
          {
            "type": "add",
            "line": "\tmask = ((u64)1 << (size * 8)) - 1;"
          },
          {
            "type": "add",
            "line": "\tif ((reg->umin_value & ~mask) == (reg->umax_value & ~mask)) {"
          },
          {
            "type": "add",
            "line": "\t\treg->umin_value &= mask;"
          },
          {
            "type": "add",
            "line": "\t\treg->umax_value &= mask;"
          },
          {
            "type": "add",
            "line": "\t} else {"
          },
          {
            "type": "add",
            "line": "\t\treg->umin_value = 0;"
          },
          {
            "type": "add",
            "line": "\t\treg->umax_value = mask;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\treg->smin_value = reg->umin_value;"
          },
          {
            "type": "add",
            "line": "\treg->smax_value = reg->umax_value;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* check whether memory at (regno + off) is accessible for t = (read | write)"
          },
          {
            "type": "context",
            "line": "  * if t==write, value_regno is a register which value is stored into memory"
          },
          {
            "type": "context",
            "line": "  * if t==read, value_regno is a register which will receive the value from memory"
          },
          {
            "type": "context",
            "line": " \tif (!err && size < BPF_REG_SIZE && value_regno >= 0 && t == BPF_READ &&"
          },
          {
            "type": "context",
            "line": " \t    regs[value_regno].type == SCALAR_VALUE) {"
          },
          {
            "type": "context",
            "line": " \t\t/* b/h/w load zero-extends, mark upper bits as known 0 */"
          },
          {
            "type": "delete",
            "line": "\t\tregs[value_regno].var_off ="
          },
          {
            "type": "delete",
            "line": "\t\t\ttnum_cast(regs[value_regno].var_off, size);"
          },
          {
            "type": "delete",
            "line": "\t\t__update_reg_bounds(&regs[value_regno]);"
          },
          {
            "type": "add",
            "line": "\t\tcoerce_reg_to_size(&regs[value_regno], size);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn err;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void coerce_reg_to_32(struct bpf_reg_state *reg)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "\t/* clear high 32 bits */"
          },
          {
            "type": "delete",
            "line": "\treg->var_off = tnum_cast(reg->var_off, 4);"
          },
          {
            "type": "delete",
            "line": "\t/* Update bounds */"
          },
          {
            "type": "delete",
            "line": "\t__update_reg_bounds(reg);"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " static bool signed_add_overflows(s64 a, s64 b)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \t/* Do the add in u64, where overflow is well-defined */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (BPF_CLASS(insn->code) != BPF_ALU64) {"
          },
          {
            "type": "context",
            "line": " \t\t/* 32-bit ALU ops are (32,32)->64 */"
          },
          {
            "type": "delete",
            "line": "\t\tcoerce_reg_to_32(dst_reg);"
          },
          {
            "type": "delete",
            "line": "\t\tcoerce_reg_to_32(&src_reg);"
          },
          {
            "type": "add",
            "line": "\t\tcoerce_reg_to_size(dst_reg, 4);"
          },
          {
            "type": "add",
            "line": "\t\tcoerce_reg_to_size(&src_reg, 4);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tsmin_val = src_reg.smin_value;"
          },
          {
            "type": "context",
            "line": " \tsmax_val = src_reg.smax_value;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\treturn -EACCES;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\tmark_reg_unknown(env, regs, insn->dst_reg);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t/* high 32 bits are known zero. */"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tregs[insn->dst_reg].var_off = tnum_cast("
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t\tregs[insn->dst_reg].var_off, 4);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t__update_reg_bounds(&regs[insn->dst_reg]);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tcoerce_reg_to_size(&regs[insn->dst_reg], 4);"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\t/* case: R = imm"
          }
        ]
      }
    ]
  },
  {
    "commit": "0c18f29aae7ce3dadd26d8ee3505d07cc982df75",
    "files": [
      {
        "file": "kernel/module.c",
        "changes": [
          {
            "type": "context",
            "line": "index 7e78dfabca97..927d46cb8eb9 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/module.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/module.c"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#ifdef CONFIG_MODULE_SIG"
          },
          {
            "type": "context",
            "line": " static bool sig_enforce = IS_ENABLED(CONFIG_MODULE_SIG_FORCE);"
          },
          {
            "type": "context",
            "line": " module_param(sig_enforce, bool_enable_only, 0644);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "void set_module_sig_enforced(void)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tsig_enforce = true;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": "#else"
          },
          {
            "type": "add",
            "line": "#define sig_enforce false"
          },
          {
            "type": "add",
            "line": "#endif"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  * Export sig_enforce kernel cmdline parameter to allow other subsystems rely"
          },
          {
            "type": "context",
            "line": "  * on that instead of directly to CONFIG_MODULE_SIG_FORCE config."
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " EXPORT_SYMBOL(is_module_sig_enforced);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "void set_module_sig_enforced(void)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "\tsig_enforce = true;"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* Block module loading/unloading? */"
          },
          {
            "type": "context",
            "line": " int modules_disabled = 0;"
          },
          {
            "type": "context",
            "line": " core_param(nomodule, modules_disabled, bint, 0);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0c319d3a144d4b8f1ea2047fd614d2149b68f889",
    "files": [
      {
        "file": "drivers/nvme/target/fc.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6850672ad2a2..58e010bdda3e 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/nvme/target/fc.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/nvme/target/fc.c"
          },
          {
            "type": "context",
            "line": " \tu16 qid = nvmet_fc_getqueueid(connection_id);"
          },
          {
            "type": "context",
            "line": " \tunsigned long flags;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (qid > NVMET_NR_QUEUES)"
          },
          {
            "type": "add",
            "line": "\t\treturn NULL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tspin_lock_irqsave(&tgtport->lock, flags);"
          },
          {
            "type": "context",
            "line": " \tlist_for_each_entry(assoc, &tgtport->assoc_list, a_list) {"
          },
          {
            "type": "context",
            "line": " \t\tif (association_id == assoc->association_id) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "0c6b9df77bac9c6f7c7e2eadf6fe100064afdeab",
    "files": [
      {
        "file": "plugins/poll/config/locales/server.en.yml",
        "changes": [
          {
            "type": "context",
            "line": "index 58e121d5d3..f6a8917efc 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/poll/config/locales/server.en.yml"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/poll/config/locales/server.en.yml"
          },
          {
            "type": "context",
            "line": "     topic_must_be_open_to_vote: \"The topic must be open to vote.\""
          },
          {
            "type": "context",
            "line": "     poll_must_be_open_to_vote: \"Poll must be open to vote.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    one_vote_per_user: \"Only 1 vote is allowed for this poll.\""
          },
          {
            "type": "add",
            "line": "    max_vote_per_user:"
          },
          {
            "type": "add",
            "line": "      one: Only %{count} vote is allowed for this poll."
          },
          {
            "type": "add",
            "line": "      other: A maximum of %{count} votes is allowed for this poll."
          },
          {
            "type": "add",
            "line": "    min_vote_per_user:"
          },
          {
            "type": "add",
            "line": "      one: A minimum of %{count} vote is required for this poll."
          },
          {
            "type": "add",
            "line": "      other: A minimum of %{count} votes is required for this poll."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     topic_must_be_open_to_toggle_status: \"The topic must be open to toggle status.\""
          },
          {
            "type": "context",
            "line": "     only_staff_or_op_can_toggle_status: \"Only a staff member or the original poster can toggle a poll status.\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "plugins/poll/plugin.rb",
        "changes": [
          {
            "type": "context",
            "line": "index b5f657f865..418b726e82 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/poll/plugin.rb"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/poll/plugin.rb"
          },
          {
            "type": "context",
            "line": "           available_options = poll.poll_options.map { |o| o.digest }.to_set"
          },
          {
            "type": "context",
            "line": "           options.select! { |o| available_options.include?(o) }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "          self.validate_votes!(poll, options)"
          },
          {
            "type": "context",
            "line": "           raise StandardError.new I18n.t(\"poll.requires_at_least_1_valid_option\") if options.empty?"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "           new_option_ids = poll.poll_options.each_with_object([]) do |option, obj|"
          },
          {
            "type": "context",
            "line": "         end"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "      def validate_votes!(poll, options)"
          },
          {
            "type": "add",
            "line": "        num_of_options = options.length"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if poll.multiple?"
          },
          {
            "type": "add",
            "line": "          if num_of_options < poll.min"
          },
          {
            "type": "add",
            "line": "            raise StandardError.new(I18n.t("
          },
          {
            "type": "add",
            "line": "              \"poll.min_vote_per_user\","
          },
          {
            "type": "add",
            "line": "              count: poll.min"
          },
          {
            "type": "add",
            "line": "            ))"
          },
          {
            "type": "add",
            "line": "          elsif num_of_options > poll.max"
          },
          {
            "type": "add",
            "line": "            raise StandardError.new(I18n.t("
          },
          {
            "type": "add",
            "line": "              \"poll.max_vote_per_user\","
          },
          {
            "type": "add",
            "line": "              count: poll.max"
          },
          {
            "type": "add",
            "line": "            ))"
          },
          {
            "type": "add",
            "line": "          end"
          },
          {
            "type": "add",
            "line": "        elsif num_of_options > 1"
          },
          {
            "type": "add",
            "line": "          raise StandardError.new(I18n.t(\"poll.one_vote_per_user\"))"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "       def toggle_status(post_id, poll_name, status, user, raise_errors = true)"
          },
          {
            "type": "context",
            "line": "         Poll.transaction do"
          },
          {
            "type": "context",
            "line": "           post = Post.find_by(id: post_id)"
          }
        ]
      }
    ]
  },
  {
    "commit": "0c791d073d0eb344ee7aaafd221513dc9226762c",
    "files": [
      {
        "file": "sesman/libscp/libscp_types.h",
        "changes": [
          {
            "type": "context",
            "line": "index 8cb9166c..84e6c465 100644"
          },
          {
            "type": "context",
            "line": "--- a/sesman/libscp/libscp_types.h"
          },
          {
            "type": "context",
            "line": "+++ b/sesman/libscp/libscp_types.h"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #include \"libscp_types_mng.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/* Max server incoming and outgoing message size, used to stop memory"
          },
          {
            "type": "add",
            "line": "   exhaustion attempts (CVE-2020-4044) */"
          },
          {
            "type": "add",
            "line": "#define SCP_MAX_MESSAGE_SIZE 8192"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " struct SCP_CONNECTION"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "   int in_sck;"
          }
        ]
      },
      {
        "file": "sesman/libscp/libscp_v0.c",
        "changes": [
          {
            "type": "context",
            "line": "index 61bf4fda..55168b4f 100644"
          },
          {
            "type": "context",
            "line": "--- a/sesman/libscp/libscp_v0.c"
          },
          {
            "type": "context",
            "line": "+++ b/sesman/libscp/libscp_v0.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " extern struct log_config *s_log;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/** Maximum length of a string (two bytes + len), excluding the terminator"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Practially this is limited by [MS-RDPBCGR] TS_INFO_PACKET"
          },
          {
            "type": "add",
            "line": " * */"
          },
          {
            "type": "add",
            "line": "#define STRING16_MAX_LEN 512"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Reads a big-endian uint16 followed by a string into a buffer"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Buffer is null-terminated on success"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @param s Input stream"
          },
          {
            "type": "add",
            "line": " * @param [out] Output buffer (must be >= (STRING16_MAX_LEN+1) chars)"
          },
          {
            "type": "add",
            "line": " * @param param Parameter we're reading"
          },
          {
            "type": "add",
            "line": " * @param line Line number reference"
          },
          {
            "type": "add",
            "line": " * @return != 0 if string read OK"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static"
          },
          {
            "type": "add",
            "line": "int in_string16(struct stream *s, char str[], const char *param, int line)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    int result;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(s, 2))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v0:%d] connection aborted: %s len missing\","
          },
          {
            "type": "add",
            "line": "                    line, param);"
          },
          {
            "type": "add",
            "line": "        result = 0;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    else"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        unsigned int sz;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        in_uint16_be(s, sz);"
          },
          {
            "type": "add",
            "line": "        if (sz > STRING16_MAX_LEN)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v0:%d] connection aborted: %s too long (%u chars)\","
          },
          {
            "type": "add",
            "line": "                        line, param, sz);"
          },
          {
            "type": "add",
            "line": "            result = 0;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        else"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            result = s_check_rem(s, sz);"
          },
          {
            "type": "add",
            "line": "            if (!result)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                            \"[v0:%d] connection aborted: %s data missing\","
          },
          {
            "type": "add",
            "line": "                            line, param);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            else"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                in_uint8a(s, str, sz);"
          },
          {
            "type": "add",
            "line": "                str[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    return result;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "context",
            "line": " /* client API */"
          },
          {
            "type": "context",
            "line": " /******************************************************************************/"
          },
          {
            "type": "context",
            "line": " enum SCP_CLIENT_STATES_E"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     sz = g_strlen(s->username);"
          },
          {
            "type": "add",
            "line": "    if (sz > STRING16_MAX_LEN)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v0:%d] connection aborted: username too long\","
          },
          {
            "type": "add",
            "line": "                    __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_CLIENT_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     out_uint16_be(c->out_s, sz);"
          },
          {
            "type": "context",
            "line": "     out_uint8a(c->out_s, s->username, sz);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     sz = g_strlen(s->password);"
          },
          {
            "type": "add",
            "line": "    if (sz > STRING16_MAX_LEN)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v0:%d] connection aborted: password too long\","
          },
          {
            "type": "add",
            "line": "                    __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_CLIENT_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     out_uint16_be(c->out_s, sz);"
          },
          {
            "type": "context",
            "line": "     out_uint8a(c->out_s, s->password, sz);"
          },
          {
            "type": "context",
            "line": "     out_uint16_be(c->out_s, s->width);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (size < 14)"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2 + 2 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: packet size error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v0:%d] connection aborted: msg size = %u\","
          },
          {
            "type": "add",
            "line": "                    __LINE__, (unsigned int)size);"
          },
          {
            "type": "context",
            "line": "         return SCP_CLIENT_STATE_SIZE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* getting payload */"
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, size - 8))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return SCP_CLIENT_STATE_NETWORK_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    c->in_s->end = c->in_s->data + (size - 8);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* check code */"
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return SCP_CLIENT_STATE_END;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "/* server API */"
          },
          {
            "type": "delete",
            "line": "/******************************************************************************/"
          },
          {
            "type": "delete",
            "line": "enum SCP_SERVER_STATES_E"
          },
          {
            "type": "delete",
            "line": "scp_v0s_accept(struct SCP_CONNECTION *c, struct SCP_SESSION **s, int skipVchk)"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Initialises a V0 session object"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * At the time of the call, the version has been read from the connection"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @param c Connection"
          },
          {
            "type": "add",
            "line": " * @param [out] session pre-allocated session object"
          },
          {
            "type": "add",
            "line": " * @return SCP_SERVER_STATE_OK for success"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static enum SCP_SERVER_STATES_E"
          },
          {
            "type": "add",
            "line": "scp_v0s_init_session(struct SCP_CONNECTION *c, struct SCP_SESSION *session)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    tui32 version = 0;"
          },
          {
            "type": "context",
            "line": "     tui32 size;"
          },
          {
            "type": "delete",
            "line": "    struct SCP_SESSION *session = 0;"
          },
          {
            "type": "delete",
            "line": "    tui16 sz;"
          },
          {
            "type": "add",
            "line": "    tui16 height;"
          },
          {
            "type": "add",
            "line": "    tui16 width;"
          },
          {
            "type": "add",
            "line": "    tui16 bpp;"
          },
          {
            "type": "context",
            "line": "     tui32 code = 0;"
          },
          {
            "type": "delete",
            "line": "    char *buf = 0;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (!skipVchk)"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        LOG_DBG(\"[v0:%d] starting connection\", __LINE__);"
          },
          {
            "type": "add",
            "line": "    char buf[STRING16_MAX_LEN + 1];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if (0 == scp_tcp_force_recv(c->in_sck, c->in_s->data, 8))"
          },
          {
            "type": "delete",
            "line": "        {"
          },
          {
            "type": "delete",
            "line": "            c->in_s->end = c->in_s->data + 8;"
          },
          {
            "type": "delete",
            "line": "            in_uint32_be(c->in_s, version);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            if (version != 0)"
          },
          {
            "type": "delete",
            "line": "            {"
          },
          {
            "type": "delete",
            "line": "                log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: version error\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "                return SCP_SERVER_STATE_VERSION_ERR;"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "        else"
          },
          {
            "type": "delete",
            "line": "        {"
          },
          {
            "type": "delete",
            "line": "            log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: network error\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "            return SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    scp_session_set_version(session, 0);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* Check for a header and a code value in the length */"
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v0:%d] connection aborted: msg size = %u\","
          },
          {
            "type": "add",
            "line": "                    __LINE__, (unsigned int)size);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, 8196);"
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, size - 8))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (code == 0 || code == 10 || code == 20)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        session = scp_session_create();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if (0 == session)"
          },
          {
            "type": "delete",
            "line": "        {"
          },
          {
            "type": "delete",
            "line": "            log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: network error\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "            return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        scp_session_set_version(session, version);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (code == 0)"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             scp_session_set_type(session, SCP_SESSION_TYPE_XVNC);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /* reading username */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "        in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "        buf[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "        if (!in_string16(c->in_s, buf, \"username\", __LINE__))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         if (0 != scp_session_set_username(session, buf))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "             log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: error setting username\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "            g_free(buf);"
          },
          {
            "type": "context",
            "line": "             return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "delete",
            "line": "        g_free(buf);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /* reading password */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "        in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "        buf[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "        if (!in_string16(c->in_s, buf, \"passwd\", __LINE__))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         if (0 != scp_session_set_password(session, buf))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "             log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: error setting password\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "            g_free(buf);"
          },
          {
            "type": "context",
            "line": "             return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "delete",
            "line": "        g_free(buf);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        /* width */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        scp_session_set_width(session, sz);"
          },
          {
            "type": "delete",
            "line": "        /* height */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        scp_session_set_height(session, sz);"
          },
          {
            "type": "delete",
            "line": "        /* bpp */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        if (0 != scp_session_set_bpp(session, (tui8)sz))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        /* width  + height + bpp */"
          },
          {
            "type": "add",
            "line": "        if (!s_check_rem(c->in_s, 2 + 2 + 2))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v0:%d] connection aborted: width+height+bpp missing\","
          },
          {
            "type": "add",
            "line": "                        __LINE__);"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        in_uint16_be(c->in_s, width);"
          },
          {
            "type": "add",
            "line": "        scp_session_set_width(session, width);"
          },
          {
            "type": "add",
            "line": "        in_uint16_be(c->in_s, height);"
          },
          {
            "type": "add",
            "line": "        scp_session_set_height(session, height);"
          },
          {
            "type": "add",
            "line": "        in_uint16_be(c->in_s, bpp);"
          },
          {
            "type": "add",
            "line": "        if (0 != scp_session_set_bpp(session, (tui8)bpp))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "             log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "context",
            "line": "                         \"[v0:%d] connection aborted: unsupported bpp: %d\","
          },
          {
            "type": "delete",
            "line": "                        __LINE__, (tui8)sz);"
          },
          {
            "type": "add",
            "line": "                        __LINE__, (tui8)bpp);"
          },
          {
            "type": "context",
            "line": "             return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (s_check_rem(c->in_s, 2))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             /* reading domain */"
          },
          {
            "type": "delete",
            "line": "            in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            if (sz > 0)"
          },
          {
            "type": "add",
            "line": "            if (!in_string16(c->in_s, buf, \"domain\", __LINE__))"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            if (buf[0] != '\\0')"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "delete",
            "line": "                buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "                in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "                buf[sz] = '\\0';"
          },
          {
            "type": "context",
            "line": "                 scp_session_set_domain(session, buf);"
          },
          {
            "type": "delete",
            "line": "                g_free(buf);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (s_check_rem(c->in_s, 2))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             /* reading program */"
          },
          {
            "type": "delete",
            "line": "            in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "add",
            "line": "            if (!in_string16(c->in_s, buf, \"program\", __LINE__))"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            if (sz > 0)"
          },
          {
            "type": "add",
            "line": "            if (buf[0] != '\\0')"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "delete",
            "line": "                buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "                in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "                buf[sz] = '\\0';"
          },
          {
            "type": "context",
            "line": "                 scp_session_set_program(session, buf);"
          },
          {
            "type": "delete",
            "line": "                g_free(buf);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (s_check_rem(c->in_s, 2))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             /* reading directory */"
          },
          {
            "type": "delete",
            "line": "            in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "add",
            "line": "            if (!in_string16(c->in_s, buf, \"directory\", __LINE__))"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            if (sz > 0)"
          },
          {
            "type": "add",
            "line": "            if (buf[0] != '\\0')"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "delete",
            "line": "                buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "                in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "                buf[sz] = '\\0';"
          },
          {
            "type": "context",
            "line": "                 scp_session_set_directory(session, buf);"
          },
          {
            "type": "delete",
            "line": "                g_free(buf);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (s_check_rem(c->in_s, 2))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             /* reading client IP address */"
          },
          {
            "type": "delete",
            "line": "            in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            if (sz > 0)"
          },
          {
            "type": "add",
            "line": "            if (!in_string16(c->in_s, buf, \"client IP\", __LINE__))"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            if (buf[0] != '\\0')"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "delete",
            "line": "                buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "                in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "                buf[sz] = '\\0';"
          },
          {
            "type": "context",
            "line": "                 scp_session_set_client_ip(session, buf);"
          },
          {
            "type": "delete",
            "line": "                g_free(buf);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     else if (code == SCP_GW_AUTHENTICATION)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        /* g_writeln(\"Command is SCP_GW_AUTHENTICATION\"); */"
          },
          {
            "type": "delete",
            "line": "        session = scp_session_create();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if (0 == session)"
          },
          {
            "type": "delete",
            "line": "        {"
          },
          {
            "type": "delete",
            "line": "            /* until syslog merge log_message(s_log, LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: network error\",      __LINE__);*/"
          },
          {
            "type": "delete",
            "line": "            return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        scp_session_set_version(session, version);"
          },
          {
            "type": "context",
            "line": "         scp_session_set_type(session, SCP_GW_AUTHENTICATION);"
          },
          {
            "type": "context",
            "line": "         /* reading username */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "        in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "        buf[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "        if (!in_string16(c->in_s, buf, \"username\", __LINE__))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /* g_writeln(\"Received user name: %s\",buf); */"
          },
          {
            "type": "context",
            "line": "         if (0 != scp_session_set_username(session, buf))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "             /* until syslog merge log_message(s_log, LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: error setting        username\", __LINE__);*/"
          },
          {
            "type": "delete",
            "line": "            g_free(buf);"
          },
          {
            "type": "context",
            "line": "             return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "delete",
            "line": "        g_free(buf);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /* reading password */"
          },
          {
            "type": "delete",
            "line": "        in_uint16_be(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "        buf = g_new0(char, sz + 1);"
          },
          {
            "type": "delete",
            "line": "        in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": "        buf[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "        if (!in_string16(c->in_s, buf, \"passwd\", __LINE__))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /* g_writeln(\"Received password: %s\",buf); */"
          },
          {
            "type": "context",
            "line": "         if (0 != scp_session_set_password(session, buf))"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "             /* until syslog merge log_message(s_log, LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: error setting password\", __LINE__); */"
          },
          {
            "type": "delete",
            "line": "            g_free(buf);"
          },
          {
            "type": "context",
            "line": "             return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "delete",
            "line": "        g_free(buf);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     else"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SEQUENCE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    (*s) = session;"
          },
          {
            "type": "context",
            "line": "     return SCP_SERVER_STATE_OK;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "/* server API */"
          },
          {
            "type": "add",
            "line": "/******************************************************************************/"
          },
          {
            "type": "add",
            "line": "enum SCP_SERVER_STATES_E"
          },
          {
            "type": "add",
            "line": "scp_v0s_accept(struct SCP_CONNECTION *c, struct SCP_SESSION **s, int skipVchk)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    enum SCP_SERVER_STATES_E result = SCP_SERVER_STATE_OK;"
          },
          {
            "type": "add",
            "line": "    struct SCP_SESSION *session = NULL;"
          },
          {
            "type": "add",
            "line": "    tui32 version = 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (!skipVchk)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        LOG_DBG(\"[v0:%d] starting connection\", __LINE__);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if (0 == scp_tcp_force_recv(c->in_sck, c->in_s->data, 8))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            c->in_s->end = c->in_s->data + 8;"
          },
          {
            "type": "add",
            "line": "            in_uint32_be(c->in_s, version);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (version != 0)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: version error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "                result = SCP_SERVER_STATE_VERSION_ERR;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        else"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING, \"[v0:%d] connection aborted: network error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "            result = SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (result == SCP_SERVER_STATE_OK)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        session = scp_session_create();"
          },
          {
            "type": "add",
            "line": "        if (NULL == session)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v0:%d] connection aborted: no memory\","
          },
          {
            "type": "add",
            "line": "                        __LINE__);"
          },
          {
            "type": "add",
            "line": "            result = SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        else"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            result = scp_v0s_init_session(c, session);"
          },
          {
            "type": "add",
            "line": "            if (result != SCP_SERVER_STATE_OK)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                scp_session_destroy(session);"
          },
          {
            "type": "add",
            "line": "                session = NULL;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    (*s) = session;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return result;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /******************************************************************************/"
          },
          {
            "type": "context",
            "line": " enum SCP_SERVER_STATES_E"
          },
          {
            "type": "context",
            "line": " scp_v0s_allow_connection(struct SCP_CONNECTION *c, SCP_DISPLAY d, const tui8 *guid)"
          }
        ]
      },
      {
        "file": "sesman/libscp/libscp_v1s.c",
        "changes": [
          {
            "type": "context",
            "line": "index 27e5ef13..37e8a01c 100644"
          },
          {
            "type": "context",
            "line": "--- a/sesman/libscp/libscp_v1s.c"
          },
          {
            "type": "context",
            "line": "+++ b/sesman/libscp/libscp_v1s.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " //extern struct log_config* s_log;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Reads a uint8 followed by a string into a buffer"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Buffer is null-terminated on success"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @param s Input stream"
          },
          {
            "type": "add",
            "line": " * @param [out] Output buffer (must be >= 256 chars)"
          },
          {
            "type": "add",
            "line": " * @param param Parameter we're reading"
          },
          {
            "type": "add",
            "line": " * @param line Line number reference"
          },
          {
            "type": "add",
            "line": " * @return != 0 if string read OK"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @todo"
          },
          {
            "type": "add",
            "line": " *     This needs to be merged with the func of the same name in"
          },
          {
            "type": "add",
            "line": " *     libscp_v1s_mng.c"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static"
          },
          {
            "type": "add",
            "line": "int in_string8(struct stream *s, char str[], const char *param, int line)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    int result;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(s, 1))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s:%d] connection aborted: %s len missing\","
          },
          {
            "type": "add",
            "line": "                    line, param);"
          },
          {
            "type": "add",
            "line": "        result = 0;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    else"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        unsigned int sz;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        in_uint8(s, sz);"
          },
          {
            "type": "add",
            "line": "        result = s_check_rem(s, sz);"
          },
          {
            "type": "add",
            "line": "        if (!result)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v1s:%d] connection aborted: %s data missing\","
          },
          {
            "type": "add",
            "line": "                        line, param);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        else"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            in_uint8a(s, str, sz);"
          },
          {
            "type": "add",
            "line": "            str[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    return result;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": "/* server API */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Initialises a V1 session object"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This is called after the V1 header, command set and command have been read"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @param c Connection"
          },
          {
            "type": "add",
            "line": " * @param [out] session pre-allocated session object"
          },
          {
            "type": "add",
            "line": " * @return SCP_SERVER_STATE_OK for success"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static enum SCP_SERVER_STATES_E"
          },
          {
            "type": "add",
            "line": "scp_v1s_init_session(struct SCP_CONNECTION *c, struct SCP_SESSION *session)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    tui8 type;"
          },
          {
            "type": "add",
            "line": "    tui16 height;"
          },
          {
            "type": "add",
            "line": "    tui16 width;"
          },
          {
            "type": "add",
            "line": "    tui8 bpp;"
          },
          {
            "type": "add",
            "line": "    tui8 sz;"
          },
          {
            "type": "add",
            "line": "    char buf[256];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    scp_session_set_version(session, 1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* Check there's data for the session type, the height, the width, the"
          },
          {
            "type": "add",
            "line": "     * bpp, the resource sharing indicator and the locale */"
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(c->in_s, 1 + 2 + 2 + 1 + 1 + 17))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s:%d] connection aborted: short packet\","
          },
          {
            "type": "add",
            "line": "                    __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    in_uint8(c->in_s, type);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if ((type != SCP_SESSION_TYPE_XVNC) && (type != SCP_SESSION_TYPE_XRDP))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: unknown session type\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SESSION_TYPE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    scp_session_set_type(session, type);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    in_uint16_be(c->in_s, height);"
          },
          {
            "type": "add",
            "line": "    scp_session_set_height(session, height);"
          },
          {
            "type": "add",
            "line": "    in_uint16_be(c->in_s, width);"
          },
          {
            "type": "add",
            "line": "    scp_session_set_width(session, width);"
          },
          {
            "type": "add",
            "line": "    in_uint8(c->in_s, bpp);"
          },
          {
            "type": "add",
            "line": "    if (0 != scp_session_set_bpp(session, bpp))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s:%d] connection aborted: unsupported bpp: %d\","
          },
          {
            "type": "add",
            "line": "                    __LINE__, bpp);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "add",
            "line": "    scp_session_set_rsr(session, sz);"
          },
          {
            "type": "add",
            "line": "    in_uint8a(c->in_s, buf, 17);"
          },
          {
            "type": "add",
            "line": "    buf[17] = '\\0';"
          },
          {
            "type": "add",
            "line": "    scp_session_set_locale(session, buf);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* Check there's enough data left for at least an IPv4 address (+len) */"
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(c->in_s, 1 + 4))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s:%d] connection aborted: IP addr len missing\","
          },
          {
            "type": "add",
            "line": "                    __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (sz == SCP_ADDRESS_TYPE_IPV4)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        tui32 ipv4;"
          },
          {
            "type": "add",
            "line": "        in_uint32_be(c->in_s, ipv4);"
          },
          {
            "type": "add",
            "line": "        scp_session_set_addr(session, sz, &ipv4);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    else if (sz == SCP_ADDRESS_TYPE_IPV6)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        if (!s_check_rem(c->in_s, 16))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v1s:%d] connection aborted: IP addr missing\","
          },
          {
            "type": "add",
            "line": "                        __LINE__);"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        in_uint8a(c->in_s, buf, 16);"
          },
          {
            "type": "add",
            "line": "        scp_session_set_addr(session, sz, buf);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* reading hostname */"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"hostname\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (0 != scp_session_set_hostname(session, buf))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* reading username */"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"username\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (0 != scp_session_set_username(session, buf))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* reading password */"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"passwd\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (0 != scp_session_set_password(session, buf))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return SCP_SERVER_STATE_OK;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* server API */"
          },
          {
            "type": "context",
            "line": " enum SCP_SERVER_STATES_E scp_v1s_accept(struct SCP_CONNECTION *c, struct SCP_SESSION **s, int skipVchk)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "    enum SCP_SERVER_STATES_E result;"
          },
          {
            "type": "context",
            "line": "     struct SCP_SESSION *session;"
          },
          {
            "type": "context",
            "line": "     tui32 version;"
          },
          {
            "type": "context",
            "line": "     tui32 size;"
          },
          {
            "type": "context",
            "line": "     tui16 cmdset;"
          },
          {
            "type": "context",
            "line": "     tui16 cmd;"
          },
          {
            "type": "delete",
            "line": "    tui8 sz;"
          },
          {
            "type": "delete",
            "line": "    char buf[257];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    (*s) = NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (!skipVchk)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (size < 12)"
          },
          {
            "type": "add",
            "line": "    /* Check the message is big enough for the header, the command set, and"
          },
          {
            "type": "add",
            "line": "     * the command (but not too big) */"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: size error\", __LINE__);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, (size - 8)))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    c->in_s->end = c->in_s->data + (size - 8);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* reading command set */"
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, cmdset);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     session = scp_session_create();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (0 == session)"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error (malloc returned NULL)\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    scp_session_set_version(session, 1);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if ((sz != SCP_SESSION_TYPE_XVNC) && (sz != SCP_SESSION_TYPE_XRDP))"
          },
          {
            "type": "add",
            "line": "    if (NULL == session)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: unknown session type\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_SESSION_TYPE_ERR;"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    scp_session_set_type(session, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    in_uint16_be(c->in_s, cmd);"
          },
          {
            "type": "delete",
            "line": "    scp_session_set_height(session, cmd);"
          },
          {
            "type": "delete",
            "line": "    in_uint16_be(c->in_s, cmd);"
          },
          {
            "type": "delete",
            "line": "    scp_session_set_width(session, cmd);"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    if (0 != scp_session_set_bpp(session, sz))"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "         log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "delete",
            "line": "                    \"[v1s:%d] connection aborted: unsupported bpp: %d\","
          },
          {
            "type": "delete",
            "line": "                    __LINE__, sz);"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    scp_session_set_rsr(session, sz);"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, 17);"
          },
          {
            "type": "delete",
            "line": "    buf[17] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    scp_session_set_locale(session, buf);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (sz == SCP_ADDRESS_TYPE_IPV4)"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        in_uint32_be(c->in_s, size);"
          },
          {
            "type": "delete",
            "line": "        scp_session_set_addr(session, sz, &size);"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "    else if (sz == SCP_ADDRESS_TYPE_IPV6)"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        in_uint8a(c->in_s, buf, 16);"
          },
          {
            "type": "delete",
            "line": "        scp_session_set_addr(session, sz, buf);"
          },
          {
            "type": "add",
            "line": "                    \"[v1s:%d] connection aborted: internal error \""
          },
          {
            "type": "add",
            "line": "                    \"(malloc returned NULL)\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        result = SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    buf[256] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    /* reading hostname */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (0 != scp_session_set_hostname(session, buf))"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* reading username */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (0 != scp_session_set_username(session, buf))"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* reading password */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (0 != scp_session_set_password(session, buf))"
          },
          {
            "type": "add",
            "line": "    else"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: internal error\", __LINE__);"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "        result = scp_v1s_init_session(c, session);"
          },
          {
            "type": "add",
            "line": "        if (result != SCP_SERVER_STATE_OK)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "add",
            "line": "            session = NULL;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* returning the struct */"
          },
          {
            "type": "context",
            "line": "     (*s) = session;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    return SCP_SERVER_STATE_OK;"
          },
          {
            "type": "add",
            "line": "    return result;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " enum SCP_SERVER_STATES_E"
          },
          {
            "type": "context",
            "line": " scp_v1s_request_password(struct SCP_CONNECTION *c, struct SCP_SESSION *s,"
          },
          {
            "type": "context",
            "line": "                          const char *reason)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    tui8 sz;"
          },
          {
            "type": "context",
            "line": "     tui32 version;"
          },
          {
            "type": "context",
            "line": "     tui32 size;"
          },
          {
            "type": "context",
            "line": "     tui16 cmdset;"
          },
          {
            "type": "context",
            "line": "     tui16 cmd;"
          },
          {
            "type": "context",
            "line": "     int rlen;"
          },
          {
            "type": "delete",
            "line": "    char buf[257];"
          },
          {
            "type": "add",
            "line": "    char buf[256];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "context",
            "line": "     init_stream(c->out_s, c->out_s->size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (size < 12)"
          },
          {
            "type": "add",
            "line": "    /* Check the message is big enough for the header, the command set, and"
          },
          {
            "type": "add",
            "line": "     * the command (but not too big) */"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: size error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s:%d] connection aborted: size error\","
          },
          {
            "type": "add",
            "line": "                    __LINE__);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, (size - 8)))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    c->in_s->end = c->in_s->data + (size - 8);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, cmdset);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (cmdset != SCP_COMMAND_SET_DEFAULT)"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SEQUENCE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    buf[256] = '\\0';"
          },
          {
            "type": "context",
            "line": "     /* reading username */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"username\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_session_set_username(s, buf))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* reading password */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"passwd\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_session_set_password(s, buf))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (size < 12)"
          },
          {
            "type": "add",
            "line": "    /* Check the message is big enough for the header, the command set, and"
          },
          {
            "type": "add",
            "line": "     * the command (but not too big) */"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: size error\", __LINE__);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, (size - 8)))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    c->in_s->end = c->in_s->data + (size - 8);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, cmd);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (cmd != SCP_COMMAND_SET_DEFAULT)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (size < 12)"
          },
          {
            "type": "add",
            "line": "    /* Check the message is big enough for the header, the command set, and"
          },
          {
            "type": "add",
            "line": "     * the command (but not too big) */"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: size error\", __LINE__);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* rest of the packet */"
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, (size - 8)))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    c->in_s->end = c->in_s->data + (size - 8);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, cmd);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (cmd != SCP_COMMAND_SET_DEFAULT)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (cmd == 43)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "add",
            "line": "        if (!s_check_rem(c->in_s, 4))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING, \"[v1s:%d] connection aborted: missing session\", __LINE__);"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         /* select session */"
          },
          {
            "type": "context",
            "line": "         in_uint32_be(c->in_s, (*sid));"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "sesman/libscp/libscp_v1s_mng.c",
        "changes": [
          {
            "type": "context",
            "line": "index 3a3e1d98..8e9aed12 100644"
          },
          {
            "type": "context",
            "line": "--- a/sesman/libscp/libscp_v1s_mng.c"
          },
          {
            "type": "context",
            "line": "+++ b/sesman/libscp/libscp_v1s_mng.c"
          },
          {
            "type": "context",
            "line": " static enum SCP_SERVER_STATES_E"
          },
          {
            "type": "context",
            "line": " _scp_v1s_mng_check_response(struct SCP_CONNECTION *c, struct SCP_SESSION *s);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "/* server API */"
          },
          {
            "type": "delete",
            "line": "enum SCP_SERVER_STATES_E"
          },
          {
            "type": "delete",
            "line": "scp_v1s_mng_accept(struct SCP_CONNECTION *c, struct SCP_SESSION **s)"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Reads a uint8 followed by a string into a buffer"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Buffer is null-terminated on success"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @param s Input stream"
          },
          {
            "type": "add",
            "line": " * @param [out] Output buffer (must be >= 256 chars)"
          },
          {
            "type": "add",
            "line": " * @param param Parameter we're reading"
          },
          {
            "type": "add",
            "line": " * @param line Line number reference"
          },
          {
            "type": "add",
            "line": " * @return != 0 if string read OK"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @todo"
          },
          {
            "type": "add",
            "line": " *     This needs to be merged with the func of the same name in"
          },
          {
            "type": "add",
            "line": " *     libscp_v1s.c"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static"
          },
          {
            "type": "add",
            "line": "int in_string8(struct stream *s, char str[], const char *param, int line)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    int result;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(s, 1))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s_mng:%d] connection aborted: %s len missing\","
          },
          {
            "type": "add",
            "line": "                    line, param);"
          },
          {
            "type": "add",
            "line": "        result = 0;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    else"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        unsigned int sz;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        in_uint8(s, sz);"
          },
          {
            "type": "add",
            "line": "        result = s_check_rem(s, sz);"
          },
          {
            "type": "add",
            "line": "        if (!result)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v1s_mng:%d] connection aborted: %s data missing\","
          },
          {
            "type": "add",
            "line": "                        line, param);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        else"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            in_uint8a(s, str, sz);"
          },
          {
            "type": "add",
            "line": "            str[sz] = '\\0';"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    return result;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Initialises a V1 management session object"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * At call time, the command set value has been read from the wire, and"
          },
          {
            "type": "add",
            "line": " * the command still needs to be processed."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * @param c Connection"
          },
          {
            "type": "add",
            "line": " * @param [out] session pre-allocated session object"
          },
          {
            "type": "add",
            "line": " * @return SCP_SERVER_STATE_START_MANAGE for success"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "static enum SCP_SERVER_STATES_E"
          },
          {
            "type": "add",
            "line": "scp_v1s_mng_init_session(struct SCP_CONNECTION *c, struct SCP_SESSION *session)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    struct SCP_SESSION *session;"
          },
          {
            "type": "context",
            "line": "     tui32 ipaddr;"
          },
          {
            "type": "context",
            "line": "     tui16 cmd;"
          },
          {
            "type": "context",
            "line": "     tui8 sz;"
          },
          {
            "type": "delete",
            "line": "    char buf[257];"
          },
          {
            "type": "add",
            "line": "    char buf[256];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    scp_session_set_version(session, 1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* reading command */"
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(c->in_s, 2))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        /* Caller should have checked this */"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, cmd);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (cmd != 1) /* manager login */"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_SEQUENCE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    session = scp_session_create();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (0 == session)"
          },
          {
            "type": "add",
            "line": "    /* reading username */"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"username\", __LINE__))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    scp_session_set_version(session, 1);"
          },
          {
            "type": "delete",
            "line": "    scp_session_set_type(session, SCP_SESSION_TYPE_MANAGE);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* reading username */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_session_set_username(session, buf))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* reading password */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"passwd\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_session_set_password(session, buf))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* reading remote address */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "add",
            "line": "    /* reading remote address"
          },
          {
            "type": "add",
            "line": "     * Check there's enough data left for at least an IPv4 address (+len) */"
          },
          {
            "type": "add",
            "line": "    if (!s_check_rem(c->in_s, 1 + 4))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                    \"[v1s_mng:%d] connection aborted: IP addr len missing\","
          },
          {
            "type": "add",
            "line": "                    __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "context",
            "line": "     if (sz == SCP_ADDRESS_TYPE_IPV4)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         in_uint32_be(c->in_s, ipaddr);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     else if (sz == SCP_ADDRESS_TYPE_IPV6)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "add",
            "line": "        if (!s_check_rem(c->in_s, 16))"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"[v1s_mng:%d] connection aborted: IP addr missing\","
          },
          {
            "type": "add",
            "line": "                        __LINE__);"
          },
          {
            "type": "add",
            "line": "            return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         in_uint8a(c->in_s, buf, 16);"
          },
          {
            "type": "context",
            "line": "         scp_session_set_addr(session, sz, buf);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* reading hostname */"
          },
          {
            "type": "delete",
            "line": "    in_uint8(c->in_s, sz);"
          },
          {
            "type": "delete",
            "line": "    buf[sz] = '\\0';"
          },
          {
            "type": "delete",
            "line": "    in_uint8a(c->in_s, buf, sz);"
          },
          {
            "type": "add",
            "line": "    if (!in_string8(c->in_s, buf, \"hostname\", __LINE__))"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (0 != scp_session_set_hostname(session, buf))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        scp_session_destroy(session);"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* returning the struct */"
          },
          {
            "type": "add",
            "line": "    return SCP_SERVER_STATE_START_MANAGE;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "enum SCP_SERVER_STATES_E"
          },
          {
            "type": "add",
            "line": "scp_v1s_mng_accept(struct SCP_CONNECTION *c, struct SCP_SESSION **s)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    enum SCP_SERVER_STATES_E result;"
          },
          {
            "type": "add",
            "line": "    struct SCP_SESSION *session;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    session = scp_session_create();"
          },
          {
            "type": "add",
            "line": "    if (NULL == session)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        result = SCP_SERVER_STATE_INTERNAL_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    else"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        scp_session_set_type(session, SCP_SESSION_TYPE_MANAGE);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        result = scp_v1s_mng_init_session(c, session);"
          },
          {
            "type": "add",
            "line": "        if (result != SCP_SERVER_STATE_START_MANAGE)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            scp_session_destroy(session);"
          },
          {
            "type": "add",
            "line": "            session = NULL;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     (*s) = session;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    return SCP_SERVER_STATE_START_MANAGE;"
          },
          {
            "type": "add",
            "line": "    return result;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* 002 */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint32_be(c->in_s, size);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_stream(c->in_s, c->in_s->size);"
          },
          {
            "type": "add",
            "line": "    /* Check the message is big enough for the header, the command set, and"
          },
          {
            "type": "add",
            "line": "     * the command (but not too big) */"
          },
          {
            "type": "add",
            "line": "    if (size < (8 + 2 + 2) || size > SCP_MAX_MESSAGE_SIZE)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        log_message(LOG_LEVEL_WARNING, \"[v1s_mng:%d] connection aborted: size error\", __LINE__);"
          },
          {
            "type": "add",
            "line": "        return SCP_SERVER_STATE_SIZE_ERR;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    init_stream(c->in_s, size - 8);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /* read the rest of the packet */"
          },
          {
            "type": "context",
            "line": "     if (0 != scp_tcp_force_recv(c->in_sck, c->in_s->data, size - 8))"
          },
          {
            "type": "context",
            "line": "         return SCP_SERVER_STATE_NETWORK_ERR;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    c->in_s->end = c->in_s->data + (size - 8);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     in_uint16_be(c->in_s, cmd);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (cmd != SCP_COMMAND_SET_MANAGE)"
          }
        ]
      },
      {
        "file": "sesman/scp.c",
        "changes": [
          {
            "type": "context",
            "line": "index d548052a..7fa4d2a7 100644"
          },
          {
            "type": "context",
            "line": "--- a/sesman/scp.c"
          },
          {
            "type": "context",
            "line": "+++ b/sesman/scp.c"
          },
          {
            "type": "context",
            "line": "     make_stream(scon.in_s);"
          },
          {
            "type": "context",
            "line": "     make_stream(scon.out_s);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    init_stream(scon.in_s, 8192);"
          },
          {
            "type": "delete",
            "line": "    init_stream(scon.out_s, 8192);"
          },
          {
            "type": "add",
            "line": "    init_stream(scon.in_s, SCP_MAX_MESSAGE_SIZE);"
          },
          {
            "type": "add",
            "line": "    init_stream(scon.out_s, SCP_MAX_MESSAGE_SIZE);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     switch (scp_vXs_accept(&scon, &(sdata)))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "             scp_v1_mng_process(&scon, sdata);"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": "         case SCP_SERVER_STATE_VERSION_ERR:"
          },
          {
            "type": "delete",
            "line": "            /* an unknown scp version was requested, so we shut down the */"
          },
          {
            "type": "delete",
            "line": "            /* connection (and log the fact)                             */"
          },
          {
            "type": "add",
            "line": "        case SCP_SERVER_STATE_SIZE_ERR:"
          },
          {
            "type": "add",
            "line": "            /* an unknown scp version was requested, or the message sizes"
          },
          {
            "type": "add",
            "line": "               are inconsistent. Shut down the connection and log the"
          },
          {
            "type": "add",
            "line": "               fact */"
          },
          {
            "type": "context",
            "line": "             log_message(LOG_LEVEL_WARNING,"
          },
          {
            "type": "delete",
            "line": "                        \"unknown protocol version specified. connection refused.\");"
          },
          {
            "type": "add",
            "line": "                        \"protocol violation. connection refused.\");"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": "         case SCP_SERVER_STATE_NETWORK_ERR:"
          },
          {
            "type": "context",
            "line": "             log_message(LOG_LEVEL_WARNING, \"libscp network error.\");"
          }
        ]
      }
    ]
  },
  {
    "commit": "0c8485f0e4931463c0f7986e1ea84a7d79f10c75",
    "files": [
      {
        "file": "src/undo.c",
        "changes": [
          {
            "type": "context",
            "line": "index ba7c0b83c..5b953795e 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/undo.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/undo.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     int\t\ti;"
          },
          {
            "type": "context",
            "line": "     u_entry_T\t*uep;"
          },
          {
            "type": "delete",
            "line": "    char_u\t**array;"
          },
          {
            "type": "add",
            "line": "    char_u\t**array = NULL;"
          },
          {
            "type": "context",
            "line": "     char_u\t*line;"
          },
          {
            "type": "context",
            "line": "     int\t\tline_len;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     uep->ue_size = undo_read_4c(bi);"
          },
          {
            "type": "context",
            "line": "     if (uep->ue_size > 0)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "\tarray = (char_u **)U_ALLOC_LINE(sizeof(char_u *) * uep->ue_size);"
          },
          {
            "type": "add",
            "line": "\tif (uep->ue_size < LONG_MAX / (int)sizeof(char_u *))"
          },
          {
            "type": "add",
            "line": "\t    array = (char_u **)U_ALLOC_LINE(sizeof(char_u *) * uep->ue_size);"
          },
          {
            "type": "context",
            "line": " \tif (array == NULL)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t    *error = TRUE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tvim_memset(array, 0, sizeof(char_u *) * uep->ue_size);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "delete",
            "line": "    else"
          },
          {
            "type": "delete",
            "line": "\tarray = NULL;"
          },
          {
            "type": "context",
            "line": "     uep->ue_array = array;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     for (i = 0; i < uep->ue_size; ++i)"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index c79020b21..026b82981 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    378,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     377,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "0cd7e9aa397f8ebb3b8481d67dbac8b4863a7f07",
    "files": [
      {
        "file": "lirack/session/cookie.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 75986758..be537a9c 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/rack/session/cookie.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/rack/session/cookie.rb"
          },
          {
            "type": "context",
            "line": "       def digest_match?(data, digest)"
          },
          {
            "type": "context",
            "line": "         return unless data && digest"
          },
          {
            "type": "context",
            "line": "         @secrets.any? do |secret|"
          },
          {
            "type": "delete",
            "line": "          digest == generate_hmac(data, secret)"
          },
          {
            "type": "add",
            "line": "          Rack::Utils.secure_compare(digest, generate_hmac(data, secret))"
          },
          {
            "type": "context",
            "line": "         end"
          },
          {
            "type": "context",
            "line": "       end"
          }
        ]
      }
    ]
  },
  {
    "commit": "0cdfa9e6f0915e3d243e2393bfa8a22e12d553b0",
    "files": [
      {
        "file": "drivers/net/wireless/microchip/wilc1000/cfg80211.c",
        "changes": [
          {
            "type": "context",
            "line": "index c4d5a272ccc0..b545d93c6e37 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/wireless/microchip/wilc1000/cfg80211.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/wireless/microchip/wilc1000/cfg80211.c"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (ch_list_idx) {"
          },
          {
            "type": "delete",
            "line": "\t\tu16 attr_size;"
          },
          {
            "type": "delete",
            "line": "\t\tstruct wilc_ch_list_elem *e;"
          },
          {
            "type": "delete",
            "line": "\t\tint i;"
          },
          {
            "type": "add",
            "line": "\t\tu16 elem_size;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tch_list = (struct wilc_attr_ch_list *)&buf[ch_list_idx];"
          },
          {
            "type": "delete",
            "line": "\t\tattr_size = le16_to_cpu(ch_list->attr_len);"
          },
          {
            "type": "delete",
            "line": "\t\tfor (i = 0; i < attr_size;) {"
          },
          {
            "type": "add",
            "line": "\t\t/* the number of bytes following the final 'elem' member */"
          },
          {
            "type": "add",
            "line": "\t\telem_size = le16_to_cpu(ch_list->attr_len) -"
          },
          {
            "type": "add",
            "line": "\t\t\t(sizeof(*ch_list) - sizeof(struct wilc_attr_entry));"
          },
          {
            "type": "add",
            "line": "\t\tfor (unsigned int i = 0; i < elem_size;) {"
          },
          {
            "type": "add",
            "line": "\t\t\tstruct wilc_ch_list_elem *e;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\te = (struct wilc_ch_list_elem *)(ch_list->elem + i);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\ti += sizeof(*e);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (i > elem_size)"
          },
          {
            "type": "add",
            "line": "\t\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\ti += e->no_of_channels;"
          },
          {
            "type": "add",
            "line": "\t\t\tif (i > elem_size)"
          },
          {
            "type": "add",
            "line": "\t\t\t\tbreak;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tif (e->op_class == WILC_WLAN_OPERATING_CLASS_2_4GHZ) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tmemset(e->ch_list, sta_ch, e->no_of_channels);"
          },
          {
            "type": "context",
            "line": " \t\t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\ti += e->no_of_channels;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "0ce38bd7bce862db251b882613ab7053ca777382",
    "files": [
      {
        "file": "config/locales/server.en.yml",
        "changes": [
          {
            "type": "context",
            "line": "index 8d29f5af5f..6591d85b24 100644"
          },
          {
            "type": "context",
            "line": "--- a/config/locales/server.en.yml"
          },
          {
            "type": "context",
            "line": "+++ b/config/locales/server.en.yml"
          },
          {
            "type": "context",
            "line": "               target_user_not_found: \"One of the users you are sending this message to could not be found.\""
          },
          {
            "type": "context",
            "line": "               unable_to_update: \"There was an error updating that topic.\""
          },
          {
            "type": "context",
            "line": "               unable_to_tag: \"There was an error tagging the topic.\""
          },
          {
            "type": "add",
            "line": "              unable_to_unlist: \"Sorry, you cannot create an unlisted topic.\""
          },
          {
            "type": "context",
            "line": "             featured_link:"
          },
          {
            "type": "context",
            "line": "               invalid: \"is invalid. URL should include http:// or https://.\""
          },
          {
            "type": "context",
            "line": "         user:"
          }
        ]
      },
      {
        "file": "liguardian/topic_guardian.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 66df380baf..c487de6897 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/guardian/topic_guardian.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/guardian/topic_guardian.rb"
          },
          {
            "type": "context",
            "line": "     can_moderate?(topic) || can_perform_action_available_to_group_moderators?(topic)"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  alias :can_create_unlisted_topic? :can_toggle_topic_visibility?"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def can_convert_topic?(topic)"
          },
          {
            "type": "context",
            "line": "     return false unless @user.in_any_groups?(SiteSetting.personal_message_enabled_groups_map)"
          },
          {
            "type": "context",
            "line": "     return false if topic.blank?"
          }
        ]
      },
      {
        "file": "litopic_creator.rb",
        "changes": [
          {
            "type": "context",
            "line": "index ca98d6a71a..12ae6114a0 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/topic_creator.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/topic_creator.rb"
          },
          {
            "type": "context",
            "line": "     # this allows us to add errors"
          },
          {
            "type": "context",
            "line": "     valid = topic.valid?"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    validate_visibility(topic)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     category = find_category"
          },
          {
            "type": "context",
            "line": "     if category.present? && guardian.can_tag?(topic)"
          },
          {
            "type": "context",
            "line": "       tags = @opts[:tags].presence || []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def create"
          },
          {
            "type": "context",
            "line": "     topic = Topic.new(setup_topic_params)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    validate_visibility!(topic)"
          },
          {
            "type": "context",
            "line": "     setup_tags(topic)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if fields = @opts[:custom_fields]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   private"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  def validate_visibility(topic)"
          },
          {
            "type": "add",
            "line": "    if !@opts[:skip_validations] && !topic.visible && !guardian.can_create_unlisted_topic?(topic)"
          },
          {
            "type": "add",
            "line": "      topic.errors.add(:base, :unable_to_unlist)"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": "  end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  def validate_visibility!(topic)"
          },
          {
            "type": "add",
            "line": "    validate_visibility(topic)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    rollback_from_errors!(topic) if topic.errors.full_messages.present?"
          },
          {
            "type": "add",
            "line": "  end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def create_shared_draft(topic)"
          },
          {
            "type": "context",
            "line": "     return if @opts[:shared_draft].blank? || @opts[:shared_draft] == 'false'"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     user"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " end"
          }
        ]
      },
      {
        "file": "spec/liguardian/topic_guardian_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index bfe003457c..e014482120 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/lib/guardian/topic_guardian_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/lib/guardian/topic_guardian_spec.rb"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  describe \"#can_create_unlisted_topic?\" do"
          },
          {
            "type": "add",
            "line": "    it \"returns true for moderators\" do"
          },
          {
            "type": "add",
            "line": "      expect(Guardian.new(moderator).can_create_unlisted_topic?(topic)).to eq(true)"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it \"returns true for TL4 users\" do"
          },
          {
            "type": "add",
            "line": "      tl4_user = Fabricate(:user, trust_level: TrustLevel[4])"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      expect(Guardian.new(tl4_user).can_create_unlisted_topic?(topic)).to eq(true)"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it \"returns false for regular users\" do"
          },
          {
            "type": "add",
            "line": "      expect(Guardian.new(user).can_create_unlisted_topic?(topic)).to eq(false)"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": "  end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   # The test cases here are intentionally kept brief because majority of the cases are already handled by"
          },
          {
            "type": "context",
            "line": "   # `TopicGuardianCanSeeConsistencyCheck` which we run to ensure that the implementation between `TopicGuardian#can_see_topic_ids`"
          },
          {
            "type": "context",
            "line": "   # and `TopicGuardian#can_see_topic?` is consistent."
          }
        ]
      },
      {
        "file": "spec/litopic_creator_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index b1536b8bec..d815a6292a 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/lib/topic_creator_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/lib/topic_creator_spec.rb"
          },
          {
            "type": "context",
            "line": "         expect(topic.external_id).to eq('external_id')"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    context \"when invisible/unlisted\" do"
          },
          {
            "type": "add",
            "line": "      let(:unlisted_attrs) { valid_attrs.merge(visible: false) }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"throws an exception for a non-staff user\" do"
          },
          {
            "type": "add",
            "line": "        expect do"
          },
          {
            "type": "add",
            "line": "          TopicCreator.create(user, Guardian.new(user), unlisted_attrs)"
          },
          {
            "type": "add",
            "line": "        end.to raise_error(ActiveRecord::Rollback)"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"is invalid for a non-staff user\" do"
          },
          {
            "type": "add",
            "line": "        expect(TopicCreator.new(user, Guardian.new(user), unlisted_attrs).valid?).to eq(false)"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"creates unlisted topic for an admin\" do"
          },
          {
            "type": "add",
            "line": "        expect(TopicCreator.create(admin, Guardian.new(admin), unlisted_attrs)).to be_valid"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"is valid for an admin\" do"
          },
          {
            "type": "add",
            "line": "        expect(TopicCreator.new(admin, Guardian.new(admin), unlisted_attrs).valid?).to eq(true)"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": " end"
          }
        ]
      },
      {
        "file": "spec/requests/posts_controller_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index a7ffbdb8be..c2bc918151 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/requests/posts_controller_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/requests/posts_controller_spec.rb"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         expect(response.status).to eq(422)"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"creates unlisted topic with admin master key\" do"
          },
          {
            "type": "add",
            "line": "        master_key = Fabricate(:api_key).key"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        expect do"
          },
          {
            "type": "add",
            "line": "          post \"/posts.json\","
          },
          {
            "type": "add",
            "line": "            params: { raw: \"this is a test title\", title: \"this is test body\", unlist_topic: true },"
          },
          {
            "type": "add",
            "line": "            headers: { HTTP_API_USERNAME: admin.username, HTTP_API_KEY: master_key }"
          },
          {
            "type": "add",
            "line": "        end.to change { Topic.count }.by(1)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        expect(response.status).to eq(200)"
          },
          {
            "type": "add",
            "line": "        expect(Topic.find(response.parsed_body[\"topic_id\"]).visible).to eq(false)"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      it \"prevents creation of unlisted topic with non-admin key\" do"
          },
          {
            "type": "add",
            "line": "        user_key = ApiKey.create!(user: user).key"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        expect do"
          },
          {
            "type": "add",
            "line": "          post \"/posts.json\","
          },
          {
            "type": "add",
            "line": "            params: { raw: \"this is a test title\", title: \"this is test body\", unlist_topic: true },"
          },
          {
            "type": "add",
            "line": "            headers: { HTTP_API_USERNAME: user.username, HTTP_API_KEY: user_key }"
          },
          {
            "type": "add",
            "line": "        end.not_to change { Topic.count }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        expect(response.status).to eq(422)"
          },
          {
            "type": "add",
            "line": "        expect(response.parsed_body[\"errors\"]).to include("
          },
          {
            "type": "add",
            "line": "          I18n.t(\"activerecord.errors.models.topic.attributes.base.unable_to_unlist\")"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     describe \"when logged in\" do"
          },
          {
            "type": "context",
            "line": "         expect(topic.title).to eq('This is the test title for the topic')"
          },
          {
            "type": "context",
            "line": "         expect(topic.category).to eq(category)"
          },
          {
            "type": "context",
            "line": "         expect(topic.meta_data).to eq(\"xyz\" => 'abc')"
          },
          {
            "type": "add",
            "line": "        expect(topic.visible).to eq(true)"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       it 'can create an uncategorized topic' do"
          },
          {
            "type": "context",
            "line": "       end"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    context \"with topic unlisting\" do"
          },
          {
            "type": "add",
            "line": "      context \"when logged in as staff\" do"
          },
          {
            "type": "add",
            "line": "        before do"
          },
          {
            "type": "add",
            "line": "          sign_in(admin)"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        it \"creates an unlisted topic\" do"
          },
          {
            "type": "add",
            "line": "          expect do"
          },
          {
            "type": "add",
            "line": "            post \"/posts.json\", params: {"
          },
          {
            "type": "add",
            "line": "              raw: \"this is the test content\","
          },
          {
            "type": "add",
            "line": "              title: \"this is the test title for the topic\","
          },
          {
            "type": "add",
            "line": "              unlist_topic: true"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "          end.to change { Topic.count }.by(1)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "          expect(response.status).to eq(200)"
          },
          {
            "type": "add",
            "line": "          expect(Topic.find(response.parsed_body[\"topic_id\"]).visible).to eq(false)"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      context \"when logged in as a non-staff user\" do"
          },
          {
            "type": "add",
            "line": "        before do"
          },
          {
            "type": "add",
            "line": "          sign_in(user)"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        it \"prevents creation of an unlisted topic\" do"
          },
          {
            "type": "add",
            "line": "          expect do"
          },
          {
            "type": "add",
            "line": "            post \"/posts.json\", params: {"
          },
          {
            "type": "add",
            "line": "              raw: \"this is the test content\","
          },
          {
            "type": "add",
            "line": "              title: \"this is the test title for the topic\","
          },
          {
            "type": "add",
            "line": "              unlist_topic: true"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "          end.not_to change { Topic.count }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "          expect(response.status).to eq(422)"
          },
          {
            "type": "add",
            "line": "          expect(response.parsed_body[\"errors\"]).to include("
          },
          {
            "type": "add",
            "line": "            I18n.t(\"activerecord.errors.models.topic.attributes.base.unable_to_unlist\")"
          },
          {
            "type": "add",
            "line": "          )"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": "      end"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     describe 'shared draft' do"
          },
          {
            "type": "context",
            "line": "       fab!(:destination_category) { Fabricate(:category) }"
          }
        ]
      }
    ]
  },
  {
    "commit": "0d0138ebe24b94065580bd2601f8bb7eb6152f56",
    "files": [
      {
        "file": "arch/xtensa/kernel/ptrace.c",
        "changes": [
          {
            "type": "context",
            "line": "index c72c9473ef99..a0d042aa2967 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/xtensa/kernel/ptrace.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/xtensa/kernel/ptrace.c"
          },
          {
            "type": "context",
            "line": " \telf_xtregs_t *xtregs = uregs;"
          },
          {
            "type": "context",
            "line": " \tint ret = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (!access_ok(VERIFY_READ, uregs, sizeof(elf_xtregs_t)))"
          },
          {
            "type": "add",
            "line": "\t\treturn -EFAULT;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " #if XTENSA_HAVE_COPROCESSORS"
          },
          {
            "type": "context",
            "line": " \t/* Flush all coprocessors before we overwrite them. */"
          },
          {
            "type": "context",
            "line": " \tcoprocessor_flush_all(ti);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0d0e57697f162da4aa218b5feafe614fb666db07",
    "files": [
      {
        "file": "kernel/bpf/verifier.c",
        "changes": [
          {
            "type": "context",
            "line": "index c2ff608c1984..c5b56c92f8e2 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/bpf/verifier.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/bpf/verifier.c"
          },
          {
            "type": "context",
            "line": " \t[BPF_EXIT >> 4] = \"exit\","
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void print_bpf_insn(struct bpf_insn *insn)"
          },
          {
            "type": "add",
            "line": "static void print_bpf_insn(const struct bpf_verifier_env *env,"
          },
          {
            "type": "add",
            "line": "\t\t\t   const struct bpf_insn *insn)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tu8 class = BPF_CLASS(insn->code);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t\tinsn->code,"
          },
          {
            "type": "context",
            "line": " \t\t\t\tbpf_ldst_string[BPF_SIZE(insn->code) >> 3],"
          },
          {
            "type": "context",
            "line": " \t\t\t\tinsn->src_reg, insn->imm);"
          },
          {
            "type": "delete",
            "line": "\t\t} else if (BPF_MODE(insn->code) == BPF_IMM) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tverbose(\"(%02x) r%d = 0x%x\\n\","
          },
          {
            "type": "delete",
            "line": "\t\t\t\tinsn->code, insn->dst_reg, insn->imm);"
          },
          {
            "type": "add",
            "line": "\t\t} else if (BPF_MODE(insn->code) == BPF_IMM &&"
          },
          {
            "type": "add",
            "line": "\t\t\t   BPF_SIZE(insn->code) == BPF_DW) {"
          },
          {
            "type": "add",
            "line": "\t\t\t/* At this point, we already made sure that the second"
          },
          {
            "type": "add",
            "line": "\t\t\t * part of the ldimm64 insn is accessible."
          },
          {
            "type": "add",
            "line": "\t\t\t */"
          },
          {
            "type": "add",
            "line": "\t\t\tu64 imm = ((u64)(insn + 1)->imm << 32) | (u32)insn->imm;"
          },
          {
            "type": "add",
            "line": "\t\t\tbool map_ptr = insn->src_reg == BPF_PSEUDO_MAP_FD;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tif (map_ptr && !env->allow_ptr_leaks)"
          },
          {
            "type": "add",
            "line": "\t\t\t\timm = 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tverbose(\"(%02x) r%d = 0x%llx\\n\", insn->code,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tinsn->dst_reg, (unsigned long long)imm);"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\tverbose(\"BUG_ld_%02x\\n\", insn->code);"
          },
          {
            "type": "context",
            "line": " \t\t\treturn;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (log_level) {"
          },
          {
            "type": "context",
            "line": " \t\t\tverbose(\"%d: \", insn_idx);"
          },
          {
            "type": "delete",
            "line": "\t\t\tprint_bpf_insn(insn);"
          },
          {
            "type": "add",
            "line": "\t\t\tprint_bpf_insn(env, insn);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\terr = ext_analyzer_insn_hook(env, insn_idx, prev_insn_idx);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0d547181389f7941e53291af940966413823f61c",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java",
        "changes": [
          {
            "type": "context",
            "line": "index 9679fadb328..e77575b2680 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private static final String TM_FAILEDDOCUMENTPARSE = \"core.document.error.failedParse\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private static final String CLOSE_HTML_MACRO = \"{{/html}}\";"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * An attachment waiting to be deleted at next document save."
          },
          {
            "type": "context",
            "line": "      *"
          },
          {
            "type": "context",
            "line": "             // We test if we're inside the rendering engine since it's also possible that this display() method is"
          },
          {
            "type": "context",
            "line": "             // called directly from a template and in this case we only want HTML as a result and not wiki syntax."
          },
          {
            "type": "context",
            "line": "             // TODO: find a more generic way to handle html macro because this works only for XWiki 1.0 and XWiki 2.0"
          },
          {
            "type": "delete",
            "line": "            // Add the {{html}}{{/html}} only when result really contains html since it's not needed for pure text"
          },
          {
            "type": "delete",
            "line": "            if (isInRenderingEngine && !is10Syntax(wrappingSyntaxId) && HTMLUtils.containsElementText(result)) {"
          },
          {
            "type": "add",
            "line": "            // Add the {{html}}{{/html}} only when result really contains html or { which could be part of an XWiki"
          },
          {
            "type": "add",
            "line": "            // macro syntax since it's not needed for pure text"
          },
          {
            "type": "add",
            "line": "            if (isInRenderingEngine && !is10Syntax(wrappingSyntaxId)"
          },
          {
            "type": "add",
            "line": "                && (HTMLUtils.containsElementText(result) || result.indexOf(\"{\") != -1))"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "context",
            "line": "                 result.insert(0, \"{{html clean=\\\"false\\\" wiki=\\\"false\\\"}}\");"
          },
          {
            "type": "delete",
            "line": "                result.append(\"{{/html}}\");"
          },
          {
            "type": "add",
            "line": "                // Escape closing HTML macro syntax."
          },
          {
            "type": "add",
            "line": "                int startIndex = 0;"
          },
          {
            "type": "add",
            "line": "                // Start searching at the last match to avoid scanning the whole string again."
          },
          {
            "type": "add",
            "line": "                while ((startIndex = result.indexOf(CLOSE_HTML_MACRO, startIndex)) != -1) {"
          },
          {
            "type": "add",
            "line": "                    result.replace(startIndex, startIndex + 2, \"&#123;&#123;\");"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                result.append(CLOSE_HTML_MACRO);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             return result.toString();"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 4d0c6aae410..0b6c405903c 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentTest.java"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.api.DocumentSection;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.objects.BaseObject;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.objects.classes.BaseClass;"
          },
          {
            "type": "add",
            "line": "import com.xpn.xwiki.objects.classes.PropertyClass;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.objects.classes.TextAreaClass;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.store.XWikiStoreInterface;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.store.XWikiVersioningStoreInterface;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertSame;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.any;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.ArgumentMatchers.anyBoolean;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.anyInt;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.anyString;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.argThat;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.eq;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.Mockito.doAnswer;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.doReturn;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.mock;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.verify;"
          },
          {
            "type": "context",
            "line": "         assertEquals(\"<p>area</p>\", this.document.display(\"area\", \"view\", this.oldcore.getXWikiContext()));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void displayEscapesClosingHTMLMacro()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        this.oldcore.getXWikiContext().put(\"isInRenderingEngine\", true);"
          },
          {
            "type": "add",
            "line": "        when(this.xWiki.getCurrentContentSyntaxId(any())).thenReturn(\"xwiki/2.1\");"
          },
          {
            "type": "add",
            "line": "        this.document.setSyntax(Syntax.XWIKI_2_0);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        BaseObject object = mock(BaseObject.class);"
          },
          {
            "type": "add",
            "line": "        when(object.getOwnerDocument()).thenReturn(this.document);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        BaseClass xClass = mock(BaseClass.class);"
          },
          {
            "type": "add",
            "line": "        when(object.getXClass(any())).thenReturn(xClass);"
          },
          {
            "type": "add",
            "line": "        PropertyClass propertyInterface = mock(PropertyClass.class);"
          },
          {
            "type": "add",
            "line": "        when(xClass.get(\"mock\")).thenReturn(propertyInterface);"
          },
          {
            "type": "add",
            "line": "        doAnswer(call -> {"
          },
          {
            "type": "add",
            "line": "            call.getArgument(0, StringBuffer.class).append(\"{{/html}}content{{/html}}\");"
          },
          {
            "type": "add",
            "line": "            return null;"
          },
          {
            "type": "add",
            "line": "        }).when(propertyInterface).displayView(any(StringBuffer.class), eq(\"mock\"), any(String.class), eq(object),"
          },
          {
            "type": "add",
            "line": "            anyBoolean(), any(XWikiContext.class));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(\"{{html clean=\\\"false\\\" wiki=\\\"false\\\"}}&#123;&#123;/html}}content&#123;&#123;/html}}{{/html}}\","
          },
          {
            "type": "add",
            "line": "            this.document.display(\"mock\", \"view\", object, this.oldcore.getXWikiContext()));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Test"
          },
          {
            "type": "context",
            "line": "     public void convertSyntax() throws XWikiException"
          },
          {
            "type": "context",
            "line": "     {"
          }
        ]
      }
    ]
  },
  {
    "commit": "0d62e9dd6da45bbf0f33a8617afc5fe774c8f45f",
    "files": [
      {
        "file": "liasn1_decoder.c",
        "changes": [
          {
            "type": "context",
            "line": "index 55980d7e1ac0..3f74dd3e2910 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/asn1_decoder.c"
          },
          {
            "type": "context",
            "line": "+++ b/lib/asn1_decoder.c"
          },
          {
            "type": "context",
            "line": " \t\tunsigned char tmp;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/* Skip conditional matches if possible */"
          },
          {
            "type": "delete",
            "line": "\t\tif ((op & ASN1_OP_MATCH__COND &&"
          },
          {
            "type": "delete",
            "line": "\t\t     flags & FLAG_MATCHED) ||"
          },
          {
            "type": "delete",
            "line": "\t\t    dp == datalen) {"
          },
          {
            "type": "add",
            "line": "\t\tif ((op & ASN1_OP_MATCH__COND && flags & FLAG_MATCHED) ||"
          },
          {
            "type": "add",
            "line": "\t\t    (op & ASN1_OP_MATCH__SKIP && dp == datalen)) {"
          },
          {
            "type": "context",
            "line": " \t\t\tflags &= ~FLAG_LAST_MATCHED;"
          },
          {
            "type": "context",
            "line": " \t\t\tpc += asn1_op_lengths[op];"
          },
          {
            "type": "context",
            "line": " \t\t\tgoto next_op;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0da9dfdd2cd9889201bc6f6f43580c99165cd087",
    "files": [
      {
        "file": "security/keys/process_keys.c",
        "changes": [
          {
            "type": "context",
            "line": "index a571fad91010..42defae1e161 100644"
          },
          {
            "type": "context",
            "line": "--- a/security/keys/process_keys.c"
          },
          {
            "type": "context",
            "line": "+++ b/security/keys/process_keys.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tkenter(\"%p{%u}\", user, uid);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (user->uid_keyring) {"
          },
          {
            "type": "add",
            "line": "\tif (user->uid_keyring && user->session_keyring) {"
          },
          {
            "type": "context",
            "line": " \t\tkleave(\" = 0 [exist]\");"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "0ddcff49b672239dda94d70d0fcf50317a9f4b51",
    "files": [
      {
        "file": "drivers/net/wireless/mac80211_hwsim.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6bf063adcbde..66c2ac0397da 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/wireless/mac80211_hwsim.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/wireless/mac80211_hwsim.c"
          },
          {
            "type": "context",
            "line": " \tif (info->attrs[HWSIM_ATTR_REG_CUSTOM_REG]) {"
          },
          {
            "type": "context",
            "line": " \t\tu32 idx = nla_get_u32(info->attrs[HWSIM_ATTR_REG_CUSTOM_REG]);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (idx >= ARRAY_SIZE(hwsim_world_regdom_custom))"
          },
          {
            "type": "add",
            "line": "\t\tif (idx >= ARRAY_SIZE(hwsim_world_regdom_custom)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tkfree(hwname);"
          },
          {
            "type": "context",
            "line": " \t\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\tparam.regd = hwsim_world_regdom_custom[idx];"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e033e04c2678dbbe74a46b23fffb7bb918c288e",
    "files": [
      {
        "file": "net/ipv6/udp_offload.c",
        "changes": [
          {
            "type": "context",
            "line": "index 08e23b0bf302..e7359f9eaa8d 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/ipv6/udp_offload.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/ipv6/udp_offload.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/* Check if there is enough headroom to insert fragment header. */"
          },
          {
            "type": "context",
            "line": " \t\ttnl_hlen = skb_tnl_header_len(skb);"
          },
          {
            "type": "delete",
            "line": "\t\tif (skb_headroom(skb) < (tnl_hlen + frag_hdr_sz)) {"
          },
          {
            "type": "add",
            "line": "\t\tif (skb->mac_header < (tnl_hlen + frag_hdr_sz)) {"
          },
          {
            "type": "context",
            "line": " \t\t\tif (gso_pskb_expand_head(skb, tnl_hlen + frag_hdr_sz))"
          },
          {
            "type": "context",
            "line": " \t\t\t\tgoto out;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e1c106d7cd0703125528a691088e42e17c99929",
    "files": [
      {
        "file": "airflow/cli/cli_config.py",
        "changes": [
          {
            "type": "context",
            "line": "index fadf988a4a..e8e096ee6f 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/cli/cli_config.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/cli/cli_config.py"
          },
          {
            "type": "context",
            "line": "     help=\"Export all variables to JSON file\","
          },
          {
            "type": "context",
            "line": "     type=argparse.FileType(\"w\", encoding=\"UTF-8\"),"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "add",
            "line": "ARG_VAR_ACTION_ON_EXISTING_KEY = Arg("
          },
          {
            "type": "add",
            "line": "    (\"-a\", \"--action-on-existing-key\"),"
          },
          {
            "type": "add",
            "line": "    help=\"Action to take if we encounter a variable key that already exists.\","
          },
          {
            "type": "add",
            "line": "    default=\"overwrite\","
          },
          {
            "type": "add",
            "line": "    choices=(\"overwrite\", \"fail\", \"skip\"),"
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # kerberos"
          },
          {
            "type": "context",
            "line": " ARG_PRINCIPAL = Arg((\"principal\",), help=\"kerberos principal\", nargs=\"?\")"
          },
          {
            "type": "context",
            "line": "         name=\"import\","
          },
          {
            "type": "context",
            "line": "         help=\"Import variables\","
          },
          {
            "type": "context",
            "line": "         func=lazy_load_command(\"airflow.cli.commands.variable_command.variables_import\"),"
          },
          {
            "type": "delete",
            "line": "        args=(ARG_VAR_IMPORT, ARG_VERBOSE),"
          },
          {
            "type": "add",
            "line": "        args=(ARG_VAR_IMPORT, ARG_VAR_ACTION_ON_EXISTING_KEY, ARG_VERBOSE),"
          },
          {
            "type": "context",
            "line": "     ),"
          },
          {
            "type": "context",
            "line": "     ActionCommand("
          },
          {
            "type": "context",
            "line": "         name=\"export\","
          }
        ]
      },
      {
        "file": "airflow/cli/commands/variable_command.py",
        "changes": [
          {
            "type": "context",
            "line": "index db0e92de28..bc09d0208d 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/cli/commands/variable_command.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/cli/commands/variable_command.py"
          },
          {
            "type": "context",
            "line": " from airflow.utils import cli as cli_utils"
          },
          {
            "type": "context",
            "line": " from airflow.utils.cli import suppress_logs_and_warning"
          },
          {
            "type": "context",
            "line": " from airflow.utils.providers_configuration_loader import providers_configuration_loaded"
          },
          {
            "type": "delete",
            "line": "from airflow.utils.session import create_session"
          },
          {
            "type": "add",
            "line": "from airflow.utils.session import create_session, provide_session"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " @suppress_logs_and_warning"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " @cli_utils.action_cli"
          },
          {
            "type": "context",
            "line": " @providers_configuration_loaded"
          },
          {
            "type": "delete",
            "line": "def variables_import(args):"
          },
          {
            "type": "add",
            "line": "@provide_session"
          },
          {
            "type": "add",
            "line": "def variables_import(args, session):"
          },
          {
            "type": "context",
            "line": "     \"\"\"Import variables from a given file.\"\"\""
          },
          {
            "type": "context",
            "line": "     if not os.path.exists(args.file):"
          },
          {
            "type": "context",
            "line": "         raise SystemExit(\"Missing variables file.\")"
          },
          {
            "type": "context",
            "line": "         except JSONDecodeError:"
          },
          {
            "type": "context",
            "line": "             raise SystemExit(\"Invalid variables file.\")"
          },
          {
            "type": "context",
            "line": "     suc_count = fail_count = 0"
          },
          {
            "type": "add",
            "line": "    skipped = set()"
          },
          {
            "type": "add",
            "line": "    action_on_existing = args.action_on_existing_key"
          },
          {
            "type": "add",
            "line": "    existing_keys = set()"
          },
          {
            "type": "add",
            "line": "    if action_on_existing != \"overwrite\":"
          },
          {
            "type": "add",
            "line": "        existing_keys = set(session.scalars(select(Variable.key).where(Variable.key.in_(var_json))))"
          },
          {
            "type": "add",
            "line": "    if action_on_existing == \"fail\" and existing_keys:"
          },
          {
            "type": "add",
            "line": "        raise SystemExit(f\"Failed. These keys: {sorted(existing_keys)} already exists.\")"
          },
          {
            "type": "context",
            "line": "     for k, v in var_json.items():"
          },
          {
            "type": "add",
            "line": "        if action_on_existing == \"skip\" and k in existing_keys:"
          },
          {
            "type": "add",
            "line": "            skipped.add(k)"
          },
          {
            "type": "add",
            "line": "            continue"
          },
          {
            "type": "context",
            "line": "         try:"
          },
          {
            "type": "context",
            "line": "             Variable.set(k, v, serialize_json=not isinstance(v, str))"
          },
          {
            "type": "context",
            "line": "         except Exception as e:"
          },
          {
            "type": "context",
            "line": "     print(f\"{suc_count} of {len(var_json)} variables successfully updated.\")"
          },
          {
            "type": "context",
            "line": "     if fail_count:"
          },
          {
            "type": "context",
            "line": "         print(f\"{fail_count} variable(s) failed to be updated.\")"
          },
          {
            "type": "add",
            "line": "    if skipped:"
          },
          {
            "type": "add",
            "line": "        print("
          },
          {
            "type": "add",
            "line": "            f\"The variables with these keys: {list(sorted(skipped))} \""
          },
          {
            "type": "add",
            "line": "            f\"were skipped because they already exists\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " @providers_configuration_loaded"
          }
        ]
      },
      {
        "file": "airflow/www/templates/airflow/variable_list.html",
        "changes": [
          {
            "type": "context",
            "line": "index fe2b4182fc..bd2171bdc1 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/www/templates/airflow/variable_list.html"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/www/templates/airflow/variable_list.html"
          },
          {
            "type": "context",
            "line": "       <div class=\"form-group\">"
          },
          {
            "type": "context",
            "line": "         <input class=\"form-control-file\" type=\"file\" name=\"file\">"
          },
          {
            "type": "context",
            "line": "       </div>"
          },
          {
            "type": "add",
            "line": "      <div class=\"form-group form-check\">"
          },
          {
            "type": "add",
            "line": "         <input type=\"radio\" class=\"form-check-input\" name=\"action_if_exists\" value=\"overwrite\" checked/>"
          },
          {
            "type": "add",
            "line": "          <label class=\"form-check-label\">Overwrite if exists</label>"
          },
          {
            "type": "add",
            "line": "      </div>"
          },
          {
            "type": "add",
            "line": "      <div class=\"form-group form-check\">"
          },
          {
            "type": "add",
            "line": "         <input type=\"radio\" class=\"form-check-input\" name=\"action_if_exists\" value=\"fail\"/>"
          },
          {
            "type": "add",
            "line": "          <label class=\"form-check-label\">Fail if exists</label>"
          },
          {
            "type": "add",
            "line": "      </div>"
          },
          {
            "type": "add",
            "line": "      <div class=\"form-group form-check\">"
          },
          {
            "type": "add",
            "line": "         <input type=\"radio\" class=\"form-check-input\" name=\"action_if_exists\" value=\"skip\" />"
          },
          {
            "type": "add",
            "line": "          <label class=\"form-check-label\">Skip if exists</label>"
          },
          {
            "type": "add",
            "line": "      </div>"
          },
          {
            "type": "context",
            "line": "       <button type=\"submit\" class=\"btn\">"
          },
          {
            "type": "context",
            "line": "         <span class=\"material-icons\">cloud_upload</span>"
          },
          {
            "type": "context",
            "line": "         Import Variables"
          }
        ]
      },
      {
        "file": "airflow/www/views.py",
        "changes": [
          {
            "type": "context",
            "line": "index d3ecae5044..6b11e99b72 100644"
          },
          {
            "type": "context",
            "line": "--- a/airflow/www/views.py"
          },
          {
            "type": "context",
            "line": "+++ b/airflow/www/views.py"
          },
          {
            "type": "context",
            "line": "     @expose(\"/varimport\", methods=[\"POST\"])"
          },
          {
            "type": "context",
            "line": "     @auth.has_access([(permissions.ACTION_CAN_CREATE, permissions.RESOURCE_VARIABLE)])"
          },
          {
            "type": "context",
            "line": "     @action_logging(event=f\"{permissions.RESOURCE_VARIABLE.lower()}.varimport\")"
          },
          {
            "type": "delete",
            "line": "    def varimport(self):"
          },
          {
            "type": "add",
            "line": "    @provide_session"
          },
          {
            "type": "add",
            "line": "    def varimport(self, session):"
          },
          {
            "type": "context",
            "line": "         \"\"\"Import variables.\"\"\""
          },
          {
            "type": "context",
            "line": "         try:"
          },
          {
            "type": "context",
            "line": "             variable_dict = json.loads(request.files[\"file\"].read())"
          },
          {
            "type": "add",
            "line": "            action_on_existing = request.form.get(\"action_if_exists\", \"overwrite\").lower()"
          },
          {
            "type": "context",
            "line": "         except Exception:"
          },
          {
            "type": "context",
            "line": "             self.update_redirect()"
          },
          {
            "type": "context",
            "line": "             flash(\"Missing file or syntax error.\", \"error\")"
          },
          {
            "type": "context",
            "line": "             return redirect(self.get_redirect())"
          },
          {
            "type": "context",
            "line": "         else:"
          },
          {
            "type": "add",
            "line": "            existing_keys = set()"
          },
          {
            "type": "add",
            "line": "            if action_on_existing != \"overwrite\":"
          },
          {
            "type": "add",
            "line": "                existing_keys = set("
          },
          {
            "type": "add",
            "line": "                    session.scalars(select(models.Variable.key).where(models.Variable.key.in_(variable_dict)))"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            if action_on_existing == \"fail\" and existing_keys:"
          },
          {
            "type": "add",
            "line": "                failed_repr = \", \".join(repr(k) for k in sorted(existing_keys))"
          },
          {
            "type": "add",
            "line": "                flash(f\"Failed. The variables with these keys: {failed_repr}  already exists.\")"
          },
          {
            "type": "add",
            "line": "                logging.error(f\"Failed. The variables with these keys: {failed_repr}  already exists.\")"
          },
          {
            "type": "add",
            "line": "                return redirect(location=request.referrer)"
          },
          {
            "type": "add",
            "line": "            skipped = set()"
          },
          {
            "type": "context",
            "line": "             suc_count = fail_count = 0"
          },
          {
            "type": "context",
            "line": "             for k, v in variable_dict.items():"
          },
          {
            "type": "add",
            "line": "                if action_on_existing == \"skip\" and k in existing_keys:"
          },
          {
            "type": "add",
            "line": "                    logging.warning(\"Variable: %s already exists, skipping.\", k)"
          },
          {
            "type": "add",
            "line": "                    skipped.add(k)"
          },
          {
            "type": "add",
            "line": "                    continue"
          },
          {
            "type": "context",
            "line": "                 try:"
          },
          {
            "type": "context",
            "line": "                     models.Variable.set(k, v, serialize_json=not isinstance(v, str))"
          },
          {
            "type": "context",
            "line": "                 except Exception as exc:"
          },
          {
            "type": "context",
            "line": "             flash(f\"{suc_count} variable(s) successfully updated.\")"
          },
          {
            "type": "context",
            "line": "             if fail_count:"
          },
          {
            "type": "context",
            "line": "                 flash(f\"{fail_count} variable(s) failed to be updated.\", \"error\")"
          },
          {
            "type": "add",
            "line": "            if skipped:"
          },
          {
            "type": "add",
            "line": "                skipped_repr = \", \".join(repr(k) for k in sorted(skipped))"
          },
          {
            "type": "add",
            "line": "                flash("
          },
          {
            "type": "add",
            "line": "                    f\"The variables with these keys: {skipped_repr} were skipped \""
          },
          {
            "type": "add",
            "line": "                    \"because they already exists\","
          },
          {
            "type": "add",
            "line": "                    \"warning\","
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "context",
            "line": "             self.update_redirect()"
          },
          {
            "type": "context",
            "line": "             return redirect(self.get_redirect())"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "tests/cli/commands/test_variable_command.py",
        "changes": [
          {
            "type": "context",
            "line": "index b07cfbba8c..93f0fab156 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/cli/commands/test_variable_command.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/cli/commands/test_variable_command.py"
          },
          {
            "type": "context",
            "line": "         assert Variable.get(\"false\", deserialize_json=True) is False"
          },
          {
            "type": "context",
            "line": "         assert Variable.get(\"null\", deserialize_json=True) is None"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # test variable import skip existing"
          },
          {
            "type": "add",
            "line": "        # set varliable list to [\"airflow\"] and have it skip during import"
          },
          {
            "type": "add",
            "line": "        variable_command.variables_set(self.parser.parse_args([\"variables\", \"set\", \"list\", '[\"airflow\"]']))"
          },
          {
            "type": "add",
            "line": "        variable_command.variables_import("
          },
          {
            "type": "add",
            "line": "            self.parser.parse_args("
          },
          {
            "type": "add",
            "line": "                [\"variables\", \"import\", \"variables_types.json\", \"--action-on-existing-key\", \"skip\"]"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        assert [\"airflow\"] == Variable.get(\"list\", deserialize_json=True)  # should not be overwritten"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # test variable import fails on existing when action is set to fail"
          },
          {
            "type": "add",
            "line": "        with pytest.raises(SystemExit):"
          },
          {
            "type": "add",
            "line": "            variable_command.variables_import("
          },
          {
            "type": "add",
            "line": "                self.parser.parse_args("
          },
          {
            "type": "add",
            "line": "                    [\"variables\", \"import\", \"variables_types.json\", \"--action-on-existing-key\", \"fail\"]"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         os.remove(\"variables_types.json\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_variables_list(self):"
          }
        ]
      },
      {
        "file": "tests/www/views/test_views_variable.py",
        "changes": [
          {
            "type": "context",
            "line": "index aca8e2aeee..22ee898c9a 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/www/views/test_views_variable.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/www/views/test_views_variable.py"
          },
          {
            "type": "context",
            "line": "     _check_last_log(session, dag_id=None, event=\"variables.varimport\", execution_date=None)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_import_variables_override_existing_variables_if_set(session, admin_client, caplog):"
          },
          {
            "type": "add",
            "line": "    assert session.query(Variable).count() == 0"
          },
          {
            "type": "add",
            "line": "    Variable.set(\"str_key\", \"str_value\")"
          },
          {
            "type": "add",
            "line": "    content = '{\"str_key\": \"str_value\", \"int_key\": 60}'  # str_key already exists"
          },
          {
            "type": "add",
            "line": "    bytes_content = io.BytesIO(bytes(content, encoding=\"utf-8\"))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    resp = admin_client.post("
          },
          {
            "type": "add",
            "line": "        \"/variable/varimport\","
          },
          {
            "type": "add",
            "line": "        data={\"file\": (bytes_content, \"test.json\"), \"action_if_exist\": \"overwrite\"},"
          },
          {
            "type": "add",
            "line": "        follow_redirects=True,"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    check_content_in_response(\"2 variable(s) successfully updated.\", resp)"
          },
          {
            "type": "add",
            "line": "    _check_last_log(session, dag_id=None, event=\"variables.varimport\", execution_date=None)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_import_variables_skips_update_if_set(session, admin_client, caplog):"
          },
          {
            "type": "add",
            "line": "    assert session.query(Variable).count() == 0"
          },
          {
            "type": "add",
            "line": "    Variable.set(\"str_key\", \"str_value\")"
          },
          {
            "type": "add",
            "line": "    content = '{\"str_key\": \"str_value\", \"int_key\": 60}'  # str_key already exists"
          },
          {
            "type": "add",
            "line": "    bytes_content = io.BytesIO(bytes(content, encoding=\"utf-8\"))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    resp = admin_client.post("
          },
          {
            "type": "add",
            "line": "        \"/variable/varimport\","
          },
          {
            "type": "add",
            "line": "        data={\"file\": (bytes_content, \"test.json\"), \"action_if_exists\": \"skip\"},"
          },
          {
            "type": "add",
            "line": "        follow_redirects=True,"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    check_content_in_response(\"1 variable(s) successfully updated.\", resp)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    check_content_in_response("
          },
          {
            "type": "add",
            "line": "        \"The variables with these keys: &#39;str_key&#39; were skipped because they already exists\", resp"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    _check_last_log(session, dag_id=None, event=\"variables.varimport\", execution_date=None)"
          },
          {
            "type": "add",
            "line": "    assert \"Variable: str_key already exists, skipping.\" in caplog.text"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_import_variables_fails_if_action_if_exists_is_fail(session, admin_client, caplog):"
          },
          {
            "type": "add",
            "line": "    assert session.query(Variable).count() == 0"
          },
          {
            "type": "add",
            "line": "    Variable.set(\"str_key\", \"str_value\")"
          },
          {
            "type": "add",
            "line": "    content = '{\"str_key\": \"str_value\", \"int_key\": 60}'  # str_key already exists"
          },
          {
            "type": "add",
            "line": "    bytes_content = io.BytesIO(bytes(content, encoding=\"utf-8\"))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    admin_client.post("
          },
          {
            "type": "add",
            "line": "        \"/variable/varimport\","
          },
          {
            "type": "add",
            "line": "        data={\"file\": (bytes_content, \"test.json\"), \"action_if_exists\": \"fail\"},"
          },
          {
            "type": "add",
            "line": "        follow_redirects=True,"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    assert \"Failed. The variables with these keys: 'str_key'  already exists.\" in caplog.text"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def test_import_variables_anon(session, app):"
          },
          {
            "type": "context",
            "line": "     assert session.query(Variable).count() == 0"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e37a39502439ecbaa1a5b5188387c01bf7f7fa1",
    "files": [
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/DeserializationFeature.java",
        "changes": [
          {
            "type": "context",
            "line": "index 4dc97e3f3..8ced4b67b 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/DeserializationFeature.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/DeserializationFeature.java"
          },
          {
            "type": "context",
            "line": "      * Feature is disabled by default."
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     ACCEPT_SINGLE_VALUE_AS_ARRAY(false),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * Feature that determines whether it is acceptable to coerce single value array (in JSON)"
          },
          {
            "type": "add",
            "line": "     * values to the corresponding value type.  This is basically the opposite of the {@link #ACCEPT_SINGLE_VALUE_AS_ARRAY}"
          },
          {
            "type": "add",
            "line": "     * feature.  If more than one value is found in the array, a JsonMappingException is thrown."
          },
          {
            "type": "add",
            "line": "     * <p>"
          },
          {
            "type": "add",
            "line": "     * Feature is disabled by default"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    UNWRAP_SINGLE_VALUE_ARRAYS(false),"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * Feature to allow \"unwrapping\" root-level JSON value, to match setting of"
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/DateDeserializers.java",
        "changes": [
          {
            "type": "context",
            "line": "index a1e4b46fd..b5d182f14 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/DateDeserializers.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/DateDeserializers.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.BeanProperty;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.DeserializationContext;"
          },
          {
            "type": "add",
            "line": "import com.fasterxml.jackson.databind.DeserializationFeature;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.JsonDeserializer;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.JsonMappingException;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.annotation.JacksonStdImpl;"
          },
          {
            "type": "context",
            "line": "         protected java.util.Date _parseDate(JsonParser jp, DeserializationContext ctxt)"
          },
          {
            "type": "context",
            "line": "             throws IOException, JsonProcessingException"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "            if (_customFormat != null && jp.getCurrentToken() == JsonToken.VALUE_STRING) {"
          },
          {
            "type": "delete",
            "line": "                String str = jp.getText().trim();"
          },
          {
            "type": "delete",
            "line": "                if (str.length() == 0) {"
          },
          {
            "type": "delete",
            "line": "                    return (Date) getEmptyValue();"
          },
          {
            "type": "delete",
            "line": "                }"
          },
          {
            "type": "delete",
            "line": "                synchronized (_customFormat) {"
          },
          {
            "type": "delete",
            "line": "                    try {"
          },
          {
            "type": "delete",
            "line": "                        return _customFormat.parse(str);"
          },
          {
            "type": "delete",
            "line": "                    } catch (ParseException e) {"
          },
          {
            "type": "delete",
            "line": "                        throw new IllegalArgumentException(\"Failed to parse Date value '\"+str"
          },
          {
            "type": "delete",
            "line": "                                +\"' (format: \\\"\"+_formatString+\"\\\"): \"+e.getMessage());"
          },
          {
            "type": "add",
            "line": "            if (_customFormat != null) {"
          },
          {
            "type": "add",
            "line": "                JsonToken t = jp.getCurrentToken();"
          },
          {
            "type": "add",
            "line": "                if (t == JsonToken.VALUE_STRING) {"
          },
          {
            "type": "add",
            "line": "                    String str = jp.getText().trim();"
          },
          {
            "type": "add",
            "line": "                    if (str.length() == 0) {"
          },
          {
            "type": "add",
            "line": "                        return (Date) getEmptyValue();"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "add",
            "line": "                    synchronized (_customFormat) {"
          },
          {
            "type": "add",
            "line": "                        try {"
          },
          {
            "type": "add",
            "line": "                            return _customFormat.parse(str);"
          },
          {
            "type": "add",
            "line": "                        } catch (ParseException e) {"
          },
          {
            "type": "add",
            "line": "                            throw new IllegalArgumentException(\"Failed to parse Date value '\"+str"
          },
          {
            "type": "add",
            "line": "                                    +\"' (format: \\\"\"+_formatString+\"\\\"): \"+e.getMessage());"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "add",
            "line": "                // Issue#381"
          },
          {
            "type": "add",
            "line": "                if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "                    jp.nextToken();"
          },
          {
            "type": "add",
            "line": "                    final Date parsed = _parseDate(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "                    t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "                    if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                        throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                                \"Attempted to unwrap single value array for single 'java.util.Date' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "add",
            "line": "                    return parsed;"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             return super._parseDate(jp, ctxt);"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/EnumDeserializer.java",
        "changes": [
          {
            "type": "context",
            "line": "index dab3d00b0..1fddc4d11 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/EnumDeserializer.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/EnumDeserializer.java"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             return result;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (curr == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Enum<?> parsed = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            curr = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (curr != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single '\" + _resolver.getEnumClass().getName() + \"' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_resolver.getEnumClass());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java",
        "changes": [
          {
            "type": "context",
            "line": "index 2d4aa3f17..dab1d3907 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/FromStringDeserializer.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.core.*;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.DeserializationContext;"
          },
          {
            "type": "add",
            "line": "import com.fasterxml.jackson.databind.DeserializationFeature;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.JavaType;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.exc.InvalidFormatException;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.util.ClassUtil;"
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": "     public T deserialize(JsonParser jp, DeserializationContext ctxt) throws IOException"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (jp.getCurrentToken() == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final T value = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                                \"Attempted to unwrap single value array for single '\" + _valueClass.getName() + \"' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return value;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // 22-Sep-2012, tatu: For 2.1, use this new method, may force coercion:"
          },
          {
            "type": "context",
            "line": "         String text = jp.getValueAsString();"
          },
          {
            "type": "context",
            "line": "         if (text != null) { // has String representation"
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/NumberDeserializers.java",
        "changes": [
          {
            "type": "context",
            "line": "index 27501e449..606d847bc 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/NumberDeserializers.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/NumberDeserializers.java"
          },
          {
            "type": "context",
            "line": "             throws IOException, JsonProcessingException"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             JsonToken t = jp.getCurrentToken();"
          },
          {
            "type": "delete",
            "line": "            int value;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (t == JsonToken.VALUE_NUMBER_INT) { // ok iff ascii value"
          },
          {
            "type": "delete",
            "line": "                value = jp.getIntValue();"
          },
          {
            "type": "add",
            "line": "                int value = jp.getIntValue();"
          },
          {
            "type": "context",
            "line": "                 if (value >= 0 && value <= 0xFFFF) {"
          },
          {
            "type": "context",
            "line": "                     return Character.valueOf((char) value);"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 // actually, empty should become null?"
          },
          {
            "type": "context",
            "line": "                 if (text.length() == 0) {"
          },
          {
            "type": "context",
            "line": "                     return (Character) getEmptyValue();"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            } else if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "                //Issue#381"
          },
          {
            "type": "add",
            "line": "                jp.nextToken();"
          },
          {
            "type": "add",
            "line": "                final Character value = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "                if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                    throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                            \"Attempted to unwrap single value array for single '\" + _valueClass.getName() + \"' value but there was more than a single value in the array\""
          },
          {
            "type": "add",
            "line": "                            );"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "add",
            "line": "                return value;"
          },
          {
            "type": "add",
            "line": "            } else if (t == JsonToken.VALUE_NULL && !_valueClass.isPrimitive()) {"
          },
          {
            "type": "add",
            "line": "                //Issue#unreported"
          },
          {
            "type": "add",
            "line": "                //  This handles the case where the value required is the Character wrapper class and the token is the null token"
          },
          {
            "type": "add",
            "line": "                return getEmptyValue();"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "                     throw ctxt.weirdStringException(text, _valueClass, \"not a valid number\");"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "                jp.nextToken();"
          },
          {
            "type": "add",
            "line": "                final Number value = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "                if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                    throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                            \"Attempted to unwrap single value array for single '\" + _valueClass.getName() + \"' value but there was more than a single value in the array\""
          },
          {
            "type": "add",
            "line": "                            );"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                return value;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "             throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "                  * Could do by calling BigDecimal.toBigIntegerExact()"
          },
          {
            "type": "context",
            "line": "                  */"
          },
          {
            "type": "context",
            "line": "                 return jp.getDecimalValue().toBigInteger();"
          },
          {
            "type": "add",
            "line": "            } else if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "                jp.nextToken();"
          },
          {
            "type": "add",
            "line": "                final BigInteger value = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "                if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                    throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'BigInteger' value but there was more than a single value in the array\""
          },
          {
            "type": "add",
            "line": "                    );"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                return value;"
          },
          {
            "type": "context",
            "line": "             } else if (t != JsonToken.VALUE_STRING) { // let's do implicit re-parse"
          },
          {
            "type": "context",
            "line": "                 // String is ok too, can easily convert; otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "                 throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             text = jp.getText().trim();"
          },
          {
            "type": "context",
            "line": "             if (text.length() == 0) {"
          },
          {
            "type": "context",
            "line": "                 return null;"
          },
          {
            "type": "context",
            "line": "                     throw ctxt.weirdStringException(text, _valueClass, \"not a valid representation\");"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "                jp.nextToken();"
          },
          {
            "type": "add",
            "line": "                final BigDecimal value = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "                if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                    throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'BigDecimal' value but there was more than a single value in the array\""
          },
          {
            "type": "add",
            "line": "                    );"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                return value;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "             throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/StackTraceElementDeserializer.java",
        "changes": [
          {
            "type": "context",
            "line": "index 2be93943d..6dc16a388 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/StackTraceElementDeserializer.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/StackTraceElementDeserializer.java"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.core.JsonToken;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.DeserializationContext;"
          },
          {
            "type": "add",
            "line": "import com.fasterxml.jackson.databind.DeserializationFeature;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.JsonMappingException;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " public class StackTraceElementDeserializer"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             return new StackTraceElement(className, methodName, fileName, lineNumber);"
          },
          {
            "type": "add",
            "line": "        } else if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final StackTraceElement value = deserialize(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'java.lang.StackTraceElement' value but there was more than a single value in the array\""
          },
          {
            "type": "add",
            "line": "                    );"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return value;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java",
        "changes": [
          {
            "type": "context",
            "line": "index cf236b927..4f1229a44 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/StdDeserializer.java"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             throw ctxt.weirdStringException(text, _valueClass, \"only \\\"true\\\" or \\\"false\\\" recognized\");"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final boolean parsed = _parseBooleanPrimitive(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'boolean' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             throw ctxt.weirdStringException(text, _valueClass, \"only \\\"true\\\" or \\\"false\\\" recognized\");"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Boolean parsed = _parseBoolean(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Boolean' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return (Byte) getNullValue();"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Byte parsed = _parseByte(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Byte' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return (Short) getNullValue();"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Short parsed = _parseShort(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Short' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return 0;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final int parsed = _parseIntPrimitive(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'int' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return (Integer) getNullValue();"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Integer parsed = _parseInteger(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Integer' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return (Long) getNullValue();"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Long parsed = _parseLong(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Long' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return 0L;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final long parsed = _parseLongPrimitive(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'long' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return (Float) getNullValue();"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Float parsed = _parseFloat(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Byte' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return 0.0f;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final float parsed = _parseFloatPrimitive(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'float' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return (Double) getNullValue();"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Double parsed = _parseDouble(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Double' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "             // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         if (t == JsonToken.VALUE_NULL) {"
          },
          {
            "type": "context",
            "line": "             return 0.0;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final double parsed = _parseDoublePrimitive(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'Byte' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "             // Otherwise, no can do:"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "                         \"not a valid representation (error: \"+iae.getMessage()+\")\");"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (t == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final Date parsed = _parseDate(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            t = jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            if (t != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'java.util.Date' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         throw ctxt.mappingException(_valueClass, t);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     protected final String _parseString(JsonParser jp, DeserializationContext ctxt)"
          },
          {
            "type": "context",
            "line": "         throws IOException"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (jp.getCurrentToken() == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final String parsed = _parseString(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'String' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         String value = jp.getValueAsString();"
          },
          {
            "type": "context",
            "line": "         if (value != null) {"
          },
          {
            "type": "context",
            "line": "             return value;"
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/deser/std/StringDeserializer.java",
        "changes": [
          {
            "type": "context",
            "line": "index dcb01ded4..81b104650 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/deser/std/StringDeserializer.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/deser/std/StringDeserializer.java"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.core.*;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.DeserializationContext;"
          },
          {
            "type": "add",
            "line": "import com.fasterxml.jackson.databind.DeserializationFeature;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.annotation.JacksonStdImpl;"
          },
          {
            "type": "context",
            "line": " import com.fasterxml.jackson.databind.jsontype.TypeDeserializer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": "     public String deserialize(JsonParser jp, DeserializationContext ctxt) throws IOException"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "add",
            "line": "        // Issue#381"
          },
          {
            "type": "add",
            "line": "        if (jp.getCurrentToken() == JsonToken.START_ARRAY && ctxt.isEnabled(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS)) {"
          },
          {
            "type": "add",
            "line": "            jp.nextToken();"
          },
          {
            "type": "add",
            "line": "            final String parsed = _parseString(jp, ctxt);"
          },
          {
            "type": "add",
            "line": "            if (jp.nextToken() != JsonToken.END_ARRAY) {"
          },
          {
            "type": "add",
            "line": "                throw ctxt.wrongTokenException(jp, JsonToken.END_ARRAY,"
          },
          {
            "type": "add",
            "line": "                        \"Attempted to unwrap single value array for single 'String' value but there was more than a single value in the array\");"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return parsed;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "         // 22-Sep-2012, tatu: For 2.1, use this new method, may force coercion:"
          },
          {
            "type": "context",
            "line": "         String text = jp.getValueAsString();"
          },
          {
            "type": "context",
            "line": "         if (text != null) {"
          }
        ]
      },
      {
        "file": "src/test/java/com/fasterxml/jackson/databind/deser/TestJdkTypes.java",
        "changes": [
          {
            "type": "context",
            "line": "index b84e987ae..53d99ca55 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/test/java/com/fasterxml/jackson/databind/deser/TestJdkTypes.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/test/java/com/fasterxml/jackson/databind/deser/TestJdkTypes.java"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         assertEquals(0, result.remaining());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    // [Issue#381]"
          },
          {
            "type": "add",
            "line": "    public void testSingleElementArray() throws Exception {"
          },
          {
            "type": "add",
            "line": "        final int intTest = 932832;"
          },
          {
            "type": "add",
            "line": "        final double doubleTest = 32.3234;"
          },
          {
            "type": "add",
            "line": "        final long longTest = 2374237428374293423L;"
          },
          {
            "type": "add",
            "line": "        final short shortTest = (short) intTest;"
          },
          {
            "type": "add",
            "line": "        final float floatTest = 84.3743f;"
          },
          {
            "type": "add",
            "line": "        final byte byteTest = (byte) 43;"
          },
          {
            "type": "add",
            "line": "        final char charTest = 'c';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final ObjectMapper mapper = new ObjectMapper();"
          },
          {
            "type": "add",
            "line": "        mapper.enable(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final int intValue = mapper.readValue(asArray(intTest), Integer.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(intTest, intValue);"
          },
          {
            "type": "add",
            "line": "        final Integer integerWrapperValue = mapper.readValue(asArray(Integer.valueOf(intTest)), Integer.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Integer.valueOf(intTest), integerWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final double doubleValue = mapper.readValue(asArray(doubleTest), Double.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(doubleTest, doubleValue);"
          },
          {
            "type": "add",
            "line": "        final Double doubleWrapperValue = mapper.readValue(asArray(Double.valueOf(doubleTest)), Double.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Double.valueOf(doubleTest), doubleWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final long longValue = mapper.readValue(asArray(longTest), Long.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(longTest, longValue);"
          },
          {
            "type": "add",
            "line": "        final Long longWrapperValue = mapper.readValue(asArray(Long.valueOf(longTest)), Long.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Long.valueOf(longTest), longWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final short shortValue = mapper.readValue(asArray(shortTest), Short.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(shortTest, shortValue);"
          },
          {
            "type": "add",
            "line": "        final Short shortWrapperValue = mapper.readValue(asArray(Short.valueOf(shortTest)), Short.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Short.valueOf(shortTest), shortWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final float floatValue = mapper.readValue(asArray(floatTest), Float.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(floatTest, floatValue);"
          },
          {
            "type": "add",
            "line": "        final Float floatWrapperValue = mapper.readValue(asArray(Float.valueOf(floatTest)), Float.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Float.valueOf(floatTest), floatWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final byte byteValue = mapper.readValue(asArray(byteTest), Byte.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(byteTest, byteValue);"
          },
          {
            "type": "add",
            "line": "        final Byte byteWrapperValue = mapper.readValue(asArray(Byte.valueOf(byteTest)), Byte.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Byte.valueOf(byteTest), byteWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final char charValue = mapper.readValue(asArray(quote(String.valueOf(charTest))), Character.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(charTest, charValue);"
          },
          {
            "type": "add",
            "line": "        final Character charWrapperValue = mapper.readValue(asArray(quote(String.valueOf(charTest))), Character.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Character.valueOf(charTest), charWrapperValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final boolean booleanTrueValue = mapper.readValue(asArray(true), Boolean.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertTrue(booleanTrueValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final boolean booleanFalseValue = mapper.readValue(asArray(false), Boolean.TYPE);"
          },
          {
            "type": "add",
            "line": "        assertFalse(booleanFalseValue);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        final Boolean booleanWrapperTrueValue = mapper.readValue(asArray(Boolean.valueOf(true)), Boolean.class);"
          },
          {
            "type": "add",
            "line": "        assertEquals(Boolean.TRUE, booleanWrapperTrueValue);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private static String asArray(Object value) {"
          },
          {
            "type": "add",
            "line": "        final String stringVal = value.toString();"
          },
          {
            "type": "add",
            "line": "        return new StringBuilder(stringVal.length() + 2).append(\"[\").append(stringVal).append(\"]\").toString();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public void testSingleElementArrayException() throws Exception {"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42]\", Integer.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42]\", Integer.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42.273]\", Double.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42.2723]\", Double.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42342342342342]\", Long.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42342342342342342]\", Long.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42]\", Short.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[42]\", Short.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[327.2323]\", Float.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[82.81902]\", Float.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[22]\", Byte.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[22]\", Byte.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"['d']\", Character.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"['d']\", Character.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[true]\", Boolean.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            MAPPER.readValue(\"[true]\", Boolean.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public void testMultiValueArrayException() throws IOException {"
          },
          {
            "type": "add",
            "line": "        final ObjectMapper mapper = new ObjectMapper();"
          },
          {
            "type": "add",
            "line": "        mapper.enable(DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42,42]\", Integer.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42,42]\", Integer.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42.273,42.273]\", Double.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42.2723,42.273]\", Double.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42342342342342,42342342342342]\", Long.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42342342342342342,42342342342342]\", Long.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42,42]\", Short.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[42,42]\", Short.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[327.2323,327.2323]\", Float.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[82.81902,327.2323]\", Float.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[22,23]\", Byte.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[22,23]\", Byte.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(asArray(quote(\"c\") + \",\"  + quote(\"d\")), Character.class);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(asArray(quote(\"c\") + \",\"  + quote(\"d\")), Character.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[true,false]\", Boolean.class);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        try {"
          },
          {
            "type": "add",
            "line": "            mapper.readValue(\"[true,false]\", Boolean.TYPE);"
          },
          {
            "type": "add",
            "line": "            fail(\"Single value array didn't throw an exception when DeserializationFeature.UNWRAP_SINGLE_VALUE_ARRAYS is disabled\");"
          },
          {
            "type": "add",
            "line": "        } catch (JsonMappingException exp) {"
          },
          {
            "type": "add",
            "line": "            //Exception was thrown correctly"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e3c8eb740e1e49a62a5f452cda7e06258712bbf",
    "files": [
      {
        "file": "admin/tool/lp/classes/page_helper.php",
        "changes": [
          {
            "type": "context",
            "line": "index d4d2a56c858..8ffa8e768d3 100644"
          },
          {
            "type": "context",
            "line": "--- a/admin/tool/lp/classes/page_helper.php"
          },
          {
            "type": "context",
            "line": "+++ b/admin/tool/lp/classes/page_helper.php"
          },
          {
            "type": "context",
            "line": "         $PAGE->set_pagelayout('standard');"
          },
          {
            "type": "context",
            "line": "         $PAGE->set_url($url);"
          },
          {
            "type": "context",
            "line": "         $PAGE->set_title($title);"
          },
          {
            "type": "delete",
            "line": "        $PAGE->set_heading(fullname($user));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!empty($plan)) {"
          },
          {
            "type": "context",
            "line": "             $PAGE->navbar->add($title, $planurl);"
          },
          {
            "type": "context",
            "line": "         $PAGE->set_pagelayout('standard');"
          },
          {
            "type": "context",
            "line": "         $PAGE->set_url($url);"
          },
          {
            "type": "context",
            "line": "         $PAGE->set_title($title);"
          },
          {
            "type": "delete",
            "line": "        $PAGE->set_heading(fullname($user));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!empty($evidence)) {"
          },
          {
            "type": "context",
            "line": "             $PAGE->navbar->add($title, $evidenceurl);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e5cc9a40ada6046e6bc3bdfcd0c0d7e4b706b14",
    "files": [
      {
        "file": "fs/udf/dir.c",
        "changes": [
          {
            "type": "context",
            "line": "index a012c51caffd..a7690b46ce0a 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/udf/dir.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/udf/dir.c"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tflen = udf_get_filename(dir->i_sb, nameptr, fname, lfi);"
          },
          {
            "type": "add",
            "line": "\t\tflen = udf_get_filename(dir->i_sb, nameptr, lfi, fname,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tUDF_NAME_LEN);"
          },
          {
            "type": "context",
            "line": " \t\tif (!flen)"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue;"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "fs/udf/namei.c",
        "changes": [
          {
            "type": "context",
            "line": "index c12e260fd6c4..6ff19b54b51f 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/udf/namei.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/udf/namei.c"
          },
          {
            "type": "context",
            "line": " \t\tif (!lfi)"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tflen = udf_get_filename(dir->i_sb, nameptr, fname, lfi);"
          },
          {
            "type": "add",
            "line": "\t\tflen = udf_get_filename(dir->i_sb, nameptr, lfi, fname,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tUDF_NAME_LEN);"
          },
          {
            "type": "context",
            "line": " \t\tif (flen && udf_match(flen, fname, child->len, child->name))"
          },
          {
            "type": "context",
            "line": " \t\t\tgoto out_ok;"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      },
      {
        "file": "fs/udf/symlink.c",
        "changes": [
          {
            "type": "context",
            "line": "index c3aa6fafd6cf..0f1b3a2654b9 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/udf/symlink.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/udf/symlink.c"
          },
          {
            "type": "context",
            "line": " #include <linux/buffer_head.h>"
          },
          {
            "type": "context",
            "line": " #include \"udf_i.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void udf_pc_to_char(struct super_block *sb, unsigned char *from,"
          },
          {
            "type": "delete",
            "line": "\t\t\t   int fromlen, unsigned char *to)"
          },
          {
            "type": "add",
            "line": "static int udf_pc_to_char(struct super_block *sb, unsigned char *from,"
          },
          {
            "type": "add",
            "line": "\t\t\t  int fromlen, unsigned char *to, int tolen)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct pathComponent *pc;"
          },
          {
            "type": "context",
            "line": " \tint elen = 0;"
          },
          {
            "type": "add",
            "line": "\tint comp_len;"
          },
          {
            "type": "context",
            "line": " \tunsigned char *p = to;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* Reserve one byte for terminating \\0 */"
          },
          {
            "type": "add",
            "line": "\ttolen--;"
          },
          {
            "type": "context",
            "line": " \twhile (elen < fromlen) {"
          },
          {
            "type": "context",
            "line": " \t\tpc = (struct pathComponent *)(from + elen);"
          },
          {
            "type": "context",
            "line": " \t\tswitch (pc->componentType) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\t\t/* Fall through */"
          },
          {
            "type": "context",
            "line": " \t\tcase 2:"
          },
          {
            "type": "add",
            "line": "\t\t\tif (tolen == 0)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn -ENAMETOOLONG;"
          },
          {
            "type": "context",
            "line": " \t\t\tp = to;"
          },
          {
            "type": "context",
            "line": " \t\t\t*p++ = '/';"
          },
          {
            "type": "add",
            "line": "\t\t\ttolen--;"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\tcase 3:"
          },
          {
            "type": "add",
            "line": "\t\t\tif (tolen < 3)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn -ENAMETOOLONG;"
          },
          {
            "type": "context",
            "line": " \t\t\tmemcpy(p, \"../\", 3);"
          },
          {
            "type": "context",
            "line": " \t\t\tp += 3;"
          },
          {
            "type": "add",
            "line": "\t\t\ttolen -= 3;"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\tcase 4:"
          },
          {
            "type": "add",
            "line": "\t\t\tif (tolen < 2)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn -ENAMETOOLONG;"
          },
          {
            "type": "context",
            "line": " \t\t\tmemcpy(p, \"./\", 2);"
          },
          {
            "type": "context",
            "line": " \t\t\tp += 2;"
          },
          {
            "type": "add",
            "line": "\t\t\ttolen -= 2;"
          },
          {
            "type": "context",
            "line": " \t\t\t/* that would be . - just ignore */"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\tcase 5:"
          },
          {
            "type": "delete",
            "line": "\t\t\tp += udf_get_filename(sb, pc->componentIdent, p,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t      pc->lengthComponentIdent);"
          },
          {
            "type": "add",
            "line": "\t\t\tcomp_len = udf_get_filename(sb, pc->componentIdent,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t    pc->lengthComponentIdent,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t    p, tolen);"
          },
          {
            "type": "add",
            "line": "\t\t\tp += comp_len;"
          },
          {
            "type": "add",
            "line": "\t\t\ttolen -= comp_len;"
          },
          {
            "type": "add",
            "line": "\t\t\tif (tolen == 0)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn -ENAMETOOLONG;"
          },
          {
            "type": "context",
            "line": " \t\t\t*p++ = '/';"
          },
          {
            "type": "add",
            "line": "\t\t\ttolen--;"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\telen += sizeof(struct pathComponent) + pc->lengthComponentIdent;"
          },
          {
            "type": "context",
            "line": " \t\tp[-1] = '\\0';"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\tp[0] = '\\0';"
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int udf_symlink_filler(struct file *file, struct page *page)"
          },
          {
            "type": "context",
            "line": " \t\tsymlink = bh->b_data;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tudf_pc_to_char(inode->i_sb, symlink, inode->i_size, p);"
          },
          {
            "type": "add",
            "line": "\terr = udf_pc_to_char(inode->i_sb, symlink, inode->i_size, p, PAGE_SIZE);"
          },
          {
            "type": "context",
            "line": " \tbrelse(bh);"
          },
          {
            "type": "add",
            "line": "\tif (err)"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_unlock_inode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tup_read(&iinfo->i_data_sem);"
          },
          {
            "type": "context",
            "line": " \tSetPageUptodate(page);"
          }
        ]
      },
      {
        "file": "fs/udf/udfdecl.h",
        "changes": [
          {
            "type": "context",
            "line": "index 1cc3c993ebd0..47bb3f5ca360 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/udf/udfdecl.h"
          },
          {
            "type": "context",
            "line": "+++ b/fs/udf/udfdecl.h"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* unicode.c */"
          },
          {
            "type": "delete",
            "line": "extern int udf_get_filename(struct super_block *, uint8_t *, uint8_t *, int);"
          },
          {
            "type": "add",
            "line": "extern int udf_get_filename(struct super_block *, uint8_t *, int, uint8_t *,"
          },
          {
            "type": "add",
            "line": "\t\t\t    int);"
          },
          {
            "type": "context",
            "line": " extern int udf_put_filename(struct super_block *, const uint8_t *, uint8_t *,"
          },
          {
            "type": "context",
            "line": " \t\t\t    int);"
          },
          {
            "type": "context",
            "line": " extern int udf_build_ustr(struct ustr *, dstring *, int);"
          }
        ]
      },
      {
        "file": "fs/udf/unicode.c",
        "changes": [
          {
            "type": "context",
            "line": "index afd470e588ff..b84fee372734 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/udf/unicode.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/udf/unicode.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #include \"udf_sb.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static int udf_translate_to_linux(uint8_t *, uint8_t *, int, uint8_t *, int);"
          },
          {
            "type": "add",
            "line": "static int udf_translate_to_linux(uint8_t *, int, uint8_t *, int, uint8_t *,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  int);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int udf_char_to_ustr(struct ustr *dest, const uint8_t *src, int strlen)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \treturn u_len + 1;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "int udf_get_filename(struct super_block *sb, uint8_t *sname, uint8_t *dname,"
          },
          {
            "type": "delete",
            "line": "\t\t     int flen)"
          },
          {
            "type": "add",
            "line": "int udf_get_filename(struct super_block *sb, uint8_t *sname, int slen,"
          },
          {
            "type": "add",
            "line": "\t\t     uint8_t *dname, int dlen)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct ustr *filename, *unifilename;"
          },
          {
            "type": "context",
            "line": " \tint len = 0;"
          },
          {
            "type": "context",
            "line": " \tif (!unifilename)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out1;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (udf_build_ustr_exact(unifilename, sname, flen))"
          },
          {
            "type": "add",
            "line": "\tif (udf_build_ustr_exact(unifilename, sname, slen))"
          },
          {
            "type": "context",
            "line": " \t\tgoto out2;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (UDF_QUERY_FLAG(sb, UDF_FLAG_UTF8)) {"
          },
          {
            "type": "context",
            "line": " \t} else"
          },
          {
            "type": "context",
            "line": " \t\tgoto out2;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tlen = udf_translate_to_linux(dname, filename->u_name, filename->u_len,"
          },
          {
            "type": "add",
            "line": "\tlen = udf_translate_to_linux(dname, dlen,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t     filename->u_name, filename->u_len,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t     unifilename->u_name, unifilename->u_len);"
          },
          {
            "type": "context",
            "line": " out2:"
          },
          {
            "type": "context",
            "line": " \tkfree(unifilename);"
          },
          {
            "type": "context",
            "line": " #define EXT_MARK\t\t'.'"
          },
          {
            "type": "context",
            "line": " #define CRC_MARK\t\t'#'"
          },
          {
            "type": "context",
            "line": " #define EXT_SIZE \t\t5"
          },
          {
            "type": "add",
            "line": "/* Number of chars we need to store generated CRC to make filename unique */"
          },
          {
            "type": "add",
            "line": "#define CRC_LEN\t\t\t5"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static int udf_translate_to_linux(uint8_t *newName, uint8_t *udfName,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t  int udfLen, uint8_t *fidName,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t  int fidNameLen)"
          },
          {
            "type": "add",
            "line": "static int udf_translate_to_linux(uint8_t *newName, int newLen,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  uint8_t *udfName, int udfLen,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t  uint8_t *fidName, int fidNameLen)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tint index, newIndex = 0, needsCRC = 0;"
          },
          {
            "type": "context",
            "line": " \tint extIndex = 0, newExtIndex = 0, hasExt = 0;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tnewExtIndex = newIndex;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (newIndex < 256)"
          },
          {
            "type": "add",
            "line": "\t\t\tif (newIndex < newLen)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tnewName[newIndex++] = curr;"
          },
          {
            "type": "context",
            "line": " \t\t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\t\tneedsCRC = 1;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\text[localExtIndex++] = curr;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\tmaxFilenameLen = 250 - localExtIndex;"
          },
          {
            "type": "add",
            "line": "\t\t\tmaxFilenameLen = newLen - CRC_LEN - localExtIndex;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (newIndex > maxFilenameLen)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tnewIndex = maxFilenameLen;"
          },
          {
            "type": "context",
            "line": " \t\t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\t\tnewIndex = newExtIndex;"
          },
          {
            "type": "delete",
            "line": "\t\t} else if (newIndex > 250)"
          },
          {
            "type": "delete",
            "line": "\t\t\tnewIndex = 250;"
          },
          {
            "type": "add",
            "line": "\t\t} else if (newIndex > newLen - CRC_LEN)"
          },
          {
            "type": "add",
            "line": "\t\t\tnewIndex = newLen - CRC_LEN;"
          },
          {
            "type": "context",
            "line": " \t\tnewName[newIndex++] = CRC_MARK;"
          },
          {
            "type": "context",
            "line": " \t\tvalueCRC = crc_itu_t(0, fidName, fidNameLen);"
          },
          {
            "type": "context",
            "line": " \t\tnewName[newIndex++] = hex_asc_upper_hi(valueCRC >> 8);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e62395da2bd5166d7c9e14cbc7503b256a34cb0",
    "files": [
      {
        "file": "drivers/scsi/bfa/bfad_attr.c",
        "changes": [
          {
            "type": "context",
            "line": "index 29ab81df75c0..fbfce02e5b93 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/bfa/bfad_attr.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/bfa/bfad_attr.c"
          },
          {
            "type": "context",
            "line": " \trc = bfa_port_get_stats(BFA_FCPORT(&bfad->bfa),"
          },
          {
            "type": "context",
            "line": " \t\t\t\tfcstats, bfad_hcb_comp, &fcomp);"
          },
          {
            "type": "context",
            "line": " \tspin_unlock_irqrestore(&bfad->bfad_lock, flags);"
          },
          {
            "type": "delete",
            "line": "\tif (rc != BFA_STATUS_OK)"
          },
          {
            "type": "add",
            "line": "\tif (rc != BFA_STATUS_OK) {"
          },
          {
            "type": "add",
            "line": "\t\tkfree(fcstats);"
          },
          {
            "type": "context",
            "line": " \t\treturn NULL;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \twait_for_completion(&fcomp.comp);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e7861aec73702f7933ce2a93056f7983939f0d6",
    "files": [
      {
        "file": "django/contriadmin/options.py",
        "changes": [
          {
            "type": "context",
            "line": "index 2071792bdb..78a08cd120 100644"
          },
          {
            "type": "context",
            "line": "--- a/django/contrib/admin/options.py"
          },
          {
            "type": "context",
            "line": "+++ b/django/contrib/admin/options.py"
          },
          {
            "type": "context",
            "line": "     def history_view(self, request, object_id, extra_context=None):"
          },
          {
            "type": "context",
            "line": "         \"The 'history' admin view for this model.\""
          },
          {
            "type": "context",
            "line": "         from django.contrib.admin.models import LogEntry"
          },
          {
            "type": "add",
            "line": "        # First check if the user can see this history."
          },
          {
            "type": "context",
            "line": "         model = self.model"
          },
          {
            "type": "add",
            "line": "        obj = get_object_or_404(model, pk=unquote(object_id))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if not self.has_change_permission(request, obj):"
          },
          {
            "type": "add",
            "line": "            raise PermissionDenied"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Then get the history for this object."
          },
          {
            "type": "context",
            "line": "         opts = model._meta"
          },
          {
            "type": "context",
            "line": "         app_label = opts.app_label"
          },
          {
            "type": "context",
            "line": "         action_list = LogEntry.objects.filter("
          },
          {
            "type": "context",
            "line": "             object_id = object_id,"
          },
          {
            "type": "context",
            "line": "             content_type__id__exact = ContentType.objects.get_for_model(model).id"
          },
          {
            "type": "context",
            "line": "         ).select_related().order_by('action_time')"
          },
          {
            "type": "delete",
            "line": "        # If no history was found, see whether this object even exists."
          },
          {
            "type": "delete",
            "line": "        obj = get_object_or_404(model, pk=unquote(object_id))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         context = {"
          },
          {
            "type": "context",
            "line": "             'title': _('Change history: %s') % force_unicode(obj),"
          },
          {
            "type": "context",
            "line": "             'action_list': action_list,"
          }
        ]
      },
      {
        "file": "tests/regressiontests/admin_views/tests.py",
        "changes": [
          {
            "type": "context",
            "line": "index 8835e816dc..5531cb4e96 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/regressiontests/admin_views/tests.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/regressiontests/admin_views/tests.py"
          },
          {
            "type": "context",
            "line": "             self.assertContains(request, 'login-form')"
          },
          {
            "type": "context",
            "line": "             self.client.get('/test_admin/admin/logout/')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def testHistoryView(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\"History view should restrict access.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # add user shoud not be able to view the list of article or change any of them"
          },
          {
            "type": "add",
            "line": "        self.client.get('/test_admin/admin/')"
          },
          {
            "type": "add",
            "line": "        self.client.post('/test_admin/admin/', self.adduser_login)"
          },
          {
            "type": "add",
            "line": "        response = self.client.get('/test_admin/admin/admin_views/article/1/history/')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.status_code, 403)"
          },
          {
            "type": "add",
            "line": "        self.client.get('/test_admin/admin/logout/')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # change user can view all items and edit them"
          },
          {
            "type": "add",
            "line": "        self.client.get('/test_admin/admin/')"
          },
          {
            "type": "add",
            "line": "        self.client.post('/test_admin/admin/', self.changeuser_login)"
          },
          {
            "type": "add",
            "line": "        response = self.client.get('/test_admin/admin/admin_views/article/1/history/')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.status_code, 200)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Test redirection when using row-level change permissions. Refs #11513."
          },
          {
            "type": "add",
            "line": "        RowLevelChangePermissionModel.objects.create(id=1, name=\"odd id\")"
          },
          {
            "type": "add",
            "line": "        RowLevelChangePermissionModel.objects.create(id=2, name=\"even id\")"
          },
          {
            "type": "add",
            "line": "        for login_dict in [self.super_login, self.changeuser_login, self.adduser_login, self.deleteuser_login]:"
          },
          {
            "type": "add",
            "line": "            self.client.post('/test_admin/admin/', login_dict)"
          },
          {
            "type": "add",
            "line": "            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/history/')"
          },
          {
            "type": "add",
            "line": "            self.assertEqual(response.status_code, 403)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/history/')"
          },
          {
            "type": "add",
            "line": "            self.assertEqual(response.status_code, 200)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            self.client.get('/test_admin/admin/logout/')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        for login_dict in [self.joepublic_login, self.no_username_login]:"
          },
          {
            "type": "add",
            "line": "            self.client.post('/test_admin/admin/', login_dict)"
          },
          {
            "type": "add",
            "line": "            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/history/')"
          },
          {
            "type": "add",
            "line": "            self.assertEqual(response.status_code, 200)"
          },
          {
            "type": "add",
            "line": "            self.assertContains(response, 'login-form')"
          },
          {
            "type": "add",
            "line": "            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/history/')"
          },
          {
            "type": "add",
            "line": "            self.assertEqual(response.status_code, 200)"
          },
          {
            "type": "add",
            "line": "            self.assertContains(response, 'login-form')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            self.client.get('/test_admin/admin/logout/')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def testConditionallyShowAddSectionLink(self):"
          },
          {
            "type": "context",
            "line": "         \"\"\""
          },
          {
            "type": "context",
            "line": "         The foreign key widget should only show the \"add related\" button if the"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e8e938d497260dd57be67b4966cb27a5f72376f",
    "files": [
      {
        "file": "src/indent.c",
        "changes": [
          {
            "type": "context",
            "line": "index 794fa2c34..fa177bcf2 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/indent.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/indent.c"
          },
          {
            "type": "context",
            "line": " \t\t\t    }"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t    }"
          },
          {
            "type": "add",
            "line": "\t\t    if (*that == NUL)"
          },
          {
            "type": "add",
            "line": "\t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tif (*that == '(' || *that == '[')"
          },
          {
            "type": "context",
            "line": " \t\t    ++parencount;"
          }
        ]
      },
      {
        "file": "src/testdir/test_indent.vim",
        "changes": [
          {
            "type": "context",
            "line": "index be55227bd..3b5b64317 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testdir/test_indent.vim"
          },
          {
            "type": "context",
            "line": "+++ b/src/testdir/test_indent.vim"
          },
          {
            "type": "context",
            "line": "   close!"
          },
          {
            "type": "context",
            "line": " endfunc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func Test_lisp_indent_quoted()"
          },
          {
            "type": "add",
            "line": "  \" This was going past the end of the line"
          },
          {
            "type": "add",
            "line": "  new"
          },
          {
            "type": "add",
            "line": "  setlocal lisp autoindent"
          },
          {
            "type": "add",
            "line": "  call setline(1, ['\"[', '='])"
          },
          {
            "type": "add",
            "line": "  normal Gvk="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  bwipe!"
          },
          {
            "type": "add",
            "line": "endfunc"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \" Test for setting the 'indentexpr' from a modeline"
          },
          {
            "type": "context",
            "line": " func Test_modeline_indent_expr()"
          },
          {
            "type": "context",
            "line": "   let modeline = &modeline"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index 89e1fa1b7..5411e1c18 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    5122,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     5121,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "0e9a9a1ad619e7e987815d20262d36a2f95717ca",
    "files": [
      {
        "file": "fs/ext4/namei.c",
        "changes": [
          {
            "type": "context",
            "line": "index cac448282331..8990165346ee 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ext4/namei.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ext4/namei.c"
          },
          {
            "type": "context",
            "line": " \tstruct ext4_iloc iloc;"
          },
          {
            "type": "context",
            "line": " \tint err = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!EXT4_SB(inode->i_sb)->s_journal)"
          },
          {
            "type": "add",
            "line": "\tif ((!EXT4_SB(inode->i_sb)->s_journal) &&"
          },
          {
            "type": "add",
            "line": "\t    !(EXT4_SB(inode->i_sb)->s_mount_state & EXT4_ORPHAN_FS))"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&EXT4_SB(inode->i_sb)->s_orphan_lock);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0ea1ec713f04bdfac343c9702b21cd3a7c711826",
    "files": [
      {
        "file": "arch/arm/mm/dma-mapping.c",
        "changes": [
          {
            "type": "context",
            "line": "index f5e1a8471714..57438506d524 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/arm/mm/dma-mapping.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/arm/mm/dma-mapping.c"
          },
          {
            "type": "context",
            "line": " void *arm_dma_alloc(struct device *dev, size_t size, dma_addr_t *handle,"
          },
          {
            "type": "context",
            "line": " \t\t    gfp_t gfp, struct dma_attrs *attrs)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tpgprot_t prot = __get_dma_pgprot(attrs, pgprot_kernel);"
          },
          {
            "type": "add",
            "line": "\tpgprot_t prot = __get_dma_pgprot(attrs, PAGE_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tvoid *memory;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (dma_alloc_from_coherent(dev, size, handle, &memory))"
          },
          {
            "type": "context",
            "line": " static void *arm_coherent_dma_alloc(struct device *dev, size_t size,"
          },
          {
            "type": "context",
            "line": " \tdma_addr_t *handle, gfp_t gfp, struct dma_attrs *attrs)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tpgprot_t prot = __get_dma_pgprot(attrs, pgprot_kernel);"
          },
          {
            "type": "add",
            "line": "\tpgprot_t prot = __get_dma_pgprot(attrs, PAGE_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tvoid *memory;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (dma_alloc_from_coherent(dev, size, handle, &memory))"
          }
        ]
      }
    ]
  },
  {
    "commit": "0ed26acce328ec16a3aa635f1ca37365e8c7403a",
    "files": [
      {
        "file": "crypto/ts/ts_lib.c",
        "changes": [
          {
            "type": "context",
            "line": "index bde1bd75e4..e18f1f3f7e 100644"
          },
          {
            "type": "context",
            "line": "--- a/crypto/ts/ts_lib.c"
          },
          {
            "type": "context",
            "line": "+++ b/crypto/ts/ts_lib.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     char obj_txt[128];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    int len = OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);"
          },
          {
            "type": "delete",
            "line": "    BIO_write(bio, obj_txt, len);"
          },
          {
            "type": "delete",
            "line": "    BIO_write(bio, \"\\n\", 1);"
          },
          {
            "type": "add",
            "line": "    OBJ_obj2txt(obj_txt, sizeof(obj_txt), obj, 0);"
          },
          {
            "type": "add",
            "line": "    BIO_printf(bio, \"%s\\n\", obj_txt);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return 1;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "0f22072ab50cac7983f9660d33974b45184da4f9",
    "files": [
      {
        "file": "arch/arm/kernel/sys_oabi-compat.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4ad8da15ef2b..af0aaebf4de6 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/arm/kernel/sys_oabi-compat.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/arm/kernel/sys_oabi-compat.c"
          },
          {
            "type": "context",
            "line": " \tlong err;"
          },
          {
            "type": "context",
            "line": " \tint i;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (nsops < 1)"
          },
          {
            "type": "add",
            "line": "\tif (nsops < 1 || nsops > SEMOPM)"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "context",
            "line": " \tsops = kmalloc(sizeof(*sops) * nsops, GFP_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tif (!sops)"
          }
        ]
      }
    ]
  },
  {
    "commit": "0f2af21aae11972fa924374ddcf52e88347cf5a8",
    "files": [
      {
        "file": "fs/ext4/extents.c",
        "changes": [
          {
            "type": "context",
            "line": "index 2e6af88d112f..3cc17aacc4c7 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ext4/extents.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ext4/extents.c"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\tmax_blocks -= lblk;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tflags = EXT4_GET_BLOCKS_CREATE_UNWRIT_EXT |"
          },
          {
            "type": "delete",
            "line": "\t\tEXT4_GET_BLOCKS_CONVERT_UNWRITTEN |"
          },
          {
            "type": "delete",
            "line": "\t\tEXT4_EX_NOCACHE;"
          },
          {
            "type": "delete",
            "line": "\tif (mode & FALLOC_FL_KEEP_SIZE)"
          },
          {
            "type": "delete",
            "line": "\t\tflags |= EXT4_GET_BLOCKS_KEEP_SIZE;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&inode->i_mutex);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t\tret = inode_newsize_ok(inode, new_size);"
          },
          {
            "type": "context",
            "line": " \t\tif (ret)"
          },
          {
            "type": "context",
            "line": " \t\t\tgoto out_mutex;"
          },
          {
            "type": "delete",
            "line": "\t\t/*"
          },
          {
            "type": "delete",
            "line": "\t\t * If we have a partial block after EOF we have to allocate"
          },
          {
            "type": "delete",
            "line": "\t\t * the entire block."
          },
          {
            "type": "delete",
            "line": "\t\t */"
          },
          {
            "type": "delete",
            "line": "\t\tif (partial_end)"
          },
          {
            "type": "delete",
            "line": "\t\t\tmax_blocks += 1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tflags = EXT4_GET_BLOCKS_CREATE_UNWRIT_EXT;"
          },
          {
            "type": "add",
            "line": "\tif (mode & FALLOC_FL_KEEP_SIZE)"
          },
          {
            "type": "add",
            "line": "\t\tflags |= EXT4_GET_BLOCKS_KEEP_SIZE;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* Preallocate the range including the unaligned edges */"
          },
          {
            "type": "add",
            "line": "\tif (partial_begin || partial_end) {"
          },
          {
            "type": "add",
            "line": "\t\tret = ext4_alloc_file_blocks(file,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tround_down(offset, 1 << blkbits) >> blkbits,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t(round_up((offset + len), 1 << blkbits) -"
          },
          {
            "type": "add",
            "line": "\t\t\t\t round_down(offset, 1 << blkbits)) >> blkbits,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tnew_size, flags, mode);"
          },
          {
            "type": "add",
            "line": "\t\tif (ret)"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto out_mutex;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/* Zero range excluding the unaligned edges */"
          },
          {
            "type": "context",
            "line": " \tif (max_blocks > 0) {"
          },
          {
            "type": "add",
            "line": "\t\tflags |= (EXT4_GET_BLOCKS_CONVERT_UNWRITTEN |"
          },
          {
            "type": "add",
            "line": "\t\t\t  EXT4_EX_NOCACHE);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/* Now release the pages and zero block aligned part of pages*/"
          },
          {
            "type": "context",
            "line": " \t\ttruncate_pagecache_range(inode, start, end - 1);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0f2ff82e11c86c05d051cae32b58226392d33bbf",
    "files": [
      {
        "file": "drivers/gpu/drm/vc4/vc4_gem.c",
        "changes": [
          {
            "type": "context",
            "line": "index db920771bfb5..c5fe3554858e 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/vc4/vc4_gem.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/vc4/vc4_gem.c"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t  args->shader_rec_count);"
          },
          {
            "type": "context",
            "line": " \tstruct vc4_bo *bo;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (uniforms_offset < shader_rec_offset ||"
          },
          {
            "type": "add",
            "line": "\tif (shader_rec_offset < args->bin_cl_size ||"
          },
          {
            "type": "add",
            "line": "\t    uniforms_offset < shader_rec_offset ||"
          },
          {
            "type": "context",
            "line": " \t    exec_size < uniforms_offset ||"
          },
          {
            "type": "context",
            "line": " \t    args->shader_rec_count >= (UINT_MAX /"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t  sizeof(struct vc4_shader_state)) ||"
          }
        ]
      }
    ]
  },
  {
    "commit": "0f4f199443faca715523b0659aa536251d8b978f",
    "files": [
      {
        "file": "drivers/net/wireless/intel/iwlwifi/pcie/ctxt-info-gen3.c",
        "changes": [
          {
            "type": "context",
            "line": "index 75fa8a6aafee..74980382e64c 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/net/wireless/intel/iwlwifi/pcie/ctxt-info-gen3.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/net/wireless/intel/iwlwifi/pcie/ctxt-info-gen3.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* allocate ucode sections in dram and set addresses */"
          },
          {
            "type": "context",
            "line": " \tret = iwl_pcie_init_fw_sec(trans, fw, &prph_scratch->dram);"
          },
          {
            "type": "delete",
            "line": "\tif (ret) {"
          },
          {
            "type": "delete",
            "line": "\t\tdma_free_coherent(trans->dev,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t  sizeof(*prph_scratch),"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t  prph_scratch,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t  trans_pcie->prph_scratch_dma_addr);"
          },
          {
            "type": "delete",
            "line": "\t\treturn ret;"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tif (ret)"
          },
          {
            "type": "add",
            "line": "\t\tgoto err_free_prph_scratch;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Allocate prph information"
          },
          {
            "type": "context",
            "line": " \t * currently we don't assign to the prph info anything, but it would get"
          },
          {
            "type": "context",
            "line": " \tprph_info = dma_alloc_coherent(trans->dev, sizeof(*prph_info),"
          },
          {
            "type": "context",
            "line": " \t\t\t\t       &trans_pcie->prph_info_dma_addr,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t       GFP_KERNEL);"
          },
          {
            "type": "delete",
            "line": "\tif (!prph_info)"
          },
          {
            "type": "delete",
            "line": "\t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\tif (!prph_info) {"
          },
          {
            "type": "add",
            "line": "\t\tret = -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\t\tgoto err_free_prph_scratch;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Allocate context info */"
          },
          {
            "type": "context",
            "line": " \tctxt_info_gen3 = dma_alloc_coherent(trans->dev,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t    sizeof(*ctxt_info_gen3),"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t    &trans_pcie->ctxt_info_dma_addr,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t    GFP_KERNEL);"
          },
          {
            "type": "delete",
            "line": "\tif (!ctxt_info_gen3)"
          },
          {
            "type": "delete",
            "line": "\t\treturn -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\tif (!ctxt_info_gen3) {"
          },
          {
            "type": "add",
            "line": "\t\tret = -ENOMEM;"
          },
          {
            "type": "add",
            "line": "\t\tgoto err_free_prph_info;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tctxt_info_gen3->prph_info_base_addr ="
          },
          {
            "type": "context",
            "line": " \t\tcpu_to_le64(trans_pcie->prph_info_dma_addr);"
          },
          {
            "type": "context",
            "line": " \t\tiwl_set_bit(trans, CSR_GP_CNTRL, CSR_AUTO_FUNC_INIT);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "err_free_prph_info:"
          },
          {
            "type": "add",
            "line": "\tdma_free_coherent(trans->dev,"
          },
          {
            "type": "add",
            "line": "\t\t\t  sizeof(*prph_info),"
          },
          {
            "type": "add",
            "line": "\t\t\tprph_info,"
          },
          {
            "type": "add",
            "line": "\t\t\ttrans_pcie->prph_info_dma_addr);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "err_free_prph_scratch:"
          },
          {
            "type": "add",
            "line": "\tdma_free_coherent(trans->dev,"
          },
          {
            "type": "add",
            "line": "\t\t\t  sizeof(*prph_scratch),"
          },
          {
            "type": "add",
            "line": "\t\t\tprph_scratch,"
          },
          {
            "type": "add",
            "line": "\t\t\ttrans_pcie->prph_scratch_dma_addr);"
          },
          {
            "type": "add",
            "line": "\treturn ret;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void iwl_pcie_ctxt_info_gen3_free(struct iwl_trans *trans)"
          }
        ]
      }
    ]
  },
  {
    "commit": "0f6e28f686dbb59ab3b562408ab9b2234797b9b1",
    "files": [
      {
        "file": "src/evalvars.c",
        "changes": [
          {
            "type": "context",
            "line": "index 40375588c..dabd49b67 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/evalvars.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/evalvars.c"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // b: variables"
          },
          {
            "type": "delete",
            "line": "    ht ="
          },
          {
            "type": "delete",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "delete",
            "line": "\t// In cmdwin, the alternative buffer should be used."
          },
          {
            "type": "delete",
            "line": "\tis_in_cmdwin() ? &prevwin->w_buffer->b_vars->dv_hashtab :"
          },
          {
            "type": "delete",
            "line": "#endif"
          },
          {
            "type": "delete",
            "line": "\t&curbuf->b_vars->dv_hashtab;"
          },
          {
            "type": "add",
            "line": "    ht = &prevwin_curwin()->w_buffer->b_vars->dv_hashtab;"
          },
          {
            "type": "context",
            "line": "     if (bdone < ht->ht_used)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \tif (bdone++ == 0)"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // w: variables"
          },
          {
            "type": "delete",
            "line": "    ht ="
          },
          {
            "type": "delete",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "delete",
            "line": "\t// In cmdwin, the alternative window should be used."
          },
          {
            "type": "delete",
            "line": "\tis_in_cmdwin() ? &prevwin->w_vars->dv_hashtab :"
          },
          {
            "type": "delete",
            "line": "#endif"
          },
          {
            "type": "delete",
            "line": "\t&curwin->w_vars->dv_hashtab;"
          },
          {
            "type": "add",
            "line": "    ht = &prevwin_curwin()->w_vars->dv_hashtab;"
          },
          {
            "type": "context",
            "line": "     if (wdone < ht->ht_used)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \tif (wdone++ == 0)"
          }
        ]
      },
      {
        "file": "src/proto/window.pro",
        "changes": [
          {
            "type": "context",
            "line": "index 654d36a6e..11c2d47c7 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/proto/window.pro"
          },
          {
            "type": "context",
            "line": "+++ b/src/proto/window.pro"
          },
          {
            "type": "context",
            "line": " /* window.c */"
          },
          {
            "type": "add",
            "line": "win_T *prevwin_curwin(void);"
          },
          {
            "type": "context",
            "line": " void do_window(int nchar, long Prenum, int xchar);"
          },
          {
            "type": "context",
            "line": " void get_wincmd_addr_type(char_u *arg, exarg_T *eap);"
          },
          {
            "type": "context",
            "line": " int win_split(int size, int flags);"
          }
        ]
      },
      {
        "file": "src/usercmd.c",
        "changes": [
          {
            "type": "context",
            "line": "index d4a7a9c15..1ff4d0d49 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/usercmd.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/usercmd.c"
          },
          {
            "type": "context",
            "line": "     /*"
          },
          {
            "type": "context",
            "line": "      * Look for buffer-local user commands first, then global ones."
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "delete",
            "line": "    gap ="
          },
          {
            "type": "delete",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "delete",
            "line": "\tis_in_cmdwin() ? &prevwin->w_buffer->b_ucmds :"
          },
          {
            "type": "delete",
            "line": "#endif"
          },
          {
            "type": "delete",
            "line": "\t&curbuf->b_ucmds;"
          },
          {
            "type": "add",
            "line": "    gap = &prevwin_curwin()->w_buffer->b_ucmds;"
          },
          {
            "type": "context",
            "line": "     for (;;)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \tfor (j = 0; j < gap->ga_len; ++j)"
          },
          {
            "type": "context",
            "line": " get_user_commands(expand_T *xp UNUSED, int idx)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     // In cmdwin, the alternative buffer should be used."
          },
          {
            "type": "delete",
            "line": "    buf_T *buf ="
          },
          {
            "type": "delete",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "delete",
            "line": "\tis_in_cmdwin() ? prevwin->w_buffer :"
          },
          {
            "type": "delete",
            "line": "#endif"
          },
          {
            "type": "delete",
            "line": "\tcurbuf;"
          },
          {
            "type": "add",
            "line": "    buf_T *buf = prevwin_curwin()->w_buffer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (idx < buf->b_ucmds.ga_len)"
          },
          {
            "type": "context",
            "line": " \treturn USER_CMD_GA(&buf->b_ucmds, idx)->uc_name;"
          },
          {
            "type": "context",
            "line": "     if (cmdidx == CMD_USER_BUF)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \t// In cmdwin, the alternative buffer should be used."
          },
          {
            "type": "delete",
            "line": "\tbuf_T *buf ="
          },
          {
            "type": "delete",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "delete",
            "line": "\t\t    is_in_cmdwin() ? prevwin->w_buffer :"
          },
          {
            "type": "delete",
            "line": "#endif"
          },
          {
            "type": "delete",
            "line": "\t\t    curbuf;"
          },
          {
            "type": "add",
            "line": "\tbuf_T *buf = prevwin_curwin()->w_buffer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (idx < buf->b_ucmds.ga_len)"
          },
          {
            "type": "context",
            "line": " \t    return USER_CMD_GA(&buf->b_ucmds, idx)->uc_name;"
          },
          {
            "type": "context",
            "line": "     garray_T\t*gap;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // In cmdwin, the alternative buffer should be used."
          },
          {
            "type": "delete",
            "line": "    gap ="
          },
          {
            "type": "delete",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "delete",
            "line": "\t    is_in_cmdwin() ? &prevwin->w_buffer->b_ucmds :"
          },
          {
            "type": "delete",
            "line": "#endif"
          },
          {
            "type": "delete",
            "line": "\t    &curbuf->b_ucmds;"
          },
          {
            "type": "add",
            "line": "    gap = &prevwin_curwin()->w_buffer->b_ucmds;"
          },
          {
            "type": "context",
            "line": "     for (;;)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \tfor (i = 0; i < gap->ga_len; ++i)"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index c5f5c22f9..777476d80 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    4428,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     4427,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      },
      {
        "file": "src/window.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1f5e70960..b00ed977f 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/window.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/window.c"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " * Return the current window, unless in the cmdline window and \"prevwin\" is"
          },
          {
            "type": "add",
            "line": " * set, then return \"prevwin\"."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "    win_T *"
          },
          {
            "type": "add",
            "line": "prevwin_curwin(void)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    return"
          },
          {
            "type": "add",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "add",
            "line": "\t// In cmdwin, the alternative buffer should be used."
          },
          {
            "type": "add",
            "line": "\tis_in_cmdwin() && prevwin != NULL ? prevwin :"
          },
          {
            "type": "add",
            "line": "#endif"
          },
          {
            "type": "add",
            "line": "\tcurwin;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  * All CTRL-W window commands are handled here, called from normal_cmd()."
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": "     tabpage_T\t*newtp;"
          },
          {
            "type": "context",
            "line": "     int\t\tn;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "#ifdef FEAT_CMDWIN"
          },
          {
            "type": "add",
            "line": "    if (cmdwin_type != 0)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "\temsg(_(e_invalid_in_cmdline_window));"
          },
          {
            "type": "add",
            "line": "\treturn FAIL;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "#endif"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     newtp = alloc_tabpage();"
          },
          {
            "type": "context",
            "line": "     if (newtp == NULL)"
          },
          {
            "type": "context",
            "line": " \treturn FAIL;"
          },
          {
            "type": "context",
            "line": " \ttext_locked_msg();"
          },
          {
            "type": "context",
            "line": " \treturn;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": "    CHECK_CMDWIN;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // If there is only one it can't work."
          },
          {
            "type": "context",
            "line": "     if (first_tabpage->tp_next == NULL)"
          },
          {
            "type": "context",
            "line": "     int\t\ttrigger_enter_autocmds,"
          },
          {
            "type": "context",
            "line": "     int\t\ttrigger_leave_autocmds)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "    CHECK_CMDWIN;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // Don't repeat a message in another tab page."
          },
          {
            "type": "context",
            "line": "     set_keep_msg(NULL, 0);"
          }
        ]
      }
    ]
  },
  {
    "commit": "0f886ca12765d20124bd06291c82951fd49a33be",
    "files": [
      {
        "file": "sound/usquirks.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5b03296a5bd9..529c35cceaa6 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/usb/quirks.c"
          },
          {
            "type": "context",
            "line": "+++ b/sound/usb/quirks.c"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \talts = &iface->altsetting[fp->altset_idx];"
          },
          {
            "type": "context",
            "line": " \taltsd = get_iface_desc(alts);"
          },
          {
            "type": "add",
            "line": "\tif (altsd->bNumEndpoints < 1) {"
          },
          {
            "type": "add",
            "line": "\t\tkfree(fp);"
          },
          {
            "type": "add",
            "line": "\t\tkfree(rate_table);"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfp->protocol = altsd->bInterfaceProtocol;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (fp->datainterval == 0)"
          }
        ]
      }
    ]
  },
  {
    "commit": "0fa3ecd87848c9c93c2c828ef4c3a8ca36ce46c7",
    "files": [
      {
        "file": "fs/inode.c",
        "changes": [
          {
            "type": "context",
            "line": "index 2c300e981796..8c86c809ca17 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/inode.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/inode.c"
          },
          {
            "type": "context",
            "line": " \tinode->i_uid = current_fsuid();"
          },
          {
            "type": "context",
            "line": " \tif (dir && dir->i_mode & S_ISGID) {"
          },
          {
            "type": "context",
            "line": " \t\tinode->i_gid = dir->i_gid;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t/* Directories are special, and always inherit S_ISGID */"
          },
          {
            "type": "context",
            "line": " \t\tif (S_ISDIR(mode))"
          },
          {
            "type": "context",
            "line": " \t\t\tmode |= S_ISGID;"
          },
          {
            "type": "add",
            "line": "\t\telse if ((mode & (S_ISGID | S_IXGRP)) == (S_ISGID | S_IXGRP) &&"
          },
          {
            "type": "add",
            "line": "\t\t\t !in_group_p(inode->i_gid) &&"
          },
          {
            "type": "add",
            "line": "\t\t\t !capable_wrt_inode_uidgid(dir, CAP_FSETID))"
          },
          {
            "type": "add",
            "line": "\t\t\tmode &= ~S_ISGID;"
          },
          {
            "type": "context",
            "line": " \t} else"
          },
          {
            "type": "context",
            "line": " \t\tinode->i_gid = current_fsgid();"
          },
          {
            "type": "context",
            "line": " \tinode->i_mode = mode;"
          }
        ]
      }
    ]
  },
  {
    "commit": "0ff01835a40f549c5c4a550502f62a2ac9ac447c",
    "files": [
      {
        "file": "src/insexpand.c",
        "changes": [
          {
            "type": "context",
            "line": "index 37162a48c..d3a1f881e 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/insexpand.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/insexpand.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (flag == 'w')\t\t// just windows"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "\tif (buf == curbuf || wp == NULL)  // first call for this flag/expansion"
          },
          {
            "type": "add",
            "line": "\tif (buf == curbuf || !win_valid(wp))"
          },
          {
            "type": "add",
            "line": "\t    // first call for this flag/expansion or window was closed"
          },
          {
            "type": "context",
            "line": " \t    wp = curwin;"
          },
          {
            "type": "context",
            "line": " \twhile ((wp = (wp->w_next != NULL ? wp->w_next : firstwin)) != curwin"
          },
          {
            "type": "context",
            "line": " \t\t&& wp->w_buffer->b_scanned)"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " typedef struct"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    char_u\t*e_cpt;\t\t\t// current entry in 'complete'"
          },
          {
            "type": "add",
            "line": "    char_u\t*e_cpt_copy;\t\t// copy of 'complete'"
          },
          {
            "type": "add",
            "line": "    char_u\t*e_cpt;\t\t\t// current entry in \"e_cpt_copy\""
          },
          {
            "type": "context",
            "line": "     buf_T\t*ins_buf;\t\t// buffer being scanned"
          },
          {
            "type": "delete",
            "line": "    pos_T\t*cur_match_pos;\t\t\t// current match position"
          },
          {
            "type": "add",
            "line": "    pos_T\t*cur_match_pos;\t\t// current match position"
          },
          {
            "type": "context",
            "line": "     pos_T\tprev_match_pos;\t\t// previous match position"
          },
          {
            "type": "context",
            "line": "     int\t\tset_match_pos;\t\t// save first_match_pos/last_match_pos"
          },
          {
            "type": "context",
            "line": "     pos_T\tfirst_match_pos;\t// first match position"
          },
          {
            "type": "context",
            "line": " \tst->set_match_pos = TRUE;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     else if (vim_strchr((char_u *)\"buwU\", *st->e_cpt) != NULL"
          },
          {
            "type": "delete",
            "line": "\t    && (st->ins_buf = ins_compl_next_buf(st->ins_buf, *st->e_cpt)) != curbuf)"
          },
          {
            "type": "add",
            "line": "\t    && (st->ins_buf = ins_compl_next_buf("
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t   st->ins_buf, *st->e_cpt)) != curbuf)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \t// Scan a buffer, but not the current one."
          },
          {
            "type": "context",
            "line": " \tif (st->ins_buf->b_ml.ml_mfp != NULL)   // loaded buffer"
          },
          {
            "type": "context",
            "line": "     static int"
          },
          {
            "type": "context",
            "line": " ins_compl_get_exp(pos_T *ini)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    static ins_compl_next_state_T st;"
          },
          {
            "type": "add",
            "line": "    static ins_compl_next_state_T   st;"
          },
          {
            "type": "add",
            "line": "    static int\t\t\t    st_cleared = FALSE;"
          },
          {
            "type": "context",
            "line": "     int\t\ti;"
          },
          {
            "type": "context",
            "line": "     int\t\tfound_new_match;"
          },
          {
            "type": "context",
            "line": "     int\t\ttype = ctrl_x_mode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (!compl_started)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "\tFOR_ALL_BUFFERS(st.ins_buf)"
          },
          {
            "type": "delete",
            "line": "\t    st.ins_buf->b_scanned = 0;"
          },
          {
            "type": "add",
            "line": "\tbuf_T *buf;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tFOR_ALL_BUFFERS(buf)"
          },
          {
            "type": "add",
            "line": "\t    buf->b_scanned = 0;"
          },
          {
            "type": "add",
            "line": "\tif (!st_cleared)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t    CLEAR_FIELD(st);"
          },
          {
            "type": "add",
            "line": "\t    st_cleared = TRUE;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \tst.found_all = FALSE;"
          },
          {
            "type": "context",
            "line": " \tst.ins_buf = curbuf;"
          },
          {
            "type": "delete",
            "line": "\tst.e_cpt = (compl_cont_status & CONT_LOCAL)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t    ? (char_u *)\".\" : curbuf->b_p_cpt;"
          },
          {
            "type": "add",
            "line": "\tvim_free(st.e_cpt_copy);"
          },
          {
            "type": "add",
            "line": "\t// Make a copy of 'complete', if case the buffer is wiped out."
          },
          {
            "type": "add",
            "line": "\tst.e_cpt_copy = vim_strsave((compl_cont_status & CONT_LOCAL)"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t    ? (char_u *)\".\" : curbuf->b_p_cpt);"
          },
          {
            "type": "add",
            "line": "\tst.e_cpt = st.e_cpt_copy == NULL ? (char_u *)\"\" : st.e_cpt_copy;"
          },
          {
            "type": "context",
            "line": " \tst.last_match_pos = st.first_match_pos = *ini;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     else if (st.ins_buf != curbuf && !buf_valid(st.ins_buf))"
          },
          {
            "type": "context",
            "line": "     int\t    todo = count;"
          },
          {
            "type": "context",
            "line": "     int\t    advance;"
          },
          {
            "type": "context",
            "line": "     int\t    started = compl_started;"
          },
          {
            "type": "add",
            "line": "    buf_T   *orig_curbuf = curbuf;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // When user complete function return -1 for findstart which is next"
          },
          {
            "type": "context",
            "line": "     // time of 'always', compl_shown_match become NULL."
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t\t&num_matches) == -1)"
          },
          {
            "type": "context",
            "line": " \treturn -1;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (curbuf != orig_curbuf)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "\t// In case some completion function switched buffer, don't want to"
          },
          {
            "type": "add",
            "line": "\t// insert the completion elsewhere."
          },
          {
            "type": "add",
            "line": "\treturn -1;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // Insert the text of the new completion, or the compl_leader."
          },
          {
            "type": "context",
            "line": "     if (compl_no_insert && !started)"
          },
          {
            "type": "context",
            "line": "     {"
          }
        ]
      },
      {
        "file": "src/move.c",
        "changes": [
          {
            "type": "context",
            "line": "index a51d2d128..967dd77fb 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/move.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/move.c"
          },
          {
            "type": "context",
            "line": "     void"
          },
          {
            "type": "context",
            "line": " validate_cursor(void)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "    check_cursor();"
          },
          {
            "type": "context",
            "line": "     check_cursor_moved(curwin);"
          },
          {
            "type": "context",
            "line": "     if ((curwin->w_valid & (VALID_WCOL|VALID_WROW)) != (VALID_WCOL|VALID_WROW))"
          },
          {
            "type": "context",
            "line": " \tcurs_columns(TRUE);"
          }
        ]
      },
      {
        "file": "src/testdir/test_ins_complete.vim",
        "changes": [
          {
            "type": "context",
            "line": "index 379db7fe7..3fc55ec1c 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testdir/test_ins_complete.vim"
          },
          {
            "type": "context",
            "line": "+++ b/src/testdir/test_ins_complete.vim"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   call writefile(lines, 'Xpreviewscript')"
          },
          {
            "type": "context",
            "line": "   let buf = RunVimInTerminal('-S Xpreviewscript', #{rows: 12})"
          },
          {
            "type": "delete",
            "line": "  call TermWait(buf, 50)"
          },
          {
            "type": "context",
            "line": "   call term_sendkeys(buf, \"Gi\\<C-X>\\<C-O>\")"
          },
          {
            "type": "delete",
            "line": "  call TermWait(buf, 100)"
          },
          {
            "type": "add",
            "line": "  call TermWait(buf, 200)"
          },
          {
            "type": "context",
            "line": "   call term_sendkeys(buf, \"\\<C-N>\")"
          },
          {
            "type": "context",
            "line": "   call VerifyScreenDump(buf, 'Test_pum_with_preview_win', {})"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   bwipe!"
          },
          {
            "type": "context",
            "line": " endfunc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func s:Tagfunc(t,f,o)"
          },
          {
            "type": "add",
            "line": "  bwipe!"
          },
          {
            "type": "add",
            "line": "  return []"
          },
          {
            "type": "add",
            "line": "endfunc"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\" This was using freed memory, since 'complete' was in a wiped out buffer."
          },
          {
            "type": "add",
            "line": "\" Also using a window that was closed."
          },
          {
            "type": "add",
            "line": "func Test_tagfunc_wipes_out_buffer()"
          },
          {
            "type": "add",
            "line": "  new"
          },
          {
            "type": "add",
            "line": "  set complete=.,t,w,b,u,i"
          },
          {
            "type": "add",
            "line": "  se tagfunc=s:Tagfunc"
          },
          {
            "type": "add",
            "line": "  sil norm i\u000e"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  bwipe!"
          },
          {
            "type": "add",
            "line": "endfunc"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \" vim: shiftwidth=2 sts=2 expandtab"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index ff8264415..1061e4c67 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    579,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     578,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "10080096879d1076756f62760d6daf582b6db722",
    "files": [
      {
        "file": "app/View/Elements/eventattribute.ctp",
        "changes": [
          {
            "type": "context",
            "line": "index 1be661670..65c50c39f 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/View/Elements/eventattribute.ctp"
          },
          {
            "type": "context",
            "line": "+++ b/app/View/Elements/eventattribute.ctp"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "add",
            "line": "\t$urlHere = $this->here;"
          },
          {
            "type": "add",
            "line": "\t$urlHere = explode('/', $urlHere);"
          },
          {
            "type": "add",
            "line": "\tforeach ($urlHere as $k => $v) {"
          },
          {
            "type": "add",
            "line": "\t\t$urlHere[$k] = urlencode($v);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t$urlHere = implode('/', $urlHere);"
          },
          {
            "type": "add",
            "line": "\t$urlHere = $baseurl . $urlHere;"
          },
          {
            "type": "context",
            "line": " \t$mayModify = ($isSiteAdmin || ($isAclModify && $event['Event']['user_id'] == $me['id'] && $event['Orgc']['id'] == $me['org_id']) || ($isAclModifyOrg && $event['Orgc']['id'] == $me['org_id']));"
          },
          {
            "type": "context",
            "line": " \t$mayPublish = ($isAclPublish && $event['Orgc']['id'] == $me['org_id']);"
          },
          {
            "type": "context",
            "line": " \t$mayChangeCorrelation = !Configure::read('MISP.completely_disable_correlation') && ($isSiteAdmin || ($mayModify && Configure::read('MISP.allow_disabling_correlation')));"
          },
          {
            "type": "context",
            "line": " \t\t<div id=\"filter_correlation\" title=\"Only show correlating attributes\" role=\"button\" tabindex=\"0\" aria-label=\"Only show correlating attributes\" class=\"attribute_filter_text<?php if ($attributeFilter == 'correlation') echo '_active'; ?>\" onClick=\"filterAttributes('correlation', '<?php echo h($event['Event']['id']); ?>');\">Correlation</div>"
          },
          {
            "type": "context",
            "line": " \t\t<div id=\"filter_warning\" title=\"Only show potentially false positive attributes\" role=\"button\" tabindex=\"0\" aria-label=\"Only show potentially false positive attributes\" class=\"attribute_filter_text<?php if ($attributeFilter == 'warning') echo '_active'; ?>\" onClick=\"filterAttributes('warning', '<?php echo h($event['Event']['id']); ?>');\">Warnings</div>"
          },
          {
            "type": "context",
            "line": " \t\t<?php if ($me['Role']['perm_sync'] || $event['Orgc']['id'] == $me['org_id']): ?>"
          },
          {
            "type": "delete",
            "line": "\t\t\t<div id=\"filter_deleted\" title=\"Include deleted attributes\" role=\"button\" tabindex=\"0\" aria-label=\"Include deleted attributes\" class=\"attribute_filter_text<?php if ($deleted) echo '_active'; ?>\" onClick=\"toggleDeletedAttributes('<?php echo Router::url( $this->here, true );?>');\">Include deleted attributes</div>"
          },
          {
            "type": "add",
            "line": "\t\t\t<div id=\"filter_deleted\" title=\"Include deleted attributes\" role=\"button\" tabindex=\"0\" aria-label=\"Include deleted attributes\" class=\"attribute_filter_text<?php if ($deleted) echo '_active'; ?>\" onClick=\"toggleDeletedAttributes('<?php echo $urlHere;?>');\">Include deleted attributes</div>"
          },
          {
            "type": "context",
            "line": " \t\t<?php endif; ?>"
          },
          {
            "type": "context",
            "line": " \t\t<div id=\"show_context\" title=\"Show attribute context fields\" role=\"button\" tabindex=\"0\" aria-label=\"Show attribute context fields\" class=\"attribute_filter_text\" onClick=\"toggleContextFields();\">Show context fields</div>"
          },
          {
            "type": "context",
            "line": " \t\t<div title=\"input filter\" tabindex=\"0\" aria-label=\"input filter\" class=\"attribute_filter_text\" style=\"padding-top:0px;\">"
          },
          {
            "type": "context",
            "line": " \t\t\t?>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t<th class=\"event_id\"><?php echo $this->Paginator->sort('event_id', 'Event');?></th>"
          },
          {
            "type": "context",
            "line": " \t\t\t<?php"
          },
          {
            "type": "delete",
            "line": "\t\tendif;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tendif;"
          },
          {
            "type": "context",
            "line": " \t\t\t?>"
          },
          {
            "type": "context",
            "line": " \t\t\t<th><?php echo $this->Paginator->sort('Org.name', 'Org'); ?>"
          },
          {
            "type": "context",
            "line": " \t\t\t<th><?php echo $this->Paginator->sort('category');?></th>"
          }
        ]
      }
    ]
  },
  {
    "commit": "102bb6ebf20f9174130c85c3b052ae104e5073ec",
    "files": [
      {
        "file": "src/appl/user_user/server.c",
        "changes": [
          {
            "type": "context",
            "line": "index 09ea4e0ed..f2b5b614e 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/appl/user_user/server.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/appl/user_user/server.c"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* principal name must be sent null-terminated. */"
          },
          {
            "type": "context",
            "line": "     retval = krb5_read_message(context, (krb5_pointer) &sock, &pname_data);"
          },
          {
            "type": "delete",
            "line": "    if (retval) {"
          },
          {
            "type": "add",
            "line": "    if (retval || pname_data.length == 0 ||"
          },
          {
            "type": "add",
            "line": "        pname_data.data[pname_data.length - 1] != '\\0') {"
          },
          {
            "type": "context",
            "line": "         com_err (\"uu-server\", retval, \"reading pname\");"
          },
          {
            "type": "context",
            "line": "         return 2;"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "src/likrb5/krrecvauth.c",
        "changes": [
          {
            "type": "context",
            "line": "index da8362830..5adc6dd14 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/lib/krb5/krb/recvauth.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/lib/krb5/krb/recvauth.c"
          },
          {
            "type": "context",
            "line": "     krb5_rcache           rcache = 0;"
          },
          {
            "type": "context",
            "line": "     krb5_octet            response;"
          },
          {
            "type": "context",
            "line": "     krb5_data             null_server;"
          },
          {
            "type": "add",
            "line": "    krb5_data             d;"
          },
          {
            "type": "context",
            "line": "     int                   need_error_free = 0;"
          },
          {
            "type": "context",
            "line": "     int                   local_rcache = 0, local_authcon = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "          */"
          },
          {
            "type": "context",
            "line": "         if ((retval = krb5_read_message(context, fd, &inbuf)))"
          },
          {
            "type": "context",
            "line": "             return(retval);"
          },
          {
            "type": "delete",
            "line": "        if (strcmp(inbuf.data, sendauth_version)) {"
          },
          {
            "type": "add",
            "line": "        d = make_data((char *)sendauth_version, strlen(sendauth_version) + 1);"
          },
          {
            "type": "add",
            "line": "        if (!data_eq(inbuf, d)) {"
          },
          {
            "type": "context",
            "line": "             problem = KRB5_SENDAUTH_BADAUTHVERS;"
          },
          {
            "type": "context",
            "line": "             response = 1;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     if ((retval = krb5_read_message(context, fd, &inbuf)))"
          },
          {
            "type": "context",
            "line": "         return(retval);"
          },
          {
            "type": "delete",
            "line": "    if (appl_version && strcmp(inbuf.data, appl_version)) {"
          },
          {
            "type": "delete",
            "line": "        if (!problem) {"
          },
          {
            "type": "add",
            "line": "    if (appl_version != NULL && !problem) {"
          },
          {
            "type": "add",
            "line": "        d = make_data(appl_version, strlen(appl_version) + 1);"
          },
          {
            "type": "add",
            "line": "        if (!data_eq(inbuf, d)) {"
          },
          {
            "type": "context",
            "line": "             problem = KRB5_SENDAUTH_BADAPPLVERS;"
          },
          {
            "type": "context",
            "line": "             response = 2;"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      }
    ]
  },
  {
    "commit": "103b171d8fc282ef435f8de9afbf7782e312961f",
    "files": [
      {
        "file": "ssl/d1_pkt.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1028e41b56..a8a06b439b 100644"
          },
          {
            "type": "context",
            "line": "--- a/ssl/d1_pkt.c"
          },
          {
            "type": "context",
            "line": "+++ b/ssl/d1_pkt.c"
          },
          {
            "type": "context",
            "line": " \t/* Limit the size of the queue to prevent DOS attacks */"
          },
          {
            "type": "context",
            "line": " \tif (pqueue_size(queue->q) >= 100)"
          },
          {
            "type": "context",
            "line": " \t\treturn 0;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \trdata = OPENSSL_malloc(sizeof(DTLS1_RECORD_DATA));"
          },
          {
            "type": "context",
            "line": " \titem = pitem_new(priority, rdata);"
          },
          {
            "type": "context",
            "line": " \tif (rdata == NULL || item == NULL)"
          },
          {
            "type": "context",
            "line": " \tif (!ssl3_setup_buffers(s))"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\tSSLerr(SSL_F_DTLS1_BUFFER_RECORD, ERR_R_INTERNAL_ERROR);"
          },
          {
            "type": "add",
            "line": "\t\tif (rdata->rbuf.buf != NULL)"
          },
          {
            "type": "add",
            "line": "\t\t\tOPENSSL_free(rdata->rbuf.buf);"
          },
          {
            "type": "context",
            "line": " \t\tOPENSSL_free(rdata);"
          },
          {
            "type": "context",
            "line": " \t\tpitem_free(item);"
          },
          {
            "type": "delete",
            "line": "\t\treturn(0);"
          },
          {
            "type": "add",
            "line": "\t\treturn(-1);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* insert should not fail, since duplicates are dropped */"
          },
          {
            "type": "context",
            "line": " \tif (pqueue_insert(queue->q, item) == NULL)"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\tSSLerr(SSL_F_DTLS1_BUFFER_RECORD, ERR_R_INTERNAL_ERROR);"
          },
          {
            "type": "add",
            "line": "\t\tif (rdata->rbuf.buf != NULL)"
          },
          {
            "type": "add",
            "line": "\t\t\tOPENSSL_free(rdata->rbuf.buf);"
          },
          {
            "type": "context",
            "line": " \t\tOPENSSL_free(rdata);"
          },
          {
            "type": "context",
            "line": " \t\tpitem_free(item);"
          },
          {
            "type": "delete",
            "line": "\t\treturn(0);"
          },
          {
            "type": "add",
            "line": "\t\treturn(-1);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn(1);"
          },
          {
            "type": "context",
            "line": "             dtls1_get_unprocessed_record(s);"
          },
          {
            "type": "context",
            "line": "             if ( ! dtls1_process_record(s))"
          },
          {
            "type": "context",
            "line": "                 return(0);"
          },
          {
            "type": "delete",
            "line": "            dtls1_buffer_record(s, &(s->d1->processed_rcds),"
          },
          {
            "type": "delete",
            "line": "                s->s3->rrec.seq_num);"
          },
          {
            "type": "add",
            "line": "            if(dtls1_buffer_record(s, &(s->d1->processed_rcds),"
          },
          {
            "type": "add",
            "line": "                s->s3->rrec.seq_num)<0)"
          },
          {
            "type": "add",
            "line": "                return -1;"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* we have pulled in a full packet so zero things */"
          },
          {
            "type": "context",
            "line": " \ts->packet_length=0;"
          },
          {
            "type": "delete",
            "line": "\tdtls1_record_bitmap_update(s, &(s->d1->bitmap));/* Mark receipt of record. */"
          },
          {
            "type": "context",
            "line": " \treturn(1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " f_err:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* The epoch may have changed.  If so, process all the"
          },
          {
            "type": "context",
            "line": " \t * pending records.  This is a non-blocking operation. */"
          },
          {
            "type": "delete",
            "line": "\tdtls1_process_buffered_records(s);"
          },
          {
            "type": "add",
            "line": "\tif(dtls1_process_buffered_records(s)<0)"
          },
          {
            "type": "add",
            "line": "\t\treturn -1;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* if we're renegotiating, then there may be buffered records */"
          },
          {
            "type": "context",
            "line": " \tif (dtls1_get_processed_record(s))"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\tif ((SSL_in_init(s) || s->in_handshake) && !s->d1->listen)"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\tdtls1_buffer_record(s, &(s->d1->unprocessed_rcds), rr->seq_num);"
          },
          {
            "type": "add",
            "line": "\t\t\tif(dtls1_buffer_record(s, &(s->d1->unprocessed_rcds), rr->seq_num)<0)"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn -1;"
          },
          {
            "type": "add",
            "line": "\t\t\tdtls1_record_bitmap_update(s, bitmap);/* Mark receipt of record. */"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\trr->length = 0;"
          },
          {
            "type": "context",
            "line": " \t\ts->packet_length = 0;"
          },
          {
            "type": "context",
            "line": " \t\ts->packet_length = 0;  /* dump this record */"
          },
          {
            "type": "context",
            "line": " \t\tgoto again;   /* get another record */"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": "\tdtls1_record_bitmap_update(s, bitmap);/* Mark receipt of record. */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn(1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t * buffer the application data for later processing rather"
          },
          {
            "type": "context",
            "line": " \t\t * than dropping the connection."
          },
          {
            "type": "context",
            "line": " \t\t */"
          },
          {
            "type": "delete",
            "line": "\t\tdtls1_buffer_record(s, &(s->d1->buffered_app_data), rr->seq_num);"
          },
          {
            "type": "add",
            "line": "\t\tif(dtls1_buffer_record(s, &(s->d1->buffered_app_data), rr->seq_num)<0)"
          },
          {
            "type": "add",
            "line": "\t\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\tSSLerr(SSL_F_DTLS1_READ_BYTES, ERR_R_INTERNAL_ERROR);"
          },
          {
            "type": "add",
            "line": "\t\t\treturn -1;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\trr->length = 0;"
          },
          {
            "type": "context",
            "line": " \t\tgoto start;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "104c307147ad379617472dd91a5bcb368d72bd6d",
    "files": [
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce100/dce100_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index afc61055eca1..1787b9bf800a 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce100/dce100_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce100/dce100_resource.c"
          },
          {
            "type": "context",
            "line": " \tif (construct(num_virtual_links, dc, pool))"
          },
          {
            "type": "context",
            "line": " \t\treturn &pool->base;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(pool);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce110/dce110_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index c66fe170e1e8..318e9c2e2ca8 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce110/dce110_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce110/dce110_resource.c"
          },
          {
            "type": "context",
            "line": " \tif (construct(num_virtual_links, dc, pool, asic_id))"
          },
          {
            "type": "context",
            "line": " \t\treturn &pool->base;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(pool);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce112/dce112_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 2b3a2917c168..83e1878161c9 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce112/dce112_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce112/dce112_resource.c"
          },
          {
            "type": "context",
            "line": " \tif (construct(num_virtual_links, dc, pool))"
          },
          {
            "type": "context",
            "line": " \t\treturn &pool->base;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(pool);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dce120/dce120_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 236c4c0324b1..8b85e5274bba 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dce120/dce120_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dce120/dce120_resource.c"
          },
          {
            "type": "context",
            "line": " \tif (construct(num_virtual_links, dc, pool))"
          },
          {
            "type": "context",
            "line": " \t\treturn &pool->base;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(pool);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "drivers/gpu/drm/amd/display/dc/dcn10/dcn10_resource.c",
        "changes": [
          {
            "type": "context",
            "line": "index 5a89e462e7cc..59305e411a66 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_resource.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_resource.c"
          },
          {
            "type": "context",
            "line": " \tif (construct(init_data->num_virtual_links, dc, pool))"
          },
          {
            "type": "context",
            "line": " \t\treturn &pool->base;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tkfree(pool);"
          },
          {
            "type": "context",
            "line": " \tBREAK_TO_DEBUGGER();"
          },
          {
            "type": "context",
            "line": " \treturn NULL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "105fee978d73b0ec23ff814a09d1c0c9ace95164",
    "files": [
      {
        "file": "app/controllers/tags_controller.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 1108b618cc..aa5037e2ea 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/controllers/tags_controller.rb"
          },
          {
            "type": "context",
            "line": "+++ b/app/controllers/tags_controller.rb"
          },
          {
            "type": "context",
            "line": "   include TopicQueryParams"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   before_action :ensure_tags_enabled"
          },
          {
            "type": "delete",
            "line": "  before_action :ensure_visible, only: %i[show info]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def self.show_methods"
          },
          {
            "type": "context",
            "line": "     Discourse.anonymous_filters.map { |f| :\"show_#{f}\" }"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  before_action :ensure_visible, only: [:show, :info, *show_methods]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   requires_login except: [:index, :show, :tag_feed, :search, :info, *show_methods]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   skip_before_action :check_xhr, only: [:tag_feed, :show, :index, *show_methods]"
          }
        ]
      },
      {
        "file": "spec/requests/tags_controller_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index 834589618b..ac85694fc7 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/requests/tags_controller_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/requests/tags_controller_spec.rb"
          },
          {
            "type": "context",
            "line": "           expect(response.status).to eq(200)"
          },
          {
            "type": "context",
            "line": "         end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        it \"returns a 404 when tag is restricted\" do"
          },
          {
            "type": "add",
            "line": "          tag_group = Fabricate(:tag_group, permissions: { \"staff\" => 1 }, tag_names: [\"test\"])"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "          get \"/tag/test/l/latest.json\""
          },
          {
            "type": "add",
            "line": "          expect(response.status).to eq(404)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "          sign_in(admin)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "          get \"/tag/test/l/latest.json\""
          },
          {
            "type": "add",
            "line": "          expect(response.status).to eq(200)"
          },
          {
            "type": "add",
            "line": "        end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         context \"with muted tags\" do"
          },
          {
            "type": "context",
            "line": "           before do"
          },
          {
            "type": "context",
            "line": "             TagUser.create!("
          },
          {
            "type": "context",
            "line": "       get \"/tag/#{tag.name}/l/top.json?period=decadely\""
          },
          {
            "type": "context",
            "line": "       expect(response.status).to eq(400)"
          },
          {
            "type": "context",
            "line": "     end"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it \"returns a 404 if tag is restricted\" do"
          },
          {
            "type": "add",
            "line": "      tag_group = Fabricate(:tag_group, permissions: { \"staff\" => 1 }, tag_names: [\"test\"])"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      get \"/tag/test/l/top.json\""
          },
          {
            "type": "add",
            "line": "      expect(response.status).to eq(404)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      sign_in(admin)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      get \"/tag/test/l/top.json\""
          },
          {
            "type": "add",
            "line": "      expect(response.status).to eq(200)"
          },
          {
            "type": "add",
            "line": "    end"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   describe \"#search\" do"
          }
        ]
      }
    ]
  },
  {
    "commit": "10eec60ce79187686e052092e5383c99b4420a20",
    "files": [
      {
        "file": "fs/ioctl.c",
        "changes": [
          {
            "type": "context",
            "line": "index 116a333e9c77..0f56deb24ce6 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ioctl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ioctl.c"
          },
          {
            "type": "context",
            "line": " \t\tgoto out;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tsame->dest_count = count;"
          },
          {
            "type": "context",
            "line": " \tret = vfs_dedupe_file_range(file, same);"
          },
          {
            "type": "context",
            "line": " \tif (ret)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out;"
          }
        ]
      }
    ]
  },
  {
    "commit": "1137b5e2529a8f5ca8ee709288ecba3e68044df2",
    "files": [
      {
        "file": "net/xfrm/xfrm_user.c",
        "changes": [
          {
            "type": "context",
            "line": "index b997f1395357..e44a0fed48dd 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/xfrm/xfrm_user.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/xfrm/xfrm_user.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int xfrm_dump_policy_done(struct netlink_callback *cb)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tstruct xfrm_policy_walk *walk = (struct xfrm_policy_walk *) &cb->args[1];"
          },
          {
            "type": "add",
            "line": "\tstruct xfrm_policy_walk *walk = (struct xfrm_policy_walk *)cb->args;"
          },
          {
            "type": "context",
            "line": " \tstruct net *net = sock_net(cb->skb->sk);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \txfrm_policy_walk_done(walk, net);"
          },
          {
            "type": "context",
            "line": " \treturn 0;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "static int xfrm_dump_policy_start(struct netlink_callback *cb)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tstruct xfrm_policy_walk *walk = (struct xfrm_policy_walk *)cb->args;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tBUILD_BUG_ON(sizeof(*walk) > sizeof(cb->args));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\txfrm_policy_walk_init(walk, XFRM_POLICY_TYPE_ANY);"
          },
          {
            "type": "add",
            "line": "\treturn 0;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int xfrm_dump_policy(struct sk_buff *skb, struct netlink_callback *cb)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct net *net = sock_net(skb->sk);"
          },
          {
            "type": "delete",
            "line": "\tstruct xfrm_policy_walk *walk = (struct xfrm_policy_walk *) &cb->args[1];"
          },
          {
            "type": "add",
            "line": "\tstruct xfrm_policy_walk *walk = (struct xfrm_policy_walk *)cb->args;"
          },
          {
            "type": "context",
            "line": " \tstruct xfrm_dump_info info;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tBUILD_BUG_ON(sizeof(struct xfrm_policy_walk) >"
          },
          {
            "type": "delete",
            "line": "\t\t     sizeof(cb->args) - sizeof(cb->args[0]));"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tinfo.in_skb = cb->skb;"
          },
          {
            "type": "context",
            "line": " \tinfo.out_skb = skb;"
          },
          {
            "type": "context",
            "line": " \tinfo.nlmsg_seq = cb->nlh->nlmsg_seq;"
          },
          {
            "type": "context",
            "line": " \tinfo.nlmsg_flags = NLM_F_MULTI;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!cb->args[0]) {"
          },
          {
            "type": "delete",
            "line": "\t\tcb->args[0] = 1;"
          },
          {
            "type": "delete",
            "line": "\t\txfrm_policy_walk_init(walk, XFRM_POLICY_TYPE_ANY);"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t(void) xfrm_policy_walk(net, walk, dump_one_policy, &info);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn skb->len;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static const struct xfrm_link {"
          },
          {
            "type": "context",
            "line": " \tint (*doit)(struct sk_buff *, struct nlmsghdr *, struct nlattr **);"
          },
          {
            "type": "add",
            "line": "\tint (*start)(struct netlink_callback *);"
          },
          {
            "type": "context",
            "line": " \tint (*dump)(struct sk_buff *, struct netlink_callback *);"
          },
          {
            "type": "context",
            "line": " \tint (*done)(struct netlink_callback *);"
          },
          {
            "type": "context",
            "line": " \tconst struct nla_policy *nla_pol;"
          },
          {
            "type": "context",
            "line": " \t[XFRM_MSG_NEWPOLICY   - XFRM_MSG_BASE] = { .doit = xfrm_add_policy    },"
          },
          {
            "type": "context",
            "line": " \t[XFRM_MSG_DELPOLICY   - XFRM_MSG_BASE] = { .doit = xfrm_get_policy    },"
          },
          {
            "type": "context",
            "line": " \t[XFRM_MSG_GETPOLICY   - XFRM_MSG_BASE] = { .doit = xfrm_get_policy,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\t   .start = xfrm_dump_policy_start,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t   .dump = xfrm_dump_policy,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t   .done = xfrm_dump_policy_done },"
          },
          {
            "type": "context",
            "line": " \t[XFRM_MSG_ALLOCSPI    - XFRM_MSG_BASE] = { .doit = xfrm_alloc_userspi },"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tstruct netlink_dump_control c = {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t.start = link->start,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t.dump = link->dump,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t.done = link->done,"
          },
          {
            "type": "context",
            "line": " \t\t\t};"
          }
        ]
      }
    ]
  },
  {
    "commit": "11555828d2cf289b350baba5ad1f462f10b80b76",
    "files": [
      {
        "file": "channels/urbdrc/client/data_transfer.c",
        "changes": [
          {
            "type": "context",
            "line": "index d8725c02c..aabeef847 100644"
          },
          {
            "type": "context",
            "line": "--- a/channels/urbdrc/client/data_transfer.c"
          },
          {
            "type": "context",
            "line": "+++ b/channels/urbdrc/client/data_transfer.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tStream_Read_UINT32(s, OutputBufferSize);"
          },
          {
            "type": "context",
            "line": " \tStream_Read_UINT32(s, RequestId);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (OutputBufferSize > UINT32_MAX - 4)"
          },
          {
            "type": "add",
            "line": "\t\treturn ERROR_INVALID_DATA;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tInterfaceId = ((STREAM_ID_PROXY << 30) | pdev->get_ReqCompletion(pdev));"
          },
          {
            "type": "context",
            "line": " \tout = urb_create_iocompletion(InterfaceId, MessageId, RequestId, OutputBufferSize + 4);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tStream_Read_UINT32(s, TransferFlags); /** TransferFlags */"
          },
          {
            "type": "context",
            "line": " \tStream_Read_UINT32(s, OutputBufferSize);"
          },
          {
            "type": "context",
            "line": " \tEndpointAddress = (PipeHandle & 0x000000ff);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (transferDir == USBD_TRANSFER_DIRECTION_OUT)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tif (!Stream_CheckAndLogRequiredLength(TAG, s, OutputBufferSize))"
          },
          {
            "type": "add",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\treturn ERROR_INVALID_DATA;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**  process TS_URB_BULK_OR_INTERRUPT_TRANSFER */"
          },
          {
            "type": "context",
            "line": " \treturn pdev->bulk_or_interrupt_transfer("
          },
          {
            "type": "context",
            "line": " \t    pdev, callback, MessageId, RequestId, EndpointAddress, TransferFlags, noAck,"
          },
          {
            "type": "context",
            "line": " \tpacketDescriptorData = Stream_Pointer(s);"
          },
          {
            "type": "context",
            "line": " \tStream_Seek(s, NumberOfPackets * 12);"
          },
          {
            "type": "context",
            "line": " \tStream_Read_UINT32(s, OutputBufferSize);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (transferDir == USBD_TRANSFER_DIRECTION_OUT)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tif (!Stream_CheckAndLogRequiredLength(TAG, s, OutputBufferSize))"
          },
          {
            "type": "add",
            "line": "\t\t\treturn ERROR_INVALID_DATA;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn pdev->isoch_transfer("
          },
          {
            "type": "context",
            "line": " \t    pdev, callback, MessageId, RequestId, EndpointAddress, TransferFlags, StartFrame,"
          },
          {
            "type": "context",
            "line": " \t    ErrorCount, noAck, packetDescriptorData, NumberOfPackets, OutputBufferSize,"
          }
        ]
      }
    ]
  },
  {
    "commit": "11977f917506d950b7e0cae558bd9189260b253b",
    "files": [
      {
        "file": "src/textformat.c",
        "changes": [
          {
            "type": "context",
            "line": "index 6a93890bd..7ebbc8849 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/textformat.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/textformat.c"
          },
          {
            "type": "context",
            "line": "     if (leader1_len == 0)"
          },
          {
            "type": "context",
            "line": " \treturn (leader2_len == 0);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    char_u  *lnum_line = NULL;"
          },
          {
            "type": "add",
            "line": "    int\t    line_len = 0;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // If first leader has 'f' flag, the lines can be joined only if the"
          },
          {
            "type": "context",
            "line": "     // second line does not have a leader."
          },
          {
            "type": "context",
            "line": "     // If first leader has 'e' flag, the lines can never be joined."
          },
          {
            "type": "context",
            "line": " \t\treturn FALSE;"
          },
          {
            "type": "context",
            "line": " \t    if (*p == COM_START)"
          },
          {
            "type": "context",
            "line": " \t    {"
          },
          {
            "type": "delete",
            "line": "\t\tif (*(ml_get(lnum) + leader1_len) == NUL)"
          },
          {
            "type": "add",
            "line": "\t\tif (lnum_line == NULL)"
          },
          {
            "type": "add",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t    lnum_line = ml_get(lnum);"
          },
          {
            "type": "add",
            "line": "\t\t    line_len = (int)STRLEN(lnum_line);"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif (line_len <= leader1_len)"
          },
          {
            "type": "context",
            "line": " \t\t    return FALSE;"
          },
          {
            "type": "context",
            "line": " \t\tif (leader2_flags == NULL || leader2_len == 0)"
          },
          {
            "type": "context",
            "line": " \t\t    return FALSE;"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index 29c788d2b..6a11b7fcb 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    1225,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     1224,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "11f3710417d026ea2f4fcf362d866342c5274185",
    "files": [
      {
        "file": "fs/overlayfs/dir.c",
        "changes": [
          {
            "type": "context",
            "line": "index 52f6de5d40a9..bc1758a160f6 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/overlayfs/dir.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/overlayfs/dir.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \tstruct dentry *upperdir = ovl_dentry_upper(dentry->d_parent);"
          },
          {
            "type": "context",
            "line": " \tstruct inode *dir = upperdir->d_inode;"
          },
          {
            "type": "delete",
            "line": "\tstruct dentry *upper = ovl_dentry_upper(dentry);"
          },
          {
            "type": "add",
            "line": "\tstruct dentry *upper;"
          },
          {
            "type": "context",
            "line": " \tint err;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tinode_lock_nested(dir, I_MUTEX_PARENT);"
          },
          {
            "type": "add",
            "line": "\tupper = lookup_one_len(dentry->d_name.name, upperdir,"
          },
          {
            "type": "add",
            "line": "\t\t\t       dentry->d_name.len);"
          },
          {
            "type": "add",
            "line": "\terr = PTR_ERR(upper);"
          },
          {
            "type": "add",
            "line": "\tif (IS_ERR(upper))"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_unlock;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \terr = -ESTALE;"
          },
          {
            "type": "delete",
            "line": "\tif (upper->d_parent == upperdir) {"
          },
          {
            "type": "delete",
            "line": "\t\t/* Don't let d_delete() think it can reset d_inode */"
          },
          {
            "type": "delete",
            "line": "\t\tdget(upper);"
          },
          {
            "type": "add",
            "line": "\tif (upper == ovl_dentry_upper(dentry)) {"
          },
          {
            "type": "context",
            "line": " \t\tif (is_dir)"
          },
          {
            "type": "context",
            "line": " \t\t\terr = vfs_rmdir(dir, upper);"
          },
          {
            "type": "context",
            "line": " \t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\terr = vfs_unlink(dir, upper, NULL);"
          },
          {
            "type": "delete",
            "line": "\t\tdput(upper);"
          },
          {
            "type": "context",
            "line": " \t\tovl_dentry_version_inc(dentry->d_parent);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": "\tdput(upper);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * Keeping this dentry hashed would mean having to release"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tif (!err)"
          },
          {
            "type": "context",
            "line": " \t\td_drop(dentry);"
          },
          {
            "type": "add",
            "line": "out_unlock:"
          },
          {
            "type": "context",
            "line": " \tinode_unlock(dir);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn err;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ttrap = lock_rename(new_upperdir, old_upperdir);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tolddentry = ovl_dentry_upper(old);"
          },
          {
            "type": "delete",
            "line": "\tnewdentry = ovl_dentry_upper(new);"
          },
          {
            "type": "delete",
            "line": "\tif (newdentry) {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tolddentry = lookup_one_len(old->d_name.name, old_upperdir,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t   old->d_name.len);"
          },
          {
            "type": "add",
            "line": "\terr = PTR_ERR(olddentry);"
          },
          {
            "type": "add",
            "line": "\tif (IS_ERR(olddentry))"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_unlock;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\terr = -ESTALE;"
          },
          {
            "type": "add",
            "line": "\tif (olddentry != ovl_dentry_upper(old))"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_dput_old;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tnewdentry = lookup_one_len(new->d_name.name, new_upperdir,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t   new->d_name.len);"
          },
          {
            "type": "add",
            "line": "\terr = PTR_ERR(newdentry);"
          },
          {
            "type": "add",
            "line": "\tif (IS_ERR(newdentry))"
          },
          {
            "type": "add",
            "line": "\t\tgoto out_dput_old;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\terr = -ESTALE;"
          },
          {
            "type": "add",
            "line": "\tif (ovl_dentry_upper(new)) {"
          },
          {
            "type": "context",
            "line": " \t\tif (opaquedir) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tnewdentry = opaquedir;"
          },
          {
            "type": "delete",
            "line": "\t\t\topaquedir = NULL;"
          },
          {
            "type": "add",
            "line": "\t\t\tif (newdentry != opaquedir)"
          },
          {
            "type": "add",
            "line": "\t\t\t\tgoto out_dput;"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\tdget(newdentry);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (newdentry != ovl_dentry_upper(new))"
          },
          {
            "type": "add",
            "line": "\t\t\t\tgoto out_dput;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t} else {"
          },
          {
            "type": "context",
            "line": " \t\tnew_create = true;"
          },
          {
            "type": "delete",
            "line": "\t\tnewdentry = lookup_one_len(new->d_name.name, new_upperdir,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t   new->d_name.len);"
          },
          {
            "type": "delete",
            "line": "\t\terr = PTR_ERR(newdentry);"
          },
          {
            "type": "delete",
            "line": "\t\tif (IS_ERR(newdentry))"
          },
          {
            "type": "delete",
            "line": "\t\t\tgoto out_unlock;"
          },
          {
            "type": "add",
            "line": "\t\tif (!d_is_negative(newdentry) &&"
          },
          {
            "type": "add",
            "line": "\t\t    (!new_opaque || !ovl_is_whiteout(newdentry)))"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto out_dput;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\terr = -ESTALE;"
          },
          {
            "type": "delete",
            "line": "\tif (olddentry->d_parent != old_upperdir)"
          },
          {
            "type": "delete",
            "line": "\t\tgoto out_dput;"
          },
          {
            "type": "delete",
            "line": "\tif (newdentry->d_parent != new_upperdir)"
          },
          {
            "type": "delete",
            "line": "\t\tgoto out_dput;"
          },
          {
            "type": "context",
            "line": " \tif (olddentry == trap)"
          },
          {
            "type": "context",
            "line": " \t\tgoto out_dput;"
          },
          {
            "type": "context",
            "line": " \tif (newdentry == trap)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " out_dput:"
          },
          {
            "type": "context",
            "line": " \tdput(newdentry);"
          },
          {
            "type": "add",
            "line": "out_dput_old:"
          },
          {
            "type": "add",
            "line": "\tdput(olddentry);"
          },
          {
            "type": "context",
            "line": " out_unlock:"
          },
          {
            "type": "context",
            "line": " \tunlock_rename(new_upperdir, old_upperdir);"
          },
          {
            "type": "context",
            "line": " out_revert_creds:"
          }
        ]
      }
    ]
  },
  {
    "commit": "1208953ba1d4d55a18a639846bbcdd66a2d5bc5e",
    "files": [
      {
        "file": "apps/files_versions/listorage.php",
        "changes": [
          {
            "type": "context",
            "line": "index 1062f49cf69..cf99f62b832 100644"
          },
          {
            "type": "context",
            "line": "--- a/apps/files_versions/lib/storage.php"
          },
          {
            "type": "context",
            "line": "+++ b/apps/files_versions/lib/storage.php"
          },
          {
            "type": "context",
            "line": " \t\t//until the end one version per week"
          },
          {
            "type": "context",
            "line": " \t\t6 => array('intervalEndsAfter' => -1,      'step' => 604800),"
          },
          {
            "type": "context",
            "line": " \t);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/** @var \\OCA\\Files_Versions\\AppInfo\\Application */"
          },
          {
            "type": "context",
            "line": " \tprivate static $application;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t$files_view = new View('/'. User::getUser().'/files');"
          },
          {
            "type": "context",
            "line": " \t\t\t$versionCreated = false;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t$fileInfo = $files_view->getFileInfo($file);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t// check if user has the permissions to revert a version"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!$fileInfo->isUpdateable()) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t//first create a new version"
          },
          {
            "type": "context",
            "line": " \t\t\t$version = 'files_versions'.$filename.'.v'.$users_view->filemtime('files'.$filename);"
          },
          {
            "type": "context",
            "line": " \t\t\tif (!$users_view->file_exists($version)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t// This has to happen manually here since the file is manually copied below"
          },
          {
            "type": "context",
            "line": " \t\t\t$oldVersion = $users_view->getFileInfo($fileToRestore)->getEncryptedVersion();"
          },
          {
            "type": "context",
            "line": " \t\t\t$oldFileInfo = $users_view->getFileInfo($fileToRestore);"
          },
          {
            "type": "delete",
            "line": "\t\t\t$newFileInfo = $files_view->getFileInfo($filename);"
          },
          {
            "type": "delete",
            "line": "\t\t\t$cache = $newFileInfo->getStorage()->getCache();"
          },
          {
            "type": "add",
            "line": "\t\t\t$cache = $fileInfo->getStorage()->getCache();"
          },
          {
            "type": "context",
            "line": " \t\t\t$cache->update("
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$newFileInfo->getId(), ["
          },
          {
            "type": "add",
            "line": "\t\t\t\t$fileInfo->getId(), ["
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t'encrypted' => $oldVersion,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t'encryptedVersion' => $oldVersion,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t'size' => $oldFileInfo->getSize()"
          },
          {
            "type": "context",
            "line": " \tpublic static function expire($filename) {"
          },
          {
            "type": "context",
            "line": " \t\t$config = \\OC::$server->getConfig();"
          },
          {
            "type": "context",
            "line": " \t\t$expiration = self::getExpiration();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif($config->getSystemValue('files_versions', Storage::DEFAULTENABLED)=='true' && $expiration->isEnabled()) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tif (!Filesystem::file_exists($filename)) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "12176503366885edd542389eed3aaf94be163fdb",
    "files": [
      {
        "file": "fs/compat_ioctl.c",
        "changes": [
          {
            "type": "context",
            "line": "index f5054025f9da..4c6285fff598 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/compat_ioctl.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/compat_ioctl.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \terr  = get_user(palp, &up->palette);"
          },
          {
            "type": "context",
            "line": " \terr |= get_user(length, &up->length);"
          },
          {
            "type": "add",
            "line": "\tif (err)"
          },
          {
            "type": "add",
            "line": "\t\treturn -EFAULT;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tup_native = compat_alloc_user_space(sizeof(struct video_spu_palette));"
          },
          {
            "type": "context",
            "line": " \terr  = put_user(compat_ptr(palp), &up_native->palette);"
          }
        ]
      }
    ]
  },
  {
    "commit": "124751d5e63c823092060074bd0abaae61aaa9c4",
    "files": [
      {
        "file": "sound/usmixer.c",
        "changes": [
          {
            "type": "context",
            "line": "index 9732edf77f86..91bc8f18791e 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/usb/mixer.c"
          },
          {
            "type": "context",
            "line": "+++ b/sound/usb/mixer.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static void snd_usb_mixer_free(struct usb_mixer_interface *mixer)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "\t/* kill pending URBs */"
          },
          {
            "type": "add",
            "line": "\tsnd_usb_mixer_disconnect(mixer);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tkfree(mixer->id_elems);"
          },
          {
            "type": "context",
            "line": " \tif (mixer->urb) {"
          },
          {
            "type": "context",
            "line": " \t\tkfree(mixer->urb->transfer_buffer);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void snd_usb_mixer_disconnect(struct usb_mixer_interface *mixer)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tusb_kill_urb(mixer->urb);"
          },
          {
            "type": "delete",
            "line": "\tusb_kill_urb(mixer->rc_urb);"
          },
          {
            "type": "add",
            "line": "\tif (mixer->disconnected)"
          },
          {
            "type": "add",
            "line": "\t\treturn;"
          },
          {
            "type": "add",
            "line": "\tif (mixer->urb)"
          },
          {
            "type": "add",
            "line": "\t\tusb_kill_urb(mixer->urb);"
          },
          {
            "type": "add",
            "line": "\tif (mixer->rc_urb)"
          },
          {
            "type": "add",
            "line": "\t\tusb_kill_urb(mixer->rc_urb);"
          },
          {
            "type": "add",
            "line": "\tmixer->disconnected = true;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #ifdef CONFIG_PM"
          }
        ]
      },
      {
        "file": "sound/usmixer.h",
        "changes": [
          {
            "type": "context",
            "line": "index 2b4b067646ab..545d99b09706 100644"
          },
          {
            "type": "context",
            "line": "--- a/sound/usb/mixer.h"
          },
          {
            "type": "context",
            "line": "+++ b/sound/usb/mixer.h"
          },
          {
            "type": "context",
            "line": " \tstruct urb *rc_urb;"
          },
          {
            "type": "context",
            "line": " \tstruct usb_ctrlrequest *rc_setup_packet;"
          },
          {
            "type": "context",
            "line": " \tu8 rc_buffer[6];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbool disconnected;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define MAX_CHANNELS\t16\t/* max logical channels */"
          }
        ]
      }
    ]
  },
  {
    "commit": "124b7dd6d9a4ad24d4d49f74701f05a13e56ceee",
    "files": [
      {
        "file": "engine/src/main/java/org/hibernate/validator/internal/constraintvalidators/hv/SafeHtmlValidator.java",
        "changes": [
          {
            "type": "context",
            "line": "index 89dd07f43..ebefed7d2 100644"
          },
          {
            "type": "context",
            "line": "--- a/engine/src/main/java/org/hibernate/validator/internal/constraintvalidators/hv/SafeHtmlValidator.java"
          },
          {
            "type": "context",
            "line": "+++ b/engine/src/main/java/org/hibernate/validator/internal/constraintvalidators/hv/SafeHtmlValidator.java"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " package org.hibernate.validator.internal.constraintvalidators.hv;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import java.util.Iterator;"
          },
          {
            "type": "add",
            "line": "import java.util.List;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import javax.validation.ConstraintValidator;"
          },
          {
            "type": "context",
            "line": " import javax.validation.ConstraintValidatorContext;"
          },
          {
            "type": "context",
            "line": " import org.hibernate.validator.constraints.SafeHtml;"
          },
          {
            "type": "context",
            "line": " import org.jsoup.Jsoup;"
          },
          {
            "type": "context",
            "line": " import org.jsoup.nodes.Document;"
          },
          {
            "type": "delete",
            "line": "import org.jsoup.nodes.Element;"
          },
          {
            "type": "add",
            "line": "import org.jsoup.nodes.Node;"
          },
          {
            "type": "context",
            "line": " import org.jsoup.parser.Parser;"
          },
          {
            "type": "context",
            "line": " import org.jsoup.safety.Cleaner;"
          },
          {
            "type": "context",
            "line": " import org.jsoup.safety.Whitelist;"
          },
          {
            "type": "context",
            "line": " \t\tDocument document = Document.createShell( baseURI );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// add the fragment's nodes to the body of resulting document"
          },
          {
            "type": "delete",
            "line": "\t\tIterator<Element> nodes = fragment.children().iterator();"
          },
          {
            "type": "delete",
            "line": "\t\twhile ( nodes.hasNext() ) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tdocument.body().appendChild( nodes.next() );"
          },
          {
            "type": "add",
            "line": "\t\tList<Node> childNodes = fragment.childNodes();"
          },
          {
            "type": "add",
            "line": "\t\tfor ( Node node : childNodes ) {"
          },
          {
            "type": "add",
            "line": "\t\t\tdocument.body().appendChild( node.clone() );"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\treturn document;"
          }
        ]
      },
      {
        "file": "engine/src/test/java/org/hibernate/validator/test/internal/constraintvalidators/hv/SafeHtmlValidatorTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 7eb9e3173..45e6f031d 100644"
          },
          {
            "type": "context",
            "line": "--- a/engine/src/test/java/org/hibernate/validator/test/internal/constraintvalidators/hv/SafeHtmlValidatorTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/engine/src/test/java/org/hibernate/validator/test/internal/constraintvalidators/hv/SafeHtmlValidatorTest.java"
          },
          {
            "type": "context",
            "line": " \t\tassertFalse( getSafeHtmlValidator().isValid( \"Hello<script>alert('Doh')</script>World !\", null ) );"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t@Test"
          },
          {
            "type": "add",
            "line": "\t// A \"downlevel revealed\" conditional 'comment' is not an (X)HTML comment at all,"
          },
          {
            "type": "add",
            "line": "\t// despite the misleading name, it is default Microsoft syntax."
          },
          {
            "type": "add",
            "line": "\t// The tag is unrecognized by therefore executed"
          },
          {
            "type": "add",
            "line": "\tpublic void testDownlevelRevealedConditionalComment() throws Exception {"
          },
          {
            "type": "add",
            "line": "\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tassertFalse( getSafeHtmlValidator().isValid( \"<![if !IE]>\\n<SCRIPT>alert{'XSS'};</SCRIPT>\\n<![endif]>\", null ) );"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t@Test"
          },
          {
            "type": "add",
            "line": "\tpublic void testDownlevelHiddenConditionalComment() throws Exception {"
          },
          {
            "type": "add",
            "line": "\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tassertFalse( getSafeHtmlValidator().isValid( \"<!--[if gte IE 4]>\\n<SCRIPT>alert{'XSS'};</SCRIPT>\\n<![endif]-->\", null ) );"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t@Test"
          },
          {
            "type": "add",
            "line": "\tpublic void testSimpleComment() throws Exception {"
          },
          {
            "type": "add",
            "line": "\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tassertFalse( getSafeHtmlValidator().isValid( \"<!-- Just a comment -->\", null ) );"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t@Test"
          },
          {
            "type": "add",
            "line": "\tpublic void testServerSideIncludesSSI() throws Exception {"
          },
          {
            "type": "add",
            "line": "\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tassertFalse( getSafeHtmlValidator().isValid( \"<? echo{'<SCR}'; echo{'IPT>alert{\\\"XSS\\\"}</SCRIPT>'}; ?>\", null ) );"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t@Test"
          },
          {
            "type": "add",
            "line": "\tpublic void testPHPScript() throws Exception {"
          },
          {
            "type": "add",
            "line": "\t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tassertFalse( getSafeHtmlValidator().isValid( \"<? echo{'<SCR}'; echo{'IPT>alert{\\\"XSS\\\"}</SCRIPT>'}; ?>\", null ) );"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t@Test"
          },
          {
            "type": "context",
            "line": " \tpublic void testInvalidIncompleteImgTagWithScriptIncluded() {"
          },
          {
            "type": "context",
            "line": " \t\tdescriptorBuilder.setAttribute( \"whitelistType\", WhiteListType.BASIC );"
          }
        ]
      }
    ]
  },
  {
    "commit": "124d3b7041f9a0ca7c43a6293e1cae4576c32fd5",
    "files": [
      {
        "file": "mm/filemap.c",
        "changes": [
          {
            "type": "context",
            "line": "index 89ce6fe5f8be..76bea88cbebc 100644"
          },
          {
            "type": "context",
            "line": "--- a/mm/filemap.c"
          },
          {
            "type": "context",
            "line": "+++ b/mm/filemap.c"
          },
          {
            "type": "context",
            "line": " \t\tconst struct iovec *iov = i->iov;"
          },
          {
            "type": "context",
            "line": " \t\tsize_t base = i->iov_offset;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\twhile (bytes) {"
          },
          {
            "type": "add",
            "line": "\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t * The !iov->iov_len check ensures we skip over unlikely"
          },
          {
            "type": "add",
            "line": "\t\t * zero-length segments."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\twhile (bytes || !iov->iov_len) {"
          },
          {
            "type": "context",
            "line": " \t\t\tint copy = min(bytes, iov->iov_len - base);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tbytes -= copy;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tcond_resched();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tiov_iter_advance(i, copied);"
          },
          {
            "type": "context",
            "line": " \t\tif (unlikely(copied == 0)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t/*"
          },
          {
            "type": "context",
            "line": " \t\t\t * If we were unable to copy any data at all, we must"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\tiov_iter_single_seg_count(i));"
          },
          {
            "type": "context",
            "line": " \t\t\tgoto again;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\tiov_iter_advance(i, copied);"
          },
          {
            "type": "context",
            "line": " \t\tpos += copied;"
          },
          {
            "type": "context",
            "line": " \t\twritten += copied;"
          }
        ]
      }
    ]
  },
  {
    "commit": "1273cdc706eeedf8346d4b9faa5b33435056061d",
    "files": [
      {
        "file": "src/media_tools/av_parsers.c",
        "changes": [
          {
            "type": "context",
            "line": "index 49f390098..d9d13d0a7 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/media_tools/av_parsers.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/media_tools/av_parsers.c"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tvps->num_output_layer_sets = num_add_olss + NumLayerSets;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (vps->num_output_layer_sets > MAX_LHVC_LAYERS) {"
          },
          {
            "type": "add",
            "line": "\t\tGF_LOG(GF_LOG_ERROR, GF_LOG_CODING, (\"[HEVC] Wrong number of output layer sets in VPS %d, max %d supported\\n\", vps->num_output_layer_sets, MAX_LHVC_LAYERS));"
          },
          {
            "type": "add",
            "line": "\t\tvps->num_output_layer_sets = 1;"
          },
          {
            "type": "add",
            "line": "\t\treturn GF_FALSE;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tlayer_set_idx_for_ols_minus1[0] = 1;"
          },
          {
            "type": "context",
            "line": " \tvps->output_layer_flag[0][0] = 1;"
          }
        ]
      }
    ]
  },
  {
    "commit": "128394eff343fc6d2f32172f03e24829539c5835",
    "files": [
      {
        "file": "block/bsg.c",
        "changes": [
          {
            "type": "context",
            "line": "index 8a05a404ae70..a57046de2f07 100644"
          },
          {
            "type": "context",
            "line": "--- a/block/bsg.c"
          },
          {
            "type": "context",
            "line": "+++ b/block/bsg.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdprintk(\"%s: write %Zd bytes\\n\", bd->name, count);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (unlikely(segment_eq(get_fs(), KERNEL_DS)))"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tbsg_set_block(bd, file);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tbytes_written = 0;"
          }
        ]
      },
      {
        "file": "drivers/scsi/sg.c",
        "changes": [
          {
            "type": "context",
            "line": "index 070332eb41f3..dbe5b4b95df0 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/scsi/sg.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/scsi/sg.c"
          },
          {
            "type": "context",
            "line": " \tsg_io_hdr_t *hp;"
          },
          {
            "type": "context",
            "line": " \tunsigned char cmnd[SG_MAX_CDB_SIZE];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (unlikely(segment_eq(get_fs(), KERNEL_DS)))"
          },
          {
            "type": "add",
            "line": "\t\treturn -EINVAL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif ((!(sfp = (Sg_fd *) filp->private_data)) || (!(sdp = sfp->parentdp)))"
          },
          {
            "type": "context",
            "line": " \t\treturn -ENXIO;"
          },
          {
            "type": "context",
            "line": " \tSCSI_LOG_TIMEOUT(3, sg_printk(KERN_INFO, sdp,"
          }
        ]
      }
    ]
  },
  {
    "commit": "128c0c21607a71f411611a0104b2a8c858dd6fca",
    "files": [
      {
        "file": "liclasses/output/mustache_pix_helper.php",
        "changes": [
          {
            "type": "context",
            "line": "index 3de09778a6e..9bc374d1414 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/classes/output/mustache_pix_helper.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/classes/output/mustache_pix_helper.php"
          },
          {
            "type": "context",
            "line": "         if (!$component) {"
          },
          {
            "type": "context",
            "line": "             $component = '';"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "delete",
            "line": "        $component = $helper->render($component);"
          },
          {
            "type": "context",
            "line": "         $text = strtok(\"\");"
          },
          {
            "type": "context",
            "line": "         // Allow mustache tags in the last argument."
          },
          {
            "type": "context",
            "line": "         $text = trim($helper->render($text));"
          }
        ]
      }
    ]
  },
  {
    "commit": "128c66429247add5128c03dc1e144ca56f05a4e2",
    "files": [
      {
        "file": "drivers/crypto/ccp/ccp-ops.c",
        "changes": [
          {
            "type": "context",
            "line": "index c8da8eb160da..422193690fd4 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/crypto/ccp/ccp-ops.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/crypto/ccp/ccp-ops.c"
          },
          {
            "type": "context",
            "line": " \t\t\t       LSB_ITEM_SIZE);"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          },
          {
            "type": "context",
            "line": " \t\tdefault:"
          },
          {
            "type": "add",
            "line": "\t\t\tkfree(hmac_buf);"
          },
          {
            "type": "context",
            "line": " \t\t\tret = -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\t\t\tgoto e_ctx;"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto e_data;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tmemset(&hmac_cmd, 0, sizeof(hmac_cmd));"
          }
        ]
      }
    ]
  },
  {
    "commit": "129a72a0d3c8e139a04512325384fe5ac119e74d",
    "files": [
      {
        "file": "arch/x86/kvm/emulate.c",
        "changes": [
          {
            "type": "context",
            "line": "index 56628a44668b..f36d0fa6b885 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/kvm/emulate.c"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/kvm/emulate.c"
          },
          {
            "type": "context",
            "line": " \treturn ctxt->ops->read_std(ctxt, linear, data, size, &ctxt->exception);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "static int segmented_write_std(struct x86_emulate_ctxt *ctxt,"
          },
          {
            "type": "add",
            "line": "\t\t\t       struct segmented_address addr,"
          },
          {
            "type": "add",
            "line": "\t\t\t       void *data,"
          },
          {
            "type": "add",
            "line": "\t\t\t       unsigned int size)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tint rc;"
          },
          {
            "type": "add",
            "line": "\tulong linear;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\trc = linearize(ctxt, addr, size, true, &linear);"
          },
          {
            "type": "add",
            "line": "\tif (rc != X86EMUL_CONTINUE)"
          },
          {
            "type": "add",
            "line": "\t\treturn rc;"
          },
          {
            "type": "add",
            "line": "\treturn ctxt->ops->write_std(ctxt, linear, data, size, &ctxt->exception);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  * Prefetch the remaining bytes of the instruction without crossing page"
          },
          {
            "type": "context",
            "line": "  * boundary if they are not in fetch_cache yet."
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t/* Disable writeback. */"
          },
          {
            "type": "context",
            "line": " \tctxt->dst.type = OP_NONE;"
          },
          {
            "type": "delete",
            "line": "\treturn segmented_write(ctxt, ctxt->dst.addr.mem,"
          },
          {
            "type": "delete",
            "line": "\t\t\t       &desc_ptr, 2 + ctxt->op_bytes);"
          },
          {
            "type": "add",
            "line": "\treturn segmented_write_std(ctxt, ctxt->dst.addr.mem,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t   &desc_ptr, 2 + ctxt->op_bytes);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int em_sgdt(struct x86_emulate_ctxt *ctxt)"
          },
          {
            "type": "context",
            "line": " \telse"
          },
          {
            "type": "context",
            "line": " \t\tsize = offsetof(struct fxregs_state, xmm_space[0]);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\treturn segmented_write(ctxt, ctxt->memop.addr.mem, &fx_state, size);"
          },
          {
            "type": "add",
            "line": "\treturn segmented_write_std(ctxt, ctxt->memop.addr.mem, &fx_state, size);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int fxrstor_fixup(struct x86_emulate_ctxt *ctxt,"
          },
          {
            "type": "context",
            "line": " \tif (rc != X86EMUL_CONTINUE)"
          },
          {
            "type": "context",
            "line": " \t\treturn rc;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\trc = segmented_read(ctxt, ctxt->memop.addr.mem, &fx_state, 512);"
          },
          {
            "type": "add",
            "line": "\trc = segmented_read_std(ctxt, ctxt->memop.addr.mem, &fx_state, 512);"
          },
          {
            "type": "context",
            "line": " \tif (rc != X86EMUL_CONTINUE)"
          },
          {
            "type": "context",
            "line": " \t\treturn rc;"
          }
        ]
      }
    ]
  },
  {
    "commit": "12ae030d54ef250706da5642fc7697cc60ad0df7",
    "files": [
      {
        "file": "kernel/trace/trace_event_perf.c",
        "changes": [
          {
            "type": "context",
            "line": "index 80c36bcf66e8..78e27e3b52ac 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/trace/trace_event_perf.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/trace/trace_event_perf.c"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": " \t/* The ftrace function trace is allowed only for root. */"
          },
          {
            "type": "context",
            "line": " \tif (ftrace_event_is_function(tp_event) &&"
          },
          {
            "type": "delete",
            "line": "\t    perf_paranoid_kernel() && !capable(CAP_SYS_ADMIN))"
          },
          {
            "type": "add",
            "line": "\t    perf_paranoid_tracepoint_raw() && !capable(CAP_SYS_ADMIN))"
          },
          {
            "type": "context",
            "line": " \t\treturn -EPERM;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* No tracing, just counting, so no obvious leak */"
          }
        ]
      }
    ]
  },
  {
    "commit": "12ca6ad2e3a896256f086497a7c7406a547ee373",
    "files": [
      {
        "file": "kernel/events/core.c",
        "changes": [
          {
            "type": "context",
            "line": "index fd7de0418fbe..0a791a2203dc 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/events/core.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/events/core.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* Recursion avoidance in each contexts */"
          },
          {
            "type": "context",
            "line": " \tint\t\t\t\trecursion[PERF_NR_CONTEXTS];"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t/* Keeps track of cpu being initialized/exited */"
          },
          {
            "type": "delete",
            "line": "\tbool\t\t\t\tonline;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static DEFINE_PER_CPU(struct swevent_htable, swevent_htable);"
          },
          {
            "type": "context",
            "line": " \thwc->state = !(flags & PERF_EF_START);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \thead = find_swevent_head(swhash, event);"
          },
          {
            "type": "delete",
            "line": "\tif (!head) {"
          },
          {
            "type": "delete",
            "line": "\t\t/*"
          },
          {
            "type": "delete",
            "line": "\t\t * We can race with cpu hotplug code. Do not"
          },
          {
            "type": "delete",
            "line": "\t\t * WARN if the cpu just got unplugged."
          },
          {
            "type": "delete",
            "line": "\t\t */"
          },
          {
            "type": "delete",
            "line": "\t\tWARN_ON_ONCE(swhash->online);"
          },
          {
            "type": "add",
            "line": "\tif (WARN_ON_ONCE(!head))"
          },
          {
            "type": "context",
            "line": " \t\treturn -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \thlist_add_head_rcu(&event->hlist_entry, head);"
          },
          {
            "type": "context",
            "line": " \tperf_event_update_userpage(event);"
          },
          {
            "type": "context",
            "line": " \tint err = 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&swhash->hlist_mutex);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!swevent_hlist_deref(swhash) && cpu_online(cpu)) {"
          },
          {
            "type": "context",
            "line": " \t\tstruct swevent_hlist *hlist;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tstruct swevent_htable *swhash = &per_cpu(swevent_htable, cpu);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmutex_lock(&swhash->hlist_mutex);"
          },
          {
            "type": "delete",
            "line": "\tswhash->online = true;"
          },
          {
            "type": "context",
            "line": " \tif (swhash->hlist_refcount > 0) {"
          },
          {
            "type": "context",
            "line": " \t\tstruct swevent_hlist *hlist;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static void perf_event_exit_cpu(int cpu)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tstruct swevent_htable *swhash = &per_cpu(swevent_htable, cpu);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tperf_event_exit_cpu_context(cpu);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tmutex_lock(&swhash->hlist_mutex);"
          },
          {
            "type": "delete",
            "line": "\tswhash->online = false;"
          },
          {
            "type": "delete",
            "line": "\tswevent_hlist_release(swhash);"
          },
          {
            "type": "delete",
            "line": "\tmutex_unlock(&swhash->hlist_mutex);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " #else"
          },
          {
            "type": "context",
            "line": " static inline void perf_event_exit_cpu(int cpu) { }"
          }
        ]
      }
    ]
  },
  {
    "commit": "12d6e7538e2d418c08f082b1b44ffa5fb7270ed8",
    "files": [
      {
        "file": "virt/kvm/kvm_main.c",
        "changes": [
          {
            "type": "context",
            "line": "index a4bf05be5fea..f41ea1262d51 100644"
          },
          {
            "type": "context",
            "line": "--- a/virt/kvm/kvm_main.c"
          },
          {
            "type": "context",
            "line": "+++ b/virt/kvm/kvm_main.c"
          },
          {
            "type": "context",
            "line": " \t\t/* destroy any largepage mappings for dirty tracking */"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!npages) {"
          },
          {
            "type": "add",
            "line": "\tif (!npages || base_gfn != old.base_gfn) {"
          },
          {
            "type": "context",
            "line": " \t\tstruct kvm_memory_slot *slot;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tr = -ENOMEM;"
          },
          {
            "type": "context",
            "line": " \t\told_memslots = kvm->memslots;"
          },
          {
            "type": "context",
            "line": " \t\trcu_assign_pointer(kvm->memslots, slots);"
          },
          {
            "type": "context",
            "line": " \t\tsynchronize_srcu_expedited(&kvm->srcu);"
          },
          {
            "type": "delete",
            "line": "\t\t/* From this point no new shadow pages pointing to a deleted"
          },
          {
            "type": "delete",
            "line": "\t\t * memslot will be created."
          },
          {
            "type": "add",
            "line": "\t\t/* From this point no new shadow pages pointing to a deleted,"
          },
          {
            "type": "add",
            "line": "\t\t * or moved, memslot will be created."
          },
          {
            "type": "context",
            "line": " \t\t *"
          },
          {
            "type": "context",
            "line": " \t\t * validation of sp->gfn happens in:"
          },
          {
            "type": "context",
            "line": " \t\t * \t- gfn_to_hva (kvm_read_guest, gfn_to_pfn)"
          }
        ]
      }
    ]
  },
  {
    "commit": "12e23c962ffb4cf1857c5461d72ae54cc8008f29",
    "files": [
      {
        "file": "release-notes/VERSION-2.x",
        "changes": [
          {
            "type": "context",
            "line": "index dba2b19e6..7c19f2123 100644"
          },
          {
            "type": "context",
            "line": "--- a/release-notes/VERSION-2.x"
          },
          {
            "type": "context",
            "line": "+++ b/release-notes/VERSION-2.x"
          },
          {
            "type": "context",
            "line": "  (reported by Al1ex@knownsec)"
          },
          {
            "type": "context",
            "line": " #2999: Block 1 more gadget type (org.glassfish.web/javax.servlet.jsp.jstl, CVE-2020-35728)"
          },
          {
            "type": "context",
            "line": "  (reported by bu5yer of Sangfor FarSight Security Lab)"
          },
          {
            "type": "add",
            "line": "#3003: Block one more gadget type (xxx, CVE to be allocated)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " 2.9.10.7 (02-Dec-2020)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java",
        "changes": [
          {
            "type": "context",
            "line": "index 307374a0a..64ff56a47 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/main/java/com/fasterxml/jackson/databind/jsontype/impl/SubTypeValidator.java"
          },
          {
            "type": "context",
            "line": "         // (derivative of #2469)"
          },
          {
            "type": "context",
            "line": "         s.add(\"com.oracle.wls.shaded.org.apache.xalan.lib.sql.JNDIConnectionPool\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // [databind#303]: another case of embedded Xalan (derivative of #2469)"
          },
          {
            "type": "add",
            "line": "        s.add(\"org.docx4j.org.apache.xalan.lib.sql.JNDIConnectionPool\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         DEFAULT_NO_DESER_CLASS_NAMES = Collections.unmodifiableSet(s);"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      }
    ]
  },
  {
    "commit": "12f09ccb4612734a53e47ed5302e0479c10a50f8",
    "files": [
      {
        "file": "drivers/target/loopback/tcm_loop.c",
        "changes": [
          {
            "type": "context",
            "line": "index c2937b2035d3..083d6c51f052 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/target/loopback/tcm_loop.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/target/loopback/tcm_loop.c"
          },
          {
            "type": "context",
            "line": " \ttpgt_str += 5; /* Skip ahead of \"tpgt_\" */"
          },
          {
            "type": "context",
            "line": " \ttpgt = (unsigned short int) simple_strtoul(tpgt_str, &end_ptr, 0);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (tpgt > TL_TPGS_PER_HBA) {"
          },
          {
            "type": "add",
            "line": "\tif (tpgt >= TL_TPGS_PER_HBA) {"
          },
          {
            "type": "context",
            "line": " \t\tprintk(KERN_ERR \"Passed tpgt: %hu exceeds TL_TPGS_PER_HBA:\""
          },
          {
            "type": "context",
            "line": " \t\t\t\t\" %u\\n\", tpgt, TL_TPGS_PER_HBA);"
          },
          {
            "type": "context",
            "line": " \t\treturn ERR_PTR(-EINVAL);"
          }
        ]
      }
    ]
  },
  {
    "commit": "1309d7afbed112f0e8e90be9af975550caa0076b",
    "files": [
      {
        "file": "drivers/char/tpm/tpm.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1f46f1cd9225..7beb0e25f1e1 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/char/tpm/tpm.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/char/tpm/tpm.c"
          },
          {
            "type": "context",
            "line": " \t\treturn -EBUSY;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tchip->data_buffer = kmalloc(TPM_BUFSIZE * sizeof(u8), GFP_KERNEL);"
          },
          {
            "type": "add",
            "line": "\tchip->data_buffer = kzalloc(TPM_BUFSIZE, GFP_KERNEL);"
          },
          {
            "type": "context",
            "line": " \tif (chip->data_buffer == NULL) {"
          },
          {
            "type": "context",
            "line": " \t\tclear_bit(0, &chip->is_open);"
          },
          {
            "type": "context",
            "line": " \t\tput_device(chip->dev);"
          }
        ]
      }
    ]
  },
  {
    "commit": "132c94e31b8bca8ea921f9f96a57d684fa4ae0a9",
    "files": [
      {
        "file": "fs/namespace.c",
        "changes": [
          {
            "type": "context",
            "line": "index 8505b5ece5de..968d4c5eae03 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/namespace.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/namespace.c"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmnt->mnt.mnt_flags = old->mnt.mnt_flags & ~MNT_WRITE_HOLD;"
          },
          {
            "type": "add",
            "line": "\t/* Don't allow unprivileged users to change mount flags */"
          },
          {
            "type": "add",
            "line": "\tif ((flag & CL_UNPRIVILEGED) && (mnt->mnt.mnt_flags & MNT_READONLY))"
          },
          {
            "type": "add",
            "line": "\t\tmnt->mnt.mnt_flags |= MNT_LOCK_READONLY;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tatomic_inc(&sb->s_active);"
          },
          {
            "type": "context",
            "line": " \tmnt->mnt.mnt_sb = sb;"
          },
          {
            "type": "context",
            "line": " \tmnt->mnt.mnt_root = dget(root);"
          },
          {
            "type": "context",
            "line": " \t/* First pass: copy the tree topology */"
          },
          {
            "type": "context",
            "line": " \tcopy_flags = CL_COPY_ALL | CL_EXPIRE;"
          },
          {
            "type": "context",
            "line": " \tif (user_ns != mnt_ns->user_ns)"
          },
          {
            "type": "delete",
            "line": "\t\tcopy_flags |= CL_SHARED_TO_SLAVE;"
          },
          {
            "type": "add",
            "line": "\t\tcopy_flags |= CL_SHARED_TO_SLAVE | CL_UNPRIVILEGED;"
          },
          {
            "type": "context",
            "line": " \tnew = copy_tree(old, old->mnt.mnt_root, copy_flags);"
          },
          {
            "type": "context",
            "line": " \tif (IS_ERR(new)) {"
          },
          {
            "type": "context",
            "line": " \t\tup_write(&namespace_sem);"
          }
        ]
      },
      {
        "file": "fs/pnode.c",
        "changes": [
          {
            "type": "context",
            "line": "index 3e000a51ac0d..8b29d2164da6 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/pnode.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/pnode.c"
          },
          {
            "type": "context",
            "line": " #include <linux/mnt_namespace.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/mount.h>"
          },
          {
            "type": "context",
            "line": " #include <linux/fs.h>"
          },
          {
            "type": "add",
            "line": "#include <linux/nsproxy.h>"
          },
          {
            "type": "context",
            "line": " #include \"internal.h\""
          },
          {
            "type": "context",
            "line": " #include \"pnode.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " int propagate_mnt(struct mount *dest_mnt, struct dentry *dest_dentry,"
          },
          {
            "type": "context",
            "line": " \t\t    struct mount *source_mnt, struct list_head *tree_list)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "\tstruct user_namespace *user_ns = current->nsproxy->mnt_ns->user_ns;"
          },
          {
            "type": "context",
            "line": " \tstruct mount *m, *child;"
          },
          {
            "type": "context",
            "line": " \tint ret = 0;"
          },
          {
            "type": "context",
            "line": " \tstruct mount *prev_dest_mnt = dest_mnt;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tsource =  get_source(m, prev_dest_mnt, prev_src_mnt, &type);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t/* Notice when we are propagating across user namespaces */"
          },
          {
            "type": "add",
            "line": "\t\tif (m->mnt_ns->user_ns != user_ns)"
          },
          {
            "type": "add",
            "line": "\t\t\ttype |= CL_UNPRIVILEGED;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tchild = copy_tree(source, source->mnt.mnt_root, type);"
          },
          {
            "type": "context",
            "line": " \t\tif (IS_ERR(child)) {"
          },
          {
            "type": "context",
            "line": " \t\t\tret = PTR_ERR(child);"
          }
        ]
      },
      {
        "file": "fs/pnode.h",
        "changes": [
          {
            "type": "context",
            "line": "index 19b853a3445c..a0493d5ebfbf 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/pnode.h"
          },
          {
            "type": "context",
            "line": "+++ b/fs/pnode.h"
          },
          {
            "type": "context",
            "line": " #define CL_MAKE_SHARED \t\t0x08"
          },
          {
            "type": "context",
            "line": " #define CL_PRIVATE \t\t0x10"
          },
          {
            "type": "context",
            "line": " #define CL_SHARED_TO_SLAVE\t0x20"
          },
          {
            "type": "add",
            "line": "#define CL_UNPRIVILEGED\t\t0x40"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static inline void set_mnt_shared(struct mount *mnt)"
          },
          {
            "type": "context",
            "line": " {"
          }
        ]
      }
    ]
  },
  {
    "commit": "1352365e8bf5ea49da3dc82b1ccf7ddb659ae960",
    "files": [
      {
        "file": ".gitignore",
        "changes": [
          {
            "type": "context",
            "line": "index 0e9a5dd0537..46e1174b792 100644"
          },
          {
            "type": "context",
            "line": "--- a/.gitignore"
          },
          {
            "type": "context",
            "line": "+++ b/.gitignore"
          },
          {
            "type": "context",
            "line": " /build/lib/"
          },
          {
            "type": "context",
            "line": " /build/jsdocs/"
          },
          {
            "type": "context",
            "line": " /npm-debug.log"
          },
          {
            "type": "add",
            "line": "/PhantomJS_*"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # puphpet"
          },
          {
            "type": "context",
            "line": " puphpet"
          }
        ]
      }
    ]
  },
  {
    "commit": "137f7df8cead00688524c82360930845396b8a21",
    "files": [
      {
        "file": "arch/mips/include/asm/thread_info.h",
        "changes": [
          {
            "type": "context",
            "line": "index 24846f9053fe..e80ae50cae80 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/mips/include/asm/thread_info.h"
          },
          {
            "type": "context",
            "line": "+++ b/arch/mips/include/asm/thread_info.h"
          },
          {
            "type": "context",
            "line": " #define _TIF_SYSCALL_TRACEPOINT\t(1<<TIF_SYSCALL_TRACEPOINT)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define _TIF_WORK_SYSCALL_ENTRY\t(_TIF_NOHZ | _TIF_SYSCALL_TRACE |\t\\"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t _TIF_SYSCALL_AUDIT | _TIF_SYSCALL_TRACEPOINT)"
          },
          {
            "type": "add",
            "line": "\t\t\t\t _TIF_SYSCALL_AUDIT | \\"
          },
          {
            "type": "add",
            "line": "\t\t\t\t _TIF_SYSCALL_TRACEPOINT | _TIF_SECCOMP)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* work to do in syscall_trace_leave() */"
          },
          {
            "type": "context",
            "line": " #define _TIF_WORK_SYSCALL_EXIT\t(_TIF_NOHZ | _TIF_SYSCALL_TRACE |\t\\"
          }
        ]
      }
    ]
  },
  {
    "commit": "13875a6437d4525ac4aeea25918f2d2dffac9ee1",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/delete.vm",
        "changes": [
          {
            "type": "context",
            "line": "index c1a64fa2721..643526ed169 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/delete.vm"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/delete.vm"
          },
          {
            "type": "context",
            "line": "   </div>"
          },
          {
            "type": "context",
            "line": "   <button class=\"btn btn-danger confirm\">$escapetool.xml($services.localization.render('delete'))</button>"
          },
          {
            "type": "context",
            "line": "   #if(\"$!{request.xredirect}\" != '')"
          },
          {
            "type": "delete",
            "line": "    #set($cancelUrl = \"$request.xredirect\")"
          },
          {
            "type": "add",
            "line": "    #getSanitizedURLAttributeValue('a','href',$request.xredirect,$doc.getURL(),$cancelUrl)"
          },
          {
            "type": "context",
            "line": "   #else"
          },
          {
            "type": "delete",
            "line": "    #set($cancelUrl = $doc.getURL())"
          },
          {
            "type": "add",
            "line": "    #set($cancelUrl = $escapetool.xml($doc.getURL()))"
          },
          {
            "type": "context",
            "line": "   #end"
          },
          {
            "type": "context",
            "line": "   <a class=\"btn btn-default cancel\" href=\"$!{escapetool.xml(${cancelUrl})}\">$escapetool.xml($services.localization.render('cancel'))</a>"
          },
          {
            "type": "context",
            "line": " #end"
          }
        ]
      }
    ]
  },
  {
    "commit": "1391ba72149655e4884d357586d3201f15bc92dc",
    "files": [
      {
        "file": "util/dcluster.go",
        "changes": [
          {
            "type": "context",
            "line": "index 9b405a9ca..69da0a3bd 100644"
          },
          {
            "type": "context",
            "line": "--- a/util/db/cluster.go"
          },
          {
            "type": "context",
            "line": "+++ b/util/db/cluster.go"
          },
          {
            "type": "context",
            "line": " \tsecret.Data = data"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tsecret.Labels = c.Labels"
          },
          {
            "type": "add",
            "line": "\tif c.Annotations != nil && c.Annotations[apiv1.LastAppliedConfigAnnotation] != \"\" {"
          },
          {
            "type": "add",
            "line": "\t\treturn status.Errorf(codes.InvalidArgument, \"annotation %s cannot be set\", apiv1.LastAppliedConfigAnnotation)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \tsecret.Annotations = c.Annotations"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif secret.Annotations == nil {"
          },
          {
            "type": "context",
            "line": " \tannotations := map[string]string{}"
          },
          {
            "type": "context",
            "line": " \tif s.Annotations != nil {"
          },
          {
            "type": "context",
            "line": " \t\tannotations = collections.CopyStringMap(s.Annotations)"
          },
          {
            "type": "add",
            "line": "\t\t// delete system annotations"
          },
          {
            "type": "add",
            "line": "\t\tdelete(annotations, apiv1.LastAppliedConfigAnnotation)"
          },
          {
            "type": "context",
            "line": " \t\tdelete(annotations, common.AnnotationKeyManagedBy)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "util/dcluster_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 9d60a3073..5d99edf83 100644"
          },
          {
            "type": "context",
            "line": "--- a/util/db/cluster_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/util/db/cluster_test.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"github.com/stretchr/testify/assert\""
          },
          {
            "type": "context",
            "line": " \t\"github.com/stretchr/testify/require\""
          },
          {
            "type": "add",
            "line": "\t\"google.golang.org/grpc/codes\""
          },
          {
            "type": "add",
            "line": "\t\"google.golang.org/grpc/status\""
          },
          {
            "type": "context",
            "line": " \tv1 \"k8s.io/api/core/v1\""
          },
          {
            "type": "context",
            "line": " \tmetav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\""
          },
          {
            "type": "context",
            "line": " \t\"k8s.io/client-go/kubernetes/fake\""
          },
          {
            "type": "context",
            "line": " \t})"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func Test_secretToCluster_LastAppliedConfigurationDropped(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tsecret := &v1.Secret{"
          },
          {
            "type": "add",
            "line": "\t\tObjectMeta: metav1.ObjectMeta{"
          },
          {
            "type": "add",
            "line": "\t\t\tName:        \"mycluster\","
          },
          {
            "type": "add",
            "line": "\t\t\tNamespace:   fakeNamespace,"
          },
          {
            "type": "add",
            "line": "\t\t\tAnnotations: map[string]string{v1.LastAppliedConfigAnnotation: \"val2\"},"
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t\tData: map[string][]byte{"
          },
          {
            "type": "add",
            "line": "\t\t\t\"name\":   []byte(\"test\"),"
          },
          {
            "type": "add",
            "line": "\t\t\t\"server\": []byte(\"http://mycluster\"),"
          },
          {
            "type": "add",
            "line": "\t\t\t\"config\": []byte(\"{\\\"username\\\":\\\"foo\\\"}\"),"
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tcluster, err := SecretToCluster(secret)"
          },
          {
            "type": "add",
            "line": "\trequire.NoError(t, err)"
          },
          {
            "type": "add",
            "line": "\tassert.Len(t, cluster.Annotations, 0)"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestClusterToSecret(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \tcluster := &appv1.Cluster{"
          },
          {
            "type": "context",
            "line": " \t\tServer:      \"server\","
          },
          {
            "type": "context",
            "line": " \tassert.Equal(t, cluster.Labels, s.Labels)"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestClusterToSecret_LastAppliedConfigurationRejected(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tcluster := &appv1.Cluster{"
          },
          {
            "type": "add",
            "line": "\t\tServer:      \"server\","
          },
          {
            "type": "add",
            "line": "\t\tAnnotations: map[string]string{v1.LastAppliedConfigAnnotation: \"val2\"},"
          },
          {
            "type": "add",
            "line": "\t\tName:        \"test\","
          },
          {
            "type": "add",
            "line": "\t\tConfig:      v1alpha1.ClusterConfig{},"
          },
          {
            "type": "add",
            "line": "\t\tProject:     \"project\","
          },
          {
            "type": "add",
            "line": "\t\tNamespaces:  []string{\"default\"},"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\ts := &v1.Secret{}"
          },
          {
            "type": "add",
            "line": "\terr := clusterToSecret(cluster, s)"
          },
          {
            "type": "add",
            "line": "\trequire.Error(t, err)"
          },
          {
            "type": "add",
            "line": "\trequire.Equal(t, codes.InvalidArgument, status.Code(err))"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " func Test_secretToCluster_NoConfig(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \tsecret := &v1.Secret{"
          },
          {
            "type": "context",
            "line": " \t\tObjectMeta: metav1.ObjectMeta{"
          }
        ]
      }
    ]
  },
  {
    "commit": "1399c59fa92984836db90538cf92397fe7caaa57",
    "files": [
      {
        "file": "net/wireless/nl80211.c",
        "changes": [
          {
            "type": "context",
            "line": "index 141cdb171665..4453dd375de9 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/wireless/nl80211.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/wireless/nl80211.c"
          },
          {
            "type": "context",
            "line": " \thdr = nl80211hdr_put(msg, info->snd_portid, info->snd_seq, 0,"
          },
          {
            "type": "context",
            "line": " \t\t\t     NL80211_CMD_GET_FTM_RESPONDER_STATS);"
          },
          {
            "type": "context",
            "line": " \tif (!hdr)"
          },
          {
            "type": "delete",
            "line": "\t\treturn -ENOBUFS;"
          },
          {
            "type": "add",
            "line": "\t\tgoto nla_put_failure;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (nla_put_u32(msg, NL80211_ATTR_IFINDEX, dev->ifindex))"
          },
          {
            "type": "context",
            "line": " \t\tgoto nla_put_failure;"
          }
        ]
      }
    ]
  },
  {
    "commit": "13bf9fbff0e5e099e2b6f003a0ab8ae145436309",
    "files": [
      {
        "file": "fs/nfsd/nfs3xdr.c",
        "changes": [
          {
            "type": "context",
            "line": "index d18cfddbe115..452334694a5d 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/nfsd/nfs3xdr.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/nfsd/nfs3xdr.c"
          },
          {
            "type": "context",
            "line": " \targs->count = ntohl(*p++);"
          },
          {
            "type": "context",
            "line": " \targs->stable = ntohl(*p++);"
          },
          {
            "type": "context",
            "line": " \tlen = args->len = ntohl(*p++);"
          },
          {
            "type": "add",
            "line": "\tif ((void *)p > head->iov_base + head->iov_len)"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * The count must equal the amount of data passed."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \t/* first copy and check from the first page */"
          },
          {
            "type": "context",
            "line": " \told = (char*)p;"
          },
          {
            "type": "context",
            "line": " \tvec = &rqstp->rq_arg.head[0];"
          },
          {
            "type": "add",
            "line": "\tif ((void *)old > vec->iov_base + vec->iov_len)"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "context",
            "line": " \tavail = vec->iov_len - (old - (char*)vec->iov_base);"
          },
          {
            "type": "context",
            "line": " \twhile (len && avail && *old) {"
          },
          {
            "type": "context",
            "line": " \t\t*new++ = *old++;"
          }
        ]
      },
      {
        "file": "fs/nfsd/nfsxdr.c",
        "changes": [
          {
            "type": "context",
            "line": "index 59bd88a23a3d..de07ff625777 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/nfsd/nfsxdr.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/nfsd/nfsxdr.c"
          },
          {
            "type": "context",
            "line": " \t * bytes."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \thdr = (void*)p - head->iov_base;"
          },
          {
            "type": "add",
            "line": "\tif (hdr > head->iov_len)"
          },
          {
            "type": "add",
            "line": "\t\treturn 0;"
          },
          {
            "type": "context",
            "line": " \tdlen = head->iov_len + rqstp->rq_arg.page_len - hdr;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          }
        ]
      }
    ]
  },
  {
    "commit": "13d2b4d11d69a92574a55bfd985cfb0ca77aebdc",
    "files": [
      {
        "file": "arch/x86/xen/xen-asm_32.S",
        "changes": [
          {
            "type": "context",
            "line": "index f9643fc50de5..33ca6e42a4ca 100644"
          },
          {
            "type": "context",
            "line": "--- a/arch/x86/xen/xen-asm_32.S"
          },
          {
            "type": "context",
            "line": "+++ b/arch/x86/xen/xen-asm_32.S"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " #ifdef CONFIG_SMP"
          },
          {
            "type": "context",
            "line": " \tGET_THREAD_INFO(%eax)"
          },
          {
            "type": "delete",
            "line": "\tmovl TI_cpu(%eax), %eax"
          },
          {
            "type": "delete",
            "line": "\tmovl __per_cpu_offset(,%eax,4), %eax"
          },
          {
            "type": "delete",
            "line": "\tmov xen_vcpu(%eax), %eax"
          },
          {
            "type": "add",
            "line": "\tmovl %ss:TI_cpu(%eax), %eax"
          },
          {
            "type": "add",
            "line": "\tmovl %ss:__per_cpu_offset(,%eax,4), %eax"
          },
          {
            "type": "add",
            "line": "\tmov %ss:xen_vcpu(%eax), %eax"
          },
          {
            "type": "context",
            "line": " #else"
          },
          {
            "type": "delete",
            "line": "\tmovl xen_vcpu, %eax"
          },
          {
            "type": "add",
            "line": "\tmovl %ss:xen_vcpu, %eax"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* check IF state we're restoring */"
          },
          {
            "type": "context",
            "line": " \t * resuming the code, so we don't have to be worried about"
          },
          {
            "type": "context",
            "line": " \t * being preempted to another CPU."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "delete",
            "line": "\tsetz XEN_vcpu_info_mask(%eax)"
          },
          {
            "type": "add",
            "line": "\tsetz %ss:XEN_vcpu_info_mask(%eax)"
          },
          {
            "type": "context",
            "line": " xen_iret_start_crit:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/* check for unmasked and pending */"
          },
          {
            "type": "delete",
            "line": "\tcmpw $0x0001, XEN_vcpu_info_pending(%eax)"
          },
          {
            "type": "add",
            "line": "\tcmpw $0x0001, %ss:XEN_vcpu_info_pending(%eax)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * If there's something pending, mask events again so we can"
          },
          {
            "type": "context",
            "line": " \t * touch XEN_vcpu_info_mask."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tjne 1f"
          },
          {
            "type": "delete",
            "line": "\tmovb $1, XEN_vcpu_info_mask(%eax)"
          },
          {
            "type": "add",
            "line": "\tmovb $1, %ss:XEN_vcpu_info_mask(%eax)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " 1:\tpopl %eax"
          }
        ]
      }
    ]
  },
  {
    "commit": "13d518074a952d33d47c428419693f63389547e9",
    "files": [
      {
        "file": "fs/eventpoll.c",
        "changes": [
          {
            "type": "context",
            "line": "index 739b0985b398..c0b3c70ee87a 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/eventpoll.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/eventpoll.c"
          },
          {
            "type": "context",
            "line": " \tif (op == EPOLL_CTL_ADD) {"
          },
          {
            "type": "context",
            "line": " \t\tif (is_file_epoll(tfile)) {"
          },
          {
            "type": "context",
            "line": " \t\t\terror = -ELOOP;"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (ep_loop_check(ep, tfile) != 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tif (ep_loop_check(ep, tfile) != 0) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tclear_tfile_check_list();"
          },
          {
            "type": "context",
            "line": " \t\t\t\tgoto error_tgt_fput;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t} else"
          },
          {
            "type": "context",
            "line": " \t\t\tlist_add(&tfile->f_tfile_llink, &tfile_check_list);"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "13dad7d5ef74ca2e6fe4010f5b03eb12e9bbe0ec",
    "files": [
      {
        "file": "src/filters/reframe_av1.c",
        "changes": [
          {
            "type": "context",
            "line": "index 591a826a9..c8b402c8a 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/filters/reframe_av1.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/filters/reframe_av1.c"
          },
          {
            "type": "context",
            "line": " \tGF_FilterPacket *pck;"
          },
          {
            "type": "context",
            "line": " \tu8 *output;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (!ctx->opid)"
          },
          {
            "type": "add",
            "line": "\t\treturn GF_NON_COMPLIANT_BITSTREAM;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tgf_bs_get_content_no_truncate(ctx->state.bs, &ctx->state.frame_obus, &pck_size, &ctx->state.frame_obus_alloc);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (!pck_size) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "13fcb7bd322164c67926ffe272846d4860196dc6",
    "files": [
      {
        "file": "include/linux/if_packet.h",
        "changes": [
          {
            "type": "context",
            "line": "index 6d66ce1791a9..7b318630139f 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/linux/if_packet.h"
          },
          {
            "type": "context",
            "line": "+++ b/include/linux/if_packet.h"
          },
          {
            "type": "context",
            "line": " \t__u16\t\ttp_mac;"
          },
          {
            "type": "context",
            "line": " \t__u16\t\ttp_net;"
          },
          {
            "type": "context",
            "line": " \t__u16\t\ttp_vlan_tci;"
          },
          {
            "type": "add",
            "line": "\t__u16\t\ttp_padding;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* Rx ring - header status */"
          },
          {
            "type": "context",
            "line": " \t__u32\t\ttp_sec;"
          },
          {
            "type": "context",
            "line": " \t__u32\t\ttp_nsec;"
          },
          {
            "type": "context",
            "line": " \t__u16\t\ttp_vlan_tci;"
          },
          {
            "type": "add",
            "line": "\t__u16\t\ttp_padding;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define TPACKET2_HDRLEN\t\t(TPACKET_ALIGN(sizeof(struct tpacket2_hdr)) + sizeof(struct sockaddr_ll))"
          }
        ]
      },
      {
        "file": "net/packet/af_packet.c",
        "changes": [
          {
            "type": "context",
            "line": "index ba248d93399a..c0c3cda19712 100644"
          },
          {
            "type": "context",
            "line": "--- a/net/packet/af_packet.c"
          },
          {
            "type": "context",
            "line": "+++ b/net/packet/af_packet.c"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\th.h2->tp_vlan_tci = 0;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": "\t\th.h2->tp_padding = 0;"
          },
          {
            "type": "context",
            "line": " \t\thdrlen = sizeof(*h.h2);"
          },
          {
            "type": "context",
            "line": " \t\tbreak;"
          },
          {
            "type": "context",
            "line": " \tdefault:"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\taux.tp_vlan_tci = 0;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": "\t\taux.tp_padding = 0;"
          },
          {
            "type": "context",
            "line": " \t\tput_cmsg(msg, SOL_PACKET, PACKET_AUXDATA, sizeof(aux), &aux);"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "1421e0c584ae9120ca1b88098f13d6d2e90b83a3",
    "files": [
      {
        "file": "ssl/s3_srvr.c",
        "changes": [
          {
            "type": "context",
            "line": "index 90e95d6bc1..8550c1b783 100644"
          },
          {
            "type": "context",
            "line": "--- a/ssl/s3_srvr.c"
          },
          {
            "type": "context",
            "line": "+++ b/ssl/s3_srvr.c"
          },
          {
            "type": "context",
            "line": " \tif (s->s3->tmp.message_type != SSL3_MT_CERTIFICATE_VERIFY)"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\ts->s3->tmp.reuse_message=1;"
          },
          {
            "type": "delete",
            "line": "\t\tif ((peer != NULL) && (type & EVP_PKT_SIGN))"
          },
          {
            "type": "add",
            "line": "\t\tif (peer != NULL)"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tal=SSL_AD_UNEXPECTED_MESSAGE;"
          },
          {
            "type": "context",
            "line": " \t\t\tSSLerr(SSL_F_SSL3_GET_CERT_VERIFY,SSL_R_MISSING_VERIFY_MESSAGE);"
          }
        ]
      }
    ]
  },
  {
    "commit": "1450b6e3c69ac7df25e5a2571186d1f43402facd",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/main/resources/XWiki/LiveTableResultsMacros.xml",
        "changes": [
          {
            "type": "context",
            "line": "index 543cf4589f4..ced0d6642b1 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/main/resources/XWiki/LiveTableResultsMacros.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/main/resources/XWiki/LiveTableResultsMacros.xml"
          },
          {
            "type": "context",
            "line": "   #set ($query = $query.setLimit($limit).setOffset($offset).bindValues($sqlParams))"
          },
          {
            "type": "context",
            "line": "   #set($items = $query.execute())"
          },
          {
            "type": "context",
            "line": "   #set($discard = $map.put('totalrows', $query.count()))"
          },
          {
            "type": "delete",
            "line": "  #set($discard = $map.put('returnedrows', $mathtool.min($items.size(), $limit)))"
          },
          {
            "type": "add",
            "line": "  #if ($limit > 0)"
          },
          {
            "type": "add",
            "line": "    #set($discard = $map.put('returnedrows', $mathtool.min($items.size(), $limit)))"
          },
          {
            "type": "add",
            "line": "  #else"
          },
          {
            "type": "add",
            "line": "    ## When the limit is 0, it's equivalent to no limit at all and the actual number of returned results can be used."
          },
          {
            "type": "add",
            "line": "    #set($discard = $map.put('returnedrows', $items.size()))"
          },
          {
            "type": "add",
            "line": "  #end"
          },
          {
            "type": "context",
            "line": "   #set($discard = $map.put('offset', $mathtool.add($offset, 1)))"
          },
          {
            "type": "context",
            "line": "   #set($rows = [])"
          },
          {
            "type": "context",
            "line": "   #foreach($item in $items)"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/test/java/org/xwiki/livetable/LiveTableResultsTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 3ba2168d6a8..cf2ae0bd5f4 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/test/java/org/xwiki/livetable/LiveTableResultsTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-livetable/xwiki-platform-livetable-ui/src/test/java/org/xwiki/livetable/LiveTableResultsTest.java"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.objects.classes.StaticListClass;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.plugin.tag.TagPluginApi;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static java.util.Collections.emptyList;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertEquals;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertFalse;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "context",
            "line": "         assertEquals(\"XWiki.Viewable\", viewable.get(\"doc_fullName\"));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void removeObfuscatedResultsWhenLimitIs0() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        when(this.queryService.hql(anyString())).thenReturn(this.query);"
          },
          {
            "type": "add",
            "line": "        when(this.query.setLimit(anyInt())).thenReturn(this.query);"
          },
          {
            "type": "add",
            "line": "        when(this.query.setOffset(anyInt())).thenReturn(this.query);"
          },
          {
            "type": "add",
            "line": "        when(this.query.bindValues(any(Map.class))).thenReturn(this.query);"
          },
          {
            "type": "add",
            "line": "        when(this.query.count()).thenReturn(1L);"
          },
          {
            "type": "add",
            "line": "        when(this.query.execute()).thenReturn(Arrays.asList(\"XWiki.NotViewable\"));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        when(this.oldcore.getMockContextualAuthorizationManager()"
          },
          {
            "type": "add",
            "line": "            .hasAccess(same(Right.VIEW), eq(new DocumentReference(\"xwiki\", \"XWiki\", \"NotViewable\")))).thenReturn(false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.request.put(\"limit\", \"0\");"
          },
          {
            "type": "add",
            "line": "        this.request.put(\"classname\", \"\");"
          },
          {
            "type": "add",
            "line": "        this.request.put(\"collist\", \"doc.title,doc.location,doc.content\");"
          },
          {
            "type": "add",
            "line": "        this.request.put(\"doc.title\", \"Sandbo\");"
          },
          {
            "type": "add",
            "line": "        this.request.put(\"doc.location\", \"Sandbox.TestPage3\");"
          },
          {
            "type": "add",
            "line": "        this.request.put(\"doc.content\", \"dummy\");"
          },
          {
            "type": "add",
            "line": "        this.request.put(\"limit\", \"0\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        renderPage();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(0, getTotalRowCount());"
          },
          {
            "type": "add",
            "line": "        assertEquals(0, getRowCount());"
          },
          {
            "type": "add",
            "line": "        assertEquals(1, getOffset());"
          },
          {
            "type": "add",
            "line": "        assertEquals(emptyList(), getRows());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     //"
          },
          {
            "type": "context",
            "line": "     // Helper methods"
          },
          {
            "type": "context",
            "line": "     //"
          }
        ]
      }
    ]
  },
  {
    "commit": "148de954ed3585d8b4298b424aa24916d0de6136",
    "files": [
      {
        "file": "source/common/http/conn_manager_impl.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 3a76359545..0f824751f6 100644"
          },
          {
            "type": "context",
            "line": "--- a/source/common/http/conn_manager_impl.cc"
          },
          {
            "type": "context",
            "line": "+++ b/source/common/http/conn_manager_impl.cc"
          },
          {
            "type": "context",
            "line": "   // here is when Envoy \"ends\" the stream by calling recreateStream at which point recreateStream"
          },
          {
            "type": "context",
            "line": "   // explicitly nulls out response_encoder to avoid the downstream being notified of the"
          },
          {
            "type": "context",
            "line": "   // Envoy-internal stream instance being ended."
          },
          {
            "type": "delete",
            "line": "  if (stream.response_encoder_ != nullptr &&"
          },
          {
            "type": "delete",
            "line": "      (!stream.filter_manager_.remoteComplete() || !stream.state_.codec_saw_local_complete_)) {"
          },
          {
            "type": "add",
            "line": "  if (stream.response_encoder_ != nullptr && (!stream.filter_manager_.remoteDecodeComplete() ||"
          },
          {
            "type": "add",
            "line": "                                              !stream.state_.codec_saw_local_complete_)) {"
          },
          {
            "type": "context",
            "line": "     // Indicate local is complete at this point so that if we reset during a continuation, we don't"
          },
          {
            "type": "context",
            "line": "     // raise further data or trailers."
          },
          {
            "type": "context",
            "line": "     ENVOY_STREAM_LOG(debug, \"doEndStream() resetting stream\", stream);"
          },
          {
            "type": "context",
            "line": "   // We also don't delay-close in the case of HTTP/1.1 where the request is"
          },
          {
            "type": "context",
            "line": "   // fully read, as there's no race condition to avoid."
          },
          {
            "type": "context",
            "line": "   bool connection_close = stream.state_.saw_connection_close_;"
          },
          {
            "type": "delete",
            "line": "  bool request_complete = stream.filter_manager_.remoteComplete();"
          },
          {
            "type": "add",
            "line": "  bool request_complete = stream.filter_manager_.remoteDecodeComplete();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   checkForDeferredClose(connection_close && (request_complete || http_10_sans_cl));"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": "   // If we are destroying a stream before remote is complete and the connection does not support"
          },
          {
            "type": "context",
            "line": "   // multiplexing, we should disconnect since we don't want to wait around for the request to"
          },
          {
            "type": "context",
            "line": "   // finish."
          },
          {
            "type": "delete",
            "line": "  if (!filter_manager_.remoteComplete()) {"
          },
          {
            "type": "add",
            "line": "  if (!filter_manager_.remoteDecodeComplete()) {"
          },
          {
            "type": "context",
            "line": "     if (connection_manager_.codec_->protocol() < Protocol::Http2) {"
          },
          {
            "type": "context",
            "line": "       connection_manager_.drain_state_ = DrainState::Closing;"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "source/common/http/filter_manager.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 7dd385416d..ea5c18daca 100644"
          },
          {
            "type": "context",
            "line": "--- a/source/common/http/filter_manager.cc"
          },
          {
            "type": "context",
            "line": "+++ b/source/common/http/filter_manager.cc"
          },
          {
            "type": "context",
            "line": "   return !parent_.state_.local_complete_;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "bool ActiveStreamEncoderFilter::canContinue() {"
          },
          {
            "type": "add",
            "line": "  // As with ActiveStreamDecoderFilter::canContinue() make sure we do not"
          },
          {
            "type": "add",
            "line": "  // continue if a local reply has been sent."
          },
          {
            "type": "add",
            "line": "  return !parent_.state_.remote_encode_complete_;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " Buffer::InstancePtr ActiveStreamDecoderFilter::createBuffer() {"
          },
          {
            "type": "context",
            "line": "   auto buffer = dispatcher().getWatermarkFactory().createBuffer("
          },
          {
            "type": "context",
            "line": "       [this]() -> void { this->requestDataDrained(); },"
          },
          {
            "type": "context",
            "line": "   return parent_.buffered_request_data_;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "bool ActiveStreamDecoderFilter::complete() { return parent_.state_.remote_complete_; }"
          },
          {
            "type": "add",
            "line": "bool ActiveStreamDecoderFilter::complete() { return parent_.state_.remote_decode_complete_; }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void ActiveStreamDecoderFilter::doHeaders(bool end_stream) {"
          },
          {
            "type": "context",
            "line": "   parent_.decodeHeaders(this, *parent_.filter_manager_callbacks_.requestHeaders(), end_stream);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void FilterManager::maybeEndDecode(bool end_stream) {"
          },
          {
            "type": "delete",
            "line": "  ASSERT(!state_.remote_complete_);"
          },
          {
            "type": "delete",
            "line": "  state_.remote_complete_ = end_stream;"
          },
          {
            "type": "add",
            "line": "  ASSERT(!state_.remote_decode_complete_);"
          },
          {
            "type": "add",
            "line": "  state_.remote_decode_complete_ = end_stream;"
          },
          {
            "type": "context",
            "line": "   if (end_stream) {"
          },
          {
            "type": "context",
            "line": "     stream_info_.downstreamTiming().onLastDownstreamRxByteReceived(dispatcher().timeSource());"
          },
          {
            "type": "context",
            "line": "     ENVOY_STREAM_LOG(debug, \"request end stream\", *this);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void FilterManager::maybeEndEncode(bool end_stream) {"
          },
          {
            "type": "context",
            "line": "   if (end_stream) {"
          },
          {
            "type": "add",
            "line": "    ASSERT(!state_.remote_encode_complete_);"
          },
          {
            "type": "add",
            "line": "    state_.remote_encode_complete_ = true;"
          },
          {
            "type": "context",
            "line": "     filter_manager_callbacks_.endStream();"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " void ActiveStreamEncoderFilter::responseDataTooLarge() {"
          },
          {
            "type": "add",
            "line": "  ENVOY_STREAM_LOG(debug, \"response data too large watermark exceeded\", parent_);"
          },
          {
            "type": "context",
            "line": "   if (parent_.state_.encoder_filters_streaming_) {"
          },
          {
            "type": "context",
            "line": "     onEncoderFilterAboveWriteBufferHighWatermark();"
          },
          {
            "type": "context",
            "line": "   } else {"
          }
        ]
      },
      {
        "file": "source/common/http/filter_manager.h",
        "changes": [
          {
            "type": "context",
            "line": "index ff3c02ab85..d9c2a3d2ad 100644"
          },
          {
            "type": "context",
            "line": "--- a/source/common/http/filter_manager.h"
          },
          {
            "type": "context",
            "line": "+++ b/source/common/http/filter_manager.h"
          },
          {
            "type": "context",
            "line": "       : ActiveStreamFilterBase(parent, dual_filter, std::move(match_state)), handle_(filter) {}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   // ActiveStreamFilterBase"
          },
          {
            "type": "delete",
            "line": "  bool canContinue() override { return true; }"
          },
          {
            "type": "add",
            "line": "  bool canContinue() override;"
          },
          {
            "type": "context",
            "line": "   Buffer::InstancePtr createBuffer() override;"
          },
          {
            "type": "context",
            "line": "   Buffer::InstancePtr& bufferedData() override;"
          },
          {
            "type": "context",
            "line": "   bool complete() override;"
          },
          {
            "type": "context",
            "line": "   /**"
          },
          {
            "type": "context",
            "line": "    * Whether remote processing has been marked as complete."
          },
          {
            "type": "context",
            "line": "    */"
          },
          {
            "type": "delete",
            "line": "  bool remoteComplete() const { return state_.remote_complete_; }"
          },
          {
            "type": "add",
            "line": "  bool remoteDecodeComplete() const { return state_.remote_decode_complete_; }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   /**"
          },
          {
            "type": "context",
            "line": "    * Instructs the FilterManager to not create a filter chain. This makes it possible to issue"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   struct State {"
          },
          {
            "type": "context",
            "line": "     State()"
          },
          {
            "type": "delete",
            "line": "        : remote_complete_(false), local_complete_(false), has_1xx_headers_(false),"
          },
          {
            "type": "delete",
            "line": "          created_filter_chain_(false), is_head_request_(false), is_grpc_request_(false),"
          },
          {
            "type": "delete",
            "line": "          non_100_response_headers_encoded_(false), under_on_local_reply_(false),"
          },
          {
            "type": "delete",
            "line": "          decoder_filter_chain_aborted_(false), encoder_filter_chain_aborted_(false),"
          },
          {
            "type": "delete",
            "line": "          saw_downstream_reset_(false) {}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "        : remote_encode_complete_(false), remote_decode_complete_(false), local_complete_(false),"
          },
          {
            "type": "add",
            "line": "          has_1xx_headers_(false), created_filter_chain_(false), is_head_request_(false),"
          },
          {
            "type": "add",
            "line": "          is_grpc_request_(false), non_100_response_headers_encoded_(false),"
          },
          {
            "type": "add",
            "line": "          under_on_local_reply_(false), decoder_filter_chain_aborted_(false),"
          },
          {
            "type": "add",
            "line": "          encoder_filter_chain_aborted_(false), saw_downstream_reset_(false) {}"
          },
          {
            "type": "context",
            "line": "     uint32_t filter_call_state_{0};"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    bool remote_complete_ : 1;"
          },
          {
            "type": "add",
            "line": "    bool remote_encode_complete_ : 1;"
          },
          {
            "type": "add",
            "line": "    bool remote_decode_complete_ : 1;"
          },
          {
            "type": "context",
            "line": "     bool local_complete_ : 1; // This indicates that local is complete prior to filter processing."
          },
          {
            "type": "context",
            "line": "                               // A filter can still stop the stream from being complete as seen"
          },
          {
            "type": "context",
            "line": "                               // by the codec."
          }
        ]
      },
      {
        "file": "test/integration/BUILD",
        "changes": [
          {
            "type": "context",
            "line": "index 990e17b2d0..d93a55ba7d 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/integration/BUILD"
          },
          {
            "type": "context",
            "line": "+++ b/test/integration/BUILD"
          },
          {
            "type": "context",
            "line": "         \"//source/extensions/filters/http/buffer:config\","
          },
          {
            "type": "context",
            "line": "         \"//test/common/http/http2:http2_frame\","
          },
          {
            "type": "context",
            "line": "         \"//test/integration/filters:add_invalid_data_filter_lib\","
          },
          {
            "type": "add",
            "line": "        \"//test/integration/filters:buffer_continue_filter_lib\","
          },
          {
            "type": "context",
            "line": "         \"//test/integration/filters:continue_after_local_reply_filter_lib\","
          },
          {
            "type": "context",
            "line": "         \"//test/integration/filters:continue_headers_only_inject_body\","
          },
          {
            "type": "context",
            "line": "         \"//test/integration/filters:encoder_decoder_buffer_filter_lib\","
          }
        ]
      },
      {
        "file": "test/integration/filters/BUILD",
        "changes": [
          {
            "type": "context",
            "line": "index 7a39648ae1..e29fd05bd6 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/integration/filters/BUILD"
          },
          {
            "type": "context",
            "line": "+++ b/test/integration/filters/BUILD"
          },
          {
            "type": "context",
            "line": "     ],"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "envoy_cc_test_library("
          },
          {
            "type": "add",
            "line": "    name = \"buffer_continue_filter_lib\","
          },
          {
            "type": "add",
            "line": "    srcs = ["
          },
          {
            "type": "add",
            "line": "        \"buffer_continue_filter.cc\","
          },
          {
            "type": "add",
            "line": "    ],"
          },
          {
            "type": "add",
            "line": "    deps = ["
          },
          {
            "type": "add",
            "line": "        \"//envoy/http:filter_interface\","
          },
          {
            "type": "add",
            "line": "        \"//envoy/registry\","
          },
          {
            "type": "add",
            "line": "        \"//envoy/server:filter_config_interface\","
          },
          {
            "type": "add",
            "line": "        \"//source/extensions/filters/http/common:pass_through_filter_lib\","
          },
          {
            "type": "add",
            "line": "        \"//test/extensions/filters/http/common:empty_http_filter_config_lib\","
          },
          {
            "type": "add",
            "line": "    ],"
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " envoy_cc_test_library("
          },
          {
            "type": "context",
            "line": "     name = \"test_socket_interface_lib\","
          },
          {
            "type": "context",
            "line": "     srcs = ["
          }
        ]
      },
      {
        "file": "test/integration/filters/buffer_continue_filter.cc",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..d5f5dadd69"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/test/integration/filters/buffer_continue_filter.cc"
          },
          {
            "type": "add",
            "line": "#include <string>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"envoy/http/filter.h\""
          },
          {
            "type": "add",
            "line": "#include \"envoy/registry/registry.h\""
          },
          {
            "type": "add",
            "line": "#include \"envoy/server/filter_config.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"source/extensions/filters/http/common/pass_through_filter.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"test/extensions/filters/http/common/empty_http_filter_config.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Envoy {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// A filter that buffers until the limit is reached and then continues."
          },
          {
            "type": "add",
            "line": "class BufferContinueStreamFilter : public Http::PassThroughFilter {"
          },
          {
            "type": "add",
            "line": "public:"
          },
          {
            "type": "add",
            "line": "  Http::FilterHeadersStatus decodeHeaders(Http::RequestHeaderMap&, bool end_stream) override {"
          },
          {
            "type": "add",
            "line": "    return end_stream ? Http::FilterHeadersStatus::Continue"
          },
          {
            "type": "add",
            "line": "                      : Http::FilterHeadersStatus::StopIteration;"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  Http::FilterDataStatus decodeData(Buffer::Instance&, bool end_stream) override {"
          },
          {
            "type": "add",
            "line": "    return end_stream ? Http::FilterDataStatus::Continue"
          },
          {
            "type": "add",
            "line": "                      : Http::FilterDataStatus::StopIterationAndBuffer;"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  Http::FilterHeadersStatus encodeHeaders(Http::ResponseHeaderMap& headers, bool) override {"
          },
          {
            "type": "add",
            "line": "    response_headers_ = &headers;"
          },
          {
            "type": "add",
            "line": "    return Http::FilterHeadersStatus::StopIteration;"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  Http::FilterDataStatus encodeData(Buffer::Instance& data, bool end_stream) override {"
          },
          {
            "type": "add",
            "line": "    data_total_ += data.length();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    const auto limit = encoder_callbacks_->encoderBufferLimit();"
          },
          {
            "type": "add",
            "line": "    const auto header_size = response_headers_->byteSize();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (limit && header_size + data_total_ > limit) {"
          },
          {
            "type": "add",
            "line": "      // Give up since we've reached the buffer limit, Envoy should generate"
          },
          {
            "type": "add",
            "line": "      // a 500 since it couldn't finished encoding."
          },
          {
            "type": "add",
            "line": "      return Http::FilterDataStatus::Continue;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    encoder_callbacks_->addEncodedData(data, false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (!end_stream) {"
          },
          {
            "type": "add",
            "line": "      return Http::FilterDataStatus::StopIterationAndBuffer;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return Http::FilterDataStatus::Continue;"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "private:"
          },
          {
            "type": "add",
            "line": "  Http::ResponseHeaderMap* response_headers_;"
          },
          {
            "type": "add",
            "line": "  uint64_t data_total_{0};"
          },
          {
            "type": "add",
            "line": "};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class BufferContinueFilterConfig : public Extensions::HttpFilters::Common::EmptyHttpFilterConfig {"
          },
          {
            "type": "add",
            "line": "public:"
          },
          {
            "type": "add",
            "line": "  BufferContinueFilterConfig() : EmptyHttpFilterConfig(\"buffer-continue-filter\") {}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  Http::FilterFactoryCb createFilter(const std::string&,"
          },
          {
            "type": "add",
            "line": "                                     Server::Configuration::FactoryContext&) override {"
          },
          {
            "type": "add",
            "line": "    return [](Http::FilterChainFactoryCallbacks& callbacks) -> void {"
          },
          {
            "type": "add",
            "line": "      callbacks.addStreamFilter(std::make_shared<::Envoy::BufferContinueStreamFilter>());"
          },
          {
            "type": "add",
            "line": "    };"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// perform static registration"
          },
          {
            "type": "add",
            "line": "static Registry::RegisterFactory<BufferContinueFilterConfig,"
          },
          {
            "type": "add",
            "line": "                                 Server::Configuration::NamedHttpFilterConfigFactory>"
          },
          {
            "type": "add",
            "line": "    register_;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "} // namespace Envoy"
          }
        ]
      },
      {
        "file": "test/integration/protocol_integration_test.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 289ae403ca..33a65d23b4 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/integration/protocol_integration_test.cc"
          },
          {
            "type": "context",
            "line": "+++ b/test/integration/protocol_integration_test.cc"
          },
          {
            "type": "context",
            "line": "   EXPECT_EQ(\"200\", response->headers().getStatusValue());"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Test buffering and then continuing after too many response bytes to buffer."
          },
          {
            "type": "add",
            "line": "TEST_P(ProtocolIntegrationTest, BufferContinue) {"
          },
          {
            "type": "add",
            "line": "  // Bytes sent is configured for http/2 flow control windows."
          },
          {
            "type": "add",
            "line": "  if (upstreamProtocol() != Http::CodecType::HTTP2) {"
          },
          {
            "type": "add",
            "line": "    return;"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "  config_helper_.addConfigModifier("
          },
          {
            "type": "add",
            "line": "      [&](envoy::extensions::filters::network::http_connection_manager::v3::HttpConnectionManager&"
          },
          {
            "type": "add",
            "line": "              hcm) -> void {"
          },
          {
            "type": "add",
            "line": "        auto* route_config = hcm.mutable_route_config();"
          },
          {
            "type": "add",
            "line": "        auto* virtual_host = route_config->mutable_virtual_hosts(0);"
          },
          {
            "type": "add",
            "line": "        auto* header = virtual_host->mutable_response_headers_to_add()->Add()->mutable_header();"
          },
          {
            "type": "add",
            "line": "        header->set_key(\"foo\");"
          },
          {
            "type": "add",
            "line": "        header->set_value(\"bar\");"
          },
          {
            "type": "add",
            "line": "      });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  useAccessLog();"
          },
          {
            "type": "add",
            "line": "  config_helper_.addFilter(\"{ name: buffer-continue-filter, typed_config: { \\\"@type\\\": \""
          },
          {
            "type": "add",
            "line": "                           \"type.googleapis.com/google.protobuf.Empty } }\");"
          },
          {
            "type": "add",
            "line": "  config_helper_.setBufferLimits(1024, 1024);"
          },
          {
            "type": "add",
            "line": "  initialize();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // Send the request."
          },
          {
            "type": "add",
            "line": "  codec_client_ = makeHttpConnection(lookupPort(\"http\"));"
          },
          {
            "type": "add",
            "line": "  auto encoder_decoder = codec_client_->startRequest(default_request_headers_);"
          },
          {
            "type": "add",
            "line": "  auto downstream_request = &encoder_decoder.first;"
          },
          {
            "type": "add",
            "line": "  auto response = std::move(encoder_decoder.second);"
          },
          {
            "type": "add",
            "line": "  Buffer::OwnedImpl data(\"HTTP body content goes here\");"
          },
          {
            "type": "add",
            "line": "  codec_client_->sendData(*downstream_request, data, true);"
          },
          {
            "type": "add",
            "line": "  waitForNextUpstreamRequest();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // Send the response headers."
          },
          {
            "type": "add",
            "line": "  upstream_request_->encodeHeaders(default_response_headers_, false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // Now send an overly large response body. At some point, too much data will"
          },
          {
            "type": "add",
            "line": "  // be buffered, the stream will be reset, and the connection will disconnect."
          },
          {
            "type": "add",
            "line": "  upstream_request_->encodeData(512, false);"
          },
          {
            "type": "add",
            "line": "  upstream_request_->encodeData(1024 * 100, false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  if (upstreamProtocol() == Http::CodecType::HTTP1) {"
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(fake_upstream_connection_->waitForDisconnect());"
          },
          {
            "type": "add",
            "line": "  } else {"
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(upstream_request_->waitForReset());"
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(fake_upstream_connection_->close());"
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(fake_upstream_connection_->waitForDisconnect());"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  ASSERT_TRUE(response->waitForEndStream());"
          },
          {
            "type": "add",
            "line": "  EXPECT_TRUE(response->complete());"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(\"500\", response->headers().getStatusValue());"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " TEST_P(DownstreamProtocolIntegrationTest, ContentLengthSmallerThanPayload) {"
          },
          {
            "type": "context",
            "line": "   initialize();"
          },
          {
            "type": "context",
            "line": "   codec_client_ = makeHttpConnection(lookupPort(\"http\"));"
          }
        ]
      }
    ]
  },
  {
    "commit": "15291164b22a357cb211b618adfef4fa82fc0de3",
    "files": [
      {
        "file": "fs/jbd2/transaction.c",
        "changes": [
          {
            "type": "context",
            "line": "index 35ae096bed5d..526533062548 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/jbd2/transaction.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/jbd2/transaction.c"
          },
          {
            "type": "context",
            "line": " \tclear_buffer_mapped(bh);"
          },
          {
            "type": "context",
            "line": " \tclear_buffer_req(bh);"
          },
          {
            "type": "context",
            "line": " \tclear_buffer_new(bh);"
          },
          {
            "type": "add",
            "line": "\tclear_buffer_delay(bh);"
          },
          {
            "type": "add",
            "line": "\tclear_buffer_unwritten(bh);"
          },
          {
            "type": "context",
            "line": " \tbh->b_bdev = NULL;"
          },
          {
            "type": "context",
            "line": " \treturn may_free;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "15342f930ebebcfe36f2415049736a77d7d2e045",
    "files": [
      {
        "file": "drivers/gpu/drm/arm/malidp_planes.c",
        "changes": [
          {
            "type": "context",
            "line": "index 81d9f5004025..338cec4a3fff 100644"
          },
          {
            "type": "context",
            "line": "--- a/drivers/gpu/drm/arm/malidp_planes.c"
          },
          {
            "type": "context",
            "line": "+++ b/drivers/gpu/drm/arm/malidp_planes.c"
          },
          {
            "type": "context",
            "line": " \t\telse"
          },
          {
            "type": "context",
            "line": " \t\t\tsgt = obj->funcs->get_sg_table(obj);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (!sgt)"
          },
          {
            "type": "add",
            "line": "\t\tif (IS_ERR(sgt))"
          },
          {
            "type": "context",
            "line": " \t\t\treturn false;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tsgl = sgt->sgl;"
          }
        ]
      }
    ]
  },
  {
    "commit": "153695d36ead0ccc4d0256953c751cabf673e621",
    "files": [
      {
        "file": "fs/cifs/connect.c",
        "changes": [
          {
            "type": "context",
            "line": "index ffb291579bb9..1cc47dd3b4d6 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/cifs/connect.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/cifs/connect.c"
          },
          {
            "type": "context",
            "line": " \tserver->session_key.response = NULL;"
          },
          {
            "type": "context",
            "line": " \tserver->session_key.len = 0;"
          },
          {
            "type": "context",
            "line": " \tkfree(server->hostname);"
          },
          {
            "type": "add",
            "line": "\tserver->hostname = NULL;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ttask = xchg(&server->tsk, NULL);"
          },
          {
            "type": "context",
            "line": " \tif (task)"
          }
        ]
      }
    ]
  },
  {
    "commit": "1540d334a04d874c2aa9d26b82dbbcd4bc5a78de",
    "files": [
      {
        "file": "src/testdir/test_assert.vim",
        "changes": [
          {
            "type": "context",
            "line": "index 01e7718bb..5d4abaa8a 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testdir/test_assert.vim"
          },
          {
            "type": "context",
            "line": "+++ b/src/testdir/test_assert.vim"
          },
          {
            "type": "context",
            "line": "   endtry"
          },
          {
            "type": "context",
            "line": "   call assert_match(\"E1222: String or List required for argument 2\", exp)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  try"
          },
          {
            "type": "add",
            "line": "    call assert_equal(0, assert_fails('xxx', [#{one: 1}]))"
          },
          {
            "type": "add",
            "line": "  catch"
          },
          {
            "type": "add",
            "line": "    let exp = v:exception"
          },
          {
            "type": "add",
            "line": "  endtry"
          },
          {
            "type": "add",
            "line": "  call assert_match(\"E731: Using a Dictionary as a String\", exp)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  let exp = ''"
          },
          {
            "type": "add",
            "line": "  try"
          },
          {
            "type": "add",
            "line": "    call assert_equal(0, assert_fails('xxx', ['E492', #{one: 1}]))"
          },
          {
            "type": "add",
            "line": "  catch"
          },
          {
            "type": "add",
            "line": "    let exp = v:exception"
          },
          {
            "type": "add",
            "line": "  endtry"
          },
          {
            "type": "add",
            "line": "  call assert_match(\"E731: Using a Dictionary as a String\", exp)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   try"
          },
          {
            "type": "context",
            "line": "     call assert_equal(1, assert_fails('xxx', 'E492', '', 'burp'))"
          },
          {
            "type": "context",
            "line": "   catch"
          },
          {
            "type": "context",
            "line": "   endtry"
          },
          {
            "type": "context",
            "line": "   call assert_match(\"E1174: String required for argument 5\", exp)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  call assert_equal(1, assert_fails('c0', ['', '\\1']))"
          },
          {
            "type": "delete",
            "line": "  call assert_match(\"Expected '\\\\\\\\\\\\\\\\1' but got 'E939: Positive count required: c0': c0\", v:errors[0])"
          },
          {
            "type": "add",
            "line": "  call assert_equal(1, assert_fails('c0', ['', '\\(.\\)\\1']))"
          },
          {
            "type": "add",
            "line": "  call assert_match(\"Expected '\\\\\\\\\\\\\\\\(.\\\\\\\\\\\\\\\\)\\\\\\\\\\\\\\\\1' but got 'E939: Positive count required: c0': c0\", v:errors[0])"
          },
          {
            "type": "context",
            "line": "   call remove(v:errors, 0)"
          },
          {
            "type": "context",
            "line": " endfunc"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/testing.c",
        "changes": [
          {
            "type": "context",
            "line": "index 8c682cf6b..fb5c9ab4c 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testing.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/testing.c"
          },
          {
            "type": "context",
            "line": "     in_assert_fails = TRUE;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     do_cmdline_cmd(cmd);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    // reset here for any errors reported below"
          },
          {
            "type": "add",
            "line": "    trylevel = save_trylevel;"
          },
          {
            "type": "add",
            "line": "    suppress_errthrow = FALSE;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (called_emsg == called_emsg_before)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": " \tprepare_assert_error(&ga);"
          },
          {
            "type": "context",
            "line": " \t    CHECK_LIST_MATERIALIZE(list);"
          },
          {
            "type": "context",
            "line": " \t    tv = &list->lv_first->li_tv;"
          },
          {
            "type": "context",
            "line": " \t    expected = tv_get_string_buf_chk(tv, buf);"
          },
          {
            "type": "add",
            "line": "\t    if (expected == NULL)"
          },
          {
            "type": "add",
            "line": "\t\tgoto theend;"
          },
          {
            "type": "context",
            "line": " \t    if (!pattern_match(expected, actual, FALSE))"
          },
          {
            "type": "context",
            "line": " \t    {"
          },
          {
            "type": "context",
            "line": " \t\terror_found = TRUE;"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t    tv = &list->lv_u.mat.lv_last->li_tv;"
          },
          {
            "type": "context",
            "line": " \t\t    expected = tv_get_string_buf_chk(tv, buf);"
          },
          {
            "type": "add",
            "line": "\t\t    if (expected == NULL)"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto theend;"
          },
          {
            "type": "context",
            "line": " \t\t    if (!pattern_match(expected, actual, FALSE))"
          },
          {
            "type": "context",
            "line": " \t\t    {"
          },
          {
            "type": "context",
            "line": " \t\t\terror_found = TRUE;"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index db1a1dec5..36ce07ef9 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    404,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     403,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      }
    ]
  },
  {
    "commit": "1572e45a924f254d9570093abde46430c3172e3d",
    "files": [
      {
        "file": "kernel/events/core.c",
        "changes": [
          {
            "type": "context",
            "line": "index d4e3f8d8238b..c1c1cdf0b811 100644"
          },
          {
            "type": "context",
            "line": "--- a/kernel/events/core.c"
          },
          {
            "type": "context",
            "line": "+++ b/kernel/events/core.c"
          },
          {
            "type": "context",
            "line": " \t\t\t\tvoid __user *buffer, size_t *lenp,"
          },
          {
            "type": "context",
            "line": " \t\t\t\tloff_t *ppos)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "\tint ret = proc_dointvec(table, write, buffer, lenp, ppos);"
          },
          {
            "type": "add",
            "line": "\tint ret = proc_dointvec_minmax(table, write, buffer, lenp, ppos);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (ret || !write)"
          },
          {
            "type": "context",
            "line": " \t\treturn ret;"
          }
        ]
      }
    ]
  },
  {
    "commit": "158a66b245739e15858de42c0ba60fcf3de9b8e6",
    "files": [
      {
        "file": "fs/ksmbd/smb2pdu.c",
        "changes": [
          {
            "type": "context",
            "line": "index 16c803a9d996..2bdfe449b2da 100644"
          },
          {
            "type": "context",
            "line": "--- a/fs/ksmbd/smb2pdu.c"
          },
          {
            "type": "context",
            "line": "+++ b/fs/ksmbd/smb2pdu.c"
          },
          {
            "type": "context",
            "line": " \tlength = le32_to_cpu(req->Length);"
          },
          {
            "type": "context",
            "line": " \tid = req->VolatileFileId;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (le16_to_cpu(req->DataOffset) =="
          },
          {
            "type": "delete",
            "line": "\t    offsetof(struct smb2_write_req, Buffer)) {"
          },
          {
            "type": "delete",
            "line": "\t\tdata_buf = (char *)&req->Buffer[0];"
          },
          {
            "type": "delete",
            "line": "\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\tif ((u64)le16_to_cpu(req->DataOffset) + length >"
          },
          {
            "type": "delete",
            "line": "\t\t    get_rfc1002_len(work->request_buf)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tpr_err(\"invalid write data offset %u, smb_len %u\\n\","
          },
          {
            "type": "delete",
            "line": "\t\t\t       le16_to_cpu(req->DataOffset),"
          },
          {
            "type": "delete",
            "line": "\t\t\t       get_rfc1002_len(work->request_buf));"
          },
          {
            "type": "delete",
            "line": "\t\t\terr = -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\t\t\tgoto out;"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tdata_buf = (char *)(((char *)&req->hdr.ProtocolId) +"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tle16_to_cpu(req->DataOffset));"
          },
          {
            "type": "add",
            "line": "\tif ((u64)le16_to_cpu(req->DataOffset) + length >"
          },
          {
            "type": "add",
            "line": "\t    get_rfc1002_len(work->request_buf)) {"
          },
          {
            "type": "add",
            "line": "\t\tpr_err(\"invalid write data offset %u, smb_len %u\\n\","
          },
          {
            "type": "add",
            "line": "\t\t       le16_to_cpu(req->DataOffset),"
          },
          {
            "type": "add",
            "line": "\t\t       get_rfc1002_len(work->request_buf));"
          },
          {
            "type": "add",
            "line": "\t\terr = -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\tgoto out;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tdata_buf = (char *)(((char *)&req->hdr.ProtocolId) +"
          },
          {
            "type": "add",
            "line": "\t\t\t   le16_to_cpu(req->DataOffset));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \trpc_resp = ksmbd_rpc_write(work->sess, id, data_buf, length);"
          },
          {
            "type": "context",
            "line": " \tif (rpc_resp) {"
          },
          {
            "type": "context",
            "line": " \t\tif (rpc_resp->flags == KSMBD_RPC_ENOTIMPLEMENTED) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (req->Channel != SMB2_CHANNEL_RDMA_V1 &&"
          },
          {
            "type": "context",
            "line": " \t    req->Channel != SMB2_CHANNEL_RDMA_V1_INVALIDATE) {"
          },
          {
            "type": "delete",
            "line": "\t\tif (le16_to_cpu(req->DataOffset) =="
          },
          {
            "type": "delete",
            "line": "\t\t    offsetof(struct smb2_write_req, Buffer)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tdata_buf = (char *)&req->Buffer[0];"
          },
          {
            "type": "delete",
            "line": "\t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\tif ((u64)le16_to_cpu(req->DataOffset) + length >"
          },
          {
            "type": "delete",
            "line": "\t\t\t    get_rfc1002_len(work->request_buf)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tpr_err(\"invalid write data offset %u, smb_len %u\\n\","
          },
          {
            "type": "delete",
            "line": "\t\t\t\t       le16_to_cpu(req->DataOffset),"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t       get_rfc1002_len(work->request_buf));"
          },
          {
            "type": "delete",
            "line": "\t\t\t\terr = -EINVAL;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tgoto out;"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tdata_buf = (char *)(((char *)&req->hdr.ProtocolId) +"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tle16_to_cpu(req->DataOffset));"
          },
          {
            "type": "add",
            "line": "\t\tif ((u64)le16_to_cpu(req->DataOffset) + length >"
          },
          {
            "type": "add",
            "line": "\t\t    get_rfc1002_len(work->request_buf)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tpr_err(\"invalid write data offset %u, smb_len %u\\n\","
          },
          {
            "type": "add",
            "line": "\t\t\t       le16_to_cpu(req->DataOffset),"
          },
          {
            "type": "add",
            "line": "\t\t\t       get_rfc1002_len(work->request_buf));"
          },
          {
            "type": "add",
            "line": "\t\t\terr = -EINVAL;"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto out;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": "\t\tdata_buf = (char *)(((char *)&req->hdr.ProtocolId) +"
          },
          {
            "type": "add",
            "line": "\t\t\t\t    le16_to_cpu(req->DataOffset));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tksmbd_debug(SMB, \"flags %u\\n\", le32_to_cpu(req->Flags));"
          },
          {
            "type": "context",
            "line": " \t\tif (le32_to_cpu(req->Flags) & SMB2_WRITEFLAG_WRITE_THROUGH)"
          }
        ]
      }
    ]
  },
  {
    "commit": "158c8b2f788b75e0d26e9249a75e1be291e59d4b",
    "files": [
      {
        "file": "app/Controller/Component/IndexFilterComponent.php",
        "changes": [
          {
            "type": "context",
            "line": "index 15fc73924..064a0bb87 100644"
          },
          {
            "type": "context",
            "line": "--- a/app/Controller/Component/IndexFilterComponent.php"
          },
          {
            "type": "context",
            "line": "+++ b/app/Controller/Component/IndexFilterComponent.php"
          },
          {
            "type": "context",
            "line": "     private function __massageData($data, $request, $paramArray)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $data = array_filter($data, function($paramName) use ($paramArray) {"
          },
          {
            "type": "delete",
            "line": "            return in_array($paramName, $paramArray);"
          },
          {
            "type": "add",
            "line": "            return in_array($paramName, $paramArray, true);"
          },
          {
            "type": "context",
            "line": "         }, ARRAY_FILTER_USE_KEY);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!empty($paramArray)) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "15a6f845d8206b0ae97f37aa092ca43d4f9d6e59",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-bridge/src/main/java/org/xwiki/bridge/DocumentModelBridge.java",
        "changes": [
          {
            "type": "context",
            "line": "index a97e911772c..3efdce44560 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-bridge/src/main/java/org/xwiki/bridge/DocumentModelBridge.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-bridge/src/main/java/org/xwiki/bridge/DocumentModelBridge.java"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return null;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @return {@code true} if the document is restricted, i.e., transformations should be executed in restricted mode"
          },
          {
            "type": "add",
            "line": "     * @since 15.2RC1"
          },
          {
            "type": "add",
            "line": "     * @since 14.10.7"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "add",
            "line": "    default boolean isRestricted()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return false;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/AbstractDocumentTitleDisplayer.java",
        "changes": [
          {
            "type": "context",
            "line": "index 46a508a01c9..0d2d26ba76c 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/AbstractDocumentTitleDisplayer.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/AbstractDocumentTitleDisplayer.java"
          },
          {
            "type": "context",
            "line": "         if (!StringUtils.isEmpty(rawTitle)) {"
          },
          {
            "type": "context",
            "line": "             try {"
          },
          {
            "type": "context",
            "line": "                 String title = rawTitle;"
          },
          {
            "type": "delete",
            "line": "                // Evaluate the title only if the document has script rights, otherwise use the raw title."
          },
          {
            "type": "delete",
            "line": "                if (authorizationManager.hasAccess(Right.SCRIPT, document.getContentAuthorReference(),"
          },
          {
            "type": "delete",
            "line": "                    document.getDocumentReference())) {"
          },
          {
            "type": "add",
            "line": "                // Evaluate the title only if the document is not restricted and its content's author has script"
          },
          {
            "type": "add",
            "line": "                // right, otherwise use the raw title."
          },
          {
            "type": "add",
            "line": "                if (!document.isRestricted() && this.authorizationManager.hasAccess(Right.SCRIPT,"
          },
          {
            "type": "add",
            "line": "                    document.getContentAuthorReference(), document.getDocumentReference()))"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "context",
            "line": "                     title = evaluateTitle(rawTitle, document, parameters);"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 return parseTitle(title);"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/DocumentContentAsyncRenderer.java",
        "changes": [
          {
            "type": "context",
            "line": "index 0a725fdf541..a555bc4f475 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/DocumentContentAsyncRenderer.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/DocumentContentAsyncRenderer.java"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         this.parameters = parameters;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Make sure the restricted property of the document is properly taken into account."
          },
          {
            "type": "add",
            "line": "        if (document.isRestricted()) {"
          },
          {
            "type": "add",
            "line": "            parameters.setTransformationContextRestricted(true);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         this.asyncProperties = this.asyncParser.getAsyncProperties(document);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         String transformationId = this.defaultEntityReferenceSerializer"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/DocumentTitleDisplayer.java",
        "changes": [
          {
            "type": "context",
            "line": "index dc11f1da4a9..a8ed848cc18 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/DocumentTitleDisplayer.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-display/xwiki-platform-display-api/src/main/java/org/xwiki/display/internal/DocumentTitleDisplayer.java"
          },
          {
            "type": "context",
            "line": "                 try {"
          },
          {
            "type": "context",
            "line": "                     TransformationContext txContext ="
          },
          {
            "type": "context",
            "line": "                         new TransformationContext(headingXDOM, document.getSyntax(),"
          },
          {
            "type": "delete",
            "line": "                                                  parameters.isTransformationContextRestricted());"
          },
          {
            "type": "add",
            "line": "                            parameters.isTransformationContextRestricted() || document.isRestricted());"
          },
          {
            "type": "context",
            "line": "                     txContext.setTargetSyntax(parameters.getTargetSyntax());"
          },
          {
            "type": "context",
            "line": "                     transformationManager.performTransformations(headingXDOM, txContext);"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/contentheader.vm",
        "changes": [
          {
            "type": "context",
            "line": "index 1435f9910e5..7cbf038086a 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/contentheader.vm"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-resources/src/main/resources/flamingo/contentheader.vm"
          },
          {
            "type": "context",
            "line": "     </div>"
          },
          {
            "type": "context",
            "line": "   #end"
          },
          {
            "type": "context",
            "line": " </div>"
          },
          {
            "type": "add",
            "line": "## Display a warning regarding restricted mode for advanced users or when there is an actual error to not to confuse"
          },
          {
            "type": "add",
            "line": "## simple users. Also, only display the warning for the content viewer as other viewers shouldn't display"
          },
          {
            "type": "add",
            "line": "## rendered content of old revisions and this would thus only confuse users."
          },
          {
            "type": "add",
            "line": "#if ($viewer == 'content' && $doc.isRestricted()"
          },
          {
            "type": "add",
            "line": "  && ($isAdvancedUser || $stringtool.contains($renderedContent, 'xwikirenderingerror')))"
          },
          {
            "type": "add",
            "line": "  #warning($escapetool.xml($services.localization.render('core.document.restrictedInfo')))"
          },
          {
            "type": "add",
            "line": "#end"
          },
          {
            "type": "context",
            "line": " <hr/>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/RecycleBinIT.java",
        "changes": [
          {
            "type": "context",
            "line": "index c0b54b5fc2d..99da14c8569 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/RecycleBinIT.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/RecycleBinIT.java"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.po.HistoryPane;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.po.ViewPage;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static org.hamcrest.MatcherAssert.assertThat;"
          },
          {
            "type": "add",
            "line": "import static org.hamcrest.Matchers.startsWith;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertEquals;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertFalse;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "context",
            "line": "         assertTrue(deletedPagesEntries.get(0).canBeRestored());"
          },
          {
            "type": "context",
            "line": "         assertTrue(deletedTerminalPagesEntries.get(0).canBeRestored());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    @Order(3)"
          },
          {
            "type": "add",
            "line": "    void deletedDocumentIsRestricted(TestUtils testUtils, TestReference testReference)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        testUtils.loginAsSuperAdmin();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        ViewPage viewPage = testUtils.createPage(testReference, \"{{velocity}}Velocity content{{/velocity}}\", \"Title\");"
          },
          {
            "type": "add",
            "line": "        // Make sure the Velocity macro is executed normally."
          },
          {
            "type": "add",
            "line": "        assertEquals(\"Velocity content\", viewPage.getContent());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        viewPage.deletePage().confirmDeletePage().waitUntilFinished();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        testUtils.gotoPage(testReference);"
          },
          {
            "type": "add",
            "line": "        DeletePageOutcomePage recycleBinPage = new DeletePageOutcomePage();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        List<DeletedPageEntry> deletedPageEntries = recycleBinPage.getDeletedPagesEntries();"
          },
          {
            "type": "add",
            "line": "        assertFalse(deletedPageEntries.isEmpty());"
          },
          {
            "type": "add",
            "line": "        viewPage = deletedPageEntries.get(0).clickView();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(\"Title\", viewPage.getDocumentTitle());"
          },
          {
            "type": "add",
            "line": "        // In the preview the Velocity macro should be forbidden."
          },
          {
            "type": "add",
            "line": "        assertThat(viewPage.getContent(), startsWith(\"Failed to execute the [velocity] macro.\"));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        testUtils.gotoPage(testReference);"
          },
          {
            "type": "add",
            "line": "        recycleBinPage = new DeletePageOutcomePage();"
          },
          {
            "type": "add",
            "line": "        viewPage = recycleBinPage.getDeletedPagesEntries().get(0).clickRestore();"
          },
          {
            "type": "add",
            "line": "        // Assert that in the restored document, scripts are allowed again."
          },
          {
            "type": "add",
            "line": "        assertEquals(\"Velocity content\", viewPage.getContent());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/VersionIT.java",
        "changes": [
          {
            "type": "context",
            "line": "index 28e0eb626f3..7458112a406 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/VersionIT.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/VersionIT.java"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.po.ViewPage;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.po.editor.WikiEditPage;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static org.hamcrest.MatcherAssert.assertThat;"
          },
          {
            "type": "add",
            "line": "import static org.hamcrest.Matchers.startsWith;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertEquals;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         attachmentsPane.getAttachmentLink(\"file.txt\").click();"
          },
          {
            "type": "context",
            "line": "         assertEquals(\"1\", utils.getDriver().findElement(By.tagName(\"html\")).getText());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    @Order(5)"
          },
          {
            "type": "add",
            "line": "    void oldRevisionsAreRestricted(TestUtils utils, TestReference testReference) throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        utils.loginAsSuperAdmin();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        utils.rest().delete(testReference);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Create first version of the page"
          },
          {
            "type": "add",
            "line": "        ViewPage vp = utils.createPage(testReference, \"{{velocity}}\" + CONTENT1 + \"{{/velocity}}\", TITLE);"
          },
          {
            "type": "add",
            "line": "        assertEquals(CONTENT1, vp.getContent());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Adds second version"
          },
          {
            "type": "add",
            "line": "        WikiEditPage wikiEditPage = vp.editWiki();"
          },
          {
            "type": "add",
            "line": "        wikiEditPage.setContent(\"{{velocity}}\" + CONTENT2 + \"{{velocity}}\");"
          },
          {
            "type": "add",
            "line": "        vp = wikiEditPage.clickSaveAndView();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(CONTENT2, vp.getContent());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // TODO: Remove when XWIKI-6688 (Possible race condition when clicking on a tab at the bottom of a page in"
          },
          {
            "type": "add",
            "line": "        // view mode) is fixed."
          },
          {
            "type": "add",
            "line": "        vp.waitForDocExtraPaneActive(\"comments\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        HistoryPane historyTab = vp.openHistoryDocExtraPane();"
          },
          {
            "type": "add",
            "line": "        vp = historyTab.viewVersion(\"1.1\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // In the preview the Velocity macro should be forbidden."
          },
          {
            "type": "add",
            "line": "        assertThat(vp.getContent(), startsWith(\"Failed to execute the [velocity] macro.\"));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // TODO: Remove when XWIKI-6688 (Possible race condition when clicking on a tab at the bottom of a page in"
          },
          {
            "type": "add",
            "line": "        // view mode) is fixed."
          },
          {
            "type": "add",
            "line": "        vp.waitForDocExtraPaneActive(\"comments\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        historyTab = vp.openHistoryDocExtraPane();"
          },
          {
            "type": "add",
            "line": "        vp = historyTab.rollbackToVersion(\"1.1\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Rollback doesn't wait..."
          },
          {
            "type": "add",
            "line": "        // Wait for the comment tab to be selected since we're currently on the history tab and rolling"
          },
          {
            "type": "add",
            "line": "        // back is going to load a new page and make the focus active on the comments tab."
          },
          {
            "type": "add",
            "line": "        vp.waitForDocExtraPaneActive(\"comments\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Assert that scripts are executed again after restoring the version."
          },
          {
            "type": "add",
            "line": "        assertEquals(CONTENT1, vp.getContent());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-legacy/xwiki-platform-legacy-oldcore/src/main/aspect/com/xpn/xwiki/doc/XWikiDocumentCompatibilityAspect.aj",
        "changes": [
          {
            "type": "context",
            "line": "index 311bdc1f361..65e795ffa17 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-legacy/xwiki-platform-legacy-oldcore/src/main/aspect/com/xpn/xwiki/doc/XWikiDocumentCompatibilityAspect.aj"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-legacy/xwiki-platform-legacy-oldcore/src/main/aspect/com/xpn/xwiki/doc/XWikiDocumentCompatibilityAspect.aj"
          },
          {
            "type": "context",
            "line": "                         XDOM headerXDOM = new XDOM(Collections.<Block> singletonList(header));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                         // transform"
          },
          {
            "type": "delete",
            "line": "                        TransformationContext context = new TransformationContext(headerXDOM, getSyntax());"
          },
          {
            "type": "add",
            "line": "                        TransformationContext context ="
          },
          {
            "type": "add",
            "line": "                            new TransformationContext(headerXDOM, getSyntax(), isRestricted());"
          },
          {
            "type": "context",
            "line": "                         Utils.getComponent(TransformationManager.class).performTransformations(headerXDOM, context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                         // render"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/Document.java",
        "changes": [
          {
            "type": "context",
            "line": "index a2379ecffcb..c7626f8607d 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/Document.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/api/Document.java"
          },
          {
            "type": "context",
            "line": "         return this.doc.isMostRecent();"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @return if rendering transformations shall be executed in restricted mode and the title not be executed"
          },
          {
            "type": "add",
            "line": "     * @since 14.10.7"
          },
          {
            "type": "add",
            "line": "     * @since 15.2RC1"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "add",
            "line": "    public boolean isRestricted()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return this.doc.isRestricted();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": "     public String toString()"
          },
          {
            "type": "context",
            "line": "     {"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java",
        "changes": [
          {
            "type": "context",
            "line": "index 6b914380d1a..a0f588b639c 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/doc/XWikiDocument.java"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     private XWikiDocument originalDocument;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * If the document should always be rendered in restricted mode."
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    private boolean restricted;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * Used to display the title and the content of this document. Do not inject the component here to avoid any simple"
          },
          {
            "type": "context",
            "line": "      * new XWikiDocument to cause many useless initialization, in particular, during initialization of the stub context"
          },
          {
            "type": "context",
            "line": "                 DocumentDisplayerParameters parameters = new DocumentDisplayerParameters();"
          },
          {
            "type": "context",
            "line": "                 parameters.setExecutionContextIsolated(executionContextIsolated);"
          },
          {
            "type": "context",
            "line": "                 parameters.setTransformationContextIsolated(transformationContextIsolated);"
          },
          {
            "type": "add",
            "line": "                // Don't consider isRestricted() here as this could invoke a sheet."
          },
          {
            "type": "context",
            "line": "                 parameters.setTransformationContextRestricted(transformationContextRestricted);"
          },
          {
            "type": "context",
            "line": "                 // Render the translated content (matching the current language) using this document's syntax."
          },
          {
            "type": "context",
            "line": "                 parameters.setContentTranslated(tdoc != this);"
          },
          {
            "type": "context",
            "line": "             XWikiDocument fakeDocument = new XWikiDocument(getDocumentReference());"
          },
          {
            "type": "context",
            "line": "             fakeDocument.setSyntax(sourceSyntaxId);"
          },
          {
            "type": "context",
            "line": "             fakeDocument.setContent(text);"
          },
          {
            "type": "add",
            "line": "            fakeDocument.setRestricted(sDocument != null && sDocument.isRestricted());"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             // We don't let displayer take care of the context isolation because we don't want the fake document to be"
          },
          {
            "type": "context",
            "line": "             // context document"
          },
          {
            "type": "context",
            "line": "             doc.setMinorEdit(isMinorEdit());"
          },
          {
            "type": "context",
            "line": "             doc.setSyntax(getSyntax());"
          },
          {
            "type": "context",
            "line": "             doc.setHidden(isHidden());"
          },
          {
            "type": "add",
            "line": "            doc.setRestricted(isRestricted());"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (this.xClass != null) {"
          },
          {
            "type": "context",
            "line": "                 doc.setXClass(this.xClass.clone());"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * Indicates whether some other document is \"equal to\" this one."
          },
          {
            "type": "add",
            "line": "     * <p>"
          },
          {
            "type": "add",
            "line": "     * This ignores the {@link #isRestricted()} property as it is not considered to be part of the data."
          },
          {
            "type": "add",
            "line": "     *"
          },
          {
            "type": "add",
            "line": "     * @param object the document to compare to"
          },
          {
            "type": "add",
            "line": "     * @return {@code true} if this document is the same as the object argument; {@code false} otherwise"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": "     public boolean equals(Object object)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         // There is no syntax by default in a new document and the default one is retrieved from the configuration"
          },
          {
            "type": "context",
            "line": "         setSyntax(getSyntax());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @return if rendering transformations shall be executed in restricted mode and the title not be executed"
          },
          {
            "type": "add",
            "line": "     * @since 14.10.7"
          },
          {
            "type": "add",
            "line": "     * @since 15.2RC1"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    @Override"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "add",
            "line": "    public boolean isRestricted()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return this.restricted;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * Set the restricted property that disables scripts and other dangerous content."
          },
          {
            "type": "add",
            "line": "     * <p>"
          },
          {
            "type": "add",
            "line": "     * This property is not stored in the database as it is only supposed to be {@code true} on documents that do not"
          },
          {
            "type": "add",
            "line": "     * correspond to the current version of the document."
          },
          {
            "type": "add",
            "line": "     *"
          },
          {
            "type": "add",
            "line": "     * @param restricted if rendering transformations shall be executed in restricted mode and the title not be executed"
          },
          {
            "type": "add",
            "line": "     * @since 14.10.7"
          },
          {
            "type": "add",
            "line": "     * @since 15.2RC1"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    @Unstable"
          },
          {
            "type": "add",
            "line": "    public void setRestricted(boolean restricted)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        this.restricted = restricted;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/filter/output/XWikiDocumentOutputFilterStream.java",
        "changes": [
          {
            "type": "context",
            "line": "index 51b2ed21046..2b5ad6cf041 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/filter/output/XWikiDocumentOutputFilterStream.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/filter/output/XWikiDocumentOutputFilterStream.java"
          },
          {
            "type": "context",
            "line": "             this.entity.setLocale(this.currentLocale);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Mark the document as restricted to avoid that any scripts are executed as scripts should only be executed"
          },
          {
            "type": "add",
            "line": "        // on the current, saved version, see https://jira.xwiki.org/browse/XWIKI-20594"
          },
          {
            "type": "add",
            "line": "        this.entity.setRestricted(true);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         // Find default author"
          },
          {
            "type": "context",
            "line": "         DocumentReference defaultAuthorDocumentReference;"
          },
          {
            "type": "context",
            "line": "         // TODO: move to UserReference based APIs in DocumentInstanceOutputProperties"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateStore.java",
        "changes": [
          {
            "type": "context",
            "line": "index 7429b19d16c..a1a9500f172 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateStore.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/store/XWikiHibernateStore.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     doc.setNew(false);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "                    // Make sure that properly saved documents aren't restricted."
          },
          {
            "type": "add",
            "line": "                    doc.setRestricted(false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     // We need to ensure that the saved document becomes the original document"
          },
          {
            "type": "context",
            "line": "                     doc.setOriginalDocument(doc.clone());"
          },
          {
            "type": "context",
            "line": "                 } finally {"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/main/resources/ApplicationResources.properties",
        "changes": [
          {
            "type": "context",
            "line": "index 3fdc7d4328e..ff9731cc285 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/main/resources/ApplicationResources.properties"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/main/resources/ApplicationResources.properties"
          },
          {
            "type": "context",
            "line": " core.footer.translationCreation=Translated into {0} by {1} on {2}"
          },
          {
            "type": "context",
            "line": " core.footer.modification=Last modified by {0} on {1}"
          },
          {
            "type": "context",
            "line": " core.document.modificationWithVersion=Version {0} by {1} on {2}"
          },
          {
            "type": "add",
            "line": "core.document.restrictedInfo=For security reasons, the document is displayed in restricted mode as it is not the \\"
          },
          {
            "type": "add",
            "line": "  current version. There may be differences and errors due to this."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " core.document.error.failedParse=Failed to parse document content"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " web.history.changes.attachment.notAvailable=The content diff is not available. One attachment might have been deleted from the recycle bin."
          },
          {
            "type": "context",
            "line": " web.history.changes.showContext=Show context"
          },
          {
            "type": "context",
            "line": " web.history.changes.hideContext=Hide context"
          },
          {
            "type": "add",
            "line": "web.history.changes.restrictedInfo=For security reasons, at least one of the compared documents is displayed in \\"
          },
          {
            "type": "add",
            "line": "  restricted mode as it is not the current version. There may be differences and errors due to this."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " core.viewers.diff.title=Changes for page <a href=\"{1}\">{0}</a>"
          },
          {
            "type": "context",
            "line": " core.viewers.diff.from=From version {0}"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentMockitoTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 97bf9530512..d794a195e53 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentMockitoTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentMockitoTest.java"
          },
          {
            "type": "context",
            "line": "         newDocument.fromXML(document, false);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         assertEquals(this.document, newDocument);"
          },
          {
            "type": "add",
            "line": "        // Assert that the document restored from XML is restricted in contrast to the original document."
          },
          {
            "type": "add",
            "line": "        assertFalse(this.document.isRestricted());"
          },
          {
            "type": "add",
            "line": "        assertTrue(newDocument.isRestricted());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Test"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentRenderingTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 6cc9698c4a5..8b74ca50fce 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentRenderingTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/doc/XWikiDocumentRenderingTest.java"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import java.io.Reader;"
          },
          {
            "type": "context",
            "line": " import java.util.Arrays;"
          },
          {
            "type": "add",
            "line": "import java.util.List;"
          },
          {
            "type": "context",
            "line": " import java.util.Locale;"
          },
          {
            "type": "context",
            "line": " import java.util.Properties;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import org.xwiki.display.internal.DisplayConfiguration;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.model.reference.DocumentReference;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.rendering.syntax.Syntax;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.transformation.RenderingContext;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.security.authorization.Right;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.annotation.AllComponents;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.junit5.mockito.InjectComponentManager;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.mockito.MockitoComponentManager;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.test.junit5.mockito.InjectMockitoOldcore;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static org.hamcrest.MatcherAssert.assertThat;"
          },
          {
            "type": "add",
            "line": "import static org.hamcrest.Matchers.startsWith;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertEquals;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.any;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.eq;"
          },
          {
            "type": "context",
            "line": "         this.oldcore.getXWikiContext().put(\"isInRenderingEngine\", true);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         when(this.oldcore.getMockAuthorizationManager().hasAccess(any(), any(), any())).thenReturn(true);"
          },
          {
            "type": "delete",
            "line": "        when(this.oldcore.getMockContextualAuthorizationManager().hasAccess(any())).thenReturn(true);"
          },
          {
            "type": "add",
            "line": "        when(this.oldcore.getMockContextualAuthorizationManager().hasAccess(any())).thenAnswer(invocationOnMock -> {"
          },
          {
            "type": "add",
            "line": "            if (List.of(Right.SCRIPT, Right.PROGRAM).contains(invocationOnMock.getArgument(0))) {"
          },
          {
            "type": "add",
            "line": "                RenderingContext renderingContext = this.oldcore.getMocker().getInstance(RenderingContext.class);"
          },
          {
            "type": "add",
            "line": "                return !renderingContext.isRestricted();"
          },
          {
            "type": "add",
            "line": "            } else {"
          },
          {
            "type": "add",
            "line": "                return true;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        });"
          },
          {
            "type": "context",
            "line": "         when(this.xwiki.getRightService().hasProgrammingRights(any())).thenReturn(true);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         this.componentManager"
          },
          {
            "type": "context",
            "line": "         assertEquals(\"title\", this.document.getRenderedTitle(Syntax.XHTML_1_0, this.oldcore.getXWikiContext()));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void getRenderedTitleRestricted()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        this.document.setRestricted(true);"
          },
          {
            "type": "add",
            "line": "        // Title with velocity that shouldn't be evaluated"
          },
          {
            "type": "add",
            "line": "        String title = \"#set($key = \\\"title\\\")$key\";"
          },
          {
            "type": "add",
            "line": "        this.document.setTitle(title);"
          },
          {
            "type": "add",
            "line": "        assertEquals(title, this.document.getRenderedTitle(Syntax.XHTML_1_0, this.oldcore.getXWikiContext()));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Test"
          },
          {
            "type": "context",
            "line": "     public void getRenderedTitleInHTMLWhenExtractedFromContent()"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         assertEquals(\"Page\", this.document.getRenderedTitle(Syntax.XHTML_1_0, this.oldcore.getXWikiContext()));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void getRenderedTitleWhenRestricted()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        // Configure XWiki to extract title from content"
          },
          {
            "type": "add",
            "line": "        this.oldcore.getConfigurationSource().setProperty(\"xwiki.title.compatibility\", \"1\");"
          },
          {
            "type": "add",
            "line": "        this.document.setRestricted(true);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.document.setContent(\"content not in section\\n\""
          },
          {
            "type": "add",
            "line": "            + \"= {{groovy}}print \\\"value\\\"{{/groovy}}=\\nheader 1 content\\n\" + \"== header 2==\\nheader 2 content\");"
          },
          {
            "type": "add",
            "line": "        assertThat(this.document.getRenderedTitle(Syntax.XHTML_1_0, this.oldcore.getXWikiContext()),"
          },
          {
            "type": "add",
            "line": "            startsWith(\"<span class=\\\"xwikirenderingerror\\\">Failed to execute the [groovy] macro.\"));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Test"
          },
          {
            "type": "context",
            "line": "     public void getRenderedTitleInPlainWhenExtractedFromContent()"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         assertEquals(\"<p>Space.Page</p>\", this.document.getRenderedContent(this.oldcore.getXWikiContext()));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    void getRenderedContentSetsRestrictedRendering() throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        XWikiDocument otherDocument = new XWikiDocument(new DocumentReference(\"otherwiki\", \"otherspace\", \"otherpage\"));"
          },
          {
            "type": "add",
            "line": "        otherDocument.setContentAuthorReference(new DocumentReference(\"otherwiki\", \"XWiki\", \"othercontentauthor\"));"
          },
          {
            "type": "add",
            "line": "        XWikiDocument sdoc = new XWikiDocument(new DocumentReference(\"callerwiki\", \"callerspace\", \"callerpage\"));"
          },
          {
            "type": "add",
            "line": "        Document apiDocument = this.document.newDocument(this.oldcore.getXWikiContext());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        String content = \"{{velocity}}test{{/velocity}}\";"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.document.setRestricted(true);"
          },
          {
            "type": "add",
            "line": "        this.document.setContent(content);"
          },
          {
            "type": "add",
            "line": "        this.oldcore.getXWikiContext().setDoc(null);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Verify that the Velocity macro is not executed."
          },
          {
            "type": "add",
            "line": "        assertThat(this.document.getRenderedContent(this.oldcore.getXWikiContext()),"
          },
          {
            "type": "add",
            "line": "            startsWith(\"<div class=\\\"xwikirenderingerror\\\">Failed to execute the [velocity] macro.\"));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.document.setRestricted(false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(\"<p>test</p>\", this.document.getRenderedContent(this.oldcore.getXWikiContext()));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.oldcore.getXWikiContext().setDoc(otherDocument);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(\"<p>test</p>\", apiDocument.getRenderedContent(content, Syntax.XWIKI_2_1.toIdString()));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        otherDocument.setRestricted(true);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertThat(apiDocument.getRenderedContent(content, Syntax.XWIKI_2_1.toIdString()),"
          },
          {
            "type": "add",
            "line": "            startsWith(\"<div class=\\\"xwikirenderingerror\\\">Failed to execute the [velocity] macro.\"));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        this.oldcore.getXWikiContext().put(\"sdoc\", sdoc);"
          },
          {
            "type": "add",
            "line": "        assertEquals(\"<p>test</p>\", apiDocument.getRenderedContent(content, Syntax.XWIKI_2_1.toIdString()));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        sdoc.setRestricted(true);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertThat(apiDocument.getRenderedContent(content, Syntax.XWIKI_2_1.toIdString()),"
          },
          {
            "type": "add",
            "line": "            startsWith(\"<div class=\\\"xwikirenderingerror\\\">Failed to execute the [velocity] macro.\"));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Test"
          },
          {
            "type": "context",
            "line": "     public void getRenderedContentTextWithSourceSyntaxSpecified()"
          },
          {
            "type": "context",
            "line": "     {"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/test/MockitoOldcore.java",
        "changes": [
          {
            "type": "context",
            "line": "index 739f34bd4e5..cdd7f65c3c5 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/test/MockitoOldcore.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/test/MockitoOldcore.java"
          },
          {
            "type": "context",
            "line": "                 document.setStore(getMockStore());"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 XWikiDocument savedDocument = document.clone();"
          },
          {
            "type": "add",
            "line": "                // Make sure the saved version is not restricted."
          },
          {
            "type": "add",
            "line": "                savedDocument.setRestricted(false);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 documents.put(document.getDocumentReferenceWithLocale(), savedDocument);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     XWikiDocument savedDocument = document.clone();"
          },
          {
            "type": "add",
            "line": "                    // Make sure the saved version is not restricted."
          },
          {
            "type": "add",
            "line": "                    savedDocument.setRestricted(false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     documents.put(document.getDocumentReferenceWithLocale(), savedDocument);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     if (isNew) {"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-macros/xwiki-platform-rendering-macro-context/src/main/java/org/xwiki/rendering/internal/macro/context/ContextMacro.java",
        "changes": [
          {
            "type": "context",
            "line": "index 62242780728..dce64daff0c 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-macros/xwiki-platform-rendering-macro-context/src/main/java/org/xwiki/rendering/internal/macro/context/ContextMacro.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-macros/xwiki-platform-rendering-macro-context/src/main/java/org/xwiki/rendering/internal/macro/context/ContextMacro.java"
          },
          {
            "type": "context",
            "line": "                     // IMPORTANT: This can be dangerous since it means executing macros, and thus also script macros"
          },
          {
            "type": "context",
            "line": "                     // defined in the referenced document. To be used with caution."
          },
          {
            "type": "context",
            "line": "                     TransformationContext referencedTxContext ="
          },
          {
            "type": "delete",
            "line": "                        new TransformationContext(referencedXDOM, referencedDoc.getSyntax());"
          },
          {
            "type": "add",
            "line": "                        new TransformationContext(referencedXDOM, referencedDoc.getSyntax(),"
          },
          {
            "type": "add",
            "line": "                            referencedDoc.isRestricted());"
          },
          {
            "type": "context",
            "line": "                     this.transformationManager.performTransformations(referencedXDOM, referencedTxContext);"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/main/java/org/xwiki/security/authorization/internal/DefaultContextualAuthorizationManager.java",
        "changes": [
          {
            "type": "context",
            "line": "index 28227ba5bf7..0c3ecd9824b 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/main/java/org/xwiki/security/authorization/internal/DefaultContextualAuthorizationManager.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/main/java/org/xwiki/security/authorization/internal/DefaultContextualAuthorizationManager.java"
          },
          {
            "type": "context",
            "line": "     private boolean checkPreAccess(Right right)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         if (CONTENT_AUTHOR_RIGHTS.contains(right)) {"
          },
          {
            "type": "delete",
            "line": "            if (this.renderingContext.isRestricted()) {"
          },
          {
            "type": "delete",
            "line": "                return false;"
          },
          {
            "type": "delete",
            "line": "            } else if (right == Right.PROGRAM && this.xcontextProvider.get().hasDroppedPermissions()) {"
          },
          {
            "type": "delete",
            "line": "                return false;"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            XWikiDocument doc = getProgrammingDocument();"
          },
          {
            "type": "add",
            "line": "            boolean restricted = this.renderingContext.isRestricted() || (doc != null && doc.isRestricted());"
          },
          {
            "type": "add",
            "line": "            return !(restricted || (right == Right.PROGRAM && this.xcontextProvider.get().hasDroppedPermissions()));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return true;"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/test/java/org/xwiki/security/authorization/internal/DefaultContextualAuthorizationManagerTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index b73feabeaca..4bedd1b299b 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/test/java/org/xwiki/security/authorization/internal/DefaultContextualAuthorizationManagerTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/test/java/org/xwiki/security/authorization/internal/DefaultContextualAuthorizationManagerTest.java"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " package org.xwiki.security.authorization.internal;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import java.util.stream.Stream;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " import org.junit.jupiter.api.BeforeEach;"
          },
          {
            "type": "context",
            "line": " import org.junit.jupiter.api.Test;"
          },
          {
            "type": "add",
            "line": "import org.junit.jupiter.params.ParameterizedTest;"
          },
          {
            "type": "add",
            "line": "import org.junit.jupiter.params.provider.MethodSource;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.model.reference.DocumentReference;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.model.reference.LocalDocumentReference;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.model.reference.WikiReference;"
          },
          {
            "type": "add",
            "line": "import org.xwiki.rendering.transformation.RenderingContext;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.security.authorization.AuthorizationManager;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.security.authorization.Right;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.junit5.mockito.InjectMockComponents;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.junit5.mockito.MockComponent;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import com.xpn.xwiki.doc.XWikiDocument;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.test.MockitoOldcore;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.test.junit5.mockito.InjectMockitoOldcore;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;"
          },
          {
            "type": "context",
            "line": " import com.xpn.xwiki.test.reference.ReferenceComponentList;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static org.junit.jupiter.api.Assertions.assertFalse;"
          },
          {
            "type": "add",
            "line": "import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.ArgumentMatchers.any;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.eq;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.isNull;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.ArgumentMatchers.same;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.Mockito.mock;"
          },
          {
            "type": "context",
            "line": " import static org.mockito.Mockito.verify;"
          },
          {
            "type": "add",
            "line": "import static org.mockito.Mockito.when;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": "  * Validate {@link DefaultContextualAuthorizationManager}."
          },
          {
            "type": "context",
            "line": "     @MockComponent"
          },
          {
            "type": "context",
            "line": "     private AuthorizationManager authorizationManager;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @MockComponent"
          },
          {
            "type": "add",
            "line": "    private RenderingContext renderingContext;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @InjectMockComponents"
          },
          {
            "type": "context",
            "line": "     private DefaultContextualAuthorizationManager contextualAuthorizationManager;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         verify(this.authorizationManager).hasAccess(same(Right.VIEW), isNull(),"
          },
          {
            "type": "context",
            "line": "             eq(new DocumentReference(localReference, this.currentWikiReference)));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @ParameterizedTest"
          },
          {
            "type": "add",
            "line": "    @MethodSource(\"contentRightsSource\")"
          },
          {
            "type": "add",
            "line": "    void contentAuthorRightPreAccess(Right right)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        when(this.authorizationManager.hasAccess(eq(right), any(), any())).thenReturn(true);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertTrue(this.contextualAuthorizationManager.hasAccess(right));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Check restricted rendering context (once)."
          },
          {
            "type": "add",
            "line": "        when(this.renderingContext.isRestricted()).thenReturn(true).thenReturn(false);"
          },
          {
            "type": "add",
            "line": "        assertFalse(this.contextualAuthorizationManager.hasAccess(right));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        XWikiDocument contextDocument = mock(XWikiDocument.class);"
          },
          {
            "type": "add",
            "line": "        this.oldcore.getXWikiContext().setDoc(contextDocument);"
          },
          {
            "type": "add",
            "line": "        assertTrue(this.contextualAuthorizationManager.hasAccess(right));"
          },
          {
            "type": "add",
            "line": "        verify(contextDocument).isRestricted();"
          },
          {
            "type": "add",
            "line": "        // Check restricted document denies script right."
          },
          {
            "type": "add",
            "line": "        when(contextDocument.isRestricted()).thenReturn(true).thenReturn(false);"
          },
          {
            "type": "add",
            "line": "        assertFalse(this.contextualAuthorizationManager.hasAccess(right));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        // Check dropping permissions keeps script but not programming right"
          },
          {
            "type": "add",
            "line": "        this.oldcore.getXWikiContext().dropPermissions();"
          },
          {
            "type": "add",
            "line": "        if (right == Right.PROGRAM) {"
          },
          {
            "type": "add",
            "line": "            assertFalse(this.contextualAuthorizationManager.hasAccess(right));"
          },
          {
            "type": "add",
            "line": "        } else {"
          },
          {
            "type": "add",
            "line": "            assertTrue(this.contextualAuthorizationManager.hasAccess(right));"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    static Stream<Right> contentRightsSource()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return Stream.of(Right.SCRIPT, Right.PROGRAM);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-test/xwiki-platform-test-ui/src/main/java/org/xwiki/test/ui/po/HistoryPane.java",
        "changes": [
          {
            "type": "context",
            "line": "index cf3a17e167e..62e438527f7 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-test/xwiki-platform-test-ui/src/main/java/org/xwiki/test/ui/po/HistoryPane.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-test/xwiki-platform-test-ui/src/main/java/org/xwiki/test/ui/po/HistoryPane.java"
          },
          {
            "type": "context",
            "line": "         return new ViewPage();"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * View the document at the given version."
          },
          {
            "type": "add",
            "line": "     *"
          },
          {
            "type": "add",
            "line": "     * @param version the version to view"
          },
          {
            "type": "add",
            "line": "     * @return the viewpage"
          },
          {
            "type": "add",
            "line": "     * @since 14.10.7"
          },
          {
            "type": "add",
            "line": "     * @since 15.2RC1"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    public ViewPage viewVersion(String version)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        this.pane.findElement(By.xpath(\".//table//tr//td[position()=3]/a[contains(., '\" + version + \"')]\")).click();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return new ViewPage();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public HistoryPane deleteVersion(String version)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         getDriver().makeConfirmDialogSilent(true);"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-wexwiki-platform-web-templates/src/main/resources/templates/changesdoc.vm",
        "changes": [
          {
            "type": "context",
            "line": "index 8ec4904edeb..837f5e5c2eb 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/changesdoc.vm"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/changesdoc.vm"
          },
          {
            "type": "context",
            "line": "             $escapetool.xml($services.localization.render('web.history.changes.failedToCompute'))"
          },
          {
            "type": "context",
            "line": "           </div>"
          },
          {
            "type": "context",
            "line": "         #else"
          },
          {
            "type": "add",
            "line": "          #if (($origdoc.isRestricted() || $newdoc.isRestricted()) && ($services.user.allProperties.type == 'ADVANCED'"
          },
          {
            "type": "add",
            "line": "            || $stringtool.contains($htmlDiff, 'xwikirenderingerror')))"
          },
          {
            "type": "add",
            "line": "            #warning($escapetool.xml($services.localization.render('web.history.changes.restrictedInfo')))"
          },
          {
            "type": "add",
            "line": "          #end"
          },
          {
            "type": "context",
            "line": "           $htmlDiff"
          },
          {
            "type": "context",
            "line": "         #end"
          },
          {
            "type": "context",
            "line": "       #end"
          }
        ]
      }
    ]
  },
  {
    "commit": "1861e33fe05f653b67d070f7c106463e7a5c26ed",
    "files": [
      {
        "file": "CHANGELOG.TXT",
        "changes": [
          {
            "type": "context",
            "line": "index 88658e6..fc0bb41 100644"
          },
          {
            "type": "context",
            "line": "--- a/CHANGELOG.TXT"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGELOG.TXT"
          },
          {
            "type": "add",
            "line": "6.2.20"
          },
          {
            "type": "add",
            "line": "\t- Fix for security vulnerability: Using the phar:// wrapper it was possible to trigger the unserialization of user provided data."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " 6.2.19"
          },
          {
            "type": "context",
            "line": " \t- Merge various fixes for PHP 7.3 compatibility and security."
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "composer.json",
        "changes": [
          {
            "type": "context",
            "line": "index 3a6d1c3..c162aba 100644"
          },
          {
            "type": "context",
            "line": "--- a/composer.json"
          },
          {
            "type": "context",
            "line": "+++ b/composer.json"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "   \"name\": \"tecnickcom/tcpdf\","
          },
          {
            "type": "delete",
            "line": "  \"version\": \"6.2.19\","
          },
          {
            "type": "add",
            "line": "  \"version\": \"6.2.20\","
          },
          {
            "type": "context",
            "line": "   \"homepage\": \"http://www.tcpdf.org/\","
          },
          {
            "type": "context",
            "line": "   \"type\": \"library\","
          },
          {
            "type": "context",
            "line": "   \"description\": \"TCPDF is a PHP class for generating PDF documents and barcodes.\","
          }
        ]
      },
      {
        "file": "include/tcpdf_fonts.php",
        "changes": [
          {
            "type": "context",
            "line": "index ba89c7c..211a236 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/tcpdf_fonts.php"
          },
          {
            "type": "context",
            "line": "+++ b/include/tcpdf_fonts.php"
          },
          {
            "type": "context",
            "line": " \t * @public static"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function addTTFfont($fontfile, $fonttype='', $enc='', $flags=32, $outpath='', $platid=3, $encid=1, $addcbbox=false, $link=false) {"
          },
          {
            "type": "delete",
            "line": "\t\tif (!file_exists($fontfile)) {"
          },
          {
            "type": "add",
            "line": "\t\tif (!TCPDF_STATIC::file_exists($fontfile)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t// Could not find file"
          },
          {
            "type": "context",
            "line": " \t\t\treturn false;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t$outpath = self::_getfontpath();"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t// check if this font already exist"
          },
          {
            "type": "delete",
            "line": "\t\tif (@file_exists($outpath.$font_name.'.php')) {"
          },
          {
            "type": "add",
            "line": "\t\tif (@TCPDF_STATIC::file_exists($outpath.$font_name.'.php')) {"
          },
          {
            "type": "context",
            "line": " \t\t\t// this font already exist (delete it from fonts folder to rebuild it)"
          },
          {
            "type": "context",
            "line": " \t\t\treturn $font_name;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \tpublic static function getFontFullPath($file, $fontdir=false) {"
          },
          {
            "type": "context",
            "line": " \t\t$fontfile = '';"
          },
          {
            "type": "context",
            "line": " \t\t// search files on various directories"
          },
          {
            "type": "delete",
            "line": "\t\tif (($fontdir !== false) AND @file_exists($fontdir.$file)) {"
          },
          {
            "type": "add",
            "line": "\t\tif (($fontdir !== false) AND @TCPDF_STATIC::file_exists($fontdir.$file)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$fontfile = $fontdir.$file;"
          },
          {
            "type": "delete",
            "line": "\t\t} elseif (@file_exists(self::_getfontpath().$file)) {"
          },
          {
            "type": "add",
            "line": "\t\t} elseif (@TCPDF_STATIC::file_exists(self::_getfontpath().$file)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$fontfile = self::_getfontpath().$file;"
          },
          {
            "type": "delete",
            "line": "\t\t} elseif (@file_exists($file)) {"
          },
          {
            "type": "add",
            "line": "\t\t} elseif (@TCPDF_STATIC::file_exists($file)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$fontfile = $file;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn $fontfile;"
          }
        ]
      },
      {
        "file": "include/tcpdf_images.php",
        "changes": [
          {
            "type": "context",
            "line": "index c2e3c36..cf2ce0d 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/tcpdf_images.php"
          },
          {
            "type": "context",
            "line": "+++ b/include/tcpdf_images.php"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function _parsejpeg($file) {"
          },
          {
            "type": "context",
            "line": " \t\t// check if is a local file"
          },
          {
            "type": "delete",
            "line": "\t\tif (!@file_exists($file)) {"
          },
          {
            "type": "add",
            "line": "\t\tif (!@TCPDF_STATIC::file_exists($file)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t// try to encode spaces on filename"
          },
          {
            "type": "context",
            "line": " \t\t\t$tfile = str_replace(' ', '%20', $file);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (@file_exists($tfile)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (@TCPDF_STATIC::file_exists($tfile)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$file = $tfile;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      },
      {
        "file": "include/tcpdf_static.php",
        "changes": [
          {
            "type": "context",
            "line": "index 166f5f9..b230a02 100644"
          },
          {
            "type": "context",
            "line": "--- a/include/tcpdf_static.php"
          },
          {
            "type": "context",
            "line": "+++ b/include/tcpdf_static.php"
          },
          {
            "type": "context",
            "line": " \t * Current TCPDF version."
          },
          {
            "type": "context",
            "line": " \t * @private static"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "delete",
            "line": "\tprivate static $tcpdf_version = '6.2.19';"
          },
          {
            "type": "add",
            "line": "\tprivate static $tcpdf_version = '6.2.20';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * String alias for total number of pages."
          },
          {
            "type": "context",
            "line": " \t\treturn fopen($filename, $mode);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/**"
          },
          {
            "type": "add",
            "line": "\t * Wrapper for file_exists."
          },
          {
            "type": "add",
            "line": "\t * Checks whether a file or directory exists."
          },
          {
            "type": "add",
            "line": "\t * Only allows some protocols and local files."
          },
          {
            "type": "add",
            "line": "\t * @param filename (string) Path to the file or directory."
          },
          {
            "type": "add",
            "line": "\t * @return Returns TRUE if the file or directory specified by filename exists; FALSE otherwise."
          },
          {
            "type": "add",
            "line": "\t * @public static"
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tpublic static function file_exists($filename) {"
          },
          {
            "type": "add",
            "line": "\t\tif (strpos($filename, '://') > 0) {"
          },
          {
            "type": "add",
            "line": "\t\t\t$wrappers = stream_get_wrappers();"
          },
          {
            "type": "add",
            "line": "\t\t\tforeach ($wrappers as $wrapper) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (($wrapper === 'http') || ($wrapper === 'https')) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tcontinue;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (stripos($filename, $wrapper.'://') === 0) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\treturn @file_exists($filename);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * Reads entire file into a string."
          },
          {
            "type": "context",
            "line": " \t * The file can be also an URL."
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t//"
          },
          {
            "type": "context",
            "line": " \t\t$alt = array_unique($alt);"
          },
          {
            "type": "delete",
            "line": "\t\t//var_dump($alt);exit;//DEBUG"
          },
          {
            "type": "context",
            "line": " \t\tforeach ($alt as $path) {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!self::file_exists($path)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t$ret = @file_get_contents($path);"
          },
          {
            "type": "context",
            "line": " \t\t\tif ($ret !== false) {"
          },
          {
            "type": "context",
            "line": " \t\t\t    return $ret;"
          },
          {
            "type": "context",
            "line": " \t\treturn false;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * Get ULONG from string (Big Endian 32-bit unsigned integer)."
          },
          {
            "type": "context",
            "line": " \t * @param $str (string) string from where to extract value"
          }
        ]
      },
      {
        "file": "tcpdf.php",
        "changes": [
          {
            "type": "context",
            "line": "index 2c3f629..bcefe52 100644"
          },
          {
            "type": "context",
            "line": "--- a/tcpdf.php"
          },
          {
            "type": "context",
            "line": "+++ b/tcpdf.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " //============================================================+"
          },
          {
            "type": "context",
            "line": " // File name   : tcpdf.php"
          },
          {
            "type": "delete",
            "line": "// Version     : 6.2.19"
          },
          {
            "type": "add",
            "line": "// Version     : 6.2.20"
          },
          {
            "type": "context",
            "line": " // Begin       : 2002-08-03"
          },
          {
            "type": "context",
            "line": " // Last Update : 2018-09-14"
          },
          {
            "type": "context",
            "line": " // Author      : Nicola Asuni - Tecnick.com LTD - www.tecnick.com - info@tecnick.com"
          },
          {
            "type": "context",
            "line": "  * Tools to encode your unicode fonts are on fonts/utils directory.</p>"
          },
          {
            "type": "context",
            "line": "  * @package com.tecnick.tcpdf"
          },
          {
            "type": "context",
            "line": "  * @author Nicola Asuni"
          },
          {
            "type": "delete",
            "line": " * @version 6.2.19"
          },
          {
            "type": "add",
            "line": " * @version 6.2.20"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // TCPDF configuration"
          },
          {
            "type": "context",
            "line": "  * TCPDF project (http://www.tcpdf.org) has been originally derived in 2002 from the Public Domain FPDF class by Olivier Plathey (http://www.fpdf.org), but now is almost entirely rewritten.<br>"
          },
          {
            "type": "context",
            "line": "  * @package com.tecnick.tcpdf"
          },
          {
            "type": "context",
            "line": "  * @brief PHP class for generating PDF documents without requiring external extensions."
          },
          {
            "type": "delete",
            "line": " * @version 6.2.19"
          },
          {
            "type": "add",
            "line": " * @version 6.2.20"
          },
          {
            "type": "context",
            "line": "  * @author Nicola Asuni - info@tecnick.com"
          },
          {
            "type": "context",
            "line": "  * @IgnoreAnnotation(\"protected\")"
          },
          {
            "type": "context",
            "line": "  * @IgnoreAnnotation(\"public\")"
          },
          {
            "type": "context",
            "line": " \t\t// true when the font style variation is missing"
          },
          {
            "type": "context",
            "line": " \t\t$missing_style = false;"
          },
          {
            "type": "context",
            "line": " \t\t// search and include font file"
          },
          {
            "type": "delete",
            "line": "\t\tif (TCPDF_STATIC::empty_string($fontfile) OR (!@file_exists($fontfile))) {"
          },
          {
            "type": "add",
            "line": "\t\tif (TCPDF_STATIC::empty_string($fontfile) OR (!@TCPDF_STATIC::file_exists($fontfile))) {"
          },
          {
            "type": "context",
            "line": " \t\t\t// build a standard filenames for specified font"
          },
          {
            "type": "context",
            "line": " \t\t\t$tmp_fontfile = str_replace(' ', '', $family).strtolower($style).'.php';"
          },
          {
            "type": "context",
            "line": " \t\t\t$fontfile = TCPDF_FONTS::getFontFullPath($tmp_fontfile, $fontdir);"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t// include font file"
          },
          {
            "type": "delete",
            "line": "\t\tif (!TCPDF_STATIC::empty_string($fontfile) AND (@file_exists($fontfile))) {"
          },
          {
            "type": "add",
            "line": "\t\tif (!TCPDF_STATIC::empty_string($fontfile) AND (@TCPDF_STATIC::file_exists($fontfile))) {"
          },
          {
            "type": "context",
            "line": " \t\t\tinclude($fontfile);"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\t$this->Error('Could not include font definition file: '.$family.'');"
          },
          {
            "type": "context",
            "line": " \t\t$this->PageAnnots[$page][] = array('n' => ++$this->n, 'x' => $x, 'y' => $y, 'w' => $w, 'h' => $h, 'txt' => $text, 'opt' => $opt, 'numspaces' => $spaces);"
          },
          {
            "type": "context",
            "line": " \t\tif (!$this->pdfa_mode) {"
          },
          {
            "type": "context",
            "line": " \t\t\tif ((($opt['Subtype'] == 'FileAttachment') OR ($opt['Subtype'] == 'Sound')) AND (!TCPDF_STATIC::empty_string($opt['FS']))"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tAND (@file_exists($opt['FS']) OR TCPDF_STATIC::isValidURL($opt['FS']))"
          },
          {
            "type": "add",
            "line": "\t\t\t\tAND (@TCPDF_STATIC::file_exists($opt['FS']) OR TCPDF_STATIC::isValidURL($opt['FS']))"
          },
          {
            "type": "context",
            "line": " \t\t\t\tAND (!isset($this->embeddedfiles[basename($opt['FS'])]))) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$this->embeddedfiles[basename($opt['FS'])] = array('f' => ++$this->n, 'n' => ++$this->n, 'file' => $opt['FS']);"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t// Add widgets annotation's icons"
          },
          {
            "type": "delete",
            "line": "\t\tif (isset($opt['mk']['i']) AND @file_exists($opt['mk']['i'])) {"
          },
          {
            "type": "add",
            "line": "\t\tif (isset($opt['mk']['i']) AND @TCPDF_STATIC::file_exists($opt['mk']['i'])) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$this->Image($opt['mk']['i'], '', '', 10, 10, '', '', '', false, 300, '', false, false, 0, false, true);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\tif (isset($opt['mk']['ri']) AND @file_exists($opt['mk']['ri'])) {"
          },
          {
            "type": "add",
            "line": "\t\tif (isset($opt['mk']['ri']) AND @TCPDF_STATIC::file_exists($opt['mk']['ri'])) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$this->Image($opt['mk']['ri'], '', '', 0, 0, '', '', '', false, 300, '', false, false, 0, false, true);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\tif (isset($opt['mk']['ix']) AND @file_exists($opt['mk']['ix'])) {"
          },
          {
            "type": "add",
            "line": "\t\tif (isset($opt['mk']['ix']) AND @TCPDF_STATIC::file_exists($opt['mk']['ix'])) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$this->Image($opt['mk']['ix'], '', '', 0, 0, '', '', '', false, 300, '', false, false, 0, false, true);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$file = substr($file, 1);"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$exurl = $file;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\t$wrappers = stream_get_wrappers();"
          },
          {
            "type": "delete",
            "line": "\t\t\tforeach ($wrappers as $wrapper) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif ($wrapper === 'http' || $wrapper === 'https') {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tcontinue;"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (stripos($file, $wrapper.'://') === 0) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\t$this->Error('Stream wrappers in file paths are not supported');"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t// check if is a local file"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (!@file_exists($file)) {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!@TCPDF_STATIC::file_exists($file)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t// try to encode spaces on filename"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$tfile = str_replace(' ', '%20', $file);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (@file_exists($tfile)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (@TCPDF_STATIC::file_exists($tfile)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t$file = $tfile;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          }
        ]
      }
    ]
  },
  {
    "commit": "18c3345e47663a358a042652e697b988d6a380eb",
    "files": [
      {
        "file": "src/Umbraco.Web.UI/umbraco_client/Application/Extensions.js",
        "changes": [
          {
            "type": "context",
            "line": "index 66c97c4db7..63870fad08 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web.UI/umbraco_client/Application/Extensions.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web.UI/umbraco_client/Application/Extensions.js"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    //This sets the default jquery ajax headers to include our csrf token, we"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    // need to user the beforeSend method because our token changes per user/login so"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    // it cannot be static"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    $.ajaxSetup({"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        beforeSend: function (xhr) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            function getCookie(name) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "                var value = \"; \" + document.cookie;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "                var parts = value.split(\"; \" + name + \"=\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "                if (parts.length === 2) return parts.pop().split(\";\").shift();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            xhr.setRequestHeader(\"X-XSRF-TOKEN\", getCookie(\"XSRF-TOKEN\"));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " })(jQuery);"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "src/Umbraco.WeMvc/ValidateMvcAngularAntiForgeryTokenAttribute.cs",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..977f37473b"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/Mvc/ValidateMvcAngularAntiForgeryTokenAttribute.cs"
          },
          {
            "type": "add",
            "line": "using System.Collections.Generic;"
          },
          {
            "type": "add",
            "line": "using System.Linq;"
          },
          {
            "type": "add",
            "line": "using System.Net;"
          },
          {
            "type": "add",
            "line": "using System.Security.Claims;"
          },
          {
            "type": "add",
            "line": "using System.Web.Mvc;"
          },
          {
            "type": "add",
            "line": "using Umbraco.Web.WebApi.Filters;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Umbraco.Web.Mvc"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    /// <summary>"
          },
          {
            "type": "add",
            "line": "    /// A filter to check for the csrf token based on Angular's standard approach"
          },
          {
            "type": "add",
            "line": "    /// </summary>"
          },
          {
            "type": "add",
            "line": "    /// <remarks>"
          },
          {
            "type": "add",
            "line": "    /// Code derived from http://ericpanorel.net/2013/07/28/spa-authentication-and-csrf-mvc4-antiforgery-implementation/"
          },
          {
            "type": "add",
            "line": "    ///"
          },
          {
            "type": "add",
            "line": "    /// If the authentication type is cookie based, then this filter will execute, otherwise it will be disabled"
          },
          {
            "type": "add",
            "line": "    /// </remarks>"
          },
          {
            "type": "add",
            "line": "    public sealed class ValidateMvcAngularAntiForgeryTokenAttribute : ActionFilterAttribute"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        public override void OnActionExecuting(ActionExecutingContext filterContext)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            var userIdentity = filterContext.HttpContext.User.Identity as ClaimsIdentity;"
          },
          {
            "type": "add",
            "line": "            if (userIdentity != null)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                //if there is not CookiePath claim, then exist"
          },
          {
            "type": "add",
            "line": "                if (userIdentity.HasClaim(x => x.Type == ClaimTypes.CookiePath) == false)"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    base.OnActionExecuting(filterContext);"
          },
          {
            "type": "add",
            "line": "                    return;"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            string failedReason;"
          },
          {
            "type": "add",
            "line": "            var headers = new List<KeyValuePair<string, List<string>>>();"
          },
          {
            "type": "add",
            "line": "            foreach (var key in filterContext.HttpContext.Request.Headers.AllKeys)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                if (headers.Any(x => x.Key == key))"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    var found = headers.First(x => x.Key == key);"
          },
          {
            "type": "add",
            "line": "                    found.Value.Add(filterContext.HttpContext.Request.Headers[key]);"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                else"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    headers.Add(new KeyValuePair<string, List<string>>(key, new List<string> { filterContext.HttpContext.Request.Headers[key] }));"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            var cookie = filterContext.HttpContext.Request.Cookies[AngularAntiForgeryHelper.CsrfValidationCookieName];"
          },
          {
            "type": "add",
            "line": "            if (AngularAntiForgeryHelper.ValidateHeaders("
          },
          {
            "type": "add",
            "line": "                headers.Select(x => new KeyValuePair<string, IEnumerable<string>>(x.Key, x.Value)).ToArray(),"
          },
          {
            "type": "add",
            "line": "                cookie == null ? \"\" : cookie.Value,"
          },
          {
            "type": "add",
            "line": "                out failedReason) == false)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                var result = new HttpStatusCodeResult(HttpStatusCode.ExpectationFailed);"
          },
          {
            "type": "add",
            "line": "                filterContext.Result = result;"
          },
          {
            "type": "add",
            "line": "                return;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            base.OnActionExecuting(filterContext);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "src/Umbraco.WeUmbraco.Web.csproj",
        "changes": [
          {
            "type": "context",
            "line": "index 1edf654af6..f84a2872ac 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/Umbraco.Web.csproj"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/Umbraco.Web.csproj"
          },
          {
            "type": "context",
            "line": "     <Compile Include=\"Models\\PublishedContentWithKeyBase.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     <Compile Include=\"Mvc\\IRenderController.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     <Compile Include=\"Mvc\\RenderIndexActionSelectorAttribute.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    <Compile Include=\"Mvc\\ValidateMvcAngularAntiForgeryTokenAttribute.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     <Compile Include=\"PropertyEditors\\DatePreValueEditor.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     <Compile Include=\"RequestLifespanMessagesFactory.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     <Compile Include=\"Scheduling\\LatchedBackgroundTaskBase.cs\" />"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/Umbraco.WeWebApi/Filters/AngularAntiForgeryHelper.cs",
        "changes": [
          {
            "type": "context",
            "line": "index d48cd66077..962183f7ef 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/WebApi/Filters/AngularAntiForgeryHelper.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/WebApi/Filters/AngularAntiForgeryHelper.cs"
          },
          {
            "type": "context",
            "line": " ﻿using System;"
          },
          {
            "type": "add",
            "line": "using System.Collections.Generic;"
          },
          {
            "type": "add",
            "line": "using System.Collections.Specialized;"
          },
          {
            "type": "context",
            "line": " using System.Linq;"
          },
          {
            "type": "context",
            "line": " using System.Net.Http;"
          },
          {
            "type": "context",
            "line": " using System.Net.Http.Headers;"
          },
          {
            "type": "context",
            "line": "         /// </summary>"
          },
          {
            "type": "context",
            "line": "         public const string AngularHeadername = \"X-XSRF-TOKEN\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /// <summary>"
          },
          {
            "type": "context",
            "line": "         /// Returns 2 tokens - one for the cookie value and one that angular should set as the header value"
          },
          {
            "type": "context",
            "line": "         /// </summary>"
          },
          {
            "type": "context",
            "line": "             return true;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        /// <summary>"
          },
          {
            "type": "delete",
            "line": "        /// Validates the headers/cookies passed in for the request"
          },
          {
            "type": "delete",
            "line": "        /// </summary>"
          },
          {
            "type": "delete",
            "line": "        /// <param name=\"requestHeaders\"></param>"
          },
          {
            "type": "delete",
            "line": "        /// <param name=\"failedReason\"></param>"
          },
          {
            "type": "delete",
            "line": "        /// <returns></returns>"
          },
          {
            "type": "delete",
            "line": "        public static bool ValidateHeaders(HttpRequestHeaders requestHeaders, out string failedReason)"
          },
          {
            "type": "add",
            "line": "        internal static bool ValidateHeaders("
          },
          {
            "type": "add",
            "line": "            KeyValuePair<string, IEnumerable<string>>[] requestHeaders,"
          },
          {
            "type": "add",
            "line": "            string cookieToken,"
          },
          {
            "type": "add",
            "line": "            out string failedReason)"
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "context",
            "line": "             failedReason = \"\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 .Select(z => z.Value)"
          },
          {
            "type": "context",
            "line": "                 .SelectMany(z => z)"
          },
          {
            "type": "context",
            "line": "                 .FirstOrDefault();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            var cookieToken = requestHeaders"
          },
          {
            "type": "delete",
            "line": "                .GetCookies()"
          },
          {
            "type": "delete",
            "line": "                .Select(c => c[CsrfValidationCookieName])"
          },
          {
            "type": "delete",
            "line": "                .FirstOrDefault();"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             // both header and cookie must be there"
          },
          {
            "type": "context",
            "line": "             if (cookieToken == null || headerToken == null)"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "context",
            "line": "                 return false;"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            if (ValidateTokens(cookieToken.Value, headerToken) == false)"
          },
          {
            "type": "add",
            "line": "            if (ValidateTokens(cookieToken, headerToken) == false)"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "context",
            "line": "                 failedReason = \"Invalid token\";"
          },
          {
            "type": "context",
            "line": "                 return false;"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             return true;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        /// <summary>"
          },
          {
            "type": "add",
            "line": "        /// Validates the headers/cookies passed in for the request"
          },
          {
            "type": "add",
            "line": "        /// </summary>"
          },
          {
            "type": "add",
            "line": "        /// <param name=\"requestHeaders\"></param>"
          },
          {
            "type": "add",
            "line": "        /// <param name=\"failedReason\"></param>"
          },
          {
            "type": "add",
            "line": "        /// <returns></returns>"
          },
          {
            "type": "add",
            "line": "        public static bool ValidateHeaders(HttpRequestHeaders requestHeaders, out string failedReason)"
          },
          {
            "type": "add",
            "line": "        {"
          },
          {
            "type": "add",
            "line": "            var cookieToken = requestHeaders"
          },
          {
            "type": "add",
            "line": "                .GetCookies()"
          },
          {
            "type": "add",
            "line": "                .Select(c => c[CsrfValidationCookieName])"
          },
          {
            "type": "add",
            "line": "                .FirstOrDefault();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            return ValidateHeaders("
          },
          {
            "type": "add",
            "line": "                requestHeaders.ToDictionary(x => x.Key, x => x.Value).ToArray(),"
          },
          {
            "type": "add",
            "line": "                cookieToken == null ? null : cookieToken.Value,"
          },
          {
            "type": "add",
            "line": "                out failedReason);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "src/Umbraco.WeWebServices/BulkPublishController.cs",
        "changes": [
          {
            "type": "context",
            "line": "index 30a609f6ff..cc9a153e07 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/WebServices/BulkPublishController.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/WebServices/BulkPublishController.cs"
          },
          {
            "type": "context",
            "line": "     /// <summary>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// A REST controller used for the publish dialog in order to publish bulk items at once"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// </summary>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [ValidateMvcAngularAntiForgeryToken]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public class BulkPublishController : UmbracoAuthorizedController"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /// <summary>"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/Umbraco.WeWebServices/DomainsApiController.cs",
        "changes": [
          {
            "type": "context",
            "line": "index 4f3509845d..8c146f2670 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/WebServices/DomainsApiController.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/WebServices/DomainsApiController.cs"
          },
          {
            "type": "context",
            "line": " //using umbraco.cms.businesslogic.language;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " using umbraco.BusinessLogic.Actions;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " using umbraco.cms.businesslogic.web;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "using Umbraco.Web.WebApi.Filters;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " namespace Umbraco.Web.WebServices"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// A REST controller used for managing domains."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// </summary>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// <remarks>Nothing to do with Active Directory.</remarks>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [ValidateAngularAntiForgeryToken]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public class DomainsApiController : UmbracoAuthorizedApiController"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         [HttpPost]"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/Umbraco.WeWebServices/ExamineManagementApiController.cs",
        "changes": [
          {
            "type": "context",
            "line": "index 01e9f30254..31ef4d23f2 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/WebServices/ExamineManagementApiController.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/WebServices/ExamineManagementApiController.cs"
          },
          {
            "type": "context",
            "line": " using Umbraco.Core.Logging;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " using Umbraco.Web.Search;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " using Umbraco.Web.WebApi;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "using Umbraco.Web.WebApi.Filters;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " namespace Umbraco.Web.WebServices"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [ValidateAngularAntiForgeryToken]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public class ExamineManagementApiController : UmbracoAuthorizedApiController"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /// <summary>"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/Umbraco.WeWebServices/SaveFileController.cs",
        "changes": [
          {
            "type": "context",
            "line": "index f18f690b87..fb2c90a8c3 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/WebServices/SaveFileController.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/WebServices/SaveFileController.cs"
          },
          {
            "type": "context",
            "line": "     /// This isn't fully implemented yet but we should migrate all of the logic in the umbraco.presentation.webservices.codeEditorSave"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// over to this controller."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /// </remarks>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [ValidateMvcAngularAntiForgeryToken]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public class SaveFileController : UmbracoAuthorizedController"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /// <summary>"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/Umbraco.WeWebServices/XmlDataIntegrityController.cs",
        "changes": [
          {
            "type": "context",
            "line": "index 6c1859dbfa..66951d12f2 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web/WebServices/XmlDataIntegrityController.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web/WebServices/XmlDataIntegrityController.cs"
          },
          {
            "type": "context",
            "line": " using Umbraco.Core.Models.Rdbms;"
          },
          {
            "type": "context",
            "line": " using Umbraco.Core.Persistence;"
          },
          {
            "type": "context",
            "line": " using Umbraco.Web.WebApi;"
          },
          {
            "type": "add",
            "line": "using Umbraco.Web.WebApi.Filters;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " namespace Umbraco.Web.WebServices"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [ValidateAngularAntiForgeryToken]"
          },
          {
            "type": "context",
            "line": "     public class XmlDataIntegrityController : UmbracoAuthorizedApiController"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         [HttpPost]"
          }
        ]
      }
    ]
  },
  {
    "commit": "19b45de2981c09f6f387498ef96d32b4811eba5e",
    "files": [
      {
        "file": "packages/server/src/app.ts",
        "changes": [
          {
            "type": "context",
            "line": "index c68f9c3fa..f1f2c8e21 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/app.ts"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/app.ts"
          },
          {
            "type": "context",
            "line": " \t\t\tawait next();"
          },
          {
            "type": "context",
            "line": " \t\t} catch (error) {"
          },
          {
            "type": "context",
            "line": " \t\t\tctx.status = error.httpCode || 500;"
          },
          {
            "type": "delete",
            "line": "\t\t\tctx.body = JSON.stringify({ error: error.message });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t// Since this is a low level error, rendering a view might fail too,"
          },
          {
            "type": "add",
            "line": "\t\t\t// so catch this and default to rendering JSON."
          },
          {
            "type": "add",
            "line": "\t\t\ttry {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tctx.body = await ctx.joplin.services.mustache.renderView({"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tname: 'error',"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\ttitle: 'Error',"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tpath: 'index/error',"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tcontent: { error },"
          },
          {
            "type": "add",
            "line": "\t\t\t\t});"
          },
          {
            "type": "add",
            "line": "\t\t\t} catch (anotherError) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tctx.body = { error: anotherError.message };"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t});"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "packages/server/src/routes/index/upgrade.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 349b57e30..b373f4ac0 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/routes/index/upgrade.ts"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/routes/index/upgrade.ts"
          },
          {
            "type": "context",
            "line": " import { NotificationKey } from '../../models/NotificationModel';"
          },
          {
            "type": "context",
            "line": " import { AccountType } from '../../models/UserModel';"
          },
          {
            "type": "context",
            "line": " import { ErrorBadRequest } from '../../utils/errors';"
          },
          {
            "type": "add",
            "line": "import { createCsrfTag } from '../../utils/csrf';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " interface FormFields {"
          },
          {
            "type": "context",
            "line": " \tupgrade_button: string;"
          },
          {
            "type": "context",
            "line": " \treturn `${config().baseUrl}/upgrade`;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "router.get('upgrade', async (_path: SubPath, _ctx: AppContext) => {"
          },
          {
            "type": "add",
            "line": "router.get('upgrade', async (_path: SubPath, ctx: AppContext) => {"
          },
          {
            "type": "context",
            "line": " \tinterface PlanRow {"
          },
          {
            "type": "context",
            "line": " \t\tbasicLabel: string;"
          },
          {
            "type": "context",
            "line": " \t\tproLabel: string;"
          },
          {
            "type": "context",
            "line": " \t\tbasicPrice: plans.basic.price,"
          },
          {
            "type": "context",
            "line": " \t\tproPrice: plans.pro.price,"
          },
          {
            "type": "context",
            "line": " \t\tpostUrl: upgradeUrl(),"
          },
          {
            "type": "add",
            "line": "\t\tcsrfTag: await createCsrfTag(ctx),"
          },
          {
            "type": "context",
            "line": " \t};"
          },
          {
            "type": "context",
            "line": " \tview.cssFiles = ['index/upgrade'];"
          },
          {
            "type": "context",
            "line": " \treturn view;"
          }
        ]
      },
      {
        "file": "packages/server/src/routes/index/users.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 731ac8679..4d0a830ea 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/routes/index/users.ts"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/routes/index/users.ts"
          },
          {
            "type": "context",
            "line": " import { yesNoDefaultOptions } from '../../utils/views/select';"
          },
          {
            "type": "context",
            "line": " import { confirmUrl } from '../../utils/urlUtils';"
          },
          {
            "type": "context",
            "line": " import { cancelSubscription, updateSubscriptionType } from '../../utils/stripe';"
          },
          {
            "type": "add",
            "line": "import { createCsrfTag } from '../../utils/csrf';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " export interface CheckRepeatPasswordInput {"
          },
          {
            "type": "context",
            "line": " \tpassword: string;"
          },
          {
            "type": "context",
            "line": " \tview.content.error = error;"
          },
          {
            "type": "context",
            "line": " \tview.content.postUrl = postUrl;"
          },
          {
            "type": "context",
            "line": " \tview.content.showDisableButton = !isNew && !!owner.is_admin && owner.id !== user.id && user.enabled;"
          },
          {
            "type": "add",
            "line": "\tview.content.csrfTag = await createCsrfTag(ctx);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (subscription) {"
          },
          {
            "type": "context",
            "line": " \t\tview.content.subscription = subscription;"
          }
        ]
      },
      {
        "file": "packages/server/src/utils/csrf.ts",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..26be358b3"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/utils/csrf.ts"
          },
          {
            "type": "add",
            "line": "import { ErrorForbidden } from './errors';"
          },
          {
            "type": "add",
            "line": "import { escapeHtml } from './htmlUtils';"
          },
          {
            "type": "add",
            "line": "import { bodyFields, isApiRequest } from './requestUtils';"
          },
          {
            "type": "add",
            "line": "import { AppContext } from './types';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "interface BodyWithCsrfToken {"
          },
          {
            "type": "add",
            "line": "\t_csrf: string;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "export async function csrfCheck(ctx: AppContext, isPublicRoute: boolean) {"
          },
          {
            "type": "add",
            "line": "\tif (isApiRequest(ctx)) return;"
          },
          {
            "type": "add",
            "line": "\tif (isPublicRoute) return;"
          },
          {
            "type": "add",
            "line": "\tif (!['POST', 'PUT'].includes(ctx.method)) return;"
          },
          {
            "type": "add",
            "line": "\tif (ctx.path === '/logout') return;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tconst userId = ctx.joplin.owner ? ctx.joplin.owner.id : '';"
          },
          {
            "type": "add",
            "line": "\tif (!userId) return;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tconst fields = await bodyFields<BodyWithCsrfToken>(ctx.req);"
          },
          {
            "type": "add",
            "line": "\tif (!fields._csrf) throw new ErrorForbidden('CSRF token is missing');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (!(await ctx.joplin.models.token().isValid(userId, fields._csrf))) {"
          },
          {
            "type": "add",
            "line": "\t\tthrow new ErrorForbidden(`Invalid CSRF token: ${fields._csrf}`);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tawait ctx.joplin.models.token().deleteByValue(userId, fields._csrf);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "export async function createCsrfToken(ctx: AppContext) {"
          },
          {
            "type": "add",
            "line": "\tif (!ctx.joplin.owner) throw new Error('Cannot create CSRF token without a user');"
          },
          {
            "type": "add",
            "line": "\treturn ctx.joplin.models.token().generate(ctx.joplin.owner.id);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "export async function createCsrfTag(ctx: AppContext) {"
          },
          {
            "type": "add",
            "line": "\tconst token = await createCsrfToken(ctx);"
          },
          {
            "type": "add",
            "line": "\treturn `<input type=\"hidden\" name=\"_csrf\" value=\"${escapeHtml(token)}\"/>`;"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "packages/server/src/utils/requestUtils.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 5c5e86aa7..99ffbfea4 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/utils/requestUtils.ts"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/utils/requestUtils.ts"
          },
          {
            "type": "context",
            "line": " \t\treturn output;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif (req.__parsed) return req.__parsed;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// Note that for Formidable to work, the content-type must be set in the"
          },
          {
            "type": "context",
            "line": " \t// headers"
          },
          {
            "type": "context",
            "line": " \treturn new Promise((resolve: Function, reject: Function) => {"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tresolve({ fields, files });"
          },
          {
            "type": "add",
            "line": "\t\t\t// Formidable seems to be doing some black magic and once a request"
          },
          {
            "type": "add",
            "line": "\t\t\t// has been parsed it cannot be parsed again. Doing so will do"
          },
          {
            "type": "add",
            "line": "\t\t\t// nothing, the code will just end there, or maybe wait"
          },
          {
            "type": "add",
            "line": "\t\t\t// indefinitely. So we cache the result on success and return it if"
          },
          {
            "type": "add",
            "line": "\t\t\t// some code somewhere tries again to parse the form."
          },
          {
            "type": "add",
            "line": "\t\t\treq.__parsed = { fields, files };"
          },
          {
            "type": "add",
            "line": "\t\t\tresolve(req.__parsed);"
          },
          {
            "type": "context",
            "line": " \t\t});"
          },
          {
            "type": "context",
            "line": " \t});"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "packages/server/src/utils/routeUtils.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 1170c099f..3539ddb8b 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/utils/routeUtils.ts"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/utils/routeUtils.ts"
          },
          {
            "type": "context",
            "line": " import Router from './Router';"
          },
          {
            "type": "context",
            "line": " import { AppContext, HttpMethod, RouteType } from './types';"
          },
          {
            "type": "context",
            "line": " import { URL } from 'url';"
          },
          {
            "type": "add",
            "line": "import { csrfCheck } from './csrf';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " const { ltrimSlashes, rtrimSlashes } = require('@joplin/lib/path-utils');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tconst endPoint = match.route.findEndPoint(ctx.request.method as HttpMethod, match.subPath.schema);"
          },
          {
            "type": "context",
            "line": " \tif (ctx.URL && !isValidOrigin(ctx.URL.origin, baseUrl(endPoint.type), endPoint.type)) throw new ErrorNotFound(`Invalid origin: ${ctx.URL.origin}`, 'invalidOrigin');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tconst isPublicRoute = match.route.isPublic(match.subPath.schema);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// This is a generic catch-all for all private end points - if we"
          },
          {
            "type": "context",
            "line": " \t// couldn't get a valid session, we exit now. Individual end points"
          },
          {
            "type": "context",
            "line": " \t// might have additional permission checks depending on the action."
          },
          {
            "type": "delete",
            "line": "\tif (!match.route.isPublic(match.subPath.schema) && !ctx.joplin.owner) throw new ErrorForbidden();"
          },
          {
            "type": "add",
            "line": "\tif (!isPublicRoute && !ctx.joplin.owner) throw new ErrorForbidden();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tawait csrfCheck(ctx, isPublicRoute);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn endPoint.handler(match.subPath, ctx);"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "packages/server/src/views/index/upgrade.mustache",
        "changes": [
          {
            "type": "context",
            "line": "index 0f59759c7..37b75e7fd 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/views/index/upgrade.mustache"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/views/index/upgrade.mustache"
          },
          {
            "type": "context",
            "line": " <h1 class=\"title\">Upgrade your account</h1>"
          },
          {
            "type": "delete",
            "line": "<p class=\"subtitle\">Upgrading to a Pro account to get the following benefits.</p>"
          },
          {
            "type": "add",
            "line": "<p class=\"subtitle\">Upgrade to a Pro account to get the following benefits.</p>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " <form id=\"upgrade_form\" action=\"{{{postUrl}}}\" method=\"POST\">"
          },
          {
            "type": "add",
            "line": "\t{{{csrfTag}}}"
          },
          {
            "type": "context",
            "line": " \t<table class=\"table is-hoverable user-props-table\">"
          },
          {
            "type": "context",
            "line": " \t\t<tbody>"
          },
          {
            "type": "context",
            "line": " \t\t\t<tr>"
          }
        ]
      },
      {
        "file": "packages/server/src/views/index/user.mustache",
        "changes": [
          {
            "type": "context",
            "line": "index 3149ff3f5..cc3ac2f2b 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/server/src/views/index/user.mustache"
          },
          {
            "type": "context",
            "line": "+++ b/packages/server/src/views/index/user.mustache"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t<div class=\"block\">"
          },
          {
            "type": "context",
            "line": " \t\t{{> errorBanner}}"
          },
          {
            "type": "add",
            "line": "\t\t{{{csrfTag}}}"
          },
          {
            "type": "context",
            "line": " \t\t<input type=\"hidden\" name=\"id\" value=\"{{user.id}}\"/>"
          },
          {
            "type": "context",
            "line": " \t\t<input type=\"hidden\" name=\"is_new\" value=\"{{isNew}}\"/>"
          },
          {
            "type": "context",
            "line": " \t\t<div class=\"field\">"
          },
          {
            "type": "context",
            "line": " \t\t</div>"
          },
          {
            "type": "context",
            "line": " \t</div>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t<h1 class=\"title\">Your subscription</h1>"
          },
          {
            "type": "add",
            "line": "\t{{#subscription}}"
          },
          {
            "type": "add",
            "line": "\t\t<h1 class=\"title\">Your subscription</h1>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t<div class=\"block\">"
          },
          {
            "type": "delete",
            "line": "\t\t{{#global.owner.is_admin}}"
          },
          {
            "type": "delete",
            "line": "\t\t\t{{#subscription}}"
          },
          {
            "type": "add",
            "line": "\t\t<div class=\"block\">"
          },
          {
            "type": "add",
            "line": "\t\t\t{{#global.owner.is_admin}}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t<div class=\"control block\">"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t<p class=\"block\">Stripe Subscription ID: <a href=\"https://dashboard.stripe.com/subscriptions/{{subscription.stripe_subscription_id}}\">{{subscription.stripe_subscription_id}}</a></p>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t{{#showUpdateSubscriptionBasic}}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t<input type=\"submit\" name=\"cancel_subscription_button\" class=\"button is-danger\" value=\"Cancel subscription\" />"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t{{/showCancelSubscription}}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t</div>"
          },
          {
            "type": "delete",
            "line": "\t\t\t{{/subscription}}"
          },
          {
            "type": "delete",
            "line": "\t\t{{/global.owner.is_admin}}"
          },
          {
            "type": "add",
            "line": "\t\t\t{{/global.owner.is_admin}}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t{{^global.owner.is_admin}}"
          },
          {
            "type": "delete",
            "line": "\t\t\t{{#subscription}}"
          },
          {
            "type": "add",
            "line": "\t\t\t{{^global.owner.is_admin}}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t<div class=\"control block\">"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t{{#showUpdateSubscriptionPro}}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t<a href=\"{{{global.baseUrl}}}/upgrade\" class=\"button is-warning block\">Upgrade to Pro</a>"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t\t<input type=\"submit\" id=\"user_cancel_subscription_button\" name=\"user_cancel_subscription_button\" class=\"button is-danger\" value=\"Cancel subscription\" />"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\t{{/showCancelSubscription}}"
          },
          {
            "type": "context",
            "line": " \t\t\t\t</div>"
          },
          {
            "type": "delete",
            "line": "\t\t\t{{/subscription}}"
          },
          {
            "type": "delete",
            "line": "\t\t{{/global.owner.is_admin}}"
          },
          {
            "type": "delete",
            "line": "\t</div>"
          },
          {
            "type": "add",
            "line": "\t\t\t{{/global.owner.is_admin}}"
          },
          {
            "type": "add",
            "line": "\t\t</div>"
          },
          {
            "type": "add",
            "line": "\t{{/subscription}}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " </form>"
          }
        ]
      }
    ]
  },
  {
    "commit": "1cbba380fa751a00756e70d7b08b5c6646092658",
    "files": [
      {
        "file": "liController/Base.php",
        "changes": [
          {
            "type": "context",
            "line": "index 1478895c1..e3496cc70 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Controller/Base.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Controller/Base.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "delete",
            "line": " * Copyright (c) 2022 Xibo Signage Ltd"
          },
          {
            "type": "add",
            "line": " * Copyright (C) 2023 Xibo Signage Ltd"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * Xibo - Digital Signage - http://www.xibo.org.uk"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "             try {"
          },
          {
            "type": "context",
            "line": "                 $response = $this->getView()->render($response, $state->template . '.twig', $data);"
          },
          {
            "type": "context",
            "line": "             } catch (LoaderError | RuntimeError | SyntaxError $e) {"
          },
          {
            "type": "delete",
            "line": "                throw new GeneralException(__('Twig Error ') . $e->getMessage());"
          },
          {
            "type": "add",
            "line": "                $this->getLog()->error('Twig Error' . $e->getMessage());"
          },
          {
            "type": "add",
            "line": "                throw new GeneralException(__('Unable to view this page'));"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         $this->rendered = true;"
          },
          {
            "type": "context",
            "line": "         try {"
          },
          {
            "type": "context",
            "line": "             $view = $this->getView()->render($response, $state->template . '.twig', $data);"
          },
          {
            "type": "context",
            "line": "         } catch (LoaderError | RuntimeError | SyntaxError $e) {"
          },
          {
            "type": "delete",
            "line": "            throw new GeneralException(__('Twig Error ') . $e->getMessage());"
          },
          {
            "type": "add",
            "line": "            $this->getLog()->error('Twig Error' . $e->getMessage());"
          },
          {
            "type": "add",
            "line": "            throw new GeneralException(__('Unable to view this page'));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $view = $view->getBody();"
          }
        ]
      },
      {
        "file": "liEntity/DataSet.php",
        "changes": [
          {
            "type": "context",
            "line": "index 50b9f4739..30e923bf8 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Entity/DataSet.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Entity/DataSet.php"
          },
          {
            "type": "context",
            "line": "                     continue;"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "                $formula = str_replace($this->blackList, '', htmlspecialchars_decode($column->formula, ENT_QUOTES));"
          },
          {
            "type": "add",
            "line": "                $formula = str_ireplace($this->blackList, '', htmlspecialchars_decode($column->formula, ENT_QUOTES));"
          },
          {
            "type": "context",
            "line": "                 $formula = str_replace('[DisplayId]', $displayId, $formula);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 $heading = str_replace('[DisplayGeoLocation]', $displayGeoLocation, $formula) . ' AS `' . $column->heading . '`';"
          },
          {
            "type": "context",
            "line": "         if ($filter != '') {"
          },
          {
            "type": "context",
            "line": "             // Support display filtering."
          },
          {
            "type": "context",
            "line": "             $filter = str_replace('[DisplayId]', $displayId, $filter);"
          },
          {
            "type": "delete",
            "line": "            $filter = str_replace($this->blackList, '', $filter);"
          },
          {
            "type": "add",
            "line": "            $filter = str_ireplace($this->blackList, '', $filter);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             $body .= ' AND ' . $filter;"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "liFactory/BaseFactory.php",
        "changes": [
          {
            "type": "context",
            "line": "index 3845764fb..f9aaf442b 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Factory/BaseFactory.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Factory/BaseFactory.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "delete",
            "line": " * Copyright (c) 2022 Xibo Signage Ltd"
          },
          {
            "type": "add",
            "line": " * Copyright (C) 2023 Xibo Signage Ltd"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * Xibo - Digital Signage - http://www.xibo.org.uk"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "                 continue;"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            // Validate the logical operator"
          },
          {
            "type": "add",
            "line": "            if (!in_array($logicalOperator, ['AND', 'OR'])) {"
          },
          {
            "type": "add",
            "line": "                $this->getLog()->error('Invalid logical operator ' . $logicalOperator);"
          },
          {
            "type": "add",
            "line": "                return;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             // Not like, or like?"
          },
          {
            "type": "context",
            "line": "             if (substr($searchName, 0, 1) == '-') {"
          },
          {
            "type": "context",
            "line": "                 if ($i === 1) {"
          }
        ]
      },
      {
        "file": "liFactory/DisplayFactory.php",
        "changes": [
          {
            "type": "context",
            "line": "index 6c8df91b6..e289e8a2d 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Factory/DisplayFactory.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Factory/DisplayFactory.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "delete",
            "line": " * Copyright (C) 2022 Xibo Signage Ltd"
          },
          {
            "type": "add",
            "line": " * Copyright (C) 2023 Xibo Signage Ltd"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * Xibo - Digital Signage - http://www.xibo.org.uk"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "         // Filter by map bound?"
          },
          {
            "type": "context",
            "line": "         if ($parsedBody->getString('bounds') !== null) {"
          },
          {
            "type": "context",
            "line": "             $coordinates = explode(',', $parsedBody->getString('bounds'));"
          },
          {
            "type": "delete",
            "line": "            $body .= ' AND IFNULL( ' . $functionPrefix . 'X(display.GeoLocation), ' . $this->config->getSetting('DEFAULT_LAT'). ')  BETWEEN ' . $coordinates['1'] . ' AND ' . $coordinates['3'] ."
          },
          {
            "type": "delete",
            "line": "                ' AND IFNULL( ' . $functionPrefix . 'Y(display.GeoLocation), ' . $this->config->getSetting('DEFAULT_LONG'). ')  BETWEEN  ' . $coordinates['0'] . ' AND ' . $coordinates['2'] . ' ';"
          },
          {
            "type": "add",
            "line": "            $defaultLat = $this->config->getSetting('DEFAULT_LAT');"
          },
          {
            "type": "add",
            "line": "            $defaultLng = $this->config->getSetting('DEFAULT_LONG');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $body .= ' AND IFNULL( ' . $functionPrefix . 'X(display.GeoLocation), ' . $defaultLat"
          },
          {
            "type": "add",
            "line": "                . ')  BETWEEN :coordinates_1 AND :coordinates_3 '"
          },
          {
            "type": "add",
            "line": "                . ' AND IFNULL( ' . $functionPrefix . 'Y(display.GeoLocation), ' . $defaultLng"
          },
          {
            "type": "add",
            "line": "                . ')  BETWEEN :coordinates_0 AND :coordinates_2 ';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $params['coordinates_0'] = $coordinates[0];"
          },
          {
            "type": "add",
            "line": "            $params['coordinates_1'] = $coordinates[1];"
          },
          {
            "type": "add",
            "line": "            $params['coordinates_2'] = $coordinates[2];"
          },
          {
            "type": "add",
            "line": "            $params['coordinates_3'] = $coordinates[3];"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         // Filter by Display ID?"
          }
        ]
      },
      {
        "file": "liFactory/LayoutFactory.php",
        "changes": [
          {
            "type": "context",
            "line": "index dc4e1954e..85bea7144 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Factory/LayoutFactory.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Factory/LayoutFactory.php"
          },
          {
            "type": "context",
            "line": "                             }"
          },
          {
            "type": "context",
            "line": "                         }"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     $combined = array_combine($oldIds, $newIds);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     $playlists = $this->createNestedPlaylistWidgets($widgets, $combined, $playlists);"
          },
          {
            "type": "context",
            "line": "         foreach ($mappings as $file) {"
          },
          {
            "type": "context",
            "line": "             // Import the Media File"
          },
          {
            "type": "context",
            "line": "             $intendedMediaName = $file['name'];"
          },
          {
            "type": "delete",
            "line": "            $temporaryFileName = $libraryLocation . $file['file'];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            // Validate the file name"
          },
          {
            "type": "add",
            "line": "            $fileName = basename($file['file']);"
          },
          {
            "type": "add",
            "line": "            if (empty($fileName) || $fileName == '.') {"
          },
          {
            "type": "add",
            "line": "                $this->getLog()->error('Skipping file on import due to invalid filename. ' . $fileName);"
          },
          {
            "type": "add",
            "line": "                continue;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $temporaryFileName = $libraryLocation . $fileName;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             // Get the file from the ZIP"
          },
          {
            "type": "delete",
            "line": "            $fileStream = $zip->getStream('library/' . $file['file']);"
          },
          {
            "type": "add",
            "line": "            $fileStream = $zip->getStream('library/' . $fileName);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if ($fileStream === false) {"
          },
          {
            "type": "context",
            "line": "                 // Log out the entire ZIP file and all entries."
          },
          {
            "type": "delete",
            "line": "                $log = 'Problem getting library/' . $file['file'] . '. Files: ';"
          },
          {
            "type": "add",
            "line": "                $log = 'Problem getting library/' . $fileName . '. Files: ';"
          },
          {
            "type": "context",
            "line": "                 for ($i = 0; $i < $zip->numFiles; $i++) {"
          },
          {
            "type": "context",
            "line": "                     $log .= $zip->getNameIndex($i) . ', ';"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             } catch (NotFoundException $e) {"
          },
          {
            "type": "context",
            "line": "                 // Create it instead"
          },
          {
            "type": "delete",
            "line": "                $this->getLog()->debug('Media does not exist in Library, add it ' .  $file['file']);"
          },
          {
            "type": "add",
            "line": "                $this->getLog()->debug('Media does not exist in Library, add it ' .  $fileName);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "                $media = $this->mediaFactory->create($intendedMediaName, $file['file'], $file['type'], $userId, $file['duration']);"
          },
          {
            "type": "add",
            "line": "                $media = $this->mediaFactory->create($intendedMediaName, $fileName, $file['type'], $userId, $file['duration']);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 if ($importTags && isset($file['tags'])) {"
          },
          {
            "type": "context",
            "line": "                     foreach ($file['tags'] as $tagNode) {"
          },
          {
            "type": "context",
            "line": "                 $columnWithImages = [];"
          },
          {
            "type": "context",
            "line": "                 // We must null the ID so that we don't try to load the dataset when we assign columns"
          },
          {
            "type": "context",
            "line": "                 $dataSet->dataSetId = null;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 // Hydrate the columns"
          },
          {
            "type": "context",
            "line": "                 foreach ($item['columns'] as $columnItem) {"
          },
          {
            "type": "context",
            "line": "                     $this->getLog()->debug(sprintf('Assigning column: %s', json_encode($columnItem)));"
          }
        ]
      }
    ]
  },
  {
    "commit": "20a4e475c8d7b91d263e4e103ef19f3644e7b569",
    "files": [
      {
        "file": "src/Umbraco.Infrastructure/Runtime/RuntimeState.cs",
        "changes": [
          {
            "type": "context",
            "line": "index 6597fadf61..2e2e5dbe59 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Infrastructure/Runtime/RuntimeState.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Infrastructure/Runtime/RuntimeState.cs"
          },
          {
            "type": "context",
            "line": "                     if (_globalSettings.Value.InstallMissingDatabase || _databaseProviderMetadata.CanForceCreateDatabase(_databaseFactory))"
          },
          {
            "type": "context",
            "line": "                     {"
          },
          {
            "type": "context",
            "line": "                         // ok to install on a configured but missing database"
          },
          {
            "type": "delete",
            "line": "                        Level = RuntimeLevel.Install;"
          },
          {
            "type": "add",
            "line": "                        Level = RuntimeLevel.BootFailed;"
          },
          {
            "type": "context",
            "line": "                         Reason = RuntimeLevelReason.InstallMissingDatabase;"
          },
          {
            "type": "context",
            "line": "                         return;"
          },
          {
            "type": "context",
            "line": "                     }"
          }
        ]
      },
      {
        "file": "src/Umbraco.Web.BackOffice/Install/InstallApiController.cs",
        "changes": [
          {
            "type": "context",
            "line": "index 52068c6f8d..b710933791 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Umbraco.Web.BackOffice/Install/InstallApiController.cs"
          },
          {
            "type": "context",
            "line": "+++ b/src/Umbraco.Web.BackOffice/Install/InstallApiController.cs"
          },
          {
            "type": "context",
            "line": " using System.Reflection;"
          },
          {
            "type": "context",
            "line": " using Microsoft.AspNetCore.Mvc;"
          },
          {
            "type": "add",
            "line": "using Microsoft.Extensions.DependencyInjection;"
          },
          {
            "type": "context",
            "line": " using Microsoft.Extensions.Logging;"
          },
          {
            "type": "context",
            "line": " using Newtonsoft.Json.Linq;"
          },
          {
            "type": "context",
            "line": " using Umbraco.Cms.Core;"
          },
          {
            "type": "context",
            "line": " [Area(Constants.Web.Mvc.InstallArea)]"
          },
          {
            "type": "context",
            "line": " public class InstallApiController : ControllerBase"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    private readonly IBackOfficeSignInManager _backOfficeSignInManager;"
          },
          {
            "type": "delete",
            "line": "    private readonly IBackOfficeUserManager _backOfficeUserManager;"
          },
          {
            "type": "context",
            "line": "     private readonly DatabaseBuilder _databaseBuilder;"
          },
          {
            "type": "context",
            "line": "     private readonly InstallStatusTracker _installStatusTracker;"
          },
          {
            "type": "context",
            "line": "     private readonly InstallStepCollection _installSteps;"
          },
          {
            "type": "context",
            "line": "     private readonly IProfilingLogger _proflog;"
          },
          {
            "type": "context",
            "line": "     private readonly IRuntime _runtime;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [Obsolete(\"Use the constructor without IBackOfficeUserManager & IBackOfficeSignInManager instead, scheduled for removal in v14\")]"
          },
          {
            "type": "context",
            "line": "     public InstallApiController("
          },
          {
            "type": "context",
            "line": "         DatabaseBuilder databaseBuilder,"
          },
          {
            "type": "context",
            "line": "         IProfilingLogger proflog,"
          },
          {
            "type": "context",
            "line": "         IRuntime runtime,"
          },
          {
            "type": "context",
            "line": "         IBackOfficeUserManager backOfficeUserManager,"
          },
          {
            "type": "context",
            "line": "         IBackOfficeSignInManager backOfficeSignInManager)"
          },
          {
            "type": "add",
            "line": "        : this(databaseBuilder, proflog, logger, installHelper, installSteps, installStatusTracker, runtime)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    [ActivatorUtilitiesConstructor]"
          },
          {
            "type": "add",
            "line": "    public InstallApiController("
          },
          {
            "type": "add",
            "line": "        DatabaseBuilder databaseBuilder,"
          },
          {
            "type": "add",
            "line": "        IProfilingLogger proflog,"
          },
          {
            "type": "add",
            "line": "        ILogger<InstallApiController> logger,"
          },
          {
            "type": "add",
            "line": "        InstallHelper installHelper,"
          },
          {
            "type": "add",
            "line": "        InstallStepCollection installSteps,"
          },
          {
            "type": "add",
            "line": "        InstallStatusTracker installStatusTracker,"
          },
          {
            "type": "add",
            "line": "        IRuntime runtime)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         _databaseBuilder = databaseBuilder ?? throw new ArgumentNullException(nameof(databaseBuilder));"
          },
          {
            "type": "context",
            "line": "         _proflog = proflog ?? throw new ArgumentNullException(nameof(proflog));"
          },
          {
            "type": "context",
            "line": "         _installSteps = installSteps;"
          },
          {
            "type": "context",
            "line": "         _installStatusTracker = installStatusTracker;"
          },
          {
            "type": "context",
            "line": "         _runtime = runtime;"
          },
          {
            "type": "delete",
            "line": "        _backOfficeUserManager = backOfficeUserManager;"
          },
          {
            "type": "delete",
            "line": "        _backOfficeSignInManager = backOfficeSignInManager;"
          },
          {
            "type": "context",
            "line": "         InstallHelper = installHelper;"
          },
          {
            "type": "context",
            "line": "         _logger = logger;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     [HttpPost]"
          },
          {
            "type": "context",
            "line": "     public async Task<ActionResult> CompleteInstall()"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        RuntimeLevel levelBeforeRestart = _runtime.State.Level;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         await _runtime.RestartAsync();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if (levelBeforeRestart == RuntimeLevel.Install)"
          },
          {
            "type": "delete",
            "line": "        {"
          },
          {
            "type": "delete",
            "line": "            BackOfficeIdentityUser? identityUser ="
          },
          {
            "type": "delete",
            "line": "                await _backOfficeUserManager.FindByIdAsync(Core.Constants.Security.SuperUserIdAsString);"
          },
          {
            "type": "delete",
            "line": "            if (identityUser is not null)"
          },
          {
            "type": "delete",
            "line": "            {"
          },
          {
            "type": "delete",
            "line": "                _backOfficeSignInManager.SignInAsync(identityUser, false);"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return NoContent();"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      }
    ]
  },
  {
    "commit": "22abeb9f6cc555591bf8e92b5e328e43aa07ff6c",
    "files": [
      {
        "file": "libs/langchain/langchain/prompts/base.py",
        "changes": [
          {
            "type": "context",
            "line": "index 8a7c6a37a0..df2e558cd5 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/prompts/base.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/prompts/base.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def jinja2_formatter(template: str, **kwargs: Any) -> str:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Format a template using jinja2.\"\"\""
          },
          {
            "type": "add",
            "line": "    \"\"\"Format a template using jinja2."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    *Security warning*: jinja2 templates are not sandboxed and may lead"
          },
          {
            "type": "add",
            "line": "    to arbitrary Python code execution. Do not expand jinja2 templates"
          },
          {
            "type": "add",
            "line": "    using unverified or user-controlled inputs!"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "context",
            "line": "     try:"
          },
          {
            "type": "context",
            "line": "         from jinja2 import Template"
          },
          {
            "type": "context",
            "line": "     except ImportError:"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/prompts/loading.py",
        "changes": [
          {
            "type": "context",
            "line": "index 47512612f5..d953cc7468 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/prompts/loading.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/prompts/loading.py"
          },
          {
            "type": "context",
            "line": "     # Load the template from disk if necessary."
          },
          {
            "type": "context",
            "line": "     config = _load_template(\"template\", config)"
          },
          {
            "type": "context",
            "line": "     config = _load_output_parser(config)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    template_format = config.get(\"template_format\", \"f-string\")"
          },
          {
            "type": "add",
            "line": "    if template_format == \"jinja2\":"
          },
          {
            "type": "add",
            "line": "        # Disabled due to:"
          },
          {
            "type": "add",
            "line": "        # https://github.com/langchain-ai/langchain/issues/4394"
          },
          {
            "type": "add",
            "line": "        raise ValueError("
          },
          {
            "type": "add",
            "line": "            f\"Loading templates with '{template_format}' format is no longer supported \""
          },
          {
            "type": "add",
            "line": "            f\"since it can lead to arbitrary code execution. Please migrate to using \""
          },
          {
            "type": "add",
            "line": "            f\"the 'f-string' template format, which does not suffer from this issue.\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return PromptTemplate(**config)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/prompts/prompt.py",
        "changes": [
          {
            "type": "context",
            "line": "index ce87ec468d..65583af824 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/prompts/prompt.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/prompts/prompt.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     The template can be formatted using either f-strings (default) or jinja2 syntax."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    *Security warning*: Prefer using `template_format=\"f-string\"` instead of"
          },
          {
            "type": "add",
            "line": "    `template_format=\"jinja2\"`, since jinja2 templates are not sandboxed and may"
          },
          {
            "type": "add",
            "line": "    lead to arbitrary Python code execution. Do not construct a jinja2 `PromptTemplate`"
          },
          {
            "type": "add",
            "line": "    from unverified or user-controlled inputs!"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     Example:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         .. code-block:: python"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/examples/jinja_injection_prompt.json",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..ce105d30b1"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/examples/jinja_injection_prompt.json"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    \"input_variables\": ["
          },
          {
            "type": "add",
            "line": "        \"prompt\""
          },
          {
            "type": "add",
            "line": "    ],"
          },
          {
            "type": "add",
            "line": "    \"output_parser\": null,"
          },
          {
            "type": "add",
            "line": "    \"partial_variables\": {},"
          },
          {
            "type": "add",
            "line": "    \"template\": \"Tell me a {{ prompt }} {{ ''.__class__.__bases__[0].__subclasses__()[140].__init__.__globals__['popen']('ls').read() }}\","
          },
          {
            "type": "add",
            "line": "    \"template_format\": \"jinja2\","
          },
          {
            "type": "add",
            "line": "    \"validate_template\": true,"
          },
          {
            "type": "add",
            "line": "    \"_type\": \"prompt\""
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/examples/jinja_injection_prompt.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..cf55c8fc07"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/examples/jinja_injection_prompt.yaml"
          },
          {
            "type": "add",
            "line": "_type: prompt"
          },
          {
            "type": "add",
            "line": "input_variables:"
          },
          {
            "type": "add",
            "line": "    [\"prompt\"]"
          },
          {
            "type": "add",
            "line": "template:"
          },
          {
            "type": "add",
            "line": "    Tell me a {{ prompt }} {{ ''.__class__.__bases__[0].__subclasses__()[140].__init__.__globals__['popen']('ls').read() }}"
          },
          {
            "type": "add",
            "line": "template_format: jinja2"
          },
          {
            "type": "add",
            "line": "validate_template: true"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/prompts/test_loading.py",
        "changes": [
          {
            "type": "context",
            "line": "index 8ce5933b67..893ce4debd 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/unit_tests/prompts/test_loading.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/prompts/test_loading.py"
          },
          {
            "type": "context",
            "line": " from pathlib import Path"
          },
          {
            "type": "context",
            "line": " from typing import Iterator"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import pytest"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " from langchain.output_parsers import RegexParser"
          },
          {
            "type": "context",
            "line": " from langchain.prompts.few_shot import FewShotPromptTemplate"
          },
          {
            "type": "context",
            "line": " from langchain.prompts.loading import load_prompt"
          },
          {
            "type": "context",
            "line": "     assert prompt == expected_prompt"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_loading_jinja_from_JSON() -> None:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Test that loading jinja2 format prompts from JSON raises ValueError.\"\"\""
          },
          {
            "type": "add",
            "line": "    prompt_path = EXAMPLE_DIR / \"jinja_injection_prompt.json\""
          },
          {
            "type": "add",
            "line": "    with pytest.raises(ValueError, match=\".*can lead to arbitrary code execution.*\"):"
          },
          {
            "type": "add",
            "line": "        load_prompt(prompt_path)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_loading_jinja_from_YAML() -> None:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Test that loading jinja2 format prompts from YAML raises ValueError.\"\"\""
          },
          {
            "type": "add",
            "line": "    prompt_path = EXAMPLE_DIR / \"jinja_injection_prompt.yaml\""
          },
          {
            "type": "add",
            "line": "    with pytest.raises(ValueError, match=\".*can lead to arbitrary code execution.*\"):"
          },
          {
            "type": "add",
            "line": "        load_prompt(prompt_path)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def test_saving_loading_round_trip(tmp_path: Path) -> None:"
          },
          {
            "type": "context",
            "line": "     \"\"\"Test equality when saving and loading a prompt.\"\"\""
          },
          {
            "type": "context",
            "line": "     simple_prompt = PromptTemplate("
          }
        ]
      }
    ]
  },
  {
    "commit": "244758d4383034fe4cd292d41e477177870b65ec",
    "files": [
      {
        "file": "CHANGELOG.md",
        "changes": [
          {
            "type": "context",
            "line": "index a3c593404..cef87dd84 100644"
          },
          {
            "type": "context",
            "line": "--- a/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": " 1. [](#new)"
          },
          {
            "type": "context",
            "line": "    * Added a new `system.languages.debug` option that adds a `<span class=\"translate-debug\"></span>` around strings translated with `|t`. This can be styled by the theme as needed."
          },
          {
            "type": "context",
            "line": " 1. [](#improved)"
          },
          {
            "type": "delete",
            "line": "   * More robust SSTI handling in `|filter` and `|map`"
          },
          {
            "type": "add",
            "line": "   * More robust SSTI handling in `filter`, `map`, and `reduce` Twig filters and functions"
          },
          {
            "type": "context",
            "line": "    * Various SSTI improvements `Utils::isDangerousFunction()`"
          },
          {
            "type": "context",
            "line": " 1. [](#bugfix)"
          },
          {
            "type": "context",
            "line": "    * Fixed Twig `|map()` allowing code execution"
          },
          {
            "type": "add",
            "line": "   * Fixed Twig `|reduce()` allowing code execution"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # v1.7.41.2"
          },
          {
            "type": "context",
            "line": " ## 06/01/2023"
          }
        ]
      },
      {
        "file": "system/src/Grav/Common/Twig/Extension/GravExtension.php",
        "changes": [
          {
            "type": "context",
            "line": "index daddc9106..2ef5364a3 100644"
          },
          {
            "type": "context",
            "line": "--- a/system/src/Grav/Common/Twig/Extension/GravExtension.php"
          },
          {
            "type": "context",
            "line": "+++ b/system/src/Grav/Common/Twig/Extension/GravExtension.php"
          },
          {
            "type": "context",
            "line": "             new TwigFilter('count', 'count'),"
          },
          {
            "type": "context",
            "line": "             new TwigFilter('array_diff', 'array_diff'),"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            // Security fix"
          },
          {
            "type": "delete",
            "line": "            new TwigFilter('filter', [$this, 'filterFilter'], ['needs_environment' => true]),"
          },
          {
            "type": "delete",
            "line": "            new TwigFilter('map', [$this, 'mapFilter'], ['needs_environment' => true]),"
          },
          {
            "type": "add",
            "line": "            // Security fixes"
          },
          {
            "type": "add",
            "line": "            new TwigFilter('filter', [$this, 'filterFunc'], ['needs_environment' => true]),"
          },
          {
            "type": "add",
            "line": "            new TwigFilter('map', [$this, 'mapFunc'], ['needs_environment' => true]),"
          },
          {
            "type": "add",
            "line": "            new TwigFilter('reduce', [$this, 'reduceFunc'], ['needs_environment' => true]),"
          },
          {
            "type": "context",
            "line": "         ];"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             new TwigFunction('count', 'count'),"
          },
          {
            "type": "context",
            "line": "             new TwigFunction('array_diff', 'array_diff'),"
          },
          {
            "type": "context",
            "line": "             new TwigFunction('parse_url', 'parse_url'),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            // Security fixes"
          },
          {
            "type": "add",
            "line": "            new TwigFunction('filter', [$this, 'filterFunc'], ['needs_environment' => true]),"
          },
          {
            "type": "add",
            "line": "            new TwigFunction('map', [$this, 'mapFunc'], ['needs_environment' => true]),"
          },
          {
            "type": "add",
            "line": "            new TwigFunction('reduce', [$this, 'reduceFunc'], ['needs_environment' => true]),"
          },
          {
            "type": "context",
            "line": "         ];"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "      * @return array|CallbackFilterIterator"
          },
          {
            "type": "context",
            "line": "      * @throws RuntimeError"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "delete",
            "line": "    function filterFilter(Environment $env, $array, $arrow)"
          },
          {
            "type": "add",
            "line": "    function filterFunc(Environment $env, $array, $arrow)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         if (!$arrow instanceof \\Closure && !is_string($arrow) || Utils::isDangerousFunction($arrow)) {"
          },
          {
            "type": "context",
            "line": "             throw new RuntimeError('Twig |filter(\"' . $arrow . '\") is not allowed.');"
          },
          {
            "type": "context",
            "line": "      * @return array|CallbackFilterIterator"
          },
          {
            "type": "context",
            "line": "      * @throws RuntimeError"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "delete",
            "line": "    function mapFilter(Environment $env, $array, $arrow)"
          },
          {
            "type": "add",
            "line": "    function mapFunc(Environment $env, $array, $arrow)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         if (!$arrow instanceof \\Closure && !is_string($arrow) || Utils::isDangerousFunction($arrow)) {"
          },
          {
            "type": "context",
            "line": "             throw new RuntimeError('Twig |map(\"' . $arrow . '\") is not allowed.');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return twig_array_map($env, $array, $arrow);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @param Environment $env"
          },
          {
            "type": "add",
            "line": "     * @param array $array"
          },
          {
            "type": "add",
            "line": "     * @param callable|string $arrow"
          },
          {
            "type": "add",
            "line": "     * @return array|CallbackFilterIterator"
          },
          {
            "type": "add",
            "line": "     * @throws RuntimeError"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    function reduceFunc(Environment $env, $array, $arrow)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        if (!$arrow instanceof \\Closure && !is_string($arrow) || Utils::isDangerousFunction($arrow)) {"
          },
          {
            "type": "add",
            "line": "            throw new RuntimeError('Twig |reduce(\"' . $arrow . '\") is not allowed.');"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return twig_array_map($env, $array, $arrow);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "2545222a3853e31ace15d87ae0e2effb7da0c96b",
    "files": [
      {
        "file": "CHANGES/5497.bugfix",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..aeea26e50"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGES/5497.bugfix"
          },
          {
            "type": "add",
            "line": "**(SECURITY BUG)** Started preventing open redirects in the"
          },
          {
            "type": "add",
            "line": "``aiohttp.web.normalize_path_middleware`` middleware. For"
          },
          {
            "type": "add",
            "line": "more details, see"
          },
          {
            "type": "add",
            "line": "https://github.com/aio-libs/aiohttp/security/advisories/GHSA-v6wp-4m6f-gcjg."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Thanks to `Beast Glatisant <https://github.com/g147>`__ for"
          },
          {
            "type": "add",
            "line": "finding the firstinstance of this issue and `Jelmer Vernooĳ"
          },
          {
            "type": "add",
            "line": "<https://jelmer.uk/>`__ for reporting and tracking it down"
          },
          {
            "type": "add",
            "line": "in aiohttp."
          }
        ]
      },
      {
        "file": "aiohttp/web_middlewares.py",
        "changes": [
          {
            "type": "context",
            "line": "index ad6284a50..3b040e849 100644"
          },
          {
            "type": "context",
            "line": "--- a/aiohttp/web_middlewares.py"
          },
          {
            "type": "context",
            "line": "+++ b/aiohttp/web_middlewares.py"
          },
          {
            "type": "context",
            "line": "                 paths_to_check.append(merged_slashes[:-1])"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             for path in paths_to_check:"
          },
          {
            "type": "add",
            "line": "                path = re.sub(\"^//+\", \"/\", path)  # SECURITY: GHSA-v6wp-4m6f-gcjg"
          },
          {
            "type": "context",
            "line": "                 resolves, request = await _check_request_resolves(request, path)"
          },
          {
            "type": "context",
            "line": "                 if resolves:"
          },
          {
            "type": "context",
            "line": "                     raise redirect_class(request.raw_path + query)"
          }
        ]
      },
      {
        "file": "tests/test_web_middleware.py",
        "changes": [
          {
            "type": "context",
            "line": "index 842dc9777..33343b65d 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/test_web_middleware.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/test_web_middleware.py"
          },
          {
            "type": "context",
            "line": "         with pytest.raises(AssertionError):"
          },
          {
            "type": "context",
            "line": "             web.normalize_path_middleware(append_slash=True, remove_slash=True)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @pytest.mark.parametrize("
          },
          {
            "type": "add",
            "line": "        [\"append_slash\", \"remove_slash\"],"
          },
          {
            "type": "add",
            "line": "        ["
          },
          {
            "type": "add",
            "line": "            (True, False),"
          },
          {
            "type": "add",
            "line": "            (False, True),"
          },
          {
            "type": "add",
            "line": "            (False, False),"
          },
          {
            "type": "add",
            "line": "        ],"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    async def test_open_redirects("
          },
          {
            "type": "add",
            "line": "        self, append_slash: bool, remove_slash: bool, aiohttp_client: Any"
          },
          {
            "type": "add",
            "line": "    ) -> None:"
          },
          {
            "type": "add",
            "line": "        async def handle(request: web.Request) -> web.StreamResponse:"
          },
          {
            "type": "add",
            "line": "            pytest.fail("
          },
          {
            "type": "add",
            "line": "                msg=\"Security advisory 'GHSA-v6wp-4m6f-gcjg' test handler \""
          },
          {
            "type": "add",
            "line": "                \"matched unexpectedly\","
          },
          {
            "type": "add",
            "line": "                pytrace=False,"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        app = web.Application("
          },
          {
            "type": "add",
            "line": "            middlewares=["
          },
          {
            "type": "add",
            "line": "                web.normalize_path_middleware("
          },
          {
            "type": "add",
            "line": "                    append_slash=append_slash, remove_slash=remove_slash"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        app.add_routes([web.get(\"/\", handle), web.get(\"/google.com\", handle)])"
          },
          {
            "type": "add",
            "line": "        client = await aiohttp_client(app, server_kwargs={\"skip_url_asserts\": True})"
          },
          {
            "type": "add",
            "line": "        resp = await client.get(\"//google.com\", allow_redirects=False)"
          },
          {
            "type": "add",
            "line": "        assert resp.status == 308"
          },
          {
            "type": "add",
            "line": "        assert resp.headers[\"Location\"] == \"/google.com\""
          },
          {
            "type": "add",
            "line": "        assert resp.url.query == URL(\"//google.com\").query"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " async def test_bug_3669(aiohttp_client: Any):"
          },
          {
            "type": "context",
            "line": "     async def paymethod(request):"
          }
        ]
      }
    ]
  },
  {
    "commit": "26de047275c355c5ae2bbbc51b164f0f8bef5c5b",
    "files": [
      {
        "file": "Changes",
        "changes": [
          {
            "type": "context",
            "line": "index 269f395b5..8aefb98bf 100644"
          },
          {
            "type": "context",
            "line": "--- a/Changes"
          },
          {
            "type": "context",
            "line": "+++ b/Changes"
          },
          {
            "type": "context",
            "line": " 3.06-2   Tue Jun  6 10:25:20 CEST 2023"
          },
          {
            "type": "context",
            "line": "           - panorama:"
          },
          {
            "type": "context",
            "line": "             - fix folder validation (CVE-2023-34096)"
          },
          {
            "type": "delete",
            "line": "next:"
          },
          {
            "type": "add",
            "line": "          - reports:"
          },
          {
            "type": "add",
            "line": "            - fix showing correct attachmenet size for html reports"
          },
          {
            "type": "add",
            "line": "            - remove duplicate css include"
          },
          {
            "type": "add",
            "line": "            - only use one css font-face source"
          },
          {
            "type": "context",
            "line": "           - Rest"
          },
          {
            "type": "context",
            "line": "             - add comments_info / downtimes_info to /r/hosts and /r/services"
          }
        ]
      }
    ]
  },
  {
    "commit": "2b71c922214d388838d930806207a66c14e80f63",
    "files": [
      {
        "file": "changelog.txt",
        "changes": [
          {
            "type": "context",
            "line": "index adc072028e..45950552fb 100644"
          },
          {
            "type": "context",
            "line": "--- a/changelog.txt"
          },
          {
            "type": "context",
            "line": "+++ b/changelog.txt"
          },
          {
            "type": "add",
            "line": "Version 4.9.11 (TBD)"
          },
          {
            "type": "add",
            "line": "    Fixed content in an iframe element parsing as dom elements instead of text content #TINY-5943"
          },
          {
            "type": "context",
            "line": " Version 4.9.10 (2020-04-23)"
          },
          {
            "type": "context",
            "line": "     Fixed an issue where the editor selection could end up inside a short ended element (eg br) #TINY-3999"
          },
          {
            "type": "context",
            "line": "     Fixed a security issue related to CDATA sanitization during parsing #TINY-4669"
          }
        ]
      },
      {
        "file": "package.json",
        "changes": [
          {
            "type": "context",
            "line": "index feac2337b2..7213f7fd0a 100644"
          },
          {
            "type": "context",
            "line": "--- a/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/package.json"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "   \"name\": \"tinymce\","
          },
          {
            "type": "delete",
            "line": "  \"version\": \"4.9.10\","
          },
          {
            "type": "add",
            "line": "  \"version\": \"4.9.11\","
          },
          {
            "type": "context",
            "line": "   \"repository\": {"
          },
          {
            "type": "context",
            "line": "     \"type\": \"git\","
          },
          {
            "type": "context",
            "line": "     \"url\": \"https://github.com/tinymce/tinymce.git\""
          }
        ]
      },
      {
        "file": "src/core/main/ts/api/html/Schema.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 7ccb256236..14640bcf2f 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/core/main/ts/api/html/Schema.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/core/main/ts/api/html/Schema.ts"
          },
          {
            "type": "context",
            "line": "   textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' +"
          },
          {
            "type": "context",
            "line": "     'dfn code mark q sup sub samp');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  each((settings.special || 'script noscript noframes noembed title style textarea xmp').split(' '), function (name) {"
          },
          {
            "type": "add",
            "line": "  each((settings.special || 'script noscript iframe noframes noembed title style textarea xmp').split(' '), function (name) {"
          },
          {
            "type": "context",
            "line": "     specialElements[name] = new RegExp('<\\/' + name + '[^>]*>', 'gi');"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/core/main/ts/html/ParserFilters.ts",
        "changes": [
          {
            "type": "context",
            "line": "index f91c78d994..fc56f24a50 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/core/main/ts/html/ParserFilters.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/core/main/ts/html/ParserFilters.ts"
          },
          {
            "type": "context",
            "line": "       const blockElements = Tools.extend({}, schema.getBlockElements());"
          },
          {
            "type": "context",
            "line": "       const nonEmptyElements = schema.getNonEmptyElements();"
          },
          {
            "type": "context",
            "line": "       let parent, lastParent, prev, prevName;"
          },
          {
            "type": "delete",
            "line": "      const whiteSpaceElements = schema.getNonEmptyElements();"
          },
          {
            "type": "add",
            "line": "      const whiteSpaceElements = schema.getWhiteSpaceElements();"
          },
          {
            "type": "context",
            "line": "       let elementRule, textNode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       // Remove brs from body element as well"
          }
        ]
      },
      {
        "file": "src/core/test/ts/browser/html/DomParserTest.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 803082fb77..e2934eb588 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/core/test/ts/browser/html/DomParserTest.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/core/test/ts/browser/html/DomParserTest.ts"
          },
          {
            "type": "context",
            "line": "     );"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  suite.test('parse iframe XSS', function () {"
          },
          {
            "type": "add",
            "line": "    const serializer = Serializer();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    LegacyUnit.equal("
          },
          {
            "type": "add",
            "line": "      serializer.serialize(DomParser().parse("
          },
          {
            "type": "add",
            "line": "        '<iframe><textarea></iframe><img src=\"a\" onerror=\"alert(document.domain)\" />')"
          },
          {
            "type": "add",
            "line": "      ),"
          },
          {
            "type": "add",
            "line": "      '<iframe><textarea></iframe><img src=\"a\" />'"
          },
          {
            "type": "add",
            "line": "    );"
          },
          {
            "type": "add",
            "line": "  });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   suite.test('getAttributeFilters/getNodeFilters', function () {"
          },
          {
            "type": "context",
            "line": "     const parser = DomParser();"
          },
          {
            "type": "context",
            "line": "     const cb1 = (nodes, name, args) => {};"
          }
        ]
      },
      {
        "file": "src/core/test/ts/browser/html/SaxParserTest.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 46a862b19b..f5f0aab2ee 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/core/test/ts/browser/html/SaxParserTest.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/core/test/ts/browser/html/SaxParserTest.ts"
          },
          {
            "type": "context",
            "line": "     const specialHtml = ("
          },
          {
            "type": "context",
            "line": "       '<b>' +"
          },
          {
            "type": "context",
            "line": "       '<textarea></b></textarea><title></b></title><script></b></script>' +"
          },
          {
            "type": "add",
            "line": "      '<iframe><img src=\"image.png\"></iframe>' +"
          },
          {
            "type": "context",
            "line": "       '<noframes></b></noframes><noscript></b></noscript><style></b></style>' +"
          },
          {
            "type": "context",
            "line": "       '<xmp></b></xmp>' +"
          },
          {
            "type": "context",
            "line": "       '<noembed></b></noembed>' +"
          },
          {
            "type": "context",
            "line": "     writer.reset();"
          },
          {
            "type": "context",
            "line": "     parser.parse(specialHtml);"
          },
          {
            "type": "context",
            "line": "     LegacyUnit.equal(writer.getContent(), specialHtml);"
          },
          {
            "type": "delete",
            "line": "    LegacyUnit.deepEqual(counter.counts, { start: 9, text: 8, end: 9 });"
          },
          {
            "type": "add",
            "line": "    LegacyUnit.deepEqual(counter.counts, { start: 10, text: 9, end: 10 });"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   suite.test('Parse malformed elements that start with numbers', function () {"
          }
        ]
      },
      {
        "file": "src/core/test/ts/browser/html/SchemaTest.ts",
        "changes": [
          {
            "type": "context",
            "line": "index b6a1f48b5e..eaf1dd0e91 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/core/test/ts/browser/html/SchemaTest.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/core/test/ts/browser/html/SchemaTest.ts"
          },
          {
            "type": "add",
            "line": "import { Arr, Obj } from '@ephox/katamari';"
          },
          {
            "type": "context",
            "line": " import { LegacyUnit } from '@ephox/mcagar';"
          },
          {
            "type": "context",
            "line": " import { Pipeline } from '@ephox/agar';"
          },
          {
            "type": "context",
            "line": " import Schema from 'tinymce/core/api/html/Schema';"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  suite.test('getSpecialElements', () => {"
          },
          {
            "type": "add",
            "line": "    const schema = Schema();"
          },
          {
            "type": "add",
            "line": "    const keys = Arr.sort(Obj.keys(schema.getSpecialElements()));"
          },
          {
            "type": "add",
            "line": "    LegacyUnit.equal(keys, Arr.sort(["
          },
          {
            "type": "add",
            "line": "      'script',"
          },
          {
            "type": "add",
            "line": "      'noscript',"
          },
          {
            "type": "add",
            "line": "      'iframe',"
          },
          {
            "type": "add",
            "line": "      'noframes',"
          },
          {
            "type": "add",
            "line": "      'noembed',"
          },
          {
            "type": "add",
            "line": "      'title',"
          },
          {
            "type": "add",
            "line": "      'style',"
          },
          {
            "type": "add",
            "line": "      'textarea',"
          },
          {
            "type": "add",
            "line": "      'xmp'"
          },
          {
            "type": "add",
            "line": "    ]));"
          },
          {
            "type": "add",
            "line": "  });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   suite.test('isValidChild', function () {"
          },
          {
            "type": "context",
            "line": "     let schema;"
          }
        ]
      }
    ]
  },
  {
    "commit": "2d4a3fee6de2fa45eb82169361918f759269b4ec",
    "files": [
      {
        "file": "src/urllib3/util/url.py",
        "changes": [
          {
            "type": "context",
            "line": "index 6ff238fe..81a03da9 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/urllib3/util/url.py"
          },
          {
            "type": "context",
            "line": "+++ b/src/urllib3/util/url.py"
          },
          {
            "type": "context",
            "line": " BRACELESS_IPV6_ADDRZ_RE = re.compile(\"^\" + IPV6_ADDRZ_PAT[2:-2] + \"$\")"
          },
          {
            "type": "context",
            "line": " ZONE_ID_RE = re.compile(\"(\" + ZONE_ID_PAT + r\")\\]$\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "SUBAUTHORITY_PAT = (u\"^(?:(.*)@)?(%s|%s|%s)(?::([0-9]{0,5}))?$\") % ("
          },
          {
            "type": "add",
            "line": "_HOST_PORT_PAT = (\"^(%s|%s|%s)(?::([0-9]{0,5}))?$\") % ("
          },
          {
            "type": "context",
            "line": "     REG_NAME_PAT,"
          },
          {
            "type": "context",
            "line": "     IPV4_PAT,"
          },
          {
            "type": "context",
            "line": "     IPV6_ADDRZ_PAT,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "delete",
            "line": "SUBAUTHORITY_RE = re.compile(SUBAUTHORITY_PAT, re.UNICODE | re.DOTALL)"
          },
          {
            "type": "add",
            "line": "_HOST_PORT_RE = re.compile(_HOST_PORT_PAT, re.UNICODE | re.DOTALL)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " UNRESERVED_CHARS = set("
          },
          {
            "type": "context",
            "line": "     \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._-~\""
          },
          {
            "type": "context",
            "line": "             scheme = scheme.lower()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if authority:"
          },
          {
            "type": "delete",
            "line": "            auth, host, port = SUBAUTHORITY_RE.match(authority).groups()"
          },
          {
            "type": "add",
            "line": "            auth, _, host_port = authority.rpartition(\"@\")"
          },
          {
            "type": "add",
            "line": "            auth = auth or None"
          },
          {
            "type": "add",
            "line": "            host, port = _HOST_PORT_RE.match(host_port).groups()"
          },
          {
            "type": "context",
            "line": "             if auth and normalize_uri:"
          },
          {
            "type": "context",
            "line": "                 auth = _encode_invalid_chars(auth, USERINFO_CHARS)"
          },
          {
            "type": "context",
            "line": "             if port == \"\":"
          }
        ]
      },
      {
        "file": "test/test_util.py",
        "changes": [
          {
            "type": "context",
            "line": "index a5b68a08..88409e2d 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/test_util.py"
          },
          {
            "type": "context",
            "line": "+++ b/test/test_util.py"
          },
          {
            "type": "context",
            "line": "                 fragment=\"hash\","
          },
          {
            "type": "context",
            "line": "             ),"
          },
          {
            "type": "context",
            "line": "         ),"
          },
          {
            "type": "add",
            "line": "        # Tons of '@' causing backtracking"
          },
          {
            "type": "add",
            "line": "        (\"https://\" + (\"@\" * 10000) + \"[\", False),"
          },
          {
            "type": "add",
            "line": "        ("
          },
          {
            "type": "add",
            "line": "            \"https://user:\" + (\"@\" * 10000) + \"example.com\","
          },
          {
            "type": "add",
            "line": "            Url("
          },
          {
            "type": "add",
            "line": "                scheme=\"https\","
          },
          {
            "type": "add",
            "line": "                auth=\"user:\" + (\"%40\" * 9999),"
          },
          {
            "type": "add",
            "line": "                host=\"example.com\","
          },
          {
            "type": "add",
            "line": "            ),"
          },
          {
            "type": "add",
            "line": "        ),"
          },
          {
            "type": "context",
            "line": "     ]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @pytest.mark.parametrize(\"url, expected_url\", url_vulnerabilities)"
          }
        ]
      }
    ]
  },
  {
    "commit": "33834cb2a4d035b52aa2a26742f832a112e90a0a",
    "files": [
      {
        "file": "rpcapd/daemon.c",
        "changes": [
          {
            "type": "context",
            "line": "index c335fb05..635d3195 100644"
          },
          {
            "type": "context",
            "line": "--- a/rpcapd/daemon.c"
          },
          {
            "type": "context",
            "line": "+++ b/rpcapd/daemon.c"
          },
          {
            "type": "context",
            "line": " static int rpcapd_discard(SOCKET sock, uint32 len);"
          },
          {
            "type": "context",
            "line": " static void session_close(struct session *);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "static int is_url(const char *source);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " int"
          },
          {
            "type": "context",
            "line": " daemon_serviceloop(SOCKET sockctrl, int isactive, char *passiveClients,"
          },
          {
            "type": "context",
            "line": "     int nullAuthAllowed)"
          },
          {
            "type": "context",
            "line": " \tsource[nread] = '\\0';"
          },
          {
            "type": "context",
            "line": " \tplen -= nread;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t// XXX - make sure it's *not* a URL; we don't support opening"
          },
          {
            "type": "delete",
            "line": "\t// remote devices here."
          },
          {
            "type": "add",
            "line": "\t// Is this a URL rather than a device?"
          },
          {
            "type": "add",
            "line": "\t// If so, reject it."
          },
          {
            "type": "add",
            "line": "\tif (is_url(source))"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errmsgbuf, PCAP_ERRBUF_SIZE, \"Source string refers to a remote device\");"
          },
          {
            "type": "add",
            "line": "\t\tgoto error;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// Open the selected device"
          },
          {
            "type": "context",
            "line": " \t// This is a fake open, since we do that only to get the needed parameters, then we close the device again"
          },
          {
            "type": "context",
            "line": " \t\tsession->fp = NULL;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Check whether a capture source string is a URL or not."
          },
          {
            "type": "add",
            "line": "// This includes URLs that refer to a local device; a scheme, followed"
          },
          {
            "type": "add",
            "line": "// by ://, followed by *another* scheme and ://, is just silly, and"
          },
          {
            "type": "add",
            "line": "// anybody who supplies that will get an error."
          },
          {
            "type": "add",
            "line": "//"
          },
          {
            "type": "add",
            "line": "static int"
          },
          {
            "type": "add",
            "line": "is_url(const char *source)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tchar *colonp;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * RFC 3986 says:"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t *   URI         = scheme \":\" hier-part [ \"?\" query ] [ \"#\" fragment ]"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t *   hier-part   = \"//\" authority path-abempty"
          },
          {
            "type": "add",
            "line": "\t *               / path-absolute"
          },
          {
            "type": "add",
            "line": "\t *               / path-rootless"
          },
          {
            "type": "add",
            "line": "\t *               / path-empty"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t *   authority   = [ userinfo \"@\" ] host [ \":\" port ]"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t *   userinfo    = *( unreserved / pct-encoded / sub-delims / \":\" )"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * Step 1: look for the \":\" at the end of the scheme."
          },
          {
            "type": "add",
            "line": "\t * A colon in the source is *NOT* sufficient to indicate that"
          },
          {
            "type": "add",
            "line": "\t * this is a URL, as interface names on some platforms might"
          },
          {
            "type": "add",
            "line": "\t * include colons (e.g., I think some Solaris interfaces"
          },
          {
            "type": "add",
            "line": "\t * might)."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tcolonp = strchr(source, ':');"
          },
          {
            "type": "add",
            "line": "\tif (colonp == NULL)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t * The source is the device to open.  It's not a URL."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\treturn (0);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * All schemes must have \"//\" after them, i.e. we only support"
          },
          {
            "type": "add",
            "line": "\t * hier-part   = \"//\" authority path-abempty, not"
          },
          {
            "type": "add",
            "line": "\t * hier-part   = path-absolute"
          },
          {
            "type": "add",
            "line": "\t * hier-part   = path-rootless"
          },
          {
            "type": "add",
            "line": "\t * hier-part   = path-empty"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * We need that in order to distinguish between a local device"
          },
          {
            "type": "add",
            "line": "\t * name that happens to contain a colon and a URI."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tif (strncmp(colonp + 1, \"//\", 2) != 0)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\t/*"
          },
          {
            "type": "add",
            "line": "\t\t * The source is the device to open.  It's not a URL."
          },
          {
            "type": "add",
            "line": "\t\t */"
          },
          {
            "type": "add",
            "line": "\t\treturn (0);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/*"
          },
          {
            "type": "add",
            "line": "\t * It's a URL."
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\treturn (1);"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      }
    ]
  },
  {
    "commit": "35a8b501c9e4e767ec4b36c2586f34d4ab66d229",
    "files": [
      {
        "file": "application/loginwebpage.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index 47cfe6563..3745589dc 100644"
          },
          {
            "type": "context",
            "line": "--- a/application/loginwebpage.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/application/loginwebpage.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t\t// This token allows the user to change the password without knowing the previous one"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$sToken = substr(md5(APPROOT.uniqid()), 0, 16);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t$sToken = bin2hex(random_bytes(32));"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$oUser->Set('reset_pwd_token', $sToken);"
          },
          {
            "type": "context",
            "line": " \t\t\t\tCMDBObject::SetTrackInfo('Reset password');"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$oUser->AllowWrite(true);"
          }
        ]
      }
    ]
  },
  {
    "commit": "3c0c64642b9e5b8d28b111263c7f4bddad6c3880",
    "files": [
      {
        "file": "wagtail/documents/models.py",
        "changes": [
          {
            "type": "context",
            "line": "index a5309df8b6..cb792f7777 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/documents/models.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/documents/models.py"
          },
          {
            "type": "delete",
            "line": "import hashlib"
          },
          {
            "type": "context",
            "line": " import os.path"
          },
          {
            "type": "context",
            "line": " import urllib"
          },
          {
            "type": "context",
            "line": " from contextlib import contextmanager"
          },
          {
            "type": "context",
            "line": " from wagtail.models import CollectionMember, ReferenceIndex"
          },
          {
            "type": "context",
            "line": " from wagtail.search import index"
          },
          {
            "type": "context",
            "line": " from wagtail.search.queryset import SearchableQuerySetMixin"
          },
          {
            "type": "add",
            "line": "from wagtail.utils.file import hash_filelike"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class DocumentQuerySet(SearchableQuerySetMixin, models.QuerySet):"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return self.file_size"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def _set_file_hash(self, file_contents):"
          },
          {
            "type": "delete",
            "line": "        self.file_hash = hashlib.sha1(file_contents).hexdigest()"
          },
          {
            "type": "add",
            "line": "    def _set_file_hash(self):"
          },
          {
            "type": "add",
            "line": "        with self.open_file() as f:"
          },
          {
            "type": "add",
            "line": "            self.file_hash = hash_filelike(f)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def get_file_hash(self):"
          },
          {
            "type": "context",
            "line": "         if self.file_hash == \"\":"
          },
          {
            "type": "delete",
            "line": "            with self.open_file() as f:"
          },
          {
            "type": "delete",
            "line": "                self._set_file_hash(f.read())"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "            self._set_file_hash()"
          },
          {
            "type": "context",
            "line": "             self.save(update_fields=[\"file_hash\"])"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return self.file_hash"
          },
          {
            "type": "context",
            "line": "         self.file_size = self.file.size"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # Set new document file hash"
          },
          {
            "type": "delete",
            "line": "        self._set_file_hash(self.file.read())"
          },
          {
            "type": "add",
            "line": "        self._set_file_hash()"
          },
          {
            "type": "context",
            "line": "         self.file.seek(0)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def __str__(self):"
          }
        ]
      },
      {
        "file": "wagtail/documents/tests/test_models.py",
        "changes": [
          {
            "type": "context",
            "line": "index eecb512c05..2a1a2d6fdb 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/documents/tests/test_models.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/documents/tests/test_models.py"
          },
          {
            "type": "context",
            "line": "             \"application/octet-stream\", self.extensionless_document.content_type"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_file_hash(self):"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            self.document.get_file_hash(), \"7d8c4778b182e4f3bd442408c64a6e22a4b0ed85\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            self.pdf_document.get_file_hash(),"
          },
          {
            "type": "add",
            "line": "            \"7d8c4778b182e4f3bd442408c64a6e22a4b0ed85\","
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            self.extensionless_document.get_file_hash(),"
          },
          {
            "type": "add",
            "line": "            \"7d8c4778b182e4f3bd442408c64a6e22a4b0ed85\","
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_content_disposition(self):"
          },
          {
            "type": "context",
            "line": "         self.assertEqual("
          },
          {
            "type": "context",
            "line": "             \"\"\"attachment; filename=example.doc; filename*=UTF-8''example.doc\"\"\","
          }
        ]
      },
      {
        "file": "wagtail/images/models.py",
        "changes": [
          {
            "type": "context",
            "line": "index 6b05f5a9dd..fc968a801b 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/images/models.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/images/models.py"
          },
          {
            "type": "context",
            "line": " from wagtail.models import CollectionMember, ReferenceIndex"
          },
          {
            "type": "context",
            "line": " from wagtail.search import index"
          },
          {
            "type": "context",
            "line": " from wagtail.search.queryset import SearchableQuerySetMixin"
          },
          {
            "type": "add",
            "line": "from wagtail.utils.file import hash_filelike"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " logger = logging.getLogger(\"wagtail.images\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     objects = ImageQuerySet.as_manager()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def _set_file_hash(self, file_contents):"
          },
          {
            "type": "delete",
            "line": "        self.file_hash = hashlib.sha1(file_contents).hexdigest()"
          },
          {
            "type": "add",
            "line": "    def _set_file_hash(self):"
          },
          {
            "type": "add",
            "line": "        with self.open_file() as f:"
          },
          {
            "type": "add",
            "line": "            self.file_hash = hash_filelike(f)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def get_file_hash(self):"
          },
          {
            "type": "context",
            "line": "         if self.file_hash == \"\":"
          },
          {
            "type": "delete",
            "line": "            with self.open_file() as f:"
          },
          {
            "type": "delete",
            "line": "                self._set_file_hash(f.read())"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "            self._set_file_hash()"
          },
          {
            "type": "context",
            "line": "             self.save(update_fields=[\"file_hash\"])"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return self.file_hash"
          },
          {
            "type": "context",
            "line": "         self.file_size = self.file.size"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # Set new image file hash"
          },
          {
            "type": "delete",
            "line": "        self._set_file_hash(self.file.read())"
          },
          {
            "type": "add",
            "line": "        self._set_file_hash()"
          },
          {
            "type": "context",
            "line": "         self.file.seek(0)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def get_upload_to(self, filename):"
          }
        ]
      },
      {
        "file": "wagtail/images/tests/test_models.py",
        "changes": [
          {
            "type": "context",
            "line": "index b6cc71e53e..58a558158e 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/images/tests/test_models.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/images/tests/test_models.py"
          },
          {
            "type": "context",
            "line": "         with self.assertRaises(SourceImageIOError):"
          },
          {
            "type": "context",
            "line": "             self.image.get_file_size()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_file_hash(self):"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            self.image.get_file_hash(), \"4dd0211870e130b7e1690d2ec53c499a54a48fef\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class TestImageQuerySet(TestCase):"
          },
          {
            "type": "context",
            "line": "     def test_search_method(self):"
          }
        ]
      },
      {
        "file": "wagtail/tests/test_utils.py",
        "changes": [
          {
            "type": "context",
            "line": "index 2987d5d871..acf397e9c3 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/tests/test_utils.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/tests/test_utils.py"
          },
          {
            "type": "context",
            "line": " # -*- coding: utf-8 -*"
          },
          {
            "type": "context",
            "line": " import pickle"
          },
          {
            "type": "add",
            "line": "from io import BytesIO, StringIO"
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from django.contrib.contenttypes.models import ContentType"
          },
          {
            "type": "context",
            "line": " from django.core.exceptions import ImproperlyConfigured, SuspiciousOperation"
          },
          {
            "type": "add",
            "line": "from django.core.files.uploadedfile import SimpleUploadedFile"
          },
          {
            "type": "context",
            "line": " from django.test import SimpleTestCase, TestCase, override_settings"
          },
          {
            "type": "context",
            "line": " from django.utils.text import slugify"
          },
          {
            "type": "context",
            "line": " from django.utils.translation import _trans"
          },
          {
            "type": "context",
            "line": "     string_to_ascii,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": " from wagtail.models import Page, Site"
          },
          {
            "type": "add",
            "line": "from wagtail.utils.file import hash_filelike"
          },
          {
            "type": "context",
            "line": " from wagtail.utils.utils import deep_update"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 \"starship\": \"enterprise\","
          },
          {
            "type": "context",
            "line": "             },"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class HashFileLikeTestCase(SimpleTestCase):"
          },
          {
            "type": "add",
            "line": "    test_file = Path.cwd() / \"LICENSE\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_hashes_io(self):"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            hash_filelike(BytesIO(b\"test\")), \"a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            hash_filelike(StringIO(\"test\")), \"a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_hashes_file(self):"
          },
          {
            "type": "add",
            "line": "        with self.test_file.open(mode=\"r\") as f:"
          },
          {
            "type": "add",
            "line": "            self.assertEqual("
          },
          {
            "type": "add",
            "line": "                hash_filelike(f), \"9e58400061ca660ef7b5c94338a5205627c77eda\""
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_hashes_file_bytes(self):"
          },
          {
            "type": "add",
            "line": "        with self.test_file.open(mode=\"rb\") as f:"
          },
          {
            "type": "add",
            "line": "            self.assertEqual("
          },
          {
            "type": "add",
            "line": "                hash_filelike(f), \"9e58400061ca660ef7b5c94338a5205627c77eda\""
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_hashes_django_uploaded_file(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        Check Django's file shims can be hashed as-is."
          },
          {
            "type": "add",
            "line": "        `SimpleUploadedFile` inherits the base `UploadedFile`, but is easiest to test against"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            hash_filelike(SimpleUploadedFile(\"example.txt\", b\"test\")),"
          },
          {
            "type": "add",
            "line": "            \"a94a8fe5ccb19ba61c4c0873d391e987982fbbd3\","
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_hashes_large_file(self):"
          },
          {
            "type": "add",
            "line": "        class FakeLargeFile:"
          },
          {
            "type": "add",
            "line": "            \"\"\""
          },
          {
            "type": "add",
            "line": "            A class that pretends to be a huge file (~1.3GB)"
          },
          {
            "type": "add",
            "line": "            \"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            def __init__(self):"
          },
          {
            "type": "add",
            "line": "                self.iterations = 20000"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            def read(self, bytes):"
          },
          {
            "type": "add",
            "line": "                self.iterations -= 1"
          },
          {
            "type": "add",
            "line": "                if not self.iterations:"
          },
          {
            "type": "add",
            "line": "                    return b\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "                return b\"A\" * bytes"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            hash_filelike(FakeLargeFile()),"
          },
          {
            "type": "add",
            "line": "            \"187cc1db32624dccace20d042f6d631f1a483020\","
          },
          {
            "type": "add",
            "line": "        )"
          }
        ]
      },
      {
        "file": "wagtail/utils/file.py",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..cb0a706241"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/utils/file.py"
          },
          {
            "type": "add",
            "line": "from hashlib import sha1"
          },
          {
            "type": "add",
            "line": "from io import UnsupportedOperation"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from django.utils.encoding import force_bytes"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "HASH_READ_SIZE = 65536  # 64k"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def hash_filelike(filelike):"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": "    Compute the hash of a file-like object, without loading it all into memory."
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": "    file_pos = 0"
          },
          {
            "type": "add",
            "line": "    if hasattr(filelike, \"tell\"):"
          },
          {
            "type": "add",
            "line": "        file_pos = filelike.tell()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    try:"
          },
          {
            "type": "add",
            "line": "        # Reset file handler to the start of the file so we hash it all"
          },
          {
            "type": "add",
            "line": "        filelike.seek(0)"
          },
          {
            "type": "add",
            "line": "    except (AttributeError, UnsupportedOperation):"
          },
          {
            "type": "add",
            "line": "        pass"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    hasher = sha1()"
          },
          {
            "type": "add",
            "line": "    while True:"
          },
          {
            "type": "add",
            "line": "        data = filelike.read(HASH_READ_SIZE)"
          },
          {
            "type": "add",
            "line": "        if not data:"
          },
          {
            "type": "add",
            "line": "            break"
          },
          {
            "type": "add",
            "line": "        # Use `force_bytes` to account for files opened as text"
          },
          {
            "type": "add",
            "line": "        hasher.update(force_bytes(data))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if hasattr(filelike, \"seek\"):"
          },
          {
            "type": "add",
            "line": "        # Reset the file handler to where it was before"
          },
          {
            "type": "add",
            "line": "        filelike.seek(file_pos)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return hasher.hexdigest()"
          }
        ]
      }
    ]
  },
  {
    "commit": "3c88aec034934bcbad30c5ef1cab62cbbdb98e64",
    "files": [
      {
        "file": "frontend/src/components/Modals/MangeWorkspace/Documents/index.jsx",
        "changes": [
          {
            "type": "context",
            "line": "index 3dcfd337..628f22c5 100644"
          },
          {
            "type": "context",
            "line": "--- a/frontend/src/components/Modals/MangeWorkspace/Documents/index.jsx"
          },
          {
            "type": "context",
            "line": "+++ b/frontend/src/components/Modals/MangeWorkspace/Documents/index.jsx"
          },
          {
            "type": "context",
            "line": "         </div>"
          },
          {
            "type": "context",
            "line": "       </div>"
          },
          {
            "type": "context",
            "line": "       <div"
          },
          {
            "type": "delete",
            "line": "        className={`flex items-center ${canDelete ? \"justify-between\" : \"justify-end\""
          },
          {
            "type": "delete",
            "line": "          } p-4 md:p-6 space-x-2 border-t border-gray-200 rounded-b dark:border-gray-600`}"
          },
          {
            "type": "add",
            "line": "        className={`flex items-center ${"
          },
          {
            "type": "add",
            "line": "          canDelete ? \"justify-between\" : \"justify-end\""
          },
          {
            "type": "add",
            "line": "        } p-4 md:p-6 space-x-2 border-t border-gray-200 rounded-b dark:border-gray-600`}"
          },
          {
            "type": "context",
            "line": "       >"
          },
          {
            "type": "context",
            "line": "         <button"
          },
          {
            "type": "context",
            "line": "           hidden={!canDelete}"
          }
        ]
      },
      {
        "file": "server/endpoints/system.js",
        "changes": [
          {
            "type": "context",
            "line": "index 736ab141..d493a2c2 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/system.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/system.js"
          },
          {
            "type": "context",
            "line": " const { validatedRequest } = require(\"../utils/middleware/validatedRequest\");"
          },
          {
            "type": "context",
            "line": " const { handleImports } = setupDataImports();"
          },
          {
            "type": "context",
            "line": " const { handleLogoUploads } = setupLogoUploads();"
          },
          {
            "type": "add",
            "line": "const fs = require(\"fs\");"
          },
          {
            "type": "context",
            "line": " const path = require(\"path\");"
          },
          {
            "type": "context",
            "line": " const {"
          },
          {
            "type": "context",
            "line": "   getDefaultFilename,"
          },
          {
            "type": "context",
            "line": "     \"/system/data-exports/:filename\","
          },
          {
            "type": "context",
            "line": "     [validatedRequest],"
          },
          {
            "type": "context",
            "line": "     (request, response) => {"
          },
          {
            "type": "delete",
            "line": "      const filePath ="
          },
          {
            "type": "delete",
            "line": "        __dirname + \"/../storage/exports/\" + request.params.filename;"
          },
          {
            "type": "delete",
            "line": "      response.download(filePath, request.params.filename, (err) => {"
          },
          {
            "type": "add",
            "line": "      const exportLocation = __dirname + \"/../storage/exports/\";"
          },
          {
            "type": "add",
            "line": "      const sanitized = path"
          },
          {
            "type": "add",
            "line": "        .normalize(request.params.filename)"
          },
          {
            "type": "add",
            "line": "        .replace(/^(\\.\\.(\\/|\\\\|$))+/, \"\");"
          },
          {
            "type": "add",
            "line": "      const finalDestination = path.join(exportLocation, sanitized);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      if (!fs.existsSync(finalDestination)) {"
          },
          {
            "type": "add",
            "line": "        response.status(404).json({"
          },
          {
            "type": "add",
            "line": "          error: 404,"
          },
          {
            "type": "add",
            "line": "          msg: `File ${request.params.filename} does not exist in exports.`,"
          },
          {
            "type": "add",
            "line": "        });"
          },
          {
            "type": "add",
            "line": "        return;"
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "      response.download(finalDestination, request.params.filename, (err) => {"
          },
          {
            "type": "context",
            "line": "         if (err) {"
          },
          {
            "type": "context",
            "line": "           response.send({"
          },
          {
            "type": "context",
            "line": "             error: err,"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ canDelete });"
          },
          {
            "type": "context",
            "line": "       } catch (error) {"
          },
          {
            "type": "context",
            "line": "         console.error(\"Error fetching can delete workspaces:\", error);"
          },
          {
            "type": "delete",
            "line": "        response"
          },
          {
            "type": "delete",
            "line": "          .status(500)"
          },
          {
            "type": "delete",
            "line": "          .json({"
          },
          {
            "type": "delete",
            "line": "            success: false,"
          },
          {
            "type": "delete",
            "line": "            message: \"Internal server error\","
          },
          {
            "type": "delete",
            "line": "            canDelete: false,"
          },
          {
            "type": "delete",
            "line": "          });"
          },
          {
            "type": "add",
            "line": "        response.status(500).json({"
          },
          {
            "type": "add",
            "line": "          success: false,"
          },
          {
            "type": "add",
            "line": "          message: \"Internal server error\","
          },
          {
            "type": "add",
            "line": "          canDelete: false,"
          },
          {
            "type": "add",
            "line": "        });"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "   );"
          }
        ]
      }
    ]
  },
  {
    "commit": "3d06c5131c15600621e08b06f07d976887cde81b",
    "files": [
      {
        "file": "deploy/requirements.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 835a79b45..944056117 100644"
          },
          {
            "type": "context",
            "line": "--- a/deploy/requirements.txt"
          },
          {
            "type": "context",
            "line": "+++ b/deploy/requirements.txt"
          },
          {
            "type": "context",
            "line": " django-storages==1.12.3"
          },
          {
            "type": "context",
            "line": " django_annoying==0.10.6"
          },
          {
            "type": "context",
            "line": " django_debug_toolbar==3.2.1"
          },
          {
            "type": "add",
            "line": "django-environ==0.10.0"
          },
          {
            "type": "context",
            "line": " django_filter==2.4.0"
          },
          {
            "type": "context",
            "line": " django_model_utils==4.1.1"
          },
          {
            "type": "context",
            "line": " django_rq==2.5.1"
          }
        ]
      },
      {
        "file": "label_studio/core/settings/base.py",
        "changes": [
          {
            "type": "context",
            "line": "index e2344bcd8..4ec6dc381 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/core/settings/base.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/core/settings/base.py"
          },
          {
            "type": "context",
            "line": " if not logging.getLogger().hasHandlers():"
          },
          {
            "type": "context",
            "line": "     logging.basicConfig(level=logging.DEBUG, format='%(message)s')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from label_studio.core.utils.io import get_data_dir"
          },
          {
            "type": "add",
            "line": "from label_studio.core.utils.io import get_data_dir, generate_key_if_missing"
          },
          {
            "type": "context",
            "line": " from label_studio.core.utils.params import get_bool_env, get_env, get_env_list_int"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " logger = logging.getLogger(__name__)"
          },
          {
            "type": "context",
            "line": " INTERNAL_PORT = '8080'"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # SECURITY WARNING: keep the secret key used in production secret!"
          },
          {
            "type": "delete",
            "line": "SECRET_KEY = '$(fefwefwef13;LFK{P!)@#*!)kdsjfWF2l+i5e3t(8a1n'"
          },
          {
            "type": "add",
            "line": "SECRET_KEY = generate_key_if_missing('SECRET_KEY')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # SECURITY WARNING: don't run with debug turned on in production!"
          },
          {
            "type": "context",
            "line": " DEBUG = get_bool_env('DEBUG', True)"
          }
        ]
      },
      {
        "file": "label_studio/core/utils/io.py",
        "changes": [
          {
            "type": "context",
            "line": "index 64dd57dd6..476d792e3 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/core/utils/io.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/core/utils/io.py"
          },
          {
            "type": "context",
            "line": " \"\"\"This file and its contents are licensed under the Apache License 2.0. Please see the included NOTICE for copyright information and LICENSE for a copy of the license."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \"\"\""
          },
          {
            "type": "context",
            "line": " import os"
          },
          {
            "type": "context",
            "line": " import socket"
          },
          {
            "type": "context",
            "line": " from tempfile import mkstemp, mkdtemp"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from django.conf import settings"
          },
          {
            "type": "add",
            "line": "from django.core.management.utils import get_random_secret_key"
          },
          {
            "type": "add",
            "line": "from label_studio.core.utils.params import env, env_file"
          },
          {
            "type": "context",
            "line": " from appdirs import user_config_dir, user_data_dir, user_cache_dir"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # full path import results in unit test failures"
          },
          {
            "type": "context",
            "line": "         if ipaddress.ip_address(ip) in ipaddress.ip_network(subnet):"
          },
          {
            "type": "context",
            "line": "             raise InvalidUploadUrlError"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def generate_key_if_missing(key):"
          },
          {
            "type": "add",
            "line": "    value = env.str(key, \"\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if value == \"\":"
          },
          {
            "type": "add",
            "line": "        print(f'Warning: {key} not found in environment variables will generate a random key.')"
          },
          {
            "type": "add",
            "line": "        value = get_random_secret_key()"
          },
          {
            "type": "add",
            "line": "        try:"
          },
          {
            "type": "add",
            "line": "            with open(env_file, 'a') as f:"
          },
          {
            "type": "add",
            "line": "                f.write(f'\\n{key}={value}\\n')"
          },
          {
            "type": "add",
            "line": "        except Exception as e:"
          },
          {
            "type": "add",
            "line": "            print(f'Warning: failed to write {key} to .env file: {e}, new key will be regenerated on every server restart. If this key is used for signing, it will invalidate all existing sessions or tokens. Please set {key} in your environment variables to avoid this warning.')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        os.environ[key] = value"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return value"
          },
          {
            "type": "add",
            "line": ""
          }
        ]
      },
      {
        "file": "label_studio/core/utils/params.py",
        "changes": [
          {
            "type": "context",
            "line": "index 077d74adc..630557862 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/core/utils/params.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/core/utils/params.py"
          },
          {
            "type": "context",
            "line": " import os"
          },
          {
            "type": "add",
            "line": "import environ"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " from rest_framework.exceptions import ValidationError"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "env = environ.Env()"
          },
          {
            "type": "add",
            "line": "data_dir = os.environ.get('LABEL_STUDIO_DATA_DIR', os.path.join(os.path.dirname(__file__), '..', '..', '..', 'data'))"
          },
          {
            "type": "add",
            "line": "env_file = os.path.join(data_dir, '.env')"
          },
          {
            "type": "add",
            "line": "environ.Env.read_env(env_file)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def cast_bool_from_str(value):"
          },
          {
            "type": "context",
            "line": "     if isinstance(value, str):"
          },
          {
            "type": "context",
            "line": "         if value.lower() in ['true', 'yes', 'on', '1']:"
          }
        ]
      }
    ]
  },
  {
    "commit": "3db47b575b9cb0a765da3d283baa2c065df0d0bc",
    "files": [
      {
        "file": ".eslintignore",
        "changes": [
          {
            "type": "context",
            "line": "index 69e2292fe..b138ca656 100644"
          },
          {
            "type": "context",
            "line": "--- a/.eslintignore"
          },
          {
            "type": "context",
            "line": "+++ b/.eslintignore"
          },
          {
            "type": "context",
            "line": " ReactNativeClient/lib/JoplinServerApi.js"
          },
          {
            "type": "context",
            "line": " ReactNativeClient/PluginAssetsLoader.js"
          },
          {
            "type": "context",
            "line": " ReactNativeClient/lib/joplin-renderer/MdToHtml/rules/mermaid.js"
          },
          {
            "type": "add",
            "line": "ReactNativeClient/lib/joplin-renderer/MdToHtml/rules/sanitize_html.js"
          }
        ]
      },
      {
        "file": ".gitignore",
        "changes": [
          {
            "type": "context",
            "line": "index 67cc93934..5b744d39d 100644"
          },
          {
            "type": "context",
            "line": "--- a/.gitignore"
          },
          {
            "type": "context",
            "line": "+++ b/.gitignore"
          },
          {
            "type": "context",
            "line": " ReactNativeClient/lib/JoplinServerApi.js"
          },
          {
            "type": "context",
            "line": " ReactNativeClient/PluginAssetsLoader.js"
          },
          {
            "type": "context",
            "line": " ReactNativeClient/lib/joplin-renderer/MdToHtml/rules/mermaid.js"
          },
          {
            "type": "add",
            "line": "ReactNativeClient/lib/joplin-renderer/MdToHtml/rules/sanitize_html.js"
          }
        ]
      },
      {
        "file": "CliClient/package-lock.json",
        "changes": [
          {
            "type": "context",
            "line": "index 0e93828c8..474741674 100644"
          },
          {
            "type": "context",
            "line": "--- a/CliClient/package-lock.json"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/package-lock.json"
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/mdurl/-/mdurl-1.0.1.tgz\","
          },
          {
            "type": "context",
            "line": "       \"integrity\": \"sha1-/oWy7HWlkDfyrf7BAP1sYBdhFS4=\""
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": {"
          },
          {
            "type": "add",
            "line": "      \"version\": \"0.2.0\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/memory-cache/-/memory-cache-0.2.0.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha1-eJCwHVLADI68nVM+H46xfjA0hxo=\""
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     \"micromatch\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"3.1.10\","
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/micromatch/-/micromatch-3.1.10.tgz\","
          },
          {
            "type": "context",
            "line": "         \"is-stream\": \"^1.0.1\""
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": {"
          },
          {
            "type": "add",
            "line": "      \"version\": \"1.2.4\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/node-html-parser/-/node-html-parser-1.2.4.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-qHwPdGyGr9pOZBoSgUOuNPG20QYZVN00lFcxKQgjPUODSxVH7obQeLVVawa3B4cfSNtLIeczSzoy/xYA8XG5WQ==\","
          },
          {
            "type": "add",
            "line": "      \"dev\": true,"
          },
          {
            "type": "add",
            "line": "      \"requires\": {"
          },
          {
            "type": "add",
            "line": "        \"he\": \"1.1.1\""
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     \"node-persist\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"2.1.0\","
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/node-persist/-/node-persist-2.1.0.tgz\","
          }
        ]
      },
      {
        "file": "CliClient/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index f3ecfa208..1d4da230e 100644"
          },
          {
            "type": "context",
            "line": "--- a/CliClient/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/package.json"
          },
          {
            "type": "context",
            "line": "     \"markdown-it-toc-done-right\": \"^4.1.0\","
          },
          {
            "type": "context",
            "line": "     \"md5\": \"^2.2.1\","
          },
          {
            "type": "context",
            "line": "     \"md5-file\": \"^4.0.0\","
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": \"^0.2.0\","
          },
          {
            "type": "context",
            "line": "     \"mime\": \"^2.0.3\","
          },
          {
            "type": "context",
            "line": "     \"moment\": \"^2.24.0\","
          },
          {
            "type": "context",
            "line": "     \"multiparty\": \"^4.2.1\","
          },
          {
            "type": "context",
            "line": "     \"valid-url\": \"^1.0.9\","
          },
          {
            "type": "context",
            "line": "     \"word-wrap\": \"^1.2.3\","
          },
          {
            "type": "context",
            "line": "     \"xml2js\": \"^0.4.19\","
          },
          {
            "type": "delete",
            "line": "    \"yargs-parser\": \"^7.0.0\""
          },
          {
            "type": "add",
            "line": "    \"yargs-parser\": \"^7.0.0\","
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": \"^1.2.4\""
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   \"devDependencies\": {"
          },
          {
            "type": "context",
            "line": "     \"jasmine\": \"^3.5.0\""
          }
        ]
      },
      {
        "file": "CliClient/tests/HtmlToHtml.js",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..da614190a"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/tests/HtmlToHtml.js"
          },
          {
            "type": "add",
            "line": "/* eslint-disable no-unused-vars */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "require('app-module-path').addPath(__dirname);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "const os = require('os');"
          },
          {
            "type": "add",
            "line": "const { time } = require('lib/time-utils.js');"
          },
          {
            "type": "add",
            "line": "const { filename } = require('lib/path-utils.js');"
          },
          {
            "type": "add",
            "line": "const { asyncTest, fileContentEqual, setupDatabase, setupDatabaseAndSynchronizer, db, synchronizer, fileApi, sleep, clearDatabase, switchClient, syncTargetId, objectsEqual, checkThrowAsync } = require('test-utils.js');"
          },
          {
            "type": "add",
            "line": "const Folder = require('lib/models/Folder.js');"
          },
          {
            "type": "add",
            "line": "const Note = require('lib/models/Note.js');"
          },
          {
            "type": "add",
            "line": "const BaseModel = require('lib/BaseModel.js');"
          },
          {
            "type": "add",
            "line": "const { shim } = require('lib/shim');"
          },
          {
            "type": "add",
            "line": "const HtmlToHtml = require('lib/joplin-renderer/HtmlToHtml');"
          },
          {
            "type": "add",
            "line": "const { enexXmlToMd } = require('lib/import-enex-md-gen.js');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "jasmine.DEFAULT_TIMEOUT_INTERVAL = 60 * 60 * 1000; // Can run for a while since everything is in the same test unit"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "process.on('unhandledRejection', (reason, p) => {"
          },
          {
            "type": "add",
            "line": "\tconsole.log('Unhandled Rejection at: Promise', p, 'reason:', reason);"
          },
          {
            "type": "add",
            "line": "});"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "describe('HtmlToHtml', function() {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbeforeEach(async (done) => {"
          },
          {
            "type": "add",
            "line": "\t\tawait setupDatabaseAndSynchronizer(1);"
          },
          {
            "type": "add",
            "line": "\t\tawait switchClient(1);"
          },
          {
            "type": "add",
            "line": "\t\tdone();"
          },
          {
            "type": "add",
            "line": "\t});"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tit('should convert from Html to Html', asyncTest(async () => {"
          },
          {
            "type": "add",
            "line": "\t\tconst basePath = `${__dirname}/html_to_html`;"
          },
          {
            "type": "add",
            "line": "\t\tconst files = await shim.fsDriver().readDirStats(basePath);"
          },
          {
            "type": "add",
            "line": "\t\tconst htmlToHtml = new HtmlToHtml();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tfor (let i = 0; i < files.length; i++) {"
          },
          {
            "type": "add",
            "line": "\t\t\tconst htmlSourceFilename = files[i].path;"
          },
          {
            "type": "add",
            "line": "\t\t\tif (htmlSourceFilename.indexOf('.src.html') < 0) continue;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst htmlSourceFilePath = `${basePath}/${htmlSourceFilename}`;"
          },
          {
            "type": "add",
            "line": "\t\t\tconst htmlDestPath = `${basePath}/${filename(filename(htmlSourceFilePath))}.dest.html`;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t// if (htmlSourceFilename !== 'table_with_header.html') continue;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst htmlToHtmlOptions = {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tbodyOnly: true,"
          },
          {
            "type": "add",
            "line": "\t\t\t};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst sourceHtml = await shim.fsDriver().readFile(htmlSourceFilePath);"
          },
          {
            "type": "add",
            "line": "\t\t\tlet expectedHtml = await shim.fsDriver().readFile(htmlDestPath);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst result = await htmlToHtml.render(sourceHtml, null, htmlToHtmlOptions);"
          },
          {
            "type": "add",
            "line": "\t\t\tlet actualHtml = result.html;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tif (os.EOL === '\\r\\n') {"
          },
          {
            "type": "add",
            "line": "\t\t\t\texpectedHtml = expectedHtml.replace(/\\r\\n/g, '\\n');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tactualHtml = actualHtml.replace(/\\r\\n/g, '\\n');"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tif (actualHtml !== expectedHtml) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(`Error converting file: ${htmlSourceFilename}`);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------- Got:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(actualHtml);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------- Raw:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(actualHtml.split('\\n'));"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------- Expected:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(expectedHtml.split('\\n'));"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------------------');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\texpect(false).toBe(true);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t// return;"
          },
          {
            "type": "add",
            "line": "\t\t\t} else {"
          },
          {
            "type": "add",
            "line": "\t\t\t\texpect(true).toBe(true);"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "});"
          }
        ]
      },
      {
        "file": "CliClient/tests/MdToHtml.js",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..e53ea4917"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/tests/MdToHtml.js"
          },
          {
            "type": "add",
            "line": "/* eslint-disable no-unused-vars */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "require('app-module-path').addPath(__dirname);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "const os = require('os');"
          },
          {
            "type": "add",
            "line": "const { time } = require('lib/time-utils.js');"
          },
          {
            "type": "add",
            "line": "const { filename } = require('lib/path-utils.js');"
          },
          {
            "type": "add",
            "line": "const { asyncTest, fileContentEqual, setupDatabase, setupDatabaseAndSynchronizer, db, synchronizer, fileApi, sleep, clearDatabase, switchClient, syncTargetId, objectsEqual, checkThrowAsync } = require('test-utils.js');"
          },
          {
            "type": "add",
            "line": "const Folder = require('lib/models/Folder.js');"
          },
          {
            "type": "add",
            "line": "const Note = require('lib/models/Note.js');"
          },
          {
            "type": "add",
            "line": "const BaseModel = require('lib/BaseModel.js');"
          },
          {
            "type": "add",
            "line": "const { shim } = require('lib/shim');"
          },
          {
            "type": "add",
            "line": "const MdToHtml = require('lib/joplin-renderer/MdToHtml');"
          },
          {
            "type": "add",
            "line": "const { enexXmlToMd } = require('lib/import-enex-md-gen.js');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "jasmine.DEFAULT_TIMEOUT_INTERVAL = 60 * 60 * 1000; // Can run for a while since everything is in the same test unit"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "process.on('unhandledRejection', (reason, p) => {"
          },
          {
            "type": "add",
            "line": "\tconsole.log('Unhandled Rejection at: Promise', p, 'reason:', reason);"
          },
          {
            "type": "add",
            "line": "});"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "describe('MdToHtml', function() {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tbeforeEach(async (done) => {"
          },
          {
            "type": "add",
            "line": "\t\tawait setupDatabaseAndSynchronizer(1);"
          },
          {
            "type": "add",
            "line": "\t\tawait switchClient(1);"
          },
          {
            "type": "add",
            "line": "\t\tdone();"
          },
          {
            "type": "add",
            "line": "\t});"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tit('should convert from Markdown to Html', asyncTest(async () => {"
          },
          {
            "type": "add",
            "line": "\t\tconst basePath = `${__dirname}/md_to_html`;"
          },
          {
            "type": "add",
            "line": "\t\tconst files = await shim.fsDriver().readDirStats(basePath);"
          },
          {
            "type": "add",
            "line": "\t\tconst mdToHtml = new MdToHtml();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tfor (let i = 0; i < files.length; i++) {"
          },
          {
            "type": "add",
            "line": "\t\t\tconst mdFilename = files[i].path;"
          },
          {
            "type": "add",
            "line": "\t\t\tif (mdFilename.indexOf('.md') < 0) continue;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst mdFilePath = `${basePath}/${mdFilename}`;"
          },
          {
            "type": "add",
            "line": "\t\t\tconst htmlPath = `${basePath}/${filename(mdFilePath)}.html`;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t// if (mdFilename !== 'table_with_header.html') continue;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst mdToHtmlOptions = {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tbodyOnly: true,"
          },
          {
            "type": "add",
            "line": "\t\t\t};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst markdown = await shim.fsDriver().readFile(mdFilePath);"
          },
          {
            "type": "add",
            "line": "\t\t\tlet expectedHtml = await shim.fsDriver().readFile(htmlPath);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tconst result = await mdToHtml.render(markdown, null, mdToHtmlOptions);"
          },
          {
            "type": "add",
            "line": "\t\t\tlet actualHtml = result.html;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tif (os.EOL === '\\r\\n') {"
          },
          {
            "type": "add",
            "line": "\t\t\t\texpectedHtml = expectedHtml.replace(/\\r\\n/g, '\\n');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tactualHtml = actualHtml.replace(/\\r\\n/g, '\\n');"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tif (actualHtml !== expectedHtml) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(`Error converting file: ${mdFilename}`);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------- Got:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(actualHtml);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------- Raw:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(actualHtml.split('\\n'));"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------- Expected:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info(expectedHtml.split('\\n'));"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('--------------------------------------------');"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconsole.info('');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\texpect(false).toBe(true);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t// return;"
          },
          {
            "type": "add",
            "line": "\t\t\t} else {"
          },
          {
            "type": "add",
            "line": "\t\t\t\texpect(true).toBe(true);"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "});"
          }
        ]
      },
      {
        "file": "CliClient/tests/html_to_html/sanitize.dest.html",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..b0f104132"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/tests/html_to_html/sanitize.dest.html"
          },
          {
            "type": "add",
            "line": "<img src onerror=\"\" />"
          },
          {
            "type": "add",
            "line": "<img src onerror=\"\" />"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "CliClient/tests/html_to_html/sanitize.src.html",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..7c16698dd"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/tests/html_to_html/sanitize.src.html"
          },
          {
            "type": "add",
            "line": "<img src=\"\" onerror=\"alert('ohno')\"/>"
          },
          {
            "type": "add",
            "line": "<img src=\"\""
          },
          {
            "type": "add",
            "line": "   onerror=\"alert('ohno')\"/>"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "CliClient/tests/md_to_html/sanitize.html",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..b0f104132"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/tests/md_to_html/sanitize.html"
          },
          {
            "type": "add",
            "line": "<img src onerror=\"\" />"
          },
          {
            "type": "add",
            "line": "<img src onerror=\"\" />"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "CliClient/tests/md_to_html/sanitize.md",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..7c16698dd"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/CliClient/tests/md_to_html/sanitize.md"
          },
          {
            "type": "add",
            "line": "<img src=\"\" onerror=\"alert('ohno')\"/>"
          },
          {
            "type": "add",
            "line": "<img src=\"\""
          },
          {
            "type": "add",
            "line": "   onerror=\"alert('ohno')\"/>"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "Clipper/joplin-webclipper/content_scripts/index.js",
        "changes": [
          {
            "type": "context",
            "line": "index 772105a61..7852ca66d 100644"
          },
          {
            "type": "context",
            "line": "--- a/Clipper/joplin-webclipper/content_scripts/index.js"
          },
          {
            "type": "context",
            "line": "+++ b/Clipper/joplin-webclipper/content_scripts/index.js"
          },
          {
            "type": "context",
            "line": " \tfunction absoluteUrl(url) {"
          },
          {
            "type": "context",
            "line": " \t\tif (!url) return url;"
          },
          {
            "type": "context",
            "line": " \t\tconst protocol = url.toLowerCase().split(':')[0];"
          },
          {
            "type": "delete",
            "line": "\t\tif (['http', 'https', 'file'].indexOf(protocol) >= 0) return url;"
          },
          {
            "type": "add",
            "line": "\t\tif (['http', 'https', 'file', 'data'].indexOf(protocol) >= 0) return url;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (url.indexOf('//') === 0) {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn location.protocol + url;"
          }
        ]
      },
      {
        "file": "ElectronClient/app/package-lock.json",
        "changes": [
          {
            "type": "context",
            "line": "index 77e1c284a..cc833ecca 100644"
          },
          {
            "type": "context",
            "line": "--- a/ElectronClient/app/package-lock.json"
          },
          {
            "type": "context",
            "line": "+++ b/ElectronClient/app/package-lock.json"
          },
          {
            "type": "context",
            "line": "         \"minimist\": \"^1.1.1\""
          },
          {
            "type": "context",
            "line": "       },"
          },
          {
            "type": "context",
            "line": "       \"dependencies\": {"
          },
          {
            "type": "add",
            "line": "        \"domelementtype\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"1.3.1\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/domelementtype/-/domelementtype-1.3.1.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-BSKB+TSpMpFI/HOxCNr1O8aMOTZ8hT3pM3GQ0w/mWRmkhEDSFJkkyzz4XQsBV44BChwGkrDfMyjVD0eA2aFV3w==\""
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        \"domhandler\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"2.4.2\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/domhandler/-/domhandler-2.4.2.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-JiK04h0Ht5u/80fdLMCEmV4zkNh2BcoMFBmZ/91WtYZ8qVXSKjiw7fXMgFPnHcSZgOo3XdinHvmnDUeMf5R4wA==\","
          },
          {
            "type": "add",
            "line": "          \"requires\": {"
          },
          {
            "type": "add",
            "line": "            \"domelementtype\": \"1\""
          },
          {
            "type": "add",
            "line": "          }"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        \"domutils\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"1.7.0\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/domutils/-/domutils-1.7.0.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-Lgd2XcJ/NjEw+7tFvfKxOzCYKZsdct5lczQ2ZaQY8Djz7pfAD3Gbp8ySJWtreII/vDlMVmxwa6pHmdxIYgttDg==\","
          },
          {
            "type": "add",
            "line": "          \"requires\": {"
          },
          {
            "type": "add",
            "line": "            \"dom-serializer\": \"0\","
          },
          {
            "type": "add",
            "line": "            \"domelementtype\": \"1\""
          },
          {
            "type": "add",
            "line": "          }"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        \"htmlparser2\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"3.10.1\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/htmlparser2/-/htmlparser2-3.10.1.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-IgieNijUMbkDovyoKObU1DUhm1iwNYE/fuifEoEHfd1oZKZDaONBSkal7Y01shxsM49R4XaMdGez3WnF9UfiCQ==\","
          },
          {
            "type": "add",
            "line": "          \"requires\": {"
          },
          {
            "type": "add",
            "line": "            \"domelementtype\": \"^1.3.1\","
          },
          {
            "type": "add",
            "line": "            \"domhandler\": \"^2.3.0\","
          },
          {
            "type": "add",
            "line": "            \"domutils\": \"^1.5.1\","
          },
          {
            "type": "add",
            "line": "            \"entities\": \"^1.1.1\","
          },
          {
            "type": "add",
            "line": "            \"inherits\": \"^2.0.1\","
          },
          {
            "type": "add",
            "line": "            \"readable-stream\": \"^3.1.1\""
          },
          {
            "type": "add",
            "line": "          }"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "context",
            "line": "         \"minimist\": {"
          },
          {
            "type": "context",
            "line": "           \"version\": \"1.2.0\","
          },
          {
            "type": "context",
            "line": "           \"resolved\": \"https://registry.npmjs.org/minimist/-/minimist-1.2.0.tgz\","
          },
          {
            "type": "context",
            "line": "           \"integrity\": \"sha1-o1AIsg9BOD7sH7kU9M1d95omQoQ=\""
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        \"readable-stream\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"3.6.0\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/readable-stream/-/readable-stream-3.6.0.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-BViHy7LKeTz4oNnkcLJ+lVSL6vpiFeX6/d3oSH8zCW7UxP2onchk+vTGB143xuFjHS3deTgkKoXXymXqymiIdA==\","
          },
          {
            "type": "add",
            "line": "          \"requires\": {"
          },
          {
            "type": "add",
            "line": "            \"inherits\": \"^2.0.3\","
          },
          {
            "type": "add",
            "line": "            \"string_decoder\": \"^1.1.1\","
          },
          {
            "type": "add",
            "line": "            \"util-deprecate\": \"^1.0.1\""
          },
          {
            "type": "add",
            "line": "          }"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        \"safe-buffer\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"5.2.0\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.0.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-fZEwUGbVl7kouZs1jCdMLdt95hdIv0ZeHg6L7qPeciMZhZ+/gdesW4wgTARkrFWEpspjEATAzUGPG8N2jJiwbg==\""
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        \"string_decoder\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"1.3.0\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==\","
          },
          {
            "type": "add",
            "line": "          \"requires\": {"
          },
          {
            "type": "add",
            "line": "            \"safe-buffer\": \"~5.2.0\""
          },
          {
            "type": "add",
            "line": "          }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"dom-serializer\": {"
          },
          {
            "type": "delete",
            "line": "      \"version\": \"0.2.1\","
          },
          {
            "type": "delete",
            "line": "      \"resolved\": \"https://registry.npmjs.org/dom-serializer/-/dom-serializer-0.2.1.tgz\","
          },
          {
            "type": "delete",
            "line": "      \"integrity\": \"sha512-sK3ujri04WyjwQXVoK4PU3y8ula1stq10GJZpqHIUgoGZdsGzAGu65BnU3d08aTVSvO7mGPZUc0wTEDL+qGE0Q==\","
          },
          {
            "type": "add",
            "line": "      \"version\": \"0.2.2\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/dom-serializer/-/dom-serializer-0.2.2.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-2/xPb3ORsQ42nHYiSunXkDjPLBaEj/xTwUO4B7XCZQTRk7EBtTOPaygh10YAAh2OI1Qrp6NWfpAhzswj0ydt9g==\","
          },
          {
            "type": "context",
            "line": "       \"requires\": {"
          },
          {
            "type": "context",
            "line": "         \"domelementtype\": \"^2.0.1\","
          },
          {
            "type": "context",
            "line": "         \"entities\": \"^2.0.0\""
          },
          {
            "type": "context",
            "line": "       },"
          },
          {
            "type": "context",
            "line": "       \"dependencies\": {"
          },
          {
            "type": "delete",
            "line": "        \"domelementtype\": {"
          },
          {
            "type": "delete",
            "line": "          \"version\": \"2.0.1\","
          },
          {
            "type": "delete",
            "line": "          \"resolved\": \"https://registry.npmjs.org/domelementtype/-/domelementtype-2.0.1.tgz\","
          },
          {
            "type": "delete",
            "line": "          \"integrity\": \"sha512-5HOHUDsYZWV8FGWN0Njbr/Rn7f/eWSQi1v7+HsUVwXgn8nWWlL64zKDkS0n8ZmQ3mlWOMuXOnR+7Nx/5tMO5AQ==\""
          },
          {
            "type": "delete",
            "line": "        },"
          },
          {
            "type": "context",
            "line": "         \"entities\": {"
          },
          {
            "type": "context",
            "line": "           \"version\": \"2.0.0\","
          },
          {
            "type": "context",
            "line": "           \"resolved\": \"https://registry.npmjs.org/entities/-/entities-2.0.0.tgz\","
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"domelementtype\": {"
          },
          {
            "type": "delete",
            "line": "      \"version\": \"1.3.1\","
          },
          {
            "type": "delete",
            "line": "      \"resolved\": \"https://registry.npmjs.org/domelementtype/-/domelementtype-1.3.1.tgz\","
          },
          {
            "type": "delete",
            "line": "      \"integrity\": \"sha512-BSKB+TSpMpFI/HOxCNr1O8aMOTZ8hT3pM3GQ0w/mWRmkhEDSFJkkyzz4XQsBV44BChwGkrDfMyjVD0eA2aFV3w==\""
          },
          {
            "type": "add",
            "line": "      \"version\": \"2.0.1\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/domelementtype/-/domelementtype-2.0.1.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-5HOHUDsYZWV8FGWN0Njbr/Rn7f/eWSQi1v7+HsUVwXgn8nWWlL64zKDkS0n8ZmQ3mlWOMuXOnR+7Nx/5tMO5AQ==\""
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"domexception\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"1.0.1\","
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"domhandler\": {"
          },
          {
            "type": "delete",
            "line": "      \"version\": \"2.4.2\","
          },
          {
            "type": "delete",
            "line": "      \"resolved\": \"https://registry.npmjs.org/domhandler/-/domhandler-2.4.2.tgz\","
          },
          {
            "type": "delete",
            "line": "      \"integrity\": \"sha512-JiK04h0Ht5u/80fdLMCEmV4zkNh2BcoMFBmZ/91WtYZ8qVXSKjiw7fXMgFPnHcSZgOo3XdinHvmnDUeMf5R4wA==\","
          },
          {
            "type": "add",
            "line": "      \"version\": \"3.0.0\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/domhandler/-/domhandler-3.0.0.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-eKLdI5v9m67kbXQbJSNn1zjh0SDzvzWVWtX+qEI3eMjZw8daH9k8rlj1FZY9memPwjiskQFbe7vHVVJIAqoEhw==\","
          },
          {
            "type": "context",
            "line": "       \"requires\": {"
          },
          {
            "type": "delete",
            "line": "        \"domelementtype\": \"1\""
          },
          {
            "type": "add",
            "line": "        \"domelementtype\": \"^2.0.1\""
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"domutils\": {"
          },
          {
            "type": "delete",
            "line": "      \"version\": \"1.7.0\","
          },
          {
            "type": "delete",
            "line": "      \"resolved\": \"https://registry.npmjs.org/domutils/-/domutils-1.7.0.tgz\","
          },
          {
            "type": "delete",
            "line": "      \"integrity\": \"sha512-Lgd2XcJ/NjEw+7tFvfKxOzCYKZsdct5lczQ2ZaQY8Djz7pfAD3Gbp8ySJWtreII/vDlMVmxwa6pHmdxIYgttDg==\","
          },
          {
            "type": "add",
            "line": "      \"version\": \"2.0.0\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/domutils/-/domutils-2.0.0.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-n5SelJ1axbO636c2yUtOGia/IcJtVtlhQbFiVDBZHKV5ReJO1ViX7sFEemtuyoAnBxk5meNSYgA8V4s0271efg==\","
          },
          {
            "type": "context",
            "line": "       \"requires\": {"
          },
          {
            "type": "delete",
            "line": "        \"dom-serializer\": \"0\","
          },
          {
            "type": "delete",
            "line": "        \"domelementtype\": \"1\""
          },
          {
            "type": "add",
            "line": "        \"dom-serializer\": \"^0.2.1\","
          },
          {
            "type": "add",
            "line": "        \"domelementtype\": \"^2.0.1\","
          },
          {
            "type": "add",
            "line": "        \"domhandler\": \"^3.0.0\""
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"dot-prop\": {"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "     \"htmlparser2\": {"
          },
          {
            "type": "delete",
            "line": "      \"version\": \"3.10.1\","
          },
          {
            "type": "delete",
            "line": "      \"resolved\": \"https://registry.npmjs.org/htmlparser2/-/htmlparser2-3.10.1.tgz\","
          },
          {
            "type": "delete",
            "line": "      \"integrity\": \"sha512-IgieNijUMbkDovyoKObU1DUhm1iwNYE/fuifEoEHfd1oZKZDaONBSkal7Y01shxsM49R4XaMdGez3WnF9UfiCQ==\","
          },
          {
            "type": "delete",
            "line": "      \"requires\": {"
          },
          {
            "type": "delete",
            "line": "        \"domelementtype\": \"^1.3.1\","
          },
          {
            "type": "delete",
            "line": "        \"domhandler\": \"^2.3.0\","
          },
          {
            "type": "delete",
            "line": "        \"domutils\": \"^1.5.1\","
          },
          {
            "type": "delete",
            "line": "        \"entities\": \"^1.1.1\","
          },
          {
            "type": "delete",
            "line": "        \"inherits\": \"^2.0.1\","
          },
          {
            "type": "delete",
            "line": "        \"readable-stream\": \"^3.1.1\""
          },
          {
            "type": "add",
            "line": "      \"version\": \"4.0.0\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/htmlparser2/-/htmlparser2-4.0.0.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-cChwXn5Vam57fyXajDtPXL1wTYc8JtLbr2TN76FYu05itVVVealxLowe2B3IEznJG4p9HAYn/0tJaRlGuEglFQ==\","
          },
          {
            "type": "add",
            "line": "      \"requires\": {"
          },
          {
            "type": "add",
            "line": "        \"domelementtype\": \"^2.0.1\","
          },
          {
            "type": "add",
            "line": "        \"domhandler\": \"^3.0.0\","
          },
          {
            "type": "add",
            "line": "        \"domutils\": \"^2.0.0\","
          },
          {
            "type": "add",
            "line": "        \"entities\": \"^2.0.0\""
          },
          {
            "type": "context",
            "line": "       },"
          },
          {
            "type": "context",
            "line": "       \"dependencies\": {"
          },
          {
            "type": "delete",
            "line": "        \"readable-stream\": {"
          },
          {
            "type": "delete",
            "line": "          \"version\": \"3.4.0\","
          },
          {
            "type": "delete",
            "line": "          \"resolved\": \"https://registry.npmjs.org/readable-stream/-/readable-stream-3.4.0.tgz\","
          },
          {
            "type": "delete",
            "line": "          \"integrity\": \"sha512-jItXPLmrSR8jmTRmRWJXCnGJsfy85mB3Wd/uINMXA65yrnFo0cPClFIUWzo2najVNSl+mx7/4W8ttlLWJe99pQ==\","
          },
          {
            "type": "delete",
            "line": "          \"requires\": {"
          },
          {
            "type": "delete",
            "line": "            \"inherits\": \"^2.0.3\","
          },
          {
            "type": "delete",
            "line": "            \"string_decoder\": \"^1.1.1\","
          },
          {
            "type": "delete",
            "line": "            \"util-deprecate\": \"^1.0.1\""
          },
          {
            "type": "delete",
            "line": "          }"
          },
          {
            "type": "delete",
            "line": "        },"
          },
          {
            "type": "delete",
            "line": "        \"safe-buffer\": {"
          },
          {
            "type": "delete",
            "line": "          \"version\": \"5.2.0\","
          },
          {
            "type": "delete",
            "line": "          \"resolved\": \"https://registry.npmjs.org/safe-buffer/-/safe-buffer-5.2.0.tgz\","
          },
          {
            "type": "delete",
            "line": "          \"integrity\": \"sha512-fZEwUGbVl7kouZs1jCdMLdt95hdIv0ZeHg6L7qPeciMZhZ+/gdesW4wgTARkrFWEpspjEATAzUGPG8N2jJiwbg==\""
          },
          {
            "type": "delete",
            "line": "        },"
          },
          {
            "type": "delete",
            "line": "        \"string_decoder\": {"
          },
          {
            "type": "delete",
            "line": "          \"version\": \"1.3.0\","
          },
          {
            "type": "delete",
            "line": "          \"resolved\": \"https://registry.npmjs.org/string_decoder/-/string_decoder-1.3.0.tgz\","
          },
          {
            "type": "delete",
            "line": "          \"integrity\": \"sha512-hkRX8U1WjJFd8LsDJ2yQ/wWWxaopEsABU1XfkM8A+j0+85JAGppt16cr1Whg6KIbb4okU6Mql6BOj+uup/wKeA==\","
          },
          {
            "type": "delete",
            "line": "          \"requires\": {"
          },
          {
            "type": "delete",
            "line": "            \"safe-buffer\": \"~5.2.0\""
          },
          {
            "type": "delete",
            "line": "          }"
          },
          {
            "type": "add",
            "line": "        \"entities\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"2.0.0\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/entities/-/entities-2.0.0.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha512-D9f7V0JSRwIxlRI2mjMqufDrRDnx8p+eEOz7aUM9SuvF8gsBzra0/6tbjl1m8eQHrZlYj6PxqE00hZ1SAIKPLw==\""
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/memoize-one/-/memoize-one-5.0.4.tgz\","
          },
          {
            "type": "context",
            "line": "       \"integrity\": \"sha512-P0z5IeAH6qHHGkJIXWw0xC2HNEgkx/9uWWBQw64FJj3/ol14VYdfVGWWr0fXfjhhv3TKVIqUq65os6O4GUNksA==\""
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": {"
          },
          {
            "type": "add",
            "line": "      \"version\": \"0.2.0\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/memory-cache/-/memory-cache-0.2.0.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha1-eJCwHVLADI68nVM+H46xfjA0hxo=\""
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     \"mermaid\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"8.4.6\","
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/mermaid/-/mermaid-8.4.6.tgz\","
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": {"
          },
          {
            "type": "add",
            "line": "      \"version\": \"1.2.4\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/node-html-parser/-/node-html-parser-1.2.4.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-qHwPdGyGr9pOZBoSgUOuNPG20QYZVN00lFcxKQgjPUODSxVH7obQeLVVawa3B4cfSNtLIeczSzoy/xYA8XG5WQ==\","
          },
          {
            "type": "add",
            "line": "      \"requires\": {"
          },
          {
            "type": "add",
            "line": "        \"he\": \"1.1.1\""
          },
          {
            "type": "add",
            "line": "      },"
          },
          {
            "type": "add",
            "line": "      \"dependencies\": {"
          },
          {
            "type": "add",
            "line": "        \"he\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"1.1.1\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/he/-/he-1.1.1.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha1-k0EP0hsAlzUVH4howvJx80J+I/0=\""
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     \"node-notifier\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"6.0.0\","
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/node-notifier/-/node-notifier-6.0.0.tgz\","
          }
        ]
      },
      {
        "file": "ElectronClient/app/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index 323c30050..c2e1c6bfe 100644"
          },
          {
            "type": "context",
            "line": "--- a/ElectronClient/app/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/ElectronClient/app/package.json"
          },
          {
            "type": "context",
            "line": "     \"markdown-it-toc-done-right\": \"^4.1.0\","
          },
          {
            "type": "context",
            "line": "     \"md5\": \"^2.2.1\","
          },
          {
            "type": "context",
            "line": "     \"md5-file\": \"^4.0.0\","
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": \"^0.2.0\","
          },
          {
            "type": "context",
            "line": "     \"mermaid\": \"^8.4.6\","
          },
          {
            "type": "context",
            "line": "     \"moment\": \"^2.22.2\","
          },
          {
            "type": "context",
            "line": "     \"multiparty\": \"^4.2.1\","
          },
          {
            "type": "context",
            "line": "     \"mustache\": \"^3.0.1\","
          },
          {
            "type": "context",
            "line": "     \"node-fetch\": \"^1.7.3\","
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": \"^1.2.4\","
          },
          {
            "type": "context",
            "line": "     \"node-notifier\": \"^6.0.0\","
          },
          {
            "type": "context",
            "line": "     \"promise\": \"^8.0.1\","
          },
          {
            "type": "context",
            "line": "     \"query-string\": \"^5.1.1\","
          }
        ]
      },
      {
        "file": "ElectronClient/build.sh",
        "changes": [
          {
            "type": "context",
            "line": "index 76193518f..f39c91926 100755"
          },
          {
            "type": "context",
            "line": "--- a/ElectronClient/build.sh"
          },
          {
            "type": "context",
            "line": "+++ b/ElectronClient/build.sh"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " rsync -a --delete \"$ROOT_DIR/../ReactNativeClient/lib/\" \"$BUILD_DIR/lib/\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "cd \"$ROOT_DIR/..\""
          },
          {
            "type": "delete",
            "line": "npm run tsc"
          },
          {
            "type": "add",
            "line": "# cd \"$ROOT_DIR/..\""
          },
          {
            "type": "add",
            "line": "# npm run tsc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " cd \"$BUILD_DIR\""
          },
          {
            "type": "context",
            "line": " npm run compile"
          }
        ]
      },
      {
        "file": "ReactNativeClient/liBaseApplication.js",
        "changes": [
          {
            "type": "context",
            "line": "index 1ae4a52f0..32d40074e 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/BaseApplication.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/BaseApplication.js"
          },
          {
            "type": "context",
            "line": " \t\treturn `${os.homedir()}/.config/${Setting.value('appName')}`;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tasync testing() {"
          },
          {
            "type": "delete",
            "line": "\t\tconst markdownUtils = require('lib/markdownUtils');"
          },
          {
            "type": "delete",
            "line": "\t\tconst ClipperServer = require('lib/ClipperServer');"
          },
          {
            "type": "delete",
            "line": "\t\tconst server = new ClipperServer();"
          },
          {
            "type": "delete",
            "line": "\t\tconst HtmlToMd = require('lib/HtmlToMd');"
          },
          {
            "type": "delete",
            "line": "\t\tconst service = new HtmlToMd();"
          },
          {
            "type": "delete",
            "line": "\t\tconst html = await shim.fsDriver().readFile('/mnt/d/test.html');"
          },
          {
            "type": "delete",
            "line": "\t\tlet markdown = service.parse(html, { baseUrl: 'https://duckduckgo.com/' });"
          },
          {
            "type": "delete",
            "line": "\t\tconsole.info(markdown);"
          },
          {
            "type": "delete",
            "line": "\t\tconsole.info('--------------------------------------------------');"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tconst imageUrls = markdownUtils.extractImageUrls(markdown);"
          },
          {
            "type": "delete",
            "line": "\t\tlet result = await server.downloadImages_(imageUrls);"
          },
          {
            "type": "delete",
            "line": "\t\tresult = await server.createResourcesFromPaths_(result);"
          },
          {
            "type": "delete",
            "line": "\t\tconsole.info(result);"
          },
          {
            "type": "delete",
            "line": "\t\tmarkdown = server.replaceImageUrlsByResources_(markdown, result);"
          },
          {
            "type": "delete",
            "line": "\t\tconsole.info('--------------------------------------------------');"
          },
          {
            "type": "delete",
            "line": "\t\tconsole.info(markdown);"
          },
          {
            "type": "delete",
            "line": "\t\tconsole.info('--------------------------------------------------');"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tasync start(argv) {"
          },
          {
            "type": "context",
            "line": " \t\tlet startFlags = await this.handleStartFlags_(argv);"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "ReactNativeClient/lijoplin-renderer/HtmlToHtml.js",
        "changes": [
          {
            "type": "context",
            "line": "index 0a929c4ec..0afb76b18 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/joplin-renderer/HtmlToHtml.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/HtmlToHtml.js"
          },
          {
            "type": "context",
            "line": " const htmlUtils = require('./htmlUtils');"
          },
          {
            "type": "context",
            "line": " const utils = require('./utils');"
          },
          {
            "type": "context",
            "line": " const noteStyle = require('./noteStyle');"
          },
          {
            "type": "add",
            "line": "const memoryCache = require('memory-cache');"
          },
          {
            "type": "add",
            "line": "const md5 = require('md5');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class HtmlToHtml {"
          },
          {
            "type": "context",
            "line": " \tconstructor(options) {"
          },
          {
            "type": "context",
            "line": " \t\tif (!options) options = {};"
          },
          {
            "type": "context",
            "line": " \t\tthis.resourceBaseUrl_ = 'resourceBaseUrl' in options ? options.resourceBaseUrl : null;"
          },
          {
            "type": "context",
            "line": " \t\tthis.ResourceModel_ = options.ResourceModel;"
          },
          {
            "type": "add",
            "line": "\t\tthis.cache_ = new memoryCache.Cache();"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\trender(markup, theme, options) {"
          },
          {
            "type": "delete",
            "line": "\t\tconst html = htmlUtils.processImageTags(markup, data => {"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (!data.src) return null;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tconst r = utils.imageReplacement(this.ResourceModel_, data.src, options.resources, this.resourceBaseUrl_);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (!r) return null;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\tif (typeof r === 'string') {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\ttype: 'replaceElement',"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\thtml: r,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t};"
          },
          {
            "type": "delete",
            "line": "\t\t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\treturn {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\ttype: 'setAttributes',"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tattrs: r,"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t};"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t});"
          },
          {
            "type": "add",
            "line": "\tasync render(markup, theme, options) {"
          },
          {
            "type": "add",
            "line": "\t\tconst cacheKey = md5(escape(markup));"
          },
          {
            "type": "add",
            "line": "\t\tlet html = this.cache_.get(cacheKey);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif (!html) {"
          },
          {
            "type": "add",
            "line": "\t\t\thtml = htmlUtils.sanitizeHtml(markup);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\thtml = htmlUtils.processImageTags(html, data => {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (!data.src) return null;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\tconst r = utils.imageReplacement(this.ResourceModel_, data.src, options.resources, this.resourceBaseUrl_);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (!r) return null;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (typeof r === 'string') {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\treturn {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\ttype: 'replaceElement',"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\thtml: r,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t};"
          },
          {
            "type": "add",
            "line": "\t\t\t\t} else {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\treturn {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\ttype: 'setAttributes',"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t\tattrs: r,"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t};"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t});"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif (options.bodyOnly) return {"
          },
          {
            "type": "add",
            "line": "\t\t\thtml: html,"
          },
          {
            "type": "add",
            "line": "\t\t\tpluginAssets: [],"
          },
          {
            "type": "add",
            "line": "\t\t};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tthis.cache_.put(cacheKey, html, 1000 * 60 * 10);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tconst cssStrings = noteStyle(theme, options);"
          },
          {
            "type": "context",
            "line": " \t\tconst styleHtml = `<style>${cssStrings.join('\\n')}</style>`;"
          }
        ]
      },
      {
        "file": "ReactNativeClient/lijoplin-renderer/MarkupToHtml.js",
        "changes": [
          {
            "type": "context",
            "line": "index 9b1f68c0c..8c186949c 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/joplin-renderer/MarkupToHtml.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/MarkupToHtml.js"
          },
          {
            "type": "context",
            "line": " \t\treturn '';"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\trender(markupLanguage, markup, theme, options) {"
          },
          {
            "type": "add",
            "line": "\tasync render(markupLanguage, markup, theme, options) {"
          },
          {
            "type": "context",
            "line": " \t\treturn this.renderer(markupLanguage).render(markup, theme, options);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "ReactNativeClient/lijoplin-renderer/MdToHtml.js",
        "changes": [
          {
            "type": "context",
            "line": "index 2f29dca3c..c0980c430 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/joplin-renderer/MdToHtml.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/MdToHtml.js"
          },
          {
            "type": "context",
            "line": " const md5 = require('md5');"
          },
          {
            "type": "context",
            "line": " const noteStyle = require('./noteStyle');"
          },
          {
            "type": "context",
            "line": " const { fileExtension } = require('./pathUtils');"
          },
          {
            "type": "add",
            "line": "const memoryCache = require('memory-cache');"
          },
          {
            "type": "context",
            "line": " const rules = {"
          },
          {
            "type": "context",
            "line": " \timage: require('./MdToHtml/rules/image'),"
          },
          {
            "type": "context",
            "line": " \tcheckbox: require('./MdToHtml/rules/checkbox'),"
          },
          {
            "type": "context",
            "line": " \tcode_inline: require('./MdToHtml/rules/code_inline'),"
          },
          {
            "type": "context",
            "line": " \tfountain: require('./MdToHtml/rules/fountain'),"
          },
          {
            "type": "context",
            "line": " \tmermaid: require('./MdToHtml/rules/mermaid').default,"
          },
          {
            "type": "add",
            "line": "\tsanitize_html: require('./MdToHtml/rules/sanitize_html').default,"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": " const setupLinkify = require('./MdToHtml/setupLinkify');"
          },
          {
            "type": "context",
            "line": " const hljs = require('highlight.js');"
          },
          {
            "type": "context",
            "line": " \t\tthis.cachedHighlightedCode_ = {};"
          },
          {
            "type": "context",
            "line": " \t\tthis.ResourceModel_ = options.ResourceModel;"
          },
          {
            "type": "context",
            "line": " \t\tthis.pluginOptions_ = options.pluginOptions ? options.pluginOptions : {};"
          },
          {
            "type": "add",
            "line": "\t\tthis.contextCache_ = new memoryCache.Cache();"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tpluginOptions(name) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tasync render(body, style = null, options = null) {"
          },
          {
            "type": "context",
            "line": " \t\tif (!options) options = {};"
          },
          {
            "type": "add",
            "line": "\t\tif (!('bodyOnly' in options)) options.bodyOnly = false;"
          },
          {
            "type": "context",
            "line": " \t\tif (!options.postMessageSyntax) options.postMessageSyntax = 'postMessage';"
          },
          {
            "type": "context",
            "line": " \t\tif (!options.paddingBottom) options.paddingBottom = '0';"
          },
          {
            "type": "context",
            "line": " \t\tif (!options.highlightedKeywords) options.highlightedKeywords = [];"
          },
          {
            "type": "context",
            "line": " \t\tconst context = {"
          },
          {
            "type": "context",
            "line": " \t\t\tcss: {},"
          },
          {
            "type": "context",
            "line": " \t\t\tpluginAssets: {},"
          },
          {
            "type": "add",
            "line": "\t\t\tcache: this.contextCache_,"
          },
          {
            "type": "context",
            "line": " \t\t};"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tconst ruleOptions = Object.assign({}, options, {"
          },
          {
            "type": "context",
            "line": " \t\tif (this.pluginEnabled('katex')) markdownIt.use(rules.katex(context, ruleOptions));"
          },
          {
            "type": "context",
            "line": " \t\tif (this.pluginEnabled('fountain')) markdownIt.use(rules.fountain(context, ruleOptions));"
          },
          {
            "type": "context",
            "line": " \t\tif (this.pluginEnabled('mermaid')) markdownIt.use(rules.mermaid(context, ruleOptions));"
          },
          {
            "type": "add",
            "line": "\t\tmarkdownIt.use(rules.sanitize_html(context, ruleOptions));"
          },
          {
            "type": "context",
            "line": " \t\tmarkdownIt.use(rules.highlight_keywords(context, ruleOptions));"
          },
          {
            "type": "context",
            "line": " \t\tmarkdownIt.use(rules.code_inline(context, ruleOptions));"
          },
          {
            "type": "context",
            "line": " \t\tmarkdownIt.use(markdownItAnchor, { slugify: uslugify });"
          }
        ]
      },
      {
        "file": "ReactNativeClient/lijoplin-renderer/MdToHtml/rules/sanitize_html.ts",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..2ecb46a81"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/MdToHtml/rules/sanitize_html.ts"
          },
          {
            "type": "add",
            "line": "const md5 = require('md5');"
          },
          {
            "type": "add",
            "line": "const htmlUtils = require('../../htmlUtils');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// @ts-ignore: Keep the function signature as-is despite unusued arguments"
          },
          {
            "type": "add",
            "line": "function installRule(markdownIt:any, mdOptions:any, ruleOptions:any, context:any) {"
          },
          {
            "type": "add",
            "line": "\tmarkdownIt.core.ruler.push('sanitize_html', (state:any) => {"
          },
          {
            "type": "add",
            "line": "\t\tconst tokens = state.tokens;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tconst walkHtmlTokens = (tokens:any[]) => {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!tokens || !tokens.length) return;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tfor (const token of tokens) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (!['html_block', 'html_inline'].includes(token.type)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\twalkHtmlTokens(token.children);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tcontinue;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\tconst cacheKey = md5(escape(token.content));"
          },
          {
            "type": "add",
            "line": "\t\t\t\tlet sanitizedContent = context.cache.get(cacheKey);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (!sanitizedContent) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tsanitizedContent = htmlUtils.sanitizeHtml(token.content);"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\ttoken.content = sanitizedContent;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\t\tcontext.cache.put(cacheKey, sanitizedContent, 1000 * 60 * 60);"
          },
          {
            "type": "add",
            "line": "\t\t\t\twalkHtmlTokens(token.children);"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\twalkHtmlTokens(tokens);"
          },
          {
            "type": "add",
            "line": "\t});"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "export default function(context:any, ruleOptions:any) {"
          },
          {
            "type": "add",
            "line": "\treturn function(md:any, mdOptions:any) {"
          },
          {
            "type": "add",
            "line": "\t\tinstallRule(md, mdOptions, ruleOptions, context);"
          },
          {
            "type": "add",
            "line": "\t};"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "ReactNativeClient/lijoplin-renderer/htmlUtils.js",
        "changes": [
          {
            "type": "context",
            "line": "index 2b775f819..dc78c4a96 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/joplin-renderer/htmlUtils.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/htmlUtils.js"
          },
          {
            "type": "context",
            "line": " const htmlentities = new Entities().encode;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // [\\s\\S] instead of . for multiline matching"
          },
          {
            "type": "add",
            "line": "const NodeHtmlParser = require('node-html-parser');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // https://stackoverflow.com/a/16119722/561309"
          },
          {
            "type": "context",
            "line": " const imageRegex = /<img([\\s\\S]*?)src=[\"']([\\s\\S]*?)[\"']([\\s\\S]*?)>/gi;"
          },
          {
            "type": "add",
            "line": "const JS_EVENT_NAMES = ['onabort', 'onafterprint', 'onbeforeprint', 'onbeforeunload', 'onblur', 'oncanplay', 'oncanplaythrough', 'onchange', 'onclick', 'oncontextmenu', 'oncopy', 'oncuechange', 'oncut', 'ondblclick', 'ondrag', 'ondragend', 'ondragenter', 'ondragleave', 'ondragover', 'ondragstart', 'ondrop', 'ondurationchange', 'onemptied', 'onended', 'onerror', 'onfocus', 'onhashchange', 'oninput', 'oninvalid', 'onkeydown', 'onkeypress', 'onkeyup', 'onload', 'onloadeddata', 'onloadedmetadata', 'onloadstart', 'onmessage', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onmousewheel', 'onoffline', 'ononline', 'onpagehide', 'onpageshow', 'onpaste', 'onpause', 'onplay', 'onplaying', 'onpopstate', 'onprogress', 'onratechange', 'onreset', 'onresize', 'onscroll', 'onsearch', 'onseeked', 'onseeking', 'onselect', 'onstalled', 'onstorage', 'onsubmit', 'onsuspend', 'ontimeupdate', 'ontoggle', 'onunload', 'onvolumechange', 'onwaiting', 'onwheel'];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class HtmlUtils {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t});"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tsanitizeHtml(html) {"
          },
          {
            "type": "add",
            "line": "\t\tconst walkHtmlNodes = (nodes) => {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!nodes || !nodes.length) return;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t\tfor (const node of nodes) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tfor (const attr in node.attributes) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tif (!node.attributes.hasOwnProperty(attr)) continue;"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tif (JS_EVENT_NAMES.includes(attr)) node.setAttribute(attr, '');"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t\twalkHtmlNodes(node.childNodes);"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// Need to wrap in div, otherwise elements at the root will be skipped"
          },
          {
            "type": "add",
            "line": "\t\t// The DIV tags are removed below"
          },
          {
            "type": "add",
            "line": "\t\tconst dom = NodeHtmlParser.parse(`<div>${html}</div>`, {"
          },
          {
            "type": "add",
            "line": "\t\t\tscript: false,"
          },
          {
            "type": "add",
            "line": "\t\t\tstyle: true,"
          },
          {
            "type": "add",
            "line": "\t\t\tpre: true,"
          },
          {
            "type": "add",
            "line": "\t\t\tcomment: false,"
          },
          {
            "type": "add",
            "line": "\t\t});"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\twalkHtmlNodes([dom]);"
          },
          {
            "type": "add",
            "line": "\t\tconst output = dom.toString();"
          },
          {
            "type": "add",
            "line": "\t\treturn output.substr(5, output.length - 11);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " const htmlUtils = new HtmlUtils();"
          }
        ]
      },
      {
        "file": "ReactNativeClient/lijoplin-renderer/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index ac1978e5d..a3daa8533 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/joplin-renderer/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/package.json"
          },
          {
            "type": "context",
            "line": "     \"markdown-it-toc-done-right\": \"^4.1.0\","
          },
          {
            "type": "context",
            "line": "     \"md5\": \"^2.2.1\","
          },
          {
            "type": "context",
            "line": "     \"mermaid\": \"^8.4.6\","
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": \"^0.2.0\","
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": \"^1.2.4\","
          },
          {
            "type": "context",
            "line": "     \"uslug\": \"^1.0.4\""
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "ReactNativeClient/lishim-init-node.js",
        "changes": [
          {
            "type": "context",
            "line": "index 81c34cb31..e906e5bb4 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/shim-init-node.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/shim-init-node.js"
          },
          {
            "type": "context",
            "line": " \t\tif (shim.isElectron()) {"
          },
          {
            "type": "context",
            "line": " \t\t\tconst nativeImage = require('electron').nativeImage;"
          },
          {
            "type": "context",
            "line": " \t\t\tlet image = nativeImage.createFromDataURL(imageDataUrl);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (image.isEmpty()) throw new Error('Could not convert data URL to image'); // Would throw for example if the image format is no supported (eg. image/gif)"
          },
          {
            "type": "add",
            "line": "\t\t\tif (image.isEmpty()) throw new Error('Could not convert data URL to image - perhaps the format is not supported (eg. image/gif)'); // Would throw for example if the image format is no supported (eg. image/gif)"
          },
          {
            "type": "context",
            "line": " \t\t\tif (options.cropRect) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t// Crop rectangle values need to be rounded or the crop() call will fail"
          },
          {
            "type": "context",
            "line": " \t\t\t\tconst c = options.cropRect;"
          }
        ]
      },
      {
        "file": "ReactNativeClient/package-lock.json",
        "changes": [
          {
            "type": "context",
            "line": "index 86b4632c3..4087c19b9 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/package-lock.json"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/package-lock.json"
          },
          {
            "type": "context",
            "line": "         \"mimic-fn\": \"^1.0.0\""
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": {"
          },
          {
            "type": "add",
            "line": "      \"version\": \"0.2.0\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/memory-cache/-/memory-cache-0.2.0.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha1-eJCwHVLADI68nVM+H46xfjA0hxo=\""
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     \"merge-stream\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"1.0.1\","
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/merge-stream/-/merge-stream-1.0.1.tgz\","
          },
          {
            "type": "context",
            "line": "         \"is-stream\": \"^1.0.1\""
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": {"
          },
          {
            "type": "add",
            "line": "      \"version\": \"1.2.4\","
          },
          {
            "type": "add",
            "line": "      \"resolved\": \"https://registry.npmjs.org/node-html-parser/-/node-html-parser-1.2.4.tgz\","
          },
          {
            "type": "add",
            "line": "      \"integrity\": \"sha512-qHwPdGyGr9pOZBoSgUOuNPG20QYZVN00lFcxKQgjPUODSxVH7obQeLVVawa3B4cfSNtLIeczSzoy/xYA8XG5WQ==\","
          },
          {
            "type": "add",
            "line": "      \"requires\": {"
          },
          {
            "type": "add",
            "line": "        \"he\": \"1.1.1\""
          },
          {
            "type": "add",
            "line": "      },"
          },
          {
            "type": "add",
            "line": "      \"dependencies\": {"
          },
          {
            "type": "add",
            "line": "        \"he\": {"
          },
          {
            "type": "add",
            "line": "          \"version\": \"1.1.1\","
          },
          {
            "type": "add",
            "line": "          \"resolved\": \"https://registry.npmjs.org/he/-/he-1.1.1.tgz\","
          },
          {
            "type": "add",
            "line": "          \"integrity\": \"sha1-k0EP0hsAlzUVH4howvJx80J+I/0=\""
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     \"node-int64\": {"
          },
          {
            "type": "context",
            "line": "       \"version\": \"0.4.0\","
          },
          {
            "type": "context",
            "line": "       \"resolved\": \"https://registry.npmjs.org/node-int64/-/node-int64-0.4.0.tgz\","
          }
        ]
      },
      {
        "file": "ReactNativeClient/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index 98a227ca5..1f44d59f4 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/package.json"
          },
          {
            "type": "context",
            "line": "     \"react-native-version-info\": \"^0.5.1\","
          },
          {
            "type": "context",
            "line": "     \"react-native-webview\": \"^5.12.0\","
          },
          {
            "type": "context",
            "line": "     \"react-redux\": \"5.0.7\","
          },
          {
            "type": "add",
            "line": "    \"memory-cache\": \"^0.2.0\","
          },
          {
            "type": "add",
            "line": "    \"node-html-parser\": \"^1.2.4\","
          },
          {
            "type": "context",
            "line": "     \"redux\": \"4.0.0\","
          },
          {
            "type": "context",
            "line": "     \"reselect\": \"^4.0.0\","
          },
          {
            "type": "context",
            "line": "     \"rn-fetch-blob\": \"^0.12.0\","
          }
        ]
      }
    ]
  },
  {
    "commit": "3dd99dd80e27e5e1d99b42844180546d90c7aa90",
    "files": [
      {
        "file": ".eslintrc.json",
        "changes": [
          {
            "type": "context",
            "line": "index 59953216..c04e2d31 100644"
          },
          {
            "type": "context",
            "line": "--- a/.eslintrc.json"
          },
          {
            "type": "context",
            "line": "+++ b/.eslintrc.json"
          },
          {
            "type": "context",
            "line": "         \"space-infix-ops\": \"error\","
          },
          {
            "type": "context",
            "line": "         \"no-useless-escape\": \"off\","
          },
          {
            "type": "context",
            "line": "         \"require-atomic-updates\": \"off\""
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "add",
            "line": "    \"globals\": {"
          },
          {
            "type": "add",
            "line": "        \"Parse\": true"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "spec/vulnerabilities.spec.js",
        "changes": [
          {
            "type": "context",
            "line": "index 5c83493c..c499eb01 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/vulnerabilities.spec.js"
          },
          {
            "type": "context",
            "line": "+++ b/spec/vulnerabilities.spec.js"
          },
          {
            "type": "context",
            "line": "       );"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('denies creating global config with polluted data', async () => {"
          },
          {
            "type": "add",
            "line": "      const headers = {"
          },
          {
            "type": "add",
            "line": "        'Content-Type': 'application/json',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Application-Id': 'test',"
          },
          {
            "type": "add",
            "line": "        'X-Parse-Master-Key': 'test',"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const params = {"
          },
          {
            "type": "add",
            "line": "        method: 'PUT',"
          },
          {
            "type": "add",
            "line": "        url: 'http://localhost:8378/1/config',"
          },
          {
            "type": "add",
            "line": "        json: true,"
          },
          {
            "type": "add",
            "line": "        body: {"
          },
          {
            "type": "add",
            "line": "          params: {"
          },
          {
            "type": "add",
            "line": "            welcomeMesssage: 'Welcome to Parse',"
          },
          {
            "type": "add",
            "line": "            foo: { _bsontype: 'Code', code: 'shell' },"
          },
          {
            "type": "add",
            "line": "          },"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        headers,"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      const response = await request(params).catch(e => e);"
          },
          {
            "type": "add",
            "line": "      expect(response.status).toBe(400);"
          },
          {
            "type": "add",
            "line": "      const text = JSON.parse(response.text);"
          },
          {
            "type": "add",
            "line": "      expect(text.code).toBe(Parse.Error.INVALID_KEY_NAME);"
          },
          {
            "type": "add",
            "line": "      expect(text.error).toBe("
          },
          {
            "type": "add",
            "line": "        'Prohibited keyword in request data: {\"key\":\"_bsontype\",\"value\":\"Code\"}.'"
          },
          {
            "type": "add",
            "line": "      );"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('denies direct database write wih prohibited keys', async () => {"
          },
          {
            "type": "add",
            "line": "      const Config = require('../lib/Config');"
          },
          {
            "type": "add",
            "line": "      const config = Config.get(Parse.applicationId);"
          },
          {
            "type": "add",
            "line": "      const user = {"
          },
          {
            "type": "add",
            "line": "        objectId: '1234567890',"
          },
          {
            "type": "add",
            "line": "        username: 'hello',"
          },
          {
            "type": "add",
            "line": "        password: 'pass',"
          },
          {
            "type": "add",
            "line": "        _session_token: 'abc',"
          },
          {
            "type": "add",
            "line": "        foo: { _bsontype: 'Code', code: 'shell' },"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      await expectAsync(config.database.create('_User', user)).toBeRejectedWith("
          },
          {
            "type": "add",
            "line": "        new Parse.Error("
          },
          {
            "type": "add",
            "line": "          Parse.Error.INVALID_KEY_NAME,"
          },
          {
            "type": "add",
            "line": "          'Prohibited keyword in request data: {\"key\":\"_bsontype\",\"value\":\"Code\"}.'"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "      );"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    it('denies direct database update wih prohibited keys', async () => {"
          },
          {
            "type": "add",
            "line": "      const Config = require('../lib/Config');"
          },
          {
            "type": "add",
            "line": "      const config = Config.get(Parse.applicationId);"
          },
          {
            "type": "add",
            "line": "      const user = {"
          },
          {
            "type": "add",
            "line": "        objectId: '1234567890',"
          },
          {
            "type": "add",
            "line": "        username: 'hello',"
          },
          {
            "type": "add",
            "line": "        password: 'pass',"
          },
          {
            "type": "add",
            "line": "        _session_token: 'abc',"
          },
          {
            "type": "add",
            "line": "        foo: { _bsontype: 'Code', code: 'shell' },"
          },
          {
            "type": "add",
            "line": "      };"
          },
          {
            "type": "add",
            "line": "      await expectAsync("
          },
          {
            "type": "add",
            "line": "        config.database.update('_User', { _id: user.objectId }, user)"
          },
          {
            "type": "add",
            "line": "      ).toBeRejectedWith("
          },
          {
            "type": "add",
            "line": "        new Parse.Error("
          },
          {
            "type": "add",
            "line": "          Parse.Error.INVALID_KEY_NAME,"
          },
          {
            "type": "add",
            "line": "          'Prohibited keyword in request data: {\"key\":\"_bsontype\",\"value\":\"Code\"}.'"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "      );"
          },
          {
            "type": "add",
            "line": "    });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     it('denies creating a hook with polluted data', async () => {"
          },
          {
            "type": "context",
            "line": "       const express = require('express');"
          },
          {
            "type": "context",
            "line": "       const bodyParser = require('body-parser');"
          }
        ]
      },
      {
        "file": "src/Controllers/DatabaseController.js",
        "changes": [
          {
            "type": "context",
            "line": "index e3ac5723..435095fb 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Controllers/DatabaseController.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/Controllers/DatabaseController.js"
          },
          {
            "type": "context",
            "line": "     validateOnly: boolean = false,"
          },
          {
            "type": "context",
            "line": "     validSchemaController: SchemaController.SchemaController"
          },
          {
            "type": "context",
            "line": "   ): Promise<any> {"
          },
          {
            "type": "add",
            "line": "    try {"
          },
          {
            "type": "add",
            "line": "      Utils.checkProhibitedKeywords(this.options, update);"
          },
          {
            "type": "add",
            "line": "    } catch (error) {"
          },
          {
            "type": "add",
            "line": "      return Promise.reject(new Parse.Error(Parse.Error.INVALID_KEY_NAME, error));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     const originalQuery = query;"
          },
          {
            "type": "context",
            "line": "     const originalUpdate = update;"
          },
          {
            "type": "context",
            "line": "     // Make a copy of the object, so we don't mutate the incoming data."
          },
          {
            "type": "context",
            "line": "     validateOnly: boolean = false,"
          },
          {
            "type": "context",
            "line": "     validSchemaController: SchemaController.SchemaController"
          },
          {
            "type": "context",
            "line": "   ): Promise<any> {"
          },
          {
            "type": "add",
            "line": "    try {"
          },
          {
            "type": "add",
            "line": "      Utils.checkProhibitedKeywords(this.options, object);"
          },
          {
            "type": "add",
            "line": "    } catch (error) {"
          },
          {
            "type": "add",
            "line": "      return Promise.reject(new Parse.Error(Parse.Error.INVALID_KEY_NAME, error));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     // Make a copy of the object, so we don't mutate the incoming data."
          },
          {
            "type": "context",
            "line": "     const originalObject = object;"
          },
          {
            "type": "context",
            "line": "     object = transformObjectACL(object);"
          }
        ]
      },
      {
        "file": "src/RestWrite.js",
        "changes": [
          {
            "type": "context",
            "line": "index 3a8385e5..dd36eb37 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/RestWrite.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/RestWrite.js"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  this.checkProhibitedKeywords(data);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "   // When the operation is complete, this.response may have several"
          },
          {
            "type": "context",
            "line": "   // fields."
          },
          {
            "type": "context",
            "line": "   // response: the actual data to be returned"
          },
          {
            "type": "context",
            "line": "           delete this.data.objectId;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "delete",
            "line": "      this.checkProhibitedKeywords(this.data);"
          },
          {
            "type": "add",
            "line": "      try {"
          },
          {
            "type": "add",
            "line": "        Utils.checkProhibitedKeywords(this.config, this.data);"
          },
          {
            "type": "add",
            "line": "      } catch (error) {"
          },
          {
            "type": "add",
            "line": "        throw new Parse.Error(Parse.Error.INVALID_KEY_NAME, error);"
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   return response;"
          },
          {
            "type": "context",
            "line": " };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "RestWrite.prototype.checkProhibitedKeywords = function (data) {"
          },
          {
            "type": "delete",
            "line": "  if (this.config.requestKeywordDenylist) {"
          },
          {
            "type": "delete",
            "line": "    // Scan request data for denied keywords"
          },
          {
            "type": "delete",
            "line": "    for (const keyword of this.config.requestKeywordDenylist) {"
          },
          {
            "type": "delete",
            "line": "      const match = Utils.objectContainsKeyValue(data, keyword.key, keyword.value);"
          },
          {
            "type": "delete",
            "line": "      if (match) {"
          },
          {
            "type": "delete",
            "line": "        throw new Parse.Error("
          },
          {
            "type": "delete",
            "line": "          Parse.Error.INVALID_KEY_NAME,"
          },
          {
            "type": "delete",
            "line": "          `Prohibited keyword in request data: ${JSON.stringify(keyword)}.`"
          },
          {
            "type": "delete",
            "line": "        );"
          },
          {
            "type": "delete",
            "line": "      }"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "  }"
          },
          {
            "type": "delete",
            "line": "};"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " export default RestWrite;"
          },
          {
            "type": "context",
            "line": " module.exports = RestWrite;"
          }
        ]
      },
      {
        "file": "src/Routers/FilesRouter.js",
        "changes": [
          {
            "type": "context",
            "line": "index ed48a28a..a5322b4c 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Routers/FilesRouter.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/Routers/FilesRouter.js"
          },
          {
            "type": "context",
            "line": "     const base64 = req.body.toString('base64');"
          },
          {
            "type": "context",
            "line": "     const file = new Parse.File(filename, { base64 }, contentType);"
          },
          {
            "type": "context",
            "line": "     const { metadata = {}, tags = {} } = req.fileData || {};"
          },
          {
            "type": "delete",
            "line": "    if (req.config && req.config.requestKeywordDenylist) {"
          },
          {
            "type": "delete",
            "line": "      // Scan request data for denied keywords"
          },
          {
            "type": "delete",
            "line": "      for (const keyword of req.config.requestKeywordDenylist) {"
          },
          {
            "type": "delete",
            "line": "        const match ="
          },
          {
            "type": "delete",
            "line": "          Utils.objectContainsKeyValue(metadata, keyword.key, keyword.value) ||"
          },
          {
            "type": "delete",
            "line": "          Utils.objectContainsKeyValue(tags, keyword.key, keyword.value);"
          },
          {
            "type": "delete",
            "line": "        if (match) {"
          },
          {
            "type": "delete",
            "line": "          next("
          },
          {
            "type": "delete",
            "line": "            new Parse.Error("
          },
          {
            "type": "delete",
            "line": "              Parse.Error.INVALID_KEY_NAME,"
          },
          {
            "type": "delete",
            "line": "              `Prohibited keyword in request data: ${JSON.stringify(keyword)}.`"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "          );"
          },
          {
            "type": "delete",
            "line": "          return;"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "      }"
          },
          {
            "type": "add",
            "line": "    try {"
          },
          {
            "type": "add",
            "line": "      Utils.checkProhibitedKeywords(config, metadata);"
          },
          {
            "type": "add",
            "line": "      Utils.checkProhibitedKeywords(config, tags);"
          },
          {
            "type": "add",
            "line": "    } catch (error) {"
          },
          {
            "type": "add",
            "line": "      next(new Parse.Error(Parse.Error.INVALID_KEY_NAME, error));"
          },
          {
            "type": "add",
            "line": "      return;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     file.setTags(tags);"
          },
          {
            "type": "context",
            "line": "     file.setMetadata(metadata);"
          }
        ]
      },
      {
        "file": "src/Utils.js",
        "changes": [
          {
            "type": "context",
            "line": "index d5a255a5..efeae58f 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Utils.js"
          },
          {
            "type": "context",
            "line": "+++ b/src/Utils.js"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     return false;"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  static checkProhibitedKeywords(config, data) {"
          },
          {
            "type": "add",
            "line": "    if (config?.requestKeywordDenylist) {"
          },
          {
            "type": "add",
            "line": "      // Scan request data for denied keywords"
          },
          {
            "type": "add",
            "line": "      for (const keyword of config.requestKeywordDenylist) {"
          },
          {
            "type": "add",
            "line": "        const match = Utils.objectContainsKeyValue(data, keyword.key, keyword.value);"
          },
          {
            "type": "add",
            "line": "        if (match) {"
          },
          {
            "type": "add",
            "line": "          throw `Prohibited keyword in request data: ${JSON.stringify(keyword)}.`;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "      }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " module.exports = Utils;"
          }
        ]
      }
    ]
  },
  {
    "commit": "437b273761adedcbd880f714bfa44afeec186a31",
    "files": [
      {
        "file": "rpcapd/daemon.c",
        "changes": [
          {
            "type": "context",
            "line": "index 98163289..c9b44aaf 100644"
          },
          {
            "type": "context",
            "line": "--- a/rpcapd/daemon.c"
          },
          {
            "type": "context",
            "line": "+++ b/rpcapd/daemon.c"
          },
          {
            "type": "context",
            "line": " #ifdef HAVE_GETSPNAM"
          },
          {
            "type": "context",
            "line": " \tstruct spwd *usersp;"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "add",
            "line": "\tchar *crypt_password;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// This call is needed to get the uid"
          },
          {
            "type": "context",
            "line": " \tif ((user = getpwnam(username)) == NULL)"
          },
          {
            "type": "context",
            "line": " \tuser_password = user->pw_passwd;"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (strcmp(user_password, (char *) crypt(password, user_password)) != 0)"
          },
          {
            "type": "add",
            "line": "\tcrypt_password = crypt(password, user_password);"
          },
          {
            "type": "add",
            "line": "\tif (crypt_password == NULL)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "add",
            "line": "\t\treturn -1;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tif (strcmp(user_password, crypt_password) != 0)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed: user name or password incorrect\");"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          }
        ]
      }
    ]
  },
  {
    "commit": "45c6b53c3978639db03b63270a56f4397f49b2c9",
    "files": [
      {
        "file": ".githuworkflows/build-container.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 6af8bc26a..adc15c7e2 100644"
          },
          {
            "type": "context",
            "line": "--- a/.github/workflows/build-container.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/.github/workflows/build-container.yaml"
          },
          {
            "type": "context",
            "line": "   build:"
          },
          {
            "type": "context",
            "line": "     name: Build Containers"
          },
          {
            "type": "context",
            "line": "     if: github.repository == 'xibosignage/xibo-cms'"
          },
          {
            "type": "delete",
            "line": "    runs-on: ubuntu-18.04"
          },
          {
            "type": "add",
            "line": "    runs-on: ubuntu-22.04"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Checkout"
          },
          {
            "type": "context",
            "line": "         uses: actions/checkout@v1"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Skip"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "delete",
            "line": "          echo 'Skipped while in a fork'"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "          echo 'Skipped while in a fork'"
          }
        ]
      },
      {
        "file": ".githuworkflows/build-cypress.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 9a9b10751..d2d16fe88 100644"
          },
          {
            "type": "context",
            "line": "--- a/.github/workflows/build-cypress.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/.github/workflows/build-cypress.yaml"
          },
          {
            "type": "context",
            "line": "   build:"
          },
          {
            "type": "context",
            "line": "     name: Build Cypress"
          },
          {
            "type": "context",
            "line": "     if: github.repository == 'xibosignage/xibo-cms'"
          },
          {
            "type": "delete",
            "line": "    runs-on: ubuntu-18.04"
          },
          {
            "type": "add",
            "line": "    runs-on: ubuntu-22.04"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Checkout"
          },
          {
            "type": "context",
            "line": "         uses: actions/checkout@v1"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Skip"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "delete",
            "line": "          echo 'Skipped while in a fork'"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "          echo 'Skipped while in a fork'"
          }
        ]
      },
      {
        "file": ".githuworkflows/build-tag.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index a4a30168e..1cc630e6b 100644"
          },
          {
            "type": "context",
            "line": "--- a/.github/workflows/build-tag.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/.github/workflows/build-tag.yaml"
          },
          {
            "type": "context",
            "line": "   build:"
          },
          {
            "type": "context",
            "line": "     name: Build Containers"
          },
          {
            "type": "context",
            "line": "     if: github.repository == 'xibosignage/xibo-cms'"
          },
          {
            "type": "delete",
            "line": "    runs-on: ubuntu-18.04"
          },
          {
            "type": "add",
            "line": "    runs-on: ubuntu-22.04"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Checkout"
          },
          {
            "type": "context",
            "line": "         uses: actions/checkout@v1"
          },
          {
            "type": "context",
            "line": "           fetch-depth: 1"
          },
          {
            "type": "context",
            "line": "       - name: Build Image"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "delete",
            "line": "          docker build . -t xibosignage/xibo-cms:release-${GITHUB_REF##*/} --build-arg GIT_COMMIT=${GITHUB_SHA}"
          },
          {
            "type": "add",
            "line": "          docker build . -t ghcr.io/xibosignage/xibo-cms:release-${GITHUB_REF##*/} --build-arg GIT_COMMIT=${GITHUB_SHA}"
          },
          {
            "type": "context",
            "line": "       - name: Push Image"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "delete",
            "line": "          docker login --username ${{ secrets.DOCKER_HUB_USERNAME }} --password ${{ secrets.DOCKER_HUB_TOKEN }}"
          },
          {
            "type": "delete",
            "line": "          docker push xibosignage/xibo-cms:release-${GITHUB_REF##*/}"
          },
          {
            "type": "add",
            "line": "          docker login --username ${{ github.actor }} --password ${{ secrets.GITHUB_TOKEN }}"
          },
          {
            "type": "add",
            "line": "          docker push ghcr.io/xibosignage/xibo-cms:release-${GITHUB_REF##*/}"
          },
          {
            "type": "context",
            "line": "       - name: Build archive"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "delete",
            "line": "          CONTAINER=$(docker create xibosignage/xibo-cms:release-${GITHUB_REF##*/})"
          },
          {
            "type": "add",
            "line": "          CONTAINER=$(docker create ghcr.io/xibosignage/xibo-cms:release-${GITHUB_REF##*/})"
          },
          {
            "type": "context",
            "line": "           echo 'Copying from container.'"
          },
          {
            "type": "context",
            "line": "           docker cp \"$CONTAINER\":/var/www/cms/ xibo-cms-${GITHUB_REF##*/}"
          },
          {
            "type": "context",
            "line": "           tar -czf xibo-cms-${GITHUB_REF##*/}.tar.gz xibo-cms-${GITHUB_REF##*/}"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Skip"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "delete",
            "line": "          echo 'Skipped while in a fork'"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "          echo 'Skipped while in a fork'"
          }
        ]
      },
      {
        "file": ".githuworkflows/test-suite.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index a52cc298b..c2afe2d06 100644"
          },
          {
            "type": "context",
            "line": "--- a/.github/workflows/test-suite.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/.github/workflows/test-suite.yaml"
          },
          {
            "type": "context",
            "line": " jobs:"
          },
          {
            "type": "context",
            "line": "   test-suite:"
          },
          {
            "type": "context",
            "line": "     name: Build Containers and Run Tests"
          },
          {
            "type": "delete",
            "line": "    runs-on: ubuntu-18.04"
          },
          {
            "type": "add",
            "line": "    runs-on: ubuntu-22.04"
          },
          {
            "type": "context",
            "line": "     steps:"
          },
          {
            "type": "context",
            "line": "       - name: Checkout"
          },
          {
            "type": "context",
            "line": "         uses: actions/checkout@v1"
          },
          {
            "type": "context",
            "line": "         run: |"
          },
          {
            "type": "context",
            "line": "           docker exec cms-db mysql -ucms -pjenkins cms -e \"INSERT INTO oauth_clients (id, secret, name, userId, authCode, clientCredentials) VALUES ('MrGPc7e3IL1hA6w13l7Ru5giygxmNiafGNhFv89d', 'Pk6DdDgu2HzSoepcMHRabY60lDEvQ9ucTejYvc5dOgNVSNaOJirCUM83oAzlwe0KBiGR2Nhi6ltclyNC1rmcq0CiJZXzE42KfeatQ4j9npr6nMIQAzMal8O8RiYrIoono306CfyvSSJRfVfKExIjj0ZyE4TUrtPezJbKmvkVDzh8aj3kbanDKatirhwpfqfVdfgsqVNjzIM9ZgKHnbrTX7nNULL3BtxxNGgDMuCuvKiJFrLSyIIz1F4SNrHwHz', 'cypress', 1, 0, 1)\""
          },
          {
            "type": "context",
            "line": "           docker exec cms-db mysql -ucms -pjenkins cms -e \"INSERT INTO oauth_client_scopes (clientId, scopeId) VALUES ('MrGPc7e3IL1hA6w13l7Ru5giygxmNiafGNhFv89d', 'all') ON DUPLICATE KEY UPDATE scopeId = scopeId\""
          },
          {
            "type": "delete",
            "line": "          docker run --ipc=host --name cms-cypress --link=cms-web:web -v $(pwd)/cypress.json:/app/cypress.json -v $(pwd)/cypress:/app/cypress xibosignage/xibo-cms:cypress bash -c \"CYPRESS_baseUrl=http://web /app/node_modules/.bin/cypress run --config screenshotsFolder=/app/results,video=false --reporter junit --reporter-options 'mochaFile=/app/results/results_cypress_[hash].xml,toConsole=true'\""
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "          docker run --ipc=host --name cms-cypress --link=cms-web:web -v $(pwd)/cypress.json:/app/cypress.json -v $(pwd)/cypress:/app/cypress xibosignage/xibo-cms:cypress bash -c \"CYPRESS_baseUrl=http://web /app/node_modules/.bin/cypress run --config screenshotsFolder=/app/results,video=false --reporter junit --reporter-options 'mochaFile=/app/results/results_cypress_[hash].xml,toConsole=true'\""
          }
        ]
      },
      {
        "file": "liEntity/DataSet.php",
        "changes": [
          {
            "type": "context",
            "line": "index aa38a7d39..1bdfbc5ba 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Entity/DataSet.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Entity/DataSet.php"
          },
          {
            "type": "context",
            "line": "         foreach ($this->getColumn() as $column) {"
          },
          {
            "type": "context",
            "line": "             /* @var DataSetColumn $column */"
          },
          {
            "type": "context",
            "line": "             $allowedOrderCols[] = $column->heading;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if ($column->dataSetColumnTypeId == 2 && !$options['includeFormulaColumns'])"
          },
          {
            "type": "context",
            "line": "                 continue;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     continue;"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "                $formula = str_replace($this->blackList, '', htmlspecialchars_decode($column->formula, ENT_QUOTES));"
          },
          {
            "type": "add",
            "line": "                $formula = str_ireplace($this->blackList, '', htmlspecialchars_decode($column->formula, ENT_QUOTES));"
          },
          {
            "type": "context",
            "line": "                 $formula = str_replace('[DisplayId]', $displayId, $formula);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 $heading = str_replace('[DisplayGeoLocation]', $displayGeoLocation, $formula) . ' AS `' . $column->heading . '`';"
          },
          {
            "type": "context",
            "line": "         // Filtering"
          },
          {
            "type": "context",
            "line": "         if ($filter != '') {"
          },
          {
            "type": "context",
            "line": "             // Support display filtering."
          },
          {
            "type": "delete",
            "line": "            $filter = str_replace('[DisplayId]', $displayId, $filter);"
          },
          {
            "type": "add",
            "line": "            $filter = str_ireplace('[DisplayId]', $displayId, $filter);"
          },
          {
            "type": "context",
            "line": "             $filter = str_replace($this->blackList, '', $filter);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             $body .= ' AND ' . $filter;"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $this->getStore()->insert('INSERT INTO `dataset_' . $dataSetIdTarget . '`  SELECT * FROM `dataset_' . $dataSetIdSource . '` ' ,[]);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "liFactory/LayoutFactory.php",
        "changes": [
          {
            "type": "context",
            "line": "index a6b0394b0..47f0f2a80 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Factory/LayoutFactory.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Factory/LayoutFactory.php"
          },
          {
            "type": "context",
            "line": "         foreach ($mappings as $file) {"
          },
          {
            "type": "context",
            "line": "             // Import the Media File"
          },
          {
            "type": "context",
            "line": "             $intendedMediaName = $file['name'];"
          },
          {
            "type": "delete",
            "line": "            $temporaryFileName = $libraryLocation . $file['file'];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            // Validate the file name"
          },
          {
            "type": "add",
            "line": "            $fileName = basename($file['file']);"
          },
          {
            "type": "add",
            "line": "            if (empty($fileName) || $fileName == '.') {"
          },
          {
            "type": "add",
            "line": "                $this->getLog()->error('Skipping file on import due to invalid filename. ' . $fileName);"
          },
          {
            "type": "add",
            "line": "                continue;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $temporaryFileName = $libraryLocation . $fileName;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             // Get the file from the ZIP"
          },
          {
            "type": "delete",
            "line": "            $fileStream = $zip->getStream('library/' . $file['file']);"
          },
          {
            "type": "add",
            "line": "            $fileStream = $zip->getStream('library/' . $fileName);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if ($fileStream === false) {"
          },
          {
            "type": "context",
            "line": "                 // Log out the entire ZIP file and all entries."
          },
          {
            "type": "delete",
            "line": "                $log = 'Problem getting library/' . $file['file'] . '. Files: ';"
          },
          {
            "type": "add",
            "line": "                $log = 'Problem getting library/' . $fileName . '. Files: ';"
          },
          {
            "type": "context",
            "line": "                 for ($i = 0; $i < $zip->numFiles; $i++) {"
          },
          {
            "type": "context",
            "line": "                     $log .= $zip->getNameIndex($i) . ', ';"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             } catch (NotFoundException $e) {"
          },
          {
            "type": "context",
            "line": "                 // Create it instead"
          },
          {
            "type": "delete",
            "line": "                $this->getLog()->debug('Media does not exist in Library, add it. %s', $file['file']);"
          },
          {
            "type": "add",
            "line": "                $this->getLog()->debug('Media does not exist in Library, add it. %s', $fileName);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "                $media = $this->mediaFactory->create($intendedMediaName, $file['file'], $file['type'], $userId, $file['duration']);"
          },
          {
            "type": "add",
            "line": "                $media = $this->mediaFactory->create($intendedMediaName, $fileName, $file['type'], $userId, $file['duration']);"
          },
          {
            "type": "context",
            "line": "                 $media->tags[] = $this->tagFactory->tagFromString('imported');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 // Get global stat setting of media to set to on/off/inherit"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 // We must null the ID so that we don't try to load the dataset when we assign columns"
          },
          {
            "type": "context",
            "line": "                 $dataSet->dataSetId = null;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 // Hydrate the columns"
          },
          {
            "type": "context",
            "line": "                 foreach ($item['columns'] as $columnItem) {"
          },
          {
            "type": "context",
            "line": "                     $this->getLog()->debug('Assigning column: %s', json_encode($columnItem));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // </editor-fold>"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "liHelper/Environment.php",
        "changes": [
          {
            "type": "context",
            "line": "index 9cd0ef881..700ffd2b4 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/Helper/Environment.php"
          },
          {
            "type": "context",
            "line": "+++ b/lib/Helper/Environment.php"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " class Environment"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    public static $WEBSITE_VERSION_NAME = '2.3.16';"
          },
          {
            "type": "add",
            "line": "    public static $WEBSITE_VERSION_NAME = '2.3.17';"
          },
          {
            "type": "context",
            "line": "     public static $XMDS_VERSION = '5';"
          },
          {
            "type": "context",
            "line": "     public static $XLF_VERSION = 3;"
          },
          {
            "type": "context",
            "line": "     public static $VERSION_REQUIRED = '7.0.8';"
          }
        ]
      }
    ]
  },
  {
    "commit": "484d60cbf7ca4ec758c3cbb8a82d68b244a78d58",
    "files": [
      {
        "file": "rpcapd/daemon.c",
        "changes": [
          {
            "type": "context",
            "line": "index c9b44aaf..c335fb05 100644"
          },
          {
            "type": "context",
            "line": "--- a/rpcapd/daemon.c"
          },
          {
            "type": "context",
            "line": "+++ b/rpcapd/daemon.c"
          },
          {
            "type": "context",
            "line": " \t * stop trying to log in with a given user name and move on"
          },
          {
            "type": "context",
            "line": " \t * to another user name."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "add",
            "line": "\tDWORD error;"
          },
          {
            "type": "context",
            "line": " \tHANDLE Token;"
          },
          {
            "type": "add",
            "line": "\tchar errmsgbuf[PCAP_ERRBUF_SIZE];\t// buffer for errors to log"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (LogonUser(username, \".\", password, LOGON32_LOGON_NETWORK, LOGON32_PROVIDER_DEFAULT, &Token) == 0)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tpcap_fmt_errmsg_for_win32_err(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "delete",
            "line": "\t\t    GetLastError(), \"LogonUser() failed\");"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "add",
            "line": "\t\terror = GetLastError();"
          },
          {
            "type": "add",
            "line": "\t\tif (error != ERROR_LOGON_FAILURE)"
          },
          {
            "type": "add",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\t// Some error other than an authentication error;"
          },
          {
            "type": "add",
            "line": "\t\t\t// log it."
          },
          {
            "type": "add",
            "line": "\t\t\tpcap_fmt_errmsg_for_win32_err(errmsgbuf,"
          },
          {
            "type": "add",
            "line": "\t\t\t    PCAP_ERRBUF_SIZE, error, \"LogonUser() failed\");"
          },
          {
            "type": "add",
            "line": "\t\t\trpcapd_log(LOGPRIO_ERROR, \"%s\", errmsgbuf);"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// I didn't test it."
          },
          {
            "type": "context",
            "line": " \tif (ImpersonateLoggedOnUser(Token) == 0)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tpcap_fmt_errmsg_for_win32_err(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "add",
            "line": "\t\tpcap_fmt_errmsg_for_win32_err(errmsgbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "context",
            "line": " \t\t    GetLastError(), \"ImpersonateLoggedOnUser() failed\");"
          },
          {
            "type": "add",
            "line": "\t\trpcapd_log(LOGPRIO_ERROR, \"%s\", errmsgbuf);"
          },
          {
            "type": "context",
            "line": " \t\tCloseHandle(Token);"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t * only password database or some other authentication mechanism,"
          },
          {
            "type": "context",
            "line": " \t * behind its API."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "add",
            "line": "\tint error;"
          },
          {
            "type": "context",
            "line": " \tstruct passwd *user;"
          },
          {
            "type": "context",
            "line": " \tchar *user_password;"
          },
          {
            "type": "context",
            "line": " #ifdef HAVE_GETSPNAM"
          },
          {
            "type": "context",
            "line": " \t// This call is needed to get the uid"
          },
          {
            "type": "context",
            "line": " \tif ((user = getpwnam(username)) == NULL)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed: user name or password incorrect\");"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// This call is needed to get the password; otherwise 'x' is returned"
          },
          {
            "type": "context",
            "line": " \tif ((usersp = getspnam(username)) == NULL)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed: user name or password incorrect\");"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tuser_password = usersp->sp_pwdp;"
          },
          {
            "type": "context",
            "line": " \tuser_password = user->pw_passwd;"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t//"
          },
          {
            "type": "add",
            "line": "\t// The Single UNIX Specification says that if crypt() fails it"
          },
          {
            "type": "add",
            "line": "\t// sets errno, but some implementatons that haven't been run"
          },
          {
            "type": "add",
            "line": "\t// through the SUS test suite might not do so."
          },
          {
            "type": "add",
            "line": "\t//"
          },
          {
            "type": "add",
            "line": "\terrno = 0;"
          },
          {
            "type": "context",
            "line": " \tcrypt_password = crypt(password, user_password);"
          },
          {
            "type": "context",
            "line": " \tif (crypt_password == NULL)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "add",
            "line": "\t\terror = errno;"
          },
          {
            "type": "context",
            "line": " \t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "add",
            "line": "\t\tif (error == 0)"
          },
          {
            "type": "add",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\t// It didn't set errno."
          },
          {
            "type": "add",
            "line": "\t\t\trpcapd_log(LOGPRIO_ERROR, \"crypt() failed\");"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\trpcapd_log(LOGPRIO_ERROR, \"crypt() failed: %s\","
          },
          {
            "type": "add",
            "line": "\t\t\t    strerror(error));"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tif (strcmp(user_password, crypt_password) != 0)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed: user name or password incorrect\");"
          },
          {
            "type": "add",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE, \"Authentication failed\");"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif (setuid(user->pw_uid))"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "add",
            "line": "\t\terror = errno;"
          },
          {
            "type": "context",
            "line": " \t\tpcap_fmt_errmsg_for_errno(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "delete",
            "line": "\t\t    errno, \"setuid\");"
          },
          {
            "type": "add",
            "line": "\t\t    error, \"setuid\");"
          },
          {
            "type": "add",
            "line": "\t\trpcapd_log(LOGPRIO_ERROR, \"setuid() failed: %s\","
          },
          {
            "type": "add",
            "line": "\t\t    strerror(error));"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*\tif (setgid(user->pw_gid))"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "add",
            "line": "\t\terror = errno;"
          },
          {
            "type": "context",
            "line": " \t\tpcap_fmt_errmsg_for_errno(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "context",
            "line": " \t\t    errno, \"setgid\");"
          },
          {
            "type": "add",
            "line": "\t\trpcapd_log(LOGPRIO_ERROR, \"setgid() failed: %s\","
          },
          {
            "type": "add",
            "line": "\t\t    strerror(error));"
          },
          {
            "type": "context",
            "line": " \t\treturn -1;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " */"
          }
        ]
      }
    ]
  },
  {
    "commit": "494e235e18659574f836f84fcf9f4d4fcdcfcf89",
    "files": [
      {
        "file": "README.md",
        "changes": [
          {
            "type": "context",
            "line": "index 3148c10d0..8034470c5 100644"
          },
          {
            "type": "context",
            "line": "--- a/README.md"
          },
          {
            "type": "context",
            "line": "+++ b/README.md"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " The checkboxes can then be ticked in the mobile and desktop applications."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "## HTML support"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Only the `<br>` tag is supported - it can be used to force a new line, which is convenient to insert new lines inside table cells. For security reasons, other HTML tags are not supported."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " # Donations"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Donations to Joplin support the development of the project. Developing quality applications mostly takes time, but there are also some expenses, such as digital certificates to sign the applications, app store fees, hosting, etc. Most of all, your donation will make it possible to keep up the current development standard."
          }
        ]
      },
      {
        "file": "ReactNativeClient/liMdToHtml.js",
        "changes": [
          {
            "type": "context",
            "line": "index 5ed85f24c..1f5de86b6 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/MdToHtml.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/MdToHtml.js"
          },
          {
            "type": "context",
            "line": " \t\tconst md = new MarkdownIt({"
          },
          {
            "type": "context",
            "line": " \t\t\tbreaks: true,"
          },
          {
            "type": "context",
            "line": " \t\t\tlinkify: true,"
          },
          {
            "type": "delete",
            "line": "\t\t\thtml: true,"
          },
          {
            "type": "add",
            "line": "\t\t\thtml: false, // For security, HTML tags are not supported - https://github.com/laurent22/joplin/issues/500"
          },
          {
            "type": "context",
            "line": " \t\t});"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// This is currently used only so that the $expression$ and $$\\nexpression\\n$$ blocks are translated"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// Support <br> tag to allow newlines inside table cells"
          },
          {
            "type": "add",
            "line": "\t\trenderedBody = renderedBody.replace(/&lt;br&gt;/gi, '<br>');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// https://necolas.github.io/normalize.css/"
          },
          {
            "type": "context",
            "line": " \t\tconst normalizeCss = `"
          },
          {
            "type": "context",
            "line": " \t\t\thtml{line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}"
          }
        ]
      },
      {
        "file": "docs/index.html",
        "changes": [
          {
            "type": "context",
            "line": "index aa0877ec2..c417f1785 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/index.html"
          },
          {
            "type": "context",
            "line": "+++ b/docs/index.html"
          },
          {
            "type": "context",
            "line": " - [ ] Rice"
          },
          {
            "type": "context",
            "line": " - [ ] Eggs"
          },
          {
            "type": "context",
            "line": " </code></pre><p>The checkboxes can then be ticked in the mobile and desktop applications.</p>"
          },
          {
            "type": "add",
            "line": "<h2 id=\"html-support\">HTML support</h2>"
          },
          {
            "type": "add",
            "line": "<p>Only the <code>&lt;br&gt;</code> tag is supported - it can be used to force a new line, which is convenient to insert new lines inside table cells. For security reasons, other HTML tags are not supported.</p>"
          },
          {
            "type": "context",
            "line": " <h1 id=\"donations\">Donations</h1>"
          },
          {
            "type": "context",
            "line": " <p>Donations to Joplin support the development of the project. Developing quality applications mostly takes time, but there are also some expenses, such as digital certificates to sign the applications, app store fees, hosting, etc. Most of all, your donation will make it possible to keep up the current development standard.</p>"
          },
          {
            "type": "context",
            "line": " <p>Please see the <a href=\"https://joplin.cozic.net/donate/\">donation page</a> for information on how to support the development of Joplin.</p>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/hr.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Croatian</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/hr_HR.po\">hr_HR</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Hrvoje Mandić <a href=\"&#109;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#116;&#x72;&#98;&#117;&#104;&#x6f;&#109;&#64;&#110;&#x65;&#116;&#x2e;&#104;&#114;\">&#116;&#x72;&#98;&#117;&#104;&#x6f;&#109;&#64;&#110;&#x65;&#116;&#x2e;&#104;&#114;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Hrvoje Mandić <a href=\"&#109;&#x61;&#105;&#x6c;&#116;&#x6f;&#x3a;&#116;&#x72;&#x62;&#x75;&#x68;&#111;&#x6d;&#x40;&#x6e;&#x65;&#116;&#46;&#x68;&#x72;\">&#116;&#x72;&#x62;&#x75;&#x68;&#111;&#x6d;&#x40;&#x6e;&#x65;&#116;&#46;&#x68;&#x72;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>61%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/cz.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Czech</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/cs_CZ.po\">cs_CZ</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Lukas Helebrandt <a href=\"&#109;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#108;&#x75;&#x6b;&#97;&#x73;&#x40;&#x61;&#x69;&#121;&#97;&#46;&#x63;&#x7a;\">&#108;&#x75;&#x6b;&#97;&#x73;&#x40;&#x61;&#x69;&#121;&#97;&#46;&#x63;&#x7a;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Lukas Helebrandt <a href=\"&#x6d;&#x61;&#105;&#108;&#116;&#x6f;&#x3a;&#108;&#117;&#x6b;&#x61;&#115;&#64;&#97;&#x69;&#121;&#97;&#46;&#99;&#122;\">&#108;&#117;&#x6b;&#x61;&#115;&#64;&#97;&#x69;&#121;&#97;&#46;&#99;&#122;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>95%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/de.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Deutsch</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/de_DE.po\">de_DE</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Philipp Zumstein <a href=\"&#x6d;&#97;&#x69;&#108;&#x74;&#x6f;&#x3a;&#122;&#x75;&#x70;&#104;&#105;&#108;&#105;&#x70;&#64;&#103;&#109;&#97;&#x69;&#x6c;&#46;&#x63;&#111;&#x6d;\">&#122;&#x75;&#x70;&#104;&#105;&#108;&#105;&#x70;&#64;&#103;&#109;&#97;&#x69;&#x6c;&#46;&#x63;&#111;&#x6d;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Philipp Zumstein <a href=\"&#x6d;&#x61;&#105;&#108;&#x74;&#x6f;&#58;&#122;&#117;&#x70;&#104;&#x69;&#108;&#x69;&#x70;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;\">&#122;&#117;&#x70;&#104;&#x69;&#108;&#x69;&#x70;&#64;&#x67;&#109;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>98%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/es.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Español</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/es_ES.po\">es_ES</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Fernando Martín <a href=\"&#x6d;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#102;&#64;&#x6d;&#114;&#116;&#x6e;&#x2e;&#101;&#115;\">&#102;&#64;&#x6d;&#114;&#116;&#x6e;&#x2e;&#101;&#115;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Fernando Martín <a href=\"&#x6d;&#97;&#105;&#x6c;&#116;&#111;&#58;&#102;&#64;&#109;&#x72;&#116;&#110;&#46;&#x65;&#x73;\">&#102;&#64;&#109;&#x72;&#116;&#110;&#46;&#x65;&#x73;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>99%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/es.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Galician</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/gl_ES.po\">gl_ES</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Marcos Lans <a href=\"&#x6d;&#97;&#x69;&#108;&#116;&#111;&#58;&#x6d;&#97;&#114;&#99;&#111;&#x73;&#108;&#x61;&#110;&#x73;&#103;&#97;&#x72;&#122;&#97;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#109;\">&#x6d;&#97;&#114;&#99;&#111;&#x73;&#108;&#x61;&#110;&#x73;&#103;&#97;&#x72;&#122;&#97;&#64;&#x67;&#x6d;&#x61;&#x69;&#108;&#46;&#x63;&#111;&#109;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Marcos Lans <a href=\"&#x6d;&#x61;&#x69;&#x6c;&#116;&#111;&#x3a;&#109;&#x61;&#114;&#x63;&#x6f;&#115;&#x6c;&#97;&#110;&#115;&#103;&#97;&#x72;&#122;&#x61;&#x40;&#103;&#109;&#97;&#105;&#x6c;&#46;&#x63;&#x6f;&#x6d;\">&#109;&#x61;&#114;&#x63;&#x6f;&#115;&#x6c;&#97;&#110;&#115;&#103;&#97;&#x72;&#122;&#x61;&#x40;&#103;&#109;&#97;&#105;&#x6c;&#46;&#x63;&#x6f;&#x6d;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>95%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/br.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Português (Brasil)</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/pt_BR.po\">pt_BR</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Renato Nunes Bastos <a href=\"&#x6d;&#x61;&#105;&#108;&#116;&#111;&#58;&#x72;&#x6e;&#x62;&#97;&#x73;&#116;&#x6f;&#x73;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#46;&#x63;&#x6f;&#109;\">&#x72;&#x6e;&#x62;&#97;&#x73;&#116;&#x6f;&#x73;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#46;&#x63;&#x6f;&#109;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Renato Nunes Bastos <a href=\"&#x6d;&#97;&#105;&#108;&#x74;&#111;&#x3a;&#x72;&#110;&#x62;&#x61;&#115;&#x74;&#111;&#x73;&#x40;&#x67;&#109;&#x61;&#105;&#108;&#46;&#99;&#111;&#109;\">&#x72;&#110;&#x62;&#x61;&#115;&#x74;&#111;&#x73;&#x40;&#x67;&#109;&#x61;&#105;&#108;&#46;&#99;&#111;&#109;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>97%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          },
          {
            "type": "context",
            "line": " <td><img src=\"https://joplin.cozic.net/images/flags/country-4x3/ru.png\" alt=\"\"></td>"
          },
          {
            "type": "context",
            "line": " <td>Русский</td>"
          },
          {
            "type": "context",
            "line": " <td><a href=\"https://github.com/laurent22/joplin/blob/master/CliClient/locales/ru_RU.po\">ru_RU</a></td>"
          },
          {
            "type": "delete",
            "line": "<td>Artyom Karlov <a href=\"&#x6d;&#x61;&#x69;&#x6c;&#x74;&#111;&#x3a;&#97;&#114;&#116;&#x79;&#x6f;&#x6d;&#x2e;&#x6b;&#97;&#x72;&#x6c;&#x6f;&#x76;&#64;&#x67;&#x6d;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;\">&#97;&#114;&#116;&#x79;&#x6f;&#x6d;&#x2e;&#x6b;&#97;&#x72;&#x6c;&#x6f;&#x76;&#64;&#x67;&#x6d;&#97;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;</a></td>"
          },
          {
            "type": "add",
            "line": "<td>Artyom Karlov <a href=\"&#x6d;&#97;&#x69;&#108;&#x74;&#x6f;&#x3a;&#97;&#x72;&#116;&#121;&#111;&#109;&#x2e;&#107;&#97;&#114;&#x6c;&#x6f;&#x76;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#109;\">&#97;&#x72;&#116;&#121;&#111;&#109;&#x2e;&#107;&#97;&#114;&#x6c;&#x6f;&#x76;&#x40;&#x67;&#109;&#97;&#x69;&#108;&#x2e;&#x63;&#x6f;&#109;</a></td>"
          },
          {
            "type": "context",
            "line": " <td>94%</td>"
          },
          {
            "type": "context",
            "line": " </tr>"
          },
          {
            "type": "context",
            "line": " <tr>"
          }
        ]
      }
    ]
  },
  {
    "commit": "498ac77e54541177be27b0c710e387c47b3836ea",
    "files": [
      {
        "file": "CHANGELOG.md",
        "changes": [
          {
            "type": "context",
            "line": "index 01dc89713..f1cf8433e 100644"
          },
          {
            "type": "context",
            "line": "--- a/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": " #### v1.2.0"
          },
          {
            "type": "context",
            "line": "  - DataObject used to automatically reload version after save, but now it's triggered only on successfull save. The reload can be forced by setting `forceReloadVersionsAfterSave` to `true` in a `postSaveObject` event listener."
          },
          {
            "type": "add",
            "line": " - [User -> Settings] When resetting password, setting the new password same as the old one would throw an error."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #### v1.1.0"
          },
          {
            "type": "context",
            "line": "  - `Pimcore\\Bundle\\AdminBundle\\Service\\ElementService` is marked as internal."
          }
        ]
      },
      {
        "file": "src/Controller/Admin/UserController.php",
        "changes": [
          {
            "type": "context",
            "line": "index 4a1b242b3..146ad8519 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Controller/Admin/UserController.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/Controller/Admin/UserController.php"
          },
          {
            "type": "context",
            "line": "                     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     if ($oldPasswordCheck && $values['new_password'] == $values['retype_password']) {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "                        if (Tool\\Authentication::verifyPassword($user, $values['new_password'])) {"
          },
          {
            "type": "add",
            "line": "                            throw new \\Exception('The new password cannot be the same as the old one');"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "                         $values['password'] = Tool\\Authentication::getPasswordHash($user->getName(), $values['new_password']);"
          },
          {
            "type": "context",
            "line": "                     } else {"
          },
          {
            "type": "context",
            "line": "                         if (!$oldPasswordCheck) {"
          }
        ]
      }
    ]
  },
  {
    "commit": "4ab7d19776011288b875abd3eef1e1f6f75289e2",
    "files": [
      {
        "file": "client/src/views/email/fields/email-address-varchar.js",
        "changes": [
          {
            "type": "context",
            "line": "index 16bde39ac5..6fdb69540f 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/email/fields/email-address-varchar.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/email/fields/email-address-varchar.js"
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         addAddress: function (address, name, type, id) {"
          },
          {
            "type": "add",
            "line": "            if (name) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(name);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (this.justAddedAddress) {"
          },
          {
            "type": "context",
            "line": "                 this.deleteAddress(this.justAddedAddress);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         addAddressHtml: function (address, name) {"
          },
          {
            "type": "add",
            "line": "            if (name) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(name);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            if (address) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(address);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var conteiner = this.$el.find('.link-container');"
          },
          {
            "type": "context",
            "line": "             var html ="
          },
          {
            "type": "context",
            "line": "             '<div data-address=\"'+address+'\" class=\"list-group-item\">' +"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var addressHtml = '<span>' + address + '</span>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (name) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(name);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var lineHtml;"
          },
          {
            "type": "context",
            "line": "             if (id) {"
          },
          {
            "type": "context",
            "line": "                 lineHtml = '<div>' + '<a href=\"#' + entityType + '/view/' + id + '\">' + name + '</a> <span class=\"text-muted\">&#187;</span> ' + addressHtml + '</div>';"
          }
        ]
      },
      {
        "file": "client/src/views/email/fields/from-address-varchar.js",
        "changes": [
          {
            "type": "context",
            "line": "index 7ee43b3314..8c12df447d 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/email/fields/from-address-varchar.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/email/fields/from-address-varchar.js"
          },
          {
            "type": "context",
            "line": "             var fromString = this.model.get('fromString') || this.model.get('fromName');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var name = this.nameHash[address] || this.parseNameFromStringAddress(fromString) || null;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (name) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(name);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var entityType = this.typeHash[address] || null;"
          },
          {
            "type": "context",
            "line": "             var id = this.idHash[address] || null;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         getCreateHtml: function (address) {"
          },
          {
            "type": "add",
            "line": "            address = this.getHelper().escapeString(address);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var html = '<span class=\"dropdown email-address-create-dropdown pull-right\">' +"
          },
          {
            "type": "context",
            "line": "                 '<button class=\"dropdown-toggle btn btn-link btn-sm\" data-toggle=\"dropdown\">' +"
          },
          {
            "type": "context",
            "line": "                     '<span class=\"caret text-muted\"></span>' +"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (name) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(name);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var attributes = {"
          },
          {
            "type": "context",
            "line": "                 emailAddress: address"
          },
          {
            "type": "context",
            "line": "             };"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            if (name) {"
          },
          {
            "type": "add",
            "line": "                name = this.getHelper().escapeString(name);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var attributes = {"
          },
          {
            "type": "context",
            "line": "                 emailAddress: address"
          },
          {
            "type": "context",
            "line": "             };"
          }
        ]
      },
      {
        "file": "client/src/views/fields/link-multiple-with-primary.js",
        "changes": [
          {
            "type": "context",
            "line": "index eb99144657..c790478338 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/fields/link-multiple-with-primary.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/fields/link-multiple-with-primary.js"
          },
          {
            "type": "context",
            "line": "             var $container = this.$el.find('.link-container');"
          },
          {
            "type": "context",
            "line": "             var $el = $('<div class=\"form-inline list-group-item link-with-role clearfix link-group-item-with-primary\">').addClass('link-' + id).attr('data-id', id);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            var nameHtml = '<div>' + name + '&nbsp;' + '</div>';"
          },
          {
            "type": "add",
            "line": "            var nameHtml = '<div>' + this.getHelper().escapeString(name) + '&nbsp;' + '</div>';"
          },
          {
            "type": "context",
            "line": "             var removeHtml = '<a href=\"javascript:\" class=\"pull-right\" data-id=\"' + id + '\" data-action=\"clearLink\"><span class=\"fas fa-times\"></a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             $left = $('<div>');"
          }
        ]
      },
      {
        "file": "client/src/views/notification/items/assign.js",
        "changes": [
          {
            "type": "context",
            "line": "index e8de5a0056..4469acda7c 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/notification/items/assign.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/notification/items/assign.js"
          },
          {
            "type": "context",
            "line": "             this.userId = data.userId;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.messageData['entityType'] = Espo.Utils.upperCaseFirst((this.translate(data.entityType, 'scopeNames') || '').toLowerCase());"
          },
          {
            "type": "delete",
            "line": "            this.messageData['entity'] = '<a href=\"#' + data.entityType + '/view/' + data.entityId + '\">' + data.entityName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['entity'] = '<a href=\"#' + this.getHelper().escapeString(data.entityType) + '/view/' + this.getHelper().escapeString(data.entityId) + '\">' + this.getHelper().escapeString(data.entityName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.createMessage();"
          },
          {
            "type": "context",
            "line": "         },"
          }
        ]
      },
      {
        "file": "client/src/views/notification/items/email-received.js",
        "changes": [
          {
            "type": "context",
            "line": "index 8f6fa64d28..fb0f59e713 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/notification/items/email-received.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/notification/items/email-received.js"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.userId = data.userId;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['entityType'] = Espo.Utils.upperCaseFirst((this.translate(data.entityType, 'scopeNames') || '').toLowerCase());"
          },
          {
            "type": "add",
            "line": "            this.messageData['entityType'] = this.getHelper().escapeString(Espo.Utils.upperCaseFirst((this.translate(data.entityType, 'scopeNames') || '').toLowerCase()));"
          },
          {
            "type": "context",
            "line": "             if (data.personEntityId) {"
          },
          {
            "type": "delete",
            "line": "                this.messageData['from'] = '<a href=\"#' + data.personEntityType + '/view/' + data.personEntityId + '\">' + data.personEntityName + '</a>';"
          },
          {
            "type": "add",
            "line": "                this.messageData['from'] = '<a href=\"#' + this.getHelper().escapeString(data.personEntityType) + '/view/' + this.getHelper().escapeString(data.personEntityId) + '\">' + this.getHelper().escapeString(data.personEntityName) + '</a>';"
          },
          {
            "type": "context",
            "line": "             } else {"
          },
          {
            "type": "delete",
            "line": "                this.messageData['from'] = data.fromString || this.translate('empty address');"
          },
          {
            "type": "add",
            "line": "                this.messageData['from'] = this.getHelper().escapeString(data.fromString || this.translate('empty address'));"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.emailId = data.emailId;"
          },
          {
            "type": "delete",
            "line": "            this.emailName = data.emailName;"
          },
          {
            "type": "add",
            "line": "            this.emailId = this.getHelper().escapeString(data.emailId);"
          },
          {
            "type": "add",
            "line": "            this.emailName = this.getHelper().escapeString(data.emailName);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.createMessage();"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": " });"
          },
          {
            "type": "delete",
            "line": ""
          }
        ]
      },
      {
        "file": "client/src/views/notification/items/entity-removed.js",
        "changes": [
          {
            "type": "context",
            "line": "index 217dd41616..ca2e54fbd2 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/notification/items/entity-removed.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/notification/items/entity-removed.js"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.userId = data.userId;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['entityType'] = (this.translate(data.entityType, 'scopeNames') || '').toLowerCase();"
          },
          {
            "type": "add",
            "line": "            this.messageData['entityType'] = this.getHelper().escapeString((this.translate(data.entityType, 'scopeNames') || '').toLowerCase());"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['user'] = '<a href=\"#User/view/' + data.userId + '\">' + data.userName + '</a>';"
          },
          {
            "type": "delete",
            "line": "            this.messageData['entity'] = '<a href=\"#'+data.entityType+'/view/' + data.entityId + '\">' + data.entityName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['user'] = '<a href=\"#User/view/' + this.getHelper().escapeString(data.userId) + '\">' + this.getHelper().escapeString(data.userName) + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['entity'] = '<a href=\"#'+this.getHelper().escapeString(data.entityType)+'/view/' + this.getHelper().escapeString(data.entityId) + '\">' + this.getHelper().escapeString(data.entityName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.createMessage();"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "client/src/views/notification/items/message.js",
        "changes": [
          {
            "type": "context",
            "line": "index a75b2c13f7..fa5a88a764 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/notification/items/message.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/notification/items/message.js"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.userId = data.userId;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['entityType'] = Espo.Utils.upperCaseFirst((this.translate(data.entityType, 'scopeNames') || '').toLowerCase());"
          },
          {
            "type": "add",
            "line": "            this.messageData['entityType'] = this.getHelper().escapeString(Espo.Utils.upperCaseFirst((this.translate(data.entityType, 'scopeNames') || '').toLowerCase()));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['user'] = '<a href=\"#User/view/' + data.userId + '\">' + data.userName + '</a>';"
          },
          {
            "type": "delete",
            "line": "            this.messageData['entity'] = '<a href=\"#'+data.entityType+'/view/' + data.entityId + '\">' + data.entityName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['user'] = '<a href=\"#User/view/' + this.getHelper().escapeString(data.userId) + '\">' + this.getHelper().escapeString(data.userName) + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['entity'] = '<a href=\"#'+this.getHelper().escapeString(data.entityType)+'/view/' + this.getHelper().escapeString(data.entityId) + '\">' + this.getHelper().escapeString(data.entityName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.createMessage();"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "client/src/views/site/navbar.js",
        "changes": [
          {
            "type": "context",
            "line": "index 069b4e01f4..25a48a4477 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/site/navbar.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/site/navbar.js"
          },
          {
            "type": "context",
            "line": "                 menuDataList: this.getMenuDataList(),"
          },
          {
            "type": "context",
            "line": "                 quickCreateList: this.quickCreateList,"
          },
          {
            "type": "context",
            "line": "                 enableQuickCreate: this.quickCreateList.length > 0,"
          },
          {
            "type": "delete",
            "line": "                userName: this.getUser().get('name'),"
          },
          {
            "type": "context",
            "line": "                 userId: this.getUser().id,"
          },
          {
            "type": "context",
            "line": "                 logoSrc: this.getLogoSrc()"
          },
          {
            "type": "context",
            "line": "             };"
          },
          {
            "type": "context",
            "line": "             var list = ["
          },
          {
            "type": "context",
            "line": "                 {"
          },
          {
            "type": "context",
            "line": "                     link: '#User/view/' + this.getUser().id,"
          },
          {
            "type": "delete",
            "line": "                    html: avatarHtml + this.getUser().get('name')"
          },
          {
            "type": "add",
            "line": "                    html: avatarHtml + this.getHelper().escapeString(this.getUser().get('name')),"
          },
          {
            "type": "context",
            "line": "                 },"
          },
          {
            "type": "context",
            "line": "                 {divider: true}"
          },
          {
            "type": "context",
            "line": "             ];"
          }
        ]
      },
      {
        "file": "client/src/views/stream/note.js",
        "changes": [
          {
            "type": "context",
            "line": "index 46d74a674c..4e2de43044 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/note.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/note.js"
          },
          {
            "type": "context",
            "line": "             this.messageData = {"
          },
          {
            "type": "context",
            "line": "                 'user': 'field:createdBy',"
          },
          {
            "type": "context",
            "line": "                 'entity': 'field:parent',"
          },
          {
            "type": "delete",
            "line": "                'entityType': this.translateEntityType(this.model.get('parentType')),"
          },
          {
            "type": "add",
            "line": "                'entityType': this.getHelper().escapeString(this.translateEntityType(this.model.get('parentType'))),"
          },
          {
            "type": "context",
            "line": "             };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (!this.options.noEdit && (this.isEditable || this.isRemovable)) {"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/assign.js",
        "changes": [
          {
            "type": "context",
            "line": "index 147605badc..649dbacf48 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/assign.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/assign.js"
          },
          {
            "type": "context",
            "line": "             this.assignedUserId = data.assignedUserId || null;"
          },
          {
            "type": "context",
            "line": "             this.assignedUserName = data.assignedUserName || null;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['assignee'] = '<a href=\"#User/view/' + data.assignedUserId + '\">' + data.assignedUserName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['assignee'] = '<a href=\"#User/view/' + this.getHelper().escapeString(data.assignedUserId) + '\">' + this.getHelper().escapeString(data.assignedUserName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (this.isUserStream) {"
          },
          {
            "type": "context",
            "line": "                 if (this.assignedUserId) {"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/create-related.js",
        "changes": [
          {
            "type": "context",
            "line": "index b269f4eed1..1d6ab2ba4d 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/create-related.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/create-related.js"
          },
          {
            "type": "context",
            "line": "             this.entityName = this.model.get('relatedName') ||  data.entityName || null;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.messageData['relatedEntityType'] = this.translateEntityType(this.entityType);"
          },
          {
            "type": "delete",
            "line": "            this.messageData['relatedEntity'] = '<a href=\"#' + this.entityType + '/view/' + this.entityId + '\">' + this.entityName +'</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['relatedEntity'] = '<a href=\"#' + this.getHelper().escapeString(this.entityType) + '/view/' + this.getHelper().escapeString(this.entityId) + '\">' + this.getHelper().escapeString(this.entityName) +'</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.createMessage();"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/create.js",
        "changes": [
          {
            "type": "context",
            "line": "index cda35873a8..60c2021a5c 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/create.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/create.js"
          },
          {
            "type": "context",
            "line": "                 this.assignedUserId = data.assignedUserId || null;"
          },
          {
            "type": "context",
            "line": "                 this.assignedUserName = data.assignedUserName || null;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "                this.messageData['assignee'] = '<a href=\"#User/view/' + this.assignedUserId + '\">' + this.assignedUserName + '</a>';"
          },
          {
            "type": "add",
            "line": "                this.messageData['assignee'] = '<a href=\"#User/view/' + this.assignedUserId + '\">' + this.getHelper().escapeString(this.assignedUserName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 var isYou = false;"
          },
          {
            "type": "context",
            "line": "                 if (this.isUserStream) {"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/email-received.js",
        "changes": [
          {
            "type": "context",
            "line": "index 1987018083..5cbd5d5b32 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/email-received.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/email-received.js"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['email'] = '<a href=\"#Email/view/' + data.emailId + '\">' + data.emailName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['email'] = '<a href=\"#Email/view/' + this.getHelper().escapeString(data.emailId) + '\">' + this.getHelper().escapeString(data.emailName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.messageName = 'emailReceived';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (data.personEntityId) {"
          },
          {
            "type": "context",
            "line": "                 this.messageName += 'From';"
          },
          {
            "type": "delete",
            "line": "                this.messageData['from'] = '<a href=\"#'+data.personEntityType+'/view/' + data.personEntityId + '\">' + data.personEntityName + '</a>';"
          },
          {
            "type": "add",
            "line": "                this.messageData['from'] = '<a href=\"#'+this.getHelper().escapeString(data.personEntityType)+'/view/' + this.getHelper().escapeString(data.personEntityId) + '\">' + this.getHelper().escapeString(data.personEntityName) + '</a>';"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (this.model.get('parentType') === data.personEntityType && this.model.get('parentId') == data.personEntityId) {"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/email-sent.js",
        "changes": [
          {
            "type": "context",
            "line": "index c033fee552..fb56a0b636 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/email-sent.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/email-sent.js"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['email'] = '<a href=\"#Email/view/' + data.emailId + '\">' + data.emailName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['email'] = '<a href=\"#Email/view/' + this.getHelper().escapeString(data.emailId) + '\">' + this.getHelper().escapeString(data.emailName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.messageName = 'emailSent';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.messageData['by'] = '<a href=\"#'+data.personEntityType+'/view/' + data.personEntityId + '\">' + data.personEntityName + '</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['by'] = '<a href=\"#'+this.getHelper().escapeString(data.personEntityType)+'/view/' + this.getHelper().escapeString(data.personEntityId) + '\">' + this.getHelper().escapeString(data.personEntityName) + '</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             if (this.isThis) {"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/mention-in-post.js",
        "changes": [
          {
            "type": "context",
            "line": "index 2ea90e7979..80d98cf559 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/mention-in-post.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/mention-in-post.js"
          },
          {
            "type": "context",
            "line": "                                 teamIdList.forEach(function (teamId) {"
          },
          {
            "type": "context",
            "line": "                                     var teamName = teamNameHash[teamId];"
          },
          {
            "type": "context",
            "line": "                                     if (teamName) {"
          },
          {
            "type": "delete",
            "line": "                                        teamHtmlList.push('<a href=\"#Team/view/' + teamId + '\">' + teamName + '</a>');"
          },
          {
            "type": "add",
            "line": "                                        teamHtmlList.push('<a href=\"#Team/view/' + this.getHelper().escapeString(teamId) + '\">' + this.getHelper().escapeString(teamName) + '</a>');"
          },
          {
            "type": "context",
            "line": "                                     }"
          },
          {
            "type": "context",
            "line": "                                 }, this);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                                     userIdList.forEach(function (userId) {"
          },
          {
            "type": "context",
            "line": "                                         var userName = userNameHash[userId];"
          },
          {
            "type": "context",
            "line": "                                         if (userName) {"
          },
          {
            "type": "delete",
            "line": "                                            userHtmlList.push('<a href=\"#User/view/' + userId + '\">' + userName + '</a>');"
          },
          {
            "type": "add",
            "line": "                                            userHtmlList.push('<a href=\"#User/view/' + this.getHelper().escapeString(userId) + '\">' + this.getHelper().escapeString(userName) + '</a>');"
          },
          {
            "type": "context",
            "line": "                                         }"
          },
          {
            "type": "context",
            "line": "                                     }, this);"
          },
          {
            "type": "context",
            "line": "                                     this.messageData['target'] = userHtmlList.join(', ');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": " });"
          },
          {
            "type": "delete",
            "line": ""
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/post.js",
        "changes": [
          {
            "type": "context",
            "line": "index 96c6a6c748..a50af61e3d 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/post.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/post.js"
          },
          {
            "type": "context",
            "line": "                         teamIdList.forEach(function (teamId) {"
          },
          {
            "type": "context",
            "line": "                             var teamName = teamNameHash[teamId];"
          },
          {
            "type": "context",
            "line": "                             if (teamName) {"
          },
          {
            "type": "delete",
            "line": "                                teamHtmlList.push('<a href=\"#Team/view/' + teamId + '\">' + teamName + '</a>');"
          },
          {
            "type": "add",
            "line": "                                teamHtmlList.push('<a href=\"#Team/view/' + this.getHelper().escapeString(teamId) + '\">' + this.getHelper().escapeString(teamName) + '</a>');"
          },
          {
            "type": "context",
            "line": "                             }"
          },
          {
            "type": "context",
            "line": "                         }, this);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                         portalIdList.forEach(function (portalId) {"
          },
          {
            "type": "context",
            "line": "                             var portalName = portalNameHash[portalId];"
          },
          {
            "type": "context",
            "line": "                             if (portalName) {"
          },
          {
            "type": "delete",
            "line": "                                portalHtmlList.push('<a href=\"#Portal/view/' + portalId + '\">' + portalName + '</a>');"
          },
          {
            "type": "add",
            "line": "                                portalHtmlList.push('<a href=\"#Portal/view/' + this.getHelper().escapeString(portalId) + '\">' + this.getHelper().escapeString(portalName) + '</a>');"
          },
          {
            "type": "context",
            "line": "                             }"
          },
          {
            "type": "context",
            "line": "                         }, this);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                                     } else {"
          },
          {
            "type": "context",
            "line": "                                         var userName = userNameHash[userId];"
          },
          {
            "type": "context",
            "line": "                                         if (userName) {"
          },
          {
            "type": "delete",
            "line": "                                            userHtmlList.push('<a href=\"#User/view/' + userId + '\">' + userName + '</a>');"
          },
          {
            "type": "add",
            "line": "                                            userHtmlList.push('<a href=\"#User/view/' + this.getHelper().escapeString(userId) + '\">' + this.getHelper().escapeString(userName) + '</a>');"
          },
          {
            "type": "context",
            "line": "                                         }"
          },
          {
            "type": "context",
            "line": "                                     }"
          },
          {
            "type": "context",
            "line": "                                 }"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/relate.js",
        "changes": [
          {
            "type": "context",
            "line": "index 261a8eb963..0ae91a4198 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/relate.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/relate.js"
          },
          {
            "type": "context",
            "line": "             this.entityName = this.model.get('relatedName') ||  data.entityName || null;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.messageData['relatedEntityType'] = this.translateEntityType(this.entityType);"
          },
          {
            "type": "delete",
            "line": "            this.messageData['relatedEntity'] = '<a href=\"#' + this.entityType + '/view/' + this.entityId + '\">' + this.entityName +'</a>';"
          },
          {
            "type": "add",
            "line": "            this.messageData['relatedEntity'] = '<a href=\"#' + this.getHelper().escapeString(this.entityType) + '/view/' + this.getHelper().escapeString(this.entityId) + '\">' + this.getHelper().escapeString(this.entityName) +'</a>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.createMessage();"
          },
          {
            "type": "context",
            "line": "         },"
          }
        ]
      },
      {
        "file": "client/src/views/stream/notes/status.js",
        "changes": [
          {
            "type": "context",
            "line": "index 571eb40381..4723ede35f 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/stream/notes/status.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/stream/notes/status.js"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.style = data.style || 'default';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            this.statusText = this.getLanguage().translateOption(value, field, this.model.get('parentType'));"
          },
          {
            "type": "add",
            "line": "            this.statusText = this.getHelper().escapeString(this.getLanguage().translateOption(value, field, this.model.get('parentType')));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             this.messageData['field'] = this.translate(field, 'fields', this.model.get('parentType')).toLowerCase();"
          }
        ]
      }
    ]
  },
  {
    "commit": "4c1df9927d1dc6b0181ee20721f93346def026fd",
    "files": [
      {
        "file": "application/loginbasic.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index 660b45cba..24b1afb2d 100644"
          },
          {
            "type": "context",
            "line": "--- a/application/loginbasic.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/application/loginbasic.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$iErrorCode = LoginWebPage::EXIT_CODE_WRONGCREDENTIALS;"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn LoginWebPage::LOGIN_FSM_ERROR;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t// Save the checked user"
          },
          {
            "type": "add",
            "line": "\t\t\t$_SESSION['auth_user'] = $sAuthUser;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tif ($_SESSION['login_mode'] == 'basic')"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\tlist($sAuthUser) = $this->GetAuthUserAndPassword();"
          },
          {
            "type": "add",
            "line": "\t\t\t$sAuthUser = $_SESSION['auth_user'];"
          },
          {
            "type": "context",
            "line": " \t\t\tLoginWebPage::OnLoginSuccess($sAuthUser, 'internal', $_SESSION['login_mode']);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          }
        ]
      },
      {
        "file": "application/loginexternal.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index d4fcb7182..c2c13de86 100644"
          },
          {
            "type": "context",
            "line": "--- a/application/loginexternal.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/application/loginexternal.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$iErrorCode = LoginWebPage::EXIT_CODE_WRONGCREDENTIALS;"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn LoginWebPage::LOGIN_FSM_ERROR;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t// Save the checked user"
          },
          {
            "type": "add",
            "line": "\t\t\t$_SESSION['auth_user'] = $sAuthUser;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tif ($_SESSION['login_mode'] == 'external')"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t$sAuthUser = $this->GetAuthUser();"
          },
          {
            "type": "add",
            "line": "\t\t\t$sAuthUser = $_SESSION['auth_user'];"
          },
          {
            "type": "context",
            "line": " \t\t\tLoginWebPage::OnLoginSuccess($sAuthUser, 'external', $_SESSION['login_mode']);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          }
        ]
      },
      {
        "file": "application/loginform.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index a4fb99db5..9a044fade 100644"
          },
          {
            "type": "context",
            "line": "--- a/application/loginform.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/application/loginform.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$iErrorCode = LoginWebPage::EXIT_CODE_WRONGCREDENTIALS;"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn LoginWebPage::LOGIN_FSM_ERROR;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t// Save the checked user"
          },
          {
            "type": "add",
            "line": "\t\t\t$_SESSION['auth_user'] = $sAuthUser;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tif ($_SESSION['login_mode'] == 'form')"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (isset($_SESSION['auth_user']))"
          },
          {
            "type": "delete",
            "line": "\t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t// If FSM reenter this state (example 2FA) then the auth_user is not resubmitted"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$sAuthUser = $_SESSION['auth_user'];"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$sAuthUser = utils::ReadPostedParam('auth_user', '', 'raw_data');"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t$sAuthUser = $_SESSION['auth_user'];"
          },
          {
            "type": "context",
            "line": " \t\t\t// Store 'auth_user' in session for further use"
          },
          {
            "type": "context",
            "line": " \t\t\tLoginWebPage::OnLoginSuccess($sAuthUser, 'internal', $_SESSION['login_mode']);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      },
      {
        "file": "application/loginurl.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index 8a215e8f5..166941d31 100644"
          },
          {
            "type": "context",
            "line": "--- a/application/loginurl.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/application/loginurl.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$iErrorCode = LoginWebPage::EXIT_CODE_WRONGCREDENTIALS;"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn LoginWebPage::LOGIN_FSM_ERROR;"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t// Save the checked user"
          },
          {
            "type": "add",
            "line": "\t\t\t$_SESSION['auth_user'] = $sAuthUser;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tif ($_SESSION['login_mode'] == 'url')"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t$sAuthUser = utils::ReadParam('auth_user', '', false, 'raw_data');"
          },
          {
            "type": "add",
            "line": "\t\t\t$sAuthUser = $_SESSION['auth_user'];"
          },
          {
            "type": "context",
            "line": " \t\t\tLoginWebPage::OnLoginSuccess($sAuthUser, 'internal', $_SESSION['login_mode']);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn LoginWebPage::LOGIN_FSM_CONTINUE;"
          }
        ]
      }
    ]
  },
  {
    "commit": "4d6d4b43c6186a13e67b92eaf70fe1b70ea24a09",
    "files": [
      {
        "file": "public/embed.js",
        "changes": [
          {
            "type": "context",
            "line": "index dac507453..d597fd33c 100644"
          },
          {
            "type": "context",
            "line": "--- a/public/embed.js"
          },
          {
            "type": "context",
            "line": "+++ b/public/embed.js"
          },
          {
            "type": "context",
            "line": "     window.addEventListener('message', function(e) {"
          },
          {
            "type": "context",
            "line": "       var data = e.data || {};"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      if (data.type !== 'setHeight' || !iframes[data.id]) {"
          },
          {
            "type": "add",
            "line": "      if (data.type !== 'setHeight' || !iframes[data.id] || window.location.origin !== e.origin || data.id.toString() === '__proto__') {"
          },
          {
            "type": "context",
            "line": "         return;"
          },
          {
            "type": "context",
            "line": "       }"
          }
        ]
      }
    ]
  },
  {
    "commit": "4fce14795aba98e40b6c4f5047305aba17a6120d",
    "files": [
      {
        "file": "bin/composer",
        "changes": [
          {
            "type": "context",
            "line": "index b4f18dfdc..7a4013477 100755"
          },
          {
            "type": "context",
            "line": "--- a/bin/composer"
          },
          {
            "type": "context",
            "line": "+++ b/bin/composer"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " if (PHP_SAPI !== 'cli' && PHP_SAPI !== 'phpdbg') {"
          },
          {
            "type": "add",
            "line": "    if (0 === strpos(__FILE__, 'phar:') && ini_get('register_argc_argv')) {"
          },
          {
            "type": "add",
            "line": "        echo 'Composer cannot be run safely on non-CLI SAPIs with register_argc_argv=On. Aborting.'.PHP_EOL;"
          },
          {
            "type": "add",
            "line": "        exit(1);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     echo 'Warning: Composer should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "572e239c5702667ca52487faf861abc768a46308",
    "files": [
      {
        "file": ".githuworkflows/security.yml",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 8c73cce0..00000000"
          },
          {
            "type": "context",
            "line": "--- a/.github/workflows/security.yml"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "name: Security"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "on: [push]"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "jobs:"
          },
          {
            "type": "delete",
            "line": "  tests:"
          },
          {
            "type": "delete",
            "line": "    runs-on: ${{ matrix.operating-system }}"
          },
          {
            "type": "delete",
            "line": "    strategy:"
          },
          {
            "type": "delete",
            "line": "      matrix:"
          },
          {
            "type": "delete",
            "line": "        operating-system: [ubuntu-latest]"
          },
          {
            "type": "delete",
            "line": "        php-versions: ['7.4']"
          },
          {
            "type": "delete",
            "line": "    name: PHP ${{ matrix.php-versions }} Test on ${{ matrix.operating-system }}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    steps:"
          },
          {
            "type": "delete",
            "line": "      - name: Checkout"
          },
          {
            "type": "delete",
            "line": "        uses: actions/checkout@v2"
          },
          {
            "type": "delete",
            "line": "        with:"
          },
          {
            "type": "delete",
            "line": "          ref: ${{ github.head_ref }}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      - name: Setup PHP, with composer and extensions"
          },
          {
            "type": "delete",
            "line": "        uses: shivammathur/setup-php@v2"
          },
          {
            "type": "delete",
            "line": "        with:"
          },
          {
            "type": "delete",
            "line": "          php-version: ${{ matrix.php-versions }}"
          },
          {
            "type": "delete",
            "line": "          extensions: json, mbstring, openssl, gmp, curl, simplexml, intl"
          },
          {
            "type": "delete",
            "line": "          coverage: xdebug"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      - name: Install Composer dependencies"
          },
          {
            "type": "delete",
            "line": "        run: |"
          },
          {
            "type": "delete",
            "line": "          composer update --no-progress --no-suggest --prefer-dist --optimize-autoloader"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      - name: Security Check"
          },
          {
            "type": "delete",
            "line": "        run: |"
          },
          {
            "type": "delete",
            "line": "          wget -c https://get.sensiolabs.org/security-checker.phar"
          },
          {
            "type": "delete",
            "line": "          chmod +x security-checker.phar"
          },
          {
            "type": "delete",
            "line": "          ./security-checker.phar security:check"
          }
        ]
      },
      {
        "file": "README.md",
        "changes": [
          {
            "type": "context",
            "line": "index 08f6c9fe..228b4bc1 100644"
          },
          {
            "type": "context",
            "line": "--- a/README.md"
          },
          {
            "type": "context",
            "line": "+++ b/README.md"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ![Build Status](https://github.com/web-auth/webauthn-framework/workflows/Coding%20Standards/badge.svg)"
          },
          {
            "type": "context",
            "line": " ![Build Status](https://github.com/web-auth/webauthn-framework/workflows/Static%20Analyze/badge.svg)"
          },
          {
            "type": "delete",
            "line": "![Build Status](https://github.com/web-auth/webauthn-framework/workflows/Security/badge.svg)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ![Build Status](https://github.com/web-auth/webauthn-framework/workflows/Backwards%20compatibility%20verification/badge.svg)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Webauthn defines an API enabling the creation and use of strong, attested, scoped, public key-based credentials by web applications, for the purpose of strongly authenticating users."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "This framework contains PHP libraries and Symfony bundle to allow developpers to integrate that authentication mechanism into their web applications."
          },
          {
            "type": "add",
            "line": "This framework contains PHP libraries and Symfony bundle to allow developers to integrate that authentication mechanism into their web applications."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # Documentation"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "phpstan.neon",
        "changes": [
          {
            "type": "context",
            "line": "index 2f43d27b..3bf2c384 100644"
          },
          {
            "type": "context",
            "line": "--- a/phpstan.neon"
          },
          {
            "type": "context",
            "line": "+++ b/phpstan.neon"
          },
          {
            "type": "context",
            "line": "         - '#Call to deprecated function Symfony\\\\Component\\\\DependencyInjection\\\\Loader\\\\Configurator\\\\ref\\(\\)(.*)#'"
          },
          {
            "type": "context",
            "line": "         - '#Parameter (.*) of class FG\\\\ASN1\\\\Universal\\\\Integer constructor expects int, string given\\.#'"
          },
          {
            "type": "context",
            "line": "         - '#Instanceof between Symfony\\\\Component\\\\HttpFoundation\\\\Response and Symfony\\\\Component\\\\HttpFoundation\\\\Response will always evaluate to true\\.#'"
          },
          {
            "type": "add",
            "line": "        - '#Parameter (.*) of class Jose\\\\Component\\\\Core\\\\AlgorithmManager constructor expects array\\<Jose\\\\Component\\\\Core\\\\Algorithm\\>\\, array\\<int\\, object\\> given\\.#'"
          },
          {
            "type": "context",
            "line": "     checkMissingIterableValueType: false"
          },
          {
            "type": "context",
            "line": "     checkGenericClassInNonGenericObjectType: false"
          },
          {
            "type": "context",
            "line": "     treatPhpDocTypesAsCertain: false"
          }
        ]
      },
      {
        "file": "src/webauthn/src/AttestationStatement/AndroidSafetyNetAttestationStatementSupport.php",
        "changes": [
          {
            "type": "context",
            "line": "index 81a8e8f0..6ef7de68 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/AttestationStatement/AndroidSafetyNetAttestationStatementSupport.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/AttestationStatement/AndroidSafetyNetAttestationStatementSupport.php"
          },
          {
            "type": "context",
            "line": "             Algorithm\\ES256::class, Algorithm\\ES384::class, Algorithm\\ES512::class,"
          },
          {
            "type": "context",
            "line": "             Algorithm\\EdDSA::class,"
          },
          {
            "type": "context",
            "line": "         ];"
          },
          {
            "type": "add",
            "line": "        /* @var AlgorithmInterface[] $algorithms */"
          },
          {
            "type": "context",
            "line": "         $algorithms = [];"
          },
          {
            "type": "delete",
            "line": "        foreach ($algorithmClasses as $key => $algorithm) {"
          },
          {
            "type": "add",
            "line": "        foreach ($algorithmClasses as $algorithm) {"
          },
          {
            "type": "context",
            "line": "             if (class_exists($algorithm)) {"
          },
          {
            "type": "context",
            "line": "                 /* @var AlgorithmInterface $algorithm */"
          },
          {
            "type": "context",
            "line": "                 $algorithms[] = new $algorithm();"
          }
        ]
      },
      {
        "file": "src/webauthn/src/AttestationStatement/AppleAttestationStatementSupport.php",
        "changes": [
          {
            "type": "context",
            "line": "index c4279544..3f942e47 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/AttestationStatement/AppleAttestationStatementSupport.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/AttestationStatement/AppleAttestationStatementSupport.php"
          },
          {
            "type": "context",
            "line": "         Assertion::allString($certificates, 'The attestation statement value \"x5c\" must be a list with at least one certificate.');"
          },
          {
            "type": "context",
            "line": "         $certificates = CertificateToolbox::convertAllDERToPEM($certificates);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return AttestationStatement::createBasic($attestation['fmt'], $attestation['attStmt'], new CertificateTrustPath($certificates));"
          },
          {
            "type": "add",
            "line": "        return AttestationStatement::createAnonymizationCA($attestation['fmt'], $attestation['attStmt'], new CertificateTrustPath($certificates));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function isValid(string $clientDataJSONHash, AttestationStatement $attestationStatement, AuthenticatorData $authenticatorData): bool"
          }
        ]
      },
      {
        "file": "src/webauthn/src/AttestationStatement/AttestationStatement.php",
        "changes": [
          {
            "type": "context",
            "line": "index f84d5289..3de8bfb0 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/AttestationStatement/AttestationStatement.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/AttestationStatement/AttestationStatement.php"
          },
          {
            "type": "context",
            "line": "     public const TYPE_SELF = 'self';"
          },
          {
            "type": "context",
            "line": "     public const TYPE_ATTCA = 'attca';"
          },
          {
            "type": "context",
            "line": "     public const TYPE_ECDAA = 'ecdaa';"
          },
          {
            "type": "add",
            "line": "    public const TYPE_ANONCA = 'anonca';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * @var string"
          },
          {
            "type": "context",
            "line": "         return new self($fmt, $attStmt, self::TYPE_ECDAA, $trustPath);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public static function createAnonymizationCA(string $fmt, array $attStmt, TrustPath $trustPath): self"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return new self($fmt, $attStmt, self::TYPE_ANONCA, $trustPath);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function getFmt(): string"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return $this->fmt;"
          }
        ]
      },
      {
        "file": "src/webauthn/src/AuthenticatorAssertionResponseValidator.php",
        "changes": [
          {
            "type": "context",
            "line": "index 8400ba9c..65bdc3a7 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/AuthenticatorAssertionResponseValidator.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/AuthenticatorAssertionResponseValidator.php"
          },
          {
            "type": "context",
            "line": "             Assertion::true(hash_equals($rpIdHash, $authenticatorAssertionResponse->getAuthenticatorData()->getRpIdHash()), 'rpId hash mismatch.');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             /* @see 7.2.12 */"
          },
          {
            "type": "delete",
            "line": "            //Nothing to do. The verification of the bit is done during the authenticator data loading"
          },
          {
            "type": "add",
            "line": "            Assertion::true($authenticatorAssertionResponse->getAuthenticatorData()->isUserPresent(), 'User was not present');"
          },
          {
            "type": "context",
            "line": "             /* @see 7.2.13 */"
          },
          {
            "type": "context",
            "line": "             if (AuthenticatorSelectionCriteria::USER_VERIFICATION_REQUIREMENT_REQUIRED === $publicKeyCredentialRequestOptions->getUserVerification()) {"
          },
          {
            "type": "context",
            "line": "                 Assertion::true($authenticatorAssertionResponse->getAuthenticatorData()->isUserVerified(), 'User authentication required.');"
          }
        ]
      },
      {
        "file": "src/webauthn/src/AuthenticatorAttestationResponseValidator.php",
        "changes": [
          {
            "type": "context",
            "line": "index f3e5a15d..d2f1ee18 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/AuthenticatorAttestationResponseValidator.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/AuthenticatorAttestationResponseValidator.php"
          },
          {
            "type": "context",
            "line": "             Assertion::true(hash_equals($rpIdHash, $attestationObject->getAuthData()->getRpIdHash()), 'rpId hash mismatch.');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             /* @see 7.1.10 */"
          },
          {
            "type": "delete",
            "line": "            //Nothing to do. The verification of the bit is done during the authenticator data loading"
          },
          {
            "type": "add",
            "line": "            Assertion::true($attestationObject->getAuthData()->isUserPresent(), 'User was not present');"
          },
          {
            "type": "context",
            "line": "             /* @see 7.1.11 */"
          },
          {
            "type": "context",
            "line": "             if (AuthenticatorSelectionCriteria::USER_VERIFICATION_REQUIREMENT_REQUIRED === $publicKeyCredentialCreationOptions->getAuthenticatorSelection()->getUserVerification()) {"
          },
          {
            "type": "context",
            "line": "                 Assertion::true($attestationObject->getAuthData()->isUserVerified(), 'User authentication required.');"
          }
        ]
      },
      {
        "file": "src/webauthn/src/PublicKeyCredentialSource.php",
        "changes": [
          {
            "type": "context",
            "line": "index 091b5266..a4f17847 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/PublicKeyCredentialSource.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/PublicKeyCredentialSource.php"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     protected $counter;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @var array|null"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    protected $otherUI;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * @param string[] $transports"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "delete",
            "line": "    public function __construct(string $publicKeyCredentialId, string $type, array $transports, string $attestationType, TrustPath $trustPath, UuidInterface $aaguid, string $credentialPublicKey, string $userHandle, int $counter)"
          },
          {
            "type": "add",
            "line": "    public function __construct(string $publicKeyCredentialId, string $type, array $transports, string $attestationType, TrustPath $trustPath, UuidInterface $aaguid, string $credentialPublicKey, string $userHandle, int $counter, ?array $otherUI = null)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $this->publicKeyCredentialId = $publicKeyCredentialId;"
          },
          {
            "type": "context",
            "line": "         $this->type = $type;"
          },
          {
            "type": "context",
            "line": "         $this->counter = $counter;"
          },
          {
            "type": "context",
            "line": "         $this->attestationType = $attestationType;"
          },
          {
            "type": "context",
            "line": "         $this->trustPath = $trustPath;"
          },
          {
            "type": "add",
            "line": "        $this->otherUI = $otherUI;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function getPublicKeyCredentialId(): string"
          },
          {
            "type": "context",
            "line": "         $this->counter = $counter;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function getOtherUI(): ?array"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return $this->otherUI;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function setOtherUI(?array $otherUI): self"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->otherUI = $otherUI;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return $this;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      * @param mixed[] $data"
          },
          {
            "type": "context",
            "line": "      */"
          }
        ]
      },
      {
        "file": "src/webauthn/src/PublicKeyCredentialUserEntity.php",
        "changes": [
          {
            "type": "context",
            "line": "index 41ff3a94..b0446e26 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/webauthn/src/PublicKeyCredentialUserEntity.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/webauthn/src/PublicKeyCredentialUserEntity.php"
          },
          {
            "type": "context",
            "line": "     public function __construct(string $name, string $id, string $displayName, ?string $icon = null)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         parent::__construct($name, $icon);"
          },
          {
            "type": "add",
            "line": "        Assertion::maxLength($id, 64, 'User ID max length is 64 bytes', 'id', '8bit');"
          },
          {
            "type": "context",
            "line": "         $this->id = $id;"
          },
          {
            "type": "context",
            "line": "         $this->displayName = $displayName;"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "tests/library/Functional/AppleAttestationStatementTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index 7303d4a6..26ad6d12 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/library/Functional/AppleAttestationStatementTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/library/Functional/AppleAttestationStatementTest.php"
          },
          {
            "type": "context",
            "line": " use Base64Url\\Base64Url;"
          },
          {
            "type": "context",
            "line": " use Cose\\Algorithms;"
          },
          {
            "type": "context",
            "line": " use Symfony\\Bridge\\PhpUnit\\ClockMock;"
          },
          {
            "type": "add",
            "line": "use Webauthn\\AttestationStatement\\AttestationStatement;"
          },
          {
            "type": "context",
            "line": " use Webauthn\\AttestedCredentialData;"
          },
          {
            "type": "context",
            "line": " use Webauthn\\AuthenticatorAttestationResponse;"
          },
          {
            "type": "context",
            "line": " use Webauthn\\AuthenticatorData;"
          },
          {
            "type": "context",
            "line": "         /** @var AuthenticatorData $authenticatorData */"
          },
          {
            "type": "context",
            "line": "         $authenticatorData = $publicKeyCredential->getResponse()->getAttestationObject()->getAuthData();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        /** @var AttestationStatement $attestationStatement */"
          },
          {
            "type": "add",
            "line": "        $attestationStatement = $publicKeyCredential->getResponse()->getAttestationObject()->getAttStmt();"
          },
          {
            "type": "add",
            "line": "        static::assertEquals(AttestationStatement::TYPE_ANONCA, $attestationStatement->getType());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         static::assertEquals(hex2bin('3ddc4710e9c088b229dba89d563220bb39f7229aff465b0a656b1afb9a8af8a0'), $authenticatorData->getRpIdHash());"
          },
          {
            "type": "context",
            "line": "         static::assertTrue($authenticatorData->isUserPresent());"
          },
          {
            "type": "context",
            "line": "         static::assertTrue($authenticatorData->isUserVerified());"
          }
        ]
      }
    ]
  },
  {
    "commit": "58ecb1dee1c46075d3e089980301ebfbe0bafd33",
    "files": [
      {
        "file": "plugins/git/include/REST/v1/Branch/BranchCreator.php",
        "changes": [
          {
            "type": "context",
            "line": "index d24230fe0c1..14390c13485 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/git/include/REST/v1/Branch/BranchCreator.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/git/include/REST/v1/Branch/BranchCreator.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " namespace Tuleap\\Git\\REST\\v1\\Branch;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "use Git;"
          },
          {
            "type": "context",
            "line": " use Git_Command_Exception;"
          },
          {
            "type": "context",
            "line": " use Luracast\\Restler\\RestException;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Branch\\BranchCreationExecutor;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Branch\\BranchName;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Branch\\CannotCreateNewBranchException;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Branch\\InvalidBranchNameException;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Git\\Permissions\\AccessControlVerifier;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\REST\\v1\\GitBranchPOSTRepresentation;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class BranchCreator"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     private const BRANCH_PREFIX = \"refs/heads/\";"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    public function __construct(private \\Git_Exec $git_exec, private BranchCreationExecutor $branch_creation_executor)"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "    public function __construct("
          },
          {
            "type": "add",
            "line": "        private \\Git_Exec $git_exec,"
          },
          {
            "type": "add",
            "line": "        private BranchCreationExecutor $branch_creation_executor,"
          },
          {
            "type": "add",
            "line": "        private AccessControlVerifier $access_control_verifier,"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     public function createBranch(\\PFUser $user, \\GitRepository $repository, GitBranchPOSTRepresentation $representation): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        if ("
          },
          {
            "type": "delete",
            "line": "            ! $user->hasPermission(Git::PERM_WRITE, $repository->getId(), $repository->getProjectId())"
          },
          {
            "type": "delete",
            "line": "            && ! $user->hasPermission(Git::PERM_WPLUS, $repository->getId(), $repository->getProjectId())"
          },
          {
            "type": "delete",
            "line": "        ) {"
          },
          {
            "type": "delete",
            "line": "            throw new RestException("
          },
          {
            "type": "delete",
            "line": "                403,"
          },
          {
            "type": "delete",
            "line": "                \"User cannot update the content of the repository\""
          },
          {
            "type": "delete",
            "line": "            );"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         try {"
          },
          {
            "type": "context",
            "line": "             BranchName::fromBranchNameShortHand($representation->branch_name);"
          },
          {
            "type": "context",
            "line": "         } catch (InvalidBranchNameException $exception) {"
          },
          {
            "type": "context",
            "line": "             );"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if (! $this->access_control_verifier->canWrite($user, $repository, self::BRANCH_PREFIX . $representation->branch_name)) {"
          },
          {
            "type": "add",
            "line": "            throw new RestException("
          },
          {
            "type": "add",
            "line": "                403,"
          },
          {
            "type": "add",
            "line": "                sprintf("
          },
          {
            "type": "add",
            "line": "                    \"You are not allowed to create the branch %s in repository %s\","
          },
          {
            "type": "add",
            "line": "                    $representation->branch_name,"
          },
          {
            "type": "add",
            "line": "                    $repository->getName()"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $all_branches_names = $this->git_exec->getAllBranchesSortedByCreationDate();"
          },
          {
            "type": "context",
            "line": "         if (in_array($representation->branch_name, $all_branches_names)) {"
          },
          {
            "type": "context",
            "line": "             throw new RestException("
          }
        ]
      },
      {
        "file": "plugins/git/include/REST/v1/RepositoryResource.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 0b36c942898..b82c553467f 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/git/include/REST/v1/RepositoryResource.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/git/include/REST/v1/RepositoryResource.class.php"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\GitPHP\\ProjectProvider;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\GitPHP\\RepositoryAccessException;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\GitPHP\\RepositoryNotExistingException;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Git\\Permissions\\AccessControlVerifier;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Permissions\\DefaultFineGrainedPermissionFactory;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Permissions\\FineGrainedDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Permissions\\FineGrainedPatternValidator;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $repository = $this->getRepositoryForCurrentUser($id);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        (new BranchCreator(new Git_Exec($repository->getFullPath(), $repository->getFullPath()), new BranchCreationExecutor()))->createBranch("
          },
          {
            "type": "add",
            "line": "        $branch_creator = new BranchCreator("
          },
          {
            "type": "add",
            "line": "            new Git_Exec($repository->getFullPath(), $repository->getFullPath()),"
          },
          {
            "type": "add",
            "line": "            new BranchCreationExecutor(),"
          },
          {
            "type": "add",
            "line": "            new AccessControlVerifier("
          },
          {
            "type": "add",
            "line": "                new FineGrainedRetriever("
          },
          {
            "type": "add",
            "line": "                    new FineGrainedDao(),"
          },
          {
            "type": "add",
            "line": "                ),"
          },
          {
            "type": "add",
            "line": "                new \\System_Command(),"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $branch_creator->createBranch("
          },
          {
            "type": "context",
            "line": "             $this->getCurrentUser(),"
          },
          {
            "type": "context",
            "line": "             $repository,"
          },
          {
            "type": "context",
            "line": "             $representation"
          }
        ]
      },
      {
        "file": "plugins/git/tests/unit/REST/v1/Branch/BranchCreatorTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index 328dfd27c27..0bbfca486e8 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/git/tests/unit/REST/v1/Branch/BranchCreatorTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/git/tests/unit/REST/v1/Branch/BranchCreatorTest.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " namespace Tuleap\\Git\\REST\\v1\\Branch;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "use Git;"
          },
          {
            "type": "context",
            "line": " use Git_Command_Exception;"
          },
          {
            "type": "context",
            "line": " use Luracast\\Restler\\RestException;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Branch\\BranchCreationExecutor;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Branch\\CannotCreateNewBranchException;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Git\\Permissions\\AccessControlVerifier;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\REST\\v1\\GitBranchPOSTRepresentation;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\UserTestBuilder;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Test\\PHPUnit\\TestCase;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " final class BranchCreatorTest extends TestCase"
          },
          {
            "type": "context",
            "line": "      * @var \\PHPUnit\\Framework\\MockObject\\MockObject&BranchCreationExecutor"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     private $branch_creation_executor;"
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @var AccessControlVerifier&\\PHPUnit\\Framework\\MockObject\\MockObject"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    private $access_control_verifier;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     protected function setUp(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->git_exec                 = $this->createMock(\\Git_Exec::class);"
          },
          {
            "type": "context",
            "line": "         $this->branch_creation_executor = $this->createMock(BranchCreationExecutor::class);"
          },
          {
            "type": "add",
            "line": "        $this->access_control_verifier  = $this->createMock(AccessControlVerifier::class);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->creator = new BranchCreator("
          },
          {
            "type": "context",
            "line": "             $this->git_exec,"
          },
          {
            "type": "delete",
            "line": "            $this->branch_creation_executor"
          },
          {
            "type": "add",
            "line": "            $this->branch_creation_executor,"
          },
          {
            "type": "add",
            "line": "            $this->access_control_verifier"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->git_exec->method('getAllBranchesSortedByCreationDate')->willReturn(["
          },
          {
            "type": "context",
            "line": "             ->method(\"createNewBranch\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->expectException(RestException::class);"
          },
          {
            "type": "delete",
            "line": "        $this->expectExceptionMessage(\"User cannot update the content of the repository\");"
          },
          {
            "type": "add",
            "line": "        $this->expectExceptionMessage(\"You are not allowed to create the branch new_branch in repository repo01\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->creator->createBranch("
          },
          {
            "type": "context",
            "line": "             $this->buildMockUserWithoutPermissions(),"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function buildMockUserWithPermissions(): \\PFUser"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $user = $this->createMock(\\PFUser::class);"
          },
          {
            "type": "delete",
            "line": "        $user->method('hasPermission')->willReturnMap(["
          },
          {
            "type": "delete",
            "line": "            [Git::PERM_WRITE, self::REPO_ID, self::PROJECT_ID, true],"
          },
          {
            "type": "delete",
            "line": "            [Git::PERM_WPLUS, self::REPO_ID, self::PROJECT_ID, true],"
          },
          {
            "type": "delete",
            "line": "        ]);"
          },
          {
            "type": "add",
            "line": "        $user = UserTestBuilder::anActiveUser()->build();"
          },
          {
            "type": "add",
            "line": "        $this->access_control_verifier->method('canWrite')->willReturn(true);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return $user;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function buildMockUserWithoutPermissions(): \\PFUser"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $user = $this->createMock(\\PFUser::class);"
          },
          {
            "type": "delete",
            "line": "        $user->method('hasPermission')->willReturnMap(["
          },
          {
            "type": "delete",
            "line": "            [Git::PERM_WRITE, self::REPO_ID, self::PROJECT_ID, false],"
          },
          {
            "type": "delete",
            "line": "            [Git::PERM_WPLUS, self::REPO_ID, self::PROJECT_ID, false],"
          },
          {
            "type": "delete",
            "line": "        ]);"
          },
          {
            "type": "add",
            "line": "        $user = UserTestBuilder::anActiveUser()->build();"
          },
          {
            "type": "add",
            "line": "        $this->access_control_verifier->method('canWrite')->willReturn(false);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return $user;"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      }
    ]
  },
  {
    "commit": "5abcf74227bfe8e5a3dbf105fe62e7b12deb58d2",
    "files": [
      {
        "file": "cmd/helm/install.go",
        "changes": [
          {
            "type": "context",
            "line": "index 281679e5c..976ce0a29 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/install.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/install.go"
          },
          {
            "type": "context",
            "line": " \tf.BoolVar(&client.Atomic, \"atomic\", false, \"if set, the installation process deletes the installation on failure. The --wait flag will be set automatically if --atomic is used\")"
          },
          {
            "type": "context",
            "line": " \tf.BoolVar(&client.SkipCRDs, \"skip-crds\", false, \"if set, no CRDs will be installed. By default, CRDs are installed if not already present\")"
          },
          {
            "type": "context",
            "line": " \tf.BoolVar(&client.SubNotes, \"render-subchart-notes\", false, \"if set, render subchart notes along with the parent\")"
          },
          {
            "type": "add",
            "line": "\tf.BoolVar(&client.EnableDNS, \"enable-dns\", false, \"enable DNS lookups when rendering templates\")"
          },
          {
            "type": "context",
            "line": " \taddValueOptionsFlags(f, valueOpts)"
          },
          {
            "type": "context",
            "line": " \taddChartPathOptionsFlags(f, &client.ChartPathOptions)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "cmd/helm/upgrade.go",
        "changes": [
          {
            "type": "context",
            "line": "index 02f4cf2a9..3302da12c 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/upgrade.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/upgrade.go"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tinstClient.SubNotes = client.SubNotes"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tinstClient.Description = client.Description"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tinstClient.DependencyUpdate = client.DependencyUpdate"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tinstClient.EnableDNS = client.EnableDNS"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t\t\trel, err := runInstall(args, instClient, valueOpts, out)"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \tf.BoolVar(&client.SubNotes, \"render-subchart-notes\", false, \"if set, render subchart notes along with the parent\")"
          },
          {
            "type": "context",
            "line": " \tf.StringVar(&client.Description, \"description\", \"\", \"add a custom description\")"
          },
          {
            "type": "context",
            "line": " \tf.BoolVar(&client.DependencyUpdate, \"dependency-update\", false, \"update dependencies if they are missing before installing the chart\")"
          },
          {
            "type": "add",
            "line": "\tf.BoolVar(&client.EnableDNS, \"enable-dns\", false, \"enable DNS lookups when rendering templates\")"
          },
          {
            "type": "context",
            "line": " \taddChartPathOptionsFlags(f, &client.ChartPathOptions)"
          },
          {
            "type": "context",
            "line": " \taddValueOptionsFlags(f, valueOpts)"
          },
          {
            "type": "context",
            "line": " \tbindOutputFlag(cmd, &outfmt)"
          }
        ]
      },
      {
        "file": "pkg/action/action.go",
        "changes": [
          {
            "type": "context",
            "line": "index 82760250f..016aec3f6 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/action/action.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/action/action.go"
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "context",
            "line": " // TODO: This function is badly in need of a refactor."
          },
          {
            "type": "context",
            "line": " // TODO: As part of the refactor the duplicate code in cmd/helm/template.go should be removed"
          },
          {
            "type": "delete",
            "line": "//       This code has to do with writing files to disk."
          },
          {
            "type": "delete",
            "line": "func (cfg *Configuration) renderResources(ch *chart.Chart, values chartutil.Values, releaseName, outputDir string, subNotes, useReleaseName, includeCrds bool, pr postrender.PostRenderer, dryRun bool) ([]*release.Hook, *bytes.Buffer, string, error) {"
          },
          {
            "type": "add",
            "line": "//"
          },
          {
            "type": "add",
            "line": "//\tThis code has to do with writing files to disk."
          },
          {
            "type": "add",
            "line": "func (cfg *Configuration) renderResources(ch *chart.Chart, values chartutil.Values, releaseName, outputDir string, subNotes, useReleaseName, includeCrds bool, pr postrender.PostRenderer, dryRun, enableDNS bool) ([]*release.Hook, *bytes.Buffer, string, error) {"
          },
          {
            "type": "context",
            "line": " \ths := []*release.Hook{}"
          },
          {
            "type": "context",
            "line": " \tb := bytes.NewBuffer(nil)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn hs, b, \"\", err"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\tfiles, err2 = engine.RenderWithClient(ch, values, restConfig)"
          },
          {
            "type": "add",
            "line": "\t\te := engine.New(restConfig)"
          },
          {
            "type": "add",
            "line": "\t\te.EnableDNS = enableDNS"
          },
          {
            "type": "add",
            "line": "\t\tfiles, err2 = e.Render(ch, values)"
          },
          {
            "type": "context",
            "line": " \t} else {"
          },
          {
            "type": "delete",
            "line": "\t\tfiles, err2 = engine.Render(ch, values)"
          },
          {
            "type": "add",
            "line": "\t\tvar e engine.Engine"
          },
          {
            "type": "add",
            "line": "\t\te.EnableDNS = enableDNS"
          },
          {
            "type": "add",
            "line": "\t\tfiles, err2 = e.Render(ch, values)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif err2 != nil {"
          }
        ]
      },
      {
        "file": "pkg/action/install.go",
        "changes": [
          {
            "type": "context",
            "line": "index 425b66f69..4658c9be8 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/action/install.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/action/install.go"
          },
          {
            "type": "context",
            "line": " \tAPIVersions chartutil.VersionSet"
          },
          {
            "type": "context",
            "line": " \t// Used by helm template to render charts with .Release.IsUpgrade. Ignored if Dry-Run is false"
          },
          {
            "type": "context",
            "line": " \tIsUpgrade bool"
          },
          {
            "type": "add",
            "line": "\t// Enable DNS lookups when rendering templates"
          },
          {
            "type": "add",
            "line": "\tEnableDNS bool"
          },
          {
            "type": "context",
            "line": " \t// Used by helm template to add the release as part of OutputDir path"
          },
          {
            "type": "context",
            "line": " \t// OutputDir/<ReleaseName>"
          },
          {
            "type": "context",
            "line": " \tUseReleaseName bool"
          },
          {
            "type": "context",
            "line": " \trel := i.createRelease(chrt, vals)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tvar manifestDoc *bytes.Buffer"
          },
          {
            "type": "delete",
            "line": "\trel.Hooks, manifestDoc, rel.Info.Notes, err = i.cfg.renderResources(chrt, valuesToRender, i.ReleaseName, i.OutputDir, i.SubNotes, i.UseReleaseName, i.IncludeCRDs, i.PostRenderer, i.DryRun)"
          },
          {
            "type": "add",
            "line": "\trel.Hooks, manifestDoc, rel.Info.Notes, err = i.cfg.renderResources(chrt, valuesToRender, i.ReleaseName, i.OutputDir, i.SubNotes, i.UseReleaseName, i.IncludeCRDs, i.PostRenderer, i.DryRun, i.EnableDNS)"
          },
          {
            "type": "context",
            "line": " \t// Even for errors, attach this if available"
          },
          {
            "type": "context",
            "line": " \tif manifestDoc != nil {"
          },
          {
            "type": "context",
            "line": " \t\trel.Manifest = manifestDoc.String()"
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "context",
            "line": " // Roughly, this will return an error if name is"
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "delete",
            "line": "//\t- empty"
          },
          {
            "type": "delete",
            "line": "//\t- too long"
          },
          {
            "type": "delete",
            "line": "//\t- already in use, and not deleted"
          },
          {
            "type": "delete",
            "line": "//\t- used by a deleted release, and i.Replace is false"
          },
          {
            "type": "add",
            "line": "//   - empty"
          },
          {
            "type": "add",
            "line": "//   - too long"
          },
          {
            "type": "add",
            "line": "//   - already in use, and not deleted"
          },
          {
            "type": "add",
            "line": "//   - used by a deleted release, and i.Replace is false"
          },
          {
            "type": "context",
            "line": " func (i *Install) availableName() error {"
          },
          {
            "type": "context",
            "line": " \tstart := i.ReleaseName"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "pkg/action/upgrade.go",
        "changes": [
          {
            "type": "context",
            "line": "index 690397d4a..8fb895df0 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/action/upgrade.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/action/upgrade.go"
          },
          {
            "type": "context",
            "line": " \tDependencyUpdate bool"
          },
          {
            "type": "context",
            "line": " \t// Lock to control raceconditions when the process receives a SIGTERM"
          },
          {
            "type": "context",
            "line": " \tLock sync.Mutex"
          },
          {
            "type": "add",
            "line": "\t// Enable DNS lookups when rendering templates"
          },
          {
            "type": "add",
            "line": "\tEnableDNS bool"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " type resultMessage struct {"
          },
          {
            "type": "context",
            "line": " \t\treturn nil, nil, err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\thooks, manifestDoc, notesTxt, err := u.cfg.renderResources(chart, valuesToRender, \"\", \"\", u.SubNotes, false, false, u.PostRenderer, u.DryRun)"
          },
          {
            "type": "add",
            "line": "\thooks, manifestDoc, notesTxt, err := u.cfg.renderResources(chart, valuesToRender, \"\", \"\", u.SubNotes, false, false, u.PostRenderer, u.DryRun, u.EnableDNS)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn nil, nil, err"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      },
      {
        "file": "pkg/engine/engine.go",
        "changes": [
          {
            "type": "context",
            "line": "index 00494f9d7..657d5767b 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/engine/engine.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/engine/engine.go"
          },
          {
            "type": "context",
            "line": " \tLintMode bool"
          },
          {
            "type": "context",
            "line": " \t// the rest config to connect to the kubernetes api"
          },
          {
            "type": "context",
            "line": " \tconfig *rest.Config"
          },
          {
            "type": "add",
            "line": "\t// EnableDNS tells the engine to allow DNS lookups when rendering templates"
          },
          {
            "type": "add",
            "line": "\tEnableDNS bool"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// New creates a new instance of Engine using the passed in rest config."
          },
          {
            "type": "add",
            "line": "func New(config *rest.Config) Engine {"
          },
          {
            "type": "add",
            "line": "\treturn Engine{"
          },
          {
            "type": "add",
            "line": "\t\tconfig: config,"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Render takes a chart, optional values, and value overrides, and attempts to render the Go templates."
          },
          {
            "type": "context",
            "line": " \t\tfuncMap[\"lookup\"] = NewLookupFunction(e.config)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t// When DNS lookups are not enabled override the sprig function and return"
          },
          {
            "type": "add",
            "line": "\t// an empty string."
          },
          {
            "type": "add",
            "line": "\tif !e.EnableDNS {"
          },
          {
            "type": "add",
            "line": "\t\tfuncMap[\"getHostByName\"] = func(name string) string {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn \"\""
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tt.Funcs(funcMap)"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "pkg/engine/engine_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 54cd21ae2..434b939dc 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/engine/engine_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/engine/engine_test.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import ("
          },
          {
            "type": "context",
            "line": " \t\"fmt\""
          },
          {
            "type": "add",
            "line": "\t\"path\""
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "context",
            "line": " \t\"sync\""
          },
          {
            "type": "context",
            "line": " \t\"testing\""
          },
          {
            "type": "context",
            "line": " \t\t\t{Name: \"templates/test2\", Data: []byte(\"{{.Values.global.callme | lower }}\")},"
          },
          {
            "type": "context",
            "line": " \t\t\t{Name: \"templates/test3\", Data: []byte(\"{{.noValue}}\")},"
          },
          {
            "type": "context",
            "line": " \t\t\t{Name: \"templates/test4\", Data: []byte(\"{{toJson .Values}}\")},"
          },
          {
            "type": "add",
            "line": "\t\t\t{Name: \"templates/test5\", Data: []byte(\"{{getHostByName \\\"helm.sh\\\"}}\")},"
          },
          {
            "type": "context",
            "line": " \t\t},"
          },
          {
            "type": "context",
            "line": " \t\tValues: map[string]interface{}{\"outer\": \"DEFAULT\", \"inner\": \"DEFAULT\"},"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t\t\"moby/templates/test2\": \"ishmael\","
          },
          {
            "type": "context",
            "line": " \t\t\"moby/templates/test3\": \"\","
          },
          {
            "type": "context",
            "line": " \t\t\"moby/templates/test4\": `{\"global\":{\"callme\":\"Ishmael\"},\"inner\":\"inn\",\"outer\":\"spouter\"}`,"
          },
          {
            "type": "add",
            "line": "\t\t\"moby/templates/test5\": \"\","
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfor name, data := range expect {"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestRenderWIthDNS(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tc := &chart.Chart{"
          },
          {
            "type": "add",
            "line": "\t\tMetadata: &chart.Metadata{"
          },
          {
            "type": "add",
            "line": "\t\t\tName:    \"moby\","
          },
          {
            "type": "add",
            "line": "\t\t\tVersion: \"1.2.3\","
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t\tTemplates: []*chart.File{"
          },
          {
            "type": "add",
            "line": "\t\t\t{Name: \"templates/test1\", Data: []byte(\"{{getHostByName \\\"helm.sh\\\"}}\")},"
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t\tValues: map[string]interface{}{},"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tvals := map[string]interface{}{"
          },
          {
            "type": "add",
            "line": "\t\t\"Values\": map[string]interface{}{},"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tv, err := chartutil.CoalesceValues(c, vals)"
          },
          {
            "type": "add",
            "line": "\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"Failed to coalesce values: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tvar e Engine"
          },
          {
            "type": "add",
            "line": "\te.EnableDNS = true"
          },
          {
            "type": "add",
            "line": "\tout, err := e.Render(c, v)"
          },
          {
            "type": "add",
            "line": "\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Errorf(\"Failed to render templates: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfor _, val := range c.Templates {"
          },
          {
            "type": "add",
            "line": "\t\tfp := path.Join(\"moby\", val.Name)"
          },
          {
            "type": "add",
            "line": "\t\tif out[fp] == \"\" {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"Expected IP address, got %q\", out[fp])"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestParallelRenderInternals(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \t// Make sure that we can use one Engine to run parallel template renders."
          },
          {
            "type": "context",
            "line": " \te := new(Engine)"
          }
        ]
      }
    ]
  },
  {
    "commit": "5be2b1ed55fd7259dfdf2c82e7701dba407b8b62",
    "files": [
      {
        "file": "wagtail/contrimodeladmin/forms.py",
        "changes": [
          {
            "type": "context",
            "line": "index 92feab81f0..be5431a56f 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/contrib/modeladmin/forms.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/contrib/modeladmin/forms.py"
          },
          {
            "type": "context",
            "line": " from django import forms"
          },
          {
            "type": "delete",
            "line": "from django.utils.safestring import mark_safe"
          },
          {
            "type": "context",
            "line": " from django.utils.translation import gettext as _"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from wagtail.models import Page"
          },
          {
            "type": "context",
            "line": "             obj.get_ancestors(inclusive=True).exclude(depth=1).specific(defer=True)"
          },
          {
            "type": "context",
            "line": "         ):"
          },
          {
            "type": "context",
            "line": "             bits.append(ancestor.get_admin_display_title())"
          },
          {
            "type": "delete",
            "line": "        return mark_safe('<span class=\"icon icon-arrow-right\"></span>'.join(bits))"
          },
          {
            "type": "add",
            "line": "        return \" | \".join(bits)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class ParentChooserForm(forms.Form):"
          }
        ]
      },
      {
        "file": "wagtail/contrimodeladmin/tests/test_page_modeladmin.py",
        "changes": [
          {
            "type": "context",
            "line": "index 9f9b52d2bc..9b3825c21c 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/contrib/modeladmin/tests/test_page_modeladmin.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/contrib/modeladmin/tests/test_page_modeladmin.py"
          },
          {
            "type": "context",
            "line": "         \"\"\""
          },
          {
            "type": "context",
            "line": "         self.assertContains(response, expected, html=True)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_page_title_html_escaping(self):"
          },
          {
            "type": "add",
            "line": "        homepage = Page.objects.get(url_path=\"/home/\")"
          },
          {
            "type": "add",
            "line": "        business_index = BusinessIndex("
          },
          {
            "type": "add",
            "line": "            title=\"Title with <script>alert('XSS')</script>\","
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        homepage.add_child(instance=business_index)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = self.client.get(\"/admin/tests/businesschild/choose_parent/\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.status_code, 200)"
          },
          {
            "type": "add",
            "line": "        self.assertNotContains(response, \"Title with <script>alert('XSS')</script>\")"
          },
          {
            "type": "add",
            "line": "        self.assertContains("
          },
          {
            "type": "add",
            "line": "            response, \"Title with &lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class TestChooseParentViewForNonSuperuser(TestCase, WagtailTestUtils):"
          },
          {
            "type": "context",
            "line": "     fixtures = [\"test_specific.json\"]"
          }
        ]
      }
    ]
  },
  {
    "commit": "5c14bf53fb42ceca12bbcc0016e8704b1580920d",
    "files": [
      {
        "file": "dcmnet/libsrc/diutil.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 45d486e39..0a6f05ae4 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/diutil.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/diutil.cc"
          },
          {
            "type": "context",
            "line": "             s[0] = '\\0';"
          },
          {
            "type": "context",
            "line": "         } else {"
          },
          {
            "type": "context",
            "line": "             ec =  elem->getString(aString);"
          },
          {
            "type": "delete",
            "line": "            OFStandard::strlcpy(s, aString, bufsize);"
          },
          {
            "type": "add",
            "line": "            if (ec == EC_Normal)"
          },
          {
            "type": "add",
            "line": "                OFStandard::strlcpy(s, aString, bufsize);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     return (ec == EC_Normal);"
          }
        ]
      }
    ]
  },
  {
    "commit": "5c7a60977cba478f6a35390ba98cffc2bd41c8a4",
    "files": [
      {
        "file": "wagtail/admin/rich_text/converters/contentstate.py",
        "changes": [
          {
            "type": "context",
            "line": "index 50b6f401a8..4853d0d490 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/admin/rich_text/converters/contentstate.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/admin/rich_text/converters/contentstate.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from wagtail.admin.rich_text.converters.html_to_contentstate import HtmlToContentStateHandler"
          },
          {
            "type": "context",
            "line": " from wagtail.core.rich_text import features as feature_registry"
          },
          {
            "type": "add",
            "line": "from wagtail.core.whitelist import check_url"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def link_entity(props):"
          },
          {
            "type": "context",
            "line": "         link_props['linktype'] = 'page'"
          },
          {
            "type": "context",
            "line": "         link_props['id'] = id_"
          },
          {
            "type": "context",
            "line": "     else:"
          },
          {
            "type": "delete",
            "line": "        link_props['href'] = props.get('url')"
          },
          {
            "type": "add",
            "line": "        link_props['href'] = check_url(props.get('url'))"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return DOM.create_element('a', link_props, props['children'])"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "wagtail/admin/tests/test_contentstate.py",
        "changes": [
          {
            "type": "context",
            "line": "index e74ff247de..d618c42024 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/admin/tests/test_contentstate.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/admin/tests/test_contentstate.py"
          },
          {
            "type": "context",
            "line": "             ],"
          },
          {
            "type": "context",
            "line": "             'entityMap': {}"
          },
          {
            "type": "context",
            "line": "         })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class TestContentStateToHtml(TestCase):"
          },
          {
            "type": "add",
            "line": "    def test_external_link(self):"
          },
          {
            "type": "add",
            "line": "        converter = ContentstateConverter(features=['link'])"
          },
          {
            "type": "add",
            "line": "        contentstate_json = json.dumps({"
          },
          {
            "type": "add",
            "line": "            'entityMap': {"
          },
          {
            "type": "add",
            "line": "                '0': {'mutability': 'MUTABLE', 'type': 'LINK', 'data': {'url': 'http://wagtail.io'}}"
          },
          {
            "type": "add",
            "line": "            },"
          },
          {
            "type": "add",
            "line": "            'blocks': ["
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    'inlineStyleRanges': [], 'text': 'an external link', 'depth': 0, 'type': 'unstyled', 'key': '00000',"
          },
          {
            "type": "add",
            "line": "                    'entityRanges': [{'offset': 3, 'length': 8, 'key': 0}]"
          },
          {
            "type": "add",
            "line": "                },"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "        })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        result = converter.to_database_format(contentstate_json)"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(result, '<p>an <a href=\"http://wagtail.io\">external</a> link</p>')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_local_link(self):"
          },
          {
            "type": "add",
            "line": "        converter = ContentstateConverter(features=['link'])"
          },
          {
            "type": "add",
            "line": "        contentstate_json = json.dumps({"
          },
          {
            "type": "add",
            "line": "            'entityMap': {"
          },
          {
            "type": "add",
            "line": "                '0': {'mutability': 'MUTABLE', 'type': 'LINK', 'data': {'url': '/some/local/path/'}}"
          },
          {
            "type": "add",
            "line": "            },"
          },
          {
            "type": "add",
            "line": "            'blocks': ["
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    'inlineStyleRanges': [], 'text': 'an external link', 'depth': 0, 'type': 'unstyled', 'key': '00000',"
          },
          {
            "type": "add",
            "line": "                    'entityRanges': [{'offset': 3, 'length': 8, 'key': 0}]"
          },
          {
            "type": "add",
            "line": "                },"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "        })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        result = converter.to_database_format(contentstate_json)"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(result, '<p>an <a href=\"/some/local/path/\">external</a> link</p>')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_reject_javascript_link(self):"
          },
          {
            "type": "add",
            "line": "        converter = ContentstateConverter(features=['link'])"
          },
          {
            "type": "add",
            "line": "        contentstate_json = json.dumps({"
          },
          {
            "type": "add",
            "line": "            'entityMap': {"
          },
          {
            "type": "add",
            "line": "                '0': {'mutability': 'MUTABLE', 'type': 'LINK', 'data': {'url': \"javascript:alert('oh no')\"}}"
          },
          {
            "type": "add",
            "line": "            },"
          },
          {
            "type": "add",
            "line": "            'blocks': ["
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    'inlineStyleRanges': [], 'text': 'an external link', 'depth': 0, 'type': 'unstyled', 'key': '00000',"
          },
          {
            "type": "add",
            "line": "                    'entityRanges': [{'offset': 3, 'length': 8, 'key': 0}]"
          },
          {
            "type": "add",
            "line": "                },"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "        })"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        result = converter.to_database_format(contentstate_json)"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(result, '<p>an <a>external</a> link</p>')"
          }
        ]
      }
    ]
  },
  {
    "commit": "5cd2d1816f90dc5c946e6e38fd2d0ba535624c5c",
    "files": [
      {
        "file": "MANIFEST.in",
        "changes": [
          {
            "type": "context",
            "line": "index 7d3d18e..2a3b5f3 100644"
          },
          {
            "type": "context",
            "line": "--- a/MANIFEST.in"
          },
          {
            "type": "context",
            "line": "+++ b/MANIFEST.in"
          },
          {
            "type": "context",
            "line": " include CHANGELOG.md"
          },
          {
            "type": "context",
            "line": " include *requirements.txt"
          },
          {
            "type": "context",
            "line": " graft example"
          },
          {
            "type": "add",
            "line": "graft oauthenticator/schemas"
          }
        ]
      },
      {
        "file": "docs/source/index.rst",
        "changes": [
          {
            "type": "context",
            "line": "index b4c92db..989f5c4 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/source/index.rst"
          },
          {
            "type": "context",
            "line": "+++ b/docs/source/index.rst"
          },
          {
            "type": "context",
            "line": "    api/index"
          },
          {
            "type": "context",
            "line": "    changelog"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "Migrations Guide"
          },
          {
            "type": "add",
            "line": "-----------------"
          },
          {
            "type": "add",
            "line": ".. toctree::"
          },
          {
            "type": "add",
            "line": "   :maxdepth: 2"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   migrations"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Indices and tables"
          },
          {
            "type": "context",
            "line": " =================="
          }
        ]
      },
      {
        "file": "docs/source/migrations.md",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000..cf7592b"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/docs/source/migrations.md"
          },
          {
            "type": "add",
            "line": "# Migrations"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "The following section describes how to migrate your OAuthenticator to a newer version given some upgrade scenarios."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "## Migrating CILogonOAuthenticator to version 15.0.0"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "OAuthenticator release of 15.0.0 version introduced some breaking changes for the CILogonOAuthenticator. This is a description of what breaking changes have been made and a step by step guide on how to update your JupyterHub CILogonOAuthenticator to this version."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "The following configurations have been deprecated in oauthenticator 15.0.0"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "1. `idp` -> **replaced**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   The `idp` config refers to the SAML Entity ID of the user's selected identity provider and prior to 15.0.0 was used to set the [CILogon `selected_idp` optional authorization parameter](https://www.cilogon.org/oidc#h.p_IWGvXH0okDI_) in order to show only this identity provider in the CILogon IdP list."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   Starting with oauthenticator 15.0.0, this config has been renamed to `shown_idps` and must now be a list of such SAML Entity IDs. Only the identity providers in this list will be shown in the CILogon IDP list, with the first one being considered the default."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   **Old config Example**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```python"
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.idp = \"https://accounts.google.com/o/oauth2/auth\""
          },
          {
            "type": "add",
            "line": "   ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   **New config Example**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```python"
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.shown_idps = [\"https://accounts.google.com/o/oauth2/auth\"]"
          },
          {
            "type": "add",
            "line": "   ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "2. `strip_idp_domain` -> **removed**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   The `strip_idp_domain` boolean config was previously used to enable stripping the domains listed in the `allowed_idps` from the hub usernames. In oauthenticator 15.0.0 this config option was removed and such behaviour can only be achieved using the `allowed_idps` dictionary config as documented in a section below."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   **Old config Example**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```python"
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.username_claim = \"email\""
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.allowed_idps = [\"uni.edu\"]"
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.strip_idp_domain = True"
          },
          {
            "type": "add",
            "line": "   ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   **New config Example**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```python"
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "       'https://uni-idp.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "           'username_derivation': {"
          },
          {
            "type": "add",
            "line": "               'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "               'action': 'strip_idp_domain',"
          },
          {
            "type": "add",
            "line": "               'domain': 'uni.edu',"
          },
          {
            "type": "add",
            "line": "           }"
          },
          {
            "type": "add",
            "line": "       },"
          },
          {
            "type": "add",
            "line": "   }"
          },
          {
            "type": "add",
            "line": "   ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```{note}"
          },
          {
            "type": "add",
            "line": "   If `allowed_idps` is used to contain more than one entry, then check the section below to find out how to also use username prefixes to avoid username clashes."
          },
          {
            "type": "add",
            "line": "   ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "3. `allowed_idps` -> **changed type**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   The `allowed_idps` config was used prior to oauthenticator version 15.0.0 to only allow access into the hub to usernames containing only these domains, after the @ sign. If `strip_idp_domain` was enabled, these domains would have been stripped from the hub username."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   Starting with oauthenticator 15.0.0 this config option must now be a dictionary structured like below. More information about each configuration option that can go into the `username_derivation` can be found in the `allowed_idps` docstring."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   **Stripping the domain from one IDP username and adding prefixes to another**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```python"
          },
          {
            "type": "add",
            "line": "   c.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "       'https://some-idp.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "           'username_derivation': {"
          },
          {
            "type": "add",
            "line": "               'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "               'action': 'strip_idp_domain',"
          },
          {
            "type": "add",
            "line": "               'domain': 'uni.edu',"
          },
          {
            "type": "add",
            "line": "           }"
          },
          {
            "type": "add",
            "line": "       },"
          },
          {
            "type": "add",
            "line": "       'https://another-idp.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "           'username_derivation': {"
          },
          {
            "type": "add",
            "line": "               'username_claim': 'nickname',"
          },
          {
            "type": "add",
            "line": "               'action': 'prefix',"
          },
          {
            "type": "add",
            "line": "               'prefix': 'idp',"
          },
          {
            "type": "add",
            "line": "           }"
          },
          {
            "type": "add",
            "line": "       },"
          },
          {
            "type": "add",
            "line": "   }"
          },
          {
            "type": "add",
            "line": "   ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   This config means that if you login using a `some-idp` provider, the hub username will be the email registered for that IdP, from which the domain `uni.edu` will be stripped (assuming this is domain in the email provided by `some-idp`)."
          },
          {
            "type": "add",
            "line": "   But if you login using `another-idp` the hub username will be your `another-idp` provided `nickname` claim, username prefixed with `idp:`. This way, users from different identity providers can log in without username clashes."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "   ```{note}"
          },
          {
            "type": "add",
            "line": "   If `allowed_idps` is specified, then each IdP in the dict must define the `username_derivation` dict, including `username_derivation.username_claim`. `CILogonOAuthenticator.username_claim` will only be used if `allowed_idps` is not specified!"
          },
          {
            "type": "add",
            "line": "   ```"
          }
        ]
      },
      {
        "file": "oauthenticator/cilogon.py",
        "changes": [
          {
            "type": "context",
            "line": "index dc002ff..4234d26 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/cilogon.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/cilogon.py"
          },
          {
            "type": "context",
            "line": "   email instead of ePPN as the JupyterHub username."
          },
          {
            "type": "context",
            "line": " \"\"\""
          },
          {
            "type": "context",
            "line": " import os"
          },
          {
            "type": "add",
            "line": "from urllib.parse import urlparse"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import jsonschema"
          },
          {
            "type": "context",
            "line": " from jupyterhub.auth import LocalAuthenticator"
          },
          {
            "type": "add",
            "line": "from ruamel.yaml import YAML"
          },
          {
            "type": "context",
            "line": " from tornado import web"
          },
          {
            "type": "context",
            "line": " from tornado.httpclient import HTTPRequest"
          },
          {
            "type": "context",
            "line": " from tornado.httputil import url_concat"
          },
          {
            "type": "delete",
            "line": "from traitlets import Bool, List, Unicode, default, validate"
          },
          {
            "type": "add",
            "line": "from traitlets import Bool, Dict, List, Unicode, default, validate"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from .oauth2 import OAuthenticator, OAuthLoginHandler"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "yaml = YAML(typ=\"safe\", pure=True)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class CILogonLoginHandler(OAuthLoginHandler):"
          },
          {
            "type": "context",
            "line": "     \"\"\"See https://www.cilogon.org/oidc for general information.\"\"\""
          },
          {
            "type": "context",
            "line": "     def authorize_redirect(self, *args, **kwargs):"
          },
          {
            "type": "context",
            "line": "         \"\"\"Add idp, skin to redirect params\"\"\""
          },
          {
            "type": "context",
            "line": "         extra_params = kwargs.setdefault('extra_params', {})"
          },
          {
            "type": "delete",
            "line": "        if self.authenticator.idp:"
          },
          {
            "type": "delete",
            "line": "            extra_params[\"selected_idp\"] = self.authenticator.idp"
          },
          {
            "type": "add",
            "line": "        if self.authenticator.shown_idps:"
          },
          {
            "type": "add",
            "line": "            # selected_idp must be a string where idps are separated by commas, with no space between, otherwise it will get escaped"
          },
          {
            "type": "add",
            "line": "            # example: https://accounts.google.com/o/oauth2/auth,https://github.com/login/oauth/authorize"
          },
          {
            "type": "add",
            "line": "            idps = \",\".join(self.authenticator.shown_idps)"
          },
          {
            "type": "add",
            "line": "            extra_params[\"selected_idp\"] = idps"
          },
          {
            "type": "context",
            "line": "         if self.authenticator.skin:"
          },
          {
            "type": "context",
            "line": "             extra_params[\"skin\"] = self.authenticator.skin"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class CILogonOAuthenticator(OAuthenticator):"
          },
          {
            "type": "context",
            "line": "     _deprecated_oauth_aliases = {"
          },
          {
            "type": "delete",
            "line": "        \"idp_whitelist\": (\"allowed_idps\", \"0.12.0\"),"
          },
          {
            "type": "add",
            "line": "        # <deprecated-config>:"
          },
          {
            "type": "add",
            "line": "        #   ("
          },
          {
            "type": "add",
            "line": "        #    <new-config>,"
          },
          {
            "type": "add",
            "line": "        #    <deprecation-version>,"
          },
          {
            "type": "add",
            "line": "        #    <deprecated-config-and-new-config-have-same-type>"
          },
          {
            "type": "add",
            "line": "        #   )"
          },
          {
            "type": "add",
            "line": "        \"idp_whitelist\": (\"allowed_idps\", \"0.12.0\", False),"
          },
          {
            "type": "add",
            "line": "        \"idp\": (\"shown_idps\", \"15.0.0\", False),"
          },
          {
            "type": "add",
            "line": "        \"strip_idp_domain\": (\"allowed_idps\", \"15.0.0\", False),"
          },
          {
            "type": "context",
            "line": "         **OAuthenticator._deprecated_oauth_aliases,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @validate('scope')"
          },
          {
            "type": "context",
            "line": "     def _validate_scope(self, proposal):"
          },
          {
            "type": "delete",
            "line": "        \"\"\"ensure openid is requested\"\"\""
          },
          {
            "type": "add",
            "line": "        \"\"\"Ensure `openid` is always requested and `org.cilogon.userinfo`"
          },
          {
            "type": "add",
            "line": "        is requested when allowed_idps is specified."
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        scopes = proposal.value"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if 'openid' not in proposal.value:"
          },
          {
            "type": "delete",
            "line": "            return ['openid'] + proposal.value"
          },
          {
            "type": "delete",
            "line": "        return proposal.value"
          },
          {
            "type": "add",
            "line": "            scopes += ['openid']"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if self.allowed_idps and 'org.cilogon.userinfo' not in proposal.value:"
          },
          {
            "type": "add",
            "line": "            scopes += ['org.cilogon.userinfo']"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return scopes"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     idp_whitelist = List("
          },
          {
            "type": "context",
            "line": "         help=\"Deprecated, use `CIlogonOAuthenticator.allowed_idps`\","
          },
          {
            "type": "context",
            "line": "         config=True,"
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "delete",
            "line": "    allowed_idps = List("
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    allowed_idps = Dict("
          },
          {
            "type": "context",
            "line": "         config=True,"
          },
          {
            "type": "delete",
            "line": "        help=\"\"\"A list of IDP which can be stripped from the username after the @ sign.\"\"\","
          },
          {
            "type": "add",
            "line": "        default_value={},"
          },
          {
            "type": "add",
            "line": "        help=\"\"\"A dictionary of the only entity IDs that will be allowed to be used as login options."
          },
          {
            "type": "add",
            "line": "        See https://cilogon.org/idplist for the list of `EntityIDs` of each IdP."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        It can be used to enable domain stripping, adding prefixes to the usernames and to specify an identity provider specific username claim."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        For example:"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        ```python"
          },
          {
            "type": "add",
            "line": "        allowed_idps = {"
          },
          {
            "type": "add",
            "line": "            \"https://idpz.utorauth.utoronto.ca/shibboleth\": {"
          },
          {
            "type": "add",
            "line": "                \"username_derivation\": {"
          },
          {
            "type": "add",
            "line": "                    \"username_claim\": \"email\","
          },
          {
            "type": "add",
            "line": "                    \"action\": \"strip_idp_domain\","
          },
          {
            "type": "add",
            "line": "                    \"domain\": \"utoronto.ca\","
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            },"
          },
          {
            "type": "add",
            "line": "            \"https://github.com/login/oauth/authorize\": {"
          },
          {
            "type": "add",
            "line": "                \"username_derivation\": {"
          },
          {
            "type": "add",
            "line": "                    \"username_claim\": \"username\","
          },
          {
            "type": "add",
            "line": "                    \"action\": \"prefix\","
          },
          {
            "type": "add",
            "line": "                    \"prefix\": \"gh\""
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        ```"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        Where:"
          },
          {
            "type": "add",
            "line": "        - `username_claim`: string"
          },
          {
            "type": "add",
            "line": "            The claim in the userinfo response from which to get the"
          },
          {
            "type": "add",
            "line": "            JupyterHub username. Examples include: eppn, email."
          },
          {
            "type": "add",
            "line": "            What keys are available will depend on the scopes requested."
          },
          {
            "type": "add",
            "line": "            It will overwrite any value set through"
          },
          {
            "type": "add",
            "line": "            CILogonOAuthenticator.username_claim for this identity provider."
          },
          {
            "type": "add",
            "line": "        - `action`: string"
          },
          {
            "type": "add",
            "line": "            What action to perform on the username. Available options are"
          },
          {
            "type": "add",
            "line": "            \"strip_idp_domain\", which will strip the domain from the username if specified and \"prefix\", which will prefix the hub username with \"prefix:\"."
          },
          {
            "type": "add",
            "line": "        - `domain:` string"
          },
          {
            "type": "add",
            "line": "            The domain after \"@\" which will be stripped from the username if it exists and if the action is \"strip_idp_domain\"."
          },
          {
            "type": "add",
            "line": "        - `prefix`: string"
          },
          {
            "type": "add",
            "line": "            The prefix which will be added at the beginning of the username"
          },
          {
            "type": "add",
            "line": "            followed by a semicolumn \":\", if the action is \"prefix\"."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        Requirements:"
          },
          {
            "type": "add",
            "line": "        - if `username_derivation.action` is `strip_idp_domain`, then"
          },
          {
            "type": "add",
            "line": "          `username_derivation.domain` must also be specified"
          },
          {
            "type": "add",
            "line": "        - if `username_derivation.action` is `prefix`, then"
          },
          {
            "type": "add",
            "line": "          `username_derivation.prefix`must also be specified."
          },
          {
            "type": "add",
            "line": "        - `username_claim` must be provided for each idp in `allowed_idps`."
          },
          {
            "type": "add",
            "line": "        \"\"\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @validate(\"allowed_idps\")"
          },
          {
            "type": "add",
            "line": "    def _validate_allowed_idps(self, proposal):"
          },
          {
            "type": "add",
            "line": "        idps = proposal.value"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        for entity_id, username_derivation in idps.items():"
          },
          {
            "type": "add",
            "line": "            # Validate `username_derivation` config using the schema"
          },
          {
            "type": "add",
            "line": "            root_dir = os.path.dirname(os.path.abspath(__file__))"
          },
          {
            "type": "add",
            "line": "            schema_file = os.path.join(root_dir, \"schemas\", \"cilogon-schema.yaml\")"
          },
          {
            "type": "add",
            "line": "            with open(schema_file) as schema_fd:"
          },
          {
            "type": "add",
            "line": "                schema = yaml.load(schema_fd)"
          },
          {
            "type": "add",
            "line": "                # Raises useful exception if validation fails"
          },
          {
            "type": "add",
            "line": "                jsonschema.validate(username_derivation, schema)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            # Make sure allowed_idps containes EntityIDs and not domain names."
          },
          {
            "type": "add",
            "line": "            accepted_entity_id_scheme = [\"urn\", \"https\", \"http\"]"
          },
          {
            "type": "add",
            "line": "            entity_id_scheme = urlparse(entity_id).scheme"
          },
          {
            "type": "add",
            "line": "            if entity_id_scheme not in accepted_entity_id_scheme:"
          },
          {
            "type": "add",
            "line": "                # Validate entity ids are the form of: `https://github.com/login/oauth/authorize`"
          },
          {
            "type": "add",
            "line": "                self.log.error("
          },
          {
            "type": "add",
            "line": "                    f\"Trying to allow an auth provider: {entity_id}, that doesn't look like a valid CILogon EntityID.\","
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "                raise ValueError("
          },
          {
            "type": "add",
            "line": "                    \"\"\"The keys of `allowed_idps` **must** be CILogon permitted EntityIDs."
          },
          {
            "type": "add",
            "line": "                    See https://cilogon.org/idplist for the list of EntityIDs of each IDP."
          },
          {
            "type": "add",
            "line": "                    \"\"\""
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return idps"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     strip_idp_domain = Bool("
          },
          {
            "type": "context",
            "line": "         False,"
          },
          {
            "type": "context",
            "line": "         config=True,"
          },
          {
            "type": "delete",
            "line": "        help=\"\"\"Remove the IDP domain from the username. Note that only domains which"
          },
          {
            "type": "delete",
            "line": "             appear in the `allowed_idps` will be stripped.\"\"\","
          },
          {
            "type": "add",
            "line": "        help=\"\"\"Deprecated, use `CILogonOAuthenticator.allowed_idps[\"username_derivation\"][\"action\"] = \"strip_idp_domain\"`"
          },
          {
            "type": "add",
            "line": "        to enable it and `CIlogonOAuthenticator.allowed_idps[\"username_derivation\"][\"domain\"]` to list the domain"
          },
          {
            "type": "add",
            "line": "        which will be stripped"
          },
          {
            "type": "add",
            "line": "        \"\"\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     idp = Unicode("
          },
          {
            "type": "add",
            "line": "        config=True, help=\"Deprecated, use `CILogonOAuthenticator.shown_idps`.\""
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    shown_idps = List("
          },
          {
            "type": "add",
            "line": "        Unicode(),"
          },
          {
            "type": "context",
            "line": "         config=True,"
          },
          {
            "type": "delete",
            "line": "        help=\"\"\"The `idp` attribute is the SAML Entity ID of the user's selected"
          },
          {
            "type": "delete",
            "line": "            identity provider."
          },
          {
            "type": "add",
            "line": "        help=\"\"\"A list of identity providers to be shown as login options."
          },
          {
            "type": "add",
            "line": "        The `idp` attribute is the SAML Entity ID of the user's selected"
          },
          {
            "type": "add",
            "line": "        identity provider."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            See https://cilogon.org/include/idplist.xml for the list of identity"
          },
          {
            "type": "delete",
            "line": "            providers supported by CILogon."
          },
          {
            "type": "add",
            "line": "        See https://cilogon.org/include/idplist.xml for the list of identity"
          },
          {
            "type": "add",
            "line": "        providers supported by CILogon."
          },
          {
            "type": "context",
            "line": "         \"\"\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     skin = Unicode("
          },
          {
            "type": "context",
            "line": "         config=True,"
          },
          {
            "type": "context",
            "line": "         help=\"\"\"The `skin` attribute is the name of the custom CILogon interface skin"
          },
          {
            "type": "delete",
            "line": "            for your application."
          },
          {
            "type": "add",
            "line": "        for your application."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            Contact help@cilogon.org to request a custom skin."
          },
          {
            "type": "add",
            "line": "        Contact help@cilogon.org to request a custom skin."
          },
          {
            "type": "context",
            "line": "         \"\"\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     username_claim = Unicode("
          },
          {
            "type": "context",
            "line": "         \"eppn\","
          },
          {
            "type": "context",
            "line": "         config=True,"
          },
          {
            "type": "context",
            "line": "         help=\"\"\"The claim in the userinfo response from which to get the JupyterHub username"
          },
          {
            "type": "add",
            "line": "        Examples include: eppn, email"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            Examples include: eppn, email"
          },
          {
            "type": "add",
            "line": "        What keys are available will depend on the scopes requested."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            What keys are available will depend on the scopes requested."
          },
          {
            "type": "add",
            "line": "        See https://www.cilogon.org/oidc for details."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            See https://www.cilogon.org/oidc for details."
          },
          {
            "type": "add",
            "line": "        Note that this option can be overridden for specific identity providers via `allowed_idps[<identity provider>][\"username_derivation\"][\"username_claim\"]`."
          },
          {
            "type": "context",
            "line": "         \"\"\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         \"\"\","
          },
          {
            "type": "context",
            "line": "     )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def check_username_claim(self, claimlist, resp_json):"
          },
          {
            "type": "add",
            "line": "        for claim in claimlist:"
          },
          {
            "type": "add",
            "line": "            username = resp_json.get(claim)"
          },
          {
            "type": "add",
            "line": "            if username:"
          },
          {
            "type": "add",
            "line": "                return username"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if not username:"
          },
          {
            "type": "add",
            "line": "            if len(claimlist) < 2:"
          },
          {
            "type": "add",
            "line": "                self.log.error("
          },
          {
            "type": "add",
            "line": "                    \"Username claim %s not found in response: %s\","
          },
          {
            "type": "add",
            "line": "                    self.username_claim,"
          },
          {
            "type": "add",
            "line": "                    sorted(resp_json.keys()),"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            else:"
          },
          {
            "type": "add",
            "line": "                self.log.error("
          },
          {
            "type": "add",
            "line": "                    \"No username claim from %r in response: %s\","
          },
          {
            "type": "add",
            "line": "                    claimlist,"
          },
          {
            "type": "add",
            "line": "                    sorted(resp_json.keys()),"
          },
          {
            "type": "add",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            raise web.HTTPError(500, \"Failed to get username from CILogon\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     async def authenticate(self, handler, data=None):"
          },
          {
            "type": "context",
            "line": "         \"\"\"We set up auth_state based on additional CILogon info if we"
          },
          {
            "type": "context",
            "line": "         receive it."
          },
          {
            "type": "context",
            "line": "         if self.additional_username_claims:"
          },
          {
            "type": "context",
            "line": "             claimlist.extend(self.additional_username_claims)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        for claim in claimlist:"
          },
          {
            "type": "delete",
            "line": "            username = resp_json.get(claim)"
          },
          {
            "type": "delete",
            "line": "            if username:"
          },
          {
            "type": "delete",
            "line": "                break"
          },
          {
            "type": "delete",
            "line": "        if not username:"
          },
          {
            "type": "delete",
            "line": "            if len(claimlist) < 2:"
          },
          {
            "type": "add",
            "line": "        selected_idp = resp_json.get(\"idp\")"
          },
          {
            "type": "add",
            "line": "        # Check if selected idp was marked as allowed"
          },
          {
            "type": "add",
            "line": "        if self.allowed_idps:"
          },
          {
            "type": "add",
            "line": "            # Faild hard if idp wasn't allowed"
          },
          {
            "type": "add",
            "line": "            if selected_idp not in self.allowed_idps.keys():"
          },
          {
            "type": "context",
            "line": "                 self.log.error("
          },
          {
            "type": "delete",
            "line": "                    \"Username claim %s not found in response: %s\","
          },
          {
            "type": "delete",
            "line": "                    self.username_claim,"
          },
          {
            "type": "delete",
            "line": "                    sorted(resp_json.keys()),"
          },
          {
            "type": "add",
            "line": "                    f\"Trying to login from an identity provider that was not allowed {selected_idp}\","
          },
          {
            "type": "context",
            "line": "                 )"
          },
          {
            "type": "delete",
            "line": "            else:"
          },
          {
            "type": "delete",
            "line": "                self.log.error("
          },
          {
            "type": "delete",
            "line": "                    \"No username claim from %r in response: %s\","
          },
          {
            "type": "delete",
            "line": "                    claimlist,"
          },
          {
            "type": "delete",
            "line": "                    sorted(resp_json.keys()),"
          },
          {
            "type": "add",
            "line": "                raise web.HTTPError("
          },
          {
            "type": "add",
            "line": "                    500,"
          },
          {
            "type": "add",
            "line": "                    \"Trying to login using an identity provider that was not allowed\","
          },
          {
            "type": "context",
            "line": "                 )"
          },
          {
            "type": "delete",
            "line": "            raise web.HTTPError(500, \"Failed to get username from CILogon\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "            # The username_claim which should be used for this idp"
          },
          {
            "type": "add",
            "line": "            claimlist = ["
          },
          {
            "type": "add",
            "line": "                self.allowed_idps[selected_idp][\"username_derivation\"][\"username_claim\"]"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Check if the requested username_claim exists in the response from the provider"
          },
          {
            "type": "add",
            "line": "        username = self.check_username_claim(claimlist, resp_json)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Check if we need to strip/prefix username"
          },
          {
            "type": "context",
            "line": "         if self.allowed_idps:"
          },
          {
            "type": "delete",
            "line": "            gotten_name, gotten_idp = username.split('@')"
          },
          {
            "type": "delete",
            "line": "            if gotten_idp not in self.allowed_idps:"
          },
          {
            "type": "delete",
            "line": "                self.log.error(\"Trying to login from not allowed domain %s\", gotten_idp)"
          },
          {
            "type": "delete",
            "line": "                raise web.HTTPError(500, \"Trying to login from a domain not allowed\")"
          },
          {
            "type": "delete",
            "line": "            if len(self.allowed_idps) == 1 and self.strip_idp_domain:"
          },
          {
            "type": "delete",
            "line": "                username = gotten_name"
          },
          {
            "type": "add",
            "line": "            username_derivation_config = self.allowed_idps[selected_idp]["
          },
          {
            "type": "add",
            "line": "                \"username_derivation\""
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "            action = username_derivation_config[\"action\"]"
          },
          {
            "type": "add",
            "line": "            if action == \"strip_idp_domain\":"
          },
          {
            "type": "add",
            "line": "                gotten_name, gotten_domain = username.split('@')"
          },
          {
            "type": "add",
            "line": "                if gotten_domain != username_derivation_config[\"domain\"]:"
          },
          {
            "type": "add",
            "line": "                    self.log.warning("
          },
          {
            "type": "add",
            "line": "                        \"Trying to strip from the username a domain that doesn't exist.\""
          },
          {
            "type": "add",
            "line": "                        \"Username will be left unchanged.\""
          },
          {
            "type": "add",
            "line": "                    )"
          },
          {
            "type": "add",
            "line": "                else:"
          },
          {
            "type": "add",
            "line": "                    username = gotten_name"
          },
          {
            "type": "add",
            "line": "            elif action == \"prefix\":"
          },
          {
            "type": "add",
            "line": "                prefix = username_derivation_config[\"prefix\"]"
          },
          {
            "type": "add",
            "line": "                username = f\"{prefix}:{username}\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         userdict = {\"name\": username}"
          },
          {
            "type": "context",
            "line": "         # Now we set up auth_state"
          },
          {
            "type": "context",
            "line": "         userdict[\"auth_state\"] = auth_state = {}"
          }
        ]
      },
      {
        "file": "oauthenticator/oauth2.py",
        "changes": [
          {
            "type": "context",
            "line": "index 30532c5..ef5b70b 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/oauth2.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/oauth2.py"
          },
          {
            "type": "context",
            "line": "     def _deprecated_oauth_trait(self, change):"
          },
          {
            "type": "context",
            "line": "         \"\"\"observer for deprecated traits\"\"\""
          },
          {
            "type": "context",
            "line": "         old_attr = change.name"
          },
          {
            "type": "delete",
            "line": "        new_attr, version = self._deprecated_oauth_aliases.get(old_attr)"
          },
          {
            "type": "add",
            "line": "        try:"
          },
          {
            "type": "add",
            "line": "            new_attr, version, same = self._deprecated_oauth_aliases.get(old_attr)"
          },
          {
            "type": "add",
            "line": "        except ValueError:"
          },
          {
            "type": "add",
            "line": "            # if `same` flag wasn't passed, we assume the new and old trait have the same type"
          },
          {
            "type": "add",
            "line": "            new_attr, version = self._deprecated_oauth_aliases.get(old_attr)"
          },
          {
            "type": "add",
            "line": "            same = True"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         new_value = getattr(self, new_attr)"
          },
          {
            "type": "context",
            "line": "         if new_value != change.new:"
          },
          {
            "type": "context",
            "line": "             # only warn if different"
          },
          {
            "type": "context",
            "line": "             # protects backward-compatible config from warnings"
          },
          {
            "type": "context",
            "line": "             # if they set the same value under both names"
          },
          {
            "type": "delete",
            "line": "            self.log.warning("
          },
          {
            "type": "delete",
            "line": "                \"{cls}.{old} is deprecated in {cls} {version}, use {cls}.{new} instead\".format("
          },
          {
            "type": "delete",
            "line": "                    cls=self.__class__.__name__,"
          },
          {
            "type": "delete",
            "line": "                    old=old_attr,"
          },
          {
            "type": "delete",
            "line": "                    new=new_attr,"
          },
          {
            "type": "delete",
            "line": "                    version=version,"
          },
          {
            "type": "delete",
            "line": "                )"
          },
          {
            "type": "add",
            "line": "            message = \"{cls}.{old} is deprecated in {cls} {version}, use {cls}.{new} instead\".format("
          },
          {
            "type": "add",
            "line": "                cls=self.__class__.__name__,"
          },
          {
            "type": "add",
            "line": "                old=old_attr,"
          },
          {
            "type": "add",
            "line": "                new=new_attr,"
          },
          {
            "type": "add",
            "line": "                version=version,"
          },
          {
            "type": "context",
            "line": "             )"
          },
          {
            "type": "delete",
            "line": "            setattr(self, new_attr, change.new)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            # set the value for the new attr only if they are the same type"
          },
          {
            "type": "add",
            "line": "            # otherwise raise an error because unexpected things can happen"
          },
          {
            "type": "add",
            "line": "            if same:"
          },
          {
            "type": "add",
            "line": "                self.log.warning(message)"
          },
          {
            "type": "add",
            "line": "                setattr(self, new_attr, change.new)"
          },
          {
            "type": "add",
            "line": "            else:"
          },
          {
            "type": "add",
            "line": "                self.log.error(message)"
          },
          {
            "type": "add",
            "line": "                raise ValueError(message)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def __init__(self, **kwargs):"
          },
          {
            "type": "context",
            "line": "         # observe deprecated config names in oauthenticator"
          }
        ]
      },
      {
        "file": "oauthenticator/schemas/cilogon-schema.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000..60c02b3"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/schemas/cilogon-schema.yaml"
          },
          {
            "type": "add",
            "line": "$schema: http://json-schema.org/draft-07/schema#"
          },
          {
            "type": "add",
            "line": "title: username_derivation"
          },
          {
            "type": "add",
            "line": "type: object"
          },
          {
            "type": "add",
            "line": "additionalProperties: false"
          },
          {
            "type": "add",
            "line": "required:"
          },
          {
            "type": "add",
            "line": "  - username_derivation"
          },
          {
            "type": "add",
            "line": "properties:"
          },
          {
            "type": "add",
            "line": "  username_derivation:"
          },
          {
            "type": "add",
            "line": "    type: object"
          },
          {
            "type": "add",
            "line": "    additionalProperties: false"
          },
          {
            "type": "add",
            "line": "    properties:"
          },
          {
            "type": "add",
            "line": "      username_claim:"
          },
          {
            "type": "add",
            "line": "        type: string"
          },
          {
            "type": "add",
            "line": "      action:"
          },
          {
            "type": "add",
            "line": "        type: string"
          },
          {
            "type": "add",
            "line": "        enum:"
          },
          {
            "type": "add",
            "line": "          - strip_idp_domain"
          },
          {
            "type": "add",
            "line": "          - prefix"
          },
          {
            "type": "add",
            "line": "      domain:"
          },
          {
            "type": "add",
            "line": "        type: string"
          },
          {
            "type": "add",
            "line": "      prefix:"
          },
          {
            "type": "add",
            "line": "        type: string"
          },
          {
            "type": "add",
            "line": "    required:"
          },
          {
            "type": "add",
            "line": "      - username_claim"
          },
          {
            "type": "add",
            "line": "      - action"
          },
          {
            "type": "add",
            "line": "    allOf:"
          },
          {
            "type": "add",
            "line": "      - if:"
          },
          {
            "type": "add",
            "line": "          properties:"
          },
          {
            "type": "add",
            "line": "            action:"
          },
          {
            "type": "add",
            "line": "              const: strip_idp_domain"
          },
          {
            "type": "add",
            "line": "        then:"
          },
          {
            "type": "add",
            "line": "          required:"
          },
          {
            "type": "add",
            "line": "            - domain"
          },
          {
            "type": "add",
            "line": "      - if:"
          },
          {
            "type": "add",
            "line": "          properties:"
          },
          {
            "type": "add",
            "line": "            action:"
          },
          {
            "type": "add",
            "line": "              const: prefix"
          },
          {
            "type": "add",
            "line": "        then:"
          },
          {
            "type": "add",
            "line": "          required:"
          },
          {
            "type": "add",
            "line": "            - prefix"
          }
        ]
      },
      {
        "file": "oauthenticator/tests/test_cilogon.py",
        "changes": [
          {
            "type": "context",
            "line": "index 453e423..d53c948 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/tests/test_cilogon.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/tests/test_cilogon.py"
          },
          {
            "type": "context",
            "line": " import json"
          },
          {
            "type": "context",
            "line": " import logging"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "from jsonschema.exceptions import ValidationError"
          },
          {
            "type": "context",
            "line": " from pytest import fixture, raises"
          },
          {
            "type": "context",
            "line": " from tornado.web import HTTPError"
          },
          {
            "type": "context",
            "line": " from traitlets.config import Config"
          },
          {
            "type": "add",
            "line": "from traitlets.traitlets import TraitError"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from ..cilogon import CILogonOAuthenticator"
          },
          {
            "type": "context",
            "line": " from .mocks import setup_oauth_mock"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def alternative_user_model(username, claimname):"
          },
          {
            "type": "add",
            "line": "def alternative_user_model(username, claimname, **kwargs):"
          },
          {
            "type": "context",
            "line": "     \"\"\"Return a user model with alternate claim name\"\"\""
          },
          {
            "type": "delete",
            "line": "    return {"
          },
          {
            "type": "delete",
            "line": "        claimname: username,"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    return {claimname: username, **kwargs}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " @fixture"
          },
          {
            "type": "context",
            "line": "     cfg = Config()"
          },
          {
            "type": "context",
            "line": "     cfg.CILogonOAuthenticator.idp_whitelist = ['pink']"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    log = logging.getLogger(\"testlog\")"
          },
          {
            "type": "delete",
            "line": "    authenticator = CILogonOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "delete",
            "line": "    assert caplog.record_tuples == ["
          },
          {
            "type": "delete",
            "line": "        ("
          },
          {
            "type": "delete",
            "line": "            log.name,"
          },
          {
            "type": "delete",
            "line": "            logging.WARNING,"
          },
          {
            "type": "delete",
            "line": "            'CILogonOAuthenticator.idp_whitelist is deprecated in CILogonOAuthenticator 0.12.0, use '"
          },
          {
            "type": "delete",
            "line": "            'CILogonOAuthenticator.allowed_idps instead',"
          },
          {
            "type": "add",
            "line": "    log = logging.getLogger('testlog')"
          },
          {
            "type": "add",
            "line": "    with raises("
          },
          {
            "type": "add",
            "line": "        ValueError,"
          },
          {
            "type": "add",
            "line": "        match='CILogonOAuthenticator.idp_whitelist is deprecated in CILogonOAuthenticator 0.12.0, use '"
          },
          {
            "type": "add",
            "line": "        'CILogonOAuthenticator.allowed_idps instead',"
          },
          {
            "type": "add",
            "line": "    ):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "add",
            "line": "    log_msgs = caplog.record_tuples"
          },
          {
            "type": "add",
            "line": "    print(log_msgs)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    expected_deprecation_error = ("
          },
          {
            "type": "add",
            "line": "        log.name,"
          },
          {
            "type": "add",
            "line": "        logging.ERROR,"
          },
          {
            "type": "add",
            "line": "        'CILogonOAuthenticator.idp_whitelist is deprecated in CILogonOAuthenticator 0.12.0, use '"
          },
          {
            "type": "add",
            "line": "        'CILogonOAuthenticator.allowed_idps instead',"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    assert expected_deprecation_error in log_msgs"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_allowed_idps_wrong_type(caplog):"
          },
          {
            "type": "add",
            "line": "    # Test alllowed_idps is a dict"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = ['pink']"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(TraitError):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_allowed_idps_required_username_derivation(caplog):"
          },
          {
            "type": "add",
            "line": "    # Test username_derivation is a required field of allowed_idps"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://github.com/login/oauth/authorize': {}"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValidationError, match=\"'username_derivation' is a required property\"):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_allowed_idps_invalid_entity_id(caplog):"
          },
          {
            "type": "add",
            "line": "    # Test allowed_idps keys cannot be domains, but only valid CILogon entity ids,"
          },
          {
            "type": "add",
            "line": "    # i.e. only fully formed URLs"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'uni.edu': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {"
          },
          {
            "type": "add",
            "line": "                'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "                'action': 'strip_idp_domain',"
          },
          {
            "type": "add",
            "line": "                'domain': 'uni.edu',"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    log = logging.getLogger('testlog')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValueError):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    log_msgs = caplog.record_tuples"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    expected_deprecation_error = ("
          },
          {
            "type": "add",
            "line": "        log.name,"
          },
          {
            "type": "add",
            "line": "        logging.ERROR,"
          },
          {
            "type": "add",
            "line": "        \"Trying to allow an auth provider: uni.edu, that doesn't look like a valid CILogon EntityID.\","
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    assert expected_deprecation_error in log_msgs"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_allowed_idps_invalid_config_option(caplog):"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    # Test config option not recognized"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://github.com/login/oauth/authorize': 'invalid'"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValidationError, match=\"'invalid' is not of type 'object'\"):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_allowed_idps_invalid_config_type(caplog):"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    # Test username_derivation not dict"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://github.com/login/oauth/authorize': 'username_derivation'"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValidationError, match=\"'username_derivation' is not of type 'object'\"):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_allowed_idps_invalid_config_username_derivation_options(caplog):"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    # Test username_derivation not dict"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://github.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {'a': 1, 'b': 2}"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValidationError, match='Additional properties are not allowed') as e:"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_allowed_idps_invalid_config_username_domain_stripping(caplog):"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    # Test username_derivation not dict"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://github.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {"
          },
          {
            "type": "add",
            "line": "                'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "                'action': 'strip_idp_domain',"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValidationError, match=\"'domain' is a required property\"):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_allowed_idps_invalid_config_username_prefix(caplog):"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    # Test username_derivation not dict"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://github.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {"
          },
          {
            "type": "add",
            "line": "                'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "                'action': 'prefix',"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    with raises(ValidationError, match=\"'prefix' is a required property\"):"
          },
          {
            "type": "add",
            "line": "        CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_cilogon_scopes():"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://some-idp.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {"
          },
          {
            "type": "add",
            "line": "                'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "                'action': 'prefix',"
          },
          {
            "type": "add",
            "line": "                'prefix': 'hub',"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.scope = ['email']"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    authenticator = CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": "    expected_scopes = ['email', 'openid', 'org.cilogon.userinfo']"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    assert authenticator.scope == expected_scopes"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "async def test_strip_and_prefix_username(cilogon_client):"
          },
          {
            "type": "add",
            "line": "    cfg = Config()"
          },
          {
            "type": "add",
            "line": "    cfg.CILogonOAuthenticator.allowed_idps = {"
          },
          {
            "type": "add",
            "line": "        'https://some-idp.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {"
          },
          {
            "type": "add",
            "line": "                'username_claim': 'email',"
          },
          {
            "type": "add",
            "line": "                'action': 'strip_idp_domain',"
          },
          {
            "type": "add",
            "line": "                'domain': 'uni.edu',"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "        'https://another-idp.com/login/oauth/authorize': {"
          },
          {
            "type": "add",
            "line": "            'username_derivation': {"
          },
          {
            "type": "add",
            "line": "                'username_claim': 'nickname',"
          },
          {
            "type": "add",
            "line": "                'action': 'prefix',"
          },
          {
            "type": "add",
            "line": "                'prefix': 'idp',"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    authenticator = CILogonOAuthenticator(config=cfg)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # Test stripping domain"
          },
          {
            "type": "add",
            "line": "    handler = cilogon_client.handler_for_user("
          },
          {
            "type": "add",
            "line": "        alternative_user_model("
          },
          {
            "type": "add",
            "line": "            'jtkirk@uni.edu', 'email', idp='https://some-idp.com/login/oauth/authorize'"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "delete",
            "line": "    ]"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    user_info = await authenticator.authenticate(handler)"
          },
          {
            "type": "add",
            "line": "    print(json.dumps(user_info, sort_keys=True, indent=4))"
          },
          {
            "type": "add",
            "line": "    name = user_info['name']"
          },
          {
            "type": "add",
            "line": "    assert name == 'jtkirk'"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    assert authenticator.allowed_idps == ['pink']"
          },
          {
            "type": "add",
            "line": "    # Test appending prefixes"
          },
          {
            "type": "add",
            "line": "    handler = cilogon_client.handler_for_user("
          },
          {
            "type": "add",
            "line": "        alternative_user_model("
          },
          {
            "type": "add",
            "line": "            'jtkirk', 'nickname', idp='https://another-idp.com/login/oauth/authorize'"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    user_info = await authenticator.authenticate(handler)"
          },
          {
            "type": "add",
            "line": "    print(json.dumps(user_info, sort_keys=True, indent=4))"
          },
          {
            "type": "add",
            "line": "    name = user_info['name']"
          },
          {
            "type": "add",
            "line": "    assert name == 'idp:jtkirk'"
          }
        ]
      },
      {
        "file": "requirements.txt",
        "changes": [
          {
            "type": "context",
            "line": "index b98c7a2..8c2d4e9 100644"
          },
          {
            "type": "context",
            "line": "--- a/requirements.txt"
          },
          {
            "type": "context",
            "line": "+++ b/requirements.txt"
          },
          {
            "type": "add",
            "line": "# jsonschema is used for validating authenticator configurations"
          },
          {
            "type": "add",
            "line": "jsonschema"
          },
          {
            "type": "context",
            "line": " jupyterhub>=1.2"
          },
          {
            "type": "context",
            "line": " # requests is already required by JupyterHub, but explicitly ask for it since we use it"
          },
          {
            "type": "context",
            "line": " requests"
          },
          {
            "type": "add",
            "line": "# ruamel.yaml is used to read and write .yaml files."
          },
          {
            "type": "add",
            "line": "ruamel.yaml"
          }
        ]
      },
      {
        "file": "setup.py",
        "changes": [
          {
            "type": "context",
            "line": "index b23d88a..bf88953 100644"
          },
          {
            "type": "context",
            "line": "--- a/setup.py"
          },
          {
            "type": "context",
            "line": "+++ b/setup.py"
          },
          {
            "type": "context",
            "line": "     platforms=\"Linux, Mac OS X\","
          },
          {
            "type": "context",
            "line": "     keywords=['Interactive', 'Interpreter', 'Shell', 'Web'],"
          },
          {
            "type": "context",
            "line": "     python_requires=\">=3.6\","
          },
          {
            "type": "add",
            "line": "    include_package_data=True,"
          },
          {
            "type": "context",
            "line": "     entry_points={"
          },
          {
            "type": "context",
            "line": "         'jupyterhub.authenticators': ["
          },
          {
            "type": "context",
            "line": "             'auth0 = oauthenticator.auth0:Auth0OAuthenticator',"
          }
        ]
      }
    ]
  },
  {
    "commit": "61045ceefea114c40ac4b680af58990dbe732389",
    "files": [
      {
        "file": "wagtail/admin/compare.py",
        "changes": [
          {
            "type": "context",
            "line": "index 873f5b665e..dd43af265d 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/admin/compare.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/admin/compare.py"
          },
          {
            "type": "context",
            "line": " from wagtail.core import blocks"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def text_from_html(val):"
          },
          {
            "type": "add",
            "line": "    # Return the unescaped text content of an HTML string"
          },
          {
            "type": "add",
            "line": "    return BeautifulSoup(force_str(val), 'html5lib').getText()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " class FieldComparison:"
          },
          {
            "type": "context",
            "line": "     is_field = True"
          },
          {
            "type": "context",
            "line": "     is_child_relation = False"
          },
          {
            "type": "context",
            "line": " class RichTextFieldComparison(TextFieldComparison):"
          },
          {
            "type": "context",
            "line": "     def htmldiff(self):"
          },
          {
            "type": "context",
            "line": "         return diff_text("
          },
          {
            "type": "delete",
            "line": "            BeautifulSoup(force_str(self.val_a), 'html5lib').getText(),"
          },
          {
            "type": "delete",
            "line": "            BeautifulSoup(force_str(self.val_b), 'html5lib').getText()"
          },
          {
            "type": "add",
            "line": "            text_from_html(self.val_a),"
          },
          {
            "type": "add",
            "line": "            text_from_html(self.val_b)"
          },
          {
            "type": "context",
            "line": "         ).to_html()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def get_comparison_class_for_block(block):"
          },
          {
            "type": "context",
            "line": "     if hasattr(block, 'get_comparison_class'):"
          },
          {
            "type": "context",
            "line": "         return block.get_comparison_class()"
          },
          {
            "type": "delete",
            "line": "    elif isinstance(block, blocks.CharBlock):"
          },
          {
            "type": "add",
            "line": "    elif isinstance(block, (blocks.CharBlock, blocks.TextBlock)):"
          },
          {
            "type": "add",
            "line": "        return CharBlockComparison"
          },
          {
            "type": "add",
            "line": "    elif isinstance(block, blocks.RawHTMLBlock):"
          },
          {
            "type": "add",
            "line": "        # Compare raw HTML blocks as if they were plain text, so that tags are shown explicitly"
          },
          {
            "type": "context",
            "line": "         return CharBlockComparison"
          },
          {
            "type": "context",
            "line": "     elif isinstance(block, blocks.RichTextBlock):"
          },
          {
            "type": "context",
            "line": "         return RichTextBlockComparison"
          },
          {
            "type": "context",
            "line": "         return self.val_a != self.val_b"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def htmlvalue(self, val):"
          },
          {
            "type": "delete",
            "line": "        return self.block.render_basic(val)"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        Return an HTML representation of this block that is safe to be included"
          },
          {
            "type": "add",
            "line": "        in comparison views"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        return escape(text_from_html(self.block.render_basic(val)))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def htmldiff(self):"
          },
          {
            "type": "add",
            "line": "        html_val_a = self.block.render_basic(self.val_a)"
          },
          {
            "type": "add",
            "line": "        html_val_b = self.block.render_basic(self.val_b)"
          },
          {
            "type": "add",
            "line": "        return diff_text("
          },
          {
            "type": "add",
            "line": "            text_from_html(html_val_a),"
          },
          {
            "type": "add",
            "line": "            text_from_html(html_val_b)"
          },
          {
            "type": "add",
            "line": "        ).to_html()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class CharBlockComparison(BlockComparison):"
          },
          {
            "type": "context",
            "line": "             force_str(self.val_b)"
          },
          {
            "type": "context",
            "line": "         ).to_html()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def htmlvalue(self, val):"
          },
          {
            "type": "add",
            "line": "        return escape(val)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class RichTextBlockComparison(BlockComparison):"
          },
          {
            "type": "delete",
            "line": "    def htmldiff(self):"
          },
          {
            "type": "delete",
            "line": "        return diff_text("
          },
          {
            "type": "delete",
            "line": "            BeautifulSoup(force_str(self.val_a), 'html5lib').getText(),"
          },
          {
            "type": "delete",
            "line": "            BeautifulSoup(force_str(self.val_b), 'html5lib').getText()"
          },
          {
            "type": "delete",
            "line": "        ).to_html()"
          },
          {
            "type": "add",
            "line": "    pass"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class StructBlockComparison(BlockComparison):"
          },
          {
            "type": "context",
            "line": "         else:"
          },
          {
            "type": "context",
            "line": "             # Fall back to diffing the HTML representation"
          },
          {
            "type": "context",
            "line": "             return diff_text("
          },
          {
            "type": "delete",
            "line": "                BeautifulSoup(force_str(self.val_a), 'html5lib').getText(),"
          },
          {
            "type": "delete",
            "line": "                BeautifulSoup(force_str(self.val_b), 'html5lib').getText()"
          },
          {
            "type": "add",
            "line": "                text_from_html(self.val_a),"
          },
          {
            "type": "add",
            "line": "                text_from_html(self.val_b)"
          },
          {
            "type": "context",
            "line": "             ).to_html()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "wagtail/admin/tests/test_compare.py",
        "changes": [
          {
            "type": "context",
            "line": "index 262f4ba91d..2348ba11f4 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/admin/tests/test_compare.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/admin/tests/test_compare.py"
          },
          {
            "type": "context",
            "line": "         self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "context",
            "line": "         self.assertTrue(comparison.has_changed())"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def test_htmldiff_escapes_value(self):"
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_escapes_value_on_change(self):"
          },
          {
            "type": "context",
            "line": "         field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         comparison = self.comparison_class("
          },
          {
            "type": "context",
            "line": "             field,"
          },
          {
            "type": "context",
            "line": "             StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "delete",
            "line": "                ('text', \"Original content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('text', \"I <b>really</b> like original<i>ish</i> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('text', 'I <b>really</b> like evil code <script type=\"text/javascript\">doSomethingBad();</script>', '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">I &lt;b&gt;really&lt;/b&gt; like <span class=\"deletion\">original&lt;i&gt;ish&lt;/i&gt; content</span><span class=\"addition\">evil code &lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</span></div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_escapes_value_on_addition(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('text', '<script type=\"text/javascript\">doSomethingBad();</script>', '2'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">Original &lt;em&gt;and unchanged&lt;/em&gt; content</div>\\n<div class=\"comparison__child-object addition\">&lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_escapes_value_on_deletion(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('text', '<script type=\"text/javascript\">doSomethingBad();</script>', '2'),"
          },
          {
            "type": "context",
            "line": "             ])),"
          },
          {
            "type": "context",
            "line": "             StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "delete",
            "line": "                ('text', '<script type=\"text/javascript\">doSomethingBad();</script>', '1'),"
          },
          {
            "type": "add",
            "line": "                ('text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "context",
            "line": "             ])),"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\"><span class=\"deletion\">Original content</span><span class=\"addition\">&lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</span></div>')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">Original &lt;em&gt;and unchanged&lt;/em&gt; content</div>\\n<div class=\"comparison__child-object deletion\">&lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</div>')"
          },
          {
            "type": "context",
            "line": "         self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def test_htmldiff_escapes_value_richtext(self):"
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_richtext_strips_tags_on_change(self):"
          },
          {
            "type": "context",
            "line": "         field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         comparison = self.comparison_class("
          },
          {
            "type": "context",
            "line": "             field,"
          },
          {
            "type": "context",
            "line": "             StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "delete",
            "line": "                ('rich_text', \"Original content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('rich_text', \"I <b>really</b> like Wagtail &lt;3\", '1'),"
          },
          {
            "type": "context",
            "line": "             ])),"
          },
          {
            "type": "context",
            "line": "             StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "delete",
            "line": "                ('rich_text', '<script type=\"text/javascript\">doSomethingBad();</script>', '1'),"
          },
          {
            "type": "add",
            "line": "                ('rich_text', 'I <b>really</b> like evil code &gt;_&lt; <script type=\"text/javascript\">doSomethingBad();</script>', '1'),"
          },
          {
            "type": "context",
            "line": "             ])),"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\"><span class=\"deletion\">Original content</span><span class=\"addition\">doSomethingBad();</span></div>')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">I really like <span class=\"deletion\">Wagtail &lt;3</span><span class=\"addition\">evil code &gt;_&lt; doSomethingBad();</span></div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_richtext_strips_tags_on_addition(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('rich_text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('rich_text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('rich_text', 'I <b>really</b> like evil code &gt;_&lt; <script type=\"text/javascript\">doSomethingBad();</script>', '2'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">Original and unchanged content</div>\\n<div class=\"comparison__child-object addition\">I really like evil code &gt;_&lt; doSomethingBad();</div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_richtext_strips_tags_on_deletion(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('rich_text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('rich_text', 'I <b>really</b> like evil code &gt;_&lt; <script type=\"text/javascript\">doSomethingBad();</script>', '2'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('rich_text', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">Original and unchanged content</div>\\n<div class=\"comparison__child-object deletion\">I really like evil code &gt;_&lt; doSomethingBad();</div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_raw_html_escapes_value_on_change(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('raw_html', \"Original<i>ish</i> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('raw_html', '<script type=\"text/javascript\">doSomethingBad();</script>', '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\"><span class=\"deletion\">Original&lt;i&gt;ish&lt;/i&gt; content</span><span class=\"addition\">&lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</span></div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_raw_html_escapes_value_on_addition(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('raw_html', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('raw_html', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('raw_html', '<script type=\"text/javascript\">doSomethingBad();</script>', '2'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">Original &lt;em&gt;and unchanged&lt;/em&gt; content</div>\\n<div class=\"comparison__child-object addition\">&lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</div>')"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_htmldiff_raw_html_escapes_value_on_deletion(self):"
          },
          {
            "type": "add",
            "line": "        field = StreamPage._meta.get_field('body')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        comparison = self.comparison_class("
          },
          {
            "type": "add",
            "line": "            field,"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('raw_html', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "                ('raw_html', '<script type=\"text/javascript\">doSomethingBad();</script>', '2'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "            StreamPage(body=StreamValue(field.stream_block, ["
          },
          {
            "type": "add",
            "line": "                ('raw_html', \"Original <em>and unchanged</em> content\", '1'),"
          },
          {
            "type": "add",
            "line": "            ])),"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(comparison.htmldiff(), '<div class=\"comparison__child-object\">Original &lt;em&gt;and unchanged&lt;/em&gt; content</div>\\n<div class=\"comparison__child-object deletion\">&lt;script type=&quot;text/javascript&quot;&gt;doSomethingBad();&lt;/script&gt;</div>')"
          },
          {
            "type": "context",
            "line": "         self.assertIsInstance(comparison.htmldiff(), SafeString)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_compare_structblock(self):"
          }
        ]
      },
      {
        "file": "wagtail/tests/testapp/migrations/0047_rawhtmlblock.py",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..479d41108a"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/tests/testapp/migrations/0047_rawhtmlblock.py"
          },
          {
            "type": "add",
            "line": "# Generated by Django 3.0.4 on 2020-04-06 09:46"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from django.db import migrations"
          },
          {
            "type": "add",
            "line": "import wagtail.core.blocks"
          },
          {
            "type": "add",
            "line": "import wagtail.core.fields"
          },
          {
            "type": "add",
            "line": "import wagtail.tests.testapp.models"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class Migration(migrations.Migration):"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    dependencies = ["
          },
          {
            "type": "add",
            "line": "        ('tests', '0046_personpage'),"
          },
          {
            "type": "add",
            "line": "    ]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    operations = ["
          },
          {
            "type": "add",
            "line": "        migrations.AlterField("
          },
          {
            "type": "add",
            "line": "            model_name='streampage',"
          },
          {
            "type": "add",
            "line": "            name='body',"
          },
          {
            "type": "add",
            "line": "            field=wagtail.core.fields.StreamField([('text', wagtail.core.blocks.CharBlock()), ('rich_text', wagtail.core.blocks.RichTextBlock()), ('image', wagtail.tests.testapp.models.ExtendedImageChooserBlock()), ('product', wagtail.core.blocks.StructBlock([('name', wagtail.core.blocks.CharBlock()), ('price', wagtail.core.blocks.CharBlock())])), ('raw_html', wagtail.core.blocks.RawHTMLBlock())]),"
          },
          {
            "type": "add",
            "line": "        ),"
          },
          {
            "type": "add",
            "line": "    ]"
          }
        ]
      },
      {
        "file": "wagtail/tests/testapp/models.py",
        "changes": [
          {
            "type": "context",
            "line": "index 93bdcb1032..a5dfb14c93 100644"
          },
          {
            "type": "context",
            "line": "--- a/wagtail/tests/testapp/models.py"
          },
          {
            "type": "context",
            "line": "+++ b/wagtail/tests/testapp/models.py"
          },
          {
            "type": "context",
            "line": " from wagtail.contrib.settings.models import BaseSetting, register_setting"
          },
          {
            "type": "context",
            "line": " from wagtail.contrib.sitemaps import Sitemap"
          },
          {
            "type": "context",
            "line": " from wagtail.contrib.table_block.blocks import TableBlock"
          },
          {
            "type": "delete",
            "line": "from wagtail.core.blocks import CharBlock, RichTextBlock, StructBlock"
          },
          {
            "type": "add",
            "line": "from wagtail.core.blocks import CharBlock, RawHTMLBlock, RichTextBlock, StructBlock"
          },
          {
            "type": "context",
            "line": " from wagtail.core.fields import RichTextField, StreamField"
          },
          {
            "type": "context",
            "line": " from wagtail.core.models import Orderable, Page, PageManager, PageQuerySet"
          },
          {
            "type": "context",
            "line": " from wagtail.documents.edit_handlers import DocumentChooserPanel"
          },
          {
            "type": "context",
            "line": "             ('name', CharBlock()),"
          },
          {
            "type": "context",
            "line": "             ('price', CharBlock()),"
          },
          {
            "type": "context",
            "line": "         ])),"
          },
          {
            "type": "add",
            "line": "        ('raw_html', RawHTMLBlock()),"
          },
          {
            "type": "context",
            "line": "     ])"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     api_fields = ('body',)"
          }
        ]
      }
    ]
  },
  {
    "commit": "61984e6843d2e59235d82a580c529920cd8f3711",
    "files": [
      {
        "file": "mlflow/utils/file_utils.py",
        "changes": [
          {
            "type": "context",
            "line": "index 32653b343..4b59a3673 100644"
          },
          {
            "type": "context",
            "line": "--- a/mlflow/utils/file_utils.py"
          },
          {
            "type": "context",
            "line": "+++ b/mlflow/utils/file_utils.py"
          },
          {
            "type": "context",
            "line": "         tar_info.mtime = 0"
          },
          {
            "type": "context",
            "line": "         return tar_info if custom_filter is None else custom_filter(tar_info)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    unzipped_filename = tempfile.mktemp()"
          },
          {
            "type": "add",
            "line": "    unzipped_file_handle, unzipped_filename = tempfile.mkstemp()"
          },
          {
            "type": "context",
            "line": "     try:"
          },
          {
            "type": "context",
            "line": "         with tarfile.open(unzipped_filename, \"w\") as tar:"
          },
          {
            "type": "context",
            "line": "             tar.add(source_dir, arcname=archive_name, filter=_filter_timestamps)"
          },
          {
            "type": "context",
            "line": "         ) as gzipped_tar, open(unzipped_filename, \"rb\") as tar:"
          },
          {
            "type": "context",
            "line": "             gzipped_tar.write(tar.read())"
          },
          {
            "type": "context",
            "line": "     finally:"
          },
          {
            "type": "delete",
            "line": "        os.remove(unzipped_filename)"
          },
          {
            "type": "add",
            "line": "        os.close(unzipped_file_handle)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _copy_project(src_path, dst_path=\"\"):"
          }
        ]
      }
    ]
  },
  {
    "commit": "6840529def97f564844e810e5a7c5bf837cf58d5",
    "files": [
      {
        "file": "plugins/hudson_git/include/HudsonGit/GitWebhooksSettingsEnhancer.php",
        "changes": [
          {
            "type": "context",
            "line": "index fa16111593b..da74d4adbcf 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/hudson_git/include/HudsonGit/GitWebhooksSettingsEnhancer.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/hudson_git/include/HudsonGit/GitWebhooksSettingsEnhancer.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " namespace Tuleap\\HudsonGit;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Codendi_HTMLPurifier;"
          },
          {
            "type": "context",
            "line": " use GitRepository;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Git\\Webhook\\ExternalWebhookPresenter;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\HudsonGit\\Git\\Administration\\JenkinsServerFactory;"
          },
          {
            "type": "context",
            "line": " use CSRFSynchronizerToken;"
          },
          {
            "type": "context",
            "line": " use TemplateRendererFactory;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\HudsonGit\\Log\\LogFactory;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Sanitizer\\URISanitizer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": "  * I am responsible of adding the possibility to repo admin to define jenkins hook for a git repository and"
          },
          {
            "type": "context",
            "line": "         LogFactory $log_factory,"
          },
          {
            "type": "context",
            "line": "         CSRFSynchronizerToken $csrf,"
          },
          {
            "type": "context",
            "line": "         JenkinsServerFactory $jenkins_server_factory,"
          },
          {
            "type": "add",
            "line": "        private readonly Codendi_HTMLPurifier $html_purifier,"
          },
          {
            "type": "add",
            "line": "        private readonly URISanitizer $uri_sanitizer,"
          },
          {
            "type": "context",
            "line": "     ) {"
          },
          {
            "type": "context",
            "line": "         $this->dao                    = $dao;"
          },
          {
            "type": "context",
            "line": "         $this->csrf                   = $csrf;"
          },
          {
            "type": "context",
            "line": "                         $repository,"
          },
          {
            "type": "context",
            "line": "                         $url,"
          },
          {
            "type": "context",
            "line": "                         $triggered_jobs,"
          },
          {
            "type": "delete",
            "line": "                        $this->csrf"
          },
          {
            "type": "add",
            "line": "                        $this->csrf,"
          },
          {
            "type": "add",
            "line": "                        $this->html_purifier,"
          },
          {
            "type": "add",
            "line": "                        $this->uri_sanitizer,"
          },
          {
            "type": "context",
            "line": "                     ),"
          },
          {
            "type": "context",
            "line": "                 ]"
          },
          {
            "type": "context",
            "line": "             );"
          }
        ]
      },
      {
        "file": "plugins/hudson_git/include/HudsonGit/JenkinsWebhookPresenter.php",
        "changes": [
          {
            "type": "context",
            "line": "index 3c9a28bbe00..c023acd1cd2 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/hudson_git/include/HudsonGit/JenkinsWebhookPresenter.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/hudson_git/include/HudsonGit/JenkinsWebhookPresenter.php"
          },
          {
            "type": "context",
            "line": " use GitRepository;"
          },
          {
            "type": "context",
            "line": " use CSRFSynchronizerToken;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\HudsonGit\\Log\\Log;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Sanitizer\\URISanitizer;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "class JenkinsWebhookPresenter extends GenericWebhookPresenter"
          },
          {
            "type": "add",
            "line": "final class JenkinsWebhookPresenter extends GenericWebhookPresenter"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    public function __construct(GitRepository $repository, $url, array $hooklogs, CSRFSynchronizerToken $csrf)"
          },
          {
            "type": "delete",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "    public function __construct("
          },
          {
            "type": "add",
            "line": "        GitRepository $repository,"
          },
          {
            "type": "add",
            "line": "        string $url,"
          },
          {
            "type": "add",
            "line": "        array $hooklogs,"
          },
          {
            "type": "add",
            "line": "        CSRFSynchronizerToken $csrf,"
          },
          {
            "type": "add",
            "line": "        private readonly Codendi_HTMLPurifier $html_purifier,"
          },
          {
            "type": "add",
            "line": "        private readonly URISanitizer $uri_sanitizer,"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "context",
            "line": "         $use_default_edit_modal = false;"
          },
          {
            "type": "context",
            "line": "         parent::__construct($repository, 'jenkins', $url, [], $csrf, $use_default_edit_modal);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     private function generateHooklogs(array $hooklogs): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $hp = Codendi_HTMLPurifier::instance();"
          },
          {
            "type": "context",
            "line": "         foreach ($hooklogs as $log) {"
          },
          {
            "type": "context",
            "line": "             $purified_information = '';"
          },
          {
            "type": "context",
            "line": "             $job_list             = $log->getJobUrlList();"
          },
          {
            "type": "context",
            "line": "                 $purified_information .= '<div class=\"hook-log-triggered-jobs\">';"
          },
          {
            "type": "context",
            "line": "                 $purified_information .= '<h4>' . dgettext(\"tuleap-hudson_git\", \"Git plugin triggered jobs:\") . '</h4>';"
          },
          {
            "type": "context",
            "line": "                 foreach ($job_list as $triggered_job_url) {"
          },
          {
            "type": "delete",
            "line": "                    $purfied_job_url       = $hp->purify($triggered_job_url);"
          },
          {
            "type": "delete",
            "line": "                    $purified_information .= '<a href=\"' . $purfied_job_url . '\">' . $purfied_job_url . '</a><br>';"
          },
          {
            "type": "add",
            "line": "                    $sanitized_job_url = $this->uri_sanitizer->sanitizeForHTMLAttribute($triggered_job_url);"
          },
          {
            "type": "add",
            "line": "                    if ($sanitized_job_url !== '' && $triggered_job_url !== '') {"
          },
          {
            "type": "add",
            "line": "                        $purified_information .= '<a href=\"' . $this->html_purifier->purify($sanitized_job_url) . '\">' . $this->html_purifier->purify($triggered_job_url) . '</a><br>';"
          },
          {
            "type": "add",
            "line": "                    } else {"
          },
          {
            "type": "add",
            "line": "                        $purified_information .= $this->html_purifier->purify($triggered_job_url);"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 $purified_information .= '</div>';"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             if ($log->getStatusCode() !== null) {"
          },
          {
            "type": "context",
            "line": "                 $purified_information .= '<div class=\"hook-log-branch-source-status\">';"
          },
          {
            "type": "context",
            "line": "                 $purified_information .= '<h4>' . dgettext(\"tuleap-hudson_git\", \"Branch source plugin:\") . '</h4>';"
          },
          {
            "type": "delete",
            "line": "                $purified_information .= $log->getStatusCode();"
          },
          {
            "type": "add",
            "line": "                $purified_information .= $this->html_purifier->purify((string) $log->getStatusCode());"
          },
          {
            "type": "context",
            "line": "                 $purified_information .= '</div>';"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "plugins/hudson_git/include/hudson_gitPlugin.php",
        "changes": [
          {
            "type": "context",
            "line": "index 4d6c8cbfc26..1defa7533fc 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/hudson_git/include/hudson_gitPlugin.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/hudson_git/include/hudson_gitPlugin.php"
          },
          {
            "type": "context",
            "line": "                     )"
          },
          {
            "type": "context",
            "line": "                 ),"
          },
          {
            "type": "context",
            "line": "                 $this->getCSRF(),"
          },
          {
            "type": "delete",
            "line": "                self::getJenkinsServerFactory()"
          },
          {
            "type": "add",
            "line": "                self::getJenkinsServerFactory(),"
          },
          {
            "type": "add",
            "line": "                Codendi_HTMLPurifier::instance(),"
          },
          {
            "type": "add",
            "line": "                new \\Tuleap\\Sanitizer\\URISanitizer(new Valid_HTTPURI()),"
          },
          {
            "type": "context",
            "line": "             );"
          },
          {
            "type": "context",
            "line": "             $xzibit->pimp($params);"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      }
    ]
  },
  {
    "commit": "68d73740d7d40aee77cfda3fb8199d58bf04f48b",
    "files": [
      {
        "file": "packages/westatus/getfiles.php",
        "changes": [
          {
            "type": "context",
            "line": "index 285d2bd69..30f9c6dae 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/web/status/getfiles.php"
          },
          {
            "type": "context",
            "line": "+++ b/packages/web/status/getfiles.php"
          },
          {
            "type": "context",
            "line": "  * @link     https://fogproject.org"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " require '../commons/base.inc.php';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Prevent file enumeration by an unauthenticated user"
          },
          {
            "type": "add",
            "line": "$unauthorized = !$currentUser->isValid() || empty($_SERVER['HTTP_X_REQUESTED_WITH'])"
          },
          {
            "type": "add",
            "line": "    || strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) !== 'xmlhttprequest';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "if ($unauthorized) {"
          },
          {
            "type": "add",
            "line": "    echo _('Unauthorized');"
          },
          {
            "type": "add",
            "line": "    exit;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " if (!is_string($_GET['path'])) {"
          },
          {
            "type": "context",
            "line": "     echo json_encode("
          },
          {
            "type": "context",
            "line": "         _('Invalid')"
          }
        ]
      }
    ]
  },
  {
    "commit": "6aab63765f99050b115f0aec3d6350c85e8da946",
    "files": [
      {
        "file": "pkg/chartutil/requirements.go",
        "changes": [
          {
            "type": "context",
            "line": "index d72aa9da5..0bd16d2eb 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chartutil/requirements.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chartutil/requirements.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import ("
          },
          {
            "type": "context",
            "line": " \t\"errors\""
          },
          {
            "type": "add",
            "line": "\t\"fmt\""
          },
          {
            "type": "context",
            "line": " \t\"log\""
          },
          {
            "type": "add",
            "line": "\t\"regexp\""
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "context",
            "line": " \t\"time\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Validate alias names against this regexp"
          },
          {
            "type": "add",
            "line": "var aliasRegexp = regexp.MustCompile(\"^[a-zA-Z0-9-_]+$\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " func getAliasDependency(charts []*chart.Chart, aliasChart *Dependency) *chart.Chart {"
          },
          {
            "type": "context",
            "line": " \tvar chartFound chart.Chart"
          },
          {
            "type": "context",
            "line": " \tfor _, existingChart := range charts {"
          },
          {
            "type": "context",
            "line": " \t\tchartFound = *existingChart"
          },
          {
            "type": "context",
            "line": " \t\tnewMetadata := *existingChart.Metadata"
          },
          {
            "type": "context",
            "line": " \t\tif aliasChart.Alias != \"\" {"
          },
          {
            "type": "add",
            "line": "\t\t\t// Make sure Alias is well-formed"
          },
          {
            "type": "add",
            "line": "\t\t\tif !aliasRegexp.MatchString(aliasChart.Alias) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tfmt.Printf(\"Invalid alias in dependency %q. Skipping.\", aliasChart.Name)"
          },
          {
            "type": "add",
            "line": "\t\t\t\tcontinue"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\tnewMetadata.Name = aliasChart.Alias"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tchartFound.Metadata = &newMetadata"
          },
          {
            "type": "context",
            "line": " \t\t\tchartDependencies = append(chartDependencies, chartDependency)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tif req.Alias != \"\" {"
          },
          {
            "type": "add",
            "line": "\t\t\tif !aliasRegexp.MatchString(req.Alias) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn fmt.Errorf(\"illegal alias name in %q\", req.Name)"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\treq.Name = req.Alias"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      },
      {
        "file": "pkg/chartutil/requirements_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 640987fdd..723f9bab3 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chartutil/requirements_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chartutil/requirements_test.go"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// Failure case"
          },
          {
            "type": "add",
            "line": "\tresetName := req.Dependencies[0].Name"
          },
          {
            "type": "context",
            "line": " \treq.Dependencies[0].Name = \"something-else\""
          },
          {
            "type": "context",
            "line": " \tif aliasChart := getAliasDependency(c.Dependencies, req.Dependencies[0]); aliasChart != nil {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatalf(\"expected no chart but got %s\", aliasChart.Metadata.Name)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t// Add a bad alias name"
          },
          {
            "type": "add",
            "line": "\treq.Dependencies[0].Name = resetName"
          },
          {
            "type": "add",
            "line": "\treq.Dependencies[0].Alias = \"$foobar\""
          },
          {
            "type": "add",
            "line": "\tif aliasChart := getAliasDependency(c.Dependencies, req.Dependencies[0]); aliasChart != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"expected no chart but got %s\", aliasChart.Metadata.Name)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treq.Dependencies[0].Version = \"something else which is not in the compatible range\""
          },
          {
            "type": "context",
            "line": " \tif version.IsCompatibleRange(req.Dependencies[0].Version, aliasChart.Metadata.Version) {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatalf(\"Dependency chart version which is not in the compatible range should cause a failure other than a success \")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestAliasRegexp(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tfor name, shouldPass := range map[string]bool{"
          },
          {
            "type": "add",
            "line": "\t\t\"abcdefghijklmnopqrstuvwxyzABCDEFG0987654321_-\": true,"
          },
          {
            "type": "add",
            "line": "\t\t\"$foo\":     false,"
          },
          {
            "type": "add",
            "line": "\t\t\"bar$\":     false,"
          },
          {
            "type": "add",
            "line": "\t\t\"foo\\nbar\": false,"
          },
          {
            "type": "add",
            "line": "\t} {"
          },
          {
            "type": "add",
            "line": "\t\tif aliasRegexp.MatchString(name) != shouldPass {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"name %q failed to pass its test\", name)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "pkg/plugin/plugin.go",
        "changes": [
          {
            "type": "context",
            "line": "index 07fcc700a..c4873918a 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/plugin/plugin.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/plugin.go"
          },
          {
            "type": "context",
            "line": " package plugin // import \"k8s.io/helm/pkg/plugin\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import ("
          },
          {
            "type": "add",
            "line": "\t\"fmt\""
          },
          {
            "type": "context",
            "line": " \t\"io/ioutil\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t\"path/filepath\""
          },
          {
            "type": "context",
            "line": " \t\treturn plugins, nil"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tloaded := map[string]bool{}"
          },
          {
            "type": "context",
            "line": " \tfor _, yaml := range matches {"
          },
          {
            "type": "context",
            "line": " \t\tdir := filepath.Dir(yaml)"
          },
          {
            "type": "context",
            "line": " \t\tp, err := LoadDir(dir)"
          },
          {
            "type": "add",
            "line": "\t\tpname := p.Metadata.Name"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn plugins, err"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif _, ok := loaded[pname]; ok {"
          },
          {
            "type": "add",
            "line": "\t\t\tfmt.Fprintf(os.Stderr, \"A plugin named %q already exists. Skipping.\", pname)"
          },
          {
            "type": "add",
            "line": "\t\t\tcontinue"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tplugins = append(plugins, p)"
          },
          {
            "type": "add",
            "line": "\t\tloaded[pname] = true"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn plugins, nil"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "pkg/plugin/plugin_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 338d949f8..2d52e2954 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/plugin/plugin_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/plugin_test.go"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatalf(\"Could not load %q: %s\", basedir, err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t// This would fail if the duplicate plugin were loaded."
          },
          {
            "type": "context",
            "line": " \tif l := len(plugs); l != 3 {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatalf(\"expected 3 plugins, found %d\", l)"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      },
      {
        "file": "pkg/plugin/testdata/plugdir/hello2/hello.sh",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100755"
          },
          {
            "type": "context",
            "line": "index 000000000..db7c0f54d"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/testdata/plugdir/hello2/hello.sh"
          },
          {
            "type": "add",
            "line": "#!/bin/bash"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "echo \"Hello from a Helm plugin\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "echo \"PARAMS\""
          },
          {
            "type": "add",
            "line": "echo $*"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "echo \"ENVIRONMENT\""
          },
          {
            "type": "add",
            "line": "echo $TILLER_HOST"
          },
          {
            "type": "add",
            "line": "echo $HELM_HOME"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "$HELM_BIN --host $TILLER_HOST ls --all"
          },
          {
            "type": "add",
            "line": ""
          }
        ]
      },
      {
        "file": "pkg/plugin/testdata/plugdir/hello2/plugin.yaml",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..cdb27b291"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/testdata/plugdir/hello2/plugin.yaml"
          },
          {
            "type": "add",
            "line": "name: \"hello\""
          },
          {
            "type": "add",
            "line": "version: \"0.1.0\""
          },
          {
            "type": "add",
            "line": "usage: \"usage\""
          },
          {
            "type": "add",
            "line": "description: |-"
          },
          {
            "type": "add",
            "line": "  description"
          },
          {
            "type": "add",
            "line": "command: \"$HELM_PLUGIN_SELF/hello.sh\""
          },
          {
            "type": "add",
            "line": "useTunnel: true"
          },
          {
            "type": "add",
            "line": "ignoreFlags: true"
          },
          {
            "type": "add",
            "line": "install: \"echo installing...\""
          },
          {
            "type": "add",
            "line": "hooks:"
          },
          {
            "type": "add",
            "line": "  install: \"echo installing...\""
          }
        ]
      },
      {
        "file": "pkg/repo/index.go",
        "changes": [
          {
            "type": "context",
            "line": "index 12f3308de..1fcb7d9cb 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/index.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/index.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"github.com/Masterminds/semver\""
          },
          {
            "type": "context",
            "line": " \t\"github.com/ghodss/yaml\""
          },
          {
            "type": "add",
            "line": "\tyaml2 \"gopkg.in/yaml.v2\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"k8s.io/helm/pkg/chartutil\""
          },
          {
            "type": "context",
            "line": " \t\"k8s.io/helm/pkg/proto/hapi/chart\""
          },
          {
            "type": "context",
            "line": " \tPublicKeys []string                 `json:\"publicKeys,omitempty\"`"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// IndexValidation is used to validate the integrity of an index file"
          },
          {
            "type": "add",
            "line": "type IndexValidation struct {"
          },
          {
            "type": "add",
            "line": "\tAPIVersion string                 `yaml:\"apiVersion\"`"
          },
          {
            "type": "add",
            "line": "\tGenerated  time.Time              `yaml:\"generated\"`"
          },
          {
            "type": "add",
            "line": "\tEntries    map[string]interface{} `yaml:\"entries\"`"
          },
          {
            "type": "add",
            "line": "\tPublicKeys []string               `yaml:\"publicKeys,omitempty\"`"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // NewIndexFile initializes an index."
          },
          {
            "type": "context",
            "line": " func NewIndexFile() *IndexFile {"
          },
          {
            "type": "context",
            "line": " \treturn &IndexFile{"
          },
          {
            "type": "context",
            "line": " // This will fail if API Version is not set (ErrNoAPIVersion) or if the unmarshal fails."
          },
          {
            "type": "context",
            "line": " func loadIndex(data []byte) (*IndexFile, error) {"
          },
          {
            "type": "context",
            "line": " \ti := &IndexFile{}"
          },
          {
            "type": "add",
            "line": "\tif err := validateIndex(data); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\treturn i, err"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif err := yaml.Unmarshal(data, i); err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn i, err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ti.SortEntries()"
          },
          {
            "type": "context",
            "line": " \tif i.APIVersion == \"\" {"
          },
          {
            "type": "context",
            "line": " \t\t// When we leave Beta, we should remove legacy support and just"
          },
          {
            "type": "context",
            "line": " \treturn i, nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// validateIndex validates that the index is well-formed."
          },
          {
            "type": "add",
            "line": "func validateIndex(data []byte) error {"
          },
          {
            "type": "add",
            "line": "\t// This is done ONLY for validation. We need to use ghodss/yaml for the actual parsing."
          },
          {
            "type": "add",
            "line": "\tvalidation := &IndexValidation{}"
          },
          {
            "type": "add",
            "line": "\tif err := yaml2.UnmarshalStrict(data, validation); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\treturn err"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // unversionedEntry represents a deprecated pre-Alpha.5 format."
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "context",
            "line": " // This will be removed prior to v2.0.0"
          }
        ]
      },
      {
        "file": "pkg/repo/index_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index de53efacf..425de70ef 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/index_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/index_test.go"
          },
          {
            "type": "context",
            "line": " \t\tt.Errorf(\"Expected http://example.com/charts/deis-0.1.0.tgz, got %s\", i.Entries[\"deis\"][0].URLs[0])"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "const mockDuplicateIndex = `"
          },
          {
            "type": "add",
            "line": "entries:"
          },
          {
            "type": "add",
            "line": "  foo: {}"
          },
          {
            "type": "add",
            "line": "  bar: {}"
          },
          {
            "type": "add",
            "line": "  baz: {}"
          },
          {
            "type": "add",
            "line": "  bar: {}"
          },
          {
            "type": "add",
            "line": "`"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestValidateIndex(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\texpect := `key \"bar\" already set in map`"
          },
          {
            "type": "add",
            "line": "\terr := validateIndex([]byte(mockDuplicateIndex))"
          },
          {
            "type": "add",
            "line": "\tif strings.Contains(expect, err.Error()) {"
          },
          {
            "type": "add",
            "line": "\t\tt.Errorf(\"Unexpected error: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      }
    ]
  },
  {
    "commit": "6af28521589599b1dbafd6313256229ee9a4fa74",
    "files": [
      {
        "file": "flask_appbuilder/security/views.py",
        "changes": [
          {
            "type": "context",
            "line": "index 939c623f..cb0c93e3 100644"
          },
          {
            "type": "context",
            "line": "--- a/flask_appbuilder/security/views.py"
          },
          {
            "type": "context",
            "line": "+++ b/flask_appbuilder/security/views.py"
          },
          {
            "type": "context",
            "line": " import datetime"
          },
          {
            "type": "context",
            "line": " import logging"
          },
          {
            "type": "context",
            "line": " import re"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from flask import abort, current_app, flash, g, redirect, request, session, url_for"
          },
          {
            "type": "add",
            "line": "from typing import Optional"
          },
          {
            "type": "add",
            "line": "from urllib.parse import urlparse"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from flask import ("
          },
          {
            "type": "add",
            "line": "    abort,"
          },
          {
            "type": "add",
            "line": "    current_app,"
          },
          {
            "type": "add",
            "line": "    flash,"
          },
          {
            "type": "add",
            "line": "    g,"
          },
          {
            "type": "add",
            "line": "    redirect,"
          },
          {
            "type": "add",
            "line": "    request,"
          },
          {
            "type": "add",
            "line": "    Response,"
          },
          {
            "type": "add",
            "line": "    session,"
          },
          {
            "type": "add",
            "line": "    url_for,"
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "context",
            "line": " from flask_babel import lazy_gettext"
          },
          {
            "type": "context",
            "line": " from flask_login import login_user, logout_user"
          },
          {
            "type": "context",
            "line": " import jwt"
          },
          {
            "type": "context",
            "line": "             self.login_template, title=self.title, form=form, appbuilder=self.appbuilder"
          },
          {
            "type": "context",
            "line": "         )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "        For Future Use, API Auth, must check howto keep REST stateless"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    @expose_api(name='auth',url='/api/auth')"
          },
          {
            "type": "delete",
            "line": "    def auth(self):"
          },
          {
            "type": "delete",
            "line": "        if g.user is not None and g.user.is_authenticated:"
          },
          {
            "type": "delete",
            "line": "            http_return_code = 401"
          },
          {
            "type": "delete",
            "line": "            response = make_response("
          },
          {
            "type": "delete",
            "line": "                jsonify("
          },
          {
            "type": "delete",
            "line": "                    {"
          },
          {
            "type": "delete",
            "line": "                        'message': 'Login Failed already authenticated',"
          },
          {
            "type": "delete",
            "line": "                        'severity': 'critical'"
          },
          {
            "type": "delete",
            "line": "                    }"
          },
          {
            "type": "delete",
            "line": "                ),"
          },
          {
            "type": "delete",
            "line": "                http_return_code"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "        username = str(request.args.get('username'))"
          },
          {
            "type": "delete",
            "line": "        password = str(request.args.get('password'))"
          },
          {
            "type": "delete",
            "line": "        user = self.appbuilder.sm.auth_user_ldap(username, password)"
          },
          {
            "type": "delete",
            "line": "        if not user:"
          },
          {
            "type": "delete",
            "line": "            http_return_code = 401"
          },
          {
            "type": "delete",
            "line": "            response = make_response("
          },
          {
            "type": "delete",
            "line": "                jsonify("
          },
          {
            "type": "delete",
            "line": "                    {"
          },
          {
            "type": "delete",
            "line": "                        'message': 'Login Failed',"
          },
          {
            "type": "delete",
            "line": "                        'severity': 'critical'"
          },
          {
            "type": "delete",
            "line": "                    }"
          },
          {
            "type": "delete",
            "line": "                ),"
          },
          {
            "type": "delete",
            "line": "                http_return_code"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "        else:"
          },
          {
            "type": "delete",
            "line": "            login_user(user, remember=False)"
          },
          {
            "type": "delete",
            "line": "            http_return_code = 201"
          },
          {
            "type": "delete",
            "line": "            response = make_response("
          },
          {
            "type": "delete",
            "line": "                jsonify("
          },
          {
            "type": "delete",
            "line": "                    {"
          },
          {
            "type": "delete",
            "line": "                        'message': 'Login Success',"
          },
          {
            "type": "delete",
            "line": "                         'severity': 'info'"
          },
          {
            "type": "delete",
            "line": "                    }"
          },
          {
            "type": "delete",
            "line": "                ),"
          },
          {
            "type": "delete",
            "line": "                http_return_code"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "        return response"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class AuthOIDView(AuthView):"
          },
          {
            "type": "context",
            "line": "     login_template = \"appbuilder/general/security/login_oid.html\""
          },
          {
            "type": "context",
            "line": "     @expose(\"/login/\")"
          },
          {
            "type": "context",
            "line": "     @expose(\"/login/<provider>\")"
          },
          {
            "type": "context",
            "line": "     @expose(\"/login/<provider>/<register>\")"
          },
          {
            "type": "delete",
            "line": "    def login(self, provider=None, register=None):"
          },
          {
            "type": "add",
            "line": "    def login("
          },
          {
            "type": "add",
            "line": "        self, provider: Optional[str] = None, register: Optional[str] = None"
          },
          {
            "type": "add",
            "line": "    ) -> Response:"
          },
          {
            "type": "context",
            "line": "         log.debug(\"Provider: {0}\".format(provider))"
          },
          {
            "type": "context",
            "line": "         if g.user is not None and g.user.is_authenticated:"
          },
          {
            "type": "context",
            "line": "             log.debug(\"Already authenticated {0}\".format(g.user))"
          },
          {
            "type": "context",
            "line": "             return redirect(self.appbuilder.get_url_for_index)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @expose(\"/oauth-authorized/<provider>\")"
          },
          {
            "type": "delete",
            "line": "    def oauth_authorized(self, provider):"
          },
          {
            "type": "add",
            "line": "    def oauth_authorized(self, provider: str) -> Response:"
          },
          {
            "type": "context",
            "line": "         log.debug(\"Authorized init\")"
          },
          {
            "type": "add",
            "line": "        if provider not in self.appbuilder.sm.oauth_remotes:"
          },
          {
            "type": "add",
            "line": "            flash(u\"Provider not supported.\", \"warning\")"
          },
          {
            "type": "add",
            "line": "            log.warning(\"OAuth authorized got an unknown provider %s\", provider)"
          },
          {
            "type": "add",
            "line": "            return redirect(self.appbuilder.get_url_for_login)"
          },
          {
            "type": "context",
            "line": "         resp = self.appbuilder.sm.oauth_remotes[provider].authorize_access_token()"
          },
          {
            "type": "context",
            "line": "         if resp is None:"
          },
          {
            "type": "context",
            "line": "             flash(u\"You denied the request to sign in.\", \"warning\")"
          },
          {
            "type": "context",
            "line": "             except jwt.InvalidTokenError:"
          },
          {
            "type": "context",
            "line": "                 raise Exception(\"State signature is not valid!\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            try:"
          },
          {
            "type": "delete",
            "line": "                next_url = state[\"next\"][0] or self.appbuilder.get_url_for_index"
          },
          {
            "type": "delete",
            "line": "            except (KeyError, IndexError):"
          },
          {
            "type": "delete",
            "line": "                next_url = self.appbuilder.get_url_for_index"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "            next_url = self.appbuilder.get_url_for_index"
          },
          {
            "type": "add",
            "line": "            # Check if there is a next url on state"
          },
          {
            "type": "add",
            "line": "            if \"next\" in state and len(state[\"next\"]) > 0:"
          },
          {
            "type": "add",
            "line": "                parsed_uri = urlparse(state[\"next\"][0])"
          },
          {
            "type": "add",
            "line": "                if parsed_uri.netloc != request.host:"
          },
          {
            "type": "add",
            "line": "                    log.warning(\"Got an invalid next URL: %s\", parsed_uri.netloc)"
          },
          {
            "type": "add",
            "line": "                else:"
          },
          {
            "type": "add",
            "line": "                    next_url = state[\"next\"][0]"
          },
          {
            "type": "context",
            "line": "             return redirect(next_url)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "flask_appbuilder/tests/config_oauth.py",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000..e162563d"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/flask_appbuilder/tests/config_oauth.py"
          },
          {
            "type": "add",
            "line": "import os"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from flask_appbuilder.security.manager import AUTH_OAUTH"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "basedir = os.path.abspath(os.path.dirname(__file__))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "SQLALCHEMY_DATABASE_URI = os.environ.get("
          },
          {
            "type": "add",
            "line": "    \"SQLALCHEMY_DATABASE_URI\""
          },
          {
            "type": "add",
            "line": ") or \"sqlite:///\" + os.path.join(basedir, \"app.db\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "SECRET_KEY = \"thisismyscretkey\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "AUTH_TYPE = AUTH_OAUTH"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "OAUTH_PROVIDERS = ["
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        \"name\": \"google\","
          },
          {
            "type": "add",
            "line": "        \"icon\": \"fa-google\","
          },
          {
            "type": "add",
            "line": "        \"token_key\": \"access_token\","
          },
          {
            "type": "add",
            "line": "        \"remote_app\": {"
          },
          {
            "type": "add",
            "line": "            \"client_id\": \"CLIENT_ID\","
          },
          {
            "type": "add",
            "line": "            \"client_secret\": \"CLIENT_SECRET\","
          },
          {
            "type": "add",
            "line": "            \"api_base_url\": \"https://www.googleapis.com/oauth2/v2/\","
          },
          {
            "type": "add",
            "line": "            \"client_kwargs\": {\"scope\": \"email profile\"},"
          },
          {
            "type": "add",
            "line": "            \"request_token_url\": None,"
          },
          {
            "type": "add",
            "line": "            \"access_token_url\": \"https://accounts.google.com/o/oauth2/token\","
          },
          {
            "type": "add",
            "line": "            \"authorize_url\": \"https://accounts.google.com/o/oauth2/auth\","
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# Will allow user self registration"
          },
          {
            "type": "add",
            "line": "AUTH_USER_REGISTRATION = True"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# The default user self registration role for all users"
          },
          {
            "type": "add",
            "line": "AUTH_USER_REGISTRATION_ROLE = \"Admin\""
          }
        ]
      },
      {
        "file": "flask_appbuilder/tests/test_mvc_oauth.py",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000..34014784"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/flask_appbuilder/tests/test_mvc_oauth.py"
          },
          {
            "type": "add",
            "line": "from flask_appbuilder import SQLA"
          },
          {
            "type": "add",
            "line": "from flask_appbuilder.tests.base import FABTestCase"
          },
          {
            "type": "add",
            "line": "import jwt"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class UserInfoReponseMock:"
          },
          {
            "type": "add",
            "line": "    def json(self):"
          },
          {
            "type": "add",
            "line": "        return {"
          },
          {
            "type": "add",
            "line": "            \"id\": \"1\","
          },
          {
            "type": "add",
            "line": "            \"given_name\": \"first-name\","
          },
          {
            "type": "add",
            "line": "            \"family_name\": \"last-name\","
          },
          {
            "type": "add",
            "line": "            \"email\": \"user1@fab.org\","
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class OAuthRemoteMock:"
          },
          {
            "type": "add",
            "line": "    def authorize_access_token(self):"
          },
          {
            "type": "add",
            "line": "        return {\"access_token\": \"some-key\"}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def get(self, item):"
          },
          {
            "type": "add",
            "line": "        if item == \"userinfo\":"
          },
          {
            "type": "add",
            "line": "            return UserInfoReponseMock()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class APICSRFTestCase(FABTestCase):"
          },
          {
            "type": "add",
            "line": "    def setUp(self):"
          },
          {
            "type": "add",
            "line": "        from flask import Flask"
          },
          {
            "type": "add",
            "line": "        from flask_wtf import CSRFProtect"
          },
          {
            "type": "add",
            "line": "        from flask_appbuilder import AppBuilder"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.app = Flask(__name__)"
          },
          {
            "type": "add",
            "line": "        self.app.config.from_object(\"flask_appbuilder.tests.config_oauth\")"
          },
          {
            "type": "add",
            "line": "        self.app.config[\"WTF_CSRF_ENABLED\"] = True"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.csrf = CSRFProtect(self.app)"
          },
          {
            "type": "add",
            "line": "        self.db = SQLA(self.app)"
          },
          {
            "type": "add",
            "line": "        self.appbuilder = AppBuilder(self.app, self.db.session)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_oauth_login(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        OAuth: Test login"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        client = self.app.test_client()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.appbuilder.sm.oauth_remotes = {\"google\": OAuthRemoteMock()}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        raw_state = {}"
          },
          {
            "type": "add",
            "line": "        state = jwt.encode(raw_state, self.app.config[\"SECRET_KEY\"], algorithm=\"HS256\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = client.get(f\"/oauth-authorized/google?state={state.decode('utf-8')}\")"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.location, \"http://localhost/\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_oauth_login_unknown_provider(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        OAuth: Test login with unknown provider"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        client = self.app.test_client()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.appbuilder.sm.oauth_remotes = {\"google\": OAuthRemoteMock()}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        raw_state = {}"
          },
          {
            "type": "add",
            "line": "        state = jwt.encode(raw_state, self.app.config[\"SECRET_KEY\"], algorithm=\"HS256\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = client.get("
          },
          {
            "type": "add",
            "line": "            f\"/oauth-authorized/unknown_provider?state={state.decode('utf-8')}\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.location, \"http://localhost/login/\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_oauth_login_next(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        OAuth: Test login next"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        client = self.app.test_client()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.appbuilder.sm.oauth_remotes = {\"google\": OAuthRemoteMock()}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        raw_state = {\"next\": [\"http://localhost/users/list/\"]}"
          },
          {
            "type": "add",
            "line": "        state = jwt.encode(raw_state, self.app.config[\"SECRET_KEY\"], algorithm=\"HS256\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = client.get(f\"/oauth-authorized/google?state={state.decode('utf-8')}\")"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.location, \"http://localhost/users/list/\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_oauth_login_next_check(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        OAuth: Test login next check"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        client = self.app.test_client()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.appbuilder.sm.oauth_remotes = {\"google\": OAuthRemoteMock()}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        raw_state = {\"next\": [\"http://www.google.com\"]}"
          },
          {
            "type": "add",
            "line": "        state = jwt.encode(raw_state, self.app.config[\"SECRET_KEY\"], algorithm=\"HS256\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = client.get(f\"/oauth-authorized/google?state={state.decode('utf-8')}\")"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(response.location, \"http://localhost/\")"
          }
        ]
      },
      {
        "file": "requirements-extra.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 7e3ac87e..8bfa162c 100644"
          },
          {
            "type": "context",
            "line": "--- a/requirements-extra.txt"
          },
          {
            "type": "context",
            "line": "+++ b/requirements-extra.txt"
          },
          {
            "type": "context",
            "line": " psycopg2-binary==2.8.6"
          },
          {
            "type": "context",
            "line": " pyodbc==4.0.30"
          },
          {
            "type": "context",
            "line": " requests==2.25.0"
          },
          {
            "type": "delete",
            "line": "Authlib==0.15.2"
          },
          {
            "type": "add",
            "line": "Authlib==0.15.4"
          },
          {
            "type": "context",
            "line": " python-ldap==3.3.1"
          }
        ]
      },
      {
        "file": "setup.py",
        "changes": [
          {
            "type": "context",
            "line": "index a6509650..9e9195ad 100644"
          },
          {
            "type": "context",
            "line": "--- a/setup.py"
          },
          {
            "type": "context",
            "line": "+++ b/setup.py"
          },
          {
            "type": "context",
            "line": "         \"PyJWT>=1.7.1, <2.0.0\","
          },
          {
            "type": "context",
            "line": "         \"sqlalchemy-utils>=0.32.21, <1\","
          },
          {
            "type": "context",
            "line": "     ],"
          },
          {
            "type": "delete",
            "line": "    extras_require={\"jmespath\": [\"jmespath>=0.9.5\"]},"
          },
          {
            "type": "add",
            "line": "    extras_require={"
          },
          {
            "type": "add",
            "line": "        \"jmespath\": [\"jmespath>=0.9.5\"],"
          },
          {
            "type": "add",
            "line": "        \"oauth\": [\"Authlib>=0.14, <1.0.0\"],"
          },
          {
            "type": "add",
            "line": "    },"
          },
          {
            "type": "context",
            "line": "     tests_require=[\"nose>=1.0\", \"mockldap>=0.3.0\"],"
          },
          {
            "type": "context",
            "line": "     classifiers=["
          },
          {
            "type": "context",
            "line": "         \"Development Status :: 5 - Production/Stable\","
          }
        ]
      }
    ]
  },
  {
    "commit": "6ce9ba60b73013857e2e7c73d3f86ed70bc1ac9a",
    "files": [
      {
        "file": "cmd/helm/repo_update.go",
        "changes": [
          {
            "type": "context",
            "line": "index e845751c1..23dca194a 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/repo_update.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/repo_update.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func (o *repoUpdateOptions) run(out io.Writer) error {"
          },
          {
            "type": "context",
            "line": " \tf, err := repo.LoadFile(o.repoFile)"
          },
          {
            "type": "delete",
            "line": "\tif isNotExist(err) || len(f.Repositories) == 0 {"
          },
          {
            "type": "add",
            "line": "\tswitch {"
          },
          {
            "type": "add",
            "line": "\tcase isNotExist(err):"
          },
          {
            "type": "add",
            "line": "\t\treturn errNoRepositories"
          },
          {
            "type": "add",
            "line": "\tcase err != nil:"
          },
          {
            "type": "add",
            "line": "\t\treturn errors.Wrapf(err, \"failed loading file: %s\", o.repoFile)"
          },
          {
            "type": "add",
            "line": "\tcase len(f.Repositories) == 0:"
          },
          {
            "type": "context",
            "line": " \t\treturn errNoRepositories"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tvar repos []*repo.ChartRepository"
          },
          {
            "type": "context",
            "line": " \tfor _, cfg := range f.Repositories {"
          },
          {
            "type": "context",
            "line": " \t\tr, err := repo.NewChartRepository(cfg, getter.All(settings))"
          }
        ]
      },
      {
        "file": "cmd/helm/repo_update_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index f4936b367..83ef24349 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/repo_update_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/repo_update_test.go"
          },
          {
            "type": "context",
            "line": " \t\"bytes\""
          },
          {
            "type": "context",
            "line": " \t\"fmt\""
          },
          {
            "type": "context",
            "line": " \t\"io\""
          },
          {
            "type": "add",
            "line": "\t\"io/ioutil\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t\"path/filepath\""
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestUpdateCustomCacheCmd(t *testing.T) {"
          },
          {
            "type": "delete",
            "line": "\tvar out bytes.Buffer"
          },
          {
            "type": "context",
            "line": " \trootDir := ensure.TempDir(t)"
          },
          {
            "type": "context",
            "line": " \tcachePath := filepath.Join(rootDir, \"updcustomcache\")"
          },
          {
            "type": "delete",
            "line": "\t_ = os.Mkdir(cachePath, os.ModePerm)"
          },
          {
            "type": "add",
            "line": "\tos.Mkdir(cachePath, os.ModePerm)"
          },
          {
            "type": "context",
            "line": " \tdefer os.RemoveAll(cachePath)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tts, err := repotest.NewTempServerWithCleanup(t, \"testdata/testserver/*.*\")"
          },
          {
            "type": "add",
            "line": "\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatal(err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tdefer ts.Stop()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \to := &repoUpdateOptions{"
          },
          {
            "type": "context",
            "line": " \t\tupdate:    updateCharts,"
          },
          {
            "type": "delete",
            "line": "\t\trepoFile:  \"testdata/repositories.yaml\","
          },
          {
            "type": "add",
            "line": "\t\trepoFile:  filepath.Join(ts.Root(), \"repositories.yaml\"),"
          },
          {
            "type": "context",
            "line": " \t\trepoCache: cachePath,"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tif err := o.run(&out); err != nil {"
          },
          {
            "type": "add",
            "line": "\tb := ioutil.Discard"
          },
          {
            "type": "add",
            "line": "\tif err := o.run(b); err != nil {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatal(err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tif _, err := os.Stat(filepath.Join(cachePath, \"charts-index.yaml\")); err != nil {"
          },
          {
            "type": "add",
            "line": "\tif _, err := os.Stat(filepath.Join(cachePath, \"test-index.yaml\")); err != nil {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatalf(\"error finding created index file in custom cache: %v\", err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "cmd/helm/search_repo.go",
        "changes": [
          {
            "type": "context",
            "line": "index ba26ee5e9..ba692a2e7 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/search_repo.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/search_repo.go"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func (o *searchRepoOptions) applyConstraint(res []*search.Result) ([]*search.Result, error) {"
          },
          {
            "type": "delete",
            "line": "\tif len(o.version) == 0 {"
          },
          {
            "type": "add",
            "line": "\tif o.version == \"\" {"
          },
          {
            "type": "context",
            "line": " \t\treturn res, nil"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tdata := res[:0]"
          },
          {
            "type": "context",
            "line": " \tfoundNames := map[string]bool{}"
          },
          {
            "type": "delete",
            "line": "\tappendSearchResults := func(res *search.Result) {"
          },
          {
            "type": "delete",
            "line": "\t\tdata = append(data, res)"
          },
          {
            "type": "delete",
            "line": "\t\tif !o.versions {"
          },
          {
            "type": "delete",
            "line": "\t\t\tfoundNames[res.Name] = true // If user hasn't requested all versions, only show the latest that matches"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \tfor _, r := range res {"
          },
          {
            "type": "delete",
            "line": "\t\tif _, found := foundNames[r.Name]; found {"
          },
          {
            "type": "add",
            "line": "\t\t// if not returning all versions and already have found a result,"
          },
          {
            "type": "add",
            "line": "\t\t// you're done!"
          },
          {
            "type": "add",
            "line": "\t\tif !o.versions && foundNames[r.Name] {"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tv, err := semver.NewVersion(r.Chart.Version)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\t\t// If the current version number check appears ErrSegmentStartsZero or ErrInvalidPrerelease error and not devel mode, ignore"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (err == semver.ErrSegmentStartsZero || err == semver.ErrInvalidPrerelease) && !o.devel {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tcontinue"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\tappendSearchResults(r)"
          },
          {
            "type": "delete",
            "line": "\t\t} else if constraint.Check(v) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tappendSearchResults(r)"
          },
          {
            "type": "add",
            "line": "\t\t\tcontinue"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif constraint.Check(v) {"
          },
          {
            "type": "add",
            "line": "\t\t\tdata = append(data, r)"
          },
          {
            "type": "add",
            "line": "\t\t\tfoundNames[r.Name] = true"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tind, err := repo.LoadIndexFile(f)"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\twarning(\"Repo %q is corrupt or missing. Try 'helm repo update'.\", n)"
          },
          {
            "type": "add",
            "line": "\t\t\twarning(\"%s\", err)"
          },
          {
            "type": "context",
            "line": " \t\t\tcontinue"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "cmd/helm/search_repo_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 86519cd42..39c9c53f5 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/search_repo_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/search_repo_test.go"
          },
          {
            "type": "context",
            "line": " \t\tname:   \"search for 'maria', expect valid json output\","
          },
          {
            "type": "context",
            "line": " \t\tcmd:    \"search repo maria --output json\","
          },
          {
            "type": "context",
            "line": " \t\tgolden: \"output/search-output-json.txt\","
          },
          {
            "type": "delete",
            "line": "\t}, {"
          },
          {
            "type": "delete",
            "line": "\t\tname:   \"search for 'maria', expect one match with semver begin with zero development version\","
          },
          {
            "type": "delete",
            "line": "\t\tcmd:    \"search repo maria --devel\","
          },
          {
            "type": "delete",
            "line": "\t\tgolden: \"output/search-semver-pre-zero-devel-release.txt\","
          },
          {
            "type": "delete",
            "line": "\t}, {"
          },
          {
            "type": "delete",
            "line": "\t\tname:   \"search for 'nginx-ingress', expect one match with invalid development pre version\","
          },
          {
            "type": "delete",
            "line": "\t\tcmd:    \"search repo nginx-ingress --devel\","
          },
          {
            "type": "delete",
            "line": "\t\tgolden: \"output/search-semver-pre-invalid-release.txt\","
          },
          {
            "type": "context",
            "line": " \t}, {"
          },
          {
            "type": "context",
            "line": " \t\tname:   \"search for 'alpine', expect valid yaml output\","
          },
          {
            "type": "context",
            "line": " \t\tcmd:    \"search repo alpine --output yaml\","
          }
        ]
      },
      {
        "file": "cmd/helm/testdata/helmhome/helm/repository/testing-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index d76501e57..889d7d87a 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/testdata/helmhome/helm/repository/testing-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/testdata/helmhome/helm/repository/testing-index.yaml"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - name: alpine"
          },
          {
            "type": "context",
            "line": "       url: https://charts.helm.sh/stable/alpine-0.2.0.tgz"
          },
          {
            "type": "context",
            "line": "       checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - name: alpine"
          },
          {
            "type": "context",
            "line": "       url: https://charts.helm.sh/stable/alpine-0.3.0-rc.1.tgz"
          },
          {
            "type": "context",
            "line": "       checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   mariadb:"
          },
          {
            "type": "context",
            "line": "     - name: mariadb"
          },
          {
            "type": "context",
            "line": "       url: https://charts.helm.sh/stable/mariadb-0.3.0.tgz"
          },
          {
            "type": "context",
            "line": "         - name: Bitnami"
          },
          {
            "type": "context",
            "line": "           email: containers@bitnami.com"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "delete",
            "line": "    - name: mariadb"
          },
          {
            "type": "delete",
            "line": "      url: https://charts.helm.sh/stable/mariadb-0.3.0-0565674.tgz"
          },
          {
            "type": "delete",
            "line": "      checksum: 65229f6de44a2be9f215d11dbff311673fc8ba56"
          },
          {
            "type": "delete",
            "line": "      home: https://mariadb.org"
          },
          {
            "type": "delete",
            "line": "      sources:"
          },
          {
            "type": "delete",
            "line": "        - https://github.com/bitnami/bitnami-docker-mariadb"
          },
          {
            "type": "delete",
            "line": "      version: 0.3.0-0565674"
          },
          {
            "type": "delete",
            "line": "      description: Chart for MariaDB"
          },
          {
            "type": "delete",
            "line": "      keywords:"
          },
          {
            "type": "delete",
            "line": "        - mariadb"
          },
          {
            "type": "delete",
            "line": "        - mysql"
          },
          {
            "type": "delete",
            "line": "        - database"
          },
          {
            "type": "delete",
            "line": "        - sql"
          },
          {
            "type": "delete",
            "line": "      maintainers:"
          },
          {
            "type": "delete",
            "line": "        - name: Bitnami"
          },
          {
            "type": "delete",
            "line": "          email: containers@bitnami.com"
          },
          {
            "type": "delete",
            "line": "      icon: \"\""
          },
          {
            "type": "delete",
            "line": "  nginx-ingress:"
          },
          {
            "type": "delete",
            "line": "    - name: nginx-ingress"
          },
          {
            "type": "delete",
            "line": "      url: https://github.com/kubernetes/ingress-nginx/ingress-a.b.c.sdfsdf.tgz"
          },
          {
            "type": "delete",
            "line": "      checksum: 25229f6de44a2be9f215d11dbff31167ddc8ba56"
          },
          {
            "type": "delete",
            "line": "      home: https://github.com/kubernetes/ingress-nginx"
          },
          {
            "type": "delete",
            "line": "      sources:"
          },
          {
            "type": "delete",
            "line": "        - https://github.com/kubernetes/ingress-nginx"
          },
          {
            "type": "delete",
            "line": "      version: a.b.c.sdfsdf"
          },
          {
            "type": "delete",
            "line": "      description: Chart for nginx-ingress"
          },
          {
            "type": "delete",
            "line": "      keywords:"
          },
          {
            "type": "delete",
            "line": "        - ingress"
          },
          {
            "type": "delete",
            "line": "        - nginx"
          },
          {
            "type": "delete",
            "line": "      icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "cmd/helm/testdata/output/search-semver-pre-invalid-release.txt",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index ea39e2978..000000000"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/testdata/output/search-semver-pre-invalid-release.txt"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "NAME                 \tCHART VERSION\tAPP VERSION\tDESCRIPTION"
          },
          {
            "type": "delete",
            "line": "testing/nginx-ingress\ta.b.c.sdfsdf \t           \tChart for nginx-ingress"
          }
        ]
      },
      {
        "file": "cmd/helm/testdata/output/search-semver-pre-zero-devel-release.txt",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 971c6523e..000000000"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/testdata/output/search-semver-pre-zero-devel-release.txt"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "NAME           \tCHART VERSION\tAPP VERSION\tDESCRIPTION"
          },
          {
            "type": "delete",
            "line": "testing/mariadb\t0.3.0-0565674\t           \tChart for MariaDB"
          }
        ]
      },
      {
        "file": "internal/resolver/testdata/repository/kubernetes-charts-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 493a162f5..c6b7962a1 100644"
          },
          {
            "type": "context",
            "line": "--- a/internal/resolver/testdata/repository/kubernetes-charts-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/internal/resolver/testdata/repository/kubernetes-charts-index.yaml"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - name: alpine"
          },
          {
            "type": "context",
            "line": "       urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/alpine-0.2.0.tgz"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   mariadb:"
          },
          {
            "type": "context",
            "line": "     - name: mariadb"
          },
          {
            "type": "context",
            "line": "       urls:"
          },
          {
            "type": "context",
            "line": "         - name: Bitnami"
          },
          {
            "type": "context",
            "line": "           email: containers@bitnami.com"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/chart/dependency.go",
        "changes": [
          {
            "type": "context",
            "line": "index 9ec4544c2..b2819f373 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chart/dependency.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chart/dependency.go"
          },
          {
            "type": "context",
            "line": " \tAlias string `json:\"alias,omitempty\"`"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Validate checks for common problems with the dependency datastructure in"
          },
          {
            "type": "add",
            "line": "// the chart. This check must be done at load time before the dependency's charts are"
          },
          {
            "type": "add",
            "line": "// loaded."
          },
          {
            "type": "add",
            "line": "func (d *Dependency) Validate() error {"
          },
          {
            "type": "add",
            "line": "\td.Name = sanitizeString(d.Name)"
          },
          {
            "type": "add",
            "line": "\td.Version = sanitizeString(d.Version)"
          },
          {
            "type": "add",
            "line": "\td.Repository = sanitizeString(d.Repository)"
          },
          {
            "type": "add",
            "line": "\td.Condition = sanitizeString(d.Condition)"
          },
          {
            "type": "add",
            "line": "\tfor i := range d.Tags {"
          },
          {
            "type": "add",
            "line": "\t\td.Tags[i] = sanitizeString(d.Tags[i])"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tif d.Alias != \"\" && !aliasNameFormat.MatchString(d.Alias) {"
          },
          {
            "type": "add",
            "line": "\t\treturn ValidationErrorf(\"dependency %q has disallowed characters in the alias\", d.Name)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Lock is a lock file for dependencies."
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "context",
            "line": " // It represents the state that the dependencies should be in."
          }
        ]
      },
      {
        "file": "pkg/chart/dependency_test.go",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..99c45b4b5"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chart/dependency_test.go"
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": "Copyright The Helm Authors."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Licensed under the Apache License, Version 2.0 (the \"License\");"
          },
          {
            "type": "add",
            "line": "you may not use this file except in compliance with the License."
          },
          {
            "type": "add",
            "line": "You may obtain a copy of the License at"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    http://www.apache.org/licenses/LICENSE-2.0"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Unless required by applicable law or agreed to in writing, software"
          },
          {
            "type": "add",
            "line": "distributed under the License is distributed on an \"AS IS\" BASIS,"
          },
          {
            "type": "add",
            "line": "WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied."
          },
          {
            "type": "add",
            "line": "See the License for the specific language governing permissions and"
          },
          {
            "type": "add",
            "line": "limitations under the License."
          },
          {
            "type": "add",
            "line": "*/"
          },
          {
            "type": "add",
            "line": "package chart"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import ("
          },
          {
            "type": "add",
            "line": "\t\"testing\""
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestValidateDependency(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tdep := &Dependency{"
          },
          {
            "type": "add",
            "line": "\t\tName: \"example\","
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tfor value, shouldFail := range map[string]bool{"
          },
          {
            "type": "add",
            "line": "\t\t\"abcdefghijklmenopQRSTUVWXYZ-0123456780_\": false,"
          },
          {
            "type": "add",
            "line": "\t\t\"-okay\":      false,"
          },
          {
            "type": "add",
            "line": "\t\t\"_okay\":      false,"
          },
          {
            "type": "add",
            "line": "\t\t\"- bad\":      true,"
          },
          {
            "type": "add",
            "line": "\t\t\" bad\":       true,"
          },
          {
            "type": "add",
            "line": "\t\t\"bad\\nvalue\": true,"
          },
          {
            "type": "add",
            "line": "\t\t\"bad \":       true,"
          },
          {
            "type": "add",
            "line": "\t\t\"bad$\":       true,"
          },
          {
            "type": "add",
            "line": "\t} {"
          },
          {
            "type": "add",
            "line": "\t\tdep.Alias = value"
          },
          {
            "type": "add",
            "line": "\t\tres := dep.Validate()"
          },
          {
            "type": "add",
            "line": "\t\tif res != nil && !shouldFail {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"Failed on case %q\", dep.Alias)"
          },
          {
            "type": "add",
            "line": "\t\t} else if res == nil && shouldFail {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"Expected failure for %q\", dep.Alias)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "pkg/chart/metadata.go",
        "changes": [
          {
            "type": "context",
            "line": "index 1848eb280..1925e45ac 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chart/metadata.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chart/metadata.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " package chart"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import ("
          },
          {
            "type": "add",
            "line": "\t\"strings\""
          },
          {
            "type": "add",
            "line": "\t\"unicode\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\"github.com/Masterminds/semver/v3\""
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Maintainer describes a Chart maintainer."
          },
          {
            "type": "context",
            "line": " type Maintainer struct {"
          },
          {
            "type": "context",
            "line": " \t// Name is a user name or organization name"
          },
          {
            "type": "context",
            "line": " \tURL string `json:\"url,omitempty\"`"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Validate checks valid data and sanitizes string characters."
          },
          {
            "type": "add",
            "line": "func (m *Maintainer) Validate() error {"
          },
          {
            "type": "add",
            "line": "\tm.Name = sanitizeString(m.Name)"
          },
          {
            "type": "add",
            "line": "\tm.Email = sanitizeString(m.Email)"
          },
          {
            "type": "add",
            "line": "\tm.URL = sanitizeString(m.URL)"
          },
          {
            "type": "add",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Metadata for a Chart file. This models the structure of a Chart.yaml file."
          },
          {
            "type": "context",
            "line": " type Metadata struct {"
          },
          {
            "type": "delete",
            "line": "\t// The name of the chart"
          },
          {
            "type": "add",
            "line": "\t// The name of the chart. Required."
          },
          {
            "type": "context",
            "line": " \tName string `json:\"name,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \t// The URL to a relevant project page, git repo, or contact person"
          },
          {
            "type": "context",
            "line": " \tHome string `json:\"home,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \t// Source is the URL to the source code of this chart"
          },
          {
            "type": "context",
            "line": " \tSources []string `json:\"sources,omitempty\"`"
          },
          {
            "type": "delete",
            "line": "\t// A SemVer 2 conformant version string of the chart"
          },
          {
            "type": "add",
            "line": "\t// A SemVer 2 conformant version string of the chart. Required."
          },
          {
            "type": "context",
            "line": " \tVersion string `json:\"version,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \t// A one-sentence description of the chart"
          },
          {
            "type": "context",
            "line": " \tDescription string `json:\"description,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \tMaintainers []*Maintainer `json:\"maintainers,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \t// The URL to an icon file."
          },
          {
            "type": "context",
            "line": " \tIcon string `json:\"icon,omitempty\"`"
          },
          {
            "type": "delete",
            "line": "\t// The API Version of this chart."
          },
          {
            "type": "add",
            "line": "\t// The API Version of this chart. Required."
          },
          {
            "type": "context",
            "line": " \tAPIVersion string `json:\"apiVersion,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \t// The condition to check to enable chart"
          },
          {
            "type": "context",
            "line": " \tCondition string `json:\"condition,omitempty\"`"
          },
          {
            "type": "context",
            "line": " \tType string `json:\"type,omitempty\"`"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "// Validate checks the metadata for known issues, returning an error if metadata is not correct"
          },
          {
            "type": "add",
            "line": "// Validate checks the metadata for known issues and sanitizes string"
          },
          {
            "type": "add",
            "line": "// characters."
          },
          {
            "type": "context",
            "line": " func (md *Metadata) Validate() error {"
          },
          {
            "type": "context",
            "line": " \tif md == nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn ValidationError(\"chart.metadata is required\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tmd.Name = sanitizeString(md.Name)"
          },
          {
            "type": "add",
            "line": "\tmd.Description = sanitizeString(md.Description)"
          },
          {
            "type": "add",
            "line": "\tmd.Home = sanitizeString(md.Home)"
          },
          {
            "type": "add",
            "line": "\tmd.Icon = sanitizeString(md.Icon)"
          },
          {
            "type": "add",
            "line": "\tmd.Condition = sanitizeString(md.Condition)"
          },
          {
            "type": "add",
            "line": "\tmd.Tags = sanitizeString(md.Tags)"
          },
          {
            "type": "add",
            "line": "\tmd.AppVersion = sanitizeString(md.AppVersion)"
          },
          {
            "type": "add",
            "line": "\tmd.KubeVersion = sanitizeString(md.KubeVersion)"
          },
          {
            "type": "add",
            "line": "\tfor i := range md.Sources {"
          },
          {
            "type": "add",
            "line": "\t\tmd.Sources[i] = sanitizeString(md.Sources[i])"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tfor i := range md.Keywords {"
          },
          {
            "type": "add",
            "line": "\t\tmd.Keywords[i] = sanitizeString(md.Keywords[i])"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif md.APIVersion == \"\" {"
          },
          {
            "type": "context",
            "line": " \t\treturn ValidationError(\"chart.metadata.apiVersion is required\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tif md.Version == \"\" {"
          },
          {
            "type": "context",
            "line": " \t\treturn ValidationError(\"chart.metadata.version is required\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": "\tif !isValidSemver(md.Version) {"
          },
          {
            "type": "add",
            "line": "\t\treturn ValidationErrorf(\"chart.metadata.version %q is invalid\", md.Version)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \tif !isValidChartType(md.Type) {"
          },
          {
            "type": "context",
            "line": " \t\treturn ValidationError(\"chart.metadata.type must be application or library\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfor _, m := range md.Maintainers {"
          },
          {
            "type": "add",
            "line": "\t\tif err := m.Validate(); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn err"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// Aliases need to be validated here to make sure that the alias name does"
          },
          {
            "type": "context",
            "line": " \t// not contain any illegal characters."
          },
          {
            "type": "context",
            "line": " \tfor _, dependency := range md.Dependencies {"
          },
          {
            "type": "delete",
            "line": "\t\tif err := validateDependency(dependency); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tif err := dependency.Validate(); err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn err"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t// TODO validate valid semver here?"
          },
          {
            "type": "context",
            "line": " \treturn nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn false"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "// validateDependency checks for common problems with the dependency datastructure in"
          },
          {
            "type": "delete",
            "line": "// the chart. This check must be done at load time before the dependency's charts are"
          },
          {
            "type": "delete",
            "line": "// loaded."
          },
          {
            "type": "delete",
            "line": "func validateDependency(dep *Dependency) error {"
          },
          {
            "type": "delete",
            "line": "\tif len(dep.Alias) > 0 && !aliasNameFormat.MatchString(dep.Alias) {"
          },
          {
            "type": "delete",
            "line": "\t\treturn ValidationErrorf(\"dependency %q has disallowed characters in the alias\", dep.Name)"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "func isValidSemver(v string) bool {"
          },
          {
            "type": "add",
            "line": "\t_, err := semver.NewVersion(v)"
          },
          {
            "type": "add",
            "line": "\treturn err == nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// sanitizeString normalize spaces and removes non-printable characters."
          },
          {
            "type": "add",
            "line": "func sanitizeString(str string) string {"
          },
          {
            "type": "add",
            "line": "\treturn strings.Map(func(r rune) rune {"
          },
          {
            "type": "add",
            "line": "\t\tif unicode.IsSpace(r) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn ' '"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif unicode.IsPrint(r) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn r"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\treturn -1"
          },
          {
            "type": "add",
            "line": "\t}, str)"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "pkg/chart/metadata_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 0c7b173dd..9f881a4e1 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chart/metadata_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chart/metadata_test.go"
          },
          {
            "type": "context",
            "line": " \t\t\t},"
          },
          {
            "type": "context",
            "line": " \t\t\tValidationError(\"dependency \\\"bad\\\" has disallowed characters in the alias\"),"
          },
          {
            "type": "context",
            "line": " \t\t},"
          },
          {
            "type": "add",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\t&Metadata{APIVersion: \"v2\", Name: \"test\", Version: \"1.2.3.4\"},"
          },
          {
            "type": "add",
            "line": "\t\t\tValidationError(\"chart.metadata.version \\\"1.2.3.4\\\" is invalid\"),"
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfor _, tt := range tests {"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "func TestValidateDependency(t *testing.T) {"
          },
          {
            "type": "delete",
            "line": "\tdep := &Dependency{"
          },
          {
            "type": "delete",
            "line": "\t\tName: \"example\","
          },
          {
            "type": "add",
            "line": "func TestValidate_sanitize(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tmd := &Metadata{APIVersion: \"v2\", Name: \"test\", Version: \"1.0\", Description: \"\\adescr\\u0081iption\\rtest\", Maintainers: []*Maintainer{{Name: \"\\r\"}}}"
          },
          {
            "type": "add",
            "line": "\tif err := md.Validate(); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"unexpected error: %s\", err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tfor value, shouldFail := range map[string]bool{"
          },
          {
            "type": "delete",
            "line": "\t\t\"abcdefghijklmenopQRSTUVWXYZ-0123456780_\": false,"
          },
          {
            "type": "delete",
            "line": "\t\t\"-okay\":      false,"
          },
          {
            "type": "delete",
            "line": "\t\t\"_okay\":      false,"
          },
          {
            "type": "delete",
            "line": "\t\t\"- bad\":      true,"
          },
          {
            "type": "delete",
            "line": "\t\t\" bad\":       true,"
          },
          {
            "type": "delete",
            "line": "\t\t\"bad\\nvalue\": true,"
          },
          {
            "type": "delete",
            "line": "\t\t\"bad \":       true,"
          },
          {
            "type": "delete",
            "line": "\t\t\"bad$\":       true,"
          },
          {
            "type": "delete",
            "line": "\t} {"
          },
          {
            "type": "delete",
            "line": "\t\tdep.Alias = value"
          },
          {
            "type": "delete",
            "line": "\t\tres := validateDependency(dep)"
          },
          {
            "type": "delete",
            "line": "\t\tif res != nil && !shouldFail {"
          },
          {
            "type": "delete",
            "line": "\t\t\tt.Errorf(\"Failed on case %q\", dep.Alias)"
          },
          {
            "type": "delete",
            "line": "\t\t} else if res == nil && shouldFail {"
          },
          {
            "type": "delete",
            "line": "\t\t\tt.Errorf(\"Expected failure for %q\", dep.Alias)"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\tif md.Description != \"description test\" {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"description was not sanitized: %q\", md.Description)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tif md.Maintainers[0].Name != \" \" {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatal(\"maintainer name was not sanitized\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "pkg/chartutil/save_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 3a45b2992..23c3f9467 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chartutil/save_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chartutil/save_test.go"
          },
          {
            "type": "context",
            "line": " \t\tMetadata: &chart.Metadata{"
          },
          {
            "type": "context",
            "line": " \t\t\tAPIVersion: chart.APIVersionV1,"
          },
          {
            "type": "context",
            "line": " \t\t\tName:       \"ahab\","
          },
          {
            "type": "delete",
            "line": "\t\t\tVersion:    \"1.2.3.4\","
          },
          {
            "type": "add",
            "line": "\t\t\tVersion:    \"1.2.3\","
          },
          {
            "type": "context",
            "line": " \t\t},"
          },
          {
            "type": "context",
            "line": " \t\tValues: map[string]interface{}{"
          },
          {
            "type": "context",
            "line": " \t\t\t\"imageName\": \"testimage\","
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/kubernetes-charts-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index b9e3dc69e..52dcf930b 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/kubernetes-charts-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/kubernetes-charts-index.yaml"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - name: alpine"
          },
          {
            "type": "context",
            "line": "       urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/alpine-0.2.0.tgz"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   mariadb:"
          },
          {
            "type": "context",
            "line": "     - name: mariadb"
          },
          {
            "type": "context",
            "line": "       urls:"
          },
          {
            "type": "context",
            "line": "         - name: Bitnami"
          },
          {
            "type": "context",
            "line": "           email: containers@bitnami.com"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/malformed-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 887e129e9..fa319abdd 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/malformed-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/malformed-index.yaml"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-basicauth-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index da3ed5108..ed092ef41 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-basicauth-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-basicauth-index.yaml"
          },
          {
            "type": "context",
            "line": "         - http://username:password@example.com/foo-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": "       version: 1.2.3"
          },
          {
            "type": "context",
            "line": "       checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-ca-file-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 17cdde1c6..81901efc7 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-ca-file-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-ca-file-index.yaml"
          },
          {
            "type": "context",
            "line": "         - https://example.com/foo-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": "       version: 1.2.3"
          },
          {
            "type": "context",
            "line": "       checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-https-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 17cdde1c6..81901efc7 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-https-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-https-index.yaml"
          },
          {
            "type": "context",
            "line": "         - https://example.com/foo-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": "       version: 1.2.3"
          },
          {
            "type": "context",
            "line": "       checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index c238b8f8d..f588bf1fb 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-index.yaml"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - name: alpine"
          },
          {
            "type": "context",
            "line": "       urls:"
          },
          {
            "type": "context",
            "line": "         - http://example.com/alpine-0.2.0.tgz"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   foo:"
          },
          {
            "type": "context",
            "line": "     - name: foo"
          },
          {
            "type": "context",
            "line": "       description: Foo Chart"
          },
          {
            "type": "context",
            "line": "         - http://example.com/foo-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": "       version: 1.2.3"
          },
          {
            "type": "context",
            "line": "       checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-querystring-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 887e129e9..fa319abdd 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-querystring-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-querystring-index.yaml"
          },
          {
            "type": "context",
            "line": "       keywords: []"
          },
          {
            "type": "context",
            "line": "       maintainers: []"
          },
          {
            "type": "context",
            "line": "       icon: \"\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-relative-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 62197b698..ba27ed257 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-relative-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-relative-index.yaml"
          },
          {
            "type": "delete",
            "line": "apiVersion: v1"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "entries:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  foo:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    - name: foo"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      description: Foo Chart With Relative Path"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      keywords: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      maintainers: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      sources:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      urls:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - charts/foo-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      version: 1.2.3"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  bar:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    - name: bar"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      description: Bar Chart With Relative Path"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      keywords: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      maintainers: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      sources:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      urls:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - bar-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      version: 1.2.3"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "apiVersion: v1"
          },
          {
            "type": "add",
            "line": "entries:"
          },
          {
            "type": "add",
            "line": "  foo:"
          },
          {
            "type": "add",
            "line": "    - name: foo"
          },
          {
            "type": "add",
            "line": "      description: Foo Chart With Relative Path"
          },
          {
            "type": "add",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "add",
            "line": "      keywords: []"
          },
          {
            "type": "add",
            "line": "      maintainers: []"
          },
          {
            "type": "add",
            "line": "      sources:"
          },
          {
            "type": "add",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "add",
            "line": "      urls:"
          },
          {
            "type": "add",
            "line": "        - charts/foo-1.2.3.tgz"
          },
          {
            "type": "add",
            "line": "      version: 1.2.3"
          },
          {
            "type": "add",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "add",
            "line": "  bar:"
          },
          {
            "type": "add",
            "line": "    - name: bar"
          },
          {
            "type": "add",
            "line": "      description: Bar Chart With Relative Path"
          },
          {
            "type": "add",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "add",
            "line": "      keywords: []"
          },
          {
            "type": "add",
            "line": "      maintainers: []"
          },
          {
            "type": "add",
            "line": "      sources:"
          },
          {
            "type": "add",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "add",
            "line": "      urls:"
          },
          {
            "type": "add",
            "line": "        - bar-1.2.3.tgz"
          },
          {
            "type": "add",
            "line": "      version: 1.2.3"
          },
          {
            "type": "add",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/downloader/testdata/repository/testing-relative-trailing-slash-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 62197b698..ba27ed257 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/downloader/testdata/repository/testing-relative-trailing-slash-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/downloader/testdata/repository/testing-relative-trailing-slash-index.yaml"
          },
          {
            "type": "delete",
            "line": "apiVersion: v1"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "entries:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  foo:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    - name: foo"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      description: Foo Chart With Relative Path"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      keywords: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      maintainers: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      sources:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      urls:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - charts/foo-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      version: 1.2.3"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  bar:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    - name: bar"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      description: Bar Chart With Relative Path"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      keywords: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      maintainers: []"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      sources:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      urls:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        - bar-1.2.3.tgz"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      version: 1.2.3"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "apiVersion: v1"
          },
          {
            "type": "add",
            "line": "entries:"
          },
          {
            "type": "add",
            "line": "  foo:"
          },
          {
            "type": "add",
            "line": "    - name: foo"
          },
          {
            "type": "add",
            "line": "      description: Foo Chart With Relative Path"
          },
          {
            "type": "add",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "add",
            "line": "      keywords: []"
          },
          {
            "type": "add",
            "line": "      maintainers: []"
          },
          {
            "type": "add",
            "line": "      sources:"
          },
          {
            "type": "add",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "add",
            "line": "      urls:"
          },
          {
            "type": "add",
            "line": "        - charts/foo-1.2.3.tgz"
          },
          {
            "type": "add",
            "line": "      version: 1.2.3"
          },
          {
            "type": "add",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "add",
            "line": "  bar:"
          },
          {
            "type": "add",
            "line": "    - name: bar"
          },
          {
            "type": "add",
            "line": "      description: Bar Chart With Relative Path"
          },
          {
            "type": "add",
            "line": "      home: https://helm.sh/helm"
          },
          {
            "type": "add",
            "line": "      keywords: []"
          },
          {
            "type": "add",
            "line": "      maintainers: []"
          },
          {
            "type": "add",
            "line": "      sources:"
          },
          {
            "type": "add",
            "line": "        - https://github.com/helm/charts"
          },
          {
            "type": "add",
            "line": "      urls:"
          },
          {
            "type": "add",
            "line": "        - bar-1.2.3.tgz"
          },
          {
            "type": "add",
            "line": "      version: 1.2.3"
          },
          {
            "type": "add",
            "line": "      checksum: 0e6661f193211d7a5206918d42f5c2a9470b737d"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/plugin/plugin.go",
        "changes": [
          {
            "type": "context",
            "line": "index 93b5527a1..9ead561b2 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/plugin/plugin.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/plugin.go"
          },
          {
            "type": "context",
            "line": " \t\"regexp\""
          },
          {
            "type": "context",
            "line": " \t\"runtime\""
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "add",
            "line": "\t\"unicode\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"github.com/pkg/errors\""
          },
          {
            "type": "context",
            "line": " \t\"sigs.k8s.io/yaml\""
          },
          {
            "type": "context",
            "line": " \tif !validPluginName.MatchString(plug.Metadata.Name) {"
          },
          {
            "type": "context",
            "line": " \t\treturn fmt.Errorf(\"invalid plugin name at %q\", filepath)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": "\tplug.Metadata.Usage = sanitizeString(plug.Metadata.Usage)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t// We could also validate SemVer, executable, and other fields should we so choose."
          },
          {
            "type": "context",
            "line": " \treturn nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// sanitizeString normalize spaces and removes non-printable characters."
          },
          {
            "type": "add",
            "line": "func sanitizeString(str string) string {"
          },
          {
            "type": "add",
            "line": "\treturn strings.Map(func(r rune) rune {"
          },
          {
            "type": "add",
            "line": "\t\tif unicode.IsSpace(r) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn ' '"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif unicode.IsPrint(r) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn r"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\treturn -1"
          },
          {
            "type": "add",
            "line": "\t}, str)"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " func detectDuplicates(plugs []*Plugin) error {"
          },
          {
            "type": "context",
            "line": " \tnames := map[string]string{}"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "pkg/repo/chartrepo.go",
        "changes": [
          {
            "type": "context",
            "line": "index 92892bb85..09b94fd42 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/chartrepo.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/chartrepo.go"
          },
          {
            "type": "context",
            "line": " // Load loads a directory of charts as if it were a repository."
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "context",
            "line": " // It requires the presence of an index.yaml file in the directory."
          },
          {
            "type": "add",
            "line": "//"
          },
          {
            "type": "add",
            "line": "// Deprecated: remove in Helm 4."
          },
          {
            "type": "context",
            "line": " func (r *ChartRepository) Load() error {"
          },
          {
            "type": "context",
            "line": " \tdirInfo, err := os.Stat(r.Config.Name)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tif strings.Contains(f.Name(), \"-index.yaml\") {"
          },
          {
            "type": "context",
            "line": " \t\t\t\ti, err := LoadIndexFile(path)"
          },
          {
            "type": "context",
            "line": " \t\t\t\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\treturn nil"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\treturn err"
          },
          {
            "type": "context",
            "line": " \t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\tr.IndexFile = i"
          },
          {
            "type": "context",
            "line": " \t\t\t} else if strings.HasSuffix(f.Name(), \".tgz\") {"
          },
          {
            "type": "context",
            "line": " \t\treturn \"\", err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tindexFile, err := loadIndex(index)"
          },
          {
            "type": "add",
            "line": "\tindexFile, err := loadIndex(index, r.Config.URL)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn \"\", err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif !r.IndexFile.Has(ch.Name(), ch.Metadata.Version) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tr.IndexFile.Add(ch.Metadata, path, r.Config.URL, digest)"
          },
          {
            "type": "add",
            "line": "\t\t\tif err := r.IndexFile.MustAdd(ch.Metadata, path, r.Config.URL, digest); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\t\treturn errors.Wrapf(err, \"failed adding to %s to index\", path)"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t// TODO: If a chart exists, but has a different Digest, should we error?"
          },
          {
            "type": "context",
            "line": " \t}"
          }
        ]
      },
      {
        "file": "pkg/repo/index.go",
        "changes": [
          {
            "type": "context",
            "line": "index 43f1e1c87..5adaf5530 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/index.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/index.go"
          },
          {
            "type": "context",
            "line": " import ("
          },
          {
            "type": "context",
            "line": " \t\"bytes\""
          },
          {
            "type": "context",
            "line": " \t\"io/ioutil\""
          },
          {
            "type": "add",
            "line": "\t\"log\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t\"path\""
          },
          {
            "type": "context",
            "line": " \t\"path/filepath\""
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn nil, err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\treturn loadIndex(b)"
          },
          {
            "type": "add",
            "line": "\ti, err := loadIndex(b, path)"
          },
          {
            "type": "add",
            "line": "\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\treturn nil, errors.Wrapf(err, \"error loading %s\", path)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\treturn i, nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "// Add adds a file to the index"
          },
          {
            "type": "add",
            "line": "// MustAdd adds a file to the index"
          },
          {
            "type": "context",
            "line": " // This can leave the index in an unsorted state"
          },
          {
            "type": "delete",
            "line": "func (i IndexFile) Add(md *chart.Metadata, filename, baseURL, digest string) {"
          },
          {
            "type": "add",
            "line": "func (i IndexFile) MustAdd(md *chart.Metadata, filename, baseURL, digest string) error {"
          },
          {
            "type": "add",
            "line": "\tif md.APIVersion == \"\" {"
          },
          {
            "type": "add",
            "line": "\t\tmd.APIVersion = chart.APIVersionV1"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tif err := md.Validate(); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\treturn errors.Wrapf(err, \"validate failed for %s\", filename)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tu := filename"
          },
          {
            "type": "context",
            "line": " \tif baseURL != \"\" {"
          },
          {
            "type": "delete",
            "line": "\t\tvar err error"
          },
          {
            "type": "context",
            "line": " \t\t_, file := filepath.Split(filename)"
          },
          {
            "type": "add",
            "line": "\t\tvar err error"
          },
          {
            "type": "context",
            "line": " \t\tu, err = urlutil.URLJoin(baseURL, file)"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tu = path.Join(baseURL, file)"
          },
          {
            "type": "context",
            "line": " \t\tDigest:   digest,"
          },
          {
            "type": "context",
            "line": " \t\tCreated:  time.Now(),"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\tif ee, ok := i.Entries[md.Name]; !ok {"
          },
          {
            "type": "delete",
            "line": "\t\ti.Entries[md.Name] = ChartVersions{cr}"
          },
          {
            "type": "delete",
            "line": "\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\ti.Entries[md.Name] = append(ee, cr)"
          },
          {
            "type": "add",
            "line": "\tee := i.Entries[md.Name]"
          },
          {
            "type": "add",
            "line": "\ti.Entries[md.Name] = append(ee, cr)"
          },
          {
            "type": "add",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Add adds a file to the index and logs an error."
          },
          {
            "type": "add",
            "line": "//"
          },
          {
            "type": "add",
            "line": "// Deprecated: Use index.MustAdd instead."
          },
          {
            "type": "add",
            "line": "func (i IndexFile) Add(md *chart.Metadata, filename, baseURL, digest string) {"
          },
          {
            "type": "add",
            "line": "\tif err := i.MustAdd(md, filename, baseURL, digest); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tlog.Printf(\"skipping loading invalid entry for chart %q %q from %s: %s\", md.Name, md.Version, filename, err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn index, err"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\tindex.Add(c.Metadata, fname, parentURL, hash)"
          },
          {
            "type": "add",
            "line": "\t\tif err := index.MustAdd(c.Metadata, fname, parentURL, hash); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn index, errors.Wrapf(err, \"failed adding to %s to index\", fname)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \treturn index, nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // loadIndex loads an index file and does minimal validity checking."
          },
          {
            "type": "context",
            "line": " //"
          },
          {
            "type": "add",
            "line": "// The source parameter is only used for logging."
          },
          {
            "type": "context",
            "line": " // This will fail if API Version is not set (ErrNoAPIVersion) or if the unmarshal fails."
          },
          {
            "type": "delete",
            "line": "func loadIndex(data []byte) (*IndexFile, error) {"
          },
          {
            "type": "add",
            "line": "func loadIndex(data []byte, source string) (*IndexFile, error) {"
          },
          {
            "type": "context",
            "line": " \ti := &IndexFile{}"
          },
          {
            "type": "context",
            "line": " \tif err := yaml.UnmarshalStrict(data, i); err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn i, err"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfor name, cvs := range i.Entries {"
          },
          {
            "type": "add",
            "line": "\t\tfor idx := len(cvs) - 1; idx >= 0; idx-- {"
          },
          {
            "type": "add",
            "line": "\t\t\tif cvs[idx].APIVersion == \"\" {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tcvs[idx].APIVersion = chart.APIVersionV1"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\tif err := cvs[idx].Validate(); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tlog.Printf(\"skipping loading invalid entry for chart %q %q from %s: %s\", name, cvs[idx].Version, source, err)"
          },
          {
            "type": "add",
            "line": "\t\t\t\tcvs = append(cvs[:idx], cvs[idx+1:]...)"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \ti.SortEntries()"
          },
          {
            "type": "context",
            "line": " \tif i.APIVersion == \"\" {"
          },
          {
            "type": "context",
            "line": " \t\treturn i, ErrNoAPIVersion"
          }
        ]
      },
      {
        "file": "pkg/repo/index_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index b3d91402b..47f3c6b2e 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/index_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/index_test.go"
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "context",
            "line": " \t\"testing\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\"helm.sh/helm/v3/pkg/chart\""
          },
          {
            "type": "context",
            "line": " \t\"helm.sh/helm/v3/pkg/cli\""
          },
          {
            "type": "context",
            "line": " \t\"helm.sh/helm/v3/pkg/getter\""
          },
          {
            "type": "context",
            "line": " \t\"helm.sh/helm/v3/pkg/helmpath\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\"helm.sh/helm/v3/pkg/chart\""
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " const ("
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestIndexFile(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \ti := NewIndexFile()"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"clipper\", Version: \"0.1.0\"}, \"clipper-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\")"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"cutter\", Version: \"0.1.1\"}, \"cutter-0.1.1.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\")"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"cutter\", Version: \"0.1.0\"}, \"cutter-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\")"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"cutter\", Version: \"0.2.0\"}, \"cutter-0.2.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\")"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"setter\", Version: \"0.1.9+alpha\"}, \"setter-0.1.9+alpha.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\")"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"setter\", Version: \"0.1.9+beta\"}, \"setter-0.1.9+beta.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\")"
          },
          {
            "type": "add",
            "line": "\tfor _, x := range []struct {"
          },
          {
            "type": "add",
            "line": "\t\tmd       *chart.Metadata"
          },
          {
            "type": "add",
            "line": "\t\tfilename string"
          },
          {
            "type": "add",
            "line": "\t\tbaseURL  string"
          },
          {
            "type": "add",
            "line": "\t\tdigest   string"
          },
          {
            "type": "add",
            "line": "\t}{"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"clipper\", Version: \"0.1.0\"}, \"clipper-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"cutter\", Version: \"0.1.1\"}, \"cutter-0.1.1.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"cutter\", Version: \"0.1.0\"}, \"cutter-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"cutter\", Version: \"0.2.0\"}, \"cutter-0.2.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"setter\", Version: \"0.1.9+alpha\"}, \"setter-0.1.9+alpha.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"setter\", Version: \"0.1.9+beta\"}, \"setter-0.1.9+beta.tgz\", \"http://example.com/charts\", \"sha256:1234567890abc\"},"
          },
          {
            "type": "add",
            "line": "\t} {"
          },
          {
            "type": "add",
            "line": "\t\tif err := i.MustAdd(x.md, x.filename, x.baseURL, x.digest); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"unexpected error adding to index: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \ti.SortEntries()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\ttc := tc"
          },
          {
            "type": "context",
            "line": " \t\tt.Run(tc.Name, func(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Parallel()"
          },
          {
            "type": "delete",
            "line": "\t\t\tb, err := ioutil.ReadFile(tc.Filename)"
          },
          {
            "type": "delete",
            "line": "\t\t\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tt.Fatal(err)"
          },
          {
            "type": "delete",
            "line": "\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\ti, err := loadIndex(b)"
          },
          {
            "type": "add",
            "line": "\t\t\ti, err := LoadIndexFile(tc.Filename)"
          },
          {
            "type": "context",
            "line": " \t\t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tt.Fatal(err)"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // TestLoadIndex_Duplicates is a regression to make sure that we don't non-deterministically allow duplicate packages."
          },
          {
            "type": "context",
            "line": " func TestLoadIndex_Duplicates(t *testing.T) {"
          },
          {
            "type": "delete",
            "line": "\tif _, err := loadIndex([]byte(indexWithDuplicates)); err == nil {"
          },
          {
            "type": "add",
            "line": "\tif _, err := loadIndex([]byte(indexWithDuplicates), \"indexWithDuplicates\"); err == nil {"
          },
          {
            "type": "context",
            "line": " \t\tt.Errorf(\"Expected an error when duplicate entries are present\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "func TestLoadIndexFile(t *testing.T) {"
          },
          {
            "type": "delete",
            "line": "\ti, err := LoadIndexFile(testfile)"
          },
          {
            "type": "delete",
            "line": "\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\tt.Fatal(err)"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": "\tverifyLocalIndex(t, i)"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestLoadIndexFileAnnotations(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \ti, err := LoadIndexFile(annotationstestfile)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestLoadUnorderedIndex(t *testing.T) {"
          },
          {
            "type": "delete",
            "line": "\tb, err := ioutil.ReadFile(unorderedTestfile)"
          },
          {
            "type": "delete",
            "line": "\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\tt.Fatal(err)"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": "\ti, err := loadIndex(b)"
          },
          {
            "type": "add",
            "line": "\ti, err := LoadIndexFile(unorderedTestfile)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatal(err)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestMerge(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \tind1 := NewIndexFile()"
          },
          {
            "type": "delete",
            "line": "\tind1.Add(&chart.Metadata{"
          },
          {
            "type": "delete",
            "line": "\t\tName:    \"dreadnought\","
          },
          {
            "type": "delete",
            "line": "\t\tVersion: \"0.1.0\","
          },
          {
            "type": "delete",
            "line": "\t}, \"dreadnought-0.1.0.tgz\", \"http://example.com\", \"aaaa\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tif err := ind1.MustAdd(&chart.Metadata{APIVersion: \"v2\", Name: \"dreadnought\", Version: \"0.1.0\"}, \"dreadnought-0.1.0.tgz\", \"http://example.com\", \"aaaa\"); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"unexpected error: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tind2 := NewIndexFile()"
          },
          {
            "type": "delete",
            "line": "\tind2.Add(&chart.Metadata{"
          },
          {
            "type": "delete",
            "line": "\t\tName:    \"dreadnought\","
          },
          {
            "type": "delete",
            "line": "\t\tVersion: \"0.2.0\","
          },
          {
            "type": "delete",
            "line": "\t}, \"dreadnought-0.2.0.tgz\", \"http://example.com\", \"aaaabbbb\")"
          },
          {
            "type": "delete",
            "line": "\tind2.Add(&chart.Metadata{"
          },
          {
            "type": "delete",
            "line": "\t\tName:    \"doughnut\","
          },
          {
            "type": "delete",
            "line": "\t\tVersion: \"0.2.0\","
          },
          {
            "type": "delete",
            "line": "\t}, \"doughnut-0.2.0.tgz\", \"http://example.com\", \"ccccbbbb\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfor _, x := range []struct {"
          },
          {
            "type": "add",
            "line": "\t\tmd       *chart.Metadata"
          },
          {
            "type": "add",
            "line": "\t\tfilename string"
          },
          {
            "type": "add",
            "line": "\t\tbaseURL  string"
          },
          {
            "type": "add",
            "line": "\t\tdigest   string"
          },
          {
            "type": "add",
            "line": "\t}{"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"dreadnought\", Version: \"0.2.0\"}, \"dreadnought-0.2.0.tgz\", \"http://example.com\", \"aaaabbbb\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"doughnut\", Version: \"0.2.0\"}, \"doughnut-0.2.0.tgz\", \"http://example.com\", \"ccccbbbb\"},"
          },
          {
            "type": "add",
            "line": "\t} {"
          },
          {
            "type": "add",
            "line": "\t\tif err := ind2.MustAdd(x.md, x.filename, x.baseURL, x.digest); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"unexpected error: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tind1.Merge(ind2)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"error finding created index file: %#v\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tb, err := ioutil.ReadFile(idx)"
          },
          {
            "type": "delete",
            "line": "\t\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\t\tt.Fatalf(\"error reading index file: %#v\", err)"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\ti, err := loadIndex(b)"
          },
          {
            "type": "add",
            "line": "\t\ti, err := LoadIndexFile(idx)"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"Index %q failed to parse: %s\", testfile, err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"error finding created charts file: %#v\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tb, err = ioutil.ReadFile(idx)"
          },
          {
            "type": "add",
            "line": "\t\tb, err := ioutil.ReadFile(idx)"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"error reading charts file: %#v\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"error finding created index file: %#v\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tb, err := ioutil.ReadFile(idx)"
          },
          {
            "type": "delete",
            "line": "\t\tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\t\tt.Fatalf(\"error reading index file: %#v\", err)"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\ti, err := loadIndex(b)"
          },
          {
            "type": "add",
            "line": "\t\ti, err := LoadIndexFile(idx)"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"Index %q failed to parse: %s\", testfile, err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"error finding created charts file: %#v\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tb, err = ioutil.ReadFile(idx)"
          },
          {
            "type": "add",
            "line": "\t\tb, err := ioutil.ReadFile(idx)"
          },
          {
            "type": "context",
            "line": " \t\tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\t\tt.Fatalf(\"error reading charts file: %#v\", err)"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \texpects := []*ChartVersion{"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tMetadata: &chart.Metadata{"
          },
          {
            "type": "add",
            "line": "\t\t\t\tAPIVersion:  \"v2\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tName:        \"alpine\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tDescription: \"string\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tVersion:     \"1.0.0\","
          },
          {
            "type": "context",
            "line": " \t\t},"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tMetadata: &chart.Metadata{"
          },
          {
            "type": "add",
            "line": "\t\t\t\tAPIVersion:  \"v2\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tName:        \"nginx\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tDescription: \"string\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tVersion:     \"0.2.0\","
          },
          {
            "type": "context",
            "line": " \t\t},"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tMetadata: &chart.Metadata{"
          },
          {
            "type": "add",
            "line": "\t\t\t\tAPIVersion:  \"v2\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tName:        \"nginx\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tDescription: \"string\","
          },
          {
            "type": "context",
            "line": " \t\t\t\tVersion:     \"0.1.0\","
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestIndexAdd(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \ti := NewIndexFile()"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"clipper\", Version: \"0.1.0\"}, \"clipper-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfor _, x := range []struct {"
          },
          {
            "type": "add",
            "line": "\t\tmd       *chart.Metadata"
          },
          {
            "type": "add",
            "line": "\t\tfilename string"
          },
          {
            "type": "add",
            "line": "\t\tbaseURL  string"
          },
          {
            "type": "add",
            "line": "\t\tdigest   string"
          },
          {
            "type": "add",
            "line": "\t}{"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"clipper\", Version: \"0.1.0\"}, \"clipper-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"alpine\", Version: \"0.1.0\"}, \"/home/charts/alpine-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\"},"
          },
          {
            "type": "add",
            "line": "\t\t{&chart.Metadata{APIVersion: \"v2\", Name: \"deis\", Version: \"0.1.0\"}, \"/home/charts/deis-0.1.0.tgz\", \"http://example.com/charts/\", \"sha256:1234567890\"},"
          },
          {
            "type": "add",
            "line": "\t} {"
          },
          {
            "type": "add",
            "line": "\t\tif err := i.MustAdd(x.md, x.filename, x.baseURL, x.digest); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"unexpected error adding to index: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif i.Entries[\"clipper\"][0].URLs[0] != \"http://example.com/charts/clipper-0.1.0.tgz\" {"
          },
          {
            "type": "context",
            "line": " \t\tt.Errorf(\"Expected http://example.com/charts/clipper-0.1.0.tgz, got %s\", i.Entries[\"clipper\"][0].URLs[0])"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"alpine\", Version: \"0.1.0\"}, \"/home/charts/alpine-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif i.Entries[\"alpine\"][0].URLs[0] != \"http://example.com/charts/alpine-0.1.0.tgz\" {"
          },
          {
            "type": "context",
            "line": " \t\tt.Errorf(\"Expected http://example.com/charts/alpine-0.1.0.tgz, got %s\", i.Entries[\"alpine\"][0].URLs[0])"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"deis\", Version: \"0.1.0\"}, \"/home/charts/deis-0.1.0.tgz\", \"http://example.com/charts/\", \"sha256:1234567890\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif i.Entries[\"deis\"][0].URLs[0] != \"http://example.com/charts/deis-0.1.0.tgz\" {"
          },
          {
            "type": "context",
            "line": " \t\tt.Errorf(\"Expected http://example.com/charts/deis-0.1.0.tgz, got %s\", i.Entries[\"deis\"][0].URLs[0])"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t// test error condition"
          },
          {
            "type": "add",
            "line": "\tif err := i.MustAdd(&chart.Metadata{}, \"error-0.1.0.tgz\", \"\", \"\"); err == nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatal(\"expected error adding to index\")"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestIndexWrite(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \ti := NewIndexFile()"
          },
          {
            "type": "delete",
            "line": "\ti.Add(&chart.Metadata{Name: \"clipper\", Version: \"0.1.0\"}, \"clipper-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\")"
          },
          {
            "type": "add",
            "line": "\tif err := i.MustAdd(&chart.Metadata{APIVersion: \"v2\", Name: \"clipper\", Version: \"0.1.0\"}, \"clipper-0.1.0.tgz\", \"http://example.com/charts\", \"sha256:1234567890\"); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"unexpected error: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "context",
            "line": " \tdir, err := ioutil.TempDir(\"\", \"helm-tmp\")"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\tt.Fatal(err)"
          }
        ]
      },
      {
        "file": "pkg/repo/testdata/chartmuseum-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 364e42c54..349a529aa 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/testdata/chartmuseum-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/testdata/chartmuseum-index.yaml"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/nginx-0.1.0.tgz"
          },
          {
            "type": "context",
            "line": "       name: nginx"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   alpine:"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/alpine-1.0.0.tgz"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   chartWithNoURL:"
          },
          {
            "type": "context",
            "line": "     - name: chartWithNoURL"
          },
          {
            "type": "context",
            "line": "       description: string"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/repo/testdata/local-index-annotations.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index d429aa11c..833ab854b 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/testdata/local-index-annotations.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/testdata/local-index-annotations.yaml"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/nginx-0.1.0.tgz"
          },
          {
            "type": "context",
            "line": "       name: nginx"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   alpine:"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/alpine-1.0.0.tgz"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   chartWithNoURL:"
          },
          {
            "type": "context",
            "line": "     - name: chartWithNoURL"
          },
          {
            "type": "context",
            "line": "       description: string"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": " annotations:"
          },
          {
            "type": "context",
            "line": "   helm.sh/test: foo bar"
          }
        ]
      },
      {
        "file": "pkg/repo/testdata/local-index-unordered.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index 3af72dfd1..cdfaa7f24 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/testdata/local-index-unordered.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/testdata/local-index-unordered.yaml"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/nginx-0.2.0.tgz"
          },
          {
            "type": "context",
            "line": "       name: nginx"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   alpine:"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/alpine-1.0.0.tgz"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   chartWithNoURL:"
          },
          {
            "type": "context",
            "line": "     - name: chartWithNoURL"
          },
          {
            "type": "context",
            "line": "       description: string"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      },
      {
        "file": "pkg/repo/testdata/local-index.yaml",
        "changes": [
          {
            "type": "context",
            "line": "index f8fa32bb2..d61f40dda 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/repo/testdata/local-index.yaml"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/repo/testdata/local-index.yaml"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/nginx-0.1.0.tgz"
          },
          {
            "type": "context",
            "line": "       name: nginx"
          },
          {
            "type": "context",
            "line": "         - popular"
          },
          {
            "type": "context",
            "line": "         - web server"
          },
          {
            "type": "context",
            "line": "         - proxy"
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   alpine:"
          },
          {
            "type": "context",
            "line": "     - urls:"
          },
          {
            "type": "context",
            "line": "         - https://charts.helm.sh/stable/alpine-1.0.0.tgz"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          },
          {
            "type": "context",
            "line": "   chartWithNoURL:"
          },
          {
            "type": "context",
            "line": "     - name: chartWithNoURL"
          },
          {
            "type": "context",
            "line": "       description: string"
          },
          {
            "type": "context",
            "line": "         - small"
          },
          {
            "type": "context",
            "line": "         - sumtin"
          },
          {
            "type": "context",
            "line": "       digest: \"sha256:1234567890abcdef\""
          },
          {
            "type": "add",
            "line": "      apiVersion: v2"
          }
        ]
      }
    ]
  },
  {
    "commit": "7278714133422cee46c32c7523f81ec2cecad9e2",
    "files": [
      {
        "file": "src/amf/gmm-sm.c",
        "changes": [
          {
            "type": "context",
            "line": "index 9ce0a8952..d94096af5 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/amf/gmm-sm.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/amf/gmm-sm.c"
          },
          {
            "type": "context",
            "line": "             END"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        CASE(OGS_SBI_SERVICE_NAME_NUDM_UECM)"
          },
          {
            "type": "add",
            "line": "            if (sbi_message->res_status != OGS_SBI_HTTP_STATUS_CREATED &&"
          },
          {
            "type": "add",
            "line": "                sbi_message->res_status != OGS_SBI_HTTP_STATUS_NO_CONTENT &&"
          },
          {
            "type": "add",
            "line": "                sbi_message->res_status != OGS_SBI_HTTP_STATUS_OK) {"
          },
          {
            "type": "add",
            "line": "                ogs_error(\"[%s] HTTP response error [%d]\","
          },
          {
            "type": "add",
            "line": "                        amf_ue->supi, sbi_message->res_status);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            SWITCH(sbi_message->h.resource.component[1])"
          },
          {
            "type": "add",
            "line": "            CASE(OGS_SBI_RESOURCE_NAME_REGISTRATIONS)"
          },
          {
            "type": "add",
            "line": "                SWITCH(sbi_message->h.method)"
          },
          {
            "type": "add",
            "line": "                CASE(OGS_SBI_HTTP_METHOD_PUT)"
          },
          {
            "type": "add",
            "line": "                    /*"
          },
          {
            "type": "add",
            "line": "                     * Issue #2733"
          },
          {
            "type": "add",
            "line": "                     *"
          },
          {
            "type": "add",
            "line": "                     * We need to ignore this message in this state."
          },
          {
            "type": "add",
            "line": "                     */"
          },
          {
            "type": "add",
            "line": "                    ogs_error(\"[%s] Ignore SBI message\", amf_ue->supi);"
          },
          {
            "type": "add",
            "line": "                    break;"
          },
          {
            "type": "add",
            "line": "                DEFAULT"
          },
          {
            "type": "add",
            "line": "                    ogs_error(\"[%s] Invalid HTTP method [%s]\","
          },
          {
            "type": "add",
            "line": "                            amf_ue->suci, sbi_message->h.method);"
          },
          {
            "type": "add",
            "line": "                    ogs_assert_if_reached();"
          },
          {
            "type": "add",
            "line": "                END"
          },
          {
            "type": "add",
            "line": "                break;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            DEFAULT"
          },
          {
            "type": "add",
            "line": "                ogs_error(\"Invalid resource name [%s]\","
          },
          {
            "type": "add",
            "line": "                        sbi_message->h.resource.component[1]);"
          },
          {
            "type": "add",
            "line": "                ogs_assert_if_reached();"
          },
          {
            "type": "add",
            "line": "            END"
          },
          {
            "type": "add",
            "line": "            break;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         DEFAULT"
          },
          {
            "type": "context",
            "line": "             ogs_error(\"Invalid service name [%s]\", sbi_message->h.service.name);"
          },
          {
            "type": "context",
            "line": "             ogs_assert_if_reached();"
          }
        ]
      }
    ]
  },
  {
    "commit": "7757f1f2d2330d49a3ebb40194f5ec4c8eaf8186",
    "files": [
      {
        "file": "application/transaction.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index b83230a61..053c71891 100644"
          },
          {
            "type": "context",
            "line": "--- a/application/transaction.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/application/transaction.class.inc.php"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " class privUITransactionFile"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "add",
            "line": "\t/**"
          },
          {
            "type": "add",
            "line": "\t * @return int"
          },
          {
            "type": "add",
            "line": "\t * @throws \\SecurityException if no connected user"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @since 2.6.5 2.7.6 3.0.0 N°4289 method creation"
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tprivate static function GetCurrentUserId() {"
          },
          {
            "type": "add",
            "line": "\t\t$iCurrentUserId = UserRights::GetConnectedUserId();"
          },
          {
            "type": "add",
            "line": "\t\tif ('' === $iCurrentUserId) {"
          },
          {
            "type": "add",
            "line": "\t\t\tthrow new SecurityException('Cannot creation transaction_id when no user logged');"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\treturn $iCurrentUserId;"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * Create a new transaction id, store it in the session and return its id"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @param void"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @return int The identifier of the new transaction"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @throws \\SecurityException"
          },
          {
            "type": "add",
            "line": "\t * @throws \\Exception"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @since 2.6.5 2.7.6 3.0.0 security hardening + throws SecurityException if no user logged"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function GetNewTransactionId()"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\t\t\tthrow new Exception('Failed to create the directory \"'.APPROOT.'data/transactions\". Ajust the rights on the parent directory or let an administrator create the transactions directory and give the web sever enough rights to write into it.');"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif (!is_writable(APPROOT.'data/transactions'))"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\tthrow new Exception('The directory \"'.APPROOT.'data/transactions\" must be writable to the application.');"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t$iCurrentUserId = static::GetCurrentUserId();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tself::CleanupOldTransactions();"
          },
          {
            "type": "delete",
            "line": "\t\t$id = basename(tempnam(APPROOT.'data/transactions', static::GetUserPrefix()));"
          },
          {
            "type": "delete",
            "line": "\t\tself::Info('GetNewTransactionId: Created transaction: '.$id);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\treturn (string)$id;"
          },
          {
            "type": "add",
            "line": "\t\t$sTransactionIdFullPath = tempnam(APPROOT.'data/transactions', static::GetUserPrefix());"
          },
          {
            "type": "add",
            "line": "\t\tfile_put_contents($sTransactionIdFullPath, $iCurrentUserId, LOCK_EX);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t$sTransactionIdFileName = basename($sTransactionIdFullPath);"
          },
          {
            "type": "add",
            "line": "\t\tself::Info('GetNewTransactionId: Created transaction: '.$sTransactionIdFileName);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\treturn $sTransactionIdFileName;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * Check whether a transaction is valid or not and (optionally) remove the valid transaction from"
          },
          {
            "type": "context",
            "line": " \t * the session so that another call to IsTransactionValid for the same transaction id"
          },
          {
            "type": "context",
            "line": " \t * will return false"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @param int $id Identifier of the transaction, as returned by GetNewTransactionId"
          },
          {
            "type": "context",
            "line": " \t * @param bool $bRemoveTransaction True if the transaction must be removed"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @return bool True if the transaction is valid, false otherwise"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @since 2.6.5 2.7.6 3.0.0 N°4289 security hardening"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function IsTransactionValid($id, $bRemoveTransaction = true)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tclearstatcache(true, $sFilepath);"
          },
          {
            "type": "context",
            "line": " \t\t$bResult = file_exists($sFilepath);"
          },
          {
            "type": "delete",
            "line": "\t\tif ($bResult)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif (false === $bResult) {"
          },
          {
            "type": "add",
            "line": "\t\t\tself::Info(\"IsTransactionValid: Transaction '$id' not found. Pending transactions:\\n\".implode(\"\\n\", self::GetPendingTransactions()));"
          },
          {
            "type": "add",
            "line": "\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t$iCurrentUserId = static::GetCurrentUserId();"
          },
          {
            "type": "add",
            "line": "\t\t$sTransactionIdUserId = file_get_contents($sFilepath);"
          },
          {
            "type": "add",
            "line": "\t\tif ($iCurrentUserId != $sTransactionIdUserId) {"
          },
          {
            "type": "add",
            "line": "\t\t\tself::Info(\"IsTransactionValid: Transaction '$id' not existing for current user. Pending transactions:\\n\".implode(\"\\n\", self::GetPendingTransactions()));"
          },
          {
            "type": "add",
            "line": "\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif ($bRemoveTransaction)"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\tif ($bRemoveTransaction)"
          },
          {
            "type": "add",
            "line": "\t\t\t$bResult = @unlink($sFilepath);"
          },
          {
            "type": "add",
            "line": "\t\t\tif (!$bResult)"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$bResult = @unlink($sFilepath);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (!$bResult)"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tself::Error('IsTransactionValid: FAILED to remove transaction '.$id);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\t\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tself::Info('IsTransactionValid: OK. Removed transaction: '.$id);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\t\tself::Error('IsTransactionValid: FAILED to remove transaction '.$id);"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t\telse"
          },
          {
            "type": "add",
            "line": "\t\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\t\tself::Info('IsTransactionValid: OK. Removed transaction: '.$id);"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "delete",
            "line": "\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\tself::Info(\"IsTransactionValid: Transaction '$id' not found. Pending transactions for this user:\\n\".implode(\"\\n\", self::GetPendingTransactions()));"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\treturn $bResult;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t * Removes the transaction specified by its id"
          },
          {
            "type": "context",
            "line": " \t * @param int $id The Identifier (as returned by GetNewTransactionId) of the transaction to be removed."
          },
          {
            "type": "context",
            "line": " \t * @return bool true if the token can be removed"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @since 2.6.5 2.7.6 3.0.0 N°4289 security hardening"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function RemoveTransaction($id)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\t$sFilepath = APPROOT.'data/transactions/'.$id;"
          },
          {
            "type": "delete",
            "line": "\t\tclearstatcache(true, $sFilepath);"
          },
          {
            "type": "delete",
            "line": "\t\tif (!file_exists($sFilepath)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t$bSuccess = false;"
          },
          {
            "type": "delete",
            "line": "\t\t\tself::Error(\"RemoveTransaction: Transaction '$id' not found. Pending transactions for this user:\\n\""
          },
          {
            "type": "add",
            "line": "\t\t/** @noinspection PhpRedundantOptionalArgumentInspection */"
          },
          {
            "type": "add",
            "line": "\t\t$bResult = static::IsTransactionValid($id, true);"
          },
          {
            "type": "add",
            "line": "\t\tif (false === $bResult) {"
          },
          {
            "type": "add",
            "line": "\t\t\tself::Error(\"RemoveTransaction: Transaction '$id' is invalid. Pending transactions:\\n\""
          },
          {
            "type": "context",
            "line": " \t\t\t\t.implode(\"\\n\", self::GetPendingTransactions()));"
          },
          {
            "type": "delete",
            "line": "\t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\t$bSuccess = @unlink($sFilepath);"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (!$bSuccess) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tself::Error('RemoveTransaction: FAILED to remove transaction '.$id);"
          },
          {
            "type": "delete",
            "line": "\t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\tself::Info('RemoveTransaction: OK '.$id);"
          },
          {
            "type": "add",
            "line": "\t\t\treturn false;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\treturn $bSuccess;"
          },
          {
            "type": "add",
            "line": "\t\treturn true;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          }
        ]
      },
      {
        "file": "core/userrights.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index 12a936787..1819c0a9e 100644"
          },
          {
            "type": "context",
            "line": "--- a/core/userrights.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/core/userrights.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\treturn self::$m_oRealUser;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/**"
          },
          {
            "type": "add",
            "line": "\t * @return int|string ID of the connected user : if impersonate then use {@see m_oRealUser}, else {@see m_oUser}. If no user set then return ''"
          },
          {
            "type": "add",
            "line": "\t * @since 2.6.5 2.7.6 3.0.0 N°4289 method creation"
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tpublic static function GetConnectedUserId() {"
          },
          {
            "type": "add",
            "line": "\t\tif (false === is_null(static::$m_oRealUser)) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn static::$m_oRealUser->GetKey();"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tif (false === is_null(static::$m_oUser)) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn static::$m_oUser->GetKey();"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\treturn '';"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tpublic static function GetRealUserId()"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tif (is_null(self::$m_oRealUser))"
          },
          {
            "type": "context",
            "line": " \t\telseif ((self::$m_oUser !== null) && ($oUser->GetKey() == self::$m_oUser->GetKey()))"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\t// Data about the current user can be found into the session data"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (array_key_exists('profile_list', $_SESSION))"
          },
          {
            "type": "add",
            "line": "\t\t\tif ((false === utils::IsModeCLI()) && array_key_exists('profile_list', $_SESSION))"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$aProfiles = $_SESSION['profile_list'];"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          }
        ]
      },
      {
        "file": "test/application/privUITransactionFileTest.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..c3df443cc"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/test/application/privUITransactionFileTest.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "class privUITransactionFileTest extends \\Combodo\\iTop\\Test\\UnitTest\\ItopDataTestCase"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "\tconst USER_TEST_LOGIN = 'support_test_privUITransaction';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tpublic function testIsTransactionValid() {"
          },
          {
            "type": "add",
            "line": "\t\t$this->CreateUser(static::USER_TEST_LOGIN, 5); // profile:5 is \"Support agent\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// create token in the support user context"
          },
          {
            "type": "add",
            "line": "\t\tUserRights::Login(self::USER_TEST_LOGIN);"
          },
          {
            "type": "add",
            "line": "\t\t$sTransactionIdUserSupport = privUITransactionFile::GetNewTransactionId();"
          },
          {
            "type": "add",
            "line": "\t\t$bResult = privUITransactionFile::IsTransactionValid($sTransactionIdUserSupport, false);"
          },
          {
            "type": "add",
            "line": "\t\t$this->assertTrue($bResult, 'Token created by support user must be valid in the support user context');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// test token in the admin user context"
          },
          {
            "type": "add",
            "line": "\t\tUserRights::Login('admin');"
          },
          {
            "type": "add",
            "line": "\t\t$bResult = privUITransactionFile::IsTransactionValid($sTransactionIdUserSupport, false);"
          },
          {
            "type": "add",
            "line": "\t\t$this->assertFalse($bResult, 'Token created by support user must be invalid in the admin user context');"
          },
          {
            "type": "add",
            "line": "\t\t$bResult = privUITransactionFile::RemoveTransaction($sTransactionIdUserSupport);"
          },
          {
            "type": "add",
            "line": "\t\t$this->assertFalse($bResult, 'Token created by support user cannot be removed in the admin user context');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// test other methods in the support user context"
          },
          {
            "type": "add",
            "line": "\t\tUserRights::Login(self::USER_TEST_LOGIN);"
          },
          {
            "type": "add",
            "line": "\t\t$bResult = privUITransactionFile::RemoveTransaction($sTransactionIdUserSupport);"
          },
          {
            "type": "add",
            "line": "\t\t$this->assertTrue($bResult, 'Token created by support user must be removed in the support user context');"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      }
    ]
  },
  {
    "commit": "780bd0e8fbf2d36ada52edb769477e0a4edae580",
    "files": [
      {
        "file": "flask_appbuilder/security/manager.py",
        "changes": [
          {
            "type": "context",
            "line": "index f837e5c4..7154dc50 100644"
          },
          {
            "type": "context",
            "line": "--- a/flask_appbuilder/security/manager.py"
          },
          {
            "type": "context",
            "line": "+++ b/flask_appbuilder/security/manager.py"
          },
          {
            "type": "context",
            "line": "         if user is None:"
          },
          {
            "type": "context",
            "line": "             user = self.find_user(email=username)"
          },
          {
            "type": "context",
            "line": "         if user is None or (not user.is_active):"
          },
          {
            "type": "add",
            "line": "            # Balance failure and success"
          },
          {
            "type": "add",
            "line": "            check_password_hash("
          },
          {
            "type": "add",
            "line": "                \"pbkdf2:sha256:150000$Z3t6fmj2$22da622d94a1f8118\""
          },
          {
            "type": "add",
            "line": "                \"c0976a03d2f18f680bfff877c9a965db9eedc51bc0be87c\","
          },
          {
            "type": "add",
            "line": "                \"password\","
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "context",
            "line": "             log.info(LOGMSG_WAR_SEC_LOGIN_FAILED.format(username))"
          },
          {
            "type": "context",
            "line": "             return None"
          },
          {
            "type": "context",
            "line": "         elif check_password_hash(user.password, password):"
          }
        ]
      }
    ]
  },
  {
    "commit": "7c4cf3137f45f1541f09f2f6a7f8850cd3a2eaee",
    "files": [
      {
        "file": "changes/4959.security",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..ee836c233"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/changes/4959.security"
          },
          {
            "type": "add",
            "line": "Enforce authentication and object permissions on DB file storage views (https://github.com/nautobot/nautobot/security/advisories/GHSA-75mc-3pjc-727q)."
          }
        ]
      },
      {
        "file": "nautobot/core/tests/test_views.py",
        "changes": [
          {
            "type": "context",
            "line": "index d95c0e19c..9527e1032 100644"
          },
          {
            "type": "context",
            "line": "--- a/nautobot/core/tests/test_views.py"
          },
          {
            "type": "context",
            "line": "+++ b/nautobot/core/tests/test_views.py"
          },
          {
            "type": "context",
            "line": " from unittest import mock"
          },
          {
            "type": "context",
            "line": " import urllib.parse"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "from django.contrib.contenttypes.models import ContentType"
          },
          {
            "type": "add",
            "line": "from django.core.files.uploadedfile import SimpleUploadedFile"
          },
          {
            "type": "context",
            "line": " from django.test import override_settings"
          },
          {
            "type": "context",
            "line": " from django.test.utils import override_script_prefix"
          },
          {
            "type": "context",
            "line": " from django.urls import get_script_prefix, reverse"
          },
          {
            "type": "context",
            "line": " from prometheus_client.parser import text_string_to_metric_families"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "from nautobot.extras.models import FileProxy"
          },
          {
            "type": "context",
            "line": " from nautobot.extras.registry import registry"
          },
          {
            "type": "add",
            "line": "from nautobot.users.models import ObjectPermission"
          },
          {
            "type": "add",
            "line": "from nautobot.utilities.permissions import get_permission_for_model"
          },
          {
            "type": "context",
            "line": " from nautobot.utilities.testing import TestCase"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         self.assertNotContains(response, \"Network to Code\", status_code=500)"
          },
          {
            "type": "context",
            "line": "         response_content = response.content.decode(response.charset)"
          },
          {
            "type": "context",
            "line": "         self.assertInHTML(\"Hello world!\", response_content)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class DBFileStorageViewTestCase(TestCase):"
          },
          {
            "type": "add",
            "line": "    \"\"\"Test authentication/permission enforcement for django_db_file_storage views.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def setUp(self):"
          },
          {
            "type": "add",
            "line": "        super().setUp()"
          },
          {
            "type": "add",
            "line": "        self.test_file_1 = SimpleUploadedFile(name=\"test_file_1.txt\", content=b\"I am content.\\n\")"
          },
          {
            "type": "add",
            "line": "        self.file_proxy_1 = FileProxy.objects.create(name=self.test_file_1.name, file=self.test_file_1)"
          },
          {
            "type": "add",
            "line": "        self.test_file_2 = SimpleUploadedFile(name=\"test_file_2.txt\", content=b\"I am content.\\n\")"
          },
          {
            "type": "add",
            "line": "        self.file_proxy_2 = FileProxy.objects.create(name=self.test_file_2.name, file=self.test_file_2)"
          },
          {
            "type": "add",
            "line": "        self.urls = ["
          },
          {
            "type": "add",
            "line": "            f\"{reverse('db_file_storage.download_file')}?name={self.file_proxy_1.file.name}\","
          },
          {
            "type": "add",
            "line": "            f\"{reverse('db_file_storage.get_file')}?name={self.file_proxy_1.file.name}\","
          },
          {
            "type": "add",
            "line": "        ]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_get_file_anonymous(self):"
          },
          {
            "type": "add",
            "line": "        self.client.logout()"
          },
          {
            "type": "add",
            "line": "        for url in self.urls:"
          },
          {
            "type": "add",
            "line": "            with self.subTest(url):"
          },
          {
            "type": "add",
            "line": "                response = self.client.get(url)"
          },
          {
            "type": "add",
            "line": "                self.assertHttpStatus(response, 403)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_get_file_without_permission(self):"
          },
          {
            "type": "add",
            "line": "        for url in self.urls:"
          },
          {
            "type": "add",
            "line": "            with self.subTest(url):"
          },
          {
            "type": "add",
            "line": "                response = self.client.get(url)"
          },
          {
            "type": "add",
            "line": "                self.assertHttpStatus(response, 403)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_get_object_with_permission(self):"
          },
          {
            "type": "add",
            "line": "        self.add_permissions(get_permission_for_model(FileProxy, \"view\"))"
          },
          {
            "type": "add",
            "line": "        for url in self.urls:"
          },
          {
            "type": "add",
            "line": "            with self.subTest(url):"
          },
          {
            "type": "add",
            "line": "                response = self.client.get(url)"
          },
          {
            "type": "add",
            "line": "                self.assertHttpStatus(response, 200)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_get_object_with_constrained_permission(self):"
          },
          {
            "type": "add",
            "line": "        obj_perm = ObjectPermission("
          },
          {
            "type": "add",
            "line": "            name=\"Test permission\","
          },
          {
            "type": "add",
            "line": "            constraints={\"pk\": self.file_proxy_1.pk},"
          },
          {
            "type": "add",
            "line": "            actions=[\"view\"],"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        obj_perm.save()"
          },
          {
            "type": "add",
            "line": "        obj_perm.users.add(self.user)"
          },
          {
            "type": "add",
            "line": "        obj_perm.object_types.add(ContentType.objects.get_for_model(FileProxy))"
          },
          {
            "type": "add",
            "line": "        for url in self.urls:"
          },
          {
            "type": "add",
            "line": "            with self.subTest(url):"
          },
          {
            "type": "add",
            "line": "                response = self.client.get(url)"
          },
          {
            "type": "add",
            "line": "                self.assertHttpStatus(response, 200)"
          },
          {
            "type": "add",
            "line": "        for url in ["
          },
          {
            "type": "add",
            "line": "            f\"{reverse('db_file_storage.download_file')}?name={self.file_proxy_2.file.name}\","
          },
          {
            "type": "add",
            "line": "            f\"{reverse('db_file_storage.get_file')}?name={self.file_proxy_2.file.name}\","
          },
          {
            "type": "add",
            "line": "        ]:"
          },
          {
            "type": "add",
            "line": "            with self.subTest(url):"
          },
          {
            "type": "add",
            "line": "                response = self.client.get(url)"
          },
          {
            "type": "add",
            "line": "                self.assertHttpStatus(response, 404)"
          }
        ]
      },
      {
        "file": "nautobot/core/urls.py",
        "changes": [
          {
            "type": "context",
            "line": "index c8d5b70a1..347be5024 100644"
          },
          {
            "type": "context",
            "line": "--- a/nautobot/core/urls.py"
          },
          {
            "type": "context",
            "line": "+++ b/nautobot/core/urls.py"
          },
          {
            "type": "context",
            "line": " from django.conf import settings"
          },
          {
            "type": "delete",
            "line": "from django.conf.urls import include"
          },
          {
            "type": "add",
            "line": "from django.conf.urls import include, url"
          },
          {
            "type": "context",
            "line": " from django.urls import path"
          },
          {
            "type": "context",
            "line": " from django.views.static import serve"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from nautobot.core.views import CustomGraphQLView, HomeView, StaticMediaFailureView, SearchView, nautobot_metrics_view"
          },
          {
            "type": "add",
            "line": "from nautobot.core.views import ("
          },
          {
            "type": "add",
            "line": "    CustomGraphQLView,"
          },
          {
            "type": "add",
            "line": "    HomeView,"
          },
          {
            "type": "add",
            "line": "    StaticMediaFailureView,"
          },
          {
            "type": "add",
            "line": "    SearchView,"
          },
          {
            "type": "add",
            "line": "    nautobot_metrics_view,"
          },
          {
            "type": "add",
            "line": "    get_file_with_authorization,"
          },
          {
            "type": "add",
            "line": ")"
          },
          {
            "type": "context",
            "line": " from nautobot.extras.plugins.urls import ("
          },
          {
            "type": "context",
            "line": "     plugin_admin_patterns,"
          },
          {
            "type": "context",
            "line": "     plugin_patterns,"
          },
          {
            "type": "context",
            "line": "     # django-health-check"
          },
          {
            "type": "context",
            "line": "     path(r\"health/\", include(\"health_check.urls\")),"
          },
          {
            "type": "context",
            "line": "     # FileProxy attachments download/get URLs used in admin views only"
          },
          {
            "type": "delete",
            "line": "    path(\"files/\", include(\"db_file_storage.urls\")),"
          },
          {
            "type": "add",
            "line": "    url("
          },
          {
            "type": "add",
            "line": "        \"files/download/\","
          },
          {
            "type": "add",
            "line": "        get_file_with_authorization,"
          },
          {
            "type": "add",
            "line": "        {\"add_attachment_headers\": True},"
          },
          {
            "type": "add",
            "line": "        name=\"db_file_storage.download_file\","
          },
          {
            "type": "add",
            "line": "    ),"
          },
          {
            "type": "add",
            "line": "    url("
          },
          {
            "type": "add",
            "line": "        \"files/get/\","
          },
          {
            "type": "add",
            "line": "        get_file_with_authorization,"
          },
          {
            "type": "add",
            "line": "        {\"add_attachment_headers\": False},"
          },
          {
            "type": "add",
            "line": "        name=\"db_file_storage.get_file\","
          },
          {
            "type": "add",
            "line": "    ),"
          },
          {
            "type": "context",
            "line": " ]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "nautobot/core/views/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index 3a3c42b62..761374f61 100644"
          },
          {
            "type": "context",
            "line": "--- a/nautobot/core/views/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/nautobot/core/views/__init__.py"
          },
          {
            "type": "context",
            "line": " import sys"
          },
          {
            "type": "context",
            "line": " import time"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "from db_file_storage.views import get_file"
          },
          {
            "type": "context",
            "line": " import prometheus_client"
          },
          {
            "type": "context",
            "line": " from django.conf import settings"
          },
          {
            "type": "add",
            "line": "from django.contrib.auth.decorators import permission_required"
          },
          {
            "type": "context",
            "line": " from django.contrib.auth.mixins import AccessMixin"
          },
          {
            "type": "context",
            "line": " from django.http import HttpResponseServerError, JsonResponse, HttpResponseForbidden, HttpResponse"
          },
          {
            "type": "delete",
            "line": "from django.shortcuts import redirect, render"
          },
          {
            "type": "add",
            "line": "from django.shortcuts import get_object_or_404, redirect, render"
          },
          {
            "type": "context",
            "line": " from django.template import loader, RequestContext, Template"
          },
          {
            "type": "context",
            "line": " from django.template.exceptions import TemplateDoesNotExist"
          },
          {
            "type": "context",
            "line": " from django.urls import reverse"
          },
          {
            "type": "context",
            "line": " from nautobot.core.constants import SEARCH_MAX_RESULTS, SEARCH_TYPES"
          },
          {
            "type": "context",
            "line": " from nautobot.core.forms import SearchForm"
          },
          {
            "type": "context",
            "line": " from nautobot.core.releases import get_latest_release"
          },
          {
            "type": "delete",
            "line": "from nautobot.extras.models import GraphQLQuery"
          },
          {
            "type": "add",
            "line": "from nautobot.extras.models import GraphQLQuery, FileProxy"
          },
          {
            "type": "context",
            "line": " from nautobot.extras.registry import registry"
          },
          {
            "type": "context",
            "line": " from nautobot.extras.forms import GraphQLQueryForm"
          },
          {
            "type": "context",
            "line": " from nautobot.utilities.config import get_settings_or_config"
          },
          {
            "type": "add",
            "line": "from nautobot.utilities.permissions import get_permission_for_model"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class HomeView(AccessMixin, TemplateView):"
          },
          {
            "type": "context",
            "line": "         pass"
          },
          {
            "type": "context",
            "line": "     metrics_page = prometheus_client.generate_latest(prometheus_registry)"
          },
          {
            "type": "context",
            "line": "     return HttpResponse(metrics_page, content_type=prometheus_client.CONTENT_TYPE_LATEST)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "@permission_required(get_permission_for_model(FileProxy, \"view\"), raise_exception=True)"
          },
          {
            "type": "add",
            "line": "def get_file_with_authorization(request, *args, **kwargs):"
          },
          {
            "type": "add",
            "line": "    \"\"\"Patch db_file_storage view with authentication.\"\"\""
          },
          {
            "type": "add",
            "line": "    # Make sure user has permissions"
          },
          {
            "type": "add",
            "line": "    queryset = FileProxy.objects.restrict(request.user, \"view\")"
          },
          {
            "type": "add",
            "line": "    get_object_or_404(queryset, file=request.GET.get(\"name\"))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return get_file(request, *args, **kwargs)"
          }
        ]
      }
    ]
  },
  {
    "commit": "7d484864fe91ff79c478f57e7ddb1235d701921e",
    "files": [
      {
        "file": "liquote_rewriter.rb",
        "changes": [
          {
            "type": "context",
            "line": "index a316b81ca2..5a45d580d6 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/quote_rewriter.rb"
          },
          {
            "type": "context",
            "line": "+++ b/lib/quote_rewriter.rb"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def rewrite_raw_username(raw, old_username, new_username)"
          },
          {
            "type": "add",
            "line": "    escaped_old_username = Regexp.escape(old_username)"
          },
          {
            "type": "context",
            "line": "     pattern ="
          },
          {
            "type": "context",
            "line": "       Regexp.union("
          },
          {
            "type": "delete",
            "line": "        /(?<pre>\\[quote\\s*=\\s*[\"'']?.*username:)#{old_username}(?<post>\\,?[^\\]]*\\])/i,"
          },
          {
            "type": "delete",
            "line": "        /(?<pre>\\[quote\\s*=\\s*[\"'']?)#{old_username}(?<post>\\,?[^\\]]*\\])/i,"
          },
          {
            "type": "add",
            "line": "        /(?<pre>\\[quote\\s*=\\s*[\"'']?.*username:)#{escaped_old_username}(?<post>\\,?[^\\]]*\\])/i,"
          },
          {
            "type": "add",
            "line": "        /(?<pre>\\[quote\\s*=\\s*[\"'']?)#{escaped_old_username}(?<post>\\,?[^\\]]*\\])/i,"
          },
          {
            "type": "context",
            "line": "       )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     raw.gsub(pattern, \"\\\\k<pre>#{new_username}\\\\k<post>\")"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def rewrite_cooked_username(cooked, old_username, new_username, avatar_img)"
          },
          {
            "type": "delete",
            "line": "    pattern = /(?<=\\s)#{PrettyText::Helpers.format_username(old_username)}(?=:)/i"
          },
          {
            "type": "add",
            "line": "    formatted_old_username = PrettyText::Helpers.format_username(old_username)"
          },
          {
            "type": "add",
            "line": "    escaped_old_username = Regexp.escape(formatted_old_username)"
          },
          {
            "type": "add",
            "line": "    pattern = /(?<=\\s)#{escaped_old_username}(?=:)/i"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     cooked"
          },
          {
            "type": "context",
            "line": "       .css(\"aside.quote\")"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def rewrite_raw_display_name(raw, old_display_name, new_display_name)"
          },
          {
            "type": "delete",
            "line": "    pattern = /(?<pre>\\[quote\\s*=\\s*[\"'']?)#{old_display_name}(?<post>\\,[^\\]]*username[^\\]]*\\])/i"
          },
          {
            "type": "add",
            "line": "    escaped_old_display_name = Regexp.escape(old_display_name)"
          },
          {
            "type": "add",
            "line": "    pattern ="
          },
          {
            "type": "add",
            "line": "      /(?<pre>\\[quote\\s*=\\s*[\"'']?)#{escaped_old_display_name}(?<post>\\,[^\\]]*username[^\\]]*\\])/i"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     raw.gsub(pattern, \"\\\\k<pre>#{new_display_name}\\\\k<post>\")"
          },
          {
            "type": "context",
            "line": "   end"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   def rewrite_cooked_display_name(cooked, old_display_name, new_display_name)"
          },
          {
            "type": "delete",
            "line": "    pattern = /(?<=\\s)#{PrettyText::Helpers.format_username(old_display_name)}(?=:)/i"
          },
          {
            "type": "add",
            "line": "    formatted_old_display_name = PrettyText::Helpers.format_username(old_display_name)"
          },
          {
            "type": "add",
            "line": "    escaped_old_display_name = Regexp.escape(formatted_old_display_name)"
          },
          {
            "type": "add",
            "line": "    pattern = /(?<=\\s)#{escaped_old_display_name}(?=:)/i"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     cooked"
          },
          {
            "type": "context",
            "line": "       .css(\"aside.quote\")"
          }
        ]
      },
      {
        "file": "spec/jobs/change_display_name_spec.rb",
        "changes": [
          {
            "type": "context",
            "line": "index e18db2cf34..bb87afee4a 100644"
          },
          {
            "type": "context",
            "line": "--- a/spec/jobs/change_display_name_spec.rb"
          },
          {
            "type": "context",
            "line": "+++ b/spec/jobs/change_display_name_spec.rb"
          },
          {
            "type": "context",
            "line": " RSpec.describe Jobs::ChangeDisplayName do"
          },
          {
            "type": "context",
            "line": "   before { stub_image_size }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  let(:user) { Fabricate(:user, username: \"codinghorror\", name: \"Jeff\") }"
          },
          {
            "type": "add",
            "line": "  let(:username) { \"codinghorror\" }"
          },
          {
            "type": "add",
            "line": "  let(:old_display_name) { \"|| Jeff ||\" }"
          },
          {
            "type": "add",
            "line": "  let(:new_display_name) { \"|| Mr. Atwood ||\" }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  let(:user) { Fabricate(:user, username: username, name: old_display_name) }"
          },
          {
            "type": "context",
            "line": "   let(:topic) { Fabricate(:topic, user: user) }"
          },
          {
            "type": "context",
            "line": "   let!(:post) { create_post(post_attributes.merge(topic_id: topic.id)) }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   let(:avatar_url) { user.avatar_template_url.gsub(\"{size}\", \"48\") }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   let(:post_attributes) { { raw: <<~RAW } }"
          },
          {
            "type": "delete",
            "line": "    [quote=\"Jeff, post:1, topic:#{quoted_post.topic.id}, username:codinghorror\"]"
          },
          {
            "type": "add",
            "line": "    [quote=\"#{old_display_name}, post:1, topic:#{quoted_post.topic.id}, username:#{username}\"]"
          },
          {
            "type": "context",
            "line": "     quoted post"
          },
          {
            "type": "context",
            "line": "     [/quote]"
          },
          {
            "type": "context",
            "line": "   RAW"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   let(:revised_post_attributes) { { raw: <<~RAW } }"
          },
          {
            "type": "delete",
            "line": "    [quote=\"Jeff, post:1, topic:#{quoted_post.topic.id}, username:codinghorror\"]"
          },
          {
            "type": "add",
            "line": "    [quote=\"#{old_display_name}, post:1, topic:#{quoted_post.topic.id}, username:#{username}\"]"
          },
          {
            "type": "context",
            "line": "     quoted post"
          },
          {
            "type": "context",
            "line": "     [/quote]"
          },
          {
            "type": "context",
            "line": "     Forgot something."
          },
          {
            "type": "context",
            "line": "   RAW"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  let(:args) { { user_id: user.id, old_name: \"Jeff\", new_name: \"Mr. Atwood\" } }"
          },
          {
            "type": "add",
            "line": "  let(:args) { { user_id: user.id, old_name: old_display_name, new_name: new_display_name } }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   describe \"#execute\" do"
          },
          {
            "type": "context",
            "line": "     context \"when the renamed user has been quoted\" do"
          },
          {
            "type": "context",
            "line": "       it \"rewrites the raw quote display name\" do"
          },
          {
            "type": "context",
            "line": "         expect { described_class.new.execute(args) }.to change { post.reload.raw }.to(<<~RAW.strip)"
          },
          {
            "type": "delete",
            "line": "          [quote=\"Mr. Atwood, post:1, topic:#{quoted_post.topic.id}, username:codinghorror\"]"
          },
          {
            "type": "add",
            "line": "          [quote=\"#{new_display_name}, post:1, topic:#{quoted_post.topic.id}, username:#{username}\"]"
          },
          {
            "type": "context",
            "line": "           quoted post"
          },
          {
            "type": "context",
            "line": "           [/quote]"
          },
          {
            "type": "context",
            "line": "         RAW"
          },
          {
            "type": "context",
            "line": "       it \"rewrites the cooked quote display name\" do"
          },
          {
            "type": "context",
            "line": "         expect { described_class.new.execute(args) }.to change { post.reload.cooked }.to("
          },
          {
            "type": "context",
            "line": "           match_html(<<~HTML.strip),"
          },
          {
            "type": "delete",
            "line": "          <aside class=\"quote no-group\" data-username=\"codinghorror\" data-post=\"1\" data-topic=\"#{quoted_post.topic.id}\">"
          },
          {
            "type": "add",
            "line": "          <aside class=\"quote no-group\" data-username=\"#{username}\" data-post=\"1\" data-topic=\"#{quoted_post.topic.id}\">"
          },
          {
            "type": "context",
            "line": "           <div class=\"title\">"
          },
          {
            "type": "context",
            "line": "           <div class=\"quote-controls\"></div>"
          },
          {
            "type": "delete",
            "line": "          <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"#{avatar_url}\" class=\"avatar\"> Mr. Atwood:</div>"
          },
          {
            "type": "add",
            "line": "          <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"#{avatar_url}\" class=\"avatar\"> #{new_display_name}:</div>"
          },
          {
            "type": "context",
            "line": "           <blockquote>"
          },
          {
            "type": "context",
            "line": "           <p>quoted post</p>"
          },
          {
            "type": "context",
            "line": "           </blockquote>"
          },
          {
            "type": "context",
            "line": "         expect { described_class.new.execute(args) }.to change {"
          },
          {
            "type": "context",
            "line": "           post.reload.revisions[0].modifications[\"raw\"][0]"
          },
          {
            "type": "context",
            "line": "         }.to(<<~RAW.strip)"
          },
          {
            "type": "delete",
            "line": "          [quote=\"Mr. Atwood, post:1, topic:#{quoted_post.topic.id}, username:codinghorror\"]"
          },
          {
            "type": "add",
            "line": "          [quote=\"#{new_display_name}, post:1, topic:#{quoted_post.topic.id}, username:#{username}\"]"
          },
          {
            "type": "context",
            "line": "           quoted post"
          },
          {
            "type": "context",
            "line": "           [/quote]"
          },
          {
            "type": "context",
            "line": "           RAW"
          }
        ]
      }
    ]
  },
  {
    "commit": "7ef8cb2f232abdf59ec9c3c99a086a14b972bc56",
    "files": [
      {
        "file": "browser/net/ipfs_redirect_network_delegate_helper.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 9d7b21c9221..410cc26ebe0 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/net/ipfs_redirect_network_delegate_helper.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/net/ipfs_redirect_network_delegate_helper.cc"
          },
          {
            "type": "context",
            "line": " int OnBeforeURLRequest_IPFSRedirectWork("
          },
          {
            "type": "context",
            "line": "     const brave::ResponseCallback& next_callback,"
          },
          {
            "type": "context",
            "line": "     std::shared_ptr<brave::BraveRequestInfo> ctx) {"
          },
          {
            "type": "delete",
            "line": "  if (!ctx->browser_context || !brave::IsRegularProfile(ctx->browser_context))"
          },
          {
            "type": "add",
            "line": "  const bool has_ipfs_scheme = IsIPFSScheme(ctx->request_url);"
          },
          {
            "type": "add",
            "line": "  if (!ctx->browser_context) {"
          },
          {
            "type": "add",
            "line": "    // IPFS url translation depends on selected gateway."
          },
          {
            "type": "add",
            "line": "    // So we block IPFS requests if we don't have access to prefs."
          },
          {
            "type": "add",
            "line": "    if (has_ipfs_scheme) {"
          },
          {
            "type": "add",
            "line": "      ctx->blocked_by = brave::kOtherBlocked;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     return net::OK;"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   auto* prefs = user_prefs::UserPrefs::Get(ctx->browser_context);"
          },
          {
            "type": "delete",
            "line": "  if (IsIpfsResolveMethodDisabled(prefs)) {"
          },
          {
            "type": "add",
            "line": "  const bool ipfs_disabled = IsIpfsResolveMethodDisabled(prefs);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  if (ipfs_disabled || !brave::IsRegularProfile(ctx->browser_context)) {"
          },
          {
            "type": "add",
            "line": "    // Don't allow IPFS requests without translation of IPFS urls."
          },
          {
            "type": "add",
            "line": "    if (has_ipfs_scheme &&"
          },
          {
            "type": "add",
            "line": "        ctx->resource_type != blink::mojom::ResourceType::kMainFrame) {"
          },
          {
            "type": "add",
            "line": "      ctx->blocked_by = brave::kOtherBlocked;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     return net::OK;"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "browser/net/ipfs_redirect_network_delegate_helper_unittest.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 030d380cd05..b4bad3041ad 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/net/ipfs_redirect_network_delegate_helper_unittest.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/net/ipfs_redirect_network_delegate_helper_unittest.cc"
          },
          {
            "type": "context",
            "line": "             \"QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "add",
            "line": "       SubFrameRequestDisabledWhenIPFSDisabled) {"
          },
          {
            "type": "add",
            "line": "  profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod,"
          },
          {
            "type": "add",
            "line": "      static_cast<int>(IPFSResolveMethodTypes::IPFS_DISABLED));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  GURL url(\"ipfs://QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "add",
            "line": "  auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "  brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "  brave_request_info->browser_context = profile();"
          },
          {
            "type": "add",
            "line": "  int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork(brave::ResponseCallback(),"
          },
          {
            "type": "add",
            "line": "                                                     brave_request_info);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "add",
            "line": "       SubFrameRequestDisabledWhenIPFSDisabled_Incognito) {"
          },
          {
            "type": "add",
            "line": "  profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod, static_cast<int>(IPFSResolveMethodTypes::IPFS_LOCAL));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  GURL url(\"ipfs://QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "add",
            "line": "  auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "  brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "  brave_request_info->browser_context = profile()->GetOffTheRecordProfile("
          },
          {
            "type": "add",
            "line": "      Profile::OTRProfileID::CreateUnique(\"incognito\"), true);"
          },
          {
            "type": "add",
            "line": "  int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork(brave::ResponseCallback(),"
          },
          {
            "type": "add",
            "line": "                                                     brave_request_info);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "add",
            "line": "       SubFrameRequestDisabledWhen_NoContext) {"
          },
          {
            "type": "add",
            "line": "  profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod, static_cast<int>(IPFSResolveMethodTypes::IPFS_LOCAL));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  GURL url(\"ipfs://QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "add",
            "line": "  auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "  brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "  brave_request_info->browser_context = nullptr;"
          },
          {
            "type": "add",
            "line": "  int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork(brave::ResponseCallback(),"
          },
          {
            "type": "add",
            "line": "                                                     brave_request_info);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " TEST_F(IPFSRedirectNetworkDelegateHelperTest, TranslateIPFSURIIPFSScheme) {"
          },
          {
            "type": "context",
            "line": "   GURL url(\"ipfs://QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "context",
            "line": "   auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          }
        ]
      }
    ]
  },
  {
    "commit": "809e2d999e2c33e20e77f6bff30652d79c287542",
    "files": [
      {
        "file": "cmd/helm/load_plugins.go",
        "changes": [
          {
            "type": "context",
            "line": "index e4aac6c0f..83590210a 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/load_plugins.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/load_plugins.go"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tfound, err := plugin.FindPlugins(settings.PluginsDirectory)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\tfmt.Fprintf(os.Stderr, \"failed to load plugins: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t\tfmt.Fprintf(os.Stderr, \"failed to load plugins: %s\\n\", err)"
          },
          {
            "type": "context",
            "line": " \t\treturn"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "cmd/helm/plugin_install.go",
        "changes": [
          {
            "type": "context",
            "line": "index 183d3dc57..4e8ee327b 100644"
          },
          {
            "type": "context",
            "line": "--- a/cmd/helm/plugin_install.go"
          },
          {
            "type": "context",
            "line": "+++ b/cmd/helm/plugin_install.go"
          },
          {
            "type": "context",
            "line": " \t\"fmt\""
          },
          {
            "type": "context",
            "line": " \t\"io\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\"github.com/pkg/errors\""
          },
          {
            "type": "context",
            "line": " \t\"github.com/spf13/cobra\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"helm.sh/helm/v3/cmd/helm/require\""
          },
          {
            "type": "context",
            "line": " \tdebug(\"loading plugin from %s\", i.Path())"
          },
          {
            "type": "context",
            "line": " \tp, err := plugin.LoadDir(i.Path())"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\treturn err"
          },
          {
            "type": "add",
            "line": "\t\treturn errors.Wrap(err, \"plugin is installed but unusable\")"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif err := runHook(p, plugin.Install); err != nil {"
          }
        ]
      },
      {
        "file": "pkg/plugin/plugin.go",
        "changes": [
          {
            "type": "context",
            "line": "index caa34fbd3..9bac2244c 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/plugin/plugin.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/plugin.go"
          },
          {
            "type": "context",
            "line": " \t\"io/ioutil\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t\"path/filepath\""
          },
          {
            "type": "add",
            "line": "\t\"regexp\""
          },
          {
            "type": "context",
            "line": " \t\"runtime\""
          },
          {
            "type": "context",
            "line": " \t\"strings\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\"github.com/pkg/errors\""
          },
          {
            "type": "context",
            "line": " \t\"sigs.k8s.io/yaml\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\"helm.sh/helm/v3/pkg/cli\""
          },
          {
            "type": "context",
            "line": " \treturn main, baseArgs, nil"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// validPluginName is a regular expression that validates plugin names."
          },
          {
            "type": "add",
            "line": "//"
          },
          {
            "type": "add",
            "line": "// Plugin names can only contain the ASCII characters a-z, A-Z, 0-9, ​_​ and ​-."
          },
          {
            "type": "add",
            "line": "var validPluginName = regexp.MustCompile(\"^[A-Za-z0-9_-]+$\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// validatePluginData validates a plugin's YAML data."
          },
          {
            "type": "add",
            "line": "func validatePluginData(plug *Plugin, filepath string) error {"
          },
          {
            "type": "add",
            "line": "\tif !validPluginName.MatchString(plug.Metadata.Name) {"
          },
          {
            "type": "add",
            "line": "\t\treturn fmt.Errorf(\"invalid plugin name at %q\", filepath)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t// We could also validate SemVer, executable, and other fields should we so choose."
          },
          {
            "type": "add",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func detectDuplicates(plugs []*Plugin) error {"
          },
          {
            "type": "add",
            "line": "\tnames := map[string]string{}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tfor _, plug := range plugs {"
          },
          {
            "type": "add",
            "line": "\t\tif oldpath, ok := names[plug.Metadata.Name]; ok {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn fmt.Errorf("
          },
          {
            "type": "add",
            "line": "\t\t\t\t\"two plugins claim the name %q at %q and %q\","
          },
          {
            "type": "add",
            "line": "\t\t\t\tplug.Metadata.Name,"
          },
          {
            "type": "add",
            "line": "\t\t\t\toldpath,"
          },
          {
            "type": "add",
            "line": "\t\t\t\tplug.Dir,"
          },
          {
            "type": "add",
            "line": "\t\t\t)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\tnames[plug.Metadata.Name] = plug.Dir"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn nil"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // LoadDir loads a plugin from the given directory."
          },
          {
            "type": "context",
            "line": " func LoadDir(dirname string) (*Plugin, error) {"
          },
          {
            "type": "delete",
            "line": "\tdata, err := ioutil.ReadFile(filepath.Join(dirname, PluginFileName))"
          },
          {
            "type": "add",
            "line": "\tpluginfile := filepath.Join(dirname, PluginFileName)"
          },
          {
            "type": "add",
            "line": "\tdata, err := ioutil.ReadFile(pluginfile)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\treturn nil, err"
          },
          {
            "type": "add",
            "line": "\t\treturn nil, errors.Wrapf(err, \"failed to read plugin at %q\", pluginfile)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tplug := &Plugin{Dir: dirname}"
          },
          {
            "type": "context",
            "line": " \tif err := yaml.Unmarshal(data, &plug.Metadata); err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\treturn nil, err"
          },
          {
            "type": "add",
            "line": "\t\treturn nil, errors.Wrapf(err, \"failed to load plugin at %q\", pluginfile)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\treturn plug, nil"
          },
          {
            "type": "add",
            "line": "\treturn plug, validatePluginData(plug, pluginfile)"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // LoadAll loads all plugins found beneath the base directory."
          },
          {
            "type": "context",
            "line": " \tscanpath := filepath.Join(basedir, \"*\", PluginFileName)"
          },
          {
            "type": "context",
            "line": " \tmatches, err := filepath.Glob(scanpath)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "delete",
            "line": "\t\treturn plugins, err"
          },
          {
            "type": "add",
            "line": "\t\treturn plugins, errors.Wrapf(err, \"failed to find plugins in %q\", scanpath)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tif matches == nil {"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\tplugins = append(plugins, p)"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\treturn plugins, nil"
          },
          {
            "type": "add",
            "line": "\treturn plugins, detectDuplicates(plugins)"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // FindPlugins returns a list of YAML files that describe plugins."
          }
        ]
      },
      {
        "file": "pkg/plugin/plugin_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index af0b61846..88add037d 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/plugin/plugin_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/plugin/plugin_test.go"
          },
          {
            "type": "context",
            "line": " package plugin // import \"helm.sh/helm/v3/pkg/plugin\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import ("
          },
          {
            "type": "add",
            "line": "\t\"fmt\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t\"path/filepath\""
          },
          {
            "type": "context",
            "line": " \t\"reflect\""
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestValidatePluginData(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tfor i, item := range []struct {"
          },
          {
            "type": "add",
            "line": "\t\tpass bool"
          },
          {
            "type": "add",
            "line": "\t\tplug *Plugin"
          },
          {
            "type": "add",
            "line": "\t}{"
          },
          {
            "type": "add",
            "line": "\t\t{true, mockPlugin(\"abcdefghijklmnopqrstuvwxyz0123456789_-ABC\")},"
          },
          {
            "type": "add",
            "line": "\t\t{true, mockPlugin(\"foo-bar-FOO-BAR_1234\")},"
          },
          {
            "type": "add",
            "line": "\t\t{false, mockPlugin(\"foo -bar\")},"
          },
          {
            "type": "add",
            "line": "\t\t{false, mockPlugin(\"$foo -bar\")}, // Test leading chars"
          },
          {
            "type": "add",
            "line": "\t\t{false, mockPlugin(\"foo -bar \")}, // Test trailing chars"
          },
          {
            "type": "add",
            "line": "\t\t{false, mockPlugin(\"foo\\nbar\")},  // Test newline"
          },
          {
            "type": "add",
            "line": "\t} {"
          },
          {
            "type": "add",
            "line": "\t\terr := validatePluginData(item.plug, fmt.Sprintf(\"test-%d\", i))"
          },
          {
            "type": "add",
            "line": "\t\tif item.pass && err != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"failed to validate case %d: %s\", i, err)"
          },
          {
            "type": "add",
            "line": "\t\t} else if !item.pass && err == nil {"
          },
          {
            "type": "add",
            "line": "\t\t\tt.Errorf(\"expected case %d to fail\", i)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestDetectDuplicates(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tplugs := []*Plugin{"
          },
          {
            "type": "add",
            "line": "\t\tmockPlugin(\"foo\"),"
          },
          {
            "type": "add",
            "line": "\t\tmockPlugin(\"bar\"),"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tif err := detectDuplicates(plugs); err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Error(\"no duplicates in the first set\")"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tplugs = append(plugs, mockPlugin(\"foo\"))"
          },
          {
            "type": "add",
            "line": "\tif err := detectDuplicates(plugs); err == nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Error(\"duplicates in the second set\")"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "func mockPlugin(name string) *Plugin {"
          },
          {
            "type": "add",
            "line": "\treturn &Plugin{"
          },
          {
            "type": "add",
            "line": "\t\tMetadata: &Metadata{"
          },
          {
            "type": "add",
            "line": "\t\t\tName:        name,"
          },
          {
            "type": "add",
            "line": "\t\t\tVersion:     \"v0.1.2\","
          },
          {
            "type": "add",
            "line": "\t\t\tUsage:       \"Mock plugin\","
          },
          {
            "type": "add",
            "line": "\t\t\tDescription: \"Mock plugin for testing\","
          },
          {
            "type": "add",
            "line": "\t\t\tCommand:     \"echo mock plugin\","
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t\tDir: \"no-such-dir\","
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      }
    ]
  },
  {
    "commit": "82d8e39043e691e0492519126437275511ee87e8",
    "files": [
      {
        "file": "browser/brave_content_browser_client.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 584ef1292cf..3c681fb906a 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/brave_content_browser_client.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/brave_content_browser_client.cc"
          },
          {
            "type": "context",
            "line": " #if BUILDFLAG(ENABLE_IPFS)"
          },
          {
            "type": "context",
            "line": " #include \"brave/browser/ipfs/content_browser_client_helper.h\""
          },
          {
            "type": "context",
            "line": " #include \"brave/browser/ipfs/ipfs_service_factory.h\""
          },
          {
            "type": "add",
            "line": "#include \"brave/browser/ipfs/ipfs_subframe_navigation_throttle.h\""
          },
          {
            "type": "context",
            "line": " #include \"brave/components/ipfs/ipfs_constants.h\""
          },
          {
            "type": "context",
            "line": " #include \"brave/components/ipfs/ipfs_navigation_throttle.h\""
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": " #endif"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #if BUILDFLAG(ENABLE_IPFS)"
          },
          {
            "type": "add",
            "line": "  throttles.insert("
          },
          {
            "type": "add",
            "line": "      throttles.begin(),"
          },
          {
            "type": "add",
            "line": "      ipfs::IpfsSubframeNavigationThrottle::CreateThrottleFor(handle));"
          },
          {
            "type": "context",
            "line": "   std::unique_ptr<content::NavigationThrottle> ipfs_navigation_throttle ="
          },
          {
            "type": "context",
            "line": "       ipfs::IpfsNavigationThrottle::MaybeCreateThrottleFor("
          },
          {
            "type": "context",
            "line": "           handle, ipfs::IpfsServiceFactory::GetForContext(context),"
          }
        ]
      },
      {
        "file": "browser/ipfs/ipfs_subframe_navigation_throttle.cc",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..faf5af0f5c0"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/browser/ipfs/ipfs_subframe_navigation_throttle.cc"
          },
          {
            "type": "add",
            "line": "/* Copyright (c) 2022 The Brave Authors. All rights reserved."
          },
          {
            "type": "add",
            "line": " * This Source Code Form is subject to the terms of the Mozilla Public"
          },
          {
            "type": "add",
            "line": " * License, v. 2.0. If a copy of the MPL was not distributed with this file,"
          },
          {
            "type": "add",
            "line": " * You can obtain one at http://mozilla.org/MPL/2.0/. */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"brave/browser/ipfs/ipfs_subframe_navigation_throttle.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"brave/components/ipfs/ipfs_constants.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace ipfs {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// static"
          },
          {
            "type": "add",
            "line": "std::unique_ptr<IpfsSubframeNavigationThrottle>"
          },
          {
            "type": "add",
            "line": "IpfsSubframeNavigationThrottle::CreateThrottleFor("
          },
          {
            "type": "add",
            "line": "    content::NavigationHandle* navigation_handle) {"
          },
          {
            "type": "add",
            "line": "  return std::make_unique<IpfsSubframeNavigationThrottle>(navigation_handle);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "IpfsSubframeNavigationThrottle::IpfsSubframeNavigationThrottle("
          },
          {
            "type": "add",
            "line": "    content::NavigationHandle* navigation_handle)"
          },
          {
            "type": "add",
            "line": "    : content::NavigationThrottle(navigation_handle) {}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "IpfsSubframeNavigationThrottle::~IpfsSubframeNavigationThrottle() {}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// content::NavigationThrottle implementation:"
          },
          {
            "type": "add",
            "line": "content::NavigationThrottle::ThrottleCheckResult"
          },
          {
            "type": "add",
            "line": "IpfsSubframeNavigationThrottle::WillFailRequest() {"
          },
          {
            "type": "add",
            "line": "  // Ignores subframe ipfs:// navigation. It is ok to commit toplevel"
          },
          {
            "type": "add",
            "line": "  // navigation."
          },
          {
            "type": "add",
            "line": "  if (!navigation_handle()->IsInMainFrame() &&"
          },
          {
            "type": "add",
            "line": "      (navigation_handle()->GetURL().SchemeIs(ipfs::kIPFSScheme) ||"
          },
          {
            "type": "add",
            "line": "       navigation_handle()->GetURL().SchemeIs(ipfs::kIPNSScheme))) {"
          },
          {
            "type": "add",
            "line": "    return {content::NavigationThrottle::CANCEL_AND_IGNORE,"
          },
          {
            "type": "add",
            "line": "            navigation_handle()->GetNetErrorCode()};"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "  return content::NavigationThrottle::PROCEED;"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "const char* IpfsSubframeNavigationThrottle::GetNameForLogging() {"
          },
          {
            "type": "add",
            "line": "  return \"IpfsSubframeNavigationThrottle\";"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "}  // namespace ipfs"
          }
        ]
      },
      {
        "file": "browser/ipfs/ipfs_subframe_navigation_throttle.h",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..a37ead16c79"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/browser/ipfs/ipfs_subframe_navigation_throttle.h"
          },
          {
            "type": "add",
            "line": "/* Copyright (c) 2022 The Brave Authors. All rights reserved."
          },
          {
            "type": "add",
            "line": " * This Source Code Form is subject to the terms of the Mozilla Public"
          },
          {
            "type": "add",
            "line": " * License, v. 2.0. If a copy of the MPL was not distributed with this file,"
          },
          {
            "type": "add",
            "line": " * You can obtain one at http://mozilla.org/MPL/2.0/. */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#ifndef BRAVE_BROWSER_IPFS_IPFS_SUBFRAME_NAVIGATION_THROTTLE_H_"
          },
          {
            "type": "add",
            "line": "#define BRAVE_BROWSER_IPFS_IPFS_SUBFRAME_NAVIGATION_THROTTLE_H_"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include <memory>"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"content/public/browser/navigation_handle.h\""
          },
          {
            "type": "add",
            "line": "#include \"content/public/browser/navigation_throttle.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace ipfs {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Prevents commiting of subframe IPFS navigations."
          },
          {
            "type": "add",
            "line": "// IPFS urls must be changed to proper gateway urls."
          },
          {
            "type": "add",
            "line": "// See ipfs_redirect_network_delegate_helper.h for example."
          },
          {
            "type": "add",
            "line": "class IpfsSubframeNavigationThrottle : public content::NavigationThrottle {"
          },
          {
            "type": "add",
            "line": " public:"
          },
          {
            "type": "add",
            "line": "  static std::unique_ptr<IpfsSubframeNavigationThrottle> CreateThrottleFor("
          },
          {
            "type": "add",
            "line": "      content::NavigationHandle* navigation_handle);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  explicit IpfsSubframeNavigationThrottle("
          },
          {
            "type": "add",
            "line": "      content::NavigationHandle* navigation_handle);"
          },
          {
            "type": "add",
            "line": "  ~IpfsSubframeNavigationThrottle() override;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  IpfsSubframeNavigationThrottle(const IpfsSubframeNavigationThrottle&) ="
          },
          {
            "type": "add",
            "line": "      delete;"
          },
          {
            "type": "add",
            "line": "  IpfsSubframeNavigationThrottle& operator=("
          },
          {
            "type": "add",
            "line": "      const IpfsSubframeNavigationThrottle&) = delete;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // content::NavigationThrottle implementation:"
          },
          {
            "type": "add",
            "line": "  // This is called before navigation commits with error."
          },
          {
            "type": "add",
            "line": "  // Here we can cancel subframe navigation for ipfs:// urls."
          },
          {
            "type": "add",
            "line": "  content::NavigationThrottle::ThrottleCheckResult WillFailRequest() override;"
          },
          {
            "type": "add",
            "line": "  const char* GetNameForLogging() override;"
          },
          {
            "type": "add",
            "line": "};"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "}  // namespace ipfs"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#endif  // BRAVE_BROWSER_IPFS_IPFS_SUBFRAME_NAVIGATION_THROTTLE_H_"
          }
        ]
      },
      {
        "file": "browser/ipfs/sources.gni",
        "changes": [
          {
            "type": "context",
            "line": "index 14021d75de4..e5d8a5498b4 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/ipfs/sources.gni"
          },
          {
            "type": "context",
            "line": "+++ b/browser/ipfs/sources.gni"
          },
          {
            "type": "context",
            "line": "     \"//brave/browser/ipfs/ipfs_host_resolver.h\","
          },
          {
            "type": "context",
            "line": "     \"//brave/browser/ipfs/ipfs_service_factory.cc\","
          },
          {
            "type": "context",
            "line": "     \"//brave/browser/ipfs/ipfs_service_factory.h\","
          },
          {
            "type": "add",
            "line": "    \"//brave/browser/ipfs/ipfs_subframe_navigation_throttle.cc\","
          },
          {
            "type": "add",
            "line": "    \"//brave/browser/ipfs/ipfs_subframe_navigation_throttle.h\","
          },
          {
            "type": "context",
            "line": "     \"//brave/browser/ipfs/ipfs_tab_helper.cc\","
          },
          {
            "type": "context",
            "line": "     \"//brave/browser/ipfs/ipfs_tab_helper.h\","
          },
          {
            "type": "context",
            "line": "   ]"
          }
        ]
      },
      {
        "file": "browser/ipfs/test/ipfs_service_browsertest.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 42640a0ff9f..be95fe7ce8c 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/ipfs/test/ipfs_service_browsertest.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/ipfs/test/ipfs_service_browsertest.cc"
          },
          {
            "type": "context",
            "line": "       http_response->set_content("
          },
          {
            "type": "context",
            "line": "           \"<iframe \""
          },
          {
            "type": "context",
            "line": "           \"src='ipfs://Qmc2JTQo4iXf24g98otZmGFQq176eQ2Cdbb88qA5ToMEvC/2'>\""
          },
          {
            "type": "add",
            "line": "          \"</iframe>\""
          },
          {
            "type": "add",
            "line": "          \"<iframe \""
          },
          {
            "type": "add",
            "line": "          \"src='ipfs://10.10.1.1'>\""
          },
          {
            "type": "add",
            "line": "          \"</iframe>\""
          },
          {
            "type": "add",
            "line": "          \"<iframe \""
          },
          {
            "type": "add",
            "line": "          \"src='ipns://10.10.1.1'>\""
          },
          {
            "type": "add",
            "line": "          \"</iframe>\""
          },
          {
            "type": "add",
            "line": "          \"<iframe \""
          },
          {
            "type": "add",
            "line": "          \"src='ipfs://'>\""
          },
          {
            "type": "context",
            "line": "           \"</iframe>\");"
          },
          {
            "type": "context",
            "line": "       http_response->set_code(net::HTTP_OK);"
          },
          {
            "type": "context",
            "line": "     } else if (request_path =="
          },
          {
            "type": "context",
            "line": "   EXPECT_EQ(base::Value(true), got_fetch.value);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Make sure an <iframe src=\"ipfs://...\"> cannot load within http:// scheme in"
          },
          {
            "type": "add",
            "line": "// incognito"
          },
          {
            "type": "add",
            "line": "IN_PROC_BROWSER_TEST_F(IpfsServiceBrowserTest,"
          },
          {
            "type": "add",
            "line": "                       CannotLoadIframeFromHTTP_Incognito) {"
          },
          {
            "type": "add",
            "line": "  browser()->profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod,"
          },
          {
            "type": "add",
            "line": "      static_cast<int>(ipfs::IPFSResolveMethodTypes::IPFS_LOCAL));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  ResetTestServer("
          },
          {
            "type": "add",
            "line": "      base::BindRepeating(&IpfsServiceBrowserTest::HandleEmbeddedSrvrRequest,"
          },
          {
            "type": "add",
            "line": "                          base::Unretained(this)));"
          },
          {
            "type": "add",
            "line": "  SetIPFSDefaultGatewayForTest(GetURL(\"b.com\", \"/\"));"
          },
          {
            "type": "add",
            "line": "  Browser* private_browser = CreateIncognitoBrowser(nullptr);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  ASSERT_TRUE(ui_test_utils::NavigateToURL(private_browser,"
          },
          {
            "type": "add",
            "line": "                                           GetURL(\"b.com\", \"/iframe.html\")));"
          },
          {
            "type": "add",
            "line": "  content::WebContents* contents ="
          },
          {
            "type": "add",
            "line": "      private_browser->tab_strip_model()->GetActiveWebContents();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  int child_index = 0;"
          },
          {
            "type": "add",
            "line": "  while (auto* child_frame ="
          },
          {
            "type": "add",
            "line": "             ChildFrameAt(contents->GetMainFrame(), child_index++)) {"
          },
          {
            "type": "add",
            "line": "    auto location ="
          },
          {
            "type": "add",
            "line": "        EvalJs(child_frame,"
          },
          {
            "type": "add",
            "line": "               \"const timer = setInterval(function () {\""
          },
          {
            "type": "add",
            "line": "               \"  if (document.readyState == 'complete') {\""
          },
          {
            "type": "add",
            "line": "               \"    clearInterval(timer);\""
          },
          {
            "type": "add",
            "line": "               \"    window.domAutomationController.send(window.location.href);\""
          },
          {
            "type": "add",
            "line": "               \"  }\""
          },
          {
            "type": "add",
            "line": "               \"}, 100);\","
          },
          {
            "type": "add",
            "line": "               content::EXECUTE_SCRIPT_USE_MANUAL_REPLY);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(location.error.empty());"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(base::Value(\"chrome-error://chromewebdata/\"), location.value);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Make sure an <iframe src=\"ipfs://...\"> cannot load within http:// scheme"
          },
          {
            "type": "context",
            "line": " IN_PROC_BROWSER_TEST_F(IpfsServiceBrowserTest, CannotLoadIframeFromHTTP) {"
          },
          {
            "type": "add",
            "line": "  browser()->profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod,"
          },
          {
            "type": "add",
            "line": "      static_cast<int>(ipfs::IPFSResolveMethodTypes::IPFS_ASK));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   ResetTestServer("
          },
          {
            "type": "context",
            "line": "       base::BindRepeating(&IpfsServiceBrowserTest::HandleEmbeddedSrvrRequest,"
          },
          {
            "type": "context",
            "line": "                           base::Unretained(this)));"
          },
          {
            "type": "context",
            "line": "   content::WebContents* contents ="
          },
          {
            "type": "context",
            "line": "       browser()->tab_strip_model()->GetActiveWebContents();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  auto* child_frame = ChildFrameAt(contents->GetMainFrame(), 0);"
          },
          {
            "type": "delete",
            "line": "  auto location ="
          },
          {
            "type": "delete",
            "line": "      EvalJs(child_frame,"
          },
          {
            "type": "delete",
            "line": "             \"const timer = setInterval(function () {\""
          },
          {
            "type": "delete",
            "line": "             \"  if (document.readyState == 'complete') {\""
          },
          {
            "type": "delete",
            "line": "             \"    clearInterval(timer);\""
          },
          {
            "type": "delete",
            "line": "             \"    window.domAutomationController.send(window.location.href);\""
          },
          {
            "type": "delete",
            "line": "             \"  }\""
          },
          {
            "type": "delete",
            "line": "             \"}, 100);\","
          },
          {
            "type": "delete",
            "line": "             content::EXECUTE_SCRIPT_USE_MANUAL_REPLY);"
          },
          {
            "type": "add",
            "line": "  int child_index = 0;"
          },
          {
            "type": "add",
            "line": "  while (auto* child_frame ="
          },
          {
            "type": "add",
            "line": "             ChildFrameAt(contents->GetMainFrame(), child_index++)) {"
          },
          {
            "type": "add",
            "line": "    auto location ="
          },
          {
            "type": "add",
            "line": "        EvalJs(child_frame,"
          },
          {
            "type": "add",
            "line": "               \"const timer = setInterval(function () {\""
          },
          {
            "type": "add",
            "line": "               \"  if (document.readyState == 'complete') {\""
          },
          {
            "type": "add",
            "line": "               \"    clearInterval(timer);\""
          },
          {
            "type": "add",
            "line": "               \"    window.domAutomationController.send(window.location.href);\""
          },
          {
            "type": "add",
            "line": "               \"  }\""
          },
          {
            "type": "add",
            "line": "               \"}, 100);\","
          },
          {
            "type": "add",
            "line": "               content::EXECUTE_SCRIPT_USE_MANUAL_REPLY);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(location.error.empty());"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(base::Value(\"chrome-error://chromewebdata/\"), location.value);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "// Make sure an <iframe src=\"ipfs://...\"> cannot load within http:// scheme when"
          },
          {
            "type": "add",
            "line": "// ipfs is disabled"
          },
          {
            "type": "add",
            "line": "IN_PROC_BROWSER_TEST_F(IpfsServiceBrowserTest,"
          },
          {
            "type": "add",
            "line": "                       CannotLoadIframeFromHTTP_IPFSDisabled) {"
          },
          {
            "type": "add",
            "line": "  browser()->profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod,"
          },
          {
            "type": "add",
            "line": "      static_cast<int>(ipfs::IPFSResolveMethodTypes::IPFS_DISABLED));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  ASSERT_TRUE(location.error.empty());"
          },
          {
            "type": "delete",
            "line": "  EXPECT_EQ(base::Value(\"chrome-error://chromewebdata/\"), location.value);"
          },
          {
            "type": "add",
            "line": "  ResetTestServer("
          },
          {
            "type": "add",
            "line": "      base::BindRepeating(&IpfsServiceBrowserTest::HandleEmbeddedSrvrRequest,"
          },
          {
            "type": "add",
            "line": "                          base::Unretained(this)));"
          },
          {
            "type": "add",
            "line": "  SetIPFSDefaultGatewayForTest(GetURL(\"b.com\", \"/\"));"
          },
          {
            "type": "add",
            "line": "  ASSERT_TRUE("
          },
          {
            "type": "add",
            "line": "      ui_test_utils::NavigateToURL(browser(), GetURL(\"b.com\", \"/iframe.html\")));"
          },
          {
            "type": "add",
            "line": "  content::WebContents* contents ="
          },
          {
            "type": "add",
            "line": "      browser()->tab_strip_model()->GetActiveWebContents();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  int child_index = 0;"
          },
          {
            "type": "add",
            "line": "  while (auto* child_frame ="
          },
          {
            "type": "add",
            "line": "             ChildFrameAt(contents->GetMainFrame(), child_index++)) {"
          },
          {
            "type": "add",
            "line": "    auto location ="
          },
          {
            "type": "add",
            "line": "        EvalJs(child_frame,"
          },
          {
            "type": "add",
            "line": "               \"const timer = setInterval(function () {\""
          },
          {
            "type": "add",
            "line": "               \"  if (document.readyState == 'complete') {\""
          },
          {
            "type": "add",
            "line": "               \"    clearInterval(timer);\""
          },
          {
            "type": "add",
            "line": "               \"    window.domAutomationController.send(window.location.href);\""
          },
          {
            "type": "add",
            "line": "               \"  }\""
          },
          {
            "type": "add",
            "line": "               \"}, 100);\","
          },
          {
            "type": "add",
            "line": "               content::EXECUTE_SCRIPT_USE_MANUAL_REPLY);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    ASSERT_TRUE(location.error.empty());"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(base::Value(\"chrome-error://chromewebdata/\"), location.value);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Make sure an <iframe src=\"ipfs://...\"> can load within another ipfs:// scheme"
          }
        ]
      },
      {
        "file": "browser/net/ipfs_redirect_network_delegate_helper.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 611ec63ad5c..0fa6f77eaaa 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/net/ipfs_redirect_network_delegate_helper.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/net/ipfs_redirect_network_delegate_helper.cc"
          },
          {
            "type": "context",
            "line": "   if (has_ipfs_scheme && !brave::IsRegularProfile(ctx->browser_context)) {"
          },
          {
            "type": "context",
            "line": "     // Don't allow IPFS requests without translation of IPFS urls."
          },
          {
            "type": "context",
            "line": "     ctx->blocked_by = brave::kOtherBlocked;"
          },
          {
            "type": "delete",
            "line": "    return net::ERR_INCOGNITO_IPFS_NOT_ALLOWED;"
          },
          {
            "type": "add",
            "line": "    // Only net::OK navigation will be actually blocked without commit."
          },
          {
            "type": "add",
            "line": "    return ctx->resource_type == blink::mojom::ResourceType::kMainFrame"
          },
          {
            "type": "add",
            "line": "               ? net::ERR_INCOGNITO_IPFS_NOT_ALLOWED"
          },
          {
            "type": "add",
            "line": "               : net::OK;"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   GURL new_url;"
          }
        ]
      },
      {
        "file": "browser/net/ipfs_redirect_network_delegate_helper_unittest.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 5d35d3032e8..df8954c4747 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/net/ipfs_redirect_network_delegate_helper_unittest.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/net/ipfs_redirect_network_delegate_helper_unittest.cc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   GURL url(\"ipfs://QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "context",
            "line": "   auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "delete",
            "line": "  brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "  brave_request_info->resource_type = blink::mojom::ResourceType::kMainFrame;"
          },
          {
            "type": "context",
            "line": "   brave_request_info->browser_context = profile()->GetOffTheRecordProfile("
          },
          {
            "type": "context",
            "line": "       Profile::OTRProfileID::CreateUnique(\"incognito\"), true);"
          },
          {
            "type": "context",
            "line": "   int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork(brave::ResponseCallback(),"
          },
          {
            "type": "context",
            "line": "   EXPECT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "add",
            "line": "       SubFrameRequestDisabledWhenIPFSDisabled_Incognito_Subframe) {"
          },
          {
            "type": "add",
            "line": "  profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod, static_cast<int>(IPFSResolveMethodTypes::IPFS_LOCAL));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  GURL url(\"ipfs://QmfM2r8seH2GiRaC4esTjeraXEachRt8ZsSeGaWTPLyMoG\");"
          },
          {
            "type": "add",
            "line": "  auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "  brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "  brave_request_info->browser_context = profile()->GetOffTheRecordProfile("
          },
          {
            "type": "add",
            "line": "      Profile::OTRProfileID::CreateUnique(\"incognito\"), true);"
          },
          {
            "type": "add",
            "line": "  int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork(brave::ResponseCallback(),"
          },
          {
            "type": "add",
            "line": "                                                     brave_request_info);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "  EXPECT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "context",
            "line": "        LoadDisabledWhenIPFS_WhenWrongIPFSUrl) {"
          },
          {
            "type": "context",
            "line": "   profile()->GetPrefs()->SetInteger("
          }
        ]
      }
    ]
  },
  {
    "commit": "87d6bef033062f969e70fa40c43dfd945d5a20ab",
    "files": [
      {
        "file": "sf-pcapng.c",
        "changes": [
          {
            "type": "context",
            "line": "index cf8b3970..11bac263 100644"
          },
          {
            "type": "context",
            "line": "--- a/sf-pcapng.c"
          },
          {
            "type": "context",
            "line": "+++ b/sf-pcapng.c"
          },
          {
            "type": "context",
            "line": "  * Section Header Block."
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " #define BT_SHB\t\t\t0x0A0D0D0A"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "#define BT_SHB_INSANE_MAX       1024*1024*1  /* 1MB should be enough */"
          },
          {
            "type": "context",
            "line": " struct section_header_block {"
          },
          {
            "type": "context",
            "line": " \tbpf_u_int32\tbyte_order_magic;"
          },
          {
            "type": "context",
            "line": " \tu_short\t\tmajor_version;"
          },
          {
            "type": "context",
            "line": " \t\t\tif (amt_read == 0 && !fail_on_eof)"
          },
          {
            "type": "context",
            "line": " \t\t\t\treturn (0);\t/* EOF */"
          },
          {
            "type": "context",
            "line": " \t\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "delete",
            "line": "\t\t\t    \"truncated dump file; tried to read %\" PRIsize \" bytes, only got %\" PRIsize,"
          },
          {
            "type": "add",
            "line": "\t\t\t    \"truncated pcapng dump file; tried to read %\" PRIsize \" bytes, only got %\" PRIsize,"
          },
          {
            "type": "context",
            "line": " \t\t\t    bytes_to_read, amt_read);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\treturn (-1);"
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * Check the sanity of the total length."
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "delete",
            "line": "\tif (total_length < sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer)) {"
          },
          {
            "type": "add",
            "line": "\tif (total_length < sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer) ||"
          },
          {
            "type": "add",
            "line": "            (total_length > BT_SHB_INSANE_MAX)) {"
          },
          {
            "type": "context",
            "line": " \t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "delete",
            "line": "\t\t    \"Section Header Block in pcapng dump file has a length of %u < %\" PRIsize,"
          },
          {
            "type": "delete",
            "line": "\t\t    total_length,"
          },
          {
            "type": "delete",
            "line": "\t\t    sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer));"
          },
          {
            "type": "delete",
            "line": "\t\t*err = 1;"
          },
          {
            "type": "delete",
            "line": "\t\treturn (NULL);"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t\t    \"Section Header Block in pcapng dump file has invalid length %\" PRIsize \" < _%lu_ < %lu (BT_SHB_INSANE_MAX)\","
          },
          {
            "type": "add",
            "line": "                              sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer),"
          },
          {
            "type": "add",
            "line": "                              total_length,"
          },
          {
            "type": "add",
            "line": "                              BT_SHB_INSANE_MAX);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t/*"
          },
          {
            "type": "delete",
            "line": "\t * Make sure it's not too big."
          },
          {
            "type": "delete",
            "line": "\t */"
          },
          {
            "type": "delete",
            "line": "\tif (total_length > INITIAL_MAX_BLOCKSIZE) {"
          },
          {
            "type": "delete",
            "line": "\t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "delete",
            "line": "\t\t    \"pcapng block size %u > maximum %u\","
          },
          {
            "type": "delete",
            "line": "\t\t    total_length, INITIAL_MAX_BLOCKSIZE);"
          },
          {
            "type": "context",
            "line": " \t\t*err = 1;"
          },
          {
            "type": "context",
            "line": " \t\treturn (NULL);"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/*"
          },
          {
            "type": "context",
            "line": " \t * OK, this is a good pcapng file."
          },
          {
            "type": "context",
            "line": " \t * Allocate a pcap_t for it."
          }
        ]
      }
    ]
  },
  {
    "commit": "8bb2d2646d4e1a718fce61a775fa22e9d317b32d",
    "files": [
      {
        "file": "modules/tinymce/CHANGELOG.md",
        "changes": [
          {
            "type": "context",
            "line": "index 74abcfa66c..e0cdc54afe 100644"
          },
          {
            "type": "context",
            "line": "--- a/modules/tinymce/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": "+++ b/modules/tinymce/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ## Unreleased"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "### Fixed"
          },
          {
            "type": "add",
            "line": "- HTML in messages for the `WindowManager.alert` and `WindowManager.confirm` APIs were not properly sanitized. #TINY-3548"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " ## 5.10.6 - 2022-10-19"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ### Fixed"
          }
        ]
      },
      {
        "file": "modules/tinymce/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index 7410cde79d..4891022f08 100644"
          },
          {
            "type": "context",
            "line": "--- a/modules/tinymce/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/modules/tinymce/package.json"
          },
          {
            "type": "context",
            "line": "     \"silver-test-manual\": \"grunt bedrock-manual:silver\""
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   \"dependencies\": {"
          },
          {
            "type": "add",
            "line": "    \"dompurify\": \"2.3.8\","
          },
          {
            "type": "context",
            "line": "     \"tslib\": \"^2.0.0\""
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "modules/tinymce/src/themes/silver/main/ts/ui/core/HtmlSanitizer.ts",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..e20627df87"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/modules/tinymce/src/themes/silver/main/ts/ui/core/HtmlSanitizer.ts"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Tiny Technologies, Inc. All rights reserved."
          },
          {
            "type": "add",
            "line": " * Licensed under the LGPL or a commercial license."
          },
          {
            "type": "add",
            "line": " * For LGPL see License.txt in the project root for license information."
          },
          {
            "type": "add",
            "line": " * For commercial licenses see https://www.tiny.cloud/"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import createDompurify from 'dompurify';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "export const sanitizeHtmlString = (html: string): string => createDompurify().sanitize(html);"
          }
        ]
      },
      {
        "file": "modules/tinymce/src/themes/silver/main/ts/ui/dialog/Dialogs.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 700a7bae37..ec738ea05c 100644"
          },
          {
            "type": "context",
            "line": "--- a/modules/tinymce/src/themes/silver/main/ts/ui/dialog/Dialogs.ts"
          },
          {
            "type": "context",
            "line": "+++ b/modules/tinymce/src/themes/silver/main/ts/ui/dialog/Dialogs.ts"
          },
          {
            "type": "context",
            "line": " import Env from 'tinymce/core/api/Env';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import { UiFactoryBackstageProviders } from '../../backstage/Backstage';"
          },
          {
            "type": "add",
            "line": "import * as HtmlSanitizer from '../core/HtmlSanitizer';"
          },
          {
            "type": "context",
            "line": " import * as NavigableObject from '../general/NavigableObject';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " const isTouch = Env.deviceType.isTouch();"
          },
          {
            "type": "context",
            "line": "       },"
          },
          {
            "type": "context",
            "line": "       components: ["
          },
          {
            "type": "context",
            "line": "         {"
          },
          {
            "type": "delete",
            "line": "          dom: DomFactory.fromHtml(`<p>${providersBackstage.translate(message)}</p>`)"
          },
          {
            "type": "add",
            "line": "          dom: DomFactory.fromHtml(`<p>${HtmlSanitizer.sanitizeHtmlString(providersBackstage.translate(message))}</p>`)"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "       ]"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "modules/tinymce/src/themes/silver/test/ts/phantom/window/WindowManagerAlertTest.ts",
        "changes": [
          {
            "type": "context",
            "line": "index e2d453517a..253bcd1e79 100644"
          },
          {
            "type": "context",
            "line": "--- a/modules/tinymce/src/themes/silver/test/ts/phantom/window/WindowManagerAlertTest.ts"
          },
          {
            "type": "context",
            "line": "+++ b/modules/tinymce/src/themes/silver/test/ts/phantom/window/WindowManagerAlertTest.ts"
          },
          {
            "type": "context",
            "line": "     Mouse.clickOn(SugarBody.body(), '.tox-button:contains(\"OK\")');"
          },
          {
            "type": "context",
            "line": "     UiFinder.notExists(SugarBody.body(), '[role=\"dialog\"]');"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  it('TINY-3548: sanitize message', async () => {"
          },
          {
            "type": "add",
            "line": "    createAlert('<a href=\"javascript:alert(1)\">invalid link</a><script>alert(1)</script><a href=\"http://tiny.cloud\">valid link</a>', Fun.noop);"
          },
          {
            "type": "add",
            "line": "    const dialogBody = SelectorFind.descendant(SugarDocument.getDocument(), '.tox-dialog__body').getOrDie('Cannot find dialog body element');"
          },
          {
            "type": "add",
            "line": "    Assertions.assertStructure('A basic alert dialog should have these components',"
          },
          {
            "type": "add",
            "line": "      ApproxStructure.build((s, str, arr) => s.element('div', {"
          },
          {
            "type": "add",
            "line": "        classes: [ arr.has('tox-dialog__body') ],"
          },
          {
            "type": "add",
            "line": "        children: ["
          },
          {
            "type": "add",
            "line": "          s.element('div', {"
          },
          {
            "type": "add",
            "line": "            classes: [ arr.has('tox-dialog__body-content') ],"
          },
          {
            "type": "add",
            "line": "            children: ["
          },
          {
            "type": "add",
            "line": "              s.element('p', {"
          },
          {
            "type": "add",
            "line": "                children: ["
          },
          {
            "type": "add",
            "line": "                  s.element('a', {"
          },
          {
            "type": "add",
            "line": "                    attrs: {"
          },
          {
            "type": "add",
            "line": "                      href: str.none('Should have been trimmed away')"
          },
          {
            "type": "add",
            "line": "                    },"
          },
          {
            "type": "add",
            "line": "                    children: ["
          },
          {
            "type": "add",
            "line": "                      s.text(str.is('invalid link'))"
          },
          {
            "type": "add",
            "line": "                    ]"
          },
          {
            "type": "add",
            "line": "                  }),"
          },
          {
            "type": "add",
            "line": "                  s.element('a', {"
          },
          {
            "type": "add",
            "line": "                    attrs: {"
          },
          {
            "type": "add",
            "line": "                      href: str.is('http://tiny.cloud')"
          },
          {
            "type": "add",
            "line": "                    },"
          },
          {
            "type": "add",
            "line": "                    children: ["
          },
          {
            "type": "add",
            "line": "                      s.text(str.is('valid link'))"
          },
          {
            "type": "add",
            "line": "                    ]"
          },
          {
            "type": "add",
            "line": "                  })"
          },
          {
            "type": "add",
            "line": "                ]"
          },
          {
            "type": "add",
            "line": "              })"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "          })"
          },
          {
            "type": "add",
            "line": "        ]"
          },
          {
            "type": "add",
            "line": "      })),"
          },
          {
            "type": "add",
            "line": "      dialogBody"
          },
          {
            "type": "add",
            "line": "    );"
          },
          {
            "type": "add",
            "line": "    await pTeardown();"
          },
          {
            "type": "add",
            "line": "  });"
          },
          {
            "type": "context",
            "line": " });"
          }
        ]
      },
      {
        "file": "modules/tinymce/src/themes/silver/test/ts/phantom/window/WindowManagerConfirmTest.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 603fd82da9..d41a7625aa 100644"
          },
          {
            "type": "context",
            "line": "--- a/modules/tinymce/src/themes/silver/test/ts/phantom/window/WindowManagerConfirmTest.ts"
          },
          {
            "type": "context",
            "line": "+++ b/modules/tinymce/src/themes/silver/test/ts/phantom/window/WindowManagerConfirmTest.ts"
          },
          {
            "type": "context",
            "line": "     Mouse.clickOn(SugarBody.body(), '.tox-button:contains(\"Yes\")');"
          },
          {
            "type": "context",
            "line": "     UiFinder.notExists(SugarBody.body(), '[role=\"dialog\"]');"
          },
          {
            "type": "context",
            "line": "   });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  it('TINY-3548: sanitize message', async () => {"
          },
          {
            "type": "add",
            "line": "    createConfirm('<a href=\"javascript:alert(1)\">invalid link</a><script>alert(1)</script><a href=\"http://tiny.cloud\">valid link</a>', Fun.noop);"
          },
          {
            "type": "add",
            "line": "    const dialogBody = SelectorFind.descendant(SugarDocument.getDocument(), '.tox-dialog__body').getOrDie('Cannot find dialog body element');"
          },
          {
            "type": "add",
            "line": "    Assertions.assertStructure('A basic alert dialog should have these components',"
          },
          {
            "type": "add",
            "line": "      ApproxStructure.build((s, str, arr) => s.element('div', {"
          },
          {
            "type": "add",
            "line": "        classes: [ arr.has('tox-dialog__body') ],"
          },
          {
            "type": "add",
            "line": "        children: ["
          },
          {
            "type": "add",
            "line": "          s.element('div', {"
          },
          {
            "type": "add",
            "line": "            classes: [ arr.has('tox-dialog__body-content') ],"
          },
          {
            "type": "add",
            "line": "            children: ["
          },
          {
            "type": "add",
            "line": "              s.element('p', {"
          },
          {
            "type": "add",
            "line": "                children: ["
          },
          {
            "type": "add",
            "line": "                  s.element('a', {"
          },
          {
            "type": "add",
            "line": "                    attrs: {"
          },
          {
            "type": "add",
            "line": "                      href: str.none('Should have been trimmed away')"
          },
          {
            "type": "add",
            "line": "                    },"
          },
          {
            "type": "add",
            "line": "                    children: ["
          },
          {
            "type": "add",
            "line": "                      s.text(str.is('invalid link'))"
          },
          {
            "type": "add",
            "line": "                    ]"
          },
          {
            "type": "add",
            "line": "                  }),"
          },
          {
            "type": "add",
            "line": "                  s.element('a', {"
          },
          {
            "type": "add",
            "line": "                    attrs: {"
          },
          {
            "type": "add",
            "line": "                      href: str.is('http://tiny.cloud')"
          },
          {
            "type": "add",
            "line": "                    },"
          },
          {
            "type": "add",
            "line": "                    children: ["
          },
          {
            "type": "add",
            "line": "                      s.text(str.is('valid link'))"
          },
          {
            "type": "add",
            "line": "                    ]"
          },
          {
            "type": "add",
            "line": "                  })"
          },
          {
            "type": "add",
            "line": "                ]"
          },
          {
            "type": "add",
            "line": "              })"
          },
          {
            "type": "add",
            "line": "            ]"
          },
          {
            "type": "add",
            "line": "          })"
          },
          {
            "type": "add",
            "line": "        ]"
          },
          {
            "type": "add",
            "line": "      })),"
          },
          {
            "type": "add",
            "line": "      dialogBody"
          },
          {
            "type": "add",
            "line": "    );"
          },
          {
            "type": "add",
            "line": "    await pTeardown();"
          },
          {
            "type": "add",
            "line": "  });"
          },
          {
            "type": "context",
            "line": " });"
          }
        ]
      },
      {
        "file": "yarn.lock",
        "changes": [
          {
            "type": "context",
            "line": "index c16eb65dfc..d43463bab3 100644"
          },
          {
            "type": "context",
            "line": "--- a/yarn.lock"
          },
          {
            "type": "context",
            "line": "+++ b/yarn.lock"
          },
          {
            "type": "context",
            "line": "   dependencies:"
          },
          {
            "type": "context",
            "line": "     domelementtype \"1\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "dompurify@2.3.8:"
          },
          {
            "type": "add",
            "line": "  version \"2.3.8\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/dompurify/-/dompurify-2.3.8.tgz#224fe9ae57d7ebd9a1ae1ac18c1c1ca3f532226f\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-eVhaWoVibIzqdGYjwsBWodIQIaXFSB+cKDf4cfxLMsK0xiud6SE+/WCVx/Xw/UwQsa4cS3T2eITcdtmTg2UKcw=="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " domutils@^1.5.1, domutils@^1.7.0:"
          },
          {
            "type": "context",
            "line": "   version \"1.7.0\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/domutils/-/domutils-1.7.0.tgz#56ea341e834e06e6748af7a1cb25da67ea9f8c2a\""
          }
        ]
      }
    ]
  },
  {
    "commit": "8ce01b3b76d4634f55067d6cfdf632ec70ba304a",
    "files": [
      {
        "file": "docs/news.rst",
        "changes": [
          {
            "type": "context",
            "line": "index 2128f2f0e..aef12d9db 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/news.rst"
          },
          {
            "type": "context",
            "line": "+++ b/docs/news.rst"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " .. _release-2.6.0:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Scrapy 2.6.0 (2022-02-??)"
          },
          {
            "type": "add",
            "line": "Scrapy 2.6.0 (2022-03-01)"
          },
          {
            "type": "context",
            "line": " -------------------------"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " Highlights:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "*   :ref:`Security fixes for cookie handling <2.6-security-fixes>`"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " *   Python 3.10 support"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " *   :ref:`asyncio support <using-asyncio>` is no longer considered"
          },
          {
            "type": "context",
            "line": "     :ref:`item filtering <item-filter>` and"
          },
          {
            "type": "context",
            "line": "     :ref:`post-processing <post-processing>`"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ".. _2.6-security-fixes:"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Security bug fixes"
          },
          {
            "type": "add",
            "line": "~~~~~~~~~~~~~~~~~~"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "-   When a :class:`~scrapy.http.Request` object with cookies defined gets a"
          },
          {
            "type": "add",
            "line": "    redirect response causing a new :class:`~scrapy.http.Request` object to be"
          },
          {
            "type": "add",
            "line": "    scheduled, the cookies defined in the original"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object are no longer copied into the new"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    If you manually set the ``Cookie`` header on a"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object and the domain name of the redirect"
          },
          {
            "type": "add",
            "line": "    URL is not an exact match for the domain of the URL of the original"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object, your ``Cookie`` header is now dropped"
          },
          {
            "type": "add",
            "line": "    from the new :class:`~scrapy.http.Request` object."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    The old behavior could be exploited by an attacker to gain access to your"
          },
          {
            "type": "add",
            "line": "    cookies. Please, see the `cjvr-mfj7-j4j8 security advisory`_ for more"
          },
          {
            "type": "add",
            "line": "    information."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    .. _cjvr-mfj7-j4j8 security advisory: https://github.com/scrapy/scrapy/security/advisories/GHSA-cjvr-mfj7-j4j8"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    .. note:: It is still possible to enable the sharing of cookies between"
          },
          {
            "type": "add",
            "line": "              different domains with a shared domain suffix (e.g."
          },
          {
            "type": "add",
            "line": "              ``example.com`` and any subdomain) by defining the shared domain"
          },
          {
            "type": "add",
            "line": "              suffix (e.g. ``example.com``) as the cookie domain when defining"
          },
          {
            "type": "add",
            "line": "              your cookies. See the documentation of the"
          },
          {
            "type": "add",
            "line": "              :class:`~scrapy.http.Request` class for more information."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " Modified requirements"
          },
          {
            "type": "context",
            "line": " ~~~~~~~~~~~~~~~~~~~~~"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " (:issue:`3884`)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ".. _release-1.8.2:"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Scrapy 1.8.2 (2022-03-01)"
          },
          {
            "type": "add",
            "line": "-------------------------"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "**Security bug fixes:**"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "-   When a :class:`~scrapy.http.Request` object with cookies defined gets a"
          },
          {
            "type": "add",
            "line": "    redirect response causing a new :class:`~scrapy.http.Request` object to be"
          },
          {
            "type": "add",
            "line": "    scheduled, the cookies defined in the original"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object are no longer copied into the new"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    If you manually set the ``Cookie`` header on a"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object and the domain name of the redirect"
          },
          {
            "type": "add",
            "line": "    URL is not an exact match for the domain of the URL of the original"
          },
          {
            "type": "add",
            "line": "    :class:`~scrapy.http.Request` object, your ``Cookie`` header is now dropped"
          },
          {
            "type": "add",
            "line": "    from the new :class:`~scrapy.http.Request` object."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    The old behavior could be exploited by an attacker to gain access to your"
          },
          {
            "type": "add",
            "line": "    cookies. Please, see the `cjvr-mfj7-j4j8 security advisory`_ for more"
          },
          {
            "type": "add",
            "line": "    information."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    .. _cjvr-mfj7-j4j8 security advisory: https://github.com/scrapy/scrapy/security/advisories/GHSA-cjvr-mfj7-j4j8"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    .. note:: It is still possible to enable the sharing of cookies between"
          },
          {
            "type": "add",
            "line": "              different domains with a shared domain suffix (e.g."
          },
          {
            "type": "add",
            "line": "              ``example.com`` and any subdomain) by defining the shared domain"
          },
          {
            "type": "add",
            "line": "              suffix (e.g. ``example.com``) as the cookie domain when defining"
          },
          {
            "type": "add",
            "line": "              your cookies. See the documentation of the"
          },
          {
            "type": "add",
            "line": "              :class:`~scrapy.http.Request` class for more information."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " .. _release-1.8.1:"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "scrapy/downloadermiddlewares/redirect.py",
        "changes": [
          {
            "type": "context",
            "line": "index 4053fecc5..fcd6c298b 100644"
          },
          {
            "type": "context",
            "line": "--- a/scrapy/downloadermiddlewares/redirect.py"
          },
          {
            "type": "context",
            "line": "+++ b/scrapy/downloadermiddlewares/redirect.py"
          },
          {
            "type": "context",
            "line": " from w3lib.url import safe_url_string"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from scrapy.http import HtmlResponse"
          },
          {
            "type": "add",
            "line": "from scrapy.utils.httpobj import urlparse_cached"
          },
          {
            "type": "context",
            "line": " from scrapy.utils.response import get_meta_refresh"
          },
          {
            "type": "context",
            "line": " from scrapy.exceptions import IgnoreRequest, NotConfigured"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " logger = logging.getLogger(__name__)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def _build_redirect_request(source_request, *, url, method=None, body=None):"
          },
          {
            "type": "add",
            "line": "    redirect_request = source_request.replace("
          },
          {
            "type": "add",
            "line": "        url=url,"
          },
          {
            "type": "add",
            "line": "        method=method,"
          },
          {
            "type": "add",
            "line": "        body=body,"
          },
          {
            "type": "add",
            "line": "        cookies=None,"
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    if 'Cookie' in redirect_request.headers:"
          },
          {
            "type": "add",
            "line": "        source_request_netloc = urlparse_cached(source_request).netloc"
          },
          {
            "type": "add",
            "line": "        redirect_request_netloc = urlparse_cached(redirect_request).netloc"
          },
          {
            "type": "add",
            "line": "        if source_request_netloc != redirect_request_netloc:"
          },
          {
            "type": "add",
            "line": "            del redirect_request.headers['Cookie']"
          },
          {
            "type": "add",
            "line": "    return redirect_request"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " class BaseRedirectMiddleware:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     enabled_setting = 'REDIRECT_ENABLED'"
          },
          {
            "type": "context",
            "line": "             raise IgnoreRequest(\"max redirections reached\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def _redirect_request_using_get(self, request, redirect_url):"
          },
          {
            "type": "delete",
            "line": "        redirected = request.replace(url=redirect_url, method='GET', body='')"
          },
          {
            "type": "delete",
            "line": "        redirected.headers.pop('Content-Type', None)"
          },
          {
            "type": "delete",
            "line": "        redirected.headers.pop('Content-Length', None)"
          },
          {
            "type": "delete",
            "line": "        return redirected"
          },
          {
            "type": "add",
            "line": "        redirect_request = _build_redirect_request("
          },
          {
            "type": "add",
            "line": "            request,"
          },
          {
            "type": "add",
            "line": "            url=redirect_url,"
          },
          {
            "type": "add",
            "line": "            method='GET',"
          },
          {
            "type": "add",
            "line": "            body='',"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        redirect_request.headers.pop('Content-Type', None)"
          },
          {
            "type": "add",
            "line": "        redirect_request.headers.pop('Content-Length', None)"
          },
          {
            "type": "add",
            "line": "        return redirect_request"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class RedirectMiddleware(BaseRedirectMiddleware):"
          },
          {
            "type": "context",
            "line": "         redirected_url = urljoin(request.url, location)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if response.status in (301, 307, 308) or request.method == 'HEAD':"
          },
          {
            "type": "delete",
            "line": "            redirected = request.replace(url=redirected_url)"
          },
          {
            "type": "add",
            "line": "            redirected = _build_redirect_request(request, url=redirected_url)"
          },
          {
            "type": "context",
            "line": "             return self._redirect(redirected, request, spider, response.status)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         redirected = self._redirect_request_using_get(request, redirected_url)"
          }
        ]
      },
      {
        "file": "tests/test_downloadermiddleware_cookies.py",
        "changes": [
          {
            "type": "context",
            "line": "index 36021bfbf..1747f3b94 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/test_downloadermiddleware_cookies.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/test_downloadermiddleware_cookies.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from scrapy.downloadermiddlewares.cookies import CookiesMiddleware"
          },
          {
            "type": "context",
            "line": " from scrapy.downloadermiddlewares.defaultheaders import DefaultHeadersMiddleware"
          },
          {
            "type": "add",
            "line": "from scrapy.downloadermiddlewares.redirect import RedirectMiddleware"
          },
          {
            "type": "context",
            "line": " from scrapy.exceptions import NotConfigured"
          },
          {
            "type": "context",
            "line": " from scrapy.http import Response, Request"
          },
          {
            "type": "add",
            "line": "from scrapy.settings import Settings"
          },
          {
            "type": "context",
            "line": " from scrapy.spiders import Spider"
          },
          {
            "type": "context",
            "line": " from scrapy.utils.python import to_bytes"
          },
          {
            "type": "context",
            "line": " from scrapy.utils.test import get_crawler"
          },
          {
            "type": "context",
            "line": "     def setUp(self):"
          },
          {
            "type": "context",
            "line": "         self.spider = Spider('foo')"
          },
          {
            "type": "context",
            "line": "         self.mw = CookiesMiddleware()"
          },
          {
            "type": "add",
            "line": "        self.redirect_middleware = RedirectMiddleware(settings=Settings())"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def tearDown(self):"
          },
          {
            "type": "context",
            "line": "         del self.mw"
          },
          {
            "type": "add",
            "line": "        del self.redirect_middleware"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def test_basic(self):"
          },
          {
            "type": "context",
            "line": "         req = Request('http://scrapytest.org/')"
          },
          {
            "type": "context",
            "line": "         req4 = Request('http://example.org', cookies={'a': 'b'})"
          },
          {
            "type": "context",
            "line": "         assert self.mw.process_request(req4, self.spider) is None"
          },
          {
            "type": "context",
            "line": "         self.assertCookieValEqual(req4.headers['Cookie'], b'a=b')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def _test_cookie_redirect("
          },
          {
            "type": "add",
            "line": "        self,"
          },
          {
            "type": "add",
            "line": "        source,"
          },
          {
            "type": "add",
            "line": "        target,"
          },
          {
            "type": "add",
            "line": "        *,"
          },
          {
            "type": "add",
            "line": "        cookies1,"
          },
          {
            "type": "add",
            "line": "        cookies2,"
          },
          {
            "type": "add",
            "line": "    ):"
          },
          {
            "type": "add",
            "line": "        input_cookies = {'a': 'b'}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if not isinstance(source, dict):"
          },
          {
            "type": "add",
            "line": "            source = {'url': source}"
          },
          {
            "type": "add",
            "line": "        if not isinstance(target, dict):"
          },
          {
            "type": "add",
            "line": "            target = {'url': target}"
          },
          {
            "type": "add",
            "line": "        target.setdefault('status', 301)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        request1 = Request(cookies=input_cookies, **source)"
          },
          {
            "type": "add",
            "line": "        self.mw.process_request(request1, self.spider)"
          },
          {
            "type": "add",
            "line": "        cookies = request1.headers.get('Cookie')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(cookies, b\"a=b\" if cookies1 else None)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = Response("
          },
          {
            "type": "add",
            "line": "            headers={"
          },
          {
            "type": "add",
            "line": "                'Location': target['url'],"
          },
          {
            "type": "add",
            "line": "            },"
          },
          {
            "type": "add",
            "line": "            **target,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertEqual("
          },
          {
            "type": "add",
            "line": "            self.mw.process_response(request1, response, self.spider),"
          },
          {
            "type": "add",
            "line": "            response,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        request2 = self.redirect_middleware.process_response("
          },
          {
            "type": "add",
            "line": "            request1,"
          },
          {
            "type": "add",
            "line": "            response,"
          },
          {
            "type": "add",
            "line": "            self.spider,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(request2, Request)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self.mw.process_request(request2, self.spider)"
          },
          {
            "type": "add",
            "line": "        cookies = request2.headers.get('Cookie')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(cookies, b\"a=b\" if cookies2 else None)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_redirect_same_domain(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            cookies1=True,"
          },
          {
            "type": "add",
            "line": "            cookies2=True,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_redirect_same_domain_forcing_get(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            {'url': 'https://toscrape.com', 'status': 302},"
          },
          {
            "type": "add",
            "line": "            cookies1=True,"
          },
          {
            "type": "add",
            "line": "            cookies2=True,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_redirect_different_domain(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            'https://example.com',"
          },
          {
            "type": "add",
            "line": "            cookies1=True,"
          },
          {
            "type": "add",
            "line": "            cookies2=False,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_redirect_different_domain_forcing_get(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            {'url': 'https://example.com', 'status': 302},"
          },
          {
            "type": "add",
            "line": "            cookies1=True,"
          },
          {
            "type": "add",
            "line": "            cookies2=False,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def _test_cookie_header_redirect("
          },
          {
            "type": "add",
            "line": "        self,"
          },
          {
            "type": "add",
            "line": "        source,"
          },
          {
            "type": "add",
            "line": "        target,"
          },
          {
            "type": "add",
            "line": "        *,"
          },
          {
            "type": "add",
            "line": "        cookies2,"
          },
          {
            "type": "add",
            "line": "    ):"
          },
          {
            "type": "add",
            "line": "        \"\"\"Test the handling of a user-defined Cookie header when building a"
          },
          {
            "type": "add",
            "line": "        redirect follow-up request."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        We follow RFC 6265 for cookie handling. The Cookie header can only"
          },
          {
            "type": "add",
            "line": "        contain a list of key-value pairs (i.e. no additional cookie"
          },
          {
            "type": "add",
            "line": "        parameters like Domain or Path). Because of that, we follow the same"
          },
          {
            "type": "add",
            "line": "        rules that we would follow for the handling of the Set-Cookie response"
          },
          {
            "type": "add",
            "line": "        header when the Domain is not set: the cookies must be limited to the"
          },
          {
            "type": "add",
            "line": "        target URL domain (not even subdomains can receive those cookies)."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        .. note:: This method tests the scenario where the cookie middleware is"
          },
          {
            "type": "add",
            "line": "                  disabled. Because of known issue #1992, when the cookies"
          },
          {
            "type": "add",
            "line": "                  middleware is enabled we do not need to be concerned about"
          },
          {
            "type": "add",
            "line": "                  the Cookie header getting leaked to unintended domains,"
          },
          {
            "type": "add",
            "line": "                  because the middleware empties the header from every request."
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        if not isinstance(source, dict):"
          },
          {
            "type": "add",
            "line": "            source = {'url': source}"
          },
          {
            "type": "add",
            "line": "        if not isinstance(target, dict):"
          },
          {
            "type": "add",
            "line": "            target = {'url': target}"
          },
          {
            "type": "add",
            "line": "        target.setdefault('status', 301)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        request1 = Request(headers={'Cookie': b'a=b'}, **source)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        response = Response("
          },
          {
            "type": "add",
            "line": "            headers={"
          },
          {
            "type": "add",
            "line": "                'Location': target['url'],"
          },
          {
            "type": "add",
            "line": "            },"
          },
          {
            "type": "add",
            "line": "            **target,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        request2 = self.redirect_middleware.process_response("
          },
          {
            "type": "add",
            "line": "            request1,"
          },
          {
            "type": "add",
            "line": "            response,"
          },
          {
            "type": "add",
            "line": "            self.spider,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        self.assertIsInstance(request2, Request)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        cookies = request2.headers.get('Cookie')"
          },
          {
            "type": "add",
            "line": "        self.assertEqual(cookies, b\"a=b\" if cookies2 else None)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_header_redirect_same_domain(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_header_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            cookies2=True,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_header_redirect_same_domain_forcing_get(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_header_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            {'url': 'https://toscrape.com', 'status': 302},"
          },
          {
            "type": "add",
            "line": "            cookies2=True,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_header_redirect_different_domain(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_header_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            'https://example.com',"
          },
          {
            "type": "add",
            "line": "            cookies2=False,"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_cookie_header_redirect_different_domain_forcing_get(self):"
          },
          {
            "type": "add",
            "line": "        self._test_cookie_header_redirect("
          },
          {
            "type": "add",
            "line": "            'https://toscrape.com',"
          },
          {
            "type": "add",
            "line": "            {'url': 'https://example.com', 'status': 302},"
          },
          {
            "type": "add",
            "line": "            cookies2=False,"
          },
          {
            "type": "add",
            "line": "        )"
          }
        ]
      }
    ]
  },
  {
    "commit": "8d0ac336d23cd8c98e71d5f21cdadcae9c8a26e6",
    "files": [
      {
        "file": "CHANGELOG.md",
        "changes": [
          {
            "type": "context",
            "line": "index 18d6bf37..c5f49c5c 100644"
          },
          {
            "type": "context",
            "line": "--- a/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": "     * ADDED: Translation for Ukrainian (#533)"
          },
          {
            "type": "context",
            "line": "     * ADDED: Option to send a mail with the link, when creating a paste (#398)"
          },
          {
            "type": "context",
            "line": "     * ADDED: Add support for CONFIG_PATH environment variable (#552)"
          },
          {
            "type": "add",
            "line": "    * FIXED: HTML injection via unescaped attachment filename (#554)"
          },
          {
            "type": "context",
            "line": "     * FIXED: Password disabling option (#527)"
          },
          {
            "type": "context",
            "line": "   * **1.3.1 (2019-09-22)**"
          },
          {
            "type": "context",
            "line": "     * ADDED: Translation for Bulgarian (#455)"
          }
        ]
      },
      {
        "file": "js/privatebin.js",
        "changes": [
          {
            "type": "context",
            "line": "index eea87678..dc7adefa 100644"
          },
          {
            "type": "context",
            "line": "--- a/js/privatebin.js"
          },
          {
            "type": "context",
            "line": "+++ b/js/privatebin.js"
          },
          {
            "type": "context",
            "line": "             // move elemement to new place"
          },
          {
            "type": "context",
            "line": "             $attachmentLink.appendTo($element);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            // update text"
          },
          {
            "type": "delete",
            "line": "            I18n._($attachmentLink, label, $attachmentLink.attr('download'));"
          },
          {
            "type": "add",
            "line": "            // update text - ensuring no HTML is inserted into the text node"
          },
          {
            "type": "add",
            "line": "            I18n._("
          },
          {
            "type": "add",
            "line": "                $attachmentLink,"
          },
          {
            "type": "add",
            "line": "                $('<div />').text(label).html(),"
          },
          {
            "type": "add",
            "line": "                $('<div />').text($attachmentLink.attr('download')).html()"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "context",
            "line": "         };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         /**"
          }
        ]
      },
      {
        "file": "js/test/AttachmentViewer.js",
        "changes": [
          {
            "type": "context",
            "line": "index 438b2f89..e891deb7 100644"
          },
          {
            "type": "context",
            "line": "--- a/js/test/AttachmentViewer.js"
          },
          {
            "type": "context",
            "line": "+++ b/js/test/AttachmentViewer.js"
          },
          {
            "type": "context",
            "line": "                         mimeType.match(/\\/pdf/i)"
          },
          {
            "type": "context",
            "line": "                     ),"
          },
          {
            "type": "context",
            "line": "                     results = [];"
          },
          {
            "type": "delete",
            "line": "                prefix = prefix.replace(/%(s|d)/g, '%%');"
          },
          {
            "type": "add",
            "line": "                prefix  = prefix.replace(/%(s|d)/g, '%%');"
          },
          {
            "type": "context",
            "line": "                 postfix = postfix.replace(/%(s|d)/g, '%%');"
          },
          {
            "type": "context",
            "line": "                 $('body').html("
          },
          {
            "type": "context",
            "line": "                     '<div id=\"attachment\" role=\"alert\" class=\"hidden alert ' +"
          },
          {
            "type": "context",
            "line": "                     results.push("
          },
          {
            "type": "context",
            "line": "                         element.children()[0].href === data &&"
          },
          {
            "type": "context",
            "line": "                         element.children()[0].getAttribute('download') === filename &&"
          },
          {
            "type": "delete",
            "line": "                        element.children()[0].text === prefix + filename + postfix"
          },
          {
            "type": "add",
            "line": "                        element.children()[0].text === $('<div />').text(prefix + filename + postfix).html()"
          },
          {
            "type": "context",
            "line": "                     );"
          },
          {
            "type": "context",
            "line": "                 } else {"
          },
          {
            "type": "context",
            "line": "                     results.push(element.children()[0].href === data);"
          }
        ]
      },
      {
        "file": "tpl/bootstrap.php",
        "changes": [
          {
            "type": "context",
            "line": "index 0d095e29..50e3e253 100644"
          },
          {
            "type": "context",
            "line": "--- a/tpl/bootstrap.php"
          },
          {
            "type": "context",
            "line": "+++ b/tpl/bootstrap.php"
          },
          {
            "type": "context",
            "line": " ?>"
          },
          {
            "type": "context",
            "line": " \t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/purify-2.0.7.js\" integrity=\"sha512-XjNEK1xwh7SJ/7FouwV4VZcGW9cMySL3SwNpXgrURLBcXXQYtZdqhGoNdEwx9vwLvFjUGDQVNgpOrTsXlSTiQg==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "context",
            "line": " \t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/legacy.js?<?php echo rawurlencode($VERSION); ?>\" integrity=\"sha512-LYos+qXHIRqFf5ZPNphvtTB0cgzHUizu2wwcOwcwz/VIpRv9lpcBgPYz4uq6jx0INwCAj6Fbnl5HoKiLufS2jg==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "delete",
            "line": "\t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/privatebin.js?<?php echo rawurlencode($VERSION); ?>\" integrity=\"sha512-Bppv5Tt3fBwlJMQaL3ktLhrCNKZQwWo9ox4A/CAXiUs3rQLjfPSuEVViyuYy11e9oOaTKrMb7ejrkwDjhK1NmA==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "add",
            "line": "\t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/privatebin.js?<?php echo rawurlencode($VERSION); ?>\" integrity=\"sha512-HxU8g6MFviBCv6fEKEL+bn0fICxg9++ZUxxqySWXkX4iGgLodH/OVZDfr3dgKK5vZAv+0niWLuf+CWZ+/gUwWw==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "context",
            "line": " \t\t<link rel=\"apple-touch-icon\" href=\"img/apple-touch-icon.png?<?php echo rawurlencode($VERSION); ?>\" sizes=\"180x180\" />"
          },
          {
            "type": "context",
            "line": " \t\t<link rel=\"icon\" type=\"image/png\" href=\"img/favicon-32x32.png?<?php echo rawurlencode($VERSION); ?>\" sizes=\"32x32\" />"
          },
          {
            "type": "context",
            "line": " \t\t<link rel=\"icon\" type=\"image/png\" href=\"img/favicon-16x16.png?<?php echo rawurlencode($VERSION); ?>\" sizes=\"16x16\" />"
          }
        ]
      },
      {
        "file": "tpl/page.php",
        "changes": [
          {
            "type": "context",
            "line": "index 5f13e778..dcb939b3 100644"
          },
          {
            "type": "context",
            "line": "--- a/tpl/page.php"
          },
          {
            "type": "context",
            "line": "+++ b/tpl/page.php"
          },
          {
            "type": "context",
            "line": " ?>"
          },
          {
            "type": "context",
            "line": " \t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/purify-2.0.7.js\" integrity=\"sha512-XjNEK1xwh7SJ/7FouwV4VZcGW9cMySL3SwNpXgrURLBcXXQYtZdqhGoNdEwx9vwLvFjUGDQVNgpOrTsXlSTiQg==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "context",
            "line": " \t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/legacy.js?<?php echo rawurlencode($VERSION); ?>\" integrity=\"sha512-LYos+qXHIRqFf5ZPNphvtTB0cgzHUizu2wwcOwcwz/VIpRv9lpcBgPYz4uq6jx0INwCAj6Fbnl5HoKiLufS2jg==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "delete",
            "line": "\t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/privatebin.js?<?php echo rawurlencode($VERSION); ?>\" integrity=\"sha512-Bppv5Tt3fBwlJMQaL3ktLhrCNKZQwWo9ox4A/CAXiUs3rQLjfPSuEVViyuYy11e9oOaTKrMb7ejrkwDjhK1NmA==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "add",
            "line": "\t\t<script type=\"text/javascript\" data-cfasync=\"false\" src=\"js/privatebin.js?<?php echo rawurlencode($VERSION); ?>\" integrity=\"sha512-HxU8g6MFviBCv6fEKEL+bn0fICxg9++ZUxxqySWXkX4iGgLodH/OVZDfr3dgKK5vZAv+0niWLuf+CWZ+/gUwWw==\" crossorigin=\"anonymous\"></script>"
          },
          {
            "type": "context",
            "line": " \t\t<link rel=\"apple-touch-icon\" href=\"img/apple-touch-icon.png?<?php echo rawurlencode($VERSION); ?>\" sizes=\"180x180\" />"
          },
          {
            "type": "context",
            "line": " \t\t<link rel=\"icon\" type=\"image/png\" href=\"img/favicon-32x32.png?<?php echo rawurlencode($VERSION); ?>\" sizes=\"32x32\" />"
          },
          {
            "type": "context",
            "line": " \t\t<link rel=\"icon\" type=\"image/png\" href=\"img/favicon-16x16.png?<?php echo rawurlencode($VERSION); ?>\" sizes=\"16x16\" />"
          }
        ]
      }
    ]
  },
  {
    "commit": "8e99e7c82d9fe569799019b9e1d614d38a184313",
    "files": [
      {
        "file": "plugins/graphontrackersv5/include/data-access/GraphOnTrackersV5_ChartFactory.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 2697e43948f..aba04cefb6f 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/graphontrackersv5/include/data-access/GraphOnTrackersV5_ChartFactory.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/graphontrackersv5/include/data-access/GraphOnTrackersV5_ChartFactory.class.php"
          },
          {
            "type": "context",
            "line": "                 $report   = null; //We don't know the report"
          },
          {
            "type": "context",
            "line": "                 $renderer = Tracker_Report_RendererFactory::instance()->getReportRendererById($chart_data['report_graphic_id'], $report, $store_in_session);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "delete",
            "line": "            if ($renderer) {"
          },
          {
            "type": "add",
            "line": "            if ($renderer && $renderer->getReport()->getTracker()->userCanView()) {"
          },
          {
            "type": "context",
            "line": "                 $c = $this->instanciateChart($chart_data, $renderer, $store_in_session);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "plugins/tracker/include/Tracker/Widget/Tracker_Widget_Renderer.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 59061ca7ed7..2bd3c780051 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/tracker/include/Tracker/Widget/Tracker_Widget_Renderer.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/tracker/include/Tracker/Widget/Tracker_Widget_Renderer.class.php"
          },
          {
            "type": "context",
            "line": "         $store_in_session = false;"
          },
          {
            "type": "context",
            "line": "         $arrf             = Tracker_Report_RendererFactory::instance();"
          },
          {
            "type": "context",
            "line": "         $renderer         = $arrf->getReportRendererById($this->renderer_id, null, $store_in_session);"
          },
          {
            "type": "delete",
            "line": "        if ($renderer) {"
          },
          {
            "type": "delete",
            "line": "            $tracker = $renderer->report->getTracker();"
          },
          {
            "type": "delete",
            "line": "            $project = $tracker->getProject();"
          },
          {
            "type": "delete",
            "line": "            if ($tracker->isActive() && $project->isActive()) {"
          },
          {
            "type": "delete",
            "line": "                return $renderer;"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        if ($renderer && $renderer->report->getTracker()->userCanView()) {"
          },
          {
            "type": "add",
            "line": "            return $renderer;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         return null;"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      }
    ]
  },
  {
    "commit": "9125f35ff649a3e7fd7771b1c8e5add3c726f763",
    "files": [
      {
        "file": "packages/weservice/getversion.php",
        "changes": [
          {
            "type": "context",
            "line": "index 1dc9e574d..3e4f0989b 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/web/service/getversion.php"
          },
          {
            "type": "context",
            "line": "+++ b/packages/web/service/getversion.php"
          },
          {
            "type": "context",
            "line": "  * @link     https://fogproject.org"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " require '../commons/base.inc.php';"
          },
          {
            "type": "delete",
            "line": "$clientUpdate = (bool)FOGCore::getSetting('FOG_CLIENT_AUTOUPDATE');"
          },
          {
            "type": "add",
            "line": "$clientUpdate = (bool) FOGCore::getSetting('FOG_CLIENT_AUTOUPDATE');"
          },
          {
            "type": "context",
            "line": " if (isset($_REQUEST['client'])) {"
          },
          {
            "type": "context",
            "line": "     $ver = ("
          },
          {
            "type": "delete",
            "line": "        $clientUpdate ?"
          },
          {
            "type": "add",
            "line": "        $clientUpdate ?"
          },
          {
            "type": "context",
            "line": "         '9.9.99' :"
          },
          {
            "type": "context",
            "line": "         '0.0.0'"
          },
          {
            "type": "context",
            "line": "     );"
          },
          {
            "type": "context",
            "line": " } elseif (isset($_REQUEST['clientver'])) {"
          },
          {
            "type": "context",
            "line": "     $ver = ("
          },
          {
            "type": "delete",
            "line": "        $clientUpdate ?"
          },
          {
            "type": "add",
            "line": "        $clientUpdate ?"
          },
          {
            "type": "context",
            "line": "         FOG_CLIENT_VERSION :"
          },
          {
            "type": "context",
            "line": "         '0.0.0'"
          },
          {
            "type": "context",
            "line": "     );"
          },
          {
            "type": "context",
            "line": " } elseif (isset($_REQUEST['url'])) {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    // Prevent an unauthenticated user from making arbitrary requests."
          },
          {
            "type": "add",
            "line": "    $unauthorized = !$currentUser->isValid() || empty($_SERVER['HTTP_X_REQUESTED_WITH'])"
          },
          {
            "type": "add",
            "line": "        || strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) !== 'xmlhttprequest';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if ($unauthorized) {"
          },
          {
            "type": "add",
            "line": "        echo _('Unauthorized');"
          },
          {
            "type": "add",
            "line": "        exit;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     $url = $_REQUEST['url'];"
          },
          {
            "type": "context",
            "line": "     $res = $FOGURLRequests"
          },
          {
            "type": "context",
            "line": "         ->process($_REQUEST['url']);"
          },
          {
            "type": "context",
            "line": "     $ver = FOG_VERSION;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": " echo $ver;"
          },
          {
            "type": "delete",
            "line": "exit;"
          },
          {
            "type": "add",
            "line": "exit;"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      },
      {
        "file": "packages/westatus/kernelvers.php",
        "changes": [
          {
            "type": "context",
            "line": "index d39cdea3c..3aedc101d 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/web/status/kernelvers.php"
          },
          {
            "type": "context",
            "line": "+++ b/packages/web/status/kernelvers.php"
          },
          {
            "type": "context",
            "line": " ignore_user_abort(true);"
          },
          {
            "type": "context",
            "line": " set_time_limit(0);"
          },
          {
            "type": "context",
            "line": " header('Content-Type: text/event-stream');"
          },
          {
            "type": "delete",
            "line": "$url = filter_input(INPUT_POST, 'url');"
          },
          {
            "type": "delete",
            "line": "if ($url) {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "if (isset($_POST['url'])) {"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    // Prevent an unauthenticated user from making arbitrary requests."
          },
          {
            "type": "add",
            "line": "    $unauthorized = !$currentUser->isValid() || empty($_SERVER['HTTP_X_REQUESTED_WITH'])"
          },
          {
            "type": "add",
            "line": "        || strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) !== 'xmlhttprequest';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if ($unauthorized) {"
          },
          {
            "type": "add",
            "line": "        echo _('Unauthorized');"
          },
          {
            "type": "add",
            "line": "        exit;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     $res = $FOGURLRequests"
          },
          {
            "type": "delete",
            "line": "        ->process($url);"
          },
          {
            "type": "delete",
            "line": "    foreach ((array)$res as &$response) {"
          },
          {
            "type": "add",
            "line": "        ->process(filter_input(INPUT_POST, 'url'));"
          },
          {
            "type": "add",
            "line": "    foreach ((array) $res as &$response) {"
          },
          {
            "type": "context",
            "line": "         echo $response;"
          },
          {
            "type": "context",
            "line": "         unset($response);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     exit;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " $kernelvers = function ($kernel) {"
          },
          {
            "type": "context",
            "line": "     $currpath = sprintf("
          },
          {
            "type": "context",
            "line": "         '%s%sservice%sipxe%s%s',"
          },
          {
            "type": "context",
            "line": " );"
          },
          {
            "type": "context",
            "line": " printf("
          },
          {
            "type": "context",
            "line": "     \"bzImage Version: %s\\n\","
          },
          {
            "type": "delete",
            "line": "    $kernelvers('bzImage')"
          },
          {
            "type": "add",
            "line": "        $kernelvers('bzImage')"
          },
          {
            "type": "context",
            "line": " );"
          },
          {
            "type": "context",
            "line": " printf("
          },
          {
            "type": "context",
            "line": "     \"bzImage32 Version: %s\","
          },
          {
            "type": "delete",
            "line": "    $kernelvers('bzImage32')"
          },
          {
            "type": "delete",
            "line": ");"
          },
          {
            "type": "add",
            "line": "        $kernelvers('bzImage32')"
          },
          {
            "type": "add",
            "line": ");"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          }
        ]
      }
    ]
  },
  {
    "commit": "91535add59f4b3a04b6b8eab123c002cd5af180d",
    "files": [
      {
        "file": "plugins/hudson/include/HudsonJobWidget.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index f2c1d33b5c6..bd3f51b31c5 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/hudson/include/HudsonJobWidget.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/hudson/include/HudsonJobWidget.class.php"
          },
          {
            "type": "context",
            "line": "         $vId->required();"
          },
          {
            "type": "context",
            "line": "         if ($request->valid($vId)) {"
          },
          {
            "type": "context",
            "line": "             $job_id = $request->get($this->widget_id . '_job_id');"
          },
          {
            "type": "delete",
            "line": "            $sql = 'INSERT INTO plugin_hudson_widget (widget_name, owner_id, owner_type, job_id) VALUES (\"' . $this->id . '\", ' . $this->owner_id . \", '\" . $this->owner_type . \"', \" . db_escape_int($job_id) . \" )\";"
          },
          {
            "type": "delete",
            "line": "            $res = db_query($sql);"
          },
          {
            "type": "delete",
            "line": "            $content_id = db_insertid($res);"
          },
          {
            "type": "add",
            "line": "            $db = \\Tuleap\\DB\\DBFactory::getMainTuleapDBConnection()->getDB();"
          },
          {
            "type": "add",
            "line": "            $content_id = (int) $db->insertReturnId("
          },
          {
            "type": "add",
            "line": "                'plugin_hudson_widget',"
          },
          {
            "type": "add",
            "line": "                ["
          },
          {
            "type": "add",
            "line": "                    'widget_name' => $this->id,"
          },
          {
            "type": "add",
            "line": "                    'owner_id'    => $this->owner_id,"
          },
          {
            "type": "add",
            "line": "                    'owner_type'  => $this->owner_type,"
          },
          {
            "type": "add",
            "line": "                    'job_id'      => $job_id"
          },
          {
            "type": "add",
            "line": "                ]"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         return $content_id;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function destroy($id)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $sql = 'DELETE FROM plugin_hudson_widget WHERE id = ' . $id . ' AND owner_id = ' . $this->owner_id . \" AND owner_type = '\" . $this->owner_type . \"'\";"
          },
          {
            "type": "delete",
            "line": "        db_query($sql);"
          },
          {
            "type": "add",
            "line": "        $db = \\Tuleap\\DB\\DBFactory::getMainTuleapDBConnection()->getDB();"
          },
          {
            "type": "add",
            "line": "        $db->run("
          },
          {
            "type": "add",
            "line": "            'DELETE FROM plugin_hudson_widget WHERE id = ? AND owner_id = ? AND owner_type = ?',"
          },
          {
            "type": "add",
            "line": "            $id,"
          },
          {
            "type": "add",
            "line": "            $this->owner_id,"
          },
          {
            "type": "add",
            "line": "            $this->owner_type,"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function getPreferences($widget_id)"
          },
          {
            "type": "context",
            "line": "         $request->valid(new Valid_String('cancel'));"
          },
          {
            "type": "context",
            "line": "         if (!$request->exist('cancel')) {"
          },
          {
            "type": "context",
            "line": "             $job_id = $request->get($this->widget_id . '_job_id');"
          },
          {
            "type": "delete",
            "line": "            $sql = \"UPDATE plugin_hudson_widget SET job_id=\" . $job_id . \" WHERE owner_id = \" . $this->owner_id . \" AND owner_type = '\" . $this->owner_type . \"' AND id = \" . (int) $request->get('content_id');"
          },
          {
            "type": "delete",
            "line": "            $res = db_query($sql);"
          },
          {
            "type": "add",
            "line": "            $db = \\Tuleap\\DB\\DBFactory::getMainTuleapDBConnection()->getDB();"
          },
          {
            "type": "add",
            "line": "            $db->run("
          },
          {
            "type": "add",
            "line": "                'UPDATE plugin_hudson_widget SET job_id=? WHERE owner_id = ? AND owner_type = ? AND id = ?',"
          },
          {
            "type": "add",
            "line": "                $job_id,"
          },
          {
            "type": "add",
            "line": "                $this->owner_id,"
          },
          {
            "type": "add",
            "line": "                $this->owner_type,"
          },
          {
            "type": "add",
            "line": "                $this->content_id,"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         return true;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     protected function getJobIdFromWidgetConfiguration()"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $sql = \"SELECT *"
          },
          {
            "type": "delete",
            "line": "                    FROM plugin_hudson_widget"
          },
          {
            "type": "delete",
            "line": "                    WHERE widget_name = '\" . db_es($this->widget_id) . \"'"
          },
          {
            "type": "delete",
            "line": "                      AND owner_id = \" . db_ei($this->owner_id) . \""
          },
          {
            "type": "delete",
            "line": "                      AND owner_type = '\" . db_es($this->owner_type) . \"'"
          },
          {
            "type": "delete",
            "line": "                      AND id = \" . db_ei($this->content_id);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $res = db_query($sql);"
          },
          {
            "type": "delete",
            "line": "        if ($res && db_numrows($res)) {"
          },
          {
            "type": "delete",
            "line": "            $data   = db_fetch_array($res);"
          },
          {
            "type": "delete",
            "line": "            return $data['job_id'];"
          },
          {
            "type": "add",
            "line": "        $db = \\Tuleap\\DB\\DBFactory::getMainTuleapDBConnection()->getDB();"
          },
          {
            "type": "add",
            "line": "        $job_id = $db->cell("
          },
          {
            "type": "add",
            "line": "            'SELECT job_id FROM plugin_hudson_widget WHERE widget_name = ? AND owner_id = ? AND owner_type = ? AND id = ?',"
          },
          {
            "type": "add",
            "line": "            $this->widget_id,"
          },
          {
            "type": "add",
            "line": "            $this->owner_id,"
          },
          {
            "type": "add",
            "line": "            $this->owner_type,"
          },
          {
            "type": "add",
            "line": "            $this->content_id,"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if ($job_id === false) {"
          },
          {
            "type": "add",
            "line": "            return null;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return null;"
          },
          {
            "type": "add",
            "line": "        return $job_id;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "92a9a8c65f3cbb2cd4414ca3a3b45a5754ba57b4",
    "files": [
      {
        "file": "core/config.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index 42f4276a5..2f7508bae 100644"
          },
          {
            "type": "context",
            "line": "--- a/core/config.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/core/config.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t\t\t'source_of_value' => '',"
          },
          {
            "type": "context",
            "line": " \t\t\t'show_in_conf_sample' => false,"
          },
          {
            "type": "context",
            "line": " \t\t),"
          },
          {
            "type": "add",
            "line": "\t\t'security.disable_inline_documents_sandbox' => array("
          },
          {
            "type": "add",
            "line": "\t\t\t'type' => 'bool',"
          },
          {
            "type": "add",
            "line": "\t\t\t'description' => 'If true then the sandbox for documents displayed in a browser tab will be disabled; enabling scripts and other interactive content. Note that setting this to true will open the application to potential XSS attacks!',"
          },
          {
            "type": "add",
            "line": "\t\t\t'default' => false,"
          },
          {
            "type": "add",
            "line": "\t\t\t'value' => false,"
          },
          {
            "type": "add",
            "line": "\t\t\t'source_of_value' => '',"
          },
          {
            "type": "add",
            "line": "\t\t\t'show_in_conf_sample' => false,"
          },
          {
            "type": "add",
            "line": "\t\t),"
          },
          {
            "type": "context",
            "line": " \t);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tpublic function IsProperty($sPropCode)"
          }
        ]
      },
      {
        "file": "datamodels/2.x/itop-portal-base/portal/src/controllers/objectcontroller.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index 461d0e853..41190d62c 100644"
          },
          {
            "type": "context",
            "line": "--- a/datamodels/2.x/itop-portal-base/portal/src/controllers/objectcontroller.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/datamodels/2.x/itop-portal-base/portal/src/controllers/objectcontroller.class.inc.php"
          },
          {
            "type": "context",
            "line": "         $aHeaders['Content-Type'] = $oDocument->GetMimeType();"
          },
          {
            "type": "context",
            "line": "         $aHeaders['Content-Disposition'] = (($sOperation === 'display') ? 'inline' : 'attachment') . ';filename=\"'.$oDocument->GetFileName().'\"';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t    // N°4129 - Prevent XSS attacks & other script executions"
          },
          {
            "type": "add",
            "line": "\t    if (utils::GetConfig()->Get('security.disable_inline_documents_sandbox') === false) {"
          },
          {
            "type": "add",
            "line": "\t\t    $aHeaders['Content-Security-Policy'] = 'sandbox';"
          },
          {
            "type": "add",
            "line": "\t    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return new Response($oDocument->GetData(), Response::HTTP_OK, $aHeaders);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "pages/ajax.render.php",
        "changes": [
          {
            "type": "context",
            "line": "index 41373f279..766dfbf3e 100644"
          },
          {
            "type": "context",
            "line": "--- a/pages/ajax.render.php"
          },
          {
            "type": "context",
            "line": "+++ b/pages/ajax.render.php"
          },
          {
            "type": "context",
            "line": " \t\t\t$sField = utils::ReadParam('field', '');"
          },
          {
            "type": "context",
            "line": " \t\t\tif (!empty($sClass) && ($sClass != 'InlineImage') && !empty($id) && !empty($sField))"
          },
          {
            "type": "context",
            "line": " \t\t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t$oPage->add_header('X-Frame-Options:'); // resets header, see N°3416"
          },
          {
            "type": "add",
            "line": "\t\t\t\t// Resets header, see N°3416"
          },
          {
            "type": "add",
            "line": "\t\t\t\t$oPage->add_header('X-Frame-Options:');"
          },
          {
            "type": "add",
            "line": "\t\t\t\t// N°4129 - Prevent XSS attacks & other script executions"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (utils::GetConfig()->Get('security.disable_inline_documents_sandbox') === false) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\t$oPage->add_header('Content-Security-Policy: sandbox;');"
          },
          {
            "type": "add",
            "line": "\t\t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\t\tormDocument::DownloadDocument($oPage, $sClass, $id, $sField, 'inline');"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": " \t\t\tbreak;"
          }
        ]
      }
    ]
  },
  {
    "commit": "93f273a28778e5da8e51096f021d2dc1adbf4ef3",
    "files": [
      {
        "file": "datamodels/2.x/itop-portal-base/portal/src/Form/ObjectFormManager.php",
        "changes": [
          {
            "type": "context",
            "line": "index 724e68f07..2e5ae8caf 100644"
          },
          {
            "type": "context",
            "line": "--- a/datamodels/2.x/itop-portal-base/portal/src/Form/ObjectFormManager.php"
          },
          {
            "type": "context",
            "line": "+++ b/datamodels/2.x/itop-portal-base/portal/src/Form/ObjectFormManager.php"
          },
          {
            "type": "context",
            "line": " \tprotected $aCallbackUrls = array();"
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * List of hidden fields, used for form update (eg. remove them from the form regarding they dependencies)"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @var array $aHiddenFieldsId"
          },
          {
            "type": "context",
            "line": " \t * @since 2.7.5"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tprotected $aHiddenFieldsId = array();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/**"
          },
          {
            "type": "add",
            "line": "\t * @param string|array $formManagerData value of the formmanager_data portal parameter, either JSON or object"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @return array formmanager_data as a PHP array"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @since 2.7.6 3.0.0 N°4384 method creation : factorize as this is used twice now"
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tprotected static function DecodeFormManagerData($formManagerData)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tif (is_array($formManagerData)) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn $formManagerData;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\treturn json_decode($formManagerData, true);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * @param string $sJson JSON data that must contain at least :"
          },
          {
            "type": "context",
            "line": " \t *       - formobject_class : The class of the object that is being edited/viewed"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function FromJSON($sJson, $bTrustContent = false)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tif (is_array($sJson)) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t$aJson = $sJson;"
          },
          {
            "type": "delete",
            "line": "\t\t} else {"
          },
          {
            "type": "delete",
            "line": "\t\t\t$aJson = json_decode($sJson, true);"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t$aJson = static::DecodeFormManagerData($sJson);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t$oConfig = utils::GetConfig();"
          },
          {
            "type": "context",
            "line": " \t\t$bIsContentCheckEnabled = $oConfig->GetModuleSetting(PORTAL_ID, 'enable_formmanager_content_check', true);"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tpublic static function CanTrustFormLayoutContent($sPostedFormManagerData, $aOriginalFormProperties)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\t$aPostedFormManagerData = json_decode($sPostedFormManagerData, true);"
          },
          {
            "type": "add",
            "line": "\t\t$aPostedFormManagerData = static::DecodeFormManagerData($sPostedFormManagerData);"
          },
          {
            "type": "context",
            "line": " \t\t$sPostedFormLayoutType = (isset($aPostedFormManagerData['formproperties']['layout']['type'])) ? $aPostedFormManagerData['formproperties']['layout']['type'] : '';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tif ($sPostedFormLayoutType === 'xhtml') {"
          }
        ]
      }
    ]
  },
  {
    "commit": "955a48e6319c8962e5cd421b07c00ab3c728968c",
    "files": [
      {
        "file": "bin/composer",
        "changes": [
          {
            "type": "context",
            "line": "index 642714f56..8bc77e660 100755"
          },
          {
            "type": "context",
            "line": "--- a/bin/composer"
          },
          {
            "type": "context",
            "line": "+++ b/bin/composer"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " if (PHP_SAPI !== 'cli' && PHP_SAPI !== 'phpdbg') {"
          },
          {
            "type": "add",
            "line": "    if (0 === strpos(__FILE__, 'phar:') && ini_get('register_argc_argv')) {"
          },
          {
            "type": "add",
            "line": "        echo 'Composer cannot be run safely on non-CLI SAPIs with register_argc_argv=On. Aborting.'.PHP_EOL;"
          },
          {
            "type": "add",
            "line": "        exit(1);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     echo 'Warning: Composer should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "95e091c921037b7b6564942845e7b738f6b95c9c",
    "files": [
      {
        "file": "bin/composer",
        "changes": [
          {
            "type": "context",
            "line": "index 55391b9b6..5a46937ca 100755"
          },
          {
            "type": "context",
            "line": "--- a/bin/composer"
          },
          {
            "type": "context",
            "line": "+++ b/bin/composer"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " if (PHP_SAPI !== 'cli' && PHP_SAPI !== 'phpdbg') {"
          },
          {
            "type": "add",
            "line": "    if (0 === strpos(__FILE__, 'phar:') && ini_get('register_argc_argv')) {"
          },
          {
            "type": "add",
            "line": "        echo 'Composer cannot be run safely on non-CLI SAPIs with register_argc_argv=On. Aborting.'.PHP_EOL;"
          },
          {
            "type": "add",
            "line": "        exit(1);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     echo 'Warning: Composer should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "9bbd7d76b6eaba33fe0236014f9b175d21232999",
    "files": [
      {
        "file": "pkg/cmd/server/defaults.go",
        "changes": [
          {
            "type": "context",
            "line": "index 2d91b548..00395ac9 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/cmd/server/defaults.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/cmd/server/defaults.go"
          },
          {
            "type": "context",
            "line": " // metrics and pprof endpoints."
          },
          {
            "type": "context",
            "line": " func MetricsHandler(telemetryRegistry *prometheus.Registry) http.Handler {"
          },
          {
            "type": "context",
            "line": " \tmux := http.NewServeMux()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmux.Handle(\"/metrics\", promhttp.Handler())"
          },
          {
            "type": "add",
            "line": "\tif telemetryRegistry != nil {"
          },
          {
            "type": "add",
            "line": "\t\tmux.Handle(\"/telemetry\", promhttp.HandlerFor(telemetryRegistry, promhttp.HandlerOpts{}))"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tmux.HandleFunc(\"/debug/pprof/\", pprof.Index)"
          },
          {
            "type": "delete",
            "line": "\tmux.HandleFunc(\"/debug/pprof/cmdline\", pprof.Cmdline)"
          },
          {
            "type": "context",
            "line": " \tmux.HandleFunc(\"/debug/pprof/profile\", pprof.Profile)"
          },
          {
            "type": "context",
            "line": " \tmux.HandleFunc(\"/debug/pprof/symbol\", pprof.Symbol)"
          },
          {
            "type": "context",
            "line": " \tmux.HandleFunc(\"/debug/pprof/trace\", pprof.Trace)"
          },
          {
            "type": "delete",
            "line": "\tif telemetryRegistry != nil {"
          },
          {
            "type": "delete",
            "line": "\t\tmux.Handle(\"/telemetry\", promhttp.HandlerFor(telemetryRegistry, promhttp.HandlerOpts{}))"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tmux.HandleFunc(\"/debug/pprof/cmdline\", func(w http.ResponseWriter, r *http.Request) {"
          },
          {
            "type": "add",
            "line": "\t\tw.WriteHeader(http.StatusNotFound)"
          },
          {
            "type": "add",
            "line": "\t\tfmt.Fprintf(w, \"This profile type has been disabled to avoid leaking private command-line arguments\")"
          },
          {
            "type": "add",
            "line": "\t})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \treturn mux"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "9e9e840925d7b8e76c76fdac1fab7e6e88c1c3b8",
    "files": [
      {
        "file": "certifi/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index af4bcc1..a3546f1 100644"
          },
          {
            "type": "context",
            "line": "--- a/certifi/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/certifi/__init__.py"
          },
          {
            "type": "context",
            "line": " from .core import contents, where"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " __all__ = [\"contents\", \"where\"]"
          },
          {
            "type": "delete",
            "line": "__version__ = \"2022.09.24\""
          },
          {
            "type": "add",
            "line": "__version__ = \"2022.12.07\""
          }
        ]
      },
      {
        "file": "certifi/cacert.pem",
        "changes": [
          {
            "type": "context",
            "line": "index 4005155..df9e4e3 100644"
          },
          {
            "type": "context",
            "line": "--- a/certifi/cacert.pem"
          },
          {
            "type": "context",
            "line": "+++ b/certifi/cacert.pem"
          },
          {
            "type": "context",
            "line": " ZQ=="
          },
          {
            "type": "context",
            "line": " -----END CERTIFICATE-----"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "# Issuer: CN=Network Solutions Certificate Authority O=Network Solutions L.L.C."
          },
          {
            "type": "delete",
            "line": "# Subject: CN=Network Solutions Certificate Authority O=Network Solutions L.L.C."
          },
          {
            "type": "delete",
            "line": "# Label: \"Network Solutions Certificate Authority\""
          },
          {
            "type": "delete",
            "line": "# Serial: 116697915152937497490437556386812487904"
          },
          {
            "type": "delete",
            "line": "# MD5 Fingerprint: d3:f3:a6:16:c0:fa:6b:1d:59:b1:2d:96:4d:0e:11:2e"
          },
          {
            "type": "delete",
            "line": "# SHA1 Fingerprint: 74:f8:a3:c3:ef:e7:b3:90:06:4b:83:90:3c:21:64:60:20:e5:df:ce"
          },
          {
            "type": "delete",
            "line": "# SHA256 Fingerprint: 15:f0:ba:00:a3:ac:7a:f3:ac:88:4c:07:2b:10:11:a0:77:bd:77:c0:97:f4:01:64:b2:f8:59:8a:bd:83:86:0c"
          },
          {
            "type": "context",
            "line": "------BEGIN CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": "MIID5jCCAs6gAwIBAgIQV8szb8JcFuZHFhfjkDFo4DANBgkqhkiG9w0BAQUFADBi"
          },
          {
            "type": "delete",
            "line": "MQswCQYDVQQGEwJVUzEhMB8GA1UEChMYTmV0d29yayBTb2x1dGlvbnMgTC5MLkMu"
          },
          {
            "type": "delete",
            "line": "MTAwLgYDVQQDEydOZXR3b3JrIFNvbHV0aW9ucyBDZXJ0aWZpY2F0ZSBBdXRob3Jp"
          },
          {
            "type": "delete",
            "line": "dHkwHhcNMDYxMjAxMDAwMDAwWhcNMjkxMjMxMjM1OTU5WjBiMQswCQYDVQQGEwJV"
          },
          {
            "type": "delete",
            "line": "UzEhMB8GA1UEChMYTmV0d29yayBTb2x1dGlvbnMgTC5MLkMuMTAwLgYDVQQDEydO"
          },
          {
            "type": "delete",
            "line": "ZXR3b3JrIFNvbHV0aW9ucyBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwggEiMA0GCSqG"
          },
          {
            "type": "delete",
            "line": "SIb3DQEBAQUAA4IBDwAwggEKAoIBAQDkvH6SMG3G2I4rC7xGzuAnlt7e+foS0zwz"
          },
          {
            "type": "delete",
            "line": "c7MEL7xxjOWftiJgPl9dzgn/ggwbmlFQGiaJ3dVhXRncEg8tCqJDXRfQNJIg6nPP"
          },
          {
            "type": "delete",
            "line": "OCwGJgl6cvf6UDL4wpPTaaIjzkGxzOTVHzbRijr4jGPiFFlp7Q3Tf2vouAPlT2rl"
          },
          {
            "type": "delete",
            "line": "mGNpSAW+Lv8ztumXWWn4Zxmuk2GWRBXTcrA/vGp97Eh/jcOrqnErU2lBUzS1sLnF"
          },
          {
            "type": "delete",
            "line": "BgrEsEX1QV1uiUV7PTsmjHTC5dLRfbIR1PtYMiKagMnc/Qzpf14Dl847ABSHJ3A4"
          },
          {
            "type": "delete",
            "line": "qY5usyd2mFHgBeMhqxrVhSI8KbWaFsWAqPS7azCPL0YCorEMIuDTAgMBAAGjgZcw"
          },
          {
            "type": "delete",
            "line": "gZQwHQYDVR0OBBYEFCEwyfsA106Y2oeqKtCnLrFAMadMMA4GA1UdDwEB/wQEAwIB"
          },
          {
            "type": "delete",
            "line": "BjAPBgNVHRMBAf8EBTADAQH/MFIGA1UdHwRLMEkwR6BFoEOGQWh0dHA6Ly9jcmwu"
          },
          {
            "type": "delete",
            "line": "bmV0c29sc3NsLmNvbS9OZXR3b3JrU29sdXRpb25zQ2VydGlmaWNhdGVBdXRob3Jp"
          },
          {
            "type": "delete",
            "line": "dHkuY3JsMA0GCSqGSIb3DQEBBQUAA4IBAQC7rkvnt1frf6ott3NHhWrB5KUd5Oc8"
          },
          {
            "type": "delete",
            "line": "6fRZZXe1eltajSU24HqXLjjAV2CDmAaDn7l2em5Q4LqILPxFzBiwmZVRDuwduIj/"
          },
          {
            "type": "delete",
            "line": "h1AcgsLj4DKAv6ALR8jDMe+ZZzKATxcheQxpXN5eNK4CtSbqUN9/GGUsyfJj4akH"
          },
          {
            "type": "delete",
            "line": "/nxxH2szJGoeBfcFaMBqEssuXmHLrijTfsK0ZpEmXzwuJF/LWA/rKOyvEZbz3Htv"
          },
          {
            "type": "delete",
            "line": "wKeI8lN3s2Berq4o2jUsbzRF0ybh3uxbTydrFny9RAQYgrOJeRcQcT16ohZO9QHN"
          },
          {
            "type": "delete",
            "line": "pGxlaKFJdlxDydi8NmdspZS11My5vWo1ViHe2MPr+8ukYEywVaCge1ey"
          },
          {
            "type": "context",
            "line": "------END CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " # Issuer: CN=COMODO ECC Certification Authority O=COMODO CA Limited"
          },
          {
            "type": "context",
            "line": " # Subject: CN=COMODO ECC Certification Authority O=COMODO CA Limited"
          },
          {
            "type": "context",
            "line": " # Label: \"COMODO ECC Certification Authority\""
          },
          {
            "type": "context",
            "line": " xwy8p2Fp8fc74SrL+SvzZpA3"
          },
          {
            "type": "context",
            "line": " -----END CERTIFICATE-----"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "# Issuer: CN=Staat der Nederlanden EV Root CA O=Staat der Nederlanden"
          },
          {
            "type": "delete",
            "line": "# Subject: CN=Staat der Nederlanden EV Root CA O=Staat der Nederlanden"
          },
          {
            "type": "delete",
            "line": "# Label: \"Staat der Nederlanden EV Root CA\""
          },
          {
            "type": "delete",
            "line": "# Serial: 10000013"
          },
          {
            "type": "delete",
            "line": "# MD5 Fingerprint: fc:06:af:7b:e8:1a:f1:9a:b4:e8:d2:70:1f:c0:f5:ba"
          },
          {
            "type": "delete",
            "line": "# SHA1 Fingerprint: 76:e2:7e:c1:4f:db:82:c1:c0:a6:75:b5:05:be:3d:29:b4:ed:db:bb"
          },
          {
            "type": "delete",
            "line": "# SHA256 Fingerprint: 4d:24:91:41:4c:fe:95:67:46:ec:4c:ef:a6:cf:6f:72:e2:8a:13:29:43:2f:9d:8a:90:7a:c4:cb:5d:ad:c1:5a"
          },
          {
            "type": "context",
            "line": "------BEGIN CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": "MIIFcDCCA1igAwIBAgIEAJiWjTANBgkqhkiG9w0BAQsFADBYMQswCQYDVQQGEwJO"
          },
          {
            "type": "delete",
            "line": "TDEeMBwGA1UECgwVU3RhYXQgZGVyIE5lZGVybGFuZGVuMSkwJwYDVQQDDCBTdGFh"
          },
          {
            "type": "delete",
            "line": "dCBkZXIgTmVkZXJsYW5kZW4gRVYgUm9vdCBDQTAeFw0xMDEyMDgxMTE5MjlaFw0y"
          },
          {
            "type": "delete",
            "line": "MjEyMDgxMTEwMjhaMFgxCzAJBgNVBAYTAk5MMR4wHAYDVQQKDBVTdGFhdCBkZXIg"
          },
          {
            "type": "delete",
            "line": "TmVkZXJsYW5kZW4xKTAnBgNVBAMMIFN0YWF0IGRlciBOZWRlcmxhbmRlbiBFViBS"
          },
          {
            "type": "delete",
            "line": "b290IENBMIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEA48d+ifkkSzrS"
          },
          {
            "type": "delete",
            "line": "M4M1LGns3Amk41GoJSt5uAg94JG6hIXGhaTK5skuU6TJJB79VWZxXSzFYGgEt9nC"
          },
          {
            "type": "delete",
            "line": "UiY4iKTWO0Cmws0/zZiTs1QUWJZV1VD+hq2kY39ch/aO5ieSZxeSAgMs3NZmdO3d"
          },
          {
            "type": "delete",
            "line": "Z//BYY1jTw+bbRcwJu+r0h8QoPnFfxZpgQNH7R5ojXKhTbImxrpsX23Wr9GxE46p"
          },
          {
            "type": "delete",
            "line": "rfNeaXUmGD5BKyF/7otdBwadQ8QpCiv8Kj6GyzyDOvnJDdrFmeK8eEEzduG/L13l"
          },
          {
            "type": "delete",
            "line": "pJhQDBXd4Pqcfzho0LKmeqfRMb1+ilgnQ7O6M5HTp5gVXJrm0w912fxBmJc+qiXb"
          },
          {
            "type": "delete",
            "line": "j5IusHsMX/FjqTf5m3VpTCgmJdrV8hJwRVXj33NeN/UhbJCONVrJ0yPr08C+eKxC"
          },
          {
            "type": "delete",
            "line": "KFhmpUZtcALXEPlLVPxdhkqHz3/KRawRWrUgUY0viEeXOcDPusBCAUCZSCELa6fS"
          },
          {
            "type": "delete",
            "line": "/ZbV0b5GnUngC6agIk440ME8MLxwjyx1zNDFjFE7PZQIZCZhfbnDZY8UnCHQqv0X"
          },
          {
            "type": "delete",
            "line": "cgOPvZuM5l5Tnrmd74K74bzickFbIZTTRTeU0d8JOV3nI6qaHcptqAqGhYqCvkIH"
          },
          {
            "type": "delete",
            "line": "1vI4gnPah1vlPNOePqc7nvQDs/nxfRN0Av+7oeX6AHkcpmZBiFxgV6YuCcS6/ZrP"
          },
          {
            "type": "delete",
            "line": "px9Aw7vMWgpVSzs4dlG4Y4uElBbmVvMCAwEAAaNCMEAwDwYDVR0TAQH/BAUwAwEB"
          },
          {
            "type": "delete",
            "line": "/zAOBgNVHQ8BAf8EBAMCAQYwHQYDVR0OBBYEFP6rAJCYniT8qcwaivsnuL8wbqg7"
          },
          {
            "type": "delete",
            "line": "MA0GCSqGSIb3DQEBCwUAA4ICAQDPdyxuVr5Os7aEAJSrR8kN0nbHhp8dB9O2tLsI"
          },
          {
            "type": "delete",
            "line": "eK9p0gtJ3jPFrK3CiAJ9Brc1AsFgyb/E6JTe1NOpEyVa/m6irn0F3H3zbPB+po3u"
          },
          {
            "type": "delete",
            "line": "2dfOWBfoqSmuc0iH55vKbimhZF8ZE/euBhD/UcabTVUlT5OZEAFTdfETzsemQUHS"
          },
          {
            "type": "delete",
            "line": "v4ilf0X8rLiltTMMgsT7B/Zq5SWEXwbKwYY5EdtYzXc7LMJMD16a4/CrPmEbUCTC"
          },
          {
            "type": "delete",
            "line": "wPTxGfARKbalGAKb12NMcIxHowNDXLldRqANb/9Zjr7dn3LDWyvfjFvO5QxGbJKy"
          },
          {
            "type": "delete",
            "line": "CqNMVEIYFRIYvdr8unRu/8G2oGTYqV9Vrp9canaW2HNnh/tNf1zuacpzEPuKqf2e"
          },
          {
            "type": "delete",
            "line": "vTY4SUmH9A4U8OmHuD+nT3pajnnUk+S7aFKErGzp85hwVXIy+TSrK0m1zSBi5Dp6"
          },
          {
            "type": "delete",
            "line": "Z2Orltxtrpfs/J92VoguZs9btsmksNcFuuEnL5O7Jiqik7Ab846+HUCjuTaPPoIa"
          },
          {
            "type": "delete",
            "line": "Gl6I6lD4WeKDRikL40Rc4ZW2aZCaFG+XroHPaO+Zmr615+F/+PoTRxZMzG0IQOeL"
          },
          {
            "type": "delete",
            "line": "eG9QgkRQP2YGiqtDhFZKDyAthg710tvSeopLzaXoTvFeJiUBWSOgftL2fiFX1ye8"
          },
          {
            "type": "delete",
            "line": "FVdMpEbB4IMeDExNH08GGeL5qPQ6gqGyeUN51q1veieQA6TqJIc/2b3Z6fJfUEkc"
          },
          {
            "type": "delete",
            "line": "7uzXLg=="
          },
          {
            "type": "context",
            "line": "------END CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " # Issuer: CN=IdenTrust Commercial Root CA 1 O=IdenTrust"
          },
          {
            "type": "context",
            "line": " # Subject: CN=IdenTrust Commercial Root CA 1 O=IdenTrust"
          },
          {
            "type": "context",
            "line": " # Label: \"IdenTrust Commercial Root CA 1\""
          },
          {
            "type": "context",
            "line": " MTd61X8kreS8/f3MboPoDKi3QWwH3b08hpcv0g=="
          },
          {
            "type": "context",
            "line": " -----END CERTIFICATE-----"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "# Issuer: CN=TrustCor RootCert CA-1 O=TrustCor Systems S. de R.L. OU=TrustCor Certificate Authority"
          },
          {
            "type": "delete",
            "line": "# Subject: CN=TrustCor RootCert CA-1 O=TrustCor Systems S. de R.L. OU=TrustCor Certificate Authority"
          },
          {
            "type": "delete",
            "line": "# Label: \"TrustCor RootCert CA-1\""
          },
          {
            "type": "delete",
            "line": "# Serial: 15752444095811006489"
          },
          {
            "type": "delete",
            "line": "# MD5 Fingerprint: 6e:85:f1:dc:1a:00:d3:22:d5:b2:b2:ac:6b:37:05:45"
          },
          {
            "type": "delete",
            "line": "# SHA1 Fingerprint: ff:bd:cd:e7:82:c8:43:5e:3c:6f:26:86:5c:ca:a8:3a:45:5b:c3:0a"
          },
          {
            "type": "delete",
            "line": "# SHA256 Fingerprint: d4:0e:9c:86:cd:8f:e4:68:c1:77:69:59:f4:9e:a7:74:fa:54:86:84:b6:c4:06:f3:90:92:61:f4:dc:e2:57:5c"
          },
          {
            "type": "context",
            "line": "------BEGIN CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": "MIIEMDCCAxigAwIBAgIJANqb7HHzA7AZMA0GCSqGSIb3DQEBCwUAMIGkMQswCQYD"
          },
          {
            "type": "delete",
            "line": "VQQGEwJQQTEPMA0GA1UECAwGUGFuYW1hMRQwEgYDVQQHDAtQYW5hbWEgQ2l0eTEk"
          },
          {
            "type": "delete",
            "line": "MCIGA1UECgwbVHJ1c3RDb3IgU3lzdGVtcyBTLiBkZSBSLkwuMScwJQYDVQQLDB5U"
          },
          {
            "type": "delete",
            "line": "cnVzdENvciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxHzAdBgNVBAMMFlRydXN0Q29y"
          },
          {
            "type": "delete",
            "line": "IFJvb3RDZXJ0IENBLTEwHhcNMTYwMjA0MTIzMjE2WhcNMjkxMjMxMTcyMzE2WjCB"
          },
          {
            "type": "delete",
            "line": "pDELMAkGA1UEBhMCUEExDzANBgNVBAgMBlBhbmFtYTEUMBIGA1UEBwwLUGFuYW1h"
          },
          {
            "type": "delete",
            "line": "IENpdHkxJDAiBgNVBAoMG1RydXN0Q29yIFN5c3RlbXMgUy4gZGUgUi5MLjEnMCUG"
          },
          {
            "type": "delete",
            "line": "A1UECwweVHJ1c3RDb3IgQ2VydGlmaWNhdGUgQXV0aG9yaXR5MR8wHQYDVQQDDBZU"
          },
          {
            "type": "delete",
            "line": "cnVzdENvciBSb290Q2VydCBDQS0xMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB"
          },
          {
            "type": "delete",
            "line": "CgKCAQEAv463leLCJhJrMxnHQFgKq1mqjQCj/IDHUHuO1CAmujIS2CNUSSUQIpid"
          },
          {
            "type": "delete",
            "line": "RtLByZ5OGy4sDjjzGiVoHKZaBeYei0i/mJZ0PmnK6bV4pQa81QBeCQryJ3pS/C3V"
          },
          {
            "type": "delete",
            "line": "seq0iWEk8xoT26nPUu0MJLq5nux+AHT6k61sKZKuUbS701e/s/OojZz0JEsq1pme"
          },
          {
            "type": "delete",
            "line": "9J7+wH5COucLlVPat2gOkEz7cD+PSiyU8ybdY2mplNgQTsVHCJCZGxdNuWxu72CV"
          },
          {
            "type": "delete",
            "line": "EY4hgLW9oHPY0LJ3xEXqWib7ZnZ2+AYfYW0PVcWDtxBWcgYHpfOxGgMFZA6dWorW"
          },
          {
            "type": "delete",
            "line": "hnAbJN7+KIor0Gqw/Hqi3LJ5DotlDwIDAQABo2MwYTAdBgNVHQ4EFgQU7mtJPHo/"
          },
          {
            "type": "delete",
            "line": "DeOxCbeKyKsZn3MzUOcwHwYDVR0jBBgwFoAU7mtJPHo/DeOxCbeKyKsZn3MzUOcw"
          },
          {
            "type": "delete",
            "line": "DwYDVR0TAQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYwDQYJKoZIhvcNAQELBQAD"
          },
          {
            "type": "delete",
            "line": "ggEBACUY1JGPE+6PHh0RU9otRCkZoB5rMZ5NDp6tPVxBb5UrJKF5mDo4Nvu7Zp5I"
          },
          {
            "type": "delete",
            "line": "/5CQ7z3UuJu0h3U/IJvOcs+hVcFNZKIZBqEHMwwLKeXx6quj7LUKdJDHfXLy11yf"
          },
          {
            "type": "delete",
            "line": "ke+Ri7fc7Waiz45mO7yfOgLgJ90WmMCV1Aqk5IGadZQ1nJBfiDcGrVmVCrDRZ9MZ"
          },
          {
            "type": "delete",
            "line": "yonnMlo2HD6CqFqTvsbQZJG2z9m2GM/bftJlo6bEjhcxwft+dtvTheNYsnd6djts"
          },
          {
            "type": "delete",
            "line": "L1Ac59v2Z3kf9YKVmgenFK+P3CghZwnS1k1aHBkcjndcw5QkPTJrS37UeJSDvjdN"
          },
          {
            "type": "delete",
            "line": "zl/HHk484IkzlQsPpTLWPFp5LBk="
          },
          {
            "type": "context",
            "line": "------END CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "# Issuer: CN=TrustCor RootCert CA-2 O=TrustCor Systems S. de R.L. OU=TrustCor Certificate Authority"
          },
          {
            "type": "delete",
            "line": "# Subject: CN=TrustCor RootCert CA-2 O=TrustCor Systems S. de R.L. OU=TrustCor Certificate Authority"
          },
          {
            "type": "delete",
            "line": "# Label: \"TrustCor RootCert CA-2\""
          },
          {
            "type": "delete",
            "line": "# Serial: 2711694510199101698"
          },
          {
            "type": "delete",
            "line": "# MD5 Fingerprint: a2:e1:f8:18:0b:ba:45:d5:c7:41:2a:bb:37:52:45:64"
          },
          {
            "type": "delete",
            "line": "# SHA1 Fingerprint: b8:be:6d:cb:56:f1:55:b9:63:d4:12:ca:4e:06:34:c7:94:b2:1c:c0"
          },
          {
            "type": "delete",
            "line": "# SHA256 Fingerprint: 07:53:e9:40:37:8c:1b:d5:e3:83:6e:39:5d:ae:a5:cb:83:9e:50:46:f1:bd:0e:ae:19:51:cf:10:fe:c7:c9:65"
          },
          {
            "type": "context",
            "line": "------BEGIN CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": "MIIGLzCCBBegAwIBAgIIJaHfyjPLWQIwDQYJKoZIhvcNAQELBQAwgaQxCzAJBgNV"
          },
          {
            "type": "delete",
            "line": "BAYTAlBBMQ8wDQYDVQQIDAZQYW5hbWExFDASBgNVBAcMC1BhbmFtYSBDaXR5MSQw"
          },
          {
            "type": "delete",
            "line": "IgYDVQQKDBtUcnVzdENvciBTeXN0ZW1zIFMuIGRlIFIuTC4xJzAlBgNVBAsMHlRy"
          },
          {
            "type": "delete",
            "line": "dXN0Q29yIENlcnRpZmljYXRlIEF1dGhvcml0eTEfMB0GA1UEAwwWVHJ1c3RDb3Ig"
          },
          {
            "type": "delete",
            "line": "Um9vdENlcnQgQ0EtMjAeFw0xNjAyMDQxMjMyMjNaFw0zNDEyMzExNzI2MzlaMIGk"
          },
          {
            "type": "delete",
            "line": "MQswCQYDVQQGEwJQQTEPMA0GA1UECAwGUGFuYW1hMRQwEgYDVQQHDAtQYW5hbWEg"
          },
          {
            "type": "delete",
            "line": "Q2l0eTEkMCIGA1UECgwbVHJ1c3RDb3IgU3lzdGVtcyBTLiBkZSBSLkwuMScwJQYD"
          },
          {
            "type": "delete",
            "line": "VQQLDB5UcnVzdENvciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxHzAdBgNVBAMMFlRy"
          },
          {
            "type": "delete",
            "line": "dXN0Q29yIFJvb3RDZXJ0IENBLTIwggIiMA0GCSqGSIb3DQEBAQUAA4ICDwAwggIK"
          },
          {
            "type": "delete",
            "line": "AoICAQCnIG7CKqJiJJWQdsg4foDSq8GbZQWU9MEKENUCrO2fk8eHyLAnK0IMPQo+"
          },
          {
            "type": "delete",
            "line": "QVqedd2NyuCb7GgypGmSaIwLgQ5WoD4a3SwlFIIvl9NkRvRUqdw6VC0xK5mC8tkq"
          },
          {
            "type": "delete",
            "line": "1+9xALgxpL56JAfDQiDyitSSBBtlVkxs1Pu2YVpHI7TYabS3OtB0PAx1oYxOdqHp"
          },
          {
            "type": "delete",
            "line": "2yqlO/rOsP9+aij9JxzIsekp8VduZLTQwRVtDr4uDkbIXvRR/u8OYzo7cbrPb1nK"
          },
          {
            "type": "delete",
            "line": "DOObXUm4TOJXsZiKQlecdu/vvdFoqNL0Cbt3Nb4lggjEFixEIFapRBF37120Hape"
          },
          {
            "type": "delete",
            "line": "az6LMvYHL1cEksr1/p3C6eizjkxLAjHZ5DxIgif3GIJ2SDpxsROhOdUuxTTCHWKF"
          },
          {
            "type": "delete",
            "line": "3wP+TfSvPd9cW436cOGlfifHhi5qjxLGhF5DUVCcGZt45vz27Ud+ez1m7xMTiF88"
          },
          {
            "type": "delete",
            "line": "oWP7+ayHNZ/zgp6kPwqcMWmLmaSISo5uZk3vFsQPeSghYA2FFn3XVDjxklb9tTNM"
          },
          {
            "type": "delete",
            "line": "g9zXEJ9L/cb4Qr26fHMC4P99zVvh1Kxhe1fVSntb1IVYJ12/+CtgrKAmrhQhJ8Z3"
          },
          {
            "type": "delete",
            "line": "mjOAPF5GP/fDsaOGM8boXg25NSyqRsGFAnWAoOsk+xWq5Gd/bnc/9ASKL3x74xdh"
          },
          {
            "type": "delete",
            "line": "8N0JqSDIvgmk0H5Ew7IwSjiqqewYmgeCK9u4nBit2uBGF6zPXQIDAQABo2MwYTAd"
          },
          {
            "type": "delete",
            "line": "BgNVHQ4EFgQU2f4hQG6UnrybPZx9mCAZ5YwwYrIwHwYDVR0jBBgwFoAU2f4hQG6U"
          },
          {
            "type": "delete",
            "line": "nrybPZx9mCAZ5YwwYrIwDwYDVR0TAQH/BAUwAwEB/zAOBgNVHQ8BAf8EBAMCAYYw"
          },
          {
            "type": "delete",
            "line": "DQYJKoZIhvcNAQELBQADggIBAJ5Fngw7tu/hOsh80QA9z+LqBrWyOrsGS2h60COX"
          },
          {
            "type": "delete",
            "line": "dKcs8AjYeVrXWoSK2BKaG9l9XE1wxaX5q+WjiYndAfrs3fnpkpfbsEZC89NiqpX+"
          },
          {
            "type": "delete",
            "line": "MWcUaViQCqoL7jcjx1BRtPV+nuN79+TMQjItSQzL/0kMmx40/W5ulop5A7Zv2wnL"
          },
          {
            "type": "delete",
            "line": "/V9lFDfhOPXzYRZY5LVtDQsEGz9QLX+zx3oaFoBg+Iof6Rsqxvm6ARppv9JYx1RX"
          },
          {
            "type": "delete",
            "line": "CI/hOWB3S6xZhBqI8d3LT3jX5+EzLfzuQfogsL7L9ziUwOHQhQ+77Sxzq+3+knYa"
          },
          {
            "type": "delete",
            "line": "ZH9bDTMJBzN7Bj8RpFxwPIXAz+OQqIN3+tvmxYxoZxBnpVIt8MSZj3+/0WvitUfW"
          },
          {
            "type": "delete",
            "line": "2dCFmU2Umw9Lje4AWkcdEQOsQRivh7dvDDqPys/cA8GiCcjl/YBeyGBCARsaU1q7"
          },
          {
            "type": "delete",
            "line": "N6a3vLqE6R5sGtRk2tRD/pOLS/IseRYQ1JMLiI+h2IYURpFHmygk71dSTlxCnKr3"
          },
          {
            "type": "delete",
            "line": "Sewn6EAes6aJInKc9Q0ztFijMDvd1GpUk74aTfOTlPf8hAs/hCBcNANExdqtvArB"
          },
          {
            "type": "delete",
            "line": "As8e5ZTZ845b2EzwnexhF7sUMlQMAimTHpKG9n/v55IFDlndmQguLvqcAFLTxWYp"
          },
          {
            "type": "delete",
            "line": "5KeXRKQOKIETNcX2b2TmQcTVL8w0RSXPQQCWPUouwpaYT05KnJe32x+SMsj/D1Fu"
          },
          {
            "type": "delete",
            "line": "1uwJ"
          },
          {
            "type": "context",
            "line": "------END CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "# Issuer: CN=TrustCor ECA-1 O=TrustCor Systems S. de R.L. OU=TrustCor Certificate Authority"
          },
          {
            "type": "delete",
            "line": "# Subject: CN=TrustCor ECA-1 O=TrustCor Systems S. de R.L. OU=TrustCor Certificate Authority"
          },
          {
            "type": "delete",
            "line": "# Label: \"TrustCor ECA-1\""
          },
          {
            "type": "delete",
            "line": "# Serial: 9548242946988625984"
          },
          {
            "type": "delete",
            "line": "# MD5 Fingerprint: 27:92:23:1d:0a:f5:40:7c:e9:e6:6b:9d:d8:f5:e7:6c"
          },
          {
            "type": "delete",
            "line": "# SHA1 Fingerprint: 58:d1:df:95:95:67:6b:63:c0:f0:5b:1c:17:4d:8b:84:0b:c8:78:bd"
          },
          {
            "type": "delete",
            "line": "# SHA256 Fingerprint: 5a:88:5d:b1:9c:01:d9:12:c5:75:93:88:93:8c:af:bb:df:03:1a:b2:d4:8e:91:ee:15:58:9b:42:97:1d:03:9c"
          },
          {
            "type": "context",
            "line": "------BEGIN CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": "MIIEIDCCAwigAwIBAgIJAISCLF8cYtBAMA0GCSqGSIb3DQEBCwUAMIGcMQswCQYD"
          },
          {
            "type": "delete",
            "line": "VQQGEwJQQTEPMA0GA1UECAwGUGFuYW1hMRQwEgYDVQQHDAtQYW5hbWEgQ2l0eTEk"
          },
          {
            "type": "delete",
            "line": "MCIGA1UECgwbVHJ1c3RDb3IgU3lzdGVtcyBTLiBkZSBSLkwuMScwJQYDVQQLDB5U"
          },
          {
            "type": "delete",
            "line": "cnVzdENvciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxFzAVBgNVBAMMDlRydXN0Q29y"
          },
          {
            "type": "delete",
            "line": "IEVDQS0xMB4XDTE2MDIwNDEyMzIzM1oXDTI5MTIzMTE3MjgwN1owgZwxCzAJBgNV"
          },
          {
            "type": "delete",
            "line": "BAYTAlBBMQ8wDQYDVQQIDAZQYW5hbWExFDASBgNVBAcMC1BhbmFtYSBDaXR5MSQw"
          },
          {
            "type": "delete",
            "line": "IgYDVQQKDBtUcnVzdENvciBTeXN0ZW1zIFMuIGRlIFIuTC4xJzAlBgNVBAsMHlRy"
          },
          {
            "type": "delete",
            "line": "dXN0Q29yIENlcnRpZmljYXRlIEF1dGhvcml0eTEXMBUGA1UEAwwOVHJ1c3RDb3Ig"
          },
          {
            "type": "delete",
            "line": "RUNBLTEwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDPj+ARtZ+odnbb"
          },
          {
            "type": "delete",
            "line": "3w9U73NjKYKtR8aja+3+XzP4Q1HpGjORMRegdMTUpwHmspI+ap3tDvl0mEDTPwOA"
          },
          {
            "type": "delete",
            "line": "BoJA6LHip1GnHYMma6ve+heRK9jGrB6xnhkB1Zem6g23xFUfJ3zSCNV2HykVh0A5"
          },
          {
            "type": "delete",
            "line": "3ThFEXXQmqc04L/NyFIduUd+Dbi7xgz2c1cWWn5DkR9VOsZtRASqnKmcp0yJF4Ou"
          },
          {
            "type": "delete",
            "line": "owReUoCLHhIlERnXDH19MURB6tuvsBzvgdAsxZohmz3tQjtQJvLsznFhBmIhVE5/"
          },
          {
            "type": "delete",
            "line": "wZ0+fyCMgMsq2JdiyIMzkX2woloPV+g7zPIlstR8L+xNxqE6FXrntl019fZISjZF"
          },
          {
            "type": "delete",
            "line": "ZtS6mFjBAgMBAAGjYzBhMB0GA1UdDgQWBBREnkj1zG1I1KBLf/5ZJC+Dl5mahjAf"
          },
          {
            "type": "delete",
            "line": "BgNVHSMEGDAWgBREnkj1zG1I1KBLf/5ZJC+Dl5mahjAPBgNVHRMBAf8EBTADAQH/"
          },
          {
            "type": "delete",
            "line": "MA4GA1UdDwEB/wQEAwIBhjANBgkqhkiG9w0BAQsFAAOCAQEABT41XBVwm8nHc2Fv"
          },
          {
            "type": "delete",
            "line": "civUwo/yQ10CzsSUuZQRg2dd4mdsdXa/uwyqNsatR5Nj3B5+1t4u/ukZMjgDfxT2"
          },
          {
            "type": "delete",
            "line": "AHMsWbEhBuH7rBiVDKP/mZb3Kyeb1STMHd3BOuCYRLDE5D53sXOpZCz2HAF8P11F"
          },
          {
            "type": "delete",
            "line": "hcCF5yWPldwX8zyfGm6wyuMdKulMY/okYWLW2n62HGz1Ah3UKt1VkOsqEUc8Ll50"
          },
          {
            "type": "delete",
            "line": "soIipX1TH0XsJ5F95yIW6MBoNtjG8U+ARDL54dHRHareqKucBK+tIA5kmE2la8BI"
          },
          {
            "type": "delete",
            "line": "WJZpTdwHjFGTot+fDz2LYLSCjaoITmJF4PkL0uDgPFveXHEnJcLmA4GLEFPjx1Wi"
          },
          {
            "type": "delete",
            "line": "tJ/X5g=="
          },
          {
            "type": "context",
            "line": "------END CERTIFICATE-----"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " # Issuer: CN=SSL.com Root Certification Authority RSA O=SSL Corporation"
          },
          {
            "type": "context",
            "line": " # Subject: CN=SSL.com Root Certification Authority RSA O=SSL Corporation"
          },
          {
            "type": "context",
            "line": " # Label: \"SSL.com Root Certification Authority RSA\""
          }
        ]
      }
    ]
  },
  {
    "commit": "9f75e2e562fa0c0482f3dde6fc7399a9070b4a3d",
    "files": [
      {
        "file": "django/core/validators.py",
        "changes": [
          {
            "type": "context",
            "line": "index f9abec602c..731ccf2d46 100644"
          },
          {
            "type": "context",
            "line": "--- a/django/core/validators.py"
          },
          {
            "type": "context",
            "line": "+++ b/django/core/validators.py"
          },
          {
            "type": "context",
            "line": "     ul = '\\u00a1-\\uffff'  # Unicode letters range (must not be a raw string)."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # IP patterns"
          },
          {
            "type": "delete",
            "line": "    ipv4_re = r'(?:25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}'"
          },
          {
            "type": "add",
            "line": "    ipv4_re = r'(?:0|25[0-5]|2[0-4]\\d|1\\d?\\d?|[1-9]\\d?)(?:\\.(?:0|25[0-5]|2[0-4]\\d|1\\d?\\d?|[1-9]\\d?)){3}'"
          },
          {
            "type": "context",
            "line": "     ipv6_re = r'\\[[0-9a-f:.]+\\]'  # (simple regex, validated later)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # Host patterns"
          },
          {
            "type": "context",
            "line": "         ipaddress.IPv4Address(value)"
          },
          {
            "type": "context",
            "line": "     except ValueError:"
          },
          {
            "type": "context",
            "line": "         raise ValidationError(_('Enter a valid IPv4 address.'), code='invalid', params={'value': value})"
          },
          {
            "type": "add",
            "line": "    else:"
          },
          {
            "type": "add",
            "line": "        # Leading zeros are forbidden to avoid ambiguity with the octal"
          },
          {
            "type": "add",
            "line": "        # notation. This restriction is included in Python 3.9.5+."
          },
          {
            "type": "add",
            "line": "        # TODO: Remove when dropping support for PY39."
          },
          {
            "type": "add",
            "line": "        if any("
          },
          {
            "type": "add",
            "line": "            octet != '0' and octet[0] == '0'"
          },
          {
            "type": "add",
            "line": "            for octet in value.split('.')"
          },
          {
            "type": "add",
            "line": "        ):"
          },
          {
            "type": "add",
            "line": "            raise ValidationError("
          },
          {
            "type": "add",
            "line": "                _('Enter a valid IPv4 address.'),"
          },
          {
            "type": "add",
            "line": "                code='invalid',"
          },
          {
            "type": "add",
            "line": "                params={'value': value},"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def validate_ipv6_address(value):"
          }
        ]
      },
      {
        "file": "docs/releases/2.2.24.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 9bcf7037c4..1064fc53a0 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/releases/2.2.24.txt"
          },
          {
            "type": "context",
            "line": "+++ b/docs/releases/2.2.24.txt"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " As a mitigation, path sanitation is now applied and only files within the"
          },
          {
            "type": "context",
            "line": " template root directories can be loaded."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "CVE-2021-33571: Possible indeterminate SSRF, RFI, and LFI attacks since validators accepted leading zeros in IPv4 addresses"
          },
          {
            "type": "add",
            "line": "==========================================================================================================================="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ":class:`~django.core.validators.URLValidator`,"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv4_address`, and"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv46_address` didn't prohibit leading"
          },
          {
            "type": "add",
            "line": "zeros in octal literals. If you used such values you could suffer from"
          },
          {
            "type": "add",
            "line": "indeterminate SSRF, RFI, and LFI attacks."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv4_address` and"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv46_address` validators were not"
          },
          {
            "type": "add",
            "line": "affected on Python 3.9.5+."
          }
        ]
      },
      {
        "file": "docs/releases/3.1.12.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 7d8ee8447e..0700f40849 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/releases/3.1.12.txt"
          },
          {
            "type": "context",
            "line": "+++ b/docs/releases/3.1.12.txt"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " As a mitigation, path sanitation is now applied and only files within the"
          },
          {
            "type": "context",
            "line": " template root directories can be loaded."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "CVE-2021-33571: Possible indeterminate SSRF, RFI, and LFI attacks since validators accepted leading zeros in IPv4 addresses"
          },
          {
            "type": "add",
            "line": "==========================================================================================================================="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ":class:`~django.core.validators.URLValidator`,"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv4_address`, and"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv46_address` didn't prohibit leading"
          },
          {
            "type": "add",
            "line": "zeros in octal literals. If you used such values you could suffer from"
          },
          {
            "type": "add",
            "line": "indeterminate SSRF, RFI, and LFI attacks."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv4_address` and"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv46_address` validators were not"
          },
          {
            "type": "add",
            "line": "affected on Python 3.9.5+."
          }
        ]
      },
      {
        "file": "docs/releases/3.2.4.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 7c1b195d00..496ea6ec3f 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/releases/3.2.4.txt"
          },
          {
            "type": "context",
            "line": "+++ b/docs/releases/3.2.4.txt"
          },
          {
            "type": "context",
            "line": " As a mitigation, path sanitation is now applied and only files within the"
          },
          {
            "type": "context",
            "line": " template root directories can be loaded."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "CVE-2021-33571: Possible indeterminate SSRF, RFI, and LFI attacks since validators accepted leading zeros in IPv4 addresses"
          },
          {
            "type": "add",
            "line": "==========================================================================================================================="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ":class:`~django.core.validators.URLValidator`,"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv4_address`, and"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv46_address` didn't prohibit leading"
          },
          {
            "type": "add",
            "line": "zeros in octal literals. If you used such values you could suffer from"
          },
          {
            "type": "add",
            "line": "indeterminate SSRF, RFI, and LFI attacks."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv4_address` and"
          },
          {
            "type": "add",
            "line": ":func:`~django.core.validators.validate_ipv46_address` validators were not"
          },
          {
            "type": "add",
            "line": "affected on Python 3.9.5+."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " Bugfixes"
          },
          {
            "type": "context",
            "line": " ========"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "tests/validators/invalid_urls.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 3a92bbb9b4..86a080bf33 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/validators/invalid_urls.txt"
          },
          {
            "type": "context",
            "line": "+++ b/tests/validators/invalid_urls.txt"
          },
          {
            "type": "context",
            "line": " http://123.123.123"
          },
          {
            "type": "context",
            "line": " http://3628126748"
          },
          {
            "type": "context",
            "line": " http://123"
          },
          {
            "type": "add",
            "line": "http://000.000.000.000"
          },
          {
            "type": "add",
            "line": "http://016.016.016.016"
          },
          {
            "type": "add",
            "line": "http://192.168.000.001"
          },
          {
            "type": "add",
            "line": "http://01.2.3.4"
          },
          {
            "type": "add",
            "line": "http://01.2.3.4"
          },
          {
            "type": "add",
            "line": "http://1.02.3.4"
          },
          {
            "type": "add",
            "line": "http://1.2.03.4"
          },
          {
            "type": "add",
            "line": "http://1.2.3.04"
          },
          {
            "type": "context",
            "line": " http://.www.foo.bar/"
          },
          {
            "type": "context",
            "line": " http://.www.foo.bar./"
          },
          {
            "type": "context",
            "line": " http://[::1:2::3]:8080/"
          }
        ]
      },
      {
        "file": "tests/validators/tests.py",
        "changes": [
          {
            "type": "context",
            "line": "index 09d5c40ff5..e39d0e3a1c 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/validators/tests.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/validators/tests.py"
          },
          {
            "type": "context",
            "line": "     (validate_ipv4_address, '1.1.1.1\\n', ValidationError),"
          },
          {
            "type": "context",
            "line": "     (validate_ipv4_address, '٧.2٥.3٣.243', ValidationError),"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # Leading zeros are forbidden to avoid ambiguity with the octal notation."
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '000.000.000.000', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '016.016.016.016', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '192.168.000.001', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '01.2.3.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '01.2.3.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '1.02.3.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '1.2.03.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv4_address, '1.2.3.04', ValidationError),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # validate_ipv6_address uses django.utils.ipv6, which"
          },
          {
            "type": "context",
            "line": "     # is tested in much greater detail in its own testcase"
          },
          {
            "type": "context",
            "line": "     (validate_ipv6_address, 'fe80::1', None),"
          },
          {
            "type": "context",
            "line": "     (validate_ipv46_address, '::zzz', ValidationError),"
          },
          {
            "type": "context",
            "line": "     (validate_ipv46_address, '12345::', ValidationError),"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # Leading zeros are forbidden to avoid ambiguity with the octal notation."
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '000.000.000.000', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '016.016.016.016', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '192.168.000.001', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '01.2.3.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '01.2.3.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '1.02.3.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '1.2.03.4', ValidationError),"
          },
          {
            "type": "add",
            "line": "    (validate_ipv46_address, '1.2.3.04', ValidationError),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     (validate_comma_separated_integer_list, '1', None),"
          },
          {
            "type": "context",
            "line": "     (validate_comma_separated_integer_list, '12', None),"
          },
          {
            "type": "context",
            "line": "     (validate_comma_separated_integer_list, '1,2', None),"
          }
        ]
      },
      {
        "file": "tests/validators/valid_urls.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 3f8bf839b0..53fde9df7f 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/validators/valid_urls.txt"
          },
          {
            "type": "context",
            "line": "+++ b/tests/validators/valid_urls.txt"
          },
          {
            "type": "context",
            "line": " http://255.255.255.255"
          },
          {
            "type": "context",
            "line": " http://224.0.0.0"
          },
          {
            "type": "context",
            "line": " http://224.1.1.1"
          },
          {
            "type": "add",
            "line": "http://111.112.113.114/"
          },
          {
            "type": "add",
            "line": "http://88.88.88.88/"
          },
          {
            "type": "add",
            "line": "http://11.12.13.14/"
          },
          {
            "type": "add",
            "line": "http://10.20.30.40/"
          },
          {
            "type": "add",
            "line": "http://1.2.3.4/"
          },
          {
            "type": "add",
            "line": "http://127.0.01.09.home.lan"
          },
          {
            "type": "context",
            "line": " http://aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.example.com"
          },
          {
            "type": "context",
            "line": " http://example.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.com"
          },
          {
            "type": "context",
            "line": " http://example.aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
          }
        ]
      }
    ]
  },
  {
    "commit": "a108186e7538676c4bf6e615f793f3b787a09b91",
    "files": [
      {
        "file": "plugins/ldap/bin/ldap_sync.php",
        "changes": [
          {
            "type": "context",
            "line": "index c1ae6463932..3c11e02031a 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/ldap/bin/ldap_sync.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/ldap/bin/ldap_sync.php"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UserPermissionsDao;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " ini_set('max_execution_time', 0);"
          },
          {
            "type": "context",
            "line": " ini_set('memory_limit', -1);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 new \\Tuleap\\Project\\UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                 UserManager::instance(),"
          },
          {
            "type": "context",
            "line": "                 new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                new UGroupManager()"
          },
          {
            "type": "add",
            "line": "                new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "                new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "             );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             $ldapCleanUpManager = new LDAP_CleanUpManager($user_remover, $retentionPeriod);"
          }
        ]
      },
      {
        "file": "plugins/ldap/include/LDAP_DirectorySynchronization.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 58d09999111..5e53d9f41c3 100755"
          },
          {
            "type": "context",
            "line": "--- a/plugins/ldap/include/LDAP_DirectorySynchronization.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/ldap/include/LDAP_DirectorySynchronization.class.php"
          },
          {
            "type": "context",
            "line": " require_once 'LDAP_UserManager.class.php';"
          },
          {
            "type": "context",
            "line": " require_once 'LDAP_SyncNotificationManager.class.php';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UserPermissionsDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemover;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemoverDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\User\\PasswordVerifier;"
          },
          {
            "type": "context",
            "line": "         return EventManager::instance();"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    private function getUserRemover()"
          },
          {
            "type": "add",
            "line": "    private function getUserRemover(): UserRemover"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return new UserRemover("
          },
          {
            "type": "context",
            "line": "             ProjectManager::instance(),"
          },
          {
            "type": "context",
            "line": "             new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "             UserManager::instance(),"
          },
          {
            "type": "context",
            "line": "             new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "            new UGroupManager()"
          },
          {
            "type": "add",
            "line": "            new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "            new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "plugins/ldap/include/ldapPlugin.php",
        "changes": [
          {
            "type": "context",
            "line": "index f50588b4697..09e30a6177b 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/ldap/include/ldapPlugin.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/ldap/include/ldapPlugin.php"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectUGroup\\UGroupRouter;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Registration\\RegisterProjectCreationEvent;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\REST\\UserGroupAdditionalInformationEvent;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UserPermissionsDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemover;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemoverDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Request\\CollectRoutesEvent;"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    private function getUserRemover()"
          },
          {
            "type": "add",
            "line": "    private function getUserRemover(): UserRemover"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return new UserRemover("
          },
          {
            "type": "context",
            "line": "             ProjectManager::instance(),"
          },
          {
            "type": "context",
            "line": "             new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "             UserManager::instance(),"
          },
          {
            "type": "context",
            "line": "             new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "            new UGroupManager()"
          },
          {
            "type": "add",
            "line": "            new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "            new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "plugins/project_ownership/include/ProjectAdmin/UpdateVisibilityChecker.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..8c24d667c82"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/include/ProjectAdmin/UpdateVisibilityChecker.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023 - Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\ProjectOwnership\\ProjectAdmin;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityStatus;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\ProjectOwnership\\ProjectOwner\\ProjectOwnerRetriever;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "final class UpdateVisibilityChecker"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    public function __construct(private readonly ProjectOwnerRetriever $project_owner_retriever)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function canUpdateVisibilityRegardingRestrictedUsers(Project $project): UpdateVisibilityStatus"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project_owner = $this->project_owner_retriever->getProjectOwner($project);"
          },
          {
            "type": "add",
            "line": "        if ($project_owner && $project_owner->isRestricted()) {"
          },
          {
            "type": "add",
            "line": "            return UpdateVisibilityStatus::buildStatusSwitchIsNotAllowed("
          },
          {
            "type": "add",
            "line": "                dgettext('tuleap-project_ownership', 'Cannot switch the project visibility because it will remove the project owner which is restricted.')"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return UpdateVisibilityStatus::buildStatusSwitchIsAllowed();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "plugins/project_ownership/include/ProjectOwner/ProjectOwnerDAO.php",
        "changes": [
          {
            "type": "context",
            "line": "index 217ef81ce80..9e61144308f 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/project_ownership/include/ProjectOwner/ProjectOwnerDAO.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/include/ProjectOwner/ProjectOwnerDAO.php"
          },
          {
            "type": "context",
            "line": "             $project_id"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function delete(int $project_id, int $user_id): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->getDB()->delete("
          },
          {
            "type": "add",
            "line": "            'plugin_project_ownership_project_owner',"
          },
          {
            "type": "add",
            "line": "            ["
          },
          {
            "type": "add",
            "line": "                'project_id' => $project_id,"
          },
          {
            "type": "add",
            "line": "                'user_id'    => $user_id,"
          },
          {
            "type": "add",
            "line": "            ],"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "plugins/project_ownership/include/ProjectOwner/ProjectOwnerRemover.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..a43e60089c2"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/include/ProjectOwner/ProjectOwnerRemover.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023 - Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\ProjectOwnership\\ProjectOwner;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "add",
            "line": "use Psr\\Log\\LoggerInterface;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class ProjectOwnerRemover"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    public function __construct("
          },
          {
            "type": "add",
            "line": "        private readonly ProjectOwnerDAO $dao,"
          },
          {
            "type": "add",
            "line": "        private readonly ProjectOwnerRetriever $project_owner_retriever,"
          },
          {
            "type": "add",
            "line": "        private readonly LoggerInterface $logger,"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function forceRemovalOfRestrictedProjectOwner(\\Project $project, \\PFUser $removed_user): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        if ($project->getAccess() !== Project::ACCESS_PRIVATE_WO_RESTRICTED) {"
          },
          {
            "type": "add",
            "line": "            return;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if (! $removed_user->isRestricted()) {"
          },
          {
            "type": "add",
            "line": "            return;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project_owner = $this->project_owner_retriever->getProjectOwner($project);"
          },
          {
            "type": "add",
            "line": "        if ($project_owner === null) {"
          },
          {
            "type": "add",
            "line": "            return;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if ($project_owner->getId() === $removed_user->getId()) {"
          },
          {
            "type": "add",
            "line": "            $this->dao->delete("
          },
          {
            "type": "add",
            "line": "                (int) $project->getID(),"
          },
          {
            "type": "add",
            "line": "                (int) $removed_user->getId(),"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $this->logger->info("
          },
          {
            "type": "add",
            "line": "                \"Project owner #\" . $removed_user->getId() . \" in project # \" . $project->getID() . \" removed by system event at project visibility switch.\""
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "plugins/project_ownership/include/project_ownershipPlugin.php",
        "changes": [
          {
            "type": "context",
            "line": "index d3ef66b9eb2..eacfcbaeb19 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/project_ownership/include/project_ownershipPlugin.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/include/project_ownershipPlugin.php"
          },
          {
            "type": "context",
            "line": " use Tuleap\\admin\\ProjectEdit\\ProjectStatusUpdate;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\DB\\DBFactory;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\DB\\DBTransactionExecutorWithConnection;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\ForceRemovalOfRestrictedAdministrator;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\Navigation\\NavigationDropdownItemPresenter;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\Navigation\\NavigationPresenter;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\Navigation\\NavigationPresenterBuilder;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectUGroup\\ApproveProjectAdministratorRemoval;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectUGroup\\ProjectImportCleanupUserCreatorFromAdministrators;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectUGroup\\ProjectUGroupMemberUpdatable;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityIsAllowedEvent;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Registration\\RegisterProjectCreationEvent;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\ProjectOwnership\\ProjectAdmin\\CannotRemoveProjectOwnerFromTheProjectAdministratorsException;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\ProjectOwnership\\ProjectAdmin\\IndexController;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\ProjectOwnership\\ProjectOwner\\ProjectOwnerDAO;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\ProjectOwnership\\ProjectOwner\\ProjectOwnerRemover;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\ProjectOwnership\\ProjectOwner\\ProjectOwnerRetriever;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\ProjectOwnership\\ProjectOwner\\ProjectOwnerUpdater;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\ProjectOwnership\\ProjectOwner\\UserWithStarBadgeFinder;"
          },
          {
            "type": "context",
            "line": "             SystemEventManager::instance()"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    #[\\Tuleap\\Plugin\\ListeningToEventClass]"
          },
          {
            "type": "add",
            "line": "    public function updateVisibilityIsAllowedEvent(UpdateVisibilityIsAllowedEvent $event): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $update_status = (new Tuleap\\ProjectOwnership\\ProjectAdmin\\UpdateVisibilityChecker("
          },
          {
            "type": "add",
            "line": "            new ProjectOwnerRetriever(new ProjectOwnerDAO(), UserManager::instance()),"
          },
          {
            "type": "add",
            "line": "        ))->canUpdateVisibilityRegardingRestrictedUsers($event->getProject());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $event->setUpdateVisibilityStatus($update_status);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    #[\\Tuleap\\Plugin\\ListeningToEventClass]"
          },
          {
            "type": "add",
            "line": "    public function forceRemovalOfRestrictedAdministrator(ForceRemovalOfRestrictedAdministrator $event): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        (new ProjectOwnerRemover("
          },
          {
            "type": "add",
            "line": "            new ProjectOwnerDAO(),"
          },
          {
            "type": "add",
            "line": "            new ProjectOwnerRetriever(new ProjectOwnerDAO(), UserManager::instance()),"
          },
          {
            "type": "add",
            "line": "            BackendLogger::getDefaultLogger(),"
          },
          {
            "type": "add",
            "line": "        ))->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $event->project,"
          },
          {
            "type": "add",
            "line": "            $event->user,"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "plugins/project_ownership/site-content/fr_FR/LC_MESSAGES/tuleap-project_ownership.po",
        "changes": [
          {
            "type": "context",
            "line": "index 461434f5fab..c9a45793434 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/project_ownership/site-content/fr_FR/LC_MESSAGES/tuleap-project_ownership.po"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/site-content/fr_FR/LC_MESSAGES/tuleap-project_ownership.po"
          },
          {
            "type": "context",
            "line": " msgid \"Adds project owner role\""
          },
          {
            "type": "context",
            "line": " msgstr \"Ajoute le rôle du responsable du projet\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Cannot switch the project visibility because it will remove the project \""
          },
          {
            "type": "add",
            "line": "\"owner which is restricted.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"La visiblité de projet ne peut pas être modifiée car cela va supprimer le \""
          },
          {
            "type": "add",
            "line": "\"responsable du projet qui est restreint.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Current project owner:\""
          },
          {
            "type": "context",
            "line": " msgstr \"Responsable actuel du projet :\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "plugins/project_ownership/site-content/pt_BR/LC_MESSAGES/tuleap-project_ownership.po",
        "changes": [
          {
            "type": "context",
            "line": "index 13ac1d4c7a7..4580218da79 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/project_ownership/site-content/pt_BR/LC_MESSAGES/tuleap-project_ownership.po"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/site-content/pt_BR/LC_MESSAGES/tuleap-project_ownership.po"
          },
          {
            "type": "context",
            "line": " msgid \"Adds project owner role\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Cannot switch the project visibility because it will remove the project \""
          },
          {
            "type": "add",
            "line": "\"owner which is restricted.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Current project owner:\""
          },
          {
            "type": "context",
            "line": " msgstr \"\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "plugins/project_ownership/tests/unit/ProjectAdmin/UpdateVisibilityCheckerTest.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..ed492bc4755"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/tests/unit/ProjectAdmin/UpdateVisibilityCheckerTest.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\ProjectOwnership\\ProjectAdmin;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use PHPUnit\\Framework\\MockObject\\MockObject;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\ProjectOwnership\\ProjectOwner\\ProjectOwnerRetriever;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\ProjectTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\UserTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\PHPUnit\\TestCase;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "final class UpdateVisibilityCheckerTest extends TestCase"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    private UpdateVisibilityChecker $checker;"
          },
          {
            "type": "add",
            "line": "    private MockObject&ProjectOwnerRetriever $project_owner_retriever;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    protected function setUp(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        parent::setUp();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever = $this->createMock(ProjectOwnerRetriever::class);"
          },
          {
            "type": "add",
            "line": "        $this->checker                 = new UpdateVisibilityChecker($this->project_owner_retriever);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItAllowsProjectVisibilitySwitchIfThereIsNoOwnerInProject(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever->method('getProjectOwner')->with($project)->willReturn(null);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $this->checker->canUpdateVisibilityRegardingRestrictedUsers($project)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItAllowsProjectVisibilitySwitchIfOwnerInProjectIsNotRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever->method('getProjectOwner')->with($project)->willReturn("
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::anActiveUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $this->checker->canUpdateVisibilityRegardingRestrictedUsers($project)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItDoesNotAllowProjectVisibilitySwitchIfOwnerInProjectIsRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever->method('getProjectOwner')->with($project)->willReturn("
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertFalse("
          },
          {
            "type": "add",
            "line": "            $this->checker->canUpdateVisibilityRegardingRestrictedUsers($project)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "plugins/project_ownership/tests/unit/ProjectOwner/ProjectOwnerRemoverTest.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..2d9a9aa2436"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/project_ownership/tests/unit/ProjectOwner/ProjectOwnerRemoverTest.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023 - Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\ProjectOwnership\\ProjectOwner;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use PHPUnit\\Framework\\MockObject\\MockObject;"
          },
          {
            "type": "add",
            "line": "use Psr\\Log\\NullLogger;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\ProjectTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\UserTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\PHPUnit\\TestCase;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "final class ProjectOwnerRemoverTest extends TestCase"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    private ProjectOwnerRemover $remover;"
          },
          {
            "type": "add",
            "line": "    private MockObject&ProjectOwnerDAO $dao;"
          },
          {
            "type": "add",
            "line": "    private MockObject&ProjectOwnerRetriever $project_owner_retriever;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    protected function setUp(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        parent::setUp();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->dao                     = $this->createMock(ProjectOwnerDAO::class);"
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever = $this->createMock(ProjectOwnerRetriever::class);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover = new ProjectOwnerRemover("
          },
          {
            "type": "add",
            "line": "            $this->dao,"
          },
          {
            "type": "add",
            "line": "            $this->project_owner_retriever,"
          },
          {
            "type": "add",
            "line": "            new NullLogger(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItDoesNothingIfProjectIsNotPrivateWithoutRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $public_project                 = ProjectTestBuilder::aProject()->withAccessPublic()->build();"
          },
          {
            "type": "add",
            "line": "        $private_project                = ProjectTestBuilder::aProject()->withAccessPrivate()->build();"
          },
          {
            "type": "add",
            "line": "        $public_project_with_restricted = ProjectTestBuilder::aProject()->withAccessPublicIncludingRestricted()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('delete');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $public_project,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $private_project,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $public_project_with_restricted,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItDoesNothingIfUserIsNotRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->withAccessPrivateWithoutRestricted()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('delete');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $project,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::anActiveUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItDoesNothingIfThereIsNoOwnerInProject(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->withAccessPrivateWithoutRestricted()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever->method('getProjectOwner')->willReturn(null);"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('delete');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $project,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItDoesNothingIfTheRemovedUserIsNotTheOwnerInProject(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->withAccessPrivateWithoutRestricted()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever->method('getProjectOwner')->willReturn("
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::anActiveUser()->withId(103)->build()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('delete');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $project,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->withId(102)->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItForcesTheRemovalOfTheOwnerInProject(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->withAccessPrivateWithoutRestricted()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_owner_retriever->method('getProjectOwner')->willReturn("
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::anActiveUser()->withId(102)->build()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::once())->method('delete');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemovalOfRestrictedProjectOwner("
          },
          {
            "type": "add",
            "line": "            $project,"
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->withId(102)->build(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "site-content/fr_FR/LC_MESSAGES/tuleap-core.po",
        "changes": [
          {
            "type": "context",
            "line": "index 4947e5c8e04..df6b0266f00 100644"
          },
          {
            "type": "context",
            "line": "--- a/site-content/fr_FR/LC_MESSAGES/tuleap-core.po"
          },
          {
            "type": "context",
            "line": "+++ b/site-content/fr_FR/LC_MESSAGES/tuleap-core.po"
          },
          {
            "type": "context",
            "line": " msgid \"Cannot remove users from bound groups\""
          },
          {
            "type": "context",
            "line": " msgstr \"Impossible d'enlever des utilisateurs d'un group lié\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Cannot switch the project visibility because it will remove every restricted \""
          },
          {
            "type": "add",
            "line": "\"users from the project, and after that no administrator will be left.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": "\"La visibilité ne peut être changée car elle va supprimer tous les \""
          },
          {
            "type": "add",
            "line": "\"utilisateurs restreints du projet, et par conséquent aucun administrateur de \""
          },
          {
            "type": "add",
            "line": "\"projet ne sera présent.\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Cannot update the requested dashboard.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Impossible d'éditer le tableau de bord demandé.\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgstr \"Archives privées\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Private incl. restricted\""
          },
          {
            "type": "delete",
            "line": "msgstr \"Privé incl. les utilisateurs restreints\""
          },
          {
            "type": "add",
            "line": "msgstr \"Privé, incluant les utilisateurs restreints\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Private including restricted\""
          },
          {
            "type": "context",
            "line": " msgstr \"Privé incluant les utilisateurs restreints\""
          }
        ]
      },
      {
        "file": "site-content/pt_BR/LC_MESSAGES/tuleap-core.po",
        "changes": [
          {
            "type": "context",
            "line": "index 51c6d72d8ef..b7a8c19a27f 100644"
          },
          {
            "type": "context",
            "line": "--- a/site-content/pt_BR/LC_MESSAGES/tuleap-core.po"
          },
          {
            "type": "context",
            "line": "+++ b/site-content/pt_BR/LC_MESSAGES/tuleap-core.po"
          },
          {
            "type": "context",
            "line": " msgid \"Cannot remove users from bound groups\""
          },
          {
            "type": "context",
            "line": " msgstr \"Não é possível remover usuários de grupos vinculados\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "msgid \"\""
          },
          {
            "type": "add",
            "line": "\"Cannot switch the project visibility because it will remove every restricted \""
          },
          {
            "type": "add",
            "line": "\"users from the project, and after that no administrator will be left.\""
          },
          {
            "type": "add",
            "line": "msgstr \"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " msgid \"Cannot update the requested dashboard.\""
          },
          {
            "type": "context",
            "line": " msgstr \"Não é possível atualizar o painel solicitado.\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/common/Config/ForgeConfig.php",
        "changes": [
          {
            "type": "context",
            "line": "index 1a2f79ad3d3..88c8cb8107e 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Config/ForgeConfig.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Config/ForgeConfig.php"
          },
          {
            "type": "context",
            "line": "         return self::get(ForgeAccess::CONFIG) === ForgeAccess::ANONYMOUS;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    public static function areRestrictedUsersAllowed()"
          },
          {
            "type": "add",
            "line": "    public static function areRestrictedUsersAllowed(): bool"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return self::get(ForgeAccess::CONFIG) === ForgeAccess::RESTRICTED;"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ForceRemovalOfRestrictedAdministrator.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..7987ae859bb"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ForceRemovalOfRestrictedAdministrator.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2018 - Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\Project\\Admin;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use PFUser;"
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Event\\Dispatchable;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * @psalm-immutable"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "final class ForceRemovalOfRestrictedAdministrator implements Dispatchable"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    public function __construct("
          },
          {
            "type": "add",
            "line": "        public readonly Project $project,"
          },
          {
            "type": "add",
            "line": "        public readonly PFUser $user,"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ProjectDetails/ProjectDetailsController.php",
        "changes": [
          {
            "type": "context",
            "line": "index f64df0b9486..9efc13cbf84 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Admin/ProjectDetails/ProjectDetailsController.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ProjectDetails/ProjectDetailsController.php"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\Navigation\\HeaderNavigationDisplayer;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectVisibilityPresenterBuilder;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectVisibilityUserConfigurationPermissions;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityChecker;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\DescriptionFieldsFactory;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\HierarchyDisplayer;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Icons\\EmojiCodepointConverter;"
          },
          {
            "type": "context",
            "line": "         CSRFSynchronizerToken $csrf_token,"
          },
          {
            "type": "context",
            "line": "         TemplateFactory $template_factory,"
          },
          {
            "type": "context",
            "line": "         private ProjectIconRetriever $project_icon_retriever,"
          },
          {
            "type": "add",
            "line": "        private readonly UpdateVisibilityChecker $update_visibility_checker,"
          },
          {
            "type": "context",
            "line": "     ) {"
          },
          {
            "type": "context",
            "line": "         $this->description_fields_factory           = $description_fields_factory;"
          },
          {
            "type": "context",
            "line": "         $this->current_project                      = $current_project;"
          },
          {
            "type": "context",
            "line": "         if ($this->project_visibility_configuration->canUserConfigureProjectVisibility($user, $project)) {"
          },
          {
            "type": "context",
            "line": "             if ($project->getAccess() !== $request->get('project_visibility')) {"
          },
          {
            "type": "context",
            "line": "                 if ($request->get('term_of_service')) {"
          },
          {
            "type": "delete",
            "line": "                    $this->project_manager->setAccess($project, $request->get('project_visibility'));"
          },
          {
            "type": "delete",
            "line": "                    $this->project_manager->clear($project->getID());"
          },
          {
            "type": "delete",
            "line": "                    $this->ugroup_binding->reloadUgroupBindingInProject($project);"
          },
          {
            "type": "add",
            "line": "                    $update_visibility_status = $this->update_visibility_checker->canUpdateVisibilityRegardingRestrictedUsers("
          },
          {
            "type": "add",
            "line": "                        $project,"
          },
          {
            "type": "add",
            "line": "                        $request->get('project_visibility'),"
          },
          {
            "type": "add",
            "line": "                    );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "                    if ($update_visibility_status->canSwitch()) {"
          },
          {
            "type": "add",
            "line": "                        $this->project_manager->setAccess($project, $request->get('project_visibility'));"
          },
          {
            "type": "add",
            "line": "                        $this->project_manager->clear($project->getID());"
          },
          {
            "type": "add",
            "line": "                        $this->ugroup_binding->reloadUgroupBindingInProject($project);"
          },
          {
            "type": "add",
            "line": "                    } else {"
          },
          {
            "type": "add",
            "line": "                        $GLOBALS['Response']->addFeedback("
          },
          {
            "type": "add",
            "line": "                            Feedback::ERROR,"
          },
          {
            "type": "add",
            "line": "                            $update_visibility_status->getReason(),"
          },
          {
            "type": "add",
            "line": "                        );"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "context",
            "line": "                 } else {"
          },
          {
            "type": "context",
            "line": "                     $GLOBALS['Response']->addFeedback(Feedback::ERROR, _(\"Please accept term of service\"));"
          },
          {
            "type": "context",
            "line": "                 }"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ProjectMembers/ProjectMembersController.php",
        "changes": [
          {
            "type": "context",
            "line": "index 8ecdf4ef6e9..98c1041294c 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Admin/ProjectMembers/ProjectMembersController.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ProjectMembers/ProjectMembersController.php"
          },
          {
            "type": "context",
            "line": "                 new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                 $user_manager,"
          },
          {
            "type": "context",
            "line": "                 new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                $ugroup_manager"
          },
          {
            "type": "add",
            "line": "                $ugroup_manager,"
          },
          {
            "type": "add",
            "line": "                new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "             ),"
          },
          {
            "type": "context",
            "line": "             $event_manager,"
          },
          {
            "type": "context",
            "line": "             $ugroup_manager,"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ProjectUGroup/MemberRemovalController.php",
        "changes": [
          {
            "type": "context",
            "line": "index 7a173ba45d5..60927bc4705 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Admin/ProjectUGroup/MemberRemovalController.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ProjectUGroup/MemberRemovalController.php"
          },
          {
            "type": "context",
            "line": "                 new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                 $user_manager,"
          },
          {
            "type": "context",
            "line": "                 new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                $ugroup_manager"
          },
          {
            "type": "add",
            "line": "                $ugroup_manager,"
          },
          {
            "type": "add",
            "line": "                new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "             ),"
          },
          {
            "type": "context",
            "line": "             UGroupRouter::getCSRFTokenSynchronizer()"
          },
          {
            "type": "context",
            "line": "         );"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ProjectVisibilityOptionsForPresenterGenerator.php",
        "changes": [
          {
            "type": "context",
            "line": "index 7270d7b5272..7c3ca480d87 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Admin/ProjectVisibilityOptionsForPresenterGenerator.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ProjectVisibilityOptionsForPresenterGenerator.php"
          },
          {
            "type": "context",
            "line": " namespace Tuleap\\Project\\Admin;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " use Project;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityStatus;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " final class ProjectVisibilityOptionsForPresenterGenerator"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "delete",
            "line": "     * @psalm-return array<array{value: string, label: string, selected: string}>"
          },
          {
            "type": "add",
            "line": "     * @psalm-return array<array{value: string, label: string, selected: string, disabled: bool, title: string}>"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     public function generateVisibilityOptions("
          },
          {
            "type": "context",
            "line": "         bool $does_platform_allow_restricted_users,"
          },
          {
            "type": "add",
            "line": "        UpdateVisibilityStatus $private_without_restricted_visibility_switch_status,"
          },
          {
            "type": "context",
            "line": "         string $current_project_visibility,"
          },
          {
            "type": "context",
            "line": "     ): array {"
          },
          {
            "type": "context",
            "line": "         if ($does_platform_allow_restricted_users) {"
          },
          {
            "type": "context",
            "line": "                     'value'    => Project::ACCESS_PRIVATE_WO_RESTRICTED,"
          },
          {
            "type": "context",
            "line": "                     'label'    => _('Private'),"
          },
          {
            "type": "context",
            "line": "                     'selected' => ($current_project_visibility === Project::ACCESS_PRIVATE_WO_RESTRICTED) ? 'selected = \"selected\"' : '',"
          },
          {
            "type": "add",
            "line": "                    'disabled' => ! $private_without_restricted_visibility_switch_status->canSwitch(),"
          },
          {
            "type": "add",
            "line": "                    'title'    => ! $private_without_restricted_visibility_switch_status->canSwitch() ? $private_without_restricted_visibility_switch_status->getReason() : '',"
          },
          {
            "type": "context",
            "line": "                 ],"
          },
          {
            "type": "context",
            "line": "                 ["
          },
          {
            "type": "context",
            "line": "                     'value'    => Project::ACCESS_PRIVATE,"
          },
          {
            "type": "context",
            "line": "                     'label'    => _('Private incl. restricted'),"
          },
          {
            "type": "context",
            "line": "                     'selected' => ($current_project_visibility === Project::ACCESS_PRIVATE) ? 'selected = \"selected\"' : '',"
          },
          {
            "type": "add",
            "line": "                    'disabled' => false,"
          },
          {
            "type": "add",
            "line": "                    'title'    => '',"
          },
          {
            "type": "context",
            "line": "                 ],"
          },
          {
            "type": "context",
            "line": "                 ["
          },
          {
            "type": "context",
            "line": "                     'value'    => Project::ACCESS_PUBLIC,"
          },
          {
            "type": "context",
            "line": "                     'label'    => _('Public'),"
          },
          {
            "type": "context",
            "line": "                     'selected' => ($current_project_visibility === Project::ACCESS_PUBLIC) ? 'selected = \"selected\"' : '',"
          },
          {
            "type": "add",
            "line": "                    'disabled' => false,"
          },
          {
            "type": "add",
            "line": "                    'title'    => '',"
          },
          {
            "type": "context",
            "line": "                 ],"
          },
          {
            "type": "context",
            "line": "                 ["
          },
          {
            "type": "context",
            "line": "                     'value'    => Project::ACCESS_PUBLIC_UNRESTRICTED,"
          },
          {
            "type": "context",
            "line": "                     'label'    => _('Public incl. restricted'),"
          },
          {
            "type": "context",
            "line": "                     'selected' => ($current_project_visibility === Project::ACCESS_PUBLIC_UNRESTRICTED) ? 'selected = \"selected\"' : '',"
          },
          {
            "type": "add",
            "line": "                    'disabled' => false,"
          },
          {
            "type": "add",
            "line": "                    'title'    => '',"
          },
          {
            "type": "context",
            "line": "                 ],"
          },
          {
            "type": "context",
            "line": "             ];"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "                 'value'    => Project::ACCESS_PRIVATE,"
          },
          {
            "type": "context",
            "line": "                 'label'    => _('Private'),"
          },
          {
            "type": "context",
            "line": "                 'selected' => ($current_project_visibility === Project::ACCESS_PRIVATE) ? 'selected = \"selected\"' : '',"
          },
          {
            "type": "add",
            "line": "                'disabled' => false,"
          },
          {
            "type": "add",
            "line": "                'title'    => '',"
          },
          {
            "type": "context",
            "line": "             ],"
          },
          {
            "type": "context",
            "line": "             ["
          },
          {
            "type": "context",
            "line": "                 'value'    => Project::ACCESS_PUBLIC,"
          },
          {
            "type": "context",
            "line": "                 'label'    => _('Public'),"
          },
          {
            "type": "context",
            "line": "                 'selected' => ($current_project_visibility === Project::ACCESS_PUBLIC) ? 'selected = \"selected\"' : '',"
          },
          {
            "type": "add",
            "line": "                'disabled' => false,"
          },
          {
            "type": "add",
            "line": "                'title'    => '',"
          },
          {
            "type": "context",
            "line": "             ],"
          },
          {
            "type": "context",
            "line": "         ];"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ProjectVisibilityPresenter.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index faeb77949f6..311d4457d68 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Admin/ProjectVisibilityPresenter.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ProjectVisibilityPresenter.class.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " use BaseLanguage;"
          },
          {
            "type": "context",
            "line": " use Codendi_HTMLPurifier;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityStatus;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class ProjectVisibilityPresenter"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function __construct("
          },
          {
            "type": "context",
            "line": "         BaseLanguage $language,"
          },
          {
            "type": "delete",
            "line": "        $platform_allows_restricted,"
          },
          {
            "type": "delete",
            "line": "        $project_visibility,"
          },
          {
            "type": "add",
            "line": "        bool $platform_allows_restricted,"
          },
          {
            "type": "add",
            "line": "        UpdateVisibilityStatus $private_without_restricted_visibility_switch_status,"
          },
          {
            "type": "add",
            "line": "        string $project_visibility,"
          },
          {
            "type": "context",
            "line": "         int $number_of_restricted_users_in_project,"
          },
          {
            "type": "context",
            "line": "         ProjectVisibilityOptionsForPresenterGenerator $project_visibility_options_generator,"
          },
          {
            "type": "context",
            "line": "     ) {"
          },
          {
            "type": "delete",
            "line": "        $this->platform_allows_restricted       = (bool) $platform_allows_restricted;"
          },
          {
            "type": "add",
            "line": "        $this->platform_allows_restricted       = $platform_allows_restricted;"
          },
          {
            "type": "context",
            "line": "         $this->restricted_warning_message       = $language->getText("
          },
          {
            "type": "context",
            "line": "             'project_admin_editgroupinfo',"
          },
          {
            "type": "context",
            "line": "             'restricted_warning'"
          },
          {
            "type": "context",
            "line": "         $this->project_visibility_label = _('Project visibility');"
          },
          {
            "type": "context",
            "line": "         $this->accept_tos_message       = _(\"Please accept term of service\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->options                               = $project_visibility_options_generator->generateVisibilityOptions("
          },
          {
            "type": "add",
            "line": "        $this->options = $project_visibility_options_generator->generateVisibilityOptions("
          },
          {
            "type": "context",
            "line": "             $this->platform_allows_restricted,"
          },
          {
            "type": "add",
            "line": "            $private_without_restricted_visibility_switch_status,"
          },
          {
            "type": "context",
            "line": "             $project_visibility"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->number_of_restricted_users_in_project = $number_of_restricted_users_in_project;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/ProjectVisibilityPresenterBuilder.php",
        "changes": [
          {
            "type": "context",
            "line": "index a45d07831c0..0fb76e80d24 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Admin/ProjectVisibilityPresenterBuilder.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/ProjectVisibilityPresenterBuilder.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " use ForgeConfig;"
          },
          {
            "type": "context",
            "line": " use HTTPRequest;"
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "context",
            "line": " use ProjectTruncatedEmailsPresenter;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityChecker;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\ProjectAccessPresenter;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class ProjectVisibilityPresenterBuilder"
          },
          {
            "type": "context",
            "line": "         ServicesUsingTruncatedMailRetriever $service_truncated_mails_retriever,"
          },
          {
            "type": "context",
            "line": "         RestrictedUsersProjectCounter $restricted_users_project_counter,"
          },
          {
            "type": "context",
            "line": "         ProjectVisibilityOptionsForPresenterGenerator $project_visibility_options_generator,"
          },
          {
            "type": "add",
            "line": "        private readonly UpdateVisibilityChecker $update_visibility_checker,"
          },
          {
            "type": "context",
            "line": "     ) {"
          },
          {
            "type": "context",
            "line": "         $this->project_visibility_configuration     = $project_visibility_configuration;"
          },
          {
            "type": "context",
            "line": "         $this->service_truncated_mails_retriever    = $service_truncated_mails_retriever;"
          },
          {
            "type": "context",
            "line": "         $visibility_presenter = new ProjectVisibilityPresenter("
          },
          {
            "type": "context",
            "line": "             $GLOBALS['Language'],"
          },
          {
            "type": "context",
            "line": "             ForgeConfig::areRestrictedUsersAllowed(),"
          },
          {
            "type": "add",
            "line": "            $this->update_visibility_checker->canUpdateVisibilityRegardingRestrictedUsers("
          },
          {
            "type": "add",
            "line": "                $project,"
          },
          {
            "type": "add",
            "line": "                Project::ACCESS_PRIVATE_WO_RESTRICTED,"
          },
          {
            "type": "add",
            "line": "            ),"
          },
          {
            "type": "context",
            "line": "             $project->getAccess(),"
          },
          {
            "type": "context",
            "line": "             $this->restricted_users_project_counter->getNumberOfRestrictedUsersInProject($project),"
          },
          {
            "type": "context",
            "line": "             $this->project_visibility_options_generator"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/Visibility/UpdateVisibilityChecker.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..e8b91599e33"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/Visibility/UpdateVisibilityChecker.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " *  it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " *  the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " *  (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " *  but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " *  GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " *  along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\Project\\Admin\\Visibility;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use ForgeConfig;"
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "add",
            "line": "use Psr\\EventDispatcher\\EventDispatcherInterface;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "final class UpdateVisibilityChecker"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    public function __construct("
          },
          {
            "type": "add",
            "line": "        private readonly EventDispatcherInterface $event_dispatcher,"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function canUpdateVisibilityRegardingRestrictedUsers(Project $project, string $visibility): UpdateVisibilityStatus"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        if ("
          },
          {
            "type": "add",
            "line": "            ! ForgeConfig::areRestrictedUsersAllowed() ||"
          },
          {
            "type": "add",
            "line": "            $visibility !== Project::ACCESS_PRIVATE_WO_RESTRICTED"
          },
          {
            "type": "add",
            "line": "        ) {"
          },
          {
            "type": "add",
            "line": "            return UpdateVisibilityStatus::buildStatusSwitchIsAllowed();"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if (! $this->atLeastOneAdministratorIsActive($project)) {"
          },
          {
            "type": "add",
            "line": "            return UpdateVisibilityStatus::buildStatusSwitchIsNotAllowed("
          },
          {
            "type": "add",
            "line": "                _(\"Cannot switch the project visibility because it will remove every restricted users from the project, and after that no administrator will be left.\"),"
          },
          {
            "type": "add",
            "line": "            );"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $event = $this->event_dispatcher->dispatch("
          },
          {
            "type": "add",
            "line": "            new UpdateVisibilityIsAllowedEvent($project)"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return $event->getUpdateVisibilityStatus();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private function atLeastOneAdministratorIsActive(Project $project): bool"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        foreach ($project->getAdmins() as $project_admin) {"
          },
          {
            "type": "add",
            "line": "            if ($project_admin->isActive()) {"
          },
          {
            "type": "add",
            "line": "                return true;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return false;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/Visibility/UpdateVisibilityIsAllowedEvent.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..20987004369"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/Visibility/UpdateVisibilityIsAllowedEvent.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " *  it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " *  the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " *  (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " *  but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " *  GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " *  along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\Project\\Admin\\Visibility;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Event\\Dispatchable;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "final class UpdateVisibilityIsAllowedEvent implements Dispatchable"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    private UpdateVisibilityStatus $update_visibility_status;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function __construct(private readonly Project $project)"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->update_visibility_status = UpdateVisibilityStatus::buildStatusSwitchIsAllowed();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function getUpdateVisibilityStatus(): UpdateVisibilityStatus"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return $this->update_visibility_status;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function setUpdateVisibilityStatus(UpdateVisibilityStatus $update_visibility_status): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $this->update_visibility_status = $update_visibility_status;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function getProject(): Project"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return $this->project;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/common/Project/Admin/Visibility/UpdateVisibilityStatus.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..aa39ae39adf"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Admin/Visibility/UpdateVisibilityStatus.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " *  it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " *  the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " *  (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " *  but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " *  GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " *  along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\Project\\Admin\\Visibility;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "final class UpdateVisibilityStatus"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    private function __construct("
          },
          {
            "type": "add",
            "line": "        private readonly bool $can_switch,"
          },
          {
            "type": "add",
            "line": "        private readonly string $reason,"
          },
          {
            "type": "add",
            "line": "    ) {"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public static function buildStatusSwitchIsAllowed(): self"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return new self(true, '');"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public static function buildStatusSwitchIsNotAllowed(string $reason): self"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return new self(false, $reason);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function canSwitch(): bool"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return $this->can_switch;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function getReason(): string"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return $this->reason;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/common/Project/Project.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 6334ae7d2bc..e3dfc028f69 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Project.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Project.class.php"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "delete",
            "line": "     * @return array of User admin of the project"
          },
          {
            "type": "add",
            "line": "     * @return PFUser[] of User admin of the project"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "delete",
            "line": "    public function getAdmins(?UGroupManager $ugm = null)"
          },
          {
            "type": "add",
            "line": "    public function getAdmins(?UGroupManager $ugm = null): array"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         if (is_null($ugm)) {"
          },
          {
            "type": "context",
            "line": "             $ugm = $this->getUGroupManager();"
          }
        ]
      },
      {
        "file": "src/common/Project/ProjectXMLImporter.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index fc158797785..41e477a8c6a 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/ProjectXMLImporter.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/ProjectXMLImporter.class.php"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UGroups\\Membership\\DynamicUGroups\\ProjectMemberAdder;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UGroups\\Membership\\DynamicUGroups\\ProjectMemberAdderWithoutStatusCheckAndNotifications;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UGroups\\SynchronizedProjectMembershipDao;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UserPermissionsDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemover;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemoverDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\XML\\Import\\ArchiveInterface;"
          },
          {
            "type": "context",
            "line": "                 new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                 $user_manager,"
          },
          {
            "type": "context",
            "line": "                 new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                new UGroupManager()"
          },
          {
            "type": "add",
            "line": "                new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "                new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "             ),"
          },
          {
            "type": "context",
            "line": "             ProjectMemberAdderWithoutStatusCheckAndNotifications::build(),"
          },
          {
            "type": "context",
            "line": "             $project_creator,"
          }
        ]
      },
      {
        "file": "src/common/Project/Registration/ProjectRegistrationPresenter.php",
        "changes": [
          {
            "type": "context",
            "line": "index 1025b024ee4..1f3022bd30b 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/Registration/ProjectRegistrationPresenter.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/Registration/ProjectRegistrationPresenter.php"
          },
          {
            "type": "context",
            "line": "         array $external_templates,"
          },
          {
            "type": "context",
            "line": "     ) {"
          },
          {
            "type": "context",
            "line": "         $this->tuleap_templates             = json_encode($tuleap_templates);"
          },
          {
            "type": "delete",
            "line": "        $this->are_restricted_users_allowed = (bool) ForgeConfig::areRestrictedUsersAllowed();"
          },
          {
            "type": "add",
            "line": "        $this->are_restricted_users_allowed = ForgeConfig::areRestrictedUsersAllowed();"
          },
          {
            "type": "context",
            "line": "         $this->project_default_visibility   = $project_default_visibility;"
          },
          {
            "type": "context",
            "line": "         $this->projects_must_be_approved    = (bool) ForgeConfig::get("
          },
          {
            "type": "context",
            "line": "             ProjectManager::CONFIG_PROJECT_APPROVAL,"
          }
        ]
      },
      {
        "file": "src/common/Project/UGroupManager.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 41a9bfe28e9..2fe839052d8 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/UGroupManager.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/UGroupManager.class.php"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /**"
          },
          {
            "type": "delete",
            "line": "     * @return UserRemover"
          },
          {
            "type": "delete",
            "line": "     */"
          },
          {
            "type": "delete",
            "line": "    private function getUserRemover()"
          },
          {
            "type": "add",
            "line": "    private function getUserRemover(): UserRemover"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         return new UserRemover("
          },
          {
            "type": "context",
            "line": "             ProjectManager::instance(),"
          },
          {
            "type": "context",
            "line": "             new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "             UserManager::instance(),"
          },
          {
            "type": "context",
            "line": "             new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "            new UGroupManager()"
          },
          {
            "type": "add",
            "line": "            new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "            new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "src/common/Project/UserRemover.php",
        "changes": [
          {
            "type": "context",
            "line": "index 68771d67162..cfb01d79709 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/UserRemover.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/UserRemover.php"
          },
          {
            "type": "context",
            "line": " use EventManager;"
          },
          {
            "type": "context",
            "line": " use ArtifactTypeFactory;"
          },
          {
            "type": "context",
            "line": " use Feedback;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\ForceRemovalOfRestrictedAdministrator;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UGroups\\Membership\\DynamicUGroups\\ProjectAdminHistoryEntry;"
          },
          {
            "type": "context",
            "line": " use UserManager;"
          },
          {
            "type": "context",
            "line": " use ProjectHistoryDao;"
          },
          {
            "type": "context",
            "line": " use Project;"
          },
          {
            "type": "context",
            "line": "         UserManager $user_manager,"
          },
          {
            "type": "context",
            "line": "         ProjectHistoryDao $project_history_dao,"
          },
          {
            "type": "context",
            "line": "         UGroupManager $ugroup_manager,"
          },
          {
            "type": "add",
            "line": "        private readonly UserPermissionsDao $user_permissions_dao,"
          },
          {
            "type": "context",
            "line": "     ) {"
          },
          {
            "type": "context",
            "line": "         $this->project_manager     = $project_manager;"
          },
          {
            "type": "context",
            "line": "         $this->event_manager       = $event_manager;"
          },
          {
            "type": "context",
            "line": "         $this->ugroup_manager      = $ugroup_manager;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function forceRemoveAdminRestrictedUserFromProject(Project $project, \\PFUser $removed_user): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        if (! $removed_user->isRestricted()) {"
          },
          {
            "type": "add",
            "line": "            return;"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->user_permissions_dao->removeUserFromProjectAdmin($project->getID(), $removed_user->getId());"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->addHistory("
          },
          {
            "type": "add",
            "line": "            $project,"
          },
          {
            "type": "add",
            "line": "            $this->user_manager->getUserAnonymous(),"
          },
          {
            "type": "add",
            "line": "            new \\DateTimeImmutable(),"
          },
          {
            "type": "add",
            "line": "            ProjectAdminHistoryEntry::Remove->value,"
          },
          {
            "type": "add",
            "line": "            $removed_user->getUserName() . \" (\" . $removed_user->getId() . \")\","
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->event_manager->dispatch("
          },
          {
            "type": "add",
            "line": "            new ForceRemovalOfRestrictedAdministrator($project, $removed_user),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->removeUserFromProject("
          },
          {
            "type": "add",
            "line": "            $project->getID(),"
          },
          {
            "type": "add",
            "line": "            $removed_user->getID(),"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function removeUserFromProject($project_id, $user_id, $admin_action = true)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $project = $this->getProject($project_id);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        if (! $this->dao->removeUserFromProject($project_id, $user_id)) {"
          },
          {
            "type": "add",
            "line": "        if (! $this->dao->removeNonAdminUserFromProject($project_id, $user_id)) {"
          },
          {
            "type": "context",
            "line": "             $GLOBALS['Response']->addFeedback("
          },
          {
            "type": "context",
            "line": "                 Feedback::ERROR,"
          },
          {
            "type": "context",
            "line": "                 $GLOBALS['Language']->getText('project_admin_index', 'user_not_removed')"
          }
        ]
      },
      {
        "file": "src/common/Project/UserRemoverDao.php",
        "changes": [
          {
            "type": "context",
            "line": "index 890286bd045..6122b60434b 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Project/UserRemoverDao.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Project/UserRemoverDao.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class UserRemoverDao extends DataAccessObject"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    public function removeUserFromProject($project_id, $user_id)"
          },
          {
            "type": "add",
            "line": "    public function removeNonAdminUserFromProject($project_id, $user_id): bool"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $project_id = $this->da->escapeInt($project_id);"
          },
          {
            "type": "context",
            "line": "         $user_id    = $this->da->escapeInt($user_id);"
          }
        ]
      },
      {
        "file": "src/common/Request/RouteCollector.php",
        "changes": [
          {
            "type": "context",
            "line": "index a557f1e59be..d6305822344 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Request/RouteCollector.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Request/RouteCollector.php"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Service\\EditController;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Service\\IndexController;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UGroups\\Membership\\DynamicUGroups\\ProjectMemberAdderWithStatusCheckAndNotifications;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UserPermissionsDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\REST\\BasicAuthentication;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\REST\\RESTCurrentUserMiddleware;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\REST\\TuleapRESTCORSMiddleware;"
          },
          {
            "type": "context",
            "line": "                 new \\Tuleap\\Project\\UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                 $user_manager,"
          },
          {
            "type": "context",
            "line": "                 new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                new UGroupManager()"
          },
          {
            "type": "add",
            "line": "                new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "                new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "             ),"
          },
          {
            "type": "context",
            "line": "             new ProjectAdministratorsIncludingDelegationDAO(),"
          },
          {
            "type": "context",
            "line": "             new SapiEmitter()"
          }
        ]
      },
      {
        "file": "src/common/User/SwitchToPresenterBuilder.php",
        "changes": [
          {
            "type": "context",
            "line": "index a8c2178f744..87fa74b23d6 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/User/SwitchToPresenterBuilder.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/User/SwitchToPresenterBuilder.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return new SwitchToPresenter("
          },
          {
            "type": "context",
            "line": "             $this->project_presenters_builder->getProjectPresenters($user),"
          },
          {
            "type": "delete",
            "line": "            (bool) \\ForgeConfig::areRestrictedUsersAllowed(),"
          },
          {
            "type": "add",
            "line": "            \\ForgeConfig::areRestrictedUsersAllowed(),"
          },
          {
            "type": "context",
            "line": "             (bool) \\ForgeConfig::get('sys_use_trove'),"
          },
          {
            "type": "context",
            "line": "             $user->isAlive() && ! $user->isRestricted(),"
          },
          {
            "type": "context",
            "line": "             $this->search_form_presenter_builder->build(),"
          }
        ]
      },
      {
        "file": "src/common/admin/ProjectCreation/ProjectVisibility/ProjectVisibilityConfigPresenter.php",
        "changes": [
          {
            "type": "context",
            "line": "index 10e0571691d..b9f33a828d5 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/admin/ProjectCreation/ProjectVisibility/ProjectVisibilityConfigPresenter.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/admin/ProjectCreation/ProjectVisibility/ProjectVisibilityConfigPresenter.php"
          },
          {
            "type": "context",
            "line": " use ForgeConfig;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Admin\\ProjectCreationNavBarPresenter;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectVisibilityOptionsForPresenterGenerator;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityStatus;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class ProjectVisibilityConfigPresenter"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "         $this->send_mail_on_project_visibility_change = (bool) ForgeConfig::get(ProjectVisibilityConfigManager::SEND_MAIL_ON_PROJECT_VISIBILITY_CHANGE);"
          },
          {
            "type": "context",
            "line": "         $this->default_project_visibility_options     = $project_visibility_options_generator->generateVisibilityOptions("
          },
          {
            "type": "context",
            "line": "             ForgeConfig::areRestrictedUsersAllowed(),"
          },
          {
            "type": "add",
            "line": "            UpdateVisibilityStatus::buildStatusSwitchIsAllowed(),"
          },
          {
            "type": "context",
            "line": "             $current_default_project_visibility_retriever"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "src/common/system_event/SystemEventManager.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 78ee73c7e4d..3446f0db90e 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/system_event/SystemEventManager.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/system_event/SystemEventManager.class.php"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " use Tuleap\\admin\\ProjectEdit\\ProjectStatusUpdate;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\UserPermissionsDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemover;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\UserRemoverDao;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\SVNCore\\Event\\UpdateProjectAccessFilesScheduler;"
          },
          {
            "type": "context",
            "line": "                         new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                         $user_manager,"
          },
          {
            "type": "context",
            "line": "                         new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                        new UGroupManager()"
          },
          {
            "type": "add",
            "line": "                        new UGroupManager(),"
          },
          {
            "type": "add",
            "line": "                        new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "                     ),"
          },
          {
            "type": "context",
            "line": "                 ];"
          },
          {
            "type": "context",
            "line": "                 break;"
          },
          {
            "type": "context",
            "line": "                         new UserRemoverDao(),"
          },
          {
            "type": "context",
            "line": "                         UserManager::instance(),"
          },
          {
            "type": "context",
            "line": "                         new ProjectHistoryDao(),"
          },
          {
            "type": "delete",
            "line": "                        $ugroup_manager"
          },
          {
            "type": "add",
            "line": "                        $ugroup_manager,"
          },
          {
            "type": "add",
            "line": "                        new UserPermissionsDao(),"
          },
          {
            "type": "context",
            "line": "                     ),"
          },
          {
            "type": "context",
            "line": "                     $ugroup_manager,"
          },
          {
            "type": "context",
            "line": "                 ];"
          }
        ]
      },
      {
        "file": "src/common/system_event/include/SystemEvent_PROJECT_IS_PRIVATE.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index dd352dac40f..639a048730c 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/system_event/include/SystemEvent_PROJECT_IS_PRIVATE.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/system_event/include/SystemEvent_PROJECT_IS_PRIVATE.class.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": " * System Event classes"
          },
          {
            "type": "delete",
            "line": "*"
          },
          {
            "type": "context",
            "line": " */"
          },
          {
            "type": "context",
            "line": " class SystemEvent_PROJECT_IS_PRIVATE extends SystemEvent"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    /**"
          },
          {
            "type": "delete",
            "line": "     * @var UserRemover"
          },
          {
            "type": "delete",
            "line": "     */"
          },
          {
            "type": "delete",
            "line": "    private $user_remover;"
          },
          {
            "type": "delete",
            "line": "    /**"
          },
          {
            "type": "delete",
            "line": "     * @var UGroupManager"
          },
          {
            "type": "delete",
            "line": "     */"
          },
          {
            "type": "delete",
            "line": "    private $ugroup_manager;"
          },
          {
            "type": "add",
            "line": "    private UserRemover $user_remover;"
          },
          {
            "type": "add",
            "line": "    private UGroupManager $ugroup_manager;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function injectDependencies("
          },
          {
            "type": "context",
            "line": "         UserRemover $user_remover,"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function cleanRestrictedUsersIfNecessary(Project $project): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        if (! ForgeConfig::areRestrictedUsersAllowed() || $project->getAccess() !== Project::ACCESS_PRIVATE_WO_RESTRICTED) {"
          },
          {
            "type": "add",
            "line": "        if ("
          },
          {
            "type": "add",
            "line": "            ! ForgeConfig::areRestrictedUsersAllowed() ||"
          },
          {
            "type": "add",
            "line": "            $project->getAccess() !== Project::ACCESS_PRIVATE_WO_RESTRICTED"
          },
          {
            "type": "add",
            "line": "        ) {"
          },
          {
            "type": "context",
            "line": "             return;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project_admins = $project->getAdmins();"
          },
          {
            "type": "add",
            "line": "        foreach ($project_admins as $project_admin) {"
          },
          {
            "type": "add",
            "line": "            if ($project_admin->isRestricted()) {"
          },
          {
            "type": "add",
            "line": "                $this->user_remover->forceRemoveAdminRestrictedUserFromProject("
          },
          {
            "type": "add",
            "line": "                    $project,"
          },
          {
            "type": "add",
            "line": "                    $project_admin,"
          },
          {
            "type": "add",
            "line": "                );"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $project_members = $project->getMembers();"
          },
          {
            "type": "context",
            "line": "         foreach ($project_members as $project_member) {"
          },
          {
            "type": "context",
            "line": "             if ($project_member->isRestricted()) {"
          }
        ]
      },
      {
        "file": "src/templates/project/project_visibility.mustache",
        "changes": [
          {
            "type": "context",
            "line": "index 1bf7244e156..61082a47739 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/templates/project/project_visibility.mustache"
          },
          {
            "type": "context",
            "line": "+++ b/src/templates/project/project_visibility.mustache"
          },
          {
            "type": "context",
            "line": "     </label>"
          },
          {
            "type": "context",
            "line": "     <select class=\"tlp-select\" name=\"project_visibility\" id=\"project_visibility\" data-test=\"project_visibility\">"
          },
          {
            "type": "context",
            "line": "         {{# options }}"
          },
          {
            "type": "delete",
            "line": "            <option value=\"{{ value }}\" {{ selected }}>{{ label }}</option>"
          },
          {
            "type": "add",
            "line": "            <option value=\"{{ value }}\""
          },
          {
            "type": "add",
            "line": "                {{# disabled }} disabled {{/ disabled }}"
          },
          {
            "type": "add",
            "line": "                {{# title }} title=\"{{ . }}\" {{/ title }}"
          },
          {
            "type": "add",
            "line": "                {{ selected }}"
          },
          {
            "type": "add",
            "line": "            >{{ label }}</option>"
          },
          {
            "type": "context",
            "line": "         {{/ options }}"
          },
          {
            "type": "context",
            "line": "     </select>"
          },
          {
            "type": "context",
            "line": " </div>"
          }
        ]
      },
      {
        "file": "src/www/project/admin/editgroupinfo.php",
        "changes": [
          {
            "type": "context",
            "line": "index 880419dd79b..5f953a652ec 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/project/admin/editgroupinfo.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/project/admin/editgroupinfo.php"
          },
          {
            "type": "context",
            "line": "     $project_visibility_configuration,"
          },
          {
            "type": "context",
            "line": "     $service_truncated_mails_retriever,"
          },
          {
            "type": "context",
            "line": "     new RestrictedUsersProjectCounter(new UserDao()),"
          },
          {
            "type": "delete",
            "line": "    new \\Tuleap\\Project\\Admin\\ProjectVisibilityOptionsForPresenterGenerator()"
          },
          {
            "type": "add",
            "line": "    new \\Tuleap\\Project\\Admin\\ProjectVisibilityOptionsForPresenterGenerator(),"
          },
          {
            "type": "add",
            "line": "    new \\Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityChecker($event_manager),"
          },
          {
            "type": "context",
            "line": " );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " $csrf_token = new CSRFSynchronizerToken($request->getFromServer('REQUEST_URI'));"
          },
          {
            "type": "context",
            "line": "     $trove_cat_link_dao,"
          },
          {
            "type": "context",
            "line": "     $csrf_token,"
          },
          {
            "type": "context",
            "line": "     TemplateFactory::build(),"
          },
          {
            "type": "delete",
            "line": "    $project_icons_retriever"
          },
          {
            "type": "add",
            "line": "    $project_icons_retriever,"
          },
          {
            "type": "add",
            "line": "    new \\Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityChecker($event_manager),"
          },
          {
            "type": "context",
            "line": " );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " $project_details_router = new ProjectDetailsRouter("
          }
        ]
      },
      {
        "file": "tests/unit/common/Project/Admin/ProjectVisibilityOptionsForPresenterGeneratorTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index d40ae3554f5..0939a99b115 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/unit/common/Project/Admin/ProjectVisibilityOptionsForPresenterGeneratorTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/unit/common/Project/Admin/ProjectVisibilityOptionsForPresenterGeneratorTest.php"
          },
          {
            "type": "context",
            "line": " namespace Tuleap\\Project\\Admin;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " use Project;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityStatus;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " final class ProjectVisibilityOptionsForPresenterGeneratorTest extends \\Tuleap\\Test\\PHPUnit\\TestCase"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     public function testGeneratedOptionsWhenRestrictedUsersAreNotAllowed(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $generator = new ProjectVisibilityOptionsForPresenterGenerator();"
          },
          {
            "type": "delete",
            "line": "        $options   = $generator->generateVisibilityOptions(false, Project::ACCESS_PUBLIC);"
          },
          {
            "type": "add",
            "line": "        $options   = $generator->generateVisibilityOptions(false, UpdateVisibilityStatus::buildStatusSwitchIsAllowed(), Project::ACCESS_PUBLIC);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->assertEqualsCanonicalizing("
          },
          {
            "type": "add",
            "line": "        self::assertEqualsCanonicalizing("
          },
          {
            "type": "context",
            "line": "             [Project::ACCESS_PUBLIC, Project::ACCESS_PRIVATE],"
          },
          {
            "type": "context",
            "line": "             $this->getAvailableAccesses($options)"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->assertEquals(Project::ACCESS_PUBLIC, $this->getSelectedAccess($options));"
          },
          {
            "type": "add",
            "line": "        self::assertEquals(Project::ACCESS_PUBLIC, $this->getSelectedAccess($options));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function testGeneratedOptionsWhenRestrictedUsersAreAllowed(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $generator = new ProjectVisibilityOptionsForPresenterGenerator();"
          },
          {
            "type": "delete",
            "line": "        $options   = $generator->generateVisibilityOptions(true, Project::ACCESS_PRIVATE_WO_RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $options   = $generator->generateVisibilityOptions(true, UpdateVisibilityStatus::buildStatusSwitchIsAllowed(), Project::ACCESS_PRIVATE_WO_RESTRICTED);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->assertEqualsCanonicalizing("
          },
          {
            "type": "add",
            "line": "        self::assertEqualsCanonicalizing("
          },
          {
            "type": "context",
            "line": "             [Project::ACCESS_PUBLIC, Project::ACCESS_PRIVATE, Project::ACCESS_PRIVATE_WO_RESTRICTED, Project::ACCESS_PUBLIC_UNRESTRICTED],"
          },
          {
            "type": "context",
            "line": "             $this->getAvailableAccesses($options)"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->assertEquals(Project::ACCESS_PRIVATE_WO_RESTRICTED, $this->getSelectedAccess($options));"
          },
          {
            "type": "add",
            "line": "        self::assertEquals(Project::ACCESS_PRIVATE_WO_RESTRICTED, $this->getSelectedAccess($options));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testGeneratedOptionsWhenRestrictedUsersAreAllowedButDisabled(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $generator = new ProjectVisibilityOptionsForPresenterGenerator();"
          },
          {
            "type": "add",
            "line": "        $options   = $generator->generateVisibilityOptions(true, UpdateVisibilityStatus::buildStatusSwitchIsNotAllowed(''), Project::ACCESS_PUBLIC);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertEqualsCanonicalizing("
          },
          {
            "type": "add",
            "line": "            [Project::ACCESS_PUBLIC, Project::ACCESS_PRIVATE, Project::ACCESS_PRIVATE_WO_RESTRICTED, Project::ACCESS_PUBLIC_UNRESTRICTED],"
          },
          {
            "type": "add",
            "line": "            $this->getAvailableAccesses($options)"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue($this->getPrivateWithoutRestrictedOptionDisabledValue($options));"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private function getPrivateWithoutRestrictedOptionDisabledValue(array $options): bool"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        foreach ($options as $option) {"
          },
          {
            "type": "add",
            "line": "            if ($option['value'] == Project::ACCESS_PRIVATE_WO_RESTRICTED) {"
          },
          {
            "type": "add",
            "line": "                return $option['disabled'];"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return false;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function getAvailableAccesses(array $options): array"
          }
        ]
      },
      {
        "file": "tests/unit/common/Project/Admin/Visibility/UpdateVisibilityCheckerTest.php",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 00000000000..9d464e7b287"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/tests/unit/common/Project/Admin/Visibility/UpdateVisibilityCheckerTest.php"
          },
          {
            "type": "add",
            "line": "<?php"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2023-Present. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * This file is a part of Tuleap."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is free software; you can redistribute it and/or modify"
          },
          {
            "type": "add",
            "line": " * it under the terms of the GNU General Public License as published by"
          },
          {
            "type": "add",
            "line": " * the Free Software Foundation; either version 2 of the License, or"
          },
          {
            "type": "add",
            "line": " * (at your option) any later version."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * Tuleap is distributed in the hope that it will be useful,"
          },
          {
            "type": "add",
            "line": " * but WITHOUT ANY WARRANTY; without even the implied warranty of"
          },
          {
            "type": "add",
            "line": " * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the"
          },
          {
            "type": "add",
            "line": " * GNU General Public License for more details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " * You should have received a copy of the GNU General Public License"
          },
          {
            "type": "add",
            "line": " * along with Tuleap. If not, see <http://www.gnu.org/licenses/>."
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "declare(strict_types=1);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "namespace Tuleap\\Project\\Admin\\Visibility;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "use ForgeAccess;"
          },
          {
            "type": "add",
            "line": "use ForgeConfig;"
          },
          {
            "type": "add",
            "line": "use Project;"
          },
          {
            "type": "add",
            "line": "use Psr\\EventDispatcher\\EventDispatcherInterface;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\ForgeConfigSandbox;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\ProjectTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\UserTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\PHPUnit\\TestCase;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "class UpdateVisibilityCheckerTest extends TestCase"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    use ForgeConfigSandbox;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testVisibilitySwitchIsAllowedIfPlatformDoesNotAllowRestrictedUsers(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, \"whatever\");"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $this->buildDefaultUpdateVisibilityChecker()->canUpdateVisibilityRegardingRestrictedUsers($project, 'whatever')->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testVisibilitySwitchIsAllowedIfPlatformAllowRestrictedUsersButVisibilityIsNotPrivateWithoutRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $this->buildDefaultUpdateVisibilityChecker()->canUpdateVisibilityRegardingRestrictedUsers($project, Project::ACCESS_PUBLIC)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $this->buildDefaultUpdateVisibilityChecker()->canUpdateVisibilityRegardingRestrictedUsers($project, Project::ACCESS_PRIVATE)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $this->buildDefaultUpdateVisibilityChecker()->canUpdateVisibilityRegardingRestrictedUsers($project, Project::ACCESS_PUBLIC_UNRESTRICTED)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testVisibilitySwitchIsAllowedIfPlatformAllowRestrictedUsersVisibilityIsPrivateWithoutRestrictedWithActiveAdminsAndExternalPluginsAllowTheChange(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $project = $this->createMock(Project::class);"
          },
          {
            "type": "add",
            "line": "        $project->method('getAdmins')->willReturn(["
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::anActiveUser()->build(),"
          },
          {
            "type": "add",
            "line": "        ]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $checker = new UpdateVisibilityChecker("
          },
          {
            "type": "add",
            "line": "            new class implements EventDispatcherInterface {"
          },
          {
            "type": "add",
            "line": "                /**"
          },
          {
            "type": "add",
            "line": "                 * @return UpdateVisibilityIsAllowedEvent"
          },
          {
            "type": "add",
            "line": "                 */"
          },
          {
            "type": "add",
            "line": "                public function dispatch(object $event)"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    return new UpdateVisibilityIsAllowedEvent(ProjectTestBuilder::aProject()->build());"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertTrue("
          },
          {
            "type": "add",
            "line": "            $checker->canUpdateVisibilityRegardingRestrictedUsers($project, Project::ACCESS_PRIVATE_WO_RESTRICTED)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testVisibilitySwitchIsNotAllowedIfPlatformAllowRestrictedUsersVisibilityIsPrivateWithoutRestrictedWithActiveAdminsAndExternalPluginsDoesNotAllowTheChange(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $project = $this->createMock(Project::class);"
          },
          {
            "type": "add",
            "line": "        $project->method('getAdmins')->willReturn(["
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::anActiveUser()->build(),"
          },
          {
            "type": "add",
            "line": "        ]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $checker = new UpdateVisibilityChecker("
          },
          {
            "type": "add",
            "line": "            new class implements EventDispatcherInterface {"
          },
          {
            "type": "add",
            "line": "                /**"
          },
          {
            "type": "add",
            "line": "                 * @return UpdateVisibilityIsAllowedEvent"
          },
          {
            "type": "add",
            "line": "                 */"
          },
          {
            "type": "add",
            "line": "                public function dispatch(object $event)"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    $event = new UpdateVisibilityIsAllowedEvent(ProjectTestBuilder::aProject()->build());"
          },
          {
            "type": "add",
            "line": "                    $event->setUpdateVisibilityStatus("
          },
          {
            "type": "add",
            "line": "                        UpdateVisibilityStatus::buildStatusSwitchIsNotAllowed(\"\"),"
          },
          {
            "type": "add",
            "line": "                    );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "                    return $event;"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertFalse("
          },
          {
            "type": "add",
            "line": "            $checker->canUpdateVisibilityRegardingRestrictedUsers($project, Project::ACCESS_PRIVATE_WO_RESTRICTED)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testVisibilitySwitchIsNotAllowedIfPlatformAllowRestrictedUsersVisibilityIsPrivateWithoutRestrictedWithoutActiveAdmins(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $project = $this->createMock(Project::class);"
          },
          {
            "type": "add",
            "line": "        $project->method('getAdmins')->willReturn(["
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        ]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        self::assertFalse("
          },
          {
            "type": "add",
            "line": "            $this->buildDefaultUpdateVisibilityChecker()->canUpdateVisibilityRegardingRestrictedUsers($project, Project::ACCESS_PRIVATE_WO_RESTRICTED)->canSwitch()"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private function buildDefaultUpdateVisibilityChecker(): UpdateVisibilityChecker"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return new UpdateVisibilityChecker("
          },
          {
            "type": "add",
            "line": "            new class implements EventDispatcherInterface {"
          },
          {
            "type": "add",
            "line": "                /**"
          },
          {
            "type": "add",
            "line": "                 * @return void"
          },
          {
            "type": "add",
            "line": "                 */"
          },
          {
            "type": "add",
            "line": "                public function dispatch(object $event)"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    return;"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "tests/unit/common/Project/ProjectDetails/ProjectDetailsControllerTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index 6b5b5f48ee6..b8da883e60d 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/unit/common/Project/ProjectDetails/ProjectDetailsControllerTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/unit/common/Project/ProjectDetails/ProjectDetailsControllerTest.php"
          },
          {
            "type": "context",
            "line": " use CSRFSynchronizerToken;"
          },
          {
            "type": "context",
            "line": " use EventManager;"
          },
          {
            "type": "context",
            "line": " use Feedback;"
          },
          {
            "type": "add",
            "line": "use ForgeAccess;"
          },
          {
            "type": "context",
            "line": " use ForgeConfig;"
          },
          {
            "type": "context",
            "line": " use HTTPRequest;"
          },
          {
            "type": "context",
            "line": " use Mockery;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectDetails\\ProjectDetailsDAO;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectVisibilityPresenterBuilder;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Admin\\ProjectVisibilityUserConfigurationPermissions;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Project\\Admin\\Visibility\\UpdateVisibilityChecker;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\DescriptionFieldsFactory;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Icons\\ProjectIconRetriever;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Project\\Registration\\Template\\TemplateFactory;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\UserTestBuilder;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\TroveCat\\TroveCatLinkDao;"
          },
          {
            "type": "context",
            "line": " use UGroupBinding;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             $trove_cat_link_dao,"
          },
          {
            "type": "context",
            "line": "             $this->csrf_token,"
          },
          {
            "type": "context",
            "line": "             Mockery::mock(TemplateFactory::class),"
          },
          {
            "type": "delete",
            "line": "            new ProjectIconRetriever()"
          },
          {
            "type": "add",
            "line": "            new ProjectIconRetriever(),"
          },
          {
            "type": "add",
            "line": "            new UpdateVisibilityChecker($this->event_manager),"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $GLOBALS['Response'] = Mockery::mock(BaseLayout::class);"
          },
          {
            "type": "context",
            "line": "         $this->controller->update($request);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testVisibilityUpdateIsNotValidWhenNotMatchingRestrictedUsersConstraints(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set('feature_flag_project_icon_display', '1');"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->csrf_token->shouldReceive('check')->once();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $request = Mockery::mock(HTTPRequest::class);"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('get')->twice()->withArgs(['form_group_name'])->andReturn('project_name');"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('get')->twice()->withArgs(['form_shortdesc'])->andReturn('decription');"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('get')->atLeast()->once()->withArgs(['form-group-name-icon'])->andReturn(\"\");"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('get')->atLeast()->once()->withArgs(['group_id'])->andReturn(102);"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('get')->withArgs(['project_visibility'])->andReturn(Project::ACCESS_PRIVATE_WO_RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('get')->withArgs(['term_of_service'])->andReturn(true);"
          },
          {
            "type": "add",
            "line": "        $current_user = $this->createMock(PFUser::class);"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('getCurrentUser')->atLeast()->once()->andReturn($current_user);"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('existAndNonEmpty')->atLeast()->once()->andReturnFalse();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project = $this->createMock(Project::class);"
          },
          {
            "type": "add",
            "line": "        $project->method('getAdmins')->willReturn(["
          },
          {
            "type": "add",
            "line": "            UserTestBuilder::aRestrictedUser()->build(),"
          },
          {
            "type": "add",
            "line": "        ]);"
          },
          {
            "type": "add",
            "line": "        $project->method('getAccess')->willReturn(Project::ACCESS_PUBLIC);"
          },
          {
            "type": "add",
            "line": "        $project->method('getID')->willReturn(101);"
          },
          {
            "type": "add",
            "line": "        $current_user->method('isAdmin')->with(101)->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $request->shouldReceive('getProject')->twice()->andReturn($project);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->description_fields_factory->shouldReceive('getAllDescriptionFields')->twice()->andReturn([]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->current_project->shouldReceive('getProjectsDescFieldsValue')->once()->andReturn([]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_details_dao->shouldReceive('updateGroupNameAndDescription')->once();"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->shouldReceive('groupAddHistory')->once();"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->shouldReceive('processEvent')->once();"
          },
          {
            "type": "add",
            "line": "        $this->project_visibility_configuration->shouldReceive('canUserConfigureProjectVisibility')->once("
          },
          {
            "type": "add",
            "line": "        )->andReturnTrue();"
          },
          {
            "type": "add",
            "line": "        $this->project_visibility_configuration->shouldReceive('canUserConfigureTruncatedMail')->once()->andReturnFalse("
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $GLOBALS['Response']->shouldReceive('addFeedback')->once()->withArgs("
          },
          {
            "type": "add",
            "line": "            [Feedback::ERROR, _('Cannot switch the project visibility because it will remove every restricted users from the project, and after that no administrator will be left.')]"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $GLOBALS['Response']->shouldReceive('addFeedback')->once()->withArgs([Feedback::INFO, _('Update successful')]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->controller->update($request);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function testItUpdatesProject(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         ForgeConfig::set('feature_flag_project_icon_display', '1');"
          }
        ]
      },
      {
        "file": "tests/unit/common/Project/UserRemoverTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index 49390d44277..77475f2083d 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/unit/common/Project/UserRemoverTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/unit/common/Project/UserRemoverTest.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " require_once __DIR__ . '/../../../../src/www/include/exit.php';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "use Mockery\\Adapter\\Phpunit\\MockeryPHPUnitIntegration;"
          },
          {
            "type": "context",
            "line": " use PFUser;"
          },
          {
            "type": "add",
            "line": "use PHPUnit\\Framework\\MockObject\\MockObject;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\GlobalLanguageMock;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\GlobalResponseMock;"
          },
          {
            "type": "context",
            "line": " use Tuleap\\Test\\Builders\\ProjectTestBuilder;"
          },
          {
            "type": "add",
            "line": "use Tuleap\\Test\\Builders\\UserTestBuilder;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " final class UserRemoverTest extends \\Tuleap\\Test\\PHPUnit\\TestCase"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    use MockeryPHPUnitIntegration;"
          },
          {
            "type": "context",
            "line": "     use GlobalResponseMock;"
          },
          {
            "type": "context",
            "line": "     use GlobalLanguageMock;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private UserRemover $remover;"
          },
          {
            "type": "delete",
            "line": "    /**"
          },
          {
            "type": "delete",
            "line": "     * @var \\EventManager|\\Mockery\\MockInterface"
          },
          {
            "type": "delete",
            "line": "     */"
          },
          {
            "type": "delete",
            "line": "    private $event_manager;"
          },
          {
            "type": "delete",
            "line": "    private $project_manager;"
          },
          {
            "type": "delete",
            "line": "    private $tv3_tracker_factory;"
          },
          {
            "type": "delete",
            "line": "    private $dao;"
          },
          {
            "type": "delete",
            "line": "    private $user_manager;"
          },
          {
            "type": "delete",
            "line": "    private $project_history_dao;"
          },
          {
            "type": "delete",
            "line": "    private $ugroup_manager;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\EventManager $event_manager;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\ProjectManager $project_manager;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\ArtifactTypeFactory $tv3_tracker_factory;"
          },
          {
            "type": "add",
            "line": "    private MockObject&UserRemoverDao $dao;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\UserManager $user_manager;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\ProjectHistoryDao $project_history_dao;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\UGroupManager $ugroup_manager;"
          },
          {
            "type": "context",
            "line": "     private \\Project $project;"
          },
          {
            "type": "context",
            "line": "     private PFUser $user;"
          },
          {
            "type": "delete",
            "line": "    private $tracker_v3;"
          },
          {
            "type": "add",
            "line": "    private MockObject&\\ArtifactType $tracker_v3;"
          },
          {
            "type": "add",
            "line": "    private MockObject&UserPermissionsDao $user_permissions_dao;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     protected function setUp(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         parent::setUp();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->project_manager     = \\Mockery::spy(\\ProjectManager::class);"
          },
          {
            "type": "delete",
            "line": "        $this->event_manager       = \\Mockery::spy(\\EventManager::class);"
          },
          {
            "type": "delete",
            "line": "        $this->tv3_tracker_factory = \\Mockery::spy(\\ArtifactTypeFactory::class);"
          },
          {
            "type": "delete",
            "line": "        $this->dao                 = \\Mockery::spy(\\Tuleap\\Project\\UserRemoverDao::class);"
          },
          {
            "type": "delete",
            "line": "        $this->user_manager        = \\Mockery::spy(\\UserManager::class);"
          },
          {
            "type": "delete",
            "line": "        $this->project_history_dao = \\Mockery::spy(\\ProjectHistoryDao::class);"
          },
          {
            "type": "delete",
            "line": "        $this->ugroup_manager      = \\Mockery::spy(\\UGroupManager::class);"
          },
          {
            "type": "add",
            "line": "        $this->project_manager      = $this->createMock(\\ProjectManager::class);"
          },
          {
            "type": "add",
            "line": "        $this->event_manager        = $this->createMock(\\EventManager::class);"
          },
          {
            "type": "add",
            "line": "        $this->tv3_tracker_factory  = $this->createMock(\\ArtifactTypeFactory::class);"
          },
          {
            "type": "add",
            "line": "        $this->dao                  = $this->createMock(UserRemoverDao::class);"
          },
          {
            "type": "add",
            "line": "        $this->user_manager         = $this->createMock(\\UserManager::class);"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao  = $this->createMock(\\ProjectHistoryDao::class);"
          },
          {
            "type": "add",
            "line": "        $this->ugroup_manager       = $this->createMock(\\UGroupManager::class);"
          },
          {
            "type": "add",
            "line": "        $this->user_permissions_dao = $this->createMock(UserPermissionsDao::class);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->remover = new UserRemover("
          },
          {
            "type": "context",
            "line": "             $this->project_manager,"
          },
          {
            "type": "context",
            "line": "             $this->dao,"
          },
          {
            "type": "context",
            "line": "             $this->user_manager,"
          },
          {
            "type": "context",
            "line": "             $this->project_history_dao,"
          },
          {
            "type": "delete",
            "line": "            $this->ugroup_manager"
          },
          {
            "type": "add",
            "line": "            $this->ugroup_manager,"
          },
          {
            "type": "add",
            "line": "            $this->user_permissions_dao,"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->project    = ProjectTestBuilder::aProject()->withId(101)->withUnixName(\"\")->withAccess(\\Project::ACCESS_PRIVATE)->build();"
          },
          {
            "type": "context",
            "line": "             'language_id' => 'en',"
          },
          {
            "type": "context",
            "line": "             'user_id' => 102,"
          },
          {
            "type": "context",
            "line": "         ]);"
          },
          {
            "type": "delete",
            "line": "        $this->tracker_v3 = \\Mockery::spy(\\ArtifactType::class);"
          },
          {
            "type": "add",
            "line": "        $this->tracker_v3 = $this->createMock(\\ArtifactType::class);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function testItRemovesUserFromProjectMembersAndUgroups(): void"
          },
          {
            "type": "context",
            "line": "         $project_id = 101;"
          },
          {
            "type": "context",
            "line": "         $user_id    = 102;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->dao->shouldReceive('removeUserFromProject')->once()->andReturns(true);"
          },
          {
            "type": "delete",
            "line": "        $this->dao->shouldReceive('removeUserFromProjectUgroups')->once()->andReturns(true);"
          },
          {
            "type": "delete",
            "line": "        $this->tracker_v3->shouldReceive('deleteUser')->once()->with(102)->andReturns(true);"
          },
          {
            "type": "delete",
            "line": "        $this->project_manager->shouldReceive('getProject')->with(101)->andReturns($this->project);"
          },
          {
            "type": "delete",
            "line": "        $this->user_manager->shouldReceive('getUserById')->with(102)->andReturns($this->user);"
          },
          {
            "type": "delete",
            "line": "        $this->ugroup_manager->shouldReceive('getStaticUGroups')->with($this->project)->andReturns([]);"
          },
          {
            "type": "delete",
            "line": "        $this->tv3_tracker_factory->shouldReceive('getArtifactTypesFromId')->with(101)->andReturns([$this->tracker_v3]);"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::once())->method('removeNonAdminUserFromProject')->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::once())->method('removeUserFromProjectUgroups')->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $this->tracker_v3->expects(self::once())->method('deleteUser')->with(102)->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $this->project_manager->method('getProject')->with(101)->willReturn($this->project);"
          },
          {
            "type": "add",
            "line": "        $this->user_manager->method('getUserById')->with(102)->willReturn($this->user);"
          },
          {
            "type": "add",
            "line": "        $this->ugroup_manager->method('getStaticUGroups')->with($this->project)->willReturn([]);"
          },
          {
            "type": "add",
            "line": "        $this->tv3_tracker_factory->method('getArtifactTypesFromId')->with(101)->willReturn([$this->tracker_v3]);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->project_history_dao->shouldReceive('groupAddHistory')->once();"
          },
          {
            "type": "delete",
            "line": "        $this->event_manager->shouldReceive('processEvent')->twice();"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->expects(self::once())->method('groupAddHistory');"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->expects(self::exactly(2))->method('processEvent');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->remover->removeUserFromProject($project_id, $user_id);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItForcesRemovalOfRestrictedUserFromProjectAdminAndUgroups(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": "        $user    = UserTestBuilder::aRestrictedUser()->withId(102)->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->user_manager->method('getUserAnonymous')->willReturn(UserTestBuilder::anAnonymousUser()->build());"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->user_permissions_dao->expects(self::once())->method('removeUserFromProjectAdmin');"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::once())->method('removeNonAdminUserFromProject')->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::once())->method('removeUserFromProjectUgroups')->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $this->tracker_v3->expects(self::once())->method('deleteUser')->with(102)->willReturn(true);"
          },
          {
            "type": "add",
            "line": "        $this->project_manager->method('getProject')->with(101)->willReturn($this->project);"
          },
          {
            "type": "add",
            "line": "        $this->user_manager->method('getUserById')->with(102)->willReturn($this->user);"
          },
          {
            "type": "add",
            "line": "        $this->ugroup_manager->method('getStaticUGroups')->with($this->project)->willReturn([]);"
          },
          {
            "type": "add",
            "line": "        $this->tv3_tracker_factory->method('getArtifactTypesFromId')->with(101)->willReturn([$this->tracker_v3]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->expects(self::once())->method('groupAddHistory');"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->expects(self::once())->method('addHistory');"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->expects(self::exactly(2))->method('processEvent');"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->expects(self::once())->method('dispatch');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemoveAdminRestrictedUserFromProject($project, $user);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testItDoesNotForceRemovalOfUserFromProjectAdminAndUgroupsIfNotRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $project = ProjectTestBuilder::aProject()->build();"
          },
          {
            "type": "add",
            "line": "        $user    = UserTestBuilder::anActiveUser()->withId(102)->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->user_permissions_dao->expects(self::never())->method('removeUserFromProjectAdmin');"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('removeNonAdminUserFromProject');"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('removeUserFromProjectUgroups');"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->expects(self::never())->method('groupAddHistory');"
          },
          {
            "type": "add",
            "line": "        $this->tracker_v3->expects(self::never())->method('deleteUser');"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->expects(self::never())->method('processEvent');"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->expects(self::never())->method('dispatch');"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $this->remover->forceRemoveAdminRestrictedUserFromProject($project, $user);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function testItDoesNothingIfTheUserIsNotRemovedFromProjectMembers(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $project_id = 101;"
          },
          {
            "type": "context",
            "line": "         $user_id    = 102;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->project_manager->shouldReceive('getProject')->with(101)->andReturns($this->project);"
          },
          {
            "type": "add",
            "line": "        $this->project_manager->method('getProject')->with(101)->willReturn($this->project);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $this->dao->shouldReceive('removeUserFromProject')->once();"
          },
          {
            "type": "delete",
            "line": "        $this->dao->shouldReceive('removeUserFromProjectUgroups')->never();"
          },
          {
            "type": "delete",
            "line": "        $this->project_history_dao->shouldReceive('groupAddHistory')->never();"
          },
          {
            "type": "delete",
            "line": "        $this->tracker_v3->shouldReceive('deleteUser')->never();"
          },
          {
            "type": "delete",
            "line": "        $this->event_manager->shouldReceive('processEvent')->never();"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::once())->method('removeNonAdminUserFromProject');"
          },
          {
            "type": "add",
            "line": "        $this->dao->expects(self::never())->method('removeUserFromProjectUgroups');"
          },
          {
            "type": "add",
            "line": "        $this->project_history_dao->expects(self::never())->method('groupAddHistory');"
          },
          {
            "type": "add",
            "line": "        $this->tracker_v3->expects(self::never())->method('deleteUser');"
          },
          {
            "type": "add",
            "line": "        $this->event_manager->expects(self::never())->method('processEvent');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $this->remover->removeUserFromProject($project_id, $user_id);"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      },
      {
        "file": "tests/unit/common/SystemEvent/SystemEventPROJECTISPRIVATETest.php",
        "changes": [
          {
            "type": "context",
            "line": "index f3676a247d2..bf2a1d782f1 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/unit/common/SystemEvent/SystemEventPROJECTISPRIVATETest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/unit/common/SystemEvent/SystemEventPROJECTISPRIVATETest.php"
          },
          {
            "type": "context",
            "line": " use EventManager;"
          },
          {
            "type": "context",
            "line": " use ForgeAccess;"
          },
          {
            "type": "context",
            "line": " use ForgeConfig;"
          },
          {
            "type": "delete",
            "line": "use Mockery;"
          },
          {
            "type": "delete",
            "line": "use Mockery\\Adapter\\Phpunit\\MockeryPHPUnitIntegration;"
          },
          {
            "type": "context",
            "line": " use PFUser;"
          },
          {
            "type": "context",
            "line": " use Project;"
          },
          {
            "type": "context",
            "line": " use ProjectManager;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " final class SystemEventPROJECTISPRIVATETest extends \\Tuleap\\Test\\PHPUnit\\TestCase"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    use MockeryPHPUnitIntegration;"
          },
          {
            "type": "context",
            "line": "     use ForgeConfigSandbox;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private int $project_id = 102;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    protected function setUp(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        parent::setUp();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        ForgeConfig::set(ProjectVisibilityConfigManager::SEND_MAIL_ON_PROJECT_VISIBILITY_CHANGE, false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $event_manager = new class extends EventManager {"
          },
          {
            "type": "add",
            "line": "            public function processEvent($event, $params = [])"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                return;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        };"
          },
          {
            "type": "add",
            "line": "        EventManager::setInstance($event_manager);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     protected function tearDown(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         ProjectManager::clearInstance();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function testRestrictedUsersAreRemovedFromAllUserGroupsWhenProjectBecomesPrivateWithoutRestricted(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $project_id   = 102;"
          },
          {
            "type": "delete",
            "line": "        $system_event = new SystemEvent_PROJECT_IS_PRIVATE("
          },
          {
            "type": "delete",
            "line": "            1,"
          },
          {
            "type": "delete",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::TYPE_PROJECT_IS_PRIVATE,"
          },
          {
            "type": "delete",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::APP_OWNER_QUEUE,"
          },
          {
            "type": "delete",
            "line": "            $project_id . '::1',"
          },
          {
            "type": "delete",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::PRIORITY_MEDIUM,"
          },
          {
            "type": "delete",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::STATUS_NEW,"
          },
          {
            "type": "delete",
            "line": "            '',"
          },
          {
            "type": "delete",
            "line": "            '',"
          },
          {
            "type": "delete",
            "line": "            '',"
          },
          {
            "type": "delete",
            "line": "            ''"
          },
          {
            "type": "add",
            "line": "        $system_event = $this->buildSystemEvent();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $user_remover   = $this->createMock(UserRemover::class);"
          },
          {
            "type": "add",
            "line": "        $ugroup_manager = $this->createMock(\\UGroupManager::class);"
          },
          {
            "type": "add",
            "line": "        $system_event->injectDependencies("
          },
          {
            "type": "add",
            "line": "            $user_remover,"
          },
          {
            "type": "add",
            "line": "            $ugroup_manager,"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project_manager = $this->createMock(ProjectManager::class);"
          },
          {
            "type": "add",
            "line": "        ProjectManager::setInstance($project_manager);"
          },
          {
            "type": "add",
            "line": "        $project = $this->createMock(Project::class);"
          },
          {
            "type": "add",
            "line": "        $project->method('getID')->willReturn($this->project_id);"
          },
          {
            "type": "add",
            "line": "        $project_manager->method('getProject')->willReturn($project);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project->method('usesCVS')->willReturn(false);"
          },
          {
            "type": "add",
            "line": "        $project->method('usesSVN')->willReturn(false);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project->method('getAccess')->willReturn(Project::ACCESS_PRIVATE_WO_RESTRICTED);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $restricted_member_id = 456;"
          },
          {
            "type": "add",
            "line": "        $restricted_admin     = UserTestBuilder::aRestrictedUser()->build();"
          },
          {
            "type": "add",
            "line": "        $restricted_member    = UserTestBuilder::aRestrictedUser()->withId($restricted_member_id)->build();"
          },
          {
            "type": "add",
            "line": "        $member               = UserTestBuilder::anActiveUser()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project->method('getAdmins')->willReturn([$restricted_admin, $member]);"
          },
          {
            "type": "add",
            "line": "        $user_remover->expects(self::once())->method('forceRemoveAdminRestrictedUserFromProject')->with($project, $restricted_admin);"
          },
          {
            "type": "add",
            "line": "        $project->method('getMembers')->willReturn([$restricted_member, $member]);"
          },
          {
            "type": "add",
            "line": "        $user_remover->expects(self::once())->method('removeUserFromProject')->with($this->project_id, $restricted_member_id);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $restricted_user_in_ugroup_only = UserTestBuilder::aRestrictedUser()->build();"
          },
          {
            "type": "add",
            "line": "        $ugroup_with_restricted         = $this->createMock(ProjectUGroup::class);"
          },
          {
            "type": "add",
            "line": "        $ugroup_with_restricted->method('getMembers')->willReturn([$restricted_user_in_ugroup_only, $member]);"
          },
          {
            "type": "add",
            "line": "        $ugroup_with_restricted->expects(self::once())->method('removeUser')->with("
          },
          {
            "type": "add",
            "line": "            $restricted_user_in_ugroup_only,"
          },
          {
            "type": "add",
            "line": "            self::callback("
          },
          {
            "type": "add",
            "line": "                function (PFUser $user) {"
          },
          {
            "type": "add",
            "line": "                    return (int) $user->getId() === 0;"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "        $ugroup_without_restricted = $this->createMock(ProjectUGroup::class);"
          },
          {
            "type": "add",
            "line": "        $ugroup_without_restricted->method('getMembers')->willReturn([$member]);"
          },
          {
            "type": "add",
            "line": "        $ugroup_manager->method('getStaticUGroups')->with($project)->willReturn("
          },
          {
            "type": "add",
            "line": "            [$ugroup_with_restricted, $ugroup_without_restricted]"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $user_remover   = Mockery::mock(UserRemover::class);"
          },
          {
            "type": "delete",
            "line": "        $ugroup_manager = Mockery::mock(\\UGroupManager::class);"
          },
          {
            "type": "add",
            "line": "        self::assertTrue($system_event->process());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testRestrictedUsersAreRemovedFromAllUserGroupsWhenProjectBecomesPrivateWithoutRestrictedIfAllAdministratorsAreRestricted(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $system_event = $this->buildSystemEvent();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $user_remover   = $this->createMock(UserRemover::class);"
          },
          {
            "type": "add",
            "line": "        $ugroup_manager = $this->createMock(\\UGroupManager::class);"
          },
          {
            "type": "context",
            "line": "         $system_event->injectDependencies("
          },
          {
            "type": "context",
            "line": "             $user_remover,"
          },
          {
            "type": "delete",
            "line": "            $ugroup_manager"
          },
          {
            "type": "add",
            "line": "            $ugroup_manager,"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $project_manager = Mockery::mock(ProjectManager::class);"
          },
          {
            "type": "add",
            "line": "        $project_manager = $this->createMock(ProjectManager::class);"
          },
          {
            "type": "context",
            "line": "         ProjectManager::setInstance($project_manager);"
          },
          {
            "type": "delete",
            "line": "        $project = Mockery::mock(Project::class);"
          },
          {
            "type": "delete",
            "line": "        $project->shouldReceive('getID')->andReturn($project_id);"
          },
          {
            "type": "delete",
            "line": "        $project_manager->shouldReceive('getProject')->andReturn($project);"
          },
          {
            "type": "add",
            "line": "        $project = $this->createMock(Project::class);"
          },
          {
            "type": "add",
            "line": "        $project->method('getID')->willReturn($this->project_id);"
          },
          {
            "type": "add",
            "line": "        $project_manager->method('getProject')->willReturn($project);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $project->shouldReceive('usesCVS')->andReturn(false);"
          },
          {
            "type": "delete",
            "line": "        $project->shouldReceive('usesSVN')->andReturn(false);"
          },
          {
            "type": "delete",
            "line": "        ForgeConfig::set(ProjectVisibilityConfigManager::SEND_MAIL_ON_PROJECT_VISIBILITY_CHANGE, false);"
          },
          {
            "type": "delete",
            "line": "        EventManager::setInstance(Mockery::spy(EventManager::class));"
          },
          {
            "type": "add",
            "line": "        $project->method('usesCVS')->willReturn(false);"
          },
          {
            "type": "add",
            "line": "        $project->method('usesSVN')->willReturn(false);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        ForgeConfig::set(ForgeAccess::CONFIG, ForgeAccess::RESTRICTED);"
          },
          {
            "type": "delete",
            "line": "        $project->shouldReceive('getAccess')->andReturn(Project::ACCESS_PRIVATE_WO_RESTRICTED);"
          },
          {
            "type": "add",
            "line": "        $project->method('getAccess')->willReturn(Project::ACCESS_PRIVATE_WO_RESTRICTED);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $restricted_member = Mockery::mock(PFUser::class);"
          },
          {
            "type": "delete",
            "line": "        $restricted_member->shouldReceive('isRestricted')->andReturn(true);"
          },
          {
            "type": "context",
            "line": "         $restricted_member_id = 456;"
          },
          {
            "type": "delete",
            "line": "        $restricted_member->shouldReceive('getId')->andReturn($restricted_member_id);"
          },
          {
            "type": "delete",
            "line": "        $member = UserTestBuilder::anActiveUser()->build();"
          },
          {
            "type": "delete",
            "line": "        $project->shouldReceive('getMembers')->andReturn([$restricted_member, $member]);"
          },
          {
            "type": "delete",
            "line": "        $user_remover->shouldReceive('removeUserFromProject')->with($project_id, $restricted_member_id)->once();"
          },
          {
            "type": "add",
            "line": "        $restricted_admin     = UserTestBuilder::aRestrictedUser()->build();"
          },
          {
            "type": "add",
            "line": "        $restricted_member    = UserTestBuilder::aRestrictedUser()->withId($restricted_member_id)->build();"
          },
          {
            "type": "add",
            "line": "        $member               = UserTestBuilder::anActiveUser()->build();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $project->method('getAdmins')->willReturn([$restricted_admin]);"
          },
          {
            "type": "add",
            "line": "        $project->method('getMembers')->willReturn([$restricted_member, $member]);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $user_remover->expects(self::once())->method('forceRemoveAdminRestrictedUserFromProject')->with($project, $restricted_admin);"
          },
          {
            "type": "add",
            "line": "        $user_remover->expects(self::once())->method('removeUserFromProject')->with($this->project_id, $restricted_member_id);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $restricted_user_in_ugroup_only = UserTestBuilder::aRestrictedUser()->build();"
          },
          {
            "type": "delete",
            "line": "        $ugroup_with_restricted         = Mockery::mock(ProjectUGroup::class);"
          },
          {
            "type": "delete",
            "line": "        $ugroup_with_restricted->shouldReceive('getMembers')->andReturn([$restricted_user_in_ugroup_only, $member]);"
          },
          {
            "type": "delete",
            "line": "        $ugroup_with_restricted->shouldReceive('removeUser')->with("
          },
          {
            "type": "add",
            "line": "        $ugroup_with_restricted         = $this->createMock(ProjectUGroup::class);"
          },
          {
            "type": "add",
            "line": "        $ugroup_with_restricted->method('getMembers')->willReturn([$restricted_user_in_ugroup_only, $member]);"
          },
          {
            "type": "add",
            "line": "        $ugroup_with_restricted->expects(self::once())->method('removeUser')->with("
          },
          {
            "type": "context",
            "line": "             $restricted_user_in_ugroup_only,"
          },
          {
            "type": "delete",
            "line": "            \\Mockery::on("
          },
          {
            "type": "add",
            "line": "            self::callback("
          },
          {
            "type": "context",
            "line": "                 function (PFUser $user) {"
          },
          {
            "type": "context",
            "line": "                     return (int) $user->getId() === 0;"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             )"
          },
          {
            "type": "delete",
            "line": "        )->once();"
          },
          {
            "type": "delete",
            "line": "        $ugroup_without_restricted = Mockery::mock(ProjectUGroup::class);"
          },
          {
            "type": "delete",
            "line": "        $ugroup_without_restricted->shouldReceive('getMembers')->andReturn([$member]);"
          },
          {
            "type": "delete",
            "line": "        $ugroup_manager->shouldReceive('getStaticUGroups')->with($project)->andReturn("
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "        $ugroup_without_restricted = $this->createMock(ProjectUGroup::class);"
          },
          {
            "type": "add",
            "line": "        $ugroup_without_restricted->method('getMembers')->willReturn([$member]);"
          },
          {
            "type": "add",
            "line": "        $ugroup_manager->method('getStaticUGroups')->with($project)->willReturn("
          },
          {
            "type": "context",
            "line": "             [$ugroup_with_restricted, $ugroup_without_restricted]"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         self::assertTrue($system_event->process());"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    private function buildSystemEvent(): SystemEvent_PROJECT_IS_PRIVATE"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        return new SystemEvent_PROJECT_IS_PRIVATE("
          },
          {
            "type": "add",
            "line": "            1,"
          },
          {
            "type": "add",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::TYPE_PROJECT_IS_PRIVATE,"
          },
          {
            "type": "add",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::APP_OWNER_QUEUE,"
          },
          {
            "type": "add",
            "line": "            $this->project_id . '::1',"
          },
          {
            "type": "add",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::PRIORITY_MEDIUM,"
          },
          {
            "type": "add",
            "line": "            SystemEvent_PROJECT_IS_PRIVATE::STATUS_NEW,"
          },
          {
            "type": "add",
            "line": "            '',"
          },
          {
            "type": "add",
            "line": "            '',"
          },
          {
            "type": "add",
            "line": "            '',"
          },
          {
            "type": "add",
            "line": "            ''"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "a2de167b95debad83a0f0c7925a88c0198db812e",
    "files": [
      {
        "file": "packages/app-cli/tests/md_to_html/sanitize_12.html",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..c8a5e8c24"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/packages/app-cli/tests/md_to_html/sanitize_12.html"
          },
          {
            "type": "add",
            "line": "<div class=\"joplin-editable\"><pre class=\"joplin-source\" data-joplin-language=\"&quot;&gt;&lt;svg/onload=top.eval(atob(&quot;cmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoJ29wZW4gLW4gL1N5c3RlbS9BcHBsaWNhdGlvbnMvQ2FsY3VsYXRvci5hcHAvQ29udGVudHMvTWFjT1MvQ2FsY3VsYXRvcicp&quot;))&gt;\" data-joplin-source-open=\"```&quot;&gt;&lt;svg/onload=top.eval(atob(&quot;cmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoJ29wZW4gLW4gL1N5c3RlbS9BcHBsaWNhdGlvbnMvQ2FsY3VsYXRvci5hcHAvQ29udGVudHMvTWFjT1MvQ2FsY3VsYXRvcicp&quot;))&gt;&#10;\" data-joplin-source-close=\"&#10;```\">ts</pre><pre class=\"hljs\"><code><span class=\"hljs-attribute\">ts</span></code></pre></div>"
          }
        ]
      },
      {
        "file": "packages/app-cli/tests/md_to_html/sanitize_12.md",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..22f71bb68"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/packages/app-cli/tests/md_to_html/sanitize_12.md"
          },
          {
            "type": "add",
            "line": "```\"><svg/onload=top.eval(atob(\"cmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpLmV4ZWMoJ29wZW4gLW4gL1N5c3RlbS9BcHBsaWNhdGlvbnMvQ2FsY3VsYXRvci5hcHAvQ29udGVudHMvTWFjT1MvQ2FsY3VsYXRvcicp\"))>"
          },
          {
            "type": "add",
            "line": "ts"
          },
          {
            "type": "add",
            "line": "```"
          }
        ]
      },
      {
        "file": "packages/renderer/MdToHtml.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 333c0e7cd..1e57d6993 100644"
          },
          {
            "type": "context",
            "line": "--- a/packages/renderer/MdToHtml.ts"
          },
          {
            "type": "context",
            "line": "+++ b/packages/renderer/MdToHtml.ts"
          },
          {
            "type": "context",
            "line": " import { Options as NoteStyleOptions } from './noteStyle';"
          },
          {
            "type": "context",
            "line": " import hljs from './highlight';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "const Entities = require('html-entities').AllHtmlEntities;"
          },
          {
            "type": "add",
            "line": "const htmlentities = new Entities().encode;"
          },
          {
            "type": "context",
            "line": " const MarkdownIt = require('markdown-it');"
          },
          {
            "type": "context",
            "line": " const md5 = require('md5');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t\t// The strings includes the last \\n that is part of the fence,"
          },
          {
            "type": "context",
            "line": " \t\t\t\t// so we remove it because we need the exact code in the source block"
          },
          {
            "type": "context",
            "line": " \t\t\t\tconst trimmedStr = this.removeLastNewLine(str);"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tconst sourceBlockHtml = `<pre class=\"joplin-source\" data-joplin-language=\"${lang}\" data-joplin-source-open=\"\\`\\`\\`${lang}&#10;\" data-joplin-source-close=\"&#10;\\`\\`\\`\">${markdownIt.utils.escapeHtml(trimmedStr)}</pre>`;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tconst sourceBlockHtml = `<pre class=\"joplin-source\" data-joplin-language=\"${htmlentities(lang)}\" data-joplin-source-open=\"\\`\\`\\`${htmlentities(lang)}&#10;\" data-joplin-source-close=\"&#10;\\`\\`\\`\">${markdownIt.utils.escapeHtml(trimmedStr)}</pre>`;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t\tif (this.shouldSkipHighlighting(trimmedStr, lang)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\toutputCodeHtml = markdownIt.utils.escapeHtml(trimmedStr);"
          }
        ]
      }
    ]
  },
  {
    "commit": "a4aac191c16cf6281f3d346615aefa75702b02d7",
    "files": [
      {
        "file": "docs/source/changelog.md",
        "changes": [
          {
            "type": "context",
            "line": "index cd7a6de..b9a8ad6 100644"
          },
          {
            "type": "context",
            "line": "--- a/docs/source/changelog.md"
          },
          {
            "type": "context",
            "line": "+++ b/docs/source/changelog.md"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ## 0.12"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "### [0.12.2] - 2020-11-30"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "Security fix for GHSA-384w-5v3f-q499: Deprecated `c.Authenticator.whitelist` configuration was ignored instead of mapped to newer `c.Authenticator.allowed_users` when used with JupyterHub 1.2 and OAuthenticator 0.12.0-0.12.1."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " ### [0.12.1] - 2020-11-20"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #### Bugs fixed"
          }
        ]
      },
      {
        "file": "oauthenticator/bitbucket.py",
        "changes": [
          {
            "type": "context",
            "line": "index a3d2060..709d0c3 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/bitbucket.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/bitbucket.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class BitbucketOAuthenticator(OAuthenticator):"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    _deprecated_aliases = {"
          },
          {
            "type": "add",
            "line": "    _deprecated_oauth_aliases = {"
          },
          {
            "type": "context",
            "line": "         \"team_whitelist\": (\"allowed_teams\", \"0.12.0\"),"
          },
          {
            "type": "add",
            "line": "        **OAuthenticator._deprecated_oauth_aliases,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @observe(*list(_deprecated_aliases))"
          },
          {
            "type": "delete",
            "line": "    def _deprecated_trait(self, change):"
          },
          {
            "type": "delete",
            "line": "        super()._deprecated_trait(change)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     login_service = \"Bitbucket\""
          },
          {
            "type": "context",
            "line": "     client_id_env = 'BITBUCKET_CLIENT_ID'"
          },
          {
            "type": "context",
            "line": "     client_secret_env = 'BITBUCKET_CLIENT_SECRET'"
          }
        ]
      },
      {
        "file": "oauthenticator/cilogon.py",
        "changes": [
          {
            "type": "context",
            "line": "index 09c680d..127e9ec 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/cilogon.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/cilogon.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class CILogonOAuthenticator(OAuthenticator):"
          },
          {
            "type": "delete",
            "line": "    _deprecated_aliases = {"
          },
          {
            "type": "add",
            "line": "    _deprecated_oauth_aliases = {"
          },
          {
            "type": "context",
            "line": "         \"idp_whitelist\": (\"allowed_idps\", \"0.12.0\"),"
          },
          {
            "type": "add",
            "line": "        **OAuthenticator._deprecated_oauth_aliases,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @observe(*list(_deprecated_aliases))"
          },
          {
            "type": "delete",
            "line": "    def _deprecated_trait(self, change):"
          },
          {
            "type": "delete",
            "line": "        super()._deprecated_trait(change)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     login_service = \"CILogon\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     client_id_env = 'CILOGON_CLIENT_ID'"
          }
        ]
      },
      {
        "file": "oauthenticator/github.py",
        "changes": [
          {
            "type": "context",
            "line": "index 2697d9d..8708329 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/github.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/github.py"
          },
          {
            "type": "context",
            "line": "     # set scopes via config, e.g."
          },
          {
            "type": "context",
            "line": "     # c.GitHubOAuthenticator.scope = ['read:org']"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    _deprecated_aliases = {"
          },
          {
            "type": "add",
            "line": "    _deprecated_oauth_aliases = {"
          },
          {
            "type": "context",
            "line": "         \"github_organization_whitelist\": (\"allowed_organizations\", \"0.12.0\"),"
          },
          {
            "type": "add",
            "line": "        **OAuthenticator._deprecated_oauth_aliases,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @observe(*list(_deprecated_aliases))"
          },
          {
            "type": "delete",
            "line": "    def _deprecated_trait(self, change):"
          },
          {
            "type": "delete",
            "line": "        super()._deprecated_trait(change)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     login_service = \"GitHub\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     github_url = Unicode(\"https://github.com\", config=True)"
          }
        ]
      },
      {
        "file": "oauthenticator/gitlab.py",
        "changes": [
          {
            "type": "context",
            "line": "index 50ce226..cf8fd44 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/gitlab.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/gitlab.py"
          },
          {
            "type": "context",
            "line": "     # set scopes via config, e.g."
          },
          {
            "type": "context",
            "line": "     # c.GitLabOAuthenticator.scope = ['read_user']"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    _deprecated_aliases = {"
          },
          {
            "type": "add",
            "line": "    _deprecated_oauth_aliases = {"
          },
          {
            "type": "context",
            "line": "         \"gitlab_group_whitelist\": (\"allowed_gitlab_groups\", \"0.12.0\"),"
          },
          {
            "type": "delete",
            "line": "        \"gitlab_project_id_whitelist\": (\"allowed_project_ids\", \"0.12.0\")"
          },
          {
            "type": "add",
            "line": "        \"gitlab_project_id_whitelist\": (\"allowed_project_ids\", \"0.12.0\"),"
          },
          {
            "type": "add",
            "line": "        **OAuthenticator._deprecated_oauth_aliases,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @observe(*list(_deprecated_aliases))"
          },
          {
            "type": "delete",
            "line": "    def _deprecated_trait(self, change):"
          },
          {
            "type": "delete",
            "line": "        super()._deprecated_trait(change)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     login_service = \"GitLab\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     client_id_env = 'GITLAB_CLIENT_ID'"
          }
        ]
      },
      {
        "file": "oauthenticator/google.py",
        "changes": [
          {
            "type": "context",
            "line": "index 4e90800..7e3f77e 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/google.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/google.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class GoogleOAuthenticator(OAuthenticator, GoogleOAuth2Mixin):"
          },
          {
            "type": "delete",
            "line": "    _deprecated_aliases = {"
          },
          {
            "type": "add",
            "line": "    _deprecated_oauth_aliases = {"
          },
          {
            "type": "context",
            "line": "         \"google_group_whitelist\": (\"allowed_google_groups\", \"0.12.0\"),"
          },
          {
            "type": "add",
            "line": "        **OAuthenticator._deprecated_oauth_aliases,"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @observe(*list(_deprecated_aliases))"
          },
          {
            "type": "delete",
            "line": "    def _deprecated_trait(self, change):"
          },
          {
            "type": "delete",
            "line": "        super()._deprecated_trait(change)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     google_api_url = Unicode(\"https://www.googleapis.com\", config=True)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @default('google_api_url')"
          }
        ]
      },
      {
        "file": "oauthenticator/oauth2.py",
        "changes": [
          {
            "type": "context",
            "line": "index 8a8841f..40b2087 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/oauth2.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/oauth2.py"
          },
          {
            "type": "context",
            "line": "     async def authenticate(self, handler, data=None):"
          },
          {
            "type": "context",
            "line": "         raise NotImplementedError()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    _deprecated_oauth_aliases = {}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def _deprecated_trait(self, change):"
          },
          {
            "type": "add",
            "line": "    def _deprecated_oauth_trait(self, change):"
          },
          {
            "type": "context",
            "line": "         \"\"\"observer for deprecated traits\"\"\""
          },
          {
            "type": "context",
            "line": "         old_attr = change.name"
          },
          {
            "type": "delete",
            "line": "        new_attr, version = self._deprecated_aliases.get(old_attr)"
          },
          {
            "type": "add",
            "line": "        new_attr, version = self._deprecated_oauth_aliases.get(old_attr)"
          },
          {
            "type": "context",
            "line": "         new_value = getattr(self, new_attr)"
          },
          {
            "type": "context",
            "line": "         if new_value != change.new:"
          },
          {
            "type": "context",
            "line": "             # only warn if different"
          },
          {
            "type": "context",
            "line": "                 )"
          },
          {
            "type": "context",
            "line": "             )"
          },
          {
            "type": "context",
            "line": "             setattr(self, new_attr, change.new)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def __init__(self, **kwargs):"
          },
          {
            "type": "add",
            "line": "        # observe deprecated config names in oauthenticator"
          },
          {
            "type": "add",
            "line": "        if self._deprecated_oauth_aliases:"
          },
          {
            "type": "add",
            "line": "            self.observe("
          },
          {
            "type": "add",
            "line": "                self._deprecated_oauth_trait, names=list(self._deprecated_oauth_aliases)"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        super().__init__(**kwargs)"
          }
        ]
      },
      {
        "file": "oauthenticator/tests/test_bitbucket.py",
        "changes": [
          {
            "type": "context",
            "line": "index fa9eeba..ea5e7a6 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/tests/test_bitbucket.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/tests/test_bitbucket.py"
          },
          {
            "type": "context",
            "line": " def test_deprecated_config(caplog):"
          },
          {
            "type": "context",
            "line": "     cfg = Config()"
          },
          {
            "type": "context",
            "line": "     cfg.BitbucketOAuthenticator.team_whitelist = ['red']"
          },
          {
            "type": "add",
            "line": "    cfg.BitbucketOAuthenticator.whitelist = {\"blue\"}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     log = logging.getLogger(\"testlog\")"
          },
          {
            "type": "context",
            "line": "     authenticator = BitbucketOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "delete",
            "line": "    assert caplog.record_tuples == ["
          },
          {
            "type": "delete",
            "line": "        ("
          },
          {
            "type": "delete",
            "line": "            log.name,"
          },
          {
            "type": "delete",
            "line": "            logging.WARNING,"
          },
          {
            "type": "delete",
            "line": "            'BitbucketOAuthenticator.team_whitelist is deprecated in BitbucketOAuthenticator 0.12.0, use '"
          },
          {
            "type": "delete",
            "line": "            'BitbucketOAuthenticator.allowed_teams instead',"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    ]"
          },
          {
            "type": "add",
            "line": "    assert ("
          },
          {
            "type": "add",
            "line": "        log.name,"
          },
          {
            "type": "add",
            "line": "        logging.WARNING,"
          },
          {
            "type": "add",
            "line": "        'BitbucketOAuthenticator.team_whitelist is deprecated in BitbucketOAuthenticator 0.12.0, use '"
          },
          {
            "type": "add",
            "line": "        'BitbucketOAuthenticator.allowed_teams instead',"
          },
          {
            "type": "add",
            "line": "    ) in caplog.record_tuples"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     assert authenticator.allowed_teams == {\"red\"}"
          },
          {
            "type": "add",
            "line": "    assert authenticator.allowed_users == {\"blue\"}"
          }
        ]
      },
      {
        "file": "oauthenticator/tests/test_github.py",
        "changes": [
          {
            "type": "context",
            "line": "index 38d854b..a88946c 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/tests/test_github.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/tests/test_github.py"
          },
          {
            "type": "context",
            "line": " def test_deprecated_config(caplog):"
          },
          {
            "type": "context",
            "line": "     cfg = Config()"
          },
          {
            "type": "context",
            "line": "     cfg.GitHubOAuthenticator.github_organization_whitelist = [\"jupy\"]"
          },
          {
            "type": "add",
            "line": "    cfg.Authenticator.whitelist = {\"user1\"}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     log = logging.getLogger(\"testlog\")"
          },
          {
            "type": "context",
            "line": "     authenticator = GitHubOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "delete",
            "line": "    assert caplog.record_tuples == ["
          },
          {
            "type": "delete",
            "line": "        ("
          },
          {
            "type": "delete",
            "line": "            log.name,"
          },
          {
            "type": "delete",
            "line": "            logging.WARNING,"
          },
          {
            "type": "delete",
            "line": "            'GitHubOAuthenticator.github_organization_whitelist is deprecated in GitHubOAuthenticator 0.12.0, use '"
          },
          {
            "type": "delete",
            "line": "            'GitHubOAuthenticator.allowed_organizations instead',"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    ]"
          },
          {
            "type": "add",
            "line": "    assert ("
          },
          {
            "type": "add",
            "line": "        log.name,"
          },
          {
            "type": "add",
            "line": "        logging.WARNING,"
          },
          {
            "type": "add",
            "line": "        'GitHubOAuthenticator.github_organization_whitelist is deprecated in GitHubOAuthenticator 0.12.0, use '"
          },
          {
            "type": "add",
            "line": "        'GitHubOAuthenticator.allowed_organizations instead',"
          },
          {
            "type": "add",
            "line": "    ) in caplog.record_tuples"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     assert authenticator.allowed_organizations == {\"jupy\"}"
          },
          {
            "type": "add",
            "line": "    assert authenticator.allowed_users == {\"user1\"}"
          }
        ]
      },
      {
        "file": "oauthenticator/tests/test_gitlab.py",
        "changes": [
          {
            "type": "context",
            "line": "index fe2d3b1..7dab575 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/tests/test_gitlab.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/tests/test_gitlab.py"
          },
          {
            "type": "context",
            "line": " def test_deprecated_config(caplog):"
          },
          {
            "type": "context",
            "line": "     cfg = Config()"
          },
          {
            "type": "context",
            "line": "     cfg.GitLabOAuthenticator.gitlab_group_whitelist = {'red'}"
          },
          {
            "type": "add",
            "line": "    cfg.GitLabOAuthenticator.whitelist = {\"blue\"}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     log = logging.getLogger(\"testlog\")"
          },
          {
            "type": "context",
            "line": "     authenticator = GitLabOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "delete",
            "line": "    assert caplog.record_tuples == ["
          },
          {
            "type": "delete",
            "line": "        ("
          },
          {
            "type": "delete",
            "line": "            log.name,"
          },
          {
            "type": "delete",
            "line": "            logging.WARNING,"
          },
          {
            "type": "delete",
            "line": "            'GitLabOAuthenticator.gitlab_group_whitelist is deprecated in GitLabOAuthenticator 0.12.0, use '"
          },
          {
            "type": "delete",
            "line": "            'GitLabOAuthenticator.allowed_gitlab_groups instead'"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    ]"
          },
          {
            "type": "add",
            "line": "    assert ("
          },
          {
            "type": "add",
            "line": "        log.name,"
          },
          {
            "type": "add",
            "line": "        logging.WARNING,"
          },
          {
            "type": "add",
            "line": "        'GitLabOAuthenticator.gitlab_group_whitelist is deprecated in GitLabOAuthenticator 0.12.0, use '"
          },
          {
            "type": "add",
            "line": "        'GitLabOAuthenticator.allowed_gitlab_groups instead',"
          },
          {
            "type": "add",
            "line": "    ) in caplog.record_tuples"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     assert authenticator.allowed_gitlab_groups == {'red'}"
          },
          {
            "type": "add",
            "line": "    assert authenticator.allowed_users == {\"blue\"}"
          }
        ]
      },
      {
        "file": "oauthenticator/tests/test_google.py",
        "changes": [
          {
            "type": "context",
            "line": "index 3e6d58f..ed76406 100644"
          },
          {
            "type": "context",
            "line": "--- a/oauthenticator/tests/test_google.py"
          },
          {
            "type": "context",
            "line": "+++ b/oauthenticator/tests/test_google.py"
          },
          {
            "type": "context",
            "line": " def test_deprecated_config(caplog):"
          },
          {
            "type": "context",
            "line": "     cfg = Config()"
          },
          {
            "type": "context",
            "line": "     cfg.GoogleOAuthenticator.google_group_whitelist = {'email.com': ['group']}"
          },
          {
            "type": "add",
            "line": "    cfg.Authenticator.whitelist = {\"user1\"}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     log = logging.getLogger(\"testlog\")"
          },
          {
            "type": "context",
            "line": "     authenticator = GoogleOAuthenticator(config=cfg, log=log)"
          },
          {
            "type": "delete",
            "line": "    assert caplog.record_tuples == ["
          },
          {
            "type": "delete",
            "line": "        ("
          },
          {
            "type": "delete",
            "line": "            log.name,"
          },
          {
            "type": "delete",
            "line": "            logging.WARNING,"
          },
          {
            "type": "delete",
            "line": "            'GoogleOAuthenticator.google_group_whitelist is deprecated in GoogleOAuthenticator 0.12.0, use '"
          },
          {
            "type": "delete",
            "line": "            'GoogleOAuthenticator.allowed_google_groups instead',"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    ]"
          },
          {
            "type": "add",
            "line": "    assert ("
          },
          {
            "type": "add",
            "line": "        log.name,"
          },
          {
            "type": "add",
            "line": "        logging.WARNING,"
          },
          {
            "type": "add",
            "line": "        'GoogleOAuthenticator.google_group_whitelist is deprecated in GoogleOAuthenticator 0.12.0, use '"
          },
          {
            "type": "add",
            "line": "        'GoogleOAuthenticator.allowed_google_groups instead',"
          },
          {
            "type": "add",
            "line": "    ) in caplog.record_tuples"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     assert authenticator.allowed_google_groups == {'email.com': ['group']}"
          },
          {
            "type": "add",
            "line": "    assert authenticator.allowed_users == {\"user1\"}"
          }
        ]
      }
    ]
  },
  {
    "commit": "a5a36d9e82dde7265e38fe1f87b7f11c461c29f6",
    "files": [
      {
        "file": "sf-pcapng.c",
        "changes": [
          {
            "type": "context",
            "line": "index 11bac263..40f37c1f 100644"
          },
          {
            "type": "context",
            "line": "--- a/sf-pcapng.c"
          },
          {
            "type": "context",
            "line": "+++ b/sf-pcapng.c"
          },
          {
            "type": "context",
            "line": "  * Section Header Block."
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " #define BT_SHB\t\t\t0x0A0D0D0A"
          },
          {
            "type": "delete",
            "line": "#define BT_SHB_INSANE_MAX       1024*1024*1  /* 1MB should be enough */"
          },
          {
            "type": "add",
            "line": "#define BT_SHB_INSANE_MAX       1024U*1024U*1U  /* 1MB should be enough */"
          },
          {
            "type": "context",
            "line": " struct section_header_block {"
          },
          {
            "type": "context",
            "line": " \tbpf_u_int32\tbyte_order_magic;"
          },
          {
            "type": "context",
            "line": " \tu_short\t\tmajor_version;"
          },
          {
            "type": "context",
            "line": " \tif (total_length < sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer) ||"
          },
          {
            "type": "context",
            "line": "             (total_length > BT_SHB_INSANE_MAX)) {"
          },
          {
            "type": "context",
            "line": " \t\tpcap_snprintf(errbuf, PCAP_ERRBUF_SIZE,"
          },
          {
            "type": "delete",
            "line": "\t\t    \"Section Header Block in pcapng dump file has invalid length %\" PRIsize \" < _%lu_ < %lu (BT_SHB_INSANE_MAX)\","
          },
          {
            "type": "delete",
            "line": "                              sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer),"
          },
          {
            "type": "delete",
            "line": "                              total_length,"
          },
          {
            "type": "delete",
            "line": "                              BT_SHB_INSANE_MAX);"
          },
          {
            "type": "add",
            "line": "\t\t    \"Section Header Block in pcapng dump file has invalid length %\" PRIsize \" < _%u_ < %u (BT_SHB_INSANE_MAX)\","
          },
          {
            "type": "add",
            "line": "\t\t    sizeof(*bhdrp) + sizeof(*shbp) + sizeof(struct block_trailer),"
          },
          {
            "type": "add",
            "line": "\t\t    total_length,"
          },
          {
            "type": "add",
            "line": "\t\t    BT_SHB_INSANE_MAX);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t*err = 1;"
          },
          {
            "type": "context",
            "line": " \t\treturn (NULL);"
          }
        ]
      }
    ]
  },
  {
    "commit": "a74c9cfbaed9f811e7563cfc3dce894928e0221a",
    "files": [
      {
        "file": "CHANGES.rst",
        "changes": [
          {
            "type": "context",
            "line": "index 54c669e6..cf228533 100644"
          },
          {
            "type": "context",
            "line": "--- a/CHANGES.rst"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGES.rst"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " * Change ``is_ipaddress`` to not detect IPvFuture addresses. (Pull #1583)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "* Change ``parse_url`` to percent-encode invalid characters within the"
          },
          {
            "type": "add",
            "line": "  path, query, and target components. (Pull #1586)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " 1.25.1 (2019-04-24)"
          },
          {
            "type": "context",
            "line": " -------------------"
          }
        ]
      },
      {
        "file": "src/urllib3/util/url.py",
        "changes": [
          {
            "type": "context",
            "line": "index de3c4686..0bc6ced7 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/urllib3/util/url.py"
          },
          {
            "type": "context",
            "line": "+++ b/src/urllib3/util/url.py"
          },
          {
            "type": "context",
            "line": " from ..packages import six, rfc3986"
          },
          {
            "type": "context",
            "line": " from ..packages.rfc3986.exceptions import RFC3986Exception, ValidationError"
          },
          {
            "type": "context",
            "line": " from ..packages.rfc3986.validators import Validator"
          },
          {
            "type": "add",
            "line": "from ..packages.rfc3986 import abnf_regexp, normalizers, compat, misc"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " url_attrs = ['scheme', 'auth', 'host', 'port', 'path', 'query', 'fragment']"
          },
          {
            "type": "context",
            "line": " # Regex for detecting URLs with schemes. RFC 3986 Section 3.1"
          },
          {
            "type": "context",
            "line": " SCHEME_REGEX = re.compile(r\"^(?:[a-zA-Z][a-zA-Z0-9+\\-]*:|/)\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "PATH_CHARS = abnf_regexp.UNRESERVED_CHARS_SET | abnf_regexp.SUB_DELIMITERS_SET | {':', '@', '/'}"
          },
          {
            "type": "add",
            "line": "QUERY_CHARS = FRAGMENT_CHARS = PATH_CHARS | {'?'}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class Url(namedtuple('Url', url_attrs)):"
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "context",
            "line": "     return s[:min_idx], s[min_idx + 1:], min_delim"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "def _encode_invalid_chars(component, allowed_chars, encoding='utf-8'):"
          },
          {
            "type": "add",
            "line": "    \"\"\"Percent-encodes a URI component without reapplying"
          },
          {
            "type": "add",
            "line": "    onto an already percent-encoded component. Based on"
          },
          {
            "type": "add",
            "line": "    rfc3986.normalizers.encode_component()"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": "    if component is None:"
          },
          {
            "type": "add",
            "line": "        return component"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # Try to see if the component we're encoding is already percent-encoded"
          },
          {
            "type": "add",
            "line": "    # so we can skip all '%' characters but still encode all others."
          },
          {
            "type": "add",
            "line": "    percent_encodings = len(normalizers.PERCENT_MATCHER.findall("
          },
          {
            "type": "add",
            "line": "                            compat.to_str(component, encoding)))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    uri_bytes = component.encode('utf-8', 'surrogatepass')"
          },
          {
            "type": "add",
            "line": "    is_percent_encoded = percent_encodings == uri_bytes.count(b'%')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    encoded_component = bytearray()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    for i in range(0, len(uri_bytes)):"
          },
          {
            "type": "add",
            "line": "        # Will return a single character bytestring on both Python 2 & 3"
          },
          {
            "type": "add",
            "line": "        byte = uri_bytes[i:i+1]"
          },
          {
            "type": "add",
            "line": "        byte_ord = ord(byte)"
          },
          {
            "type": "add",
            "line": "        if ((is_percent_encoded and byte == b'%')"
          },
          {
            "type": "add",
            "line": "                or (byte_ord < 128 and byte.decode() in allowed_chars)):"
          },
          {
            "type": "add",
            "line": "            encoded_component.extend(byte)"
          },
          {
            "type": "add",
            "line": "            continue"
          },
          {
            "type": "add",
            "line": "        encoded_component.extend('%{0:02x}'.format(byte_ord).encode().upper())"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return encoded_component.decode(encoding)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " def parse_url(url):"
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "context",
            "line": "     Given a url, return a parsed :class:`.Url` namedtuple. Best-effort is"
          },
          {
            "type": "context",
            "line": "         return Url()"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     is_string = not isinstance(url, six.binary_type)"
          },
          {
            "type": "delete",
            "line": "    if not is_string:"
          },
          {
            "type": "delete",
            "line": "        url = url.decode(\"utf-8\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # RFC 3986 doesn't like URLs that have a host but don't start"
          },
          {
            "type": "context",
            "line": "     # with a scheme and we support URLs like that so we need to"
          },
          {
            "type": "context",
            "line": "     if not SCHEME_REGEX.search(url):"
          },
          {
            "type": "context",
            "line": "         url = \"//\" + url"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        iri_ref = rfc3986.IRIReference.from_string(url, encoding=\"utf-8\")"
          },
          {
            "type": "delete",
            "line": "    except (ValueError, RFC3986Exception):"
          },
          {
            "type": "delete",
            "line": "        six.raise_from(LocationParseError(url), None)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     def idna_encode(name):"
          },
          {
            "type": "context",
            "line": "         if name and any([ord(x) > 128 for x in name]):"
          },
          {
            "type": "context",
            "line": "             try:"
          },
          {
            "type": "context",
            "line": "                 raise LocationParseError(u\"Name '%s' is not a valid IDNA label\" % name)"
          },
          {
            "type": "context",
            "line": "         return name"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    has_authority = iri_ref.authority is not None"
          },
          {
            "type": "delete",
            "line": "    uri_ref = iri_ref.encode(idna_encoder=idna_encode)"
          },
          {
            "type": "add",
            "line": "    try:"
          },
          {
            "type": "add",
            "line": "        split_iri = misc.IRI_MATCHER.match(compat.to_str(url)).groupdict()"
          },
          {
            "type": "add",
            "line": "        iri_ref = rfc3986.IRIReference("
          },
          {
            "type": "add",
            "line": "            split_iri['scheme'], split_iri['authority'],"
          },
          {
            "type": "add",
            "line": "            _encode_invalid_chars(split_iri['path'], PATH_CHARS),"
          },
          {
            "type": "add",
            "line": "            _encode_invalid_chars(split_iri['query'], QUERY_CHARS),"
          },
          {
            "type": "add",
            "line": "            _encode_invalid_chars(split_iri['fragment'], FRAGMENT_CHARS)"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "        has_authority = iri_ref.authority is not None"
          },
          {
            "type": "add",
            "line": "        uri_ref = iri_ref.encode(idna_encoder=idna_encode)"
          },
          {
            "type": "add",
            "line": "    except (ValueError, RFC3986Exception):"
          },
          {
            "type": "add",
            "line": "        return six.raise_from(LocationParseError(url), None)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # rfc3986 strips the authority if it's invalid"
          },
          {
            "type": "context",
            "line": "     if has_authority and uri_ref.authority is None:"
          },
          {
            "type": "context",
            "line": "             *validator.COMPONENT_NAMES"
          },
          {
            "type": "context",
            "line": "         ).validate(uri_ref)"
          },
          {
            "type": "context",
            "line": "     except ValidationError:"
          },
          {
            "type": "delete",
            "line": "        six.raise_from(LocationParseError(url), None)"
          },
          {
            "type": "add",
            "line": "        return six.raise_from(LocationParseError(url), None)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     # For the sake of backwards compatibility we put empty"
          },
          {
            "type": "context",
            "line": "     # string values for path if there are any defined values"
          }
        ]
      },
      {
        "file": "test/test_util.py",
        "changes": [
          {
            "type": "context",
            "line": "index c86170cf..cc237b0e 100644"
          },
          {
            "type": "context",
            "line": "--- a/test/test_util.py"
          },
          {
            "type": "context",
            "line": "+++ b/test/test_util.py"
          },
          {
            "type": "context",
            "line": "         'http://user\\\\@google.com',"
          },
          {
            "type": "context",
            "line": "         'http://google\\\\.com',"
          },
          {
            "type": "context",
            "line": "         'user\\\\@google.com',"
          },
          {
            "type": "delete",
            "line": "        'http://google.com#fragment#',"
          },
          {
            "type": "context",
            "line": "         'http://user@user@google.com/',"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Invalid IDNA labels"
          },
          {
            "type": "add",
            "line": "        u'http://\\uD7FF.com',"
          },
          {
            "type": "add",
            "line": "        u'http://❤️',"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Unicode surrogates"
          },
          {
            "type": "add",
            "line": "        u'http://\\uD800.com',"
          },
          {
            "type": "add",
            "line": "        u'http://\\uDC00.com',"
          },
          {
            "type": "context",
            "line": "     ])"
          },
          {
            "type": "context",
            "line": "     def test_invalid_url(self, url):"
          },
          {
            "type": "context",
            "line": "         with pytest.raises(LocationParseError):"
          },
          {
            "type": "context",
            "line": "         ('HTTPS://Example.Com/?Key=Value', 'https://example.com/?Key=Value'),"
          },
          {
            "type": "context",
            "line": "         ('Https://Example.Com/#Fragment', 'https://example.com/#Fragment'),"
          },
          {
            "type": "context",
            "line": "         ('[::Ff%etH0%Ff]/%ab%Af', '[::ff%25etH0%Ff]/%AB%AF'),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Invalid characters for the query/fragment getting encoded"
          },
          {
            "type": "add",
            "line": "        ('http://google.com/p[]?parameter[]=\\\"hello\\\"#fragment#',"
          },
          {
            "type": "add",
            "line": "         'http://google.com/p%5B%5D?parameter%5B%5D=%22hello%22#fragment%23'),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Percent encoding isn't applied twice despite '%' being invalid"
          },
          {
            "type": "add",
            "line": "        # but the percent encoding is still normalized."
          },
          {
            "type": "add",
            "line": "        ('http://google.com/p%5B%5d?parameter%5b%5D=%22hello%22#fragment%23',"
          },
          {
            "type": "add",
            "line": "         'http://google.com/p%5B%5D?parameter%5B%5D=%22hello%22#fragment%23')"
          },
          {
            "type": "context",
            "line": "     ])"
          },
          {
            "type": "context",
            "line": "     def test_parse_url_normalization(self, url, expected_normalized_url):"
          },
          {
            "type": "context",
            "line": "         \"\"\"Assert parse_url normalizes the scheme/host, and only the scheme/host\"\"\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         # Uppercase IRI"
          },
          {
            "type": "context",
            "line": "         (u'http://Königsgäßchen.de/straße',"
          },
          {
            "type": "delete",
            "line": "         Url('http', host='xn--knigsgchen-b4a3dun.de', path='/stra%C3%9Fe'))"
          },
          {
            "type": "add",
            "line": "         Url('http', host='xn--knigsgchen-b4a3dun.de', path='/stra%C3%9Fe')),"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Unicode Surrogates"
          },
          {
            "type": "add",
            "line": "        (u'http://google.com/\\uD800', Url('http', host='google.com', path='%ED%A0%80')),"
          },
          {
            "type": "add",
            "line": "        (u'http://google.com?q=\\uDC00',"
          },
          {
            "type": "add",
            "line": "         Url('http', host='google.com', path='', query='q=%ED%B0%80')),"
          },
          {
            "type": "add",
            "line": "        (u'http://google.com#\\uDC00',"
          },
          {
            "type": "add",
            "line": "         Url('http', host='google.com', path='', fragment='%ED%B0%80')),"
          },
          {
            "type": "context",
            "line": "     ]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @pytest.mark.parametrize("
          }
        ]
      }
    ]
  },
  {
    "commit": "a9697dfeb672b0b9412c00c7d36d801e27ec85cb",
    "files": [
      {
        "file": "dcmnet/include/dcmtk/dcmnet/dulstruc.h",
        "changes": [
          {
            "type": "context",
            "line": "similarity index 98%"
          },
          {
            "type": "context",
            "line": "rename from dcmnet/libsrc/dulstruc.h"
          },
          {
            "type": "context",
            "line": "rename to dcmnet/include/dcmtk/dcmnet/dulstruc.h"
          },
          {
            "type": "context",
            "line": "index 22da6ece1..6ac9a8f5d 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dulstruc.h"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/include/dcmtk/dcmnet/dulstruc.h"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/config/osconfig.h\"    /* make sure OS specific configuration is included first */"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/extneg.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcuserid.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dicom.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dntypes.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class DcmTransportConnection;"
          },
          {
            "type": "context",
            "line": " class DcmTransportLayer;"
          },
          {
            "type": "context",
            "line": "     DUL_PRESENTATIONDATAVALUE presentationDataValue;"
          },
          {
            "type": "context",
            "line": " }   DUL_DATAPDU;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define DUL_PROTOCOL      (unsigned short) 0x01"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #define DUL_TYPEAPPLICATIONCONTEXT  (unsigned char)0x10"
          }
        ]
      },
      {
        "file": "dcmnet/include/dcmtk/dcmnet/helpers.h",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..7d7e382be"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/include/dcmtk/dcmnet/helpers.h"
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Copyright (C) 2021, OFFIS e.V."
          },
          {
            "type": "add",
            "line": " *  All rights reserved.  See COPYRIGHT file for details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  This software and supporting documentation were partly developed by"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *    OFFIS e.V."
          },
          {
            "type": "add",
            "line": " *    R&D Division Health"
          },
          {
            "type": "add",
            "line": " *    Escherweg 2"
          },
          {
            "type": "add",
            "line": " *    D-26121 Oldenburg, Germany"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Module: dcmnet"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Author: Michael Onken"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Purpose: Collection of helper functions"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#ifndef DCMHET_HELPERS_H"
          },
          {
            "type": "add",
            "line": "#define DCMHET_HELPERS_H"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/ofstd/ofcond.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "struct T_ASC_Parameters;"
          },
          {
            "type": "add",
            "line": "class LST_HEAD;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "void"
          },
          {
            "type": "add",
            "line": "destroyPresentationContextList(LST_HEAD ** l);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "void"
          },
          {
            "type": "add",
            "line": "destroyUserInformationLists(DUL_USERINFO * userInfo);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#endif"
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/CMakeLists.txt",
        "changes": [
          {
            "type": "context",
            "line": "index 2b97767ca..7ab209616 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/CMakeLists.txt"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/CMakeLists.txt"
          },
          {
            "type": "context",
            "line": "   dulpres.cc"
          },
          {
            "type": "context",
            "line": "   dwrap.c"
          },
          {
            "type": "context",
            "line": "   extneg.cc"
          },
          {
            "type": "add",
            "line": "  helpers.cc"
          },
          {
            "type": "context",
            "line": "   lst.cc"
          },
          {
            "type": "context",
            "line": "   scp.cc"
          },
          {
            "type": "context",
            "line": "   scpcfg.cc"
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/Makefile.in",
        "changes": [
          {
            "type": "context",
            "line": "index 66d8c527b..d767bea35 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/Makefile.in"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/Makefile.in"
          },
          {
            "type": "context",
            "line": " \tdulfsm.o dulparse.o dulpres.o dul.o lst.o extneg.o dimget.o dcmlayer.o \\"
          },
          {
            "type": "context",
            "line": " \tdcmtrans.o dcasccfg.o dcasccff.o dccfuidh.o dccftsmp.o dccfpcmp.o \\"
          },
          {
            "type": "context",
            "line": " \tdccfrsmp.o dccfenmp.o dccfprmp.o dfindscu.o dstorscp.o dstorscu.o \\"
          },
          {
            "type": "delete",
            "line": "\tdcuserid.o scu.o scp.o scpcfg.o scpthrd.o scppool.o dwrap.o"
          },
          {
            "type": "add",
            "line": "\tdcuserid.o helper.o scu.o scp.o scpcfg.o scpthrd.o scppool.o dwrap.o"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " library = libdcmnet.$(LIBEXT)"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/assoc.cc",
        "changes": [
          {
            "type": "context",
            "line": "index e69329031..a9a42a88e 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/assoc.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/assoc.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofconsol.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofstd.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcmtrans.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/helpers.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": " ** Constant Definitions"
          },
          {
            "type": "context",
            "line": "     return EC_Normal;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "static void"
          },
          {
            "type": "delete",
            "line": "destroyPresentationContextList(LST_HEAD ** lst)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "    DUL_PRESENTATIONCONTEXT *pc;"
          },
          {
            "type": "delete",
            "line": "    DUL_TRANSFERSYNTAX *ts;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if ((lst == NULL) || (*lst == NULL))"
          },
          {
            "type": "delete",
            "line": "        return;"
          },
          {
            "type": "delete",
            "line": "    while ((pc = (DUL_PRESENTATIONCONTEXT*) LST_Dequeue(lst)) != NULL) {"
          },
          {
            "type": "delete",
            "line": "        if (pc->proposedTransferSyntax != NULL) {"
          },
          {
            "type": "delete",
            "line": "            while ((ts = (DUL_TRANSFERSYNTAX*) LST_Dequeue(&pc->proposedTransferSyntax)) != NULL) {"
          },
          {
            "type": "delete",
            "line": "                free(ts);"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "            LST_Destroy(&pc->proposedTransferSyntax);"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "        free(pc);"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "    LST_Destroy(lst);"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " OFCondition"
          },
          {
            "type": "context",
            "line": " ASC_destroyAssociationParameters(T_ASC_Parameters ** params)"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if ((*association)->params != NULL) {"
          },
          {
            "type": "delete",
            "line": "        cond = ASC_destroyAssociationParameters(&(*association)->params);"
          },
          {
            "type": "delete",
            "line": "        if (cond.bad()) return cond;"
          },
          {
            "type": "add",
            "line": "        ASC_destroyAssociationParameters(&(*association)->params);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if ((*association)->sendPDVBuffer != NULL)"
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dcuserid.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 6a2d72a20..f1530fe79 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dcuserid.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dcuserid.cc"
          },
          {
            "type": "context",
            "line": " /*"
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "delete",
            "line": " *  Copyright (C) 1997-2018, OFFIS e.V."
          },
          {
            "type": "add",
            "line": " *  Copyright (C) 1997-2021, OFFIS e.V."
          },
          {
            "type": "context",
            "line": "  *  All rights reserved.  See COPYRIGHT file for details."
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  *  This software and supporting documentation were developed by"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/config/osconfig.h\" /* make sure OS specific configuration is included first */"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcuserid.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /* ************************************************************************* */"
          },
          {
            "type": "context",
            "line": " /*       Implementation of class UserIdentityNegotiationSubItem              */"
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dul.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 49ef18886..1aba744d7 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dul.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dul.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofstd.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulpriv.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulfsm.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcmtrans.h\""
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dulconst.cc",
        "changes": [
          {
            "type": "context",
            "line": "index d91b0379e..5900b7b7e 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dulconst.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dulconst.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/diutil.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulpriv.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofconsol.h\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dulextra.cc",
        "changes": [
          {
            "type": "context",
            "line": "index b11b65aa1..06079a942 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dulextra.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dulextra.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/cond.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulpriv.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcmtrans.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/diutil.h\""
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dulfsm.cc",
        "changes": [
          {
            "type": "context",
            "line": "index b3a0aaf42..92b34f3b2 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dulfsm.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dulfsm.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/cond.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulpriv.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulfsm.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofbmanip.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcmtrans.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dcmlayer.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/diutil.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/helpers.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofsockad.h\" /* for class OFSockAddr */"
          },
          {
            "type": "context",
            "line": " #include <ctime>"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " PRV_SCUSCPROLE *"
          },
          {
            "type": "context",
            "line": " findSCUSCPRole(LST_HEAD ** lst, char *abstractSyntax);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "void destroyPresentationContextList(LST_HEAD ** l);"
          },
          {
            "type": "delete",
            "line": "void destroyUserInformationLists(DUL_USERINFO * userInfo);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": " static volatile FSM_Event_Description Event_Table[] = {"
          },
          {
            "type": "context",
            "line": "     {A_ASSOCIATE_REQ_LOCAL_USER, \"A-ASSOCIATE request (local user)\"},"
          },
          {
            "type": "context",
            "line": "     {TRANS_CONN_CONFIRM_LOCAL_USER, \"Transport conn confirmation (local)\"},"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": "     return NULL;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "void"
          },
          {
            "type": "delete",
            "line": "destroyPresentationContextList(LST_HEAD ** l)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "    PRV_PRESENTATIONCONTEXTITEM"
          },
          {
            "type": "delete",
            "line": "    * prvCtx;"
          },
          {
            "type": "delete",
            "line": "    DUL_SUBITEM"
          },
          {
            "type": "delete",
            "line": "        * subItem;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if (*l == NULL)"
          },
          {
            "type": "delete",
            "line": "        return;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    prvCtx = (PRV_PRESENTATIONCONTEXTITEM*)LST_Dequeue(l);"
          },
          {
            "type": "delete",
            "line": "    while (prvCtx != NULL) {"
          },
          {
            "type": "delete",
            "line": "        subItem = (DUL_SUBITEM*)LST_Dequeue(&prvCtx->transferSyntaxList);"
          },
          {
            "type": "delete",
            "line": "        while (subItem != NULL) {"
          },
          {
            "type": "delete",
            "line": "            free(subItem);"
          },
          {
            "type": "delete",
            "line": "            subItem = (DUL_SUBITEM*)LST_Dequeue(&prvCtx->transferSyntaxList);"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "        LST_Destroy(&prvCtx->transferSyntaxList);"
          },
          {
            "type": "delete",
            "line": "        free(prvCtx);"
          },
          {
            "type": "delete",
            "line": "        prvCtx = (PRV_PRESENTATIONCONTEXTITEM*)LST_Dequeue(l);"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "    LST_Destroy(l);"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "void"
          },
          {
            "type": "delete",
            "line": "destroyUserInformationLists(DUL_USERINFO * userInfo)"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "    PRV_SCUSCPROLE"
          },
          {
            "type": "delete",
            "line": "    * role;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    role = (PRV_SCUSCPROLE*)LST_Dequeue(&userInfo->SCUSCPRoleList);"
          },
          {
            "type": "delete",
            "line": "    while (role != NULL) {"
          },
          {
            "type": "delete",
            "line": "        free(role);"
          },
          {
            "type": "delete",
            "line": "        role = (PRV_SCUSCPROLE*)LST_Dequeue(&userInfo->SCUSCPRoleList);"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "    LST_Destroy(&userInfo->SCUSCPRoleList);"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* extended negotiation */"
          },
          {
            "type": "delete",
            "line": "    delete userInfo->extNegList; userInfo->extNegList = NULL;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    /* user identity negotiation */"
          },
          {
            "type": "delete",
            "line": "    delete userInfo->usrIdent; userInfo->usrIdent = NULL;"
          },
          {
            "type": "delete",
            "line": "}"
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dulparse.cc",
        "changes": [
          {
            "type": "context",
            "line": "index ea28c11ce..5f9faebba 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dulparse.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dulparse.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/diutil.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/helpers.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulpriv.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/ofstd/ofconsol.h\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         * context;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     (void) memset(assoc, 0, sizeof(*assoc));"
          },
          {
            "type": "delete",
            "line": "    if ((assoc->presentationContextList = LST_Create()) == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "delete",
            "line": "    if ((assoc->userInfo.SCUSCPRoleList = LST_Create()) == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     // Check if the PDU actually is long enough for the fields we read"
          },
          {
            "type": "context",
            "line": "     if (pduLength < 2 + 2 + 16 + 16 + 32)"
          },
          {
            "type": "context",
            "line": "         return makeLengthError(\"associate PDU\", pduLength, 2 + 2 + 16 + 16 + 32);"
          },
          {
            "type": "context",
            "line": "             << \"Called AP Title:  \" << assoc->calledAPTitle << OFendl"
          },
          {
            "type": "context",
            "line": "             << \"Calling AP Title: \" << assoc->callingAPTitle);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": "    if ((assoc->presentationContextList = LST_Create()) == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "add",
            "line": "    if ((assoc->userInfo.SCUSCPRoleList = LST_Create()) == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "context",
            "line": "     while ((cond.good()) && (pduLength > 0))"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         type = *buf;"
          },
          {
            "type": "context",
            "line": "             {"
          },
          {
            "type": "context",
            "line": "                 buf += itemLength;"
          },
          {
            "type": "context",
            "line": "                 if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "delete",
            "line": "                  return makeUnderflowError(\"Application Context item\", pduLength, itemLength);"
          },
          {
            "type": "delete",
            "line": "                DCMNET_TRACE(\"Successfully parsed Application Context\");"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    cond = makeUnderflowError(\"Application Context item\", pduLength, itemLength);"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                else"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    DCMNET_TRACE(\"Successfully parsed Application Context\");"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": "         case DUL_TYPEPRESENTATIONCONTEXTRQ:"
          },
          {
            "type": "context",
            "line": "         case DUL_TYPEPRESENTATIONCONTEXTAC:"
          },
          {
            "type": "context",
            "line": "             context = (PRV_PRESENTATIONCONTEXTITEM*)malloc(sizeof(PRV_PRESENTATIONCONTEXTITEM));"
          },
          {
            "type": "delete",
            "line": "            if (context == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "delete",
            "line": "            (void) memset(context, 0, sizeof(*context));"
          },
          {
            "type": "delete",
            "line": "            cond = parsePresentationContext(type, context, buf, &itemLength, pduLength);"
          },
          {
            "type": "delete",
            "line": "            if (cond.bad()) return cond;"
          },
          {
            "type": "delete",
            "line": "            buf += itemLength;"
          },
          {
            "type": "delete",
            "line": "            if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "delete",
            "line": "              return makeUnderflowError(\"Presentation Context item\", pduLength, itemLength);"
          },
          {
            "type": "delete",
            "line": "            LST_Enqueue(&assoc->presentationContextList, (LST_NODE*)context);"
          },
          {
            "type": "delete",
            "line": "            DCMNET_TRACE(\"Successfully parsed Presentation Context\");"
          },
          {
            "type": "add",
            "line": "            if (context != NULL)"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                (void) memset(context, 0, sizeof(*context));"
          },
          {
            "type": "add",
            "line": "                cond = parsePresentationContext(type, context, buf, &itemLength, pduLength);"
          },
          {
            "type": "add",
            "line": "                if (cond.bad())"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    free(context);"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                else"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    buf += itemLength;"
          },
          {
            "type": "add",
            "line": "                    if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "add",
            "line": "                    {"
          },
          {
            "type": "add",
            "line": "                        cond =  makeUnderflowError(\"Presentation Context item\", pduLength, itemLength);"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "add",
            "line": "                    else"
          },
          {
            "type": "add",
            "line": "                    {"
          },
          {
            "type": "add",
            "line": "                        LST_Enqueue(&assoc->presentationContextList, (LST_NODE*)context);"
          },
          {
            "type": "add",
            "line": "                        DCMNET_TRACE(\"Successfully parsed Presentation Context\");"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            else"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                cond = EC_MemoryExhausted;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": "         case DUL_TYPEUSERINFO:"
          },
          {
            "type": "context",
            "line": "             // parse user info, which can contain several sub-items like User"
          },
          {
            "type": "context",
            "line": "             // Identity Negotiation or SOP Class Extended Negotiation"
          },
          {
            "type": "context",
            "line": "             cond = parseUserInfo(&assoc->userInfo, buf, &itemLength, assoc->type, pduLength);"
          },
          {
            "type": "delete",
            "line": "            if (cond.bad())"
          },
          {
            "type": "delete",
            "line": "                return cond;"
          },
          {
            "type": "delete",
            "line": "            buf += itemLength;"
          },
          {
            "type": "delete",
            "line": "            if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "delete",
            "line": "              return makeUnderflowError(\"User Information item\", pduLength, itemLength);"
          },
          {
            "type": "delete",
            "line": "            DCMNET_TRACE(\"Successfully parsed User Information\");"
          },
          {
            "type": "add",
            "line": "            if (cond.good())"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                buf += itemLength;"
          },
          {
            "type": "add",
            "line": "                if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    cond = makeUnderflowError(\"User Information item\", pduLength, itemLength);"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "                else"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    DCMNET_TRACE(\"Successfully parsed User Information\");"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": "         default:"
          },
          {
            "type": "context",
            "line": "             cond = parseDummy(buf, &itemLength, pduLength);"
          },
          {
            "type": "delete",
            "line": "            if (cond.bad())"
          },
          {
            "type": "delete",
            "line": "                return cond;"
          },
          {
            "type": "delete",
            "line": "            buf += itemLength;"
          },
          {
            "type": "delete",
            "line": "            if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "delete",
            "line": "              return makeUnderflowError(\"unknown item type\", pduLength, itemLength);"
          },
          {
            "type": "add",
            "line": "            if (cond.good())"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                buf += itemLength;"
          },
          {
            "type": "add",
            "line": "                if (!OFStandard::safeSubtract(pduLength, itemLength, pduLength))"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    cond = makeUnderflowError(\"unknown item type\", pduLength, itemLength);"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             break;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": "    if (cond.bad())"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "      destroyPresentationContextList(&assoc->presentationContextList);"
          },
          {
            "type": "add",
            "line": "      destroyUserInformationLists(&assoc->userInfo);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": "     return cond;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 subItem = (DUL_SUBITEM*)malloc(sizeof(DUL_SUBITEM));"
          },
          {
            "type": "context",
            "line": "                 if (subItem == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "context",
            "line": "                 cond = parseSubItem(subItem, buf, &length, presentationLength);"
          },
          {
            "type": "delete",
            "line": "                if (cond.bad()) return cond;"
          },
          {
            "type": "add",
            "line": "                if (cond.bad())"
          },
          {
            "type": "add",
            "line": "                {"
          },
          {
            "type": "add",
            "line": "                    free(subItem);"
          },
          {
            "type": "add",
            "line": "                    return cond;"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "context",
            "line": "                 LST_Enqueue(&context->transferSyntaxList, (LST_NODE*)subItem);"
          },
          {
            "type": "context",
            "line": "                 buf += length;"
          },
          {
            "type": "context",
            "line": "                 if (!OFStandard::safeSubtract(presentationLength, length, presentationLength))"
          },
          {
            "type": "context",
            "line": "             role = (PRV_SCUSCPROLE*)malloc(sizeof(PRV_SCUSCPROLE));"
          },
          {
            "type": "context",
            "line": "             if (role == NULL) return EC_MemoryExhausted;"
          },
          {
            "type": "context",
            "line": "             cond = parseSCUSCPRole(role, buf, &length, userLength);"
          },
          {
            "type": "delete",
            "line": "            if (cond.bad()) return cond;"
          },
          {
            "type": "add",
            "line": "            if (cond.bad())"
          },
          {
            "type": "add",
            "line": "            {"
          },
          {
            "type": "add",
            "line": "                free(role);"
          },
          {
            "type": "add",
            "line": "                return cond;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "context",
            "line": "             LST_Enqueue(&userInfo->SCUSCPRoleList, (LST_NODE*)role);"
          },
          {
            "type": "context",
            "line": "             buf += length;"
          },
          {
            "type": "context",
            "line": "             if (!OFStandard::safeSubtract(userLength, OFstatic_cast(short unsigned int, length), userLength))"
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/dulpres.cc",
        "changes": [
          {
            "type": "context",
            "line": "index ece31a063..7ba3beef1 100644"
          },
          {
            "type": "context",
            "line": "--- a/dcmnet/libsrc/dulpres.cc"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/dulpres.cc"
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/cond.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "context",
            "line": " #include \"dcmtk/dcmnet/dul.h\""
          },
          {
            "type": "delete",
            "line": "#include \"dulstruc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulpriv.h\""
          },
          {
            "type": "context",
            "line": " #include \"dulfsm.h\""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "dcmnet/libsrc/helpers.cc",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..9cd20cefc"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/dcmnet/libsrc/helpers.cc"
          },
          {
            "type": "add",
            "line": "/*"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Copyright (C) 2021, OFFIS e.V."
          },
          {
            "type": "add",
            "line": " *  All rights reserved.  See COPYRIGHT file for details."
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  This software and supporting documentation were partly developed by"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *    OFFIS e.V."
          },
          {
            "type": "add",
            "line": " *    R&D Division Health"
          },
          {
            "type": "add",
            "line": " *    Escherweg 2"
          },
          {
            "type": "add",
            "line": " *    D-26121 Oldenburg, Germany"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Module: dcmnet"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Author: Michael Onken"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " *  Purpose: Collection of helper functions"
          },
          {
            "type": "add",
            "line": " *"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/helpers.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/lst.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/assoc.h\""
          },
          {
            "type": "add",
            "line": "#include \"dcmtk/dcmnet/dulstruc.h\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "void"
          },
          {
            "type": "add",
            "line": "destroyPresentationContextList(LST_HEAD ** l)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    PRV_PRESENTATIONCONTEXTITEM"
          },
          {
            "type": "add",
            "line": "    * prvCtx;"
          },
          {
            "type": "add",
            "line": "    DUL_SUBITEM"
          },
          {
            "type": "add",
            "line": "        * subItem;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    if (*l == NULL)"
          },
          {
            "type": "add",
            "line": "        return;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    prvCtx = (PRV_PRESENTATIONCONTEXTITEM*)LST_Dequeue(l);"
          },
          {
            "type": "add",
            "line": "    while (prvCtx != NULL) {"
          },
          {
            "type": "add",
            "line": "        subItem = (DUL_SUBITEM*)LST_Dequeue(&prvCtx->transferSyntaxList);"
          },
          {
            "type": "add",
            "line": "        while (subItem != NULL) {"
          },
          {
            "type": "add",
            "line": "            free(subItem);"
          },
          {
            "type": "add",
            "line": "            subItem = (DUL_SUBITEM*)LST_Dequeue(&prvCtx->transferSyntaxList);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        LST_Destroy(&prvCtx->transferSyntaxList);"
          },
          {
            "type": "add",
            "line": "        free(prvCtx);"
          },
          {
            "type": "add",
            "line": "        prvCtx = (PRV_PRESENTATIONCONTEXTITEM*)LST_Dequeue(l);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    LST_Destroy(l);"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "void"
          },
          {
            "type": "add",
            "line": "destroyUserInformationLists(DUL_USERINFO * userInfo)"
          },
          {
            "type": "add",
            "line": "{"
          },
          {
            "type": "add",
            "line": "    PRV_SCUSCPROLE"
          },
          {
            "type": "add",
            "line": "    * role;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    role = (PRV_SCUSCPROLE*)LST_Dequeue(&userInfo->SCUSCPRoleList);"
          },
          {
            "type": "add",
            "line": "    while (role != NULL) {"
          },
          {
            "type": "add",
            "line": "        free(role);"
          },
          {
            "type": "add",
            "line": "        role = (PRV_SCUSCPROLE*)LST_Dequeue(&userInfo->SCUSCPRoleList);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": "    LST_Destroy(&userInfo->SCUSCPRoleList);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* extended negotiation */"
          },
          {
            "type": "add",
            "line": "    delete userInfo->extNegList; userInfo->extNegList = NULL;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /* user identity negotiation */"
          },
          {
            "type": "add",
            "line": "    delete userInfo->usrIdent; userInfo->usrIdent = NULL;"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      }
    ]
  },
  {
    "commit": "ab12b686ced4cf233d3b15b08da008e0553eb6a6",
    "files": [
      {
        "file": "src/common/Widget/Widget_MyLatestSvnCommits.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index d98308a620d..f5cb8586d48 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Widget/Widget_MyLatestSvnCommits.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Widget/Widget_MyLatestSvnCommits.class.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "delete",
            "line": " * Copyright (c) Enalean, 2013 - 2018. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2013 - Present. All Rights Reserved."
          },
          {
            "type": "context",
            "line": "  * Copyright (c) Xerox Corporation, Codendi 2001-2009."
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * This file is a part of Tuleap."
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 $html .= '<strong>' . $hp->purify($project->getPublicName()) . '</strong>';"
          },
          {
            "type": "context",
            "line": "                 if (! $hide_now) {"
          },
          {
            "type": "delete",
            "line": "                    list($latest_revisions, $nb_revisions) = svn_get_revisions($project, 0, $this->_nb_svn_commits, '', $user->getUserName(), '', '', 0, false);"
          },
          {
            "type": "add",
            "line": "                    list($latest_revisions, $nb_revisions) = svn_get_revisions($project, 0, $this->_nb_svn_commits, '', $user->getUserName(), '', [], 0, false);"
          },
          {
            "type": "context",
            "line": "                     $revision_total += $nb_revisions;"
          },
          {
            "type": "context",
            "line": "                     if (db_numrows($latest_revisions) > 0) {"
          },
          {
            "type": "context",
            "line": "                         $i = 0;"
          }
        ]
      },
      {
        "file": "src/common/Widget/Widget_ProjectLatestSvnCommits.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index ee235508094..a28cd2fa2aa 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/Widget/Widget_ProjectLatestSvnCommits.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/Widget/Widget_ProjectLatestSvnCommits.class.php"
          },
          {
            "type": "context",
            "line": "             $pm = ProjectManager::instance();"
          },
          {
            "type": "context",
            "line": "             $project = $pm->getProject($this->group_id);"
          },
          {
            "type": "context",
            "line": "             if ($project && $this->canBeUsedByProject($project)) {"
          },
          {
            "type": "delete",
            "line": "                list($this->latest_revisions,) = svn_get_revisions($project, 0, 5, '', '', '', '', 0, false);"
          },
          {
            "type": "add",
            "line": "                list($this->latest_revisions,) = svn_get_revisions($project, 0, 5, '', '', '', [], 0, false);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         return $this->latest_revisions;"
          }
        ]
      },
      {
        "file": "src/common/svn/SVN_LogFactory.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index fbe5d163ef7..ee7f185a4eb 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/common/svn/SVN_LogFactory.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/common/svn/SVN_LogFactory.class.php"
          },
          {
            "type": "context",
            "line": " <?php"
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "delete",
            "line": " * Copyright (c) Enalean, 2012-2018. All Rights Reserved."
          },
          {
            "type": "add",
            "line": " * Copyright (c) Enalean, 2012-Present. All Rights Reserved."
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "  * This file is a part of Tuleap."
          },
          {
            "type": "context",
            "line": "  *"
          },
          {
            "type": "context",
            "line": "             '',"
          },
          {
            "type": "context",
            "line": "             $author->getUserName(),"
          },
          {
            "type": "context",
            "line": "             '',"
          },
          {
            "type": "delete",
            "line": "            '',"
          },
          {
            "type": "add",
            "line": "            [],"
          },
          {
            "type": "context",
            "line": "             0,"
          },
          {
            "type": "context",
            "line": "             false"
          },
          {
            "type": "context",
            "line": "         );"
          }
        ]
      },
      {
        "file": "src/www/svn/browse_revision.php",
        "changes": [
          {
            "type": "context",
            "line": "index 6c72481cd9c..666f9c07fc2 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/svn/browse_revision.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/svn/browse_revision.php"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    $order_by = '';"
          },
          {
            "type": "add",
            "line": "    $order_by = [];"
          },
          {
            "type": "context",
            "line": "     if (isset($morder)) {"
          },
          {
            "type": "context",
            "line": "         if (user_isloggedin()) {"
          },
          {
            "type": "context",
            "line": "             if ($morder != user_get_preference('svn_commit_browse_order' . $group_id)) {"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if ($morder != '') {"
          },
          {
            "type": "delete",
            "line": "            $order_by = ' ORDER BY ' . svn_utils_criteria_list_to_query($morder);"
          },
          {
            "type": "add",
            "line": "            $order_by = svn_utils_criteria_list_to_query($morder);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "src/www/svn/svn_utils.php",
        "changes": [
          {
            "type": "context",
            "line": "index a5358c1b914..7efad0c68ce 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/svn/svn_utils.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/svn/svn_utils.php"
          },
          {
            "type": "context",
            "line": "     return(join(',', $arr));"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "// Transform criteria list to SQL query (+ means ascending"
          },
          {
            "type": "delete",
            "line": "// - is descending)"
          },
          {
            "type": "delete",
            "line": "function svn_utils_criteria_list_to_query($criteria_list)"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * @psalm-return array<array{order:\"ASC\"|\"DESC\", column: \"revision\"|\"commit_id\"|\"description\"|\"date\"|\"whoid\"}>"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "function svn_utils_criteria_list_to_query(string $criteria_list): array"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "delete",
            "line": "    $criteria_list = str_replace('>', ' ASC', $criteria_list);"
          },
          {
            "type": "delete",
            "line": "    $criteria_list = str_replace('<', ' DESC', $criteria_list);"
          },
          {
            "type": "delete",
            "line": "    return $criteria_list;"
          },
          {
            "type": "add",
            "line": "    $order_list = [];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    foreach (explode(',', $criteria_list) as $criteria) {"
          },
          {
            "type": "add",
            "line": "        if (preg_match('/^(?<column>[a-z]+)(?<order>[<>]?)$/', $criteria, $matches) === 1) {"
          },
          {
            "type": "add",
            "line": "            $column = $matches['column'];"
          },
          {
            "type": "add",
            "line": "            if (! in_array($column, ['revision', 'commit_id', 'description', 'date', 'whoid'], true)) {"
          },
          {
            "type": "add",
            "line": "                continue;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $order = 'ASC';"
          },
          {
            "type": "add",
            "line": "            if ($matches['order'] === '<') {"
          },
          {
            "type": "add",
            "line": "                $order = 'DESC';"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            $order_list[] = ['order' => $order, 'column' => $column];"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return $order_list;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // Transform criteria list to readable text statement"
          },
          {
            "type": "context",
            "line": "         $morder = '';"
          },
          {
            "type": "context",
            "line": "         $arr = explode(',', $criteria_list);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $purifier = Codendi_HTMLPurifier::instance();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "         foreach ($arr as $crit) {"
          },
          {
            "type": "context",
            "line": "             $morder .= ($morder ? \",\" . $crit : $crit);"
          },
          {
            "type": "context",
            "line": "             $attr = str_replace('>', '', $crit);"
          },
          {
            "type": "context",
            "line": "             $attr = str_replace('<', '', $attr);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            $arr_text[] = '<a href=\"' . $url . '&morder=' . $morder . '#results\">' ."
          },
          {
            "type": "delete",
            "line": "            svn_utils_field_get_label($attr) . '</a><img src=\"' . util_get_dir_image_theme() ."
          },
          {
            "type": "add",
            "line": "            $arr_text[] = '<a href=\"' . $url . '&morder=' . $purifier->purify(urlencode($morder)) . '#results\">' ."
          },
          {
            "type": "add",
            "line": "            $purifier->purify(svn_utils_field_get_label($attr)) . '</a><img src=\"' . util_get_dir_image_theme() ."
          },
          {
            "type": "context",
            "line": "             ((substr($crit, -1) == '<') ? 'dn' : 'up') ."
          },
          {
            "type": "context",
            "line": "             '_arrow.png\" border=\"0\">';"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     return ! $specifics || $specifics != '';"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "function svn_get_revisions(Project $project, $offset, $chunksz, $_rev_id = '', $_commiter = '', $_srch = '', $order_by = '', $pv = 0, $foundRows = true)"
          },
          {
            "type": "add",
            "line": "/**"
          },
          {
            "type": "add",
            "line": " * @psalm-param array<array{order:\"ASC\"|\"DESC\", column: \"revision\"|\"commit_id\"|\"description\"|\"date\"|\"whoid\"}> $order_by"
          },
          {
            "type": "add",
            "line": " */"
          },
          {
            "type": "add",
            "line": "function svn_get_revisions(Project $project, $offset, $chunksz, $_rev_id = '', $_commiter = '', $_srch = '', array $order_by = [], $pv = 0, $foundRows = true)"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     global $_path;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     $where .= $commiter_str . $commit_str . $srch_str . $path_str;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    $limit = '';"
          },
          {
            "type": "context",
            "line": "     if (! isset($pv) || ! $pv) {"
          },
          {
            "type": "context",
            "line": "         $limit = \" LIMIT \" . db_ei($offset) . \",\" . db_ei($chunksz);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    // SQLi Warning: no real possibility to escape $order_by here."
          },
          {
            "type": "delete",
            "line": "    // We rely on a proper filtering of user input by calling methods."
          },
          {
            "type": "delete",
            "line": "    if (! isset($order_by) || $order_by == '') {"
          },
          {
            "type": "delete",
            "line": "        $order_by = \" ORDER BY revision DESC \";"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    $sql = $select . $from . $where . $group_by . $order_by . $limit;"
          },
          {
            "type": "add",
            "line": "    if (empty($order_by)) {"
          },
          {
            "type": "add",
            "line": "        $order_by_sql = \" ORDER BY revision DESC \";"
          },
          {
            "type": "add",
            "line": "    } else {"
          },
          {
            "type": "add",
            "line": "        $order_by_sql = ' ORDER BY ';"
          },
          {
            "type": "add",
            "line": "        $order_by_sql .= implode("
          },
          {
            "type": "add",
            "line": "            ',',"
          },
          {
            "type": "add",
            "line": "            array_map("
          },
          {
            "type": "add",
            "line": "                static function (array $order_by_row) {"
          },
          {
            "type": "add",
            "line": "                    return $order_by_row['column'] . ' ' . $order_by_row['order'];"
          },
          {
            "type": "add",
            "line": "                },"
          },
          {
            "type": "add",
            "line": "                $order_by"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "add",
            "line": "        $order_by_sql .= ' ';"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    $sql = $select . $from . $where . $group_by . $order_by_sql . $limit;"
          },
          {
            "type": "context",
            "line": "     //echo $sql.\"<br>\\n\";"
          },
          {
            "type": "context",
            "line": "     $result = db_query($sql);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if ($foundRows) {"
          },
          {
            "type": "context",
            "line": "         $sql1 = 'SELECT FOUND_ROWS() as nb';"
          },
          {
            "type": "context",
            "line": "         $result1 = db_query($sql1);"
          },
          {
            "type": "delete",
            "line": "        if ($result1 && ! db_error($result1)) {"
          },
          {
            "type": "add",
            "line": "        if ($result1 && ! db_error()) {"
          },
          {
            "type": "context",
            "line": "             $row1 = db_fetch_array($result1);"
          },
          {
            "type": "context",
            "line": "             $totalrows = $row1['nb'];"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "tests/psalm/tuleap-baseline.xml",
        "changes": [
          {
            "type": "context",
            "line": "index d1c28dc7256..ff713f3a9e8 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/psalm/tuleap-baseline.xml"
          },
          {
            "type": "context",
            "line": "+++ b/tests/psalm/tuleap-baseline.xml"
          },
          {
            "type": "context",
            "line": "     </UndefinedGlobalVariable>"
          },
          {
            "type": "context",
            "line": "   </file>"
          },
          {
            "type": "context",
            "line": "   <file src=\"src/www/svn/svn_utils.php\">"
          },
          {
            "type": "delete",
            "line": "    <DeprecatedFunction occurrences=\"20\">"
          },
          {
            "type": "add",
            "line": "    <DeprecatedFunction occurrences=\"25\">"
          },
          {
            "type": "context",
            "line": "       <code>html_build_select_box_from_arrays($userids, $usernames, $name, $checked, true, $text_100, false, '', false, '', CODENDI_PURIFIER_CONVERT_HTML)</code>"
          },
          {
            "type": "context",
            "line": "       <code>db_fetch_array($result)</code>"
          },
          {
            "type": "context",
            "line": "       <code>db_numrows($result)</code>"
          },
          {
            "type": "context",
            "line": "       <code>db_es(htmlspecialchars($_srch))</code>"
          },
          {
            "type": "context",
            "line": "       <code>db_ei($offset)</code>"
          },
          {
            "type": "context",
            "line": "       <code>db_ei($chunksz)</code>"
          },
          {
            "type": "add",
            "line": "      <code>db_query($sql)</code>"
          },
          {
            "type": "add",
            "line": "      <code>db_query($sql1)</code>"
          },
          {
            "type": "add",
            "line": "      <code>db_fetch_array($sql1)</code>"
          },
          {
            "type": "add",
            "line": "      <code>db_error()</code>"
          },
          {
            "type": "context",
            "line": "     </DeprecatedFunction>"
          },
          {
            "type": "context",
            "line": "     <MissingParamType occurrences=\"51\">"
          },
          {
            "type": "context",
            "line": "       <code>$params</code>"
          }
        ]
      }
    ]
  },
  {
    "commit": "abdafb0cae1e0c00f184abbadc692f4eaa98f451",
    "files": [
      {
        "file": "liparsers.js",
        "changes": [
          {
            "type": "context",
            "line": "index 42730fe..b14bc83 100644"
          },
          {
            "type": "context",
            "line": "--- a/lib/parsers.js"
          },
          {
            "type": "context",
            "line": "+++ b/lib/parsers.js"
          },
          {
            "type": "context",
            "line": "     .set('multiplier', function() {"
          },
          {
            "type": "context",
            "line": "       var isInside = this.isInside('brace');"
          },
          {
            "type": "context",
            "line": "       var pos = this.position();"
          },
          {
            "type": "delete",
            "line": "      var m = this.match(/^\\{(,+(?:(\\{,+\\})*),*|,*(?:(\\{,+\\})*),+)\\}/);"
          },
          {
            "type": "add",
            "line": "      var m = this.match(/^\\{((?:,|\\{,+\\})+)\\}/);"
          },
          {
            "type": "context",
            "line": "       if (!m) return;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       this.multiplier = true;"
          }
        ]
      }
    ]
  },
  {
    "commit": "b290bfd573c6f7db6cc15a88dd4111d9fcad0d31",
    "files": [
      {
        "file": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-docker/src/test/it/org/xwiki/administration/test/ui/RegisterIT.java",
        "changes": [
          {
            "type": "context",
            "line": "index 31c3c33a1be..620c51d86a9 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-docker/src/test/it/org/xwiki/administration/test/ui/RegisterIT.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-test/xwiki-platform-administration-test-docker/src/test/it/org/xwiki/administration/test/ui/RegisterIT.java"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " package org.xwiki.administration.test.ui;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import java.util.List;"
          },
          {
            "type": "context",
            "line": " import java.util.stream.Stream;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import org.junit.jupiter.api.Order;"
          },
          {
            "type": "add",
            "line": "import org.junit.jupiter.api.Test;"
          },
          {
            "type": "context",
            "line": " import org.junit.jupiter.params.ParameterizedTest;"
          },
          {
            "type": "context",
            "line": " import org.junit.jupiter.params.provider.Arguments;"
          },
          {
            "type": "context",
            "line": " import org.junit.jupiter.params.provider.MethodSource;"
          },
          {
            "type": "context",
            "line": " import org.openqa.selenium.By;"
          },
          {
            "type": "context",
            "line": " import org.openqa.selenium.NoSuchElementException;"
          },
          {
            "type": "delete",
            "line": "import org.openqa.selenium.WebElement;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.administration.test.po.RegistrationModal;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.docker.junit5.UITest;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.TestUtils;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.po.AbstractRegistrationPage;"
          },
          {
            "type": "context",
            "line": " import org.xwiki.test.ui.po.RegistrationPage;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import static org.junit.jupiter.api.Assertions.assertEquals;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertFalse;"
          },
          {
            "type": "context",
            "line": " import static org.junit.jupiter.api.Assertions.assertTrue;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         assertTrue(registrationPage.validationFailureMessagesInclude(\"Please enter a valid email address.\"));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    @Test"
          },
          {
            "type": "add",
            "line": "    @Order(8)"
          },
          {
            "type": "add",
            "line": "    void registerWikiSyntaxName(TestUtils testUtils) throws Exception"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        AbstractRegistrationPage registrationPage = setUp(testUtils, false, false);"
          },
          {
            "type": "add",
            "line": "        String password = \"SomePassword\";"
          },
          {
            "type": "add",
            "line": "        String firstName = \"]]{{/html}}{{html clean=false}}HT&amp;ML\";"
          },
          {
            "type": "add",
            "line": "        String lastName = \"]]{{/html}}\";"
          },
          {
            "type": "add",
            "line": "        String username = \"WikiSyntaxName\";"
          },
          {
            "type": "add",
            "line": "        registrationPage.fillRegisterForm(firstName, lastName, username, password, password, \"wiki@example.com\");"
          },
          {
            "type": "add",
            "line": "        assertTrue(validateAndRegister(testUtils, false, false, registrationPage));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assertEquals(String.format(\"%s %s (%s): Registration successful.\", firstName, lastName, username),"
          },
          {
            "type": "add",
            "line": "            ((RegistrationPage) registrationPage).getRegistrationSuccessMessage().orElseThrow());"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private AbstractRegistrationPage setUp(TestUtils testUtils, boolean useLiveValidation, boolean isModal)"
          },
          {
            "type": "context",
            "line": "         throws Exception"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         if (isModal) {"
          },
          {
            "type": "context",
            "line": "             return administrationModalUserCreation(testUtils, registrationPage);"
          },
          {
            "type": "context",
            "line": "         } else {"
          },
          {
            "type": "delete",
            "line": "            return guestUserRegistration(testUtils, registrationPage);"
          },
          {
            "type": "add",
            "line": "            return guestUserRegistration(registrationPage);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    private boolean guestUserRegistration(TestUtils testUtils, AbstractRegistrationPage registrationPage)"
          },
          {
            "type": "add",
            "line": "    private boolean guestUserRegistration(AbstractRegistrationPage registrationPage)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         registrationPage.clickRegister();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        List<WebElement> infos = testUtils.getDriver().findElements(By.className(\"infomessage\"));"
          },
          {
            "type": "delete",
            "line": "        for (WebElement info : infos) {"
          },
          {
            "type": "delete",
            "line": "            if (info.getText().contains(\"Registration successful.\")) {"
          },
          {
            "type": "delete",
            "line": "                return true;"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "        return false;"
          },
          {
            "type": "add",
            "line": "        return ((RegistrationPage) registrationPage).getRegistrationSuccessMessage().isPresent();"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private void tryToLoginAsJohnSmith(TestUtils testUtils, AbstractRegistrationPage registrationPage)"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/RegistrationConfig.xml",
        "changes": [
          {
            "type": "context",
            "line": "index ae1e3b1d9a3..640c8d1bd36 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/RegistrationConfig.xml"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/RegistrationConfig.xml"
          },
          {
            "type": "context",
            "line": "       <passwordRuleOneUpperCaseEnabled>0</passwordRuleOneUpperCaseEnabled>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "     <property>"
          },
          {
            "type": "delete",
            "line": "      <registrationSuccessMessage>#set($fullName = \"$request.get('register_first_name') $request.get('register_last_name')\")"
          },
          {
            "type": "delete",
            "line": "{{info}}$services.localization.render('core.register.successful', [\"[[$fullName&gt;&gt;$userSpace$userName]]\", $userName]){{/info}}</registrationSuccessMessage>"
          },
          {
            "type": "add",
            "line": "      <registrationSuccessMessage>#set($message = $services.localization.render('core.register.successful', 'xwiki/2.1', ['USERLINK', $userName]))"
          },
          {
            "type": "add",
            "line": "#set($userLink = $xwiki.getUserName(\"$userSpace$userName\"))"
          },
          {
            "type": "add",
            "line": "{{info}}$message.replace('USERLINK', \"{{html clean=false}}$userLink{{/html}}\"){{/info}}</registrationSuccessMessage>"
          },
          {
            "type": "context",
            "line": "     </property>"
          },
          {
            "type": "context",
            "line": "     <property>"
          },
          {
            "type": "context",
            "line": "       <requireCaptcha>0</requireCaptcha>"
          }
        ]
      },
      {
        "file": "xwiki-platform-core/xwiki-platform-test/xwiki-platform-test-ui/src/main/java/org/xwiki/test/ui/po/RegistrationPage.java",
        "changes": [
          {
            "type": "context",
            "line": "index bea4fa49d00..cf5a0eff76a 100644"
          },
          {
            "type": "context",
            "line": "--- a/xwiki-platform-core/xwiki-platform-test/xwiki-platform-test-ui/src/main/java/org/xwiki/test/ui/po/RegistrationPage.java"
          },
          {
            "type": "context",
            "line": "+++ b/xwiki-platform-core/xwiki-platform-test/xwiki-platform-test-ui/src/main/java/org/xwiki/test/ui/po/RegistrationPage.java"
          },
          {
            "type": "context",
            "line": "  */"
          },
          {
            "type": "context",
            "line": " package org.xwiki.test.ui.po;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "import java.util.List;"
          },
          {
            "type": "add",
            "line": "import java.util.Optional;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "import org.openqa.selenium.By;"
          },
          {
            "type": "context",
            "line": " import org.openqa.selenium.WebElement;"
          },
          {
            "type": "context",
            "line": " import org.openqa.selenium.support.FindBy;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         this.submitButton.click();"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @since 14.10.17"
          },
          {
            "type": "add",
            "line": "     * @since 15.5.3"
          },
          {
            "type": "add",
            "line": "     * @since 15.8RC1"
          },
          {
            "type": "add",
            "line": "     *"
          },
          {
            "type": "add",
            "line": "     * @return the registration success message if present after submitting the registration form"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "add",
            "line": "    public Optional<String> getRegistrationSuccessMessage()"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        List<WebElement> infos = getDriver().findElements(By.className(\"infomessage\"));"
          },
          {
            "type": "add",
            "line": "        for (WebElement info : infos) {"
          },
          {
            "type": "add",
            "line": "            if (info.getText().contains(\"Registration successful.\")) {"
          },
          {
            "type": "add",
            "line": "                return Optional.of(info.getText());"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return Optional.empty();"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "b6fac4b411b8d145fc30fa35c66b51243eafd06b",
    "files": [
      {
        "file": "datamodels/2.x/itop-portal-base/portal/src/Form/ObjectFormManager.php",
        "changes": [
          {
            "type": "context",
            "line": "index 3fac09f48..2705b8c4d 100644"
          },
          {
            "type": "context",
            "line": "--- a/datamodels/2.x/itop-portal-base/portal/src/Form/ObjectFormManager.php"
          },
          {
            "type": "context",
            "line": "+++ b/datamodels/2.x/itop-portal-base/portal/src/Form/ObjectFormManager.php"
          },
          {
            "type": "context",
            "line": " \t * - formmode : view|edit|create"
          },
          {
            "type": "context",
            "line": " \t * - values for parent"
          },
          {
            "type": "context",
            "line": " \t *"
          },
          {
            "type": "add",
            "line": "\t * @param bool $bTrustContent if false then won't allow TWIG content"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @inheritDoc"
          },
          {
            "type": "context",
            "line": " \t * @throws \\Exception"
          },
          {
            "type": "add",
            "line": "\t * @throws \\SecurityException if twig content is present and $bTrustContent is false"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "delete",
            "line": "\tstatic function FromJSON($sJson)"
          },
          {
            "type": "add",
            "line": "\tpublic static function FromJSON($sJson, $bTrustContent = false)"
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "delete",
            "line": "\t\tif (is_array($sJson))"
          },
          {
            "type": "delete",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\tif (is_array($sJson)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t$aJson = $sJson;"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\t$aJson = json_decode($sJson, true);"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif (false === $bTrustContent) {"
          },
          {
            "type": "add",
            "line": "\t\t\t/** @noinspection NestedPositiveIfStatementsInspection */"
          },
          {
            "type": "add",
            "line": "\t\t\tif (isset($aJson['formproperties']['layout']['type']) && ($aJson['formproperties']['layout']['type'] === 'twig')) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t// There will be an IssueLog above in the hierarchy due to the exception, but we are logging here so that we can output the JSON data !"
          },
          {
            "type": "add",
            "line": "\t\t\t\tIssueLog::Error('Portal received a query with forbidden twig content!', \\LogChannels::PORTAL, ['formmanager_data' => $aJson]);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tthrow new \\SecurityException('Twig content not allowed in this context!');"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t/** @var \\Combodo\\iTop\\Portal\\Form\\ObjectFormManager $oFormManager */"
          },
          {
            "type": "context",
            "line": " \t\t$oFormManager = parent::FromJSON($sJson);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// Retrieving object to edit"
          },
          {
            "type": "delete",
            "line": "\t\tif (!isset($aJson['formobject_class']))"
          },
          {
            "type": "delete",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\tif (!isset($aJson['formobject_class'])) {"
          },
          {
            "type": "context",
            "line": " \t\t\tthrow new Exception('Object class must be defined in order to generate the form');"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t\t$sObjectClass = $aJson['formobject_class'];"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// Retrieving callback urls"
          },
          {
            "type": "delete",
            "line": "\t\tif (!isset($aJson['formcallbacks']))"
          },
          {
            "type": "delete",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\tif (!isset($aJson['formcallbacks'])) {"
          },
          {
            "type": "context",
            "line": " \t\t\t// TODO"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\treturn $oFormManager;"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t/**"
          },
          {
            "type": "add",
            "line": "\t * @param string $sPostedFormManagerData received data from the browser"
          },
          {
            "type": "add",
            "line": "\t * @param array $aOriginalFormProperties data generated server side"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @return bool true if the data are identical"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "add",
            "line": "\t * @since 2.7.6 3.0.0 N°4384 check formmanager_data"
          },
          {
            "type": "add",
            "line": "\t */"
          },
          {
            "type": "add",
            "line": "\tpublic static function CanTrustFormLayoutContent($sPostedFormManagerData, $aOriginalFormProperties)"
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\t$aPostedFormManagerData = json_decode($sPostedFormManagerData, true);"
          },
          {
            "type": "add",
            "line": "\t\t$sPostedFormLayoutType = (isset($aPostedFormManagerData['formproperties']['layout']['type'])) ? $aPostedFormManagerData['formproperties']['layout']['type'] : '';"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tif ($sPostedFormLayoutType === 'xhtml') {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn true;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t// we need to parse the content so that autoclose tags are returned correctly (`<div />` => `<div></div>`)"
          },
          {
            "type": "add",
            "line": "\t\t$oHtmlDocument = new \\DOMDocument();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t$sPostedFormLayoutContent = (isset($aPostedFormManagerData['formproperties']['layout']['content'])) ? $aPostedFormManagerData['formproperties']['layout']['content'] : '';"
          },
          {
            "type": "add",
            "line": "\t\t$oHtmlDocument->loadXML('<root>'.$sPostedFormLayoutContent.'</root>');"
          },
          {
            "type": "add",
            "line": "\t\t$sPostedFormLayoutRendered = $oHtmlDocument->saveHTML();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\t$sOriginalFormLayoutContent = (isset($aOriginalFormProperties['layout']['content'])) ? $aOriginalFormProperties['layout']['content'] : '';"
          },
          {
            "type": "add",
            "line": "\t\t$oHtmlDocument->loadXML('<root>'.$sOriginalFormLayoutContent.'</root>');"
          },
          {
            "type": "add",
            "line": "\t\t$sOriginalFormLayoutContentRendered = $oHtmlDocument->saveHTML();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\treturn ($sPostedFormLayoutRendered === $sOriginalFormLayoutContentRendered);"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t *"
          },
          {
            "type": "context",
            "line": " \t * @return \\Symfony\\Component\\DependencyInjection\\ContainerInterface"
          }
        ]
      },
      {
        "file": "datamodels/2.x/itop-portal-base/portal/src/Helper/ObjectFormHandlerHelper.php",
        "changes": [
          {
            "type": "context",
            "line": "index d114b1b05..ff4fcbd49 100644"
          },
          {
            "type": "context",
            "line": "--- a/datamodels/2.x/itop-portal-base/portal/src/Helper/ObjectFormHandlerHelper.php"
          },
          {
            "type": "context",
            "line": "+++ b/datamodels/2.x/itop-portal-base/portal/src/Helper/ObjectFormHandlerHelper.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t/**"
          },
          {
            "type": "context",
            "line": " \t * @param \\Symfony\\Component\\HttpFoundation\\Request $oRequest"
          },
          {
            "type": "delete",
            "line": "\t * @param string                                    $sMode"
          },
          {
            "type": "delete",
            "line": "\t * @param string                                    $sObjectClass"
          },
          {
            "type": "delete",
            "line": "\t * @param string                                    $sObjectId"
          },
          {
            "type": "delete",
            "line": "\t * @param string                                    $aFormProperties"
          },
          {
            "type": "add",
            "line": "\t * @param string $sMode"
          },
          {
            "type": "add",
            "line": "\t * @param string $sObjectClass"
          },
          {
            "type": "add",
            "line": "\t * @param string $sObjectId"
          },
          {
            "type": "add",
            "line": "\t * @param array $aFormProperties"
          },
          {
            "type": "context",
            "line": " \t *"
          },
          {
            "type": "context",
            "line": " \t * @return array"
          },
          {
            "type": "context",
            "line": " \t *"
          },
          {
            "type": "context",
            "line": " \t\t$bModal = ($oRequest->isXmlHttpRequest() && empty($sOperation));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// - Retrieve form properties"
          },
          {
            "type": "add",
            "line": "\t\t$aOriginalFormProperties = ApplicationHelper::GetLoadedFormFromClass($this->aCombodoPortalInstanceConf['forms'], $sObjectClass, $sMode);"
          },
          {
            "type": "context",
            "line": " \t\tif ($aFormProperties === null)"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "delete",
            "line": "\t\t\t$aFormProperties = ApplicationHelper::GetLoadedFormFromClass($this->aCombodoPortalInstanceConf['forms'], $sObjectClass, $sMode);"
          },
          {
            "type": "add",
            "line": "\t\t\t$aFormProperties = $aOriginalFormProperties;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// - Create and"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t$oFormManager->Build();"
          },
          {
            "type": "context",
            "line": " \t\t\t$aFormData['hidden_fields'] = $oFormManager->GetHiddenFieldsId();"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t// Check the number of editable fields"
          },
          {
            "type": "add",
            "line": "\t\t\t// Check the number of editable fields"
          },
          {
            "type": "context",
            "line": " \t\t\t$aFormData['editable_fields_count'] = $oFormManager->GetForm()->GetEditableFieldCount();"
          },
          {
            "type": "delete",
            "line": "\t\t}"
          },
          {
            "type": "delete",
            "line": "\t\telse"
          },
          {
            "type": "delete",
            "line": "\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\t// Update / Submit / Cancel"
          },
          {
            "type": "add",
            "line": "\t\t\t/** @var \\Combodo\\iTop\\Portal\\Form\\ObjectFormManager $sFormManagerClass */"
          },
          {
            "type": "context",
            "line": " \t\t\t$sFormManagerClass = $this->oRequestManipulator->ReadParam('formmanager_class', '', FILTER_UNSAFE_RAW);"
          },
          {
            "type": "context",
            "line": " \t\t\t$sFormManagerData = $this->oRequestManipulator->ReadParam('formmanager_data', '', FILTER_UNSAFE_RAW);"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (empty($sFormManagerClass) || empty($sFormManagerData))"
          },
          {
            "type": "delete",
            "line": "\t\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\tif (empty($sFormManagerClass) || empty($sFormManagerData)) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\tIssueLog::Error(__METHOD__.' at line '.__LINE__.' : Parameters formmanager_class and formamanager_data must be defined.');"
          },
          {
            "type": "context",
            "line": " \t\t\t\tthrow new HttpException(Response::HTTP_INTERNAL_SERVER_ERROR, 'Parameters formmanager_class and formmanager_data must be defined.');"
          },
          {
            "type": "context",
            "line": " \t\t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\t/** @var \\Combodo\\iTop\\Portal\\Form\\ObjectFormManager $oFormManager */"
          },
          {
            "type": "delete",
            "line": "\t\t\t$oFormManager = $sFormManagerClass::FromJSON($sFormManagerData);"
          },
          {
            "type": "add",
            "line": "\t\t\t$bTrustContent = $sFormManagerClass::CanTrustFormLayoutContent($sFormManagerData, $aOriginalFormProperties);"
          },
          {
            "type": "add",
            "line": "\t\t\t$oFormManager = $sFormManagerClass::FromJSON($sFormManagerData, $bTrustContent);"
          },
          {
            "type": "context",
            "line": " \t\t\t$oFormManager->SetContainer($this->oContainer);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t\t// Applying action rules if present"
          },
          {
            "type": "delete",
            "line": "\t\t\tif (($oFormManager->GetActionRulesToken() !== null) && ($oFormManager->GetActionRulesToken() !== ''))"
          },
          {
            "type": "delete",
            "line": "\t\t\t{"
          },
          {
            "type": "add",
            "line": "\t\t\tif (($oFormManager->GetActionRulesToken() !== null) && ($oFormManager->GetActionRulesToken() !== '')) {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$aActionRules = ContextManipulatorHelper::DecodeRulesToken($oFormManager->GetActionRulesToken());"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$oObj = $oFormManager->GetObject();"
          },
          {
            "type": "context",
            "line": " \t\t\t\t$this->oContextManipulator->PrepareObject($aActionRules, $oObj);"
          }
        ]
      },
      {
        "file": "sources/form/formmanager.class.inc.php",
        "changes": [
          {
            "type": "context",
            "line": "index feeb2359e..4f20d1f4c 100644"
          },
          {
            "type": "context",
            "line": "--- a/sources/form/formmanager.class.inc.php"
          },
          {
            "type": "context",
            "line": "+++ b/sources/form/formmanager.class.inc.php"
          },
          {
            "type": "context",
            "line": " \t * - formrenderer_class : The class of the FormRenderer to use in the FormManager"
          },
          {
            "type": "context",
            "line": " \t * - formrenderer_endpoint : The endpoint of the renderer"
          },
          {
            "type": "context",
            "line": " \t *"
          },
          {
            "type": "delete",
            "line": "\t * @param string $sJson"
          },
          {
            "type": "add",
            "line": "\t * @param string|string[] $sJson"
          },
          {
            "type": "add",
            "line": "\t *"
          },
          {
            "type": "context",
            "line": " \t * @return $this"
          },
          {
            "type": "context",
            "line": " \t */"
          },
          {
            "type": "context",
            "line": " \tstatic function FromJSON($sJson)"
          }
        ]
      }
    ]
  },
  {
    "commit": "b8c9ede6efa231116c4bd8bb9d5e03eac1cb76dc",
    "files": [
      {
        "file": "ctx.go",
        "changes": [
          {
            "type": "context",
            "line": "index ddb1e61d..f409250a 100644"
          },
          {
            "type": "context",
            "line": "--- a/ctx.go"
          },
          {
            "type": "context",
            "line": "+++ b/ctx.go"
          },
          {
            "type": "context",
            "line": " \treturn false"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "var localHosts = [...]string{\"127.0.0.1\", \"0.0.0.0\", \"::1\"}"
          },
          {
            "type": "add",
            "line": "var localHosts = [...]string{\"127.0.0.1\", \"::1\"}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // IsLocalHost will return true if address is a localhost address."
          },
          {
            "type": "context",
            "line": " func (*Ctx) isLocalHost(address string) bool {"
          },
          {
            "type": "context",
            "line": " \tfor _, h := range localHosts {"
          },
          {
            "type": "delete",
            "line": "\t\tif strings.Contains(address, h) {"
          },
          {
            "type": "add",
            "line": "\t\tif address == h {"
          },
          {
            "type": "context",
            "line": " \t\t\treturn true"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // IsFromLocal will return true if request came from local."
          },
          {
            "type": "context",
            "line": " func (c *Ctx) IsFromLocal() bool {"
          },
          {
            "type": "delete",
            "line": "\tips := c.IPs()"
          },
          {
            "type": "delete",
            "line": "\tif len(ips) == 0 {"
          },
          {
            "type": "delete",
            "line": "\t\tips = append(ips, c.IP())"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": "\treturn c.isLocalHost(ips[0])"
          },
          {
            "type": "add",
            "line": "\treturn c.isLocalHost(c.fasthttp.RemoteIP().String())"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      },
      {
        "file": "ctx_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index 4ea1e877..52c62fe5 100644"
          },
          {
            "type": "context",
            "line": "--- a/ctx_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/ctx_test.go"
          },
          {
            "type": "context",
            "line": " \t\"fmt\""
          },
          {
            "type": "context",
            "line": " \t\"io\""
          },
          {
            "type": "context",
            "line": " \t\"mime/multipart\""
          },
          {
            "type": "add",
            "line": "\t\"net\""
          },
          {
            "type": "context",
            "line": " \t\"net/http/httptest\""
          },
          {
            "type": "context",
            "line": " \t\"net/url\""
          },
          {
            "type": "context",
            "line": " \t\"os\""
          },
          {
            "type": "context",
            "line": " \t})"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "// go test -run Test_Ctx_IsFromLocal"
          },
          {
            "type": "delete",
            "line": "func Test_Ctx_IsFromLocal(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "// go test -run Test_Ctx_IsFromLocal_X_Forwarded"
          },
          {
            "type": "add",
            "line": "func Test_Ctx_IsFromLocal_X_Forwarded(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \tt.Parallel()"
          },
          {
            "type": "delete",
            "line": "\t// Test \"0.0.0.0\", \"127.0.0.1\" and \"::1\"."
          },
          {
            "type": "add",
            "line": "\t// Test unset X-Forwarded-For header."
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tapp := New()"
          },
          {
            "type": "context",
            "line": " \t\tc := app.AcquireCtx(&fasthttp.RequestCtx{})"
          },
          {
            "type": "context",
            "line": " \t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "delete",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t\t// fasthttp returns \"0.0.0.0\" as IP as there is no remote address."
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"0.0.0.0\", c.IP())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": "\t// This is a test for \"0.0.0.0\""
          },
          {
            "type": "add",
            "line": "\t// Test when setting X-Forwarded-For header to localhost \"127.0.0.1\""
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tapp := New()"
          },
          {
            "type": "context",
            "line": " \t\tc := app.AcquireCtx(&fasthttp.RequestCtx{})"
          },
          {
            "type": "delete",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"0.0.0.0\")"
          },
          {
            "type": "add",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"127.0.0.1\")"
          },
          {
            "type": "context",
            "line": " \t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "delete",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t// This is a test for \"127.0.0.1\""
          },
          {
            "type": "add",
            "line": "\t// Test when setting X-Forwarded-For header to localhost \"::1\""
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tapp := New()"
          },
          {
            "type": "context",
            "line": " \t\tc := app.AcquireCtx(&fasthttp.RequestCtx{})"
          },
          {
            "type": "delete",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"127.0.0.1\")"
          },
          {
            "type": "add",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"::1\")"
          },
          {
            "type": "context",
            "line": " \t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "delete",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t// This is a test for \"localhost\""
          },
          {
            "type": "add",
            "line": "\t// Test when setting X-Forwarded-For to full localhost IPv6 address \"0:0:0:0:0:0:0:1\""
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tapp := New()"
          },
          {
            "type": "context",
            "line": " \t\tc := app.AcquireCtx(&fasthttp.RequestCtx{})"
          },
          {
            "type": "add",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"0:0:0:0:0:0:0:1\")"
          },
          {
            "type": "context",
            "line": " \t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "delete",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t// This is testing \"::1\", it is the compressed format IPV6 loopback address 0:0:0:0:0:0:0:1."
          },
          {
            "type": "delete",
            "line": "\t// It is the equivalent of the IPV4 address 127.0.0.1."
          },
          {
            "type": "add",
            "line": "\t// Test for a random IP address."
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tapp := New()"
          },
          {
            "type": "context",
            "line": " \t\tc := app.AcquireCtx(&fasthttp.RequestCtx{})"
          },
          {
            "type": "delete",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"::1\")"
          },
          {
            "type": "add",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"93.46.8.90\")"
          },
          {
            "type": "context",
            "line": " \t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "delete",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "// go test -run Test_Ctx_IsFromLocal_RemoteAddr"
          },
          {
            "type": "add",
            "line": "func Test_Ctx_IsFromLocal_RemoteAddr(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tt.Parallel()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tlocalIPv4 := net.Addr(&net.TCPAddr{IP: net.ParseIP(\"127.0.0.1\")})"
          },
          {
            "type": "add",
            "line": "\tlocalIPv6 := net.Addr(&net.TCPAddr{IP: net.ParseIP(\"::1\")})"
          },
          {
            "type": "add",
            "line": "\tlocalIPv6long := net.Addr(&net.TCPAddr{IP: net.ParseIP(\"0:0:0:0:0:0:0:1\")})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tzeroIPv4 := net.Addr(&net.TCPAddr{IP: net.IPv4zero})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tsomeIPv4 := net.Addr(&net.TCPAddr{IP: net.ParseIP(\"93.46.8.90\")})"
          },
          {
            "type": "add",
            "line": "\tsomeIPv6 := net.Addr(&net.TCPAddr{IP: net.ParseIP(\"2001:0db8:85a3:0000:0000:8a2e:0370:7334\")})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t// Test for the case fasthttp remoteAddr is set to \"127.0.0.1\"."
          },
          {
            "type": "context",
            "line": " \t{"
          },
          {
            "type": "context",
            "line": " \t\tapp := New()"
          },
          {
            "type": "delete",
            "line": "\t\tc := app.AcquireCtx(&fasthttp.RequestCtx{})"
          },
          {
            "type": "delete",
            "line": "\t\tc.Request().Header.Set(HeaderXForwardedFor, \"93.46.8.90\")"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx := &fasthttp.RequestCtx{}"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx.SetRemoteAddr(localIPv4)"
          },
          {
            "type": "add",
            "line": "\t\tc := app.AcquireCtx(fastCtx)"
          },
          {
            "type": "add",
            "line": "\t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"127.0.0.1\", c.IP())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t// Test for the case fasthttp remoteAddr is set to \"::1\"."
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tapp := New()"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx := &fasthttp.RequestCtx{}"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx.SetRemoteAddr(localIPv6)"
          },
          {
            "type": "add",
            "line": "\t\tc := app.AcquireCtx(fastCtx)"
          },
          {
            "type": "add",
            "line": "\t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"::1\", c.IP())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t// Test for the case fasthttp remoteAddr is set to \"0:0:0:0:0:0:0:1\"."
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tapp := New()"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx := &fasthttp.RequestCtx{}"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx.SetRemoteAddr(localIPv6long)"
          },
          {
            "type": "add",
            "line": "\t\tc := app.AcquireCtx(fastCtx)"
          },
          {
            "type": "add",
            "line": "\t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "add",
            "line": "\t\t// fasthttp should return \"::1\" for \"0:0:0:0:0:0:0:1\"."
          },
          {
            "type": "add",
            "line": "\t\t// otherwise IsFromLocal() will break."
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"::1\", c.IP())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, true, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t// Test for the case fasthttp remoteAddr is set to \"0.0.0.0\"."
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tapp := New()"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx := &fasthttp.RequestCtx{}"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx.SetRemoteAddr(zeroIPv4)"
          },
          {
            "type": "add",
            "line": "\t\tc := app.AcquireCtx(fastCtx)"
          },
          {
            "type": "add",
            "line": "\t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"0.0.0.0\", c.IP())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t// Test for the case fasthttp remoteAddr is set to \"93.46.8.90\"."
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tapp := New()"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx := &fasthttp.RequestCtx{}"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx.SetRemoteAddr(someIPv4)"
          },
          {
            "type": "add",
            "line": "\t\tc := app.AcquireCtx(fastCtx)"
          },
          {
            "type": "add",
            "line": "\t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"93.46.8.90\", c.IP())"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\t// Test for the case fasthttp remoteAddr is set to \"2001:0db8:85a3:0000:0000:8a2e:0370:7334\"."
          },
          {
            "type": "add",
            "line": "\t{"
          },
          {
            "type": "add",
            "line": "\t\tapp := New()"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx := &fasthttp.RequestCtx{}"
          },
          {
            "type": "add",
            "line": "\t\tfastCtx.SetRemoteAddr(someIPv6)"
          },
          {
            "type": "add",
            "line": "\t\tc := app.AcquireCtx(fastCtx)"
          },
          {
            "type": "context",
            "line": " \t\tdefer app.ReleaseCtx(c)"
          },
          {
            "type": "add",
            "line": "\t\tutils.AssertEqual(t, \"2001:db8:85a3::8a2e:370:7334\", c.IP())"
          },
          {
            "type": "context",
            "line": " \t\tutils.AssertEqual(t, false, c.IsFromLocal())"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "b924696b2e8731f39696584d12cceeb3aeb2d874",
    "files": [
      {
        "file": "src/cryptography/hazmat/primitives/kdf/hkdf.py",
        "changes": [
          {
            "type": "context",
            "line": "index f738bbdc7..82ed9b1c8 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/cryptography/hazmat/primitives/kdf/hkdf.py"
          },
          {
            "type": "context",
            "line": "+++ b/src/cryptography/hazmat/primitives/kdf/hkdf.py"
          },
          {
            "type": "context",
            "line": "         output = [b\"\"]"
          },
          {
            "type": "context",
            "line": "         counter = 1"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        while (self._algorithm.digest_size // 8) * len(output) < self._length:"
          },
          {
            "type": "add",
            "line": "        while self._algorithm.digest_size * (len(output) - 1) < self._length:"
          },
          {
            "type": "context",
            "line": "             h = hmac.HMAC(key_material, self._algorithm, backend=self._backend)"
          },
          {
            "type": "context",
            "line": "             h.update(output[-1])"
          },
          {
            "type": "context",
            "line": "             h.update(self._info)"
          }
        ]
      },
      {
        "file": "tests/hazmat/primitives/test_hkdf.py",
        "changes": [
          {
            "type": "context",
            "line": "index e33529c9d..a05fd752f 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/hazmat/primitives/test_hkdf.py"
          },
          {
            "type": "context",
            "line": "+++ b/tests/hazmat/primitives/test_hkdf.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             hkdf.verify(b\"foo\", u\"bar\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_derive_short_output(self, backend):"
          },
          {
            "type": "add",
            "line": "        hkdf = HKDF("
          },
          {
            "type": "add",
            "line": "            hashes.SHA256(),"
          },
          {
            "type": "add",
            "line": "            4,"
          },
          {
            "type": "add",
            "line": "            salt=None,"
          },
          {
            "type": "add",
            "line": "            info=None,"
          },
          {
            "type": "add",
            "line": "            backend=backend"
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        assert hkdf.derive(b\"\\x01\" * 16) == b\"gJ\\xfb{\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " @pytest.mark.requires_backend_interface(interface=HMACBackend)"
          },
          {
            "type": "context",
            "line": " class TestHKDFExpand(object):"
          }
        ]
      }
    ]
  },
  {
    "commit": "b94a69943992df999d627b21a4ed056fad4569f8",
    "files": [
      {
        "file": "src/community/jdbcconfig/src/main/java/org/geoserver/jdbcloader/DataSourceFactoryBean.java",
        "changes": [
          {
            "type": "context",
            "line": "index c620952072..b153303fe7 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/community/jdbcconfig/src/main/java/org/geoserver/jdbcloader/DataSourceFactoryBean.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/community/jdbcconfig/src/main/java/org/geoserver/jdbcloader/DataSourceFactoryBean.java"
          },
          {
            "type": "context",
            "line": " import java.util.Properties;"
          },
          {
            "type": "context",
            "line": " import java.util.logging.Level;"
          },
          {
            "type": "context",
            "line": " import java.util.logging.Logger;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.Context;"
          },
          {
            "type": "context",
            "line": " import javax.naming.NamingException;"
          },
          {
            "type": "context",
            "line": " import javax.sql.DataSource;"
          },
          {
            "type": "context",
            "line": " import org.apache.commons.dbcp.BasicDataSource;"
          },
          {
            "type": "context",
            "line": "     private static final Logger LOGGER = Logging.getLogger(DataSourceFactoryBean.class);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     JDBCLoaderProperties config;"
          },
          {
            "type": "delete",
            "line": "    Context jndiCtx;"
          },
          {
            "type": "context",
            "line": "     DataSource dataSource;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    private static Context getJNDI(JDBCLoaderProperties config) {"
          },
          {
            "type": "delete",
            "line": "        if (config.isEnabled() && config.getJndiName().isPresent()) {"
          },
          {
            "type": "delete",
            "line": "            try {"
          },
          {
            "type": "delete",
            "line": "                return GeoTools.getInitialContext(GeoTools.getDefaultHints());"
          },
          {
            "type": "delete",
            "line": "            } catch (NamingException ex) {"
          },
          {
            "type": "delete",
            "line": "                LOGGER.log("
          },
          {
            "type": "delete",
            "line": "                        Level.WARNING,"
          },
          {
            "type": "delete",
            "line": "                        \"Could not get JNDI Context, will not use JNDI to locate DataSource\","
          },
          {
            "type": "delete",
            "line": "                        ex);"
          },
          {
            "type": "delete",
            "line": "                return null;"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "        } else {"
          },
          {
            "type": "delete",
            "line": "            // Don't bother trying to get a JNDI context if JNDI lookup isn't needed."
          },
          {
            "type": "delete",
            "line": "            return null;"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public DataSourceFactoryBean(JDBCLoaderProperties config) {"
          },
          {
            "type": "delete",
            "line": "        this(config, getJNDI(config));"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    public DataSourceFactoryBean(JDBCLoaderProperties config, Context jndiCtx) {"
          },
          {
            "type": "context",
            "line": "         this.config = config;"
          },
          {
            "type": "delete",
            "line": "        this.jndiCtx = jndiCtx;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /** Try to lookup a configured DataSource using JNDI. */"
          },
          {
            "type": "context",
            "line": "     protected Optional<DataSource> getJNDIDataSource(Optional<String> name) {"
          },
          {
            "type": "delete",
            "line": "        if (jndiCtx == null) return Optional.absent();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (name.isPresent()) {"
          },
          {
            "type": "context",
            "line": "             try {"
          },
          {
            "type": "delete",
            "line": "                Optional<DataSource> ds = Optional.of((DataSource) jndiCtx.lookup(name.get()));"
          },
          {
            "type": "add",
            "line": "                Optional<DataSource> ds = Optional.of((DataSource) GeoTools.jndiLookup(name.get()));"
          },
          {
            "type": "context",
            "line": "                 if (LOGGER.isLoggable(Level.INFO)) {"
          },
          {
            "type": "context",
            "line": "                     LOGGER.log(Level.INFO, \"JDBCLoader using JNDI DataSource {0}\", name.get());"
          },
          {
            "type": "context",
            "line": "                 }"
          }
        ]
      },
      {
        "file": "src/community/jdbcconfig/src/test/java/org/geoserver/jdbcconfig/internal/DataSourceFactoryBeanTest.java",
        "changes": [
          {
            "type": "context",
            "line": "index 900d0f6cf4..a5a4923f05 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/community/jdbcconfig/src/test/java/org/geoserver/jdbcconfig/internal/DataSourceFactoryBeanTest.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/community/jdbcconfig/src/test/java/org/geoserver/jdbcconfig/internal/DataSourceFactoryBeanTest.java"
          },
          {
            "type": "context",
            "line": " import com.google.common.base.Optional;"
          },
          {
            "type": "context",
            "line": " import java.sql.Connection;"
          },
          {
            "type": "context",
            "line": " import java.sql.DatabaseMetaData;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.Context;"
          },
          {
            "type": "add",
            "line": "import javax.naming.InitialContext;"
          },
          {
            "type": "context",
            "line": " import javax.naming.NamingException;"
          },
          {
            "type": "context",
            "line": " import javax.sql.DataSource;"
          },
          {
            "type": "context",
            "line": " import org.apache.commons.dbcp.BasicDataSource;"
          },
          {
            "type": "context",
            "line": " import org.easymock.EasyMock;"
          },
          {
            "type": "context",
            "line": " import org.geoserver.jdbcloader.DataSourceFactoryBean;"
          },
          {
            "type": "add",
            "line": "import org.geotools.util.factory.GeoTools;"
          },
          {
            "type": "context",
            "line": " import org.junit.Test;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /** @author Kevin Smith, OpenGeo */"
          },
          {
            "type": "context",
            "line": "     public void testBasic() throws Exception {"
          },
          {
            "type": "context",
            "line": "         final BasicDataSource ds = EasyMock.createMock(BasicDataSource.class);"
          },
          {
            "type": "context",
            "line": "         JDBCConfigProperties config = EasyMock.createMock(JDBCConfigProperties.class);"
          },
          {
            "type": "delete",
            "line": "        Context jndi = EasyMock.createMock(Context.class);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         expect(config.isEnabled()).andReturn(true);"
          },
          {
            "type": "context",
            "line": "         expectJndi(config, null);"
          },
          {
            "type": "context",
            "line": "         expectLastCall();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         expectVerifyConnect(ds);"
          },
          {
            "type": "delete",
            "line": "        replay(ds, config, jndi);"
          },
          {
            "type": "add",
            "line": "        replay(ds, config);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         DataSourceFactoryBean fact ="
          },
          {
            "type": "delete",
            "line": "                new DataSourceFactoryBean(config, jndi) {"
          },
          {
            "type": "add",
            "line": "                new DataSourceFactoryBean(config) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     @Override"
          },
          {
            "type": "context",
            "line": "                     protected BasicDataSource createBasicDataSource() {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         // Check that the same DataSource is returned on subsequent calls without any changes"
          },
          {
            "type": "context",
            "line": "         assertThat(fact.getObject(), is((DataSource) ds));"
          },
          {
            "type": "delete",
            "line": "        verify(ds, config, jndi);"
          },
          {
            "type": "add",
            "line": "        verify(ds, config);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         // Check that destruction properly closes the DataSource"
          },
          {
            "type": "context",
            "line": "         reset(ds);"
          },
          {
            "type": "context",
            "line": "     public void testJNDI() throws Exception {"
          },
          {
            "type": "context",
            "line": "         DataSource ds = EasyMock.createMock(DataSource.class);"
          },
          {
            "type": "context",
            "line": "         JDBCConfigProperties config = EasyMock.createMock(JDBCConfigProperties.class);"
          },
          {
            "type": "delete",
            "line": "        Context jndi = EasyMock.createMock(Context.class);"
          },
          {
            "type": "add",
            "line": "        InitialContext jndi = EasyMock.createMock(InitialContext.class);"
          },
          {
            "type": "add",
            "line": "        GeoTools.init(jndi);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         expect(config.isEnabled()).andReturn(true);"
          },
          {
            "type": "context",
            "line": "         expectJndi(config, \"java:comp/env/jdbc/test\");"
          },
          {
            "type": "context",
            "line": "         expectVerifyConnect(ds);"
          },
          {
            "type": "context",
            "line": "         replay(ds, config, jndi);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        DataSourceFactoryBean fact = new DataSourceFactoryBean(config, jndi);"
          },
          {
            "type": "add",
            "line": "        DataSourceFactoryBean fact = new DataSourceFactoryBean(config);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         // Check that we get the DataSource"
          },
          {
            "type": "context",
            "line": "         assertThat(fact.getObject(), is((DataSource) ds));"
          },
          {
            "type": "context",
            "line": "     public void testJNDIFail() throws Exception {"
          },
          {
            "type": "context",
            "line": "         final BasicDataSource ds = EasyMock.createMock(BasicDataSource.class);"
          },
          {
            "type": "context",
            "line": "         JDBCConfigProperties config = EasyMock.createMock(JDBCConfigProperties.class);"
          },
          {
            "type": "delete",
            "line": "        Context jndi = EasyMock.createMock(Context.class);"
          },
          {
            "type": "add",
            "line": "        InitialContext jndi = EasyMock.createMock(InitialContext.class);"
          },
          {
            "type": "add",
            "line": "        GeoTools.init(jndi);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         expect(config.isEnabled()).andReturn(true);"
          },
          {
            "type": "context",
            "line": "         expectJndi(config, \"java:comp/env/jdbc/test\");"
          },
          {
            "type": "context",
            "line": "         replay(ds, config, jndi);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         DataSourceFactoryBean fact ="
          },
          {
            "type": "delete",
            "line": "                new DataSourceFactoryBean(config, jndi) {"
          },
          {
            "type": "add",
            "line": "                new DataSourceFactoryBean(config) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                     @Override"
          },
          {
            "type": "context",
            "line": "                     protected BasicDataSource createBasicDataSource() {"
          }
        ]
      },
      {
        "file": "src/community/taskmanager/core/src/main/java/org/geoserver/taskmanager/external/impl/PostgisJndiDbSourceImpl.java",
        "changes": [
          {
            "type": "context",
            "line": "index e1dfee7c3a..fa6486347d 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/community/taskmanager/core/src/main/java/org/geoserver/taskmanager/external/impl/PostgisJndiDbSourceImpl.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/community/taskmanager/core/src/main/java/org/geoserver/taskmanager/external/impl/PostgisJndiDbSourceImpl.java"
          },
          {
            "type": "context",
            "line": " import java.sql.SQLException;"
          },
          {
            "type": "context",
            "line": " import java.util.HashMap;"
          },
          {
            "type": "context",
            "line": " import java.util.Map;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.Context;"
          },
          {
            "type": "context",
            "line": " import javax.naming.NamingException;"
          },
          {
            "type": "context",
            "line": " import javax.sql.DataSource;"
          },
          {
            "type": "context",
            "line": " import org.geoserver.taskmanager.external.DbSource;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     @Override"
          },
          {
            "type": "context",
            "line": "     public DataSource getDataSource() throws SQLException {"
          },
          {
            "type": "delete",
            "line": "        Context ctx = null;"
          },
          {
            "type": "context",
            "line": "         DataSource ds = null;"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        try {"
          },
          {
            "type": "delete",
            "line": "            ctx = GeoTools.getInitialContext(GeoTools.getDefaultHints());"
          },
          {
            "type": "delete",
            "line": "        } catch (NamingException e) {"
          },
          {
            "type": "delete",
            "line": "            throw new IllegalStateException(e);"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         try {"
          },
          {
            "type": "delete",
            "line": "            ds = (DataSource) ctx.lookup(jndiName);"
          },
          {
            "type": "add",
            "line": "            ds = (DataSource) GeoTools.jndiLookup(jndiName);"
          },
          {
            "type": "context",
            "line": "         } catch (NamingException e) {"
          },
          {
            "type": "context",
            "line": "             throw new SQLException(e);"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      },
      {
        "file": "src/security/jdbc/src/main/java/org/geoserver/security/jdbc/AbstractJDBCService.java",
        "changes": [
          {
            "type": "context",
            "line": "index e2dd23ac92..e5f870dafb 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/security/jdbc/src/main/java/org/geoserver/security/jdbc/AbstractJDBCService.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/security/jdbc/src/main/java/org/geoserver/security/jdbc/AbstractJDBCService.java"
          },
          {
            "type": "context",
            "line": " import java.util.Properties;"
          },
          {
            "type": "context",
            "line": " import java.util.StringTokenizer;"
          },
          {
            "type": "context",
            "line": " import java.util.logging.Logger;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.Context;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.InitialContext;"
          },
          {
            "type": "context",
            "line": " import javax.naming.NamingException;"
          },
          {
            "type": "context",
            "line": " import javax.sql.DataSource;"
          },
          {
            "type": "context",
            "line": " import org.apache.commons.dbcp.BasicDataSource;"
          },
          {
            "type": "context",
            "line": " import org.geoserver.security.impl.AbstractGeoServerSecurityService;"
          },
          {
            "type": "context",
            "line": " import org.geoserver.security.jdbc.config.JDBCSecurityServiceConfig;"
          },
          {
            "type": "context",
            "line": " import org.geoserver.util.IOUtils;"
          },
          {
            "type": "add",
            "line": "import org.geotools.util.factory.GeoTools;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": "  * JDBC base implementation for common used methods"
          },
          {
            "type": "context",
            "line": "         if (config.isJndi()) {"
          },
          {
            "type": "context",
            "line": "             String jndiName = config.getJndiName();"
          },
          {
            "type": "context",
            "line": "             try {"
          },
          {
            "type": "delete",
            "line": "                Context initialContext = new InitialContext();"
          },
          {
            "type": "delete",
            "line": "                datasource = (DataSource) initialContext.lookup(jndiName);"
          },
          {
            "type": "add",
            "line": "                datasource = (DataSource) GeoTools.jndiLookup(jndiName);"
          },
          {
            "type": "context",
            "line": "             } catch (NamingException e) {"
          },
          {
            "type": "context",
            "line": "                 throw new IOException(e);"
          },
          {
            "type": "context",
            "line": "             }"
          }
        ]
      },
      {
        "file": "src/wesecurity/jdbc/src/main/java/org/geoserver/security/wejdbc/JDBCConnectionPanel.java",
        "changes": [
          {
            "type": "context",
            "line": "index 3836dcd53c..0bbb16f08f 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/web/security/jdbc/src/main/java/org/geoserver/security/web/jdbc/JDBCConnectionPanel.java"
          },
          {
            "type": "context",
            "line": "+++ b/src/web/security/jdbc/src/main/java/org/geoserver/security/web/jdbc/JDBCConnectionPanel.java"
          },
          {
            "type": "context",
            "line": " import java.sql.DriverManager;"
          },
          {
            "type": "context",
            "line": " import java.util.logging.Level;"
          },
          {
            "type": "context",
            "line": " import java.util.logging.Logger;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.Context;"
          },
          {
            "type": "delete",
            "line": "import javax.naming.InitialContext;"
          },
          {
            "type": "context",
            "line": " import javax.sql.DataSource;"
          },
          {
            "type": "context",
            "line": " import org.apache.wicket.ajax.AjaxRequestTarget;"
          },
          {
            "type": "context",
            "line": " import org.apache.wicket.ajax.markup.html.form.AjaxCheckBox;"
          },
          {
            "type": "context",
            "line": " import org.apache.wicket.model.Model;"
          },
          {
            "type": "context",
            "line": " import org.apache.wicket.model.StringResourceModel;"
          },
          {
            "type": "context",
            "line": " import org.geoserver.security.jdbc.config.JDBCSecurityServiceConfig;"
          },
          {
            "type": "add",
            "line": "import org.geotools.util.factory.GeoTools;"
          },
          {
            "type": "context",
            "line": " import org.geotools.util.logging.Logging;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " /**"
          },
          {
            "type": "context",
            "line": "             // models"
          },
          {
            "type": "context",
            "line": "             ((FormComponent) get(\"jndiName\")).processInput();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            Context initialContext = new InitialContext();"
          },
          {
            "type": "delete",
            "line": "            try {"
          },
          {
            "type": "delete",
            "line": "                DataSource datasource ="
          },
          {
            "type": "delete",
            "line": "                        (DataSource)"
          },
          {
            "type": "delete",
            "line": "                                initialContext.lookup("
          },
          {
            "type": "delete",
            "line": "                                        get(\"jndiName\").getDefaultModelObjectAsString());"
          },
          {
            "type": "delete",
            "line": "                try (Connection con = datasource.getConnection()) {}"
          },
          {
            "type": "delete",
            "line": "            } finally {"
          },
          {
            "type": "delete",
            "line": "                initialContext.close();"
          },
          {
            "type": "add",
            "line": "            Object lookedUp = GeoTools.jndiLookup(get(\"jndiName\").getDefaultModelObjectAsString());"
          },
          {
            "type": "add",
            "line": "            if (lookedUp == null)"
          },
          {
            "type": "add",
            "line": "                throw new IllegalArgumentException("
          },
          {
            "type": "add",
            "line": "                        \"Failed to look up an object from JNDI at the given location\");"
          },
          {
            "type": "add",
            "line": "            if (!(lookedUp instanceof DataSource)) {"
          },
          {
            "type": "add",
            "line": "                LOGGER.log("
          },
          {
            "type": "add",
            "line": "                        Level.WARNING,"
          },
          {
            "type": "add",
            "line": "                        \"Was trying to look up a DataSource in JNDI, but got this instead: \""
          },
          {
            "type": "add",
            "line": "                                + lookedUp);"
          },
          {
            "type": "add",
            "line": "                throw new IllegalArgumentException(\"JNDI lookup did not provide a DataSource\");"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "add",
            "line": "            try (Connection con = ((DataSource) lookedUp).getConnection()) {}"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": " }"
          }
        ]
      }
    ]
  },
  {
    "commit": "bafafa8bb1b571b61d7a9528da8d40c307dade3d",
    "files": [
      {
        "file": "pkg/chartutil/jsonschema.go",
        "changes": [
          {
            "type": "context",
            "line": "index 753dc98c1..7b9768fd3 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chartutil/jsonschema.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chartutil/jsonschema.go"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " // ValidateAgainstSingleSchema checks that values does not violate the structure laid out in this schema"
          },
          {
            "type": "delete",
            "line": "func ValidateAgainstSingleSchema(values Values, schemaJSON []byte) error {"
          },
          {
            "type": "add",
            "line": "func ValidateAgainstSingleSchema(values Values, schemaJSON []byte) (reterr error) {"
          },
          {
            "type": "add",
            "line": "\tdefer func() {"
          },
          {
            "type": "add",
            "line": "\t\tif r := recover(); r != nil {"
          },
          {
            "type": "add",
            "line": "\t\t\treterr = fmt.Errorf(\"unable to validate schema: %s\", r)"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}()"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tvaluesData, err := yaml.Marshal(values)"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          },
          {
            "type": "context",
            "line": " \t\treturn err"
          }
        ]
      },
      {
        "file": "pkg/chartutil/jsonschema_test.go",
        "changes": [
          {
            "type": "context",
            "line": "index a0acd5a7f..d71668ac8 100644"
          },
          {
            "type": "context",
            "line": "--- a/pkg/chartutil/jsonschema_test.go"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chartutil/jsonschema_test.go"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "func TestValidateAgainstInvalidSingleSchema(t *testing.T) {"
          },
          {
            "type": "add",
            "line": "\tvalues, err := ReadValuesFile(\"./testdata/test-values.yaml\")"
          },
          {
            "type": "add",
            "line": "\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"Error reading YAML file: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "\tschema, err := ioutil.ReadFile(\"./testdata/test-values-invalid.schema.json\")"
          },
          {
            "type": "add",
            "line": "\tif err != nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"Error reading YAML file: %s\", err)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tvar errString string"
          },
          {
            "type": "add",
            "line": "\tif err := ValidateAgainstSingleSchema(values, schema); err == nil {"
          },
          {
            "type": "add",
            "line": "\t\tt.Fatalf(\"Expected an error, but got nil\")"
          },
          {
            "type": "add",
            "line": "\t} else {"
          },
          {
            "type": "add",
            "line": "\t\terrString = err.Error()"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\texpectedErrString := \"unable to validate schema: runtime error: invalid \" +"
          },
          {
            "type": "add",
            "line": "\t\t\"memory address or nil pointer dereference\""
          },
          {
            "type": "add",
            "line": "\tif errString != expectedErrString {"
          },
          {
            "type": "add",
            "line": "\t\tt.Errorf(\"Error string :\\n`%s`\\ndoes not match expected\\n`%s`\", errString, expectedErrString)"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " func TestValidateAgainstSingleSchemaNegative(t *testing.T) {"
          },
          {
            "type": "context",
            "line": " \tvalues, err := ReadValuesFile(\"./testdata/test-values-negative.yaml\")"
          },
          {
            "type": "context",
            "line": " \tif err != nil {"
          }
        ]
      },
      {
        "file": "pkg/chartutil/testdata/test-values-invalid.schema.json",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..35a16a2c4"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/pkg/chartutil/testdata/test-values-invalid.schema.json"
          },
          {
            "type": "add",
            "line": "   1E1111111"
          }
        ]
      }
    ]
  },
  {
    "commit": "c947975a4f1ff7bbfd7d5cd24a2e16bf12bd96d4",
    "files": [
      {
        "file": "plugins/docman/include/Docman_Widget_MyDocmanSearch.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index 047e49bd442..bfb020ab3a2 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/docman/include/Docman_Widget_MyDocmanSearch.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/docman/include/Docman_Widget_MyDocmanSearch.class.php"
          },
          {
            "type": "context",
            "line": "                 $itemPerm = $dPm->userCanAccess($user, $docman_id);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 if ($itemPerm) {"
          },
          {
            "type": "delete",
            "line": "                    $html .= '<p><a data-test=\"document-search-link\" href=\"/plugins/docman/?group_id=' . $res['group_id'] . '&action=details&id=' . $docman_id . '&section=properties\">Show &quot;' . $res['title'] . '&quot; Properties</a></p>';"
          },
          {
            "type": "add",
            "line": "                    $purifier = Codendi_HTMLPurifier::instance();"
          },
          {
            "type": "add",
            "line": "                    $html    .= '<p><a data-test=\"document-search-link\" href=\"/plugins/docman/?group_id=' . urlencode((string) $res['group_id']) . '&action=details&id=' . urlencode((string) $docman_id) . '&section=properties\">Show &quot;';"
          },
          {
            "type": "add",
            "line": "                    $html    .=  $purifier->purify($res['title']);"
          },
          {
            "type": "add",
            "line": "                    $html    .= '&quot; Properties</a></p>';"
          },
          {
            "type": "context",
            "line": "                     return $html;"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "             }"
          }
        ]
      },
      {
        "file": "plugins/docman/include/view/Docman_View_Admin_LockInfos.class.php",
        "changes": [
          {
            "type": "context",
            "line": "index a9a4cfbb95e..e2374cb13d1 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/docman/include/view/Docman_View_Admin_LockInfos.class.php"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/docman/include/view/Docman_View_Admin_LockInfos.class.php"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 $parent   = $dIF->getItemFromDb($item->getParentId());"
          },
          {
            "type": "context",
            "line": "                 $content .= '<tr>';"
          },
          {
            "type": "delete",
            "line": "                $content .= '<td>' . '<a href=\"/plugins/docman/?group_id=' . $params['group_id'] . '&action=details&id=' . $item->getId() . '\">' . $item->getTitle() . '</a></td>';"
          },
          {
            "type": "add",
            "line": "                $content .= '<td>' . '<a href=\"/plugins/docman/?group_id=' . urlencode((string) $params['group_id']) . '&action=details&id=' . urlencode((string) $item->getId()) . '\">';"
          },
          {
            "type": "add",
            "line": "                $content .= $hp->purify($item->getTitle());"
          },
          {
            "type": "add",
            "line": "                $content .= '</a></td>';"
          },
          {
            "type": "context",
            "line": "                 $content .= '<td>';"
          },
          {
            "type": "context",
            "line": "                 if ($parent === null || $dIF->isRoot($parent)) {"
          },
          {
            "type": "context",
            "line": "                     $content .= '</td>';"
          },
          {
            "type": "context",
            "line": "                 } else {"
          },
          {
            "type": "delete",
            "line": "                    $content .=  '<a href=\"' . $this->defaultUrl . '&action=show&id=' . $parent->getId() . '\">' . $parent->getTitle() . '</a></td>';"
          },
          {
            "type": "add",
            "line": "                    $content .=  '<a href=\"' . $this->defaultUrl . '&action=show&id=' . urlencode((string) $parent->getId()) . '\">';"
          },
          {
            "type": "add",
            "line": "                    $content .= $hp->purify($parent->getTitle());"
          },
          {
            "type": "add",
            "line": "                    $content .= '</a></td>';"
          },
          {
            "type": "context",
            "line": "                 }"
          },
          {
            "type": "context",
            "line": "                 $content .= '<td>' . $hp->purify($uH->getDisplayNameFromUserId($row['user_id'])) . '</td>';"
          },
          {
            "type": "context",
            "line": "                 $content .= '<td>' . format_date($GLOBALS['Language']->getText('system', 'datefmt'), $row['lock_date']) . '</td>';"
          }
        ]
      }
    ]
  },
  {
    "commit": "ca5e2f8d505fd3bfac6f7c85b82f2740becbc0aa",
    "files": [
      {
        "file": "CHANGELOG.md",
        "changes": [
          {
            "type": "context",
            "line": "index bc6a92fc8..b19cfe345 100644"
          },
          {
            "type": "context",
            "line": "--- a/CHANGELOG.md"
          },
          {
            "type": "context",
            "line": "+++ b/CHANGELOG.md"
          },
          {
            "type": "add",
            "line": "### [1.10.23] 2021-10-05"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  * Security: Fixed command injection vulnerability on Windows (GHSA-frqg-7g38-6gcf / CVE-2021-41116)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " ### [1.10.22] 2021-04-27"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   * Security: Fixed command injection vulnerability in HgDriver/HgDownloader and hardened other VCS drivers and downloaders (GHSA-h5h8-pc6h-jvvx / CVE-2021-29472)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   * Initial release"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "[1.10.23]: https://github.com/composer/composer/compare/1.10.22...1.10.23"
          },
          {
            "type": "context",
            "line": " [1.10.22]: https://github.com/composer/composer/compare/1.10.21...1.10.22"
          },
          {
            "type": "context",
            "line": " [1.10.21]: https://github.com/composer/composer/compare/1.10.20...1.10.21"
          },
          {
            "type": "context",
            "line": " [1.10.20]: https://github.com/composer/composer/compare/1.10.19...1.10.20"
          }
        ]
      },
      {
        "file": "src/Composer/Command/HomeCommand.php",
        "changes": [
          {
            "type": "context",
            "line": "index b7d907066..c22128d46 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Composer/Command/HomeCommand.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/Composer/Command/HomeCommand.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $process = new ProcessExecutor($this->getIO());"
          },
          {
            "type": "context",
            "line": "         if (Platform::isWindows()) {"
          },
          {
            "type": "delete",
            "line": "            return $process->execute('start \"web\" explorer \"' . $url . '\"', $output);"
          },
          {
            "type": "add",
            "line": "            return $process->execute('start \"web\" explorer ' . $url, $output);"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $linux = $process->execute('which xdg-open', $output);"
          }
        ]
      },
      {
        "file": "src/Composer/Util/ProcessExecutor.php",
        "changes": [
          {
            "type": "context",
            "line": "index 658c2a136..7cb83e39b 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Composer/Util/ProcessExecutor.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/Composer/Util/ProcessExecutor.php"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          },
          {
            "type": "delete",
            "line": "     * Copy of ProcessUtils::escapeArgument() that is deprecated in Symfony 3.3 and removed in Symfony 4."
          },
          {
            "type": "add",
            "line": "     * Copy of Symfony's Process::escapeArgument() which is private"
          },
          {
            "type": "context",
            "line": "      *"
          },
          {
            "type": "context",
            "line": "      * @param string $argument"
          },
          {
            "type": "context",
            "line": "      *"
          },
          {
            "type": "context",
            "line": "      */"
          },
          {
            "type": "context",
            "line": "     private static function escapeArgument($argument)"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        //Fix for PHP bug #43784 escapeshellarg removes % from given string"
          },
          {
            "type": "delete",
            "line": "        //Fix for PHP bug #49446 escapeshellarg doesn't work on Windows"
          },
          {
            "type": "delete",
            "line": "        //@see https://bugs.php.net/bug.php?id=43784"
          },
          {
            "type": "delete",
            "line": "        //@see https://bugs.php.net/bug.php?id=49446"
          },
          {
            "type": "delete",
            "line": "        if ('\\\\' === DIRECTORY_SEPARATOR) {"
          },
          {
            "type": "delete",
            "line": "            if ((string) $argument === '') {"
          },
          {
            "type": "delete",
            "line": "                return escapeshellarg($argument);"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            $escapedArgument = '';"
          },
          {
            "type": "delete",
            "line": "            $quote = false;"
          },
          {
            "type": "delete",
            "line": "            foreach (preg_split('/(\")/', $argument, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE) as $part) {"
          },
          {
            "type": "delete",
            "line": "                if ('\"' === $part) {"
          },
          {
            "type": "delete",
            "line": "                    $escapedArgument .= '\\\\\"';"
          },
          {
            "type": "delete",
            "line": "                } elseif (self::isSurroundedBy($part, '%')) {"
          },
          {
            "type": "delete",
            "line": "                    // Avoid environment variable expansion"
          },
          {
            "type": "delete",
            "line": "                    $escapedArgument .= '^%\"'.substr($part, 1, -1).'\"^%';"
          },
          {
            "type": "delete",
            "line": "                } else {"
          },
          {
            "type": "delete",
            "line": "                    // escape trailing backslash"
          },
          {
            "type": "delete",
            "line": "                    if ('\\\\' === substr($part, -1)) {"
          },
          {
            "type": "delete",
            "line": "                        $part .= '\\\\';"
          },
          {
            "type": "delete",
            "line": "                    }"
          },
          {
            "type": "delete",
            "line": "                    $quote = true;"
          },
          {
            "type": "delete",
            "line": "                    $escapedArgument .= $part;"
          },
          {
            "type": "delete",
            "line": "                }"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "            if ($quote) {"
          },
          {
            "type": "delete",
            "line": "                $escapedArgument = '\"'.$escapedArgument.'\"';"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            return $escapedArgument;"
          },
          {
            "type": "add",
            "line": "        if ('' === $argument || null === $argument) {"
          },
          {
            "type": "add",
            "line": "            return '\"\"';"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        if ('\\\\' !== \\DIRECTORY_SEPARATOR) {"
          },
          {
            "type": "add",
            "line": "            return \"'\".str_replace(\"'\", \"'\\\\''\", $argument).\"'\";"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        if (false !== strpos($argument, \"\\0\")) {"
          },
          {
            "type": "add",
            "line": "            $argument = str_replace(\"\\0\", '?', $argument);"
          },
          {
            "type": "add",
            "line": "        }"
          },
          {
            "type": "add",
            "line": "        if (!preg_match('/[\\/()%!^\"<>&|\\s]/', $argument)) {"
          },
          {
            "type": "add",
            "line": "            return $argument;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "add",
            "line": "        $argument = preg_replace('/(\\\\\\\\+)$/', '$1$1', $argument);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return \"'\".str_replace(\"'\", \"'\\\\''\", $argument).\"'\";"
          },
          {
            "type": "add",
            "line": "        return '\"'.str_replace(array('\"', '^', '%', '!', \"\\n\"), array('\"\"', '\"^^\"', '\"^%\"', '\"^!\"', '!LF!'), $argument).'\"';"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private static function isSurroundedBy($arg, $char)"
          }
        ]
      },
      {
        "file": "tests/Composer/Test/Downloader/GitDownloaderTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index cd446a73b..3bc9686c5 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/Composer/Test/Downloader/GitDownloaderTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/Composer/Test/Downloader/GitDownloaderTest.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     public function testUpdateDoesntThrowsRuntimeExceptionIfGitCommandFailsAtFirstButIsAbleToRecover()"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "delete",
            "line": "        $expectedFirstGitUpdateCommand = $this->winCompat(\"(git remote set-url composer -- '' && git rev-parse --quiet --verify 'ref^{commit}' || (git fetch composer && git fetch --tags composer)) && git remote set-url composer -- ''\");"
          },
          {
            "type": "add",
            "line": "        $expectedFirstGitUpdateCommand = $this->winCompat(\"(git remote set-url composer -- \\\"\\\" && git rev-parse --quiet --verify 'ref^{commit}' || (git fetch composer && git fetch --tags composer)) && git remote set-url composer -- \\\"\\\"\");"
          },
          {
            "type": "context",
            "line": "         $expectedSecondGitUpdateCommand = $this->winCompat(\"(git remote set-url composer -- 'https://github.com/composer/composer' && git rev-parse --quiet --verify 'ref^{commit}' || (git fetch composer && git fetch --tags composer)) && git remote set-url composer -- 'https://github.com/composer/composer'\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $packageMock = $this->getMockBuilder('Composer\\Package\\PackageInterface')->getMock();"
          }
        ]
      },
      {
        "file": "tests/Composer/Test/Util/SvnTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index ada3818ae..8e1db31ec 100644"
          },
          {
            "type": "context",
            "line": "--- a/tests/Composer/Test/Util/SvnTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/tests/Composer/Test/Util/SvnTest.php"
          },
          {
            "type": "context",
            "line": "         return array("
          },
          {
            "type": "context",
            "line": "             array('http://till:test@svn.example.org/', $this->getCmd(\" --username 'till' --password 'test' \")),"
          },
          {
            "type": "context",
            "line": "             array('http://svn.apache.org/', ''),"
          },
          {
            "type": "delete",
            "line": "            array('svn://johndoe@example.org', $this->getCmd(\" --username 'johndoe' --password '' \")),"
          },
          {
            "type": "add",
            "line": "            array('svn://johndoe@example.org', $this->getCmd(\" --username 'johndoe' --password \\\"\\\" \")),"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "     }"
          }
        ]
      }
    ]
  },
  {
    "commit": "cadfce295f8a33828fc635c2e5ea28b883e5c992",
    "files": [
      {
        "file": "libs/langchain/langchain/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index f91528d3d1..b6c32407e4 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/__init__.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " __all__ = ["
          },
          {
            "type": "context",
            "line": "     \"LLMChain\","
          },
          {
            "type": "delete",
            "line": "    \"LLMBashChain\","
          },
          {
            "type": "context",
            "line": "     \"LLMCheckerChain\","
          },
          {
            "type": "context",
            "line": "     \"LLMMathChain\","
          },
          {
            "type": "context",
            "line": "     \"ArxivAPIWrapper\","
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/_api/path.py",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..f75848ff59"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/_api/path.py"
          },
          {
            "type": "add",
            "line": "import os"
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Optional, Union"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "HERE = Path(__file__).parent"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# Get directory of langchain package"
          },
          {
            "type": "add",
            "line": "PACKAGE_DIR = HERE.parent"
          },
          {
            "type": "add",
            "line": "SEPARATOR = os.sep"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def get_relative_path("
          },
          {
            "type": "add",
            "line": "    file: Union[Path, str], *, relative_to: Path = PACKAGE_DIR"
          },
          {
            "type": "add",
            "line": ") -> str:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get the path of the file as a relative path to the package directory.\"\"\""
          },
          {
            "type": "add",
            "line": "    if isinstance(file, str):"
          },
          {
            "type": "add",
            "line": "        file = Path(file)"
          },
          {
            "type": "add",
            "line": "    return str(file.relative_to(relative_to))"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def as_import_path("
          },
          {
            "type": "add",
            "line": "    file: Union[Path, str],"
          },
          {
            "type": "add",
            "line": "    *,"
          },
          {
            "type": "add",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "add",
            "line": "    relative_to: Path = PACKAGE_DIR"
          },
          {
            "type": "add",
            "line": ") -> str:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Path of the file as a LangChain import exclude langchain top namespace.\"\"\""
          },
          {
            "type": "add",
            "line": "    if isinstance(file, str):"
          },
          {
            "type": "add",
            "line": "        file = Path(file)"
          },
          {
            "type": "add",
            "line": "    path = get_relative_path(file, relative_to=relative_to)"
          },
          {
            "type": "add",
            "line": "    if file.is_file():"
          },
          {
            "type": "add",
            "line": "        path = path[: -len(file.suffix)]"
          },
          {
            "type": "add",
            "line": "    import_path = path.replace(SEPARATOR, \".\")"
          },
          {
            "type": "add",
            "line": "    if suffix:"
          },
          {
            "type": "add",
            "line": "        import_path += \".\" + suffix"
          },
          {
            "type": "add",
            "line": "    return import_path"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index 76754c7075..44094bc978 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/__init__.py"
          },
          {
            "type": "context",
            "line": "     AgentAction, AgentFinish"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \"\"\"  # noqa: E501"
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent import ("
          },
          {
            "type": "context",
            "line": "     Agent,"
          },
          {
            "type": "context",
            "line": "     AgentExecutor,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_iterator import AgentExecutorIterator"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits import ("
          },
          {
            "type": "delete",
            "line": "    create_csv_agent,"
          },
          {
            "type": "context",
            "line": "     create_json_agent,"
          },
          {
            "type": "context",
            "line": "     create_openapi_agent,"
          },
          {
            "type": "delete",
            "line": "    create_pandas_dataframe_agent,"
          },
          {
            "type": "context",
            "line": "     create_pbi_agent,"
          },
          {
            "type": "context",
            "line": "     create_pbi_chat_agent,"
          },
          {
            "type": "delete",
            "line": "    create_spark_dataframe_agent,"
          },
          {
            "type": "context",
            "line": "     create_spark_sql_agent,"
          },
          {
            "type": "context",
            "line": "     create_sql_agent,"
          },
          {
            "type": "context",
            "line": "     create_vectorstore_agent,"
          },
          {
            "type": "context",
            "line": "     create_vectorstore_router_agent,"
          },
          {
            "type": "delete",
            "line": "    create_xorbits_agent,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_types import AgentType"
          },
          {
            "type": "context",
            "line": " from langchain.agents.conversational.base import ConversationalAgent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.tools import Tool, tool"
          },
          {
            "type": "context",
            "line": " from langchain.agents.xml.base import XMLAgent"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "DEPRECATED_CODE = ["
          },
          {
            "type": "add",
            "line": "    \"create_csv_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_pandas_dataframe_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_spark_dataframe_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_xorbits_agent\","
          },
          {
            "type": "add",
            "line": "]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": "    if name in DEPRECATED_CODE:"
          },
          {
            "type": "add",
            "line": "        relative_path = as_import_path(Path(__file__).parent, suffix=name)"
          },
          {
            "type": "add",
            "line": "        old_path = \"langchain.\" + relative_path"
          },
          {
            "type": "add",
            "line": "        new_path = \"langchain_experimental.\" + relative_path"
          },
          {
            "type": "add",
            "line": "        raise ImportError("
          },
          {
            "type": "add",
            "line": "            f\"{name} has been moved to langchain experimental. \""
          },
          {
            "type": "add",
            "line": "            \"See https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "            \"for more information.\\n\""
          },
          {
            "type": "add",
            "line": "            f\"Please update your import statement from: `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "    raise ImportError(f\"{name} does not exist\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " __all__ = ["
          },
          {
            "type": "context",
            "line": "     \"Agent\","
          },
          {
            "type": "context",
            "line": "     \"AgentExecutor\","
          },
          {
            "type": "context",
            "line": "     \"StructuredChatAgent\","
          },
          {
            "type": "context",
            "line": "     \"Tool\","
          },
          {
            "type": "context",
            "line": "     \"ZeroShotAgent\","
          },
          {
            "type": "delete",
            "line": "    \"create_csv_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_json_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_openapi_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_pandas_dataframe_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_pbi_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_pbi_chat_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_spark_dataframe_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_spark_sql_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_sql_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_vectorstore_agent\","
          },
          {
            "type": "context",
            "line": "     \"load_huggingface_tool\","
          },
          {
            "type": "context",
            "line": "     \"load_tools\","
          },
          {
            "type": "context",
            "line": "     \"tool\","
          },
          {
            "type": "delete",
            "line": "    \"create_xorbits_agent\","
          },
          {
            "type": "context",
            "line": "     \"XMLAgent\","
          },
          {
            "type": "context",
            "line": " ]"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index b2e97b6f01..154ff2e2bc 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/agent_toolkits/__init__.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " See [Security](https://python.langchain.com/docs/security) for more information."
          },
          {
            "type": "context",
            "line": " \"\"\""
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.ainetwork.toolkit import AINetworkToolkit"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.amadeus.toolkit import AmadeusToolkit"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.azure_cognitive_services import ("
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.conversational_retrieval.openai_functions import ("
          },
          {
            "type": "context",
            "line": "     create_conversational_retrieval_agent,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.csv.base import create_csv_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.file_management.toolkit import ("
          },
          {
            "type": "context",
            "line": "     FileManagementToolkit,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.office365.toolkit import O365Toolkit"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.openapi.base import create_openapi_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.openapi.toolkit import OpenAPIToolkit"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.pandas.base import create_pandas_dataframe_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.playwright.toolkit import PlayWrightBrowserToolkit"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.powerbi.base import create_pbi_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.powerbi.chat_base import create_pbi_chat_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.powerbi.toolkit import PowerBIToolkit"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.python.base import create_python_agent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.spark.base import create_spark_dataframe_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.spark_sql.base import create_spark_sql_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.spark_sql.toolkit import SparkSQLToolkit"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.sql.base import create_sql_agent"
          },
          {
            "type": "context",
            "line": "     VectorStoreRouterToolkit,"
          },
          {
            "type": "context",
            "line": "     VectorStoreToolkit,"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.xorbits.base import create_xorbits_agent"
          },
          {
            "type": "context",
            "line": " from langchain.agents.agent_toolkits.zapier.toolkit import ZapierToolkit"
          },
          {
            "type": "context",
            "line": " from langchain.tools.retriever import create_retriever_tool"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "DEPRECATED_AGENTS = ["
          },
          {
            "type": "add",
            "line": "    \"create_csv_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_pandas_dataframe_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_xorbits_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_python_agent\","
          },
          {
            "type": "add",
            "line": "    \"create_spark_dataframe_agent\","
          },
          {
            "type": "add",
            "line": "]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": "    if name in DEPRECATED_AGENTS:"
          },
          {
            "type": "add",
            "line": "        relative_path = as_import_path(Path(__file__).parent, suffix=name)"
          },
          {
            "type": "add",
            "line": "        old_path = \"langchain.\" + relative_path"
          },
          {
            "type": "add",
            "line": "        new_path = \"langchain_experimental.\" + relative_path"
          },
          {
            "type": "add",
            "line": "        raise ImportError("
          },
          {
            "type": "add",
            "line": "            f\"{name} has been moved to langchain experimental. \""
          },
          {
            "type": "add",
            "line": "            \"See https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "            \"for more information.\\n\""
          },
          {
            "type": "add",
            "line": "            f\"Please update your import statement from: `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "        )"
          },
          {
            "type": "add",
            "line": "    raise ImportError(f\"{name} does not exist\")"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " __all__ = ["
          },
          {
            "type": "context",
            "line": "     \"AINetworkToolkit\","
          },
          {
            "type": "context",
            "line": "     \"AmadeusToolkit\","
          },
          {
            "type": "context",
            "line": "     \"VectorStoreRouterToolkit\","
          },
          {
            "type": "context",
            "line": "     \"VectorStoreToolkit\","
          },
          {
            "type": "context",
            "line": "     \"ZapierToolkit\","
          },
          {
            "type": "delete",
            "line": "    \"create_csv_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_json_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_openapi_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_pandas_dataframe_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_pbi_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_pbi_chat_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_python_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_spark_dataframe_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_spark_sql_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_sql_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_vectorstore_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_vectorstore_router_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_xorbits_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_conversational_retrieval_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_retriever_tool\","
          },
          {
            "type": "context",
            "line": " ]"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/csv/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index 3e3a1e069d..e01dffb979 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/csv/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/agent_toolkits/csv/__init__.py"
          },
          {
            "type": "delete",
            "line": "\"\"\"CSV toolkit.\"\"\""
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    here = as_import_path(Path(__file__).parent)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    old_path = \"langchain.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    new_path = \"langchain_experimental.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This agent has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This agent relies on python REPL tool under the hood, so to use it \""
          },
          {
            "type": "add",
            "line": "        \"safely please sandbox the python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"and https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        f\"update your import statement from:\\n `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/csv/base.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index f16b8772fd..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/csv/base.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "from io import IOBase"
          },
          {
            "type": "delete",
            "line": "from typing import Any, List, Optional, Union"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.pandas.base import create_pandas_dataframe_agent"
          },
          {
            "type": "delete",
            "line": "from langchain.schema.language_model import BaseLanguageModel"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def create_csv_agent("
          },
          {
            "type": "delete",
            "line": "    llm: BaseLanguageModel,"
          },
          {
            "type": "delete",
            "line": "    path: Union[str, IOBase, List[Union[str, IOBase]]],"
          },
          {
            "type": "delete",
            "line": "    pandas_kwargs: Optional[dict] = None,"
          },
          {
            "type": "delete",
            "line": "    **kwargs: Any,"
          },
          {
            "type": "delete",
            "line": ") -> AgentExecutor:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Create csv agent by loading to a dataframe and using pandas agent.\"\"\""
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        import pandas as pd"
          },
          {
            "type": "delete",
            "line": "    except ImportError:"
          },
          {
            "type": "delete",
            "line": "        raise ImportError("
          },
          {
            "type": "delete",
            "line": "            \"pandas package not found, please install with `pip install pandas`\""
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    _kwargs = pandas_kwargs or {}"
          },
          {
            "type": "delete",
            "line": "    if isinstance(path, (str, IOBase)):"
          },
          {
            "type": "delete",
            "line": "        df = pd.read_csv(path, **_kwargs)"
          },
          {
            "type": "delete",
            "line": "    elif isinstance(path, list):"
          },
          {
            "type": "delete",
            "line": "        df = []"
          },
          {
            "type": "delete",
            "line": "        for item in path:"
          },
          {
            "type": "delete",
            "line": "            if not isinstance(item, (str, IOBase)):"
          },
          {
            "type": "delete",
            "line": "                raise ValueError(f\"Expected str or file-like object, got {type(path)}\")"
          },
          {
            "type": "delete",
            "line": "            df.append(pd.read_csv(item, **_kwargs))"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        raise ValueError(f\"Expected str, list, or file-like object, got {type(path)}\")"
          },
          {
            "type": "delete",
            "line": "    return create_pandas_dataframe_agent(llm, df, **kwargs)"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/pandas/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index a6dc608d47..e01dffb979 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/pandas/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/agent_toolkits/pandas/__init__.py"
          },
          {
            "type": "delete",
            "line": "\"\"\"Pandas toolkit.\"\"\""
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    here = as_import_path(Path(__file__).parent)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    old_path = \"langchain.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    new_path = \"langchain_experimental.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This agent has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This agent relies on python REPL tool under the hood, so to use it \""
          },
          {
            "type": "add",
            "line": "        \"safely please sandbox the python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"and https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        f\"update your import statement from:\\n `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/pandas/base.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 6eb375d833..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/pandas/base.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"Agent for working with pandas objects.\"\"\""
          },
          {
            "type": "delete",
            "line": "from typing import Any, Dict, List, Optional, Sequence, Tuple"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain._api import warn_deprecated"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor, BaseSingleActionAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.pandas.prompt import ("
          },
          {
            "type": "delete",
            "line": "    FUNCTIONS_WITH_DF,"
          },
          {
            "type": "delete",
            "line": "    FUNCTIONS_WITH_MULTI_DF,"
          },
          {
            "type": "delete",
            "line": "    MULTI_DF_PREFIX,"
          },
          {
            "type": "delete",
            "line": "    MULTI_DF_PREFIX_FUNCTIONS,"
          },
          {
            "type": "delete",
            "line": "    PREFIX,"
          },
          {
            "type": "delete",
            "line": "    PREFIX_FUNCTIONS,"
          },
          {
            "type": "delete",
            "line": "    SUFFIX_NO_DF,"
          },
          {
            "type": "delete",
            "line": "    SUFFIX_WITH_DF,"
          },
          {
            "type": "delete",
            "line": "    SUFFIX_WITH_MULTI_DF,"
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.mrkl.base import ZeroShotAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.openai_functions_agent.base import OpenAIFunctionsAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.types import AgentType"
          },
          {
            "type": "delete",
            "line": "from langchain.callbacks.base import BaseCallbackManager"
          },
          {
            "type": "delete",
            "line": "from langchain.chains.llm import LLMChain"
          },
          {
            "type": "delete",
            "line": "from langchain.schema import BasePromptTemplate"
          },
          {
            "type": "delete",
            "line": "from langchain.schema.language_model import BaseLanguageModel"
          },
          {
            "type": "delete",
            "line": "from langchain.schema.messages import SystemMessage"
          },
          {
            "type": "delete",
            "line": "from langchain.tools import BaseTool"
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import PythonAstREPLTool"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_multi_prompt("
          },
          {
            "type": "delete",
            "line": "    dfs: List[Any],"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": ") -> Tuple[BasePromptTemplate, List[PythonAstREPLTool]]:"
          },
          {
            "type": "delete",
            "line": "    num_dfs = len(dfs)"
          },
          {
            "type": "delete",
            "line": "    if suffix is not None:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = suffix"
          },
          {
            "type": "delete",
            "line": "        include_dfs_head = True"
          },
          {
            "type": "delete",
            "line": "    elif include_df_in_prompt:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = SUFFIX_WITH_MULTI_DF"
          },
          {
            "type": "delete",
            "line": "        include_dfs_head = True"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = SUFFIX_NO_DF"
          },
          {
            "type": "delete",
            "line": "        include_dfs_head = False"
          },
          {
            "type": "delete",
            "line": "    if input_variables is None:"
          },
          {
            "type": "delete",
            "line": "        input_variables = [\"input\", \"agent_scratchpad\", \"num_dfs\"]"
          },
          {
            "type": "delete",
            "line": "        if include_dfs_head:"
          },
          {
            "type": "delete",
            "line": "            input_variables += [\"dfs_head\"]"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if prefix is None:"
          },
          {
            "type": "delete",
            "line": "        prefix = MULTI_DF_PREFIX"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    df_locals = {}"
          },
          {
            "type": "delete",
            "line": "    for i, dataframe in enumerate(dfs):"
          },
          {
            "type": "delete",
            "line": "        df_locals[f\"df{i + 1}\"] = dataframe"
          },
          {
            "type": "delete",
            "line": "    tools = [PythonAstREPLTool(locals=df_locals)]"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    prompt = ZeroShotAgent.create_prompt("
          },
          {
            "type": "delete",
            "line": "        tools, prefix=prefix, suffix=suffix_to_use, input_variables=input_variables"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    partial_prompt = prompt.partial()"
          },
          {
            "type": "delete",
            "line": "    if \"dfs_head\" in input_variables:"
          },
          {
            "type": "delete",
            "line": "        dfs_head = \"\\n\\n\".join([d.head(number_of_head_rows).to_markdown() for d in dfs])"
          },
          {
            "type": "delete",
            "line": "        partial_prompt = partial_prompt.partial(num_dfs=str(num_dfs), dfs_head=dfs_head)"
          },
          {
            "type": "delete",
            "line": "    if \"num_dfs\" in input_variables:"
          },
          {
            "type": "delete",
            "line": "        partial_prompt = partial_prompt.partial(num_dfs=str(num_dfs))"
          },
          {
            "type": "delete",
            "line": "    return partial_prompt, tools"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_single_prompt("
          },
          {
            "type": "delete",
            "line": "    df: Any,"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": ") -> Tuple[BasePromptTemplate, List[PythonAstREPLTool]]:"
          },
          {
            "type": "delete",
            "line": "    if suffix is not None:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = suffix"
          },
          {
            "type": "delete",
            "line": "        include_df_head = True"
          },
          {
            "type": "delete",
            "line": "    elif include_df_in_prompt:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = SUFFIX_WITH_DF"
          },
          {
            "type": "delete",
            "line": "        include_df_head = True"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = SUFFIX_NO_DF"
          },
          {
            "type": "delete",
            "line": "        include_df_head = False"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if input_variables is None:"
          },
          {
            "type": "delete",
            "line": "        input_variables = [\"input\", \"agent_scratchpad\"]"
          },
          {
            "type": "delete",
            "line": "        if include_df_head:"
          },
          {
            "type": "delete",
            "line": "            input_variables += [\"df_head\"]"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if prefix is None:"
          },
          {
            "type": "delete",
            "line": "        prefix = PREFIX"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    tools = [PythonAstREPLTool(locals={\"df\": df})]"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    prompt = ZeroShotAgent.create_prompt("
          },
          {
            "type": "delete",
            "line": "        tools, prefix=prefix, suffix=suffix_to_use, input_variables=input_variables"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    partial_prompt = prompt.partial()"
          },
          {
            "type": "delete",
            "line": "    if \"df_head\" in input_variables:"
          },
          {
            "type": "delete",
            "line": "        partial_prompt = partial_prompt.partial("
          },
          {
            "type": "delete",
            "line": "            df_head=str(df.head(number_of_head_rows).to_markdown())"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    return partial_prompt, tools"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_prompt_and_tools("
          },
          {
            "type": "delete",
            "line": "    df: Any,"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": ") -> Tuple[BasePromptTemplate, List[PythonAstREPLTool]]:"
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        import pandas as pd"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        pd.set_option(\"display.max_columns\", None)"
          },
          {
            "type": "delete",
            "line": "    except ImportError:"
          },
          {
            "type": "delete",
            "line": "        raise ImportError("
          },
          {
            "type": "delete",
            "line": "            \"pandas package not found, please install with `pip install pandas`\""
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if include_df_in_prompt is not None and suffix is not None:"
          },
          {
            "type": "delete",
            "line": "        raise ValueError(\"If suffix is specified, include_df_in_prompt should not be.\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if isinstance(df, list):"
          },
          {
            "type": "delete",
            "line": "        for item in df:"
          },
          {
            "type": "delete",
            "line": "            if not isinstance(item, pd.DataFrame):"
          },
          {
            "type": "delete",
            "line": "                raise ValueError(f\"Expected pandas object, got {type(df)}\")"
          },
          {
            "type": "delete",
            "line": "        return _get_multi_prompt("
          },
          {
            "type": "delete",
            "line": "            df,"
          },
          {
            "type": "delete",
            "line": "            prefix=prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=suffix,"
          },
          {
            "type": "delete",
            "line": "            input_variables=input_variables,"
          },
          {
            "type": "delete",
            "line": "            include_df_in_prompt=include_df_in_prompt,"
          },
          {
            "type": "delete",
            "line": "            number_of_head_rows=number_of_head_rows,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        if not isinstance(df, pd.DataFrame):"
          },
          {
            "type": "delete",
            "line": "            raise ValueError(f\"Expected pandas object, got {type(df)}\")"
          },
          {
            "type": "delete",
            "line": "        return _get_single_prompt("
          },
          {
            "type": "delete",
            "line": "            df,"
          },
          {
            "type": "delete",
            "line": "            prefix=prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=suffix,"
          },
          {
            "type": "delete",
            "line": "            input_variables=input_variables,"
          },
          {
            "type": "delete",
            "line": "            include_df_in_prompt=include_df_in_prompt,"
          },
          {
            "type": "delete",
            "line": "            number_of_head_rows=number_of_head_rows,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_functions_single_prompt("
          },
          {
            "type": "delete",
            "line": "    df: Any,"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": ") -> Tuple[BasePromptTemplate, List[PythonAstREPLTool]]:"
          },
          {
            "type": "delete",
            "line": "    if suffix is not None:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = suffix"
          },
          {
            "type": "delete",
            "line": "        if include_df_in_prompt:"
          },
          {
            "type": "delete",
            "line": "            suffix_to_use = suffix_to_use.format("
          },
          {
            "type": "delete",
            "line": "                df_head=str(df.head(number_of_head_rows).to_markdown())"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "    elif include_df_in_prompt:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = FUNCTIONS_WITH_DF.format("
          },
          {
            "type": "delete",
            "line": "            df_head=str(df.head(number_of_head_rows).to_markdown())"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = \"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if prefix is None:"
          },
          {
            "type": "delete",
            "line": "        prefix = PREFIX_FUNCTIONS"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    tools = [PythonAstREPLTool(locals={\"df\": df})]"
          },
          {
            "type": "delete",
            "line": "    system_message = SystemMessage(content=prefix + suffix_to_use)"
          },
          {
            "type": "delete",
            "line": "    prompt = OpenAIFunctionsAgent.create_prompt(system_message=system_message)"
          },
          {
            "type": "delete",
            "line": "    return prompt, tools"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_functions_multi_prompt("
          },
          {
            "type": "delete",
            "line": "    dfs: Any,"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": ") -> Tuple[BasePromptTemplate, List[PythonAstREPLTool]]:"
          },
          {
            "type": "delete",
            "line": "    if suffix is not None:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = suffix"
          },
          {
            "type": "delete",
            "line": "        if include_df_in_prompt:"
          },
          {
            "type": "delete",
            "line": "            dfs_head = \"\\n\\n\".join("
          },
          {
            "type": "delete",
            "line": "                [d.head(number_of_head_rows).to_markdown() for d in dfs]"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "            suffix_to_use = suffix_to_use.format("
          },
          {
            "type": "delete",
            "line": "                dfs_head=dfs_head,"
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "    elif include_df_in_prompt:"
          },
          {
            "type": "delete",
            "line": "        dfs_head = \"\\n\\n\".join([d.head(number_of_head_rows).to_markdown() for d in dfs])"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = FUNCTIONS_WITH_MULTI_DF.format("
          },
          {
            "type": "delete",
            "line": "            dfs_head=dfs_head,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        suffix_to_use = \"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if prefix is None:"
          },
          {
            "type": "delete",
            "line": "        prefix = MULTI_DF_PREFIX_FUNCTIONS"
          },
          {
            "type": "delete",
            "line": "    prefix = prefix.format(num_dfs=str(len(dfs)))"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    df_locals = {}"
          },
          {
            "type": "delete",
            "line": "    for i, dataframe in enumerate(dfs):"
          },
          {
            "type": "delete",
            "line": "        df_locals[f\"df{i + 1}\"] = dataframe"
          },
          {
            "type": "delete",
            "line": "    tools = [PythonAstREPLTool(locals=df_locals)]"
          },
          {
            "type": "delete",
            "line": "    system_message = SystemMessage(content=prefix + suffix_to_use)"
          },
          {
            "type": "delete",
            "line": "    prompt = OpenAIFunctionsAgent.create_prompt(system_message=system_message)"
          },
          {
            "type": "delete",
            "line": "    return prompt, tools"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_functions_prompt_and_tools("
          },
          {
            "type": "delete",
            "line": "    df: Any,"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": ") -> Tuple[BasePromptTemplate, List[PythonAstREPLTool]]:"
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        import pandas as pd"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        pd.set_option(\"display.max_columns\", None)"
          },
          {
            "type": "delete",
            "line": "    except ImportError:"
          },
          {
            "type": "delete",
            "line": "        raise ImportError("
          },
          {
            "type": "delete",
            "line": "            \"pandas package not found, please install with `pip install pandas`\""
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    if input_variables is not None:"
          },
          {
            "type": "delete",
            "line": "        raise ValueError(\"`input_variables` is not supported at the moment.\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if include_df_in_prompt is not None and suffix is not None:"
          },
          {
            "type": "delete",
            "line": "        raise ValueError(\"If suffix is specified, include_df_in_prompt should not be.\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if isinstance(df, list):"
          },
          {
            "type": "delete",
            "line": "        for item in df:"
          },
          {
            "type": "delete",
            "line": "            if not isinstance(item, pd.DataFrame):"
          },
          {
            "type": "delete",
            "line": "                raise ValueError(f\"Expected pandas object, got {type(df)}\")"
          },
          {
            "type": "delete",
            "line": "        return _get_functions_multi_prompt("
          },
          {
            "type": "delete",
            "line": "            df,"
          },
          {
            "type": "delete",
            "line": "            prefix=prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=suffix,"
          },
          {
            "type": "delete",
            "line": "            include_df_in_prompt=include_df_in_prompt,"
          },
          {
            "type": "delete",
            "line": "            number_of_head_rows=number_of_head_rows,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        if not isinstance(df, pd.DataFrame):"
          },
          {
            "type": "delete",
            "line": "            raise ValueError(f\"Expected pandas object, got {type(df)}\")"
          },
          {
            "type": "delete",
            "line": "        return _get_functions_single_prompt("
          },
          {
            "type": "delete",
            "line": "            df,"
          },
          {
            "type": "delete",
            "line": "            prefix=prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=suffix,"
          },
          {
            "type": "delete",
            "line": "            include_df_in_prompt=include_df_in_prompt,"
          },
          {
            "type": "delete",
            "line": "            number_of_head_rows=number_of_head_rows,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def create_pandas_dataframe_agent("
          },
          {
            "type": "delete",
            "line": "    llm: BaseLanguageModel,"
          },
          {
            "type": "delete",
            "line": "    df: Any,"
          },
          {
            "type": "delete",
            "line": "    agent_type: AgentType = AgentType.ZERO_SHOT_REACT_DESCRIPTION,"
          },
          {
            "type": "delete",
            "line": "    callback_manager: Optional[BaseCallbackManager] = None,"
          },
          {
            "type": "delete",
            "line": "    prefix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    suffix: Optional[str] = None,"
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    verbose: bool = False,"
          },
          {
            "type": "delete",
            "line": "    return_intermediate_steps: bool = False,"
          },
          {
            "type": "delete",
            "line": "    max_iterations: Optional[int] = 15,"
          },
          {
            "type": "delete",
            "line": "    max_execution_time: Optional[float] = None,"
          },
          {
            "type": "delete",
            "line": "    early_stopping_method: str = \"force\","
          },
          {
            "type": "delete",
            "line": "    agent_executor_kwargs: Optional[Dict[str, Any]] = None,"
          },
          {
            "type": "delete",
            "line": "    include_df_in_prompt: Optional[bool] = True,"
          },
          {
            "type": "delete",
            "line": "    number_of_head_rows: int = 5,"
          },
          {
            "type": "delete",
            "line": "    extra_tools: Sequence[BaseTool] = (),"
          },
          {
            "type": "delete",
            "line": "    **kwargs: Any,"
          },
          {
            "type": "delete",
            "line": ") -> AgentExecutor:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Construct a pandas agent from an LLM and dataframe.\"\"\""
          },
          {
            "type": "delete",
            "line": "    warn_deprecated("
          },
          {
            "type": "delete",
            "line": "        since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "        message=("
          },
          {
            "type": "delete",
            "line": "            \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "            \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "            \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "            \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "        ),"
          },
          {
            "type": "delete",
            "line": "        pending=True,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    agent: BaseSingleActionAgent"
          },
          {
            "type": "delete",
            "line": "    if agent_type == AgentType.ZERO_SHOT_REACT_DESCRIPTION:"
          },
          {
            "type": "delete",
            "line": "        prompt, base_tools = _get_prompt_and_tools("
          },
          {
            "type": "delete",
            "line": "            df,"
          },
          {
            "type": "delete",
            "line": "            prefix=prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=suffix,"
          },
          {
            "type": "delete",
            "line": "            input_variables=input_variables,"
          },
          {
            "type": "delete",
            "line": "            include_df_in_prompt=include_df_in_prompt,"
          },
          {
            "type": "delete",
            "line": "            number_of_head_rows=number_of_head_rows,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        tools = base_tools + list(extra_tools)"
          },
          {
            "type": "delete",
            "line": "        llm_chain = LLMChain("
          },
          {
            "type": "delete",
            "line": "            llm=llm,"
          },
          {
            "type": "delete",
            "line": "            prompt=prompt,"
          },
          {
            "type": "delete",
            "line": "            callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        tool_names = [tool.name for tool in tools]"
          },
          {
            "type": "delete",
            "line": "        agent = ZeroShotAgent("
          },
          {
            "type": "delete",
            "line": "            llm_chain=llm_chain,"
          },
          {
            "type": "delete",
            "line": "            allowed_tools=tool_names,"
          },
          {
            "type": "delete",
            "line": "            callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "            **kwargs,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    elif agent_type == AgentType.OPENAI_FUNCTIONS:"
          },
          {
            "type": "delete",
            "line": "        _prompt, base_tools = _get_functions_prompt_and_tools("
          },
          {
            "type": "delete",
            "line": "            df,"
          },
          {
            "type": "delete",
            "line": "            prefix=prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=suffix,"
          },
          {
            "type": "delete",
            "line": "            input_variables=input_variables,"
          },
          {
            "type": "delete",
            "line": "            include_df_in_prompt=include_df_in_prompt,"
          },
          {
            "type": "delete",
            "line": "            number_of_head_rows=number_of_head_rows,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        tools = base_tools + list(extra_tools)"
          },
          {
            "type": "delete",
            "line": "        agent = OpenAIFunctionsAgent("
          },
          {
            "type": "delete",
            "line": "            llm=llm,"
          },
          {
            "type": "delete",
            "line": "            prompt=_prompt,"
          },
          {
            "type": "delete",
            "line": "            tools=tools,"
          },
          {
            "type": "delete",
            "line": "            callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "            **kwargs,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        raise ValueError(f\"Agent type {agent_type} not supported at the moment.\")"
          },
          {
            "type": "delete",
            "line": "    return AgentExecutor.from_agent_and_tools("
          },
          {
            "type": "delete",
            "line": "        agent=agent,"
          },
          {
            "type": "delete",
            "line": "        tools=tools,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        verbose=verbose,"
          },
          {
            "type": "delete",
            "line": "        return_intermediate_steps=return_intermediate_steps,"
          },
          {
            "type": "delete",
            "line": "        max_iterations=max_iterations,"
          },
          {
            "type": "delete",
            "line": "        max_execution_time=max_execution_time,"
          },
          {
            "type": "delete",
            "line": "        early_stopping_method=early_stopping_method,"
          },
          {
            "type": "delete",
            "line": "        **(agent_executor_kwargs or {}),"
          },
          {
            "type": "delete",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/pandas/prompt.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 72b2bc8b20..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/pandas/prompt.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "# flake8: noqa"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "PREFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with a pandas dataframe in Python. The name of the dataframe is `df`."
          },
          {
            "type": "delete",
            "line": "You should use the tools below to answer the question posed of you:\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "MULTI_DF_PREFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with {num_dfs} pandas dataframes in Python named df1, df2, etc. You"
          },
          {
            "type": "delete",
            "line": "should use the tools below to answer the question posed of you:\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "SUFFIX_NO_DF = \"\"\""
          },
          {
            "type": "delete",
            "line": "Begin!"
          },
          {
            "type": "delete",
            "line": "Question: {input}"
          },
          {
            "type": "delete",
            "line": "{agent_scratchpad}\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "SUFFIX_WITH_DF = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(df.head())`:"
          },
          {
            "type": "delete",
            "line": "{df_head}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Begin!"
          },
          {
            "type": "delete",
            "line": "Question: {input}"
          },
          {
            "type": "delete",
            "line": "{agent_scratchpad}\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "SUFFIX_WITH_MULTI_DF = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(df.head())` for each dataframe:"
          },
          {
            "type": "delete",
            "line": "{dfs_head}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Begin!"
          },
          {
            "type": "delete",
            "line": "Question: {input}"
          },
          {
            "type": "delete",
            "line": "{agent_scratchpad}\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "PREFIX_FUNCTIONS = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with a pandas dataframe in Python. The name of the dataframe is `df`.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "MULTI_DF_PREFIX_FUNCTIONS = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with {num_dfs} pandas dataframes in Python named df1, df2, etc.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "FUNCTIONS_WITH_DF = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(df.head())`:"
          },
          {
            "type": "delete",
            "line": "{df_head}\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "FUNCTIONS_WITH_MULTI_DF = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(df.head())` for each dataframe:"
          },
          {
            "type": "delete",
            "line": "{dfs_head}\"\"\""
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/python/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index e69de29bb2..e01dffb979 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/python/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/agent_toolkits/python/__init__.py"
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    here = as_import_path(Path(__file__).parent)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    old_path = \"langchain.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    new_path = \"langchain_experimental.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This agent has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This agent relies on python REPL tool under the hood, so to use it \""
          },
          {
            "type": "add",
            "line": "        \"safely please sandbox the python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"and https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        f\"update your import statement from:\\n `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/python/base.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0f5c2cc77c..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/python/base.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"Python agent.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from typing import Any, Dict, Optional"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain._api import warn_deprecated"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor, BaseSingleActionAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.python.prompt import PREFIX"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.mrkl.base import ZeroShotAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.openai_functions_agent.base import OpenAIFunctionsAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.types import AgentType"
          },
          {
            "type": "delete",
            "line": "from langchain.callbacks.base import BaseCallbackManager"
          },
          {
            "type": "delete",
            "line": "from langchain.chains.llm import LLMChain"
          },
          {
            "type": "delete",
            "line": "from langchain.schema.language_model import BaseLanguageModel"
          },
          {
            "type": "delete",
            "line": "from langchain.schema.messages import SystemMessage"
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import PythonREPLTool"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def create_python_agent("
          },
          {
            "type": "delete",
            "line": "    llm: BaseLanguageModel,"
          },
          {
            "type": "delete",
            "line": "    tool: PythonREPLTool,"
          },
          {
            "type": "delete",
            "line": "    agent_type: AgentType = AgentType.ZERO_SHOT_REACT_DESCRIPTION,"
          },
          {
            "type": "delete",
            "line": "    callback_manager: Optional[BaseCallbackManager] = None,"
          },
          {
            "type": "delete",
            "line": "    verbose: bool = False,"
          },
          {
            "type": "delete",
            "line": "    prefix: str = PREFIX,"
          },
          {
            "type": "delete",
            "line": "    agent_executor_kwargs: Optional[Dict[str, Any]] = None,"
          },
          {
            "type": "delete",
            "line": "    **kwargs: Any,"
          },
          {
            "type": "delete",
            "line": ") -> AgentExecutor:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Construct a python agent from an LLM and tool.\"\"\""
          },
          {
            "type": "delete",
            "line": "    warn_deprecated("
          },
          {
            "type": "delete",
            "line": "        since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "        message=("
          },
          {
            "type": "delete",
            "line": "            \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "            \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "            \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "            \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "        ),"
          },
          {
            "type": "delete",
            "line": "        pending=True,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    tools = [tool]"
          },
          {
            "type": "delete",
            "line": "    agent: BaseSingleActionAgent"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if agent_type == AgentType.ZERO_SHOT_REACT_DESCRIPTION:"
          },
          {
            "type": "delete",
            "line": "        prompt = ZeroShotAgent.create_prompt(tools, prefix=prefix)"
          },
          {
            "type": "delete",
            "line": "        llm_chain = LLMChain("
          },
          {
            "type": "delete",
            "line": "            llm=llm,"
          },
          {
            "type": "delete",
            "line": "            prompt=prompt,"
          },
          {
            "type": "delete",
            "line": "            callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        tool_names = [tool.name for tool in tools]"
          },
          {
            "type": "delete",
            "line": "        agent = ZeroShotAgent(llm_chain=llm_chain, allowed_tools=tool_names, **kwargs)"
          },
          {
            "type": "delete",
            "line": "    elif agent_type == AgentType.OPENAI_FUNCTIONS:"
          },
          {
            "type": "delete",
            "line": "        system_message = SystemMessage(content=prefix)"
          },
          {
            "type": "delete",
            "line": "        _prompt = OpenAIFunctionsAgent.create_prompt(system_message=system_message)"
          },
          {
            "type": "delete",
            "line": "        agent = OpenAIFunctionsAgent("
          },
          {
            "type": "delete",
            "line": "            llm=llm,"
          },
          {
            "type": "delete",
            "line": "            prompt=_prompt,"
          },
          {
            "type": "delete",
            "line": "            tools=tools,"
          },
          {
            "type": "delete",
            "line": "            callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "            **kwargs,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        raise ValueError(f\"Agent type {agent_type} not supported at the moment.\")"
          },
          {
            "type": "delete",
            "line": "    return AgentExecutor.from_agent_and_tools("
          },
          {
            "type": "delete",
            "line": "        agent=agent,"
          },
          {
            "type": "delete",
            "line": "        tools=tools,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        verbose=verbose,"
          },
          {
            "type": "delete",
            "line": "        **(agent_executor_kwargs or {}),"
          },
          {
            "type": "delete",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/python/prompt.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index fc97e7916e..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/python/prompt.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "# flake8: noqa"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "PREFIX = \"\"\"You are an agent designed to write and execute python code to answer questions."
          },
          {
            "type": "delete",
            "line": "You have access to a python REPL, which you can use to execute python code."
          },
          {
            "type": "delete",
            "line": "If you get an error, debug your code and try again."
          },
          {
            "type": "delete",
            "line": "Only use the output of your code to answer the question."
          },
          {
            "type": "delete",
            "line": "You might know the answer without running any code, but you should still run the code to get the answer."
          },
          {
            "type": "delete",
            "line": "If it does not seem like you can write code to answer the question, just return \"I don't know\" as the answer."
          },
          {
            "type": "delete",
            "line": "\"\"\""
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/spark/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index ded6eb03a4..e01dffb979 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/spark/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/agent_toolkits/spark/__init__.py"
          },
          {
            "type": "delete",
            "line": "\"\"\"spark toolkit\"\"\""
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    here = as_import_path(Path(__file__).parent)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    old_path = \"langchain.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    new_path = \"langchain_experimental.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This agent has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This agent relies on python REPL tool under the hood, so to use it \""
          },
          {
            "type": "add",
            "line": "        \"safely please sandbox the python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"and https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        f\"update your import statement from:\\n `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/spark/base.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index cc520cf150..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/spark/base.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"Agent for working with pandas objects.\"\"\""
          },
          {
            "type": "delete",
            "line": "from typing import Any, Dict, List, Optional"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain._api import warn_deprecated"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.spark.prompt import PREFIX, SUFFIX"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.mrkl.base import ZeroShotAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.callbacks.base import BaseCallbackManager"
          },
          {
            "type": "delete",
            "line": "from langchain.chains.llm import LLMChain"
          },
          {
            "type": "delete",
            "line": "from langchain.llms.base import BaseLLM"
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import PythonAstREPLTool"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _validate_spark_df(df: Any) -> bool:"
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        from pyspark.sql import DataFrame as SparkLocalDataFrame"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return isinstance(df, SparkLocalDataFrame)"
          },
          {
            "type": "delete",
            "line": "    except ImportError:"
          },
          {
            "type": "delete",
            "line": "        return False"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _validate_spark_connect_df(df: Any) -> bool:"
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        from pyspark.sql.connect.dataframe import DataFrame as SparkConnectDataFrame"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return isinstance(df, SparkConnectDataFrame)"
          },
          {
            "type": "delete",
            "line": "    except ImportError:"
          },
          {
            "type": "delete",
            "line": "        return False"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def create_spark_dataframe_agent("
          },
          {
            "type": "delete",
            "line": "    llm: BaseLLM,"
          },
          {
            "type": "delete",
            "line": "    df: Any,"
          },
          {
            "type": "delete",
            "line": "    callback_manager: Optional[BaseCallbackManager] = None,"
          },
          {
            "type": "delete",
            "line": "    prefix: str = PREFIX,"
          },
          {
            "type": "delete",
            "line": "    suffix: str = SUFFIX,"
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    verbose: bool = False,"
          },
          {
            "type": "delete",
            "line": "    return_intermediate_steps: bool = False,"
          },
          {
            "type": "delete",
            "line": "    max_iterations: Optional[int] = 15,"
          },
          {
            "type": "delete",
            "line": "    max_execution_time: Optional[float] = None,"
          },
          {
            "type": "delete",
            "line": "    early_stopping_method: str = \"force\","
          },
          {
            "type": "delete",
            "line": "    agent_executor_kwargs: Optional[Dict[str, Any]] = None,"
          },
          {
            "type": "delete",
            "line": "    **kwargs: Any,"
          },
          {
            "type": "delete",
            "line": ") -> AgentExecutor:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Construct a Spark agent from an LLM and dataframe.\"\"\""
          },
          {
            "type": "delete",
            "line": "    warn_deprecated("
          },
          {
            "type": "delete",
            "line": "        since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "        message=("
          },
          {
            "type": "delete",
            "line": "            \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "            \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "            \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "            \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "        ),"
          },
          {
            "type": "delete",
            "line": "        pending=True,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if not _validate_spark_df(df) and not _validate_spark_connect_df(df):"
          },
          {
            "type": "delete",
            "line": "        raise ImportError(\"Spark is not installed. run `pip install pyspark`.\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if input_variables is None:"
          },
          {
            "type": "delete",
            "line": "        input_variables = [\"df\", \"input\", \"agent_scratchpad\"]"
          },
          {
            "type": "delete",
            "line": "    tools = [PythonAstREPLTool(locals={\"df\": df})]"
          },
          {
            "type": "delete",
            "line": "    prompt = ZeroShotAgent.create_prompt("
          },
          {
            "type": "delete",
            "line": "        tools, prefix=prefix, suffix=suffix, input_variables=input_variables"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    partial_prompt = prompt.partial(df=str(df.first()))"
          },
          {
            "type": "delete",
            "line": "    llm_chain = LLMChain("
          },
          {
            "type": "delete",
            "line": "        llm=llm,"
          },
          {
            "type": "delete",
            "line": "        prompt=partial_prompt,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    tool_names = [tool.name for tool in tools]"
          },
          {
            "type": "delete",
            "line": "    agent = ZeroShotAgent("
          },
          {
            "type": "delete",
            "line": "        llm_chain=llm_chain,"
          },
          {
            "type": "delete",
            "line": "        allowed_tools=tool_names,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        **kwargs,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    return AgentExecutor.from_agent_and_tools("
          },
          {
            "type": "delete",
            "line": "        agent=agent,"
          },
          {
            "type": "delete",
            "line": "        tools=tools,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        verbose=verbose,"
          },
          {
            "type": "delete",
            "line": "        return_intermediate_steps=return_intermediate_steps,"
          },
          {
            "type": "delete",
            "line": "        max_iterations=max_iterations,"
          },
          {
            "type": "delete",
            "line": "        max_execution_time=max_execution_time,"
          },
          {
            "type": "delete",
            "line": "        early_stopping_method=early_stopping_method,"
          },
          {
            "type": "delete",
            "line": "        **(agent_executor_kwargs or {}),"
          },
          {
            "type": "delete",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/spark/prompt.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 32ce2c3423..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/spark/prompt.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "# flake8: noqa"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "PREFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with a spark dataframe in Python. The name of the dataframe is `df`."
          },
          {
            "type": "delete",
            "line": "You should use the tools below to answer the question posed of you:\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "SUFFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(df.first())`:"
          },
          {
            "type": "delete",
            "line": "{df}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Begin!"
          },
          {
            "type": "delete",
            "line": "Question: {input}"
          },
          {
            "type": "delete",
            "line": "{agent_scratchpad}\"\"\""
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/xorbits/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index 71bf7b70ea..e01dffb979 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/xorbits/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/agent_toolkits/xorbits/__init__.py"
          },
          {
            "type": "delete",
            "line": "\"\"\"Xorbits toolkit.\"\"\""
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": "from typing import Any"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api.path import as_import_path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def __getattr__(name: str) -> Any:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Get attr name.\"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    here = as_import_path(Path(__file__).parent)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    old_path = \"langchain.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    new_path = \"langchain_experimental.\" + here + \".\" + name"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This agent has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This agent relies on python REPL tool under the hood, so to use it \""
          },
          {
            "type": "add",
            "line": "        \"safely please sandbox the python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"and https://github.com/langchain-ai/langchain/discussions/11680\""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        f\"update your import statement from:\\n `{old_path}` to `{new_path}`.\""
          },
          {
            "type": "add",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/xorbits/base.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 9d329619a6..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/xorbits/base.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"Agent for working with xorbits objects.\"\"\""
          },
          {
            "type": "delete",
            "line": "from typing import Any, Dict, List, Optional"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain._api import warn_deprecated"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent_toolkits.xorbits.prompt import ("
          },
          {
            "type": "delete",
            "line": "    NP_PREFIX,"
          },
          {
            "type": "delete",
            "line": "    NP_SUFFIX,"
          },
          {
            "type": "delete",
            "line": "    PD_PREFIX,"
          },
          {
            "type": "delete",
            "line": "    PD_SUFFIX,"
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.mrkl.base import ZeroShotAgent"
          },
          {
            "type": "delete",
            "line": "from langchain.callbacks.base import BaseCallbackManager"
          },
          {
            "type": "delete",
            "line": "from langchain.chains.llm import LLMChain"
          },
          {
            "type": "delete",
            "line": "from langchain.llms.base import BaseLLM"
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import PythonAstREPLTool"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def create_xorbits_agent("
          },
          {
            "type": "delete",
            "line": "    llm: BaseLLM,"
          },
          {
            "type": "delete",
            "line": "    data: Any,"
          },
          {
            "type": "delete",
            "line": "    callback_manager: Optional[BaseCallbackManager] = None,"
          },
          {
            "type": "delete",
            "line": "    prefix: str = \"\","
          },
          {
            "type": "delete",
            "line": "    suffix: str = \"\","
          },
          {
            "type": "delete",
            "line": "    input_variables: Optional[List[str]] = None,"
          },
          {
            "type": "delete",
            "line": "    verbose: bool = False,"
          },
          {
            "type": "delete",
            "line": "    return_intermediate_steps: bool = False,"
          },
          {
            "type": "delete",
            "line": "    max_iterations: Optional[int] = 15,"
          },
          {
            "type": "delete",
            "line": "    max_execution_time: Optional[float] = None,"
          },
          {
            "type": "delete",
            "line": "    early_stopping_method: str = \"force\","
          },
          {
            "type": "delete",
            "line": "    agent_executor_kwargs: Optional[Dict[str, Any]] = None,"
          },
          {
            "type": "delete",
            "line": "    **kwargs: Any,"
          },
          {
            "type": "delete",
            "line": ") -> AgentExecutor:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Construct a xorbits agent from an LLM and dataframe.\"\"\""
          },
          {
            "type": "delete",
            "line": "    warn_deprecated("
          },
          {
            "type": "delete",
            "line": "        since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "        message=("
          },
          {
            "type": "delete",
            "line": "            \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "            \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "            \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "            \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "        ),"
          },
          {
            "type": "delete",
            "line": "        pending=True,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    try:"
          },
          {
            "type": "delete",
            "line": "        from xorbits import numpy as np"
          },
          {
            "type": "delete",
            "line": "        from xorbits import pandas as pd"
          },
          {
            "type": "delete",
            "line": "    except ImportError:"
          },
          {
            "type": "delete",
            "line": "        raise ImportError("
          },
          {
            "type": "delete",
            "line": "            \"Xorbits package not installed, please install with `pip install xorbits`\""
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if not isinstance(data, (pd.DataFrame, np.ndarray)):"
          },
          {
            "type": "delete",
            "line": "        raise ValueError("
          },
          {
            "type": "delete",
            "line": "            f\"Expected Xorbits DataFrame or ndarray object, got {type(data)}\""
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "    if input_variables is None:"
          },
          {
            "type": "delete",
            "line": "        input_variables = [\"data\", \"input\", \"agent_scratchpad\"]"
          },
          {
            "type": "delete",
            "line": "    tools = [PythonAstREPLTool(locals={\"data\": data})]"
          },
          {
            "type": "delete",
            "line": "    prompt, partial_input = None, None"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    if isinstance(data, pd.DataFrame):"
          },
          {
            "type": "delete",
            "line": "        prompt = ZeroShotAgent.create_prompt("
          },
          {
            "type": "delete",
            "line": "            tools,"
          },
          {
            "type": "delete",
            "line": "            prefix=PD_PREFIX if prefix == \"\" else prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=PD_SUFFIX if suffix == \"\" else suffix,"
          },
          {
            "type": "delete",
            "line": "            input_variables=input_variables,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        partial_input = str(data.head())"
          },
          {
            "type": "delete",
            "line": "    else:"
          },
          {
            "type": "delete",
            "line": "        prompt = ZeroShotAgent.create_prompt("
          },
          {
            "type": "delete",
            "line": "            tools,"
          },
          {
            "type": "delete",
            "line": "            prefix=NP_PREFIX if prefix == \"\" else prefix,"
          },
          {
            "type": "delete",
            "line": "            suffix=NP_SUFFIX if suffix == \"\" else suffix,"
          },
          {
            "type": "delete",
            "line": "            input_variables=input_variables,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        partial_input = str(data[: len(data) // 2])"
          },
          {
            "type": "delete",
            "line": "    partial_prompt = prompt.partial(data=partial_input)"
          },
          {
            "type": "delete",
            "line": "    llm_chain = LLMChain("
          },
          {
            "type": "delete",
            "line": "        llm=llm,"
          },
          {
            "type": "delete",
            "line": "        prompt=partial_prompt,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    tool_names = [tool.name for tool in tools]"
          },
          {
            "type": "delete",
            "line": "    agent = ZeroShotAgent("
          },
          {
            "type": "delete",
            "line": "        llm_chain=llm_chain,"
          },
          {
            "type": "delete",
            "line": "        allowed_tools=tool_names,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        **kwargs,"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    return AgentExecutor.from_agent_and_tools("
          },
          {
            "type": "delete",
            "line": "        agent=agent,"
          },
          {
            "type": "delete",
            "line": "        tools=tools,"
          },
          {
            "type": "delete",
            "line": "        callback_manager=callback_manager,"
          },
          {
            "type": "delete",
            "line": "        verbose=verbose,"
          },
          {
            "type": "delete",
            "line": "        return_intermediate_steps=return_intermediate_steps,"
          },
          {
            "type": "delete",
            "line": "        max_iterations=max_iterations,"
          },
          {
            "type": "delete",
            "line": "        max_execution_time=max_execution_time,"
          },
          {
            "type": "delete",
            "line": "        early_stopping_method=early_stopping_method,"
          },
          {
            "type": "delete",
            "line": "        **(agent_executor_kwargs or {}),"
          },
          {
            "type": "delete",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/agent_toolkits/xorbits/prompt.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 6db3a41a79..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/agent_toolkits/xorbits/prompt.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "PD_PREFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with Xorbits dataframe object in Python."
          },
          {
            "type": "delete",
            "line": "Before importing Numpy or Pandas in the current script,"
          },
          {
            "type": "delete",
            "line": "remember to import the xorbits version of the library instead."
          },
          {
            "type": "delete",
            "line": "To import the xorbits version of Numpy, replace the original import statement"
          },
          {
            "type": "delete",
            "line": "`import pandas as pd` with `import xorbits.pandas as pd`."
          },
          {
            "type": "delete",
            "line": "The name of the input is `data`."
          },
          {
            "type": "delete",
            "line": "You should use the tools below to answer the question posed of you:\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "PD_SUFFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(data)`:"
          },
          {
            "type": "delete",
            "line": "{data}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Begin!"
          },
          {
            "type": "delete",
            "line": "Question: {input}"
          },
          {
            "type": "delete",
            "line": "{agent_scratchpad}\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "NP_PREFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "You are working with Xorbits ndarray object in Python."
          },
          {
            "type": "delete",
            "line": "Before importing Numpy in the current script,"
          },
          {
            "type": "delete",
            "line": "remember to import the xorbits version of the library instead."
          },
          {
            "type": "delete",
            "line": "To import the xorbits version of Numpy, replace the original import statement"
          },
          {
            "type": "delete",
            "line": "`import numpy as np` with `import xorbits.numpy as np`."
          },
          {
            "type": "delete",
            "line": "The name of the input is `data`."
          },
          {
            "type": "delete",
            "line": "You should use the tools below to answer the question posed of you:\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "NP_SUFFIX = \"\"\""
          },
          {
            "type": "delete",
            "line": "This is the result of `print(data)`:"
          },
          {
            "type": "delete",
            "line": "{data}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Begin!"
          },
          {
            "type": "delete",
            "line": "Question: {input}"
          },
          {
            "type": "delete",
            "line": "{agent_scratchpad}\"\"\""
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/agents/load_tools.py",
        "changes": [
          {
            "type": "context",
            "line": "index 85e690b621..a4be206bd5 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/agents/load_tools.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/agents/load_tools.py"
          },
          {
            "type": "context",
            "line": " from langchain.tools.searchapi.tool import SearchAPIResults, SearchAPIRun"
          },
          {
            "type": "context",
            "line": " from langchain.tools.graphql.tool import BaseGraphQLTool"
          },
          {
            "type": "context",
            "line": " from langchain.tools.human.tool import HumanInputRun"
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import PythonREPLTool"
          },
          {
            "type": "context",
            "line": " from langchain.tools.requests.tool import ("
          },
          {
            "type": "context",
            "line": "     RequestsDeleteTool,"
          },
          {
            "type": "context",
            "line": "     RequestsGetTool,"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _get_python_repl() -> BaseTool:"
          },
          {
            "type": "delete",
            "line": "    return PythonREPLTool()"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This tool has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This tool has access to a python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"For best practices make sure to sandbox this tool. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        \"update relevant imports replacing 'langchain' with 'langchain_experimental'\""
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _get_tools_requests_get() -> BaseTool:"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/tools/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index 4a1415ff66..0b63e6d990 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/tools/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/tools/__init__.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from langchain.tools.base import BaseTool, StructuredTool, Tool, tool"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "# Used for internal purposes"
          },
          {
            "type": "add",
            "line": "_DEPRECATED_TOOLS = {\"PythonAstREPLTool\", \"PythonREPLTool\"}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _import_ainetwork_app() -> Any:"
          },
          {
            "type": "context",
            "line": "     from langchain.tools.ainetwork.app import AINAppOps"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _import_python_tool_PythonAstREPLTool() -> Any:"
          },
          {
            "type": "delete",
            "line": "    from langchain.tools.python.tool import PythonAstREPLTool"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    return PythonAstREPLTool"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This tool has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This tool has access to a python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"For best practices make sure to sandbox this tool. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        \"update relevant imports replacing 'langchain' with 'langchain_experimental'\""
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _import_python_tool_PythonREPLTool() -> Any:"
          },
          {
            "type": "delete",
            "line": "    from langchain.tools.python.tool import PythonREPLTool"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    return PythonREPLTool"
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This tool has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This tool has access to a python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"For best practices make sure to sandbox this tool. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        \"update relevant imports replacing 'langchain' with 'langchain_experimental'\""
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _import_render() -> Any:"
          },
          {
            "type": "context",
            "line": "     \"OpenAPISpec\","
          },
          {
            "type": "context",
            "line": "     \"OpenWeatherMapQueryRun\","
          },
          {
            "type": "context",
            "line": "     \"PubmedQueryRun\","
          },
          {
            "type": "delete",
            "line": "    \"PythonAstREPLTool\","
          },
          {
            "type": "delete",
            "line": "    \"PythonREPLTool\","
          },
          {
            "type": "context",
            "line": "     \"QueryCheckerTool\","
          },
          {
            "type": "context",
            "line": "     \"QueryPowerBITool\","
          },
          {
            "type": "context",
            "line": "     \"QuerySQLCheckerTool\","
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/tools/python/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "index e69de29bb2..278ff9d4e4 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/tools/python/__init__.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/langchain/tools/python/__init__.py"
          },
          {
            "type": "add",
            "line": "def raise_on_import() -> None:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Raise on import letting users know that underlying code is deprecated.\"\"\""
          },
          {
            "type": "add",
            "line": "    raise ImportError("
          },
          {
            "type": "add",
            "line": "        \"This tool has been moved to langchain experiment. \""
          },
          {
            "type": "add",
            "line": "        \"This tool has access to a python REPL. \""
          },
          {
            "type": "add",
            "line": "        \"For best practices make sure to sandbox this tool. \""
          },
          {
            "type": "add",
            "line": "        \"Read https://github.com/langchain-ai/langchain/blob/master/SECURITY.md \""
          },
          {
            "type": "add",
            "line": "        \"To keep using this code as is, install langchain experimental and \""
          },
          {
            "type": "add",
            "line": "        \"update relevant imports replacing 'langchain' with 'langchain_experimental'\""
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "raise_on_import()"
          }
        ]
      },
      {
        "file": "libs/langchain/langchain/tools/python/tool.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index d7d53e6f0b..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/langchain/tools/python/tool.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"A tool for running python code in a REPL.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import ast"
          },
          {
            "type": "delete",
            "line": "import asyncio"
          },
          {
            "type": "delete",
            "line": "import re"
          },
          {
            "type": "delete",
            "line": "import sys"
          },
          {
            "type": "delete",
            "line": "from contextlib import redirect_stdout"
          },
          {
            "type": "delete",
            "line": "from io import StringIO"
          },
          {
            "type": "delete",
            "line": "from typing import Any, Dict, Optional, Type"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain._api import warn_deprecated"
          },
          {
            "type": "delete",
            "line": "from langchain.callbacks.manager import ("
          },
          {
            "type": "delete",
            "line": "    AsyncCallbackManagerForToolRun,"
          },
          {
            "type": "delete",
            "line": "    CallbackManagerForToolRun,"
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "from langchain.pydantic_v1 import BaseModel, Field, root_validator"
          },
          {
            "type": "delete",
            "line": "from langchain.tools.base import BaseTool"
          },
          {
            "type": "delete",
            "line": "from langchain.utilities.python import PythonREPL"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def _get_default_python_repl() -> PythonREPL:"
          },
          {
            "type": "delete",
            "line": "    return PythonREPL(_globals=globals(), _locals=None)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def sanitize_input(query: str) -> str:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Sanitize input to the python REPL."
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    Remove whitespace, backtick & python (if llm mistakes python console as terminal)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    Args:"
          },
          {
            "type": "delete",
            "line": "        query: The query to sanitize"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    Returns:"
          },
          {
            "type": "delete",
            "line": "        str: The sanitized query"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    # Removes `, whitespace & python from start"
          },
          {
            "type": "delete",
            "line": "    query = re.sub(r\"^(\\s|`)*(?i:python)?\\s*\", \"\", query)"
          },
          {
            "type": "delete",
            "line": "    # Removes whitespace & ` from end"
          },
          {
            "type": "delete",
            "line": "    query = re.sub(r\"(\\s|`)*$\", \"\", query)"
          },
          {
            "type": "delete",
            "line": "    return query"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "class PythonREPLTool(BaseTool):"
          },
          {
            "type": "delete",
            "line": "    \"\"\"A tool for running python code in a REPL.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    name: str = \"Python_REPL\""
          },
          {
            "type": "delete",
            "line": "    description: str = ("
          },
          {
            "type": "delete",
            "line": "        \"A Python shell. Use this to execute python commands. \""
          },
          {
            "type": "delete",
            "line": "        \"Input should be a valid python command. \""
          },
          {
            "type": "delete",
            "line": "        \"If you want to see the output of a value, you should print it out \""
          },
          {
            "type": "delete",
            "line": "        \"with `print(...)`.\""
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    python_repl: PythonREPL = Field(default_factory=_get_default_python_repl)"
          },
          {
            "type": "delete",
            "line": "    sanitize_input: bool = True"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def _run("
          },
          {
            "type": "delete",
            "line": "        self,"
          },
          {
            "type": "delete",
            "line": "        query: str,"
          },
          {
            "type": "delete",
            "line": "        run_manager: Optional[CallbackManagerForToolRun] = None,"
          },
          {
            "type": "delete",
            "line": "    ) -> Any:"
          },
          {
            "type": "delete",
            "line": "        \"\"\"Use the tool.\"\"\""
          },
          {
            "type": "delete",
            "line": "        warn_deprecated("
          },
          {
            "type": "delete",
            "line": "            since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "            message=("
          },
          {
            "type": "delete",
            "line": "                \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "                \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "                \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "                \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "            ),"
          },
          {
            "type": "delete",
            "line": "            pending=True,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        if self.sanitize_input:"
          },
          {
            "type": "delete",
            "line": "            query = sanitize_input(query)"
          },
          {
            "type": "delete",
            "line": "        return self.python_repl.run(query)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    async def _arun("
          },
          {
            "type": "delete",
            "line": "        self,"
          },
          {
            "type": "delete",
            "line": "        query: str,"
          },
          {
            "type": "delete",
            "line": "        run_manager: Optional[AsyncCallbackManagerForToolRun] = None,"
          },
          {
            "type": "delete",
            "line": "    ) -> Any:"
          },
          {
            "type": "delete",
            "line": "        \"\"\"Use the tool asynchronously.\"\"\""
          },
          {
            "type": "delete",
            "line": "        warn_deprecated("
          },
          {
            "type": "delete",
            "line": "            since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "            message=("
          },
          {
            "type": "delete",
            "line": "                \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "                \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "                \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "                \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "            ),"
          },
          {
            "type": "delete",
            "line": "            pending=True,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        if self.sanitize_input:"
          },
          {
            "type": "delete",
            "line": "            query = sanitize_input(query)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        loop = asyncio.get_running_loop()"
          },
          {
            "type": "delete",
            "line": "        result = await loop.run_in_executor(None, self.run, query)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return result"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "class PythonInputs(BaseModel):"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Python inputs.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    query: str = Field(description=\"code snippet to run\")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "class PythonAstREPLTool(BaseTool):"
          },
          {
            "type": "delete",
            "line": "    \"\"\"A tool for running python code in a REPL.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    name: str = \"python_repl_ast\""
          },
          {
            "type": "delete",
            "line": "    description: str = ("
          },
          {
            "type": "delete",
            "line": "        \"A Python shell. Use this to execute python commands. \""
          },
          {
            "type": "delete",
            "line": "        \"Input should be a valid python command. \""
          },
          {
            "type": "delete",
            "line": "        \"When using this tool, sometimes output is abbreviated - \""
          },
          {
            "type": "delete",
            "line": "        \"make sure it does not look abbreviated before using it in your answer.\""
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    globals: Optional[Dict] = Field(default_factory=dict)"
          },
          {
            "type": "delete",
            "line": "    locals: Optional[Dict] = Field(default_factory=dict)"
          },
          {
            "type": "delete",
            "line": "    sanitize_input: bool = True"
          },
          {
            "type": "delete",
            "line": "    args_schema: Type[BaseModel] = PythonInputs"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    @root_validator(pre=True)"
          },
          {
            "type": "delete",
            "line": "    def validate_python_version(cls, values: Dict) -> Dict:"
          },
          {
            "type": "delete",
            "line": "        \"\"\"Validate valid python version.\"\"\""
          },
          {
            "type": "delete",
            "line": "        if sys.version_info < (3, 9):"
          },
          {
            "type": "delete",
            "line": "            raise ValueError("
          },
          {
            "type": "delete",
            "line": "                \"This tool relies on Python 3.9 or higher \""
          },
          {
            "type": "delete",
            "line": "                \"(as it uses new functionality in the `ast` module, \""
          },
          {
            "type": "delete",
            "line": "                f\"you have Python version: {sys.version}\""
          },
          {
            "type": "delete",
            "line": "            )"
          },
          {
            "type": "delete",
            "line": "        return values"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    def _run("
          },
          {
            "type": "delete",
            "line": "        self,"
          },
          {
            "type": "delete",
            "line": "        query: str,"
          },
          {
            "type": "delete",
            "line": "        run_manager: Optional[CallbackManagerForToolRun] = None,"
          },
          {
            "type": "delete",
            "line": "    ) -> str:"
          },
          {
            "type": "delete",
            "line": "        \"\"\"Use the tool.\"\"\""
          },
          {
            "type": "delete",
            "line": "        warn_deprecated("
          },
          {
            "type": "delete",
            "line": "            since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "            message=("
          },
          {
            "type": "delete",
            "line": "                \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "                \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "                \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "                \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "            ),"
          },
          {
            "type": "delete",
            "line": "            pending=True,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        try:"
          },
          {
            "type": "delete",
            "line": "            if self.sanitize_input:"
          },
          {
            "type": "delete",
            "line": "                query = sanitize_input(query)"
          },
          {
            "type": "delete",
            "line": "            tree = ast.parse(query)"
          },
          {
            "type": "delete",
            "line": "            module = ast.Module(tree.body[:-1], type_ignores=[])"
          },
          {
            "type": "delete",
            "line": "            exec(ast.unparse(module), self.globals, self.locals)  # type: ignore"
          },
          {
            "type": "delete",
            "line": "            module_end = ast.Module(tree.body[-1:], type_ignores=[])"
          },
          {
            "type": "delete",
            "line": "            module_end_str = ast.unparse(module_end)  # type: ignore"
          },
          {
            "type": "delete",
            "line": "            io_buffer = StringIO()"
          },
          {
            "type": "delete",
            "line": "            try:"
          },
          {
            "type": "delete",
            "line": "                with redirect_stdout(io_buffer):"
          },
          {
            "type": "delete",
            "line": "                    ret = eval(module_end_str, self.globals, self.locals)"
          },
          {
            "type": "delete",
            "line": "                    if ret is None:"
          },
          {
            "type": "delete",
            "line": "                        return io_buffer.getvalue()"
          },
          {
            "type": "delete",
            "line": "                    else:"
          },
          {
            "type": "delete",
            "line": "                        return ret"
          },
          {
            "type": "delete",
            "line": "            except Exception:"
          },
          {
            "type": "delete",
            "line": "                with redirect_stdout(io_buffer):"
          },
          {
            "type": "delete",
            "line": "                    exec(module_end_str, self.globals, self.locals)"
          },
          {
            "type": "delete",
            "line": "                return io_buffer.getvalue()"
          },
          {
            "type": "delete",
            "line": "        except Exception as e:"
          },
          {
            "type": "delete",
            "line": "            return \"{}: {}\".format(type(e).__name__, str(e))"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    async def _arun("
          },
          {
            "type": "delete",
            "line": "        self,"
          },
          {
            "type": "delete",
            "line": "        query: str,"
          },
          {
            "type": "delete",
            "line": "        run_manager: Optional[AsyncCallbackManagerForToolRun] = None,"
          },
          {
            "type": "delete",
            "line": "    ) -> Any:"
          },
          {
            "type": "delete",
            "line": "        \"\"\"Use the tool asynchronously.\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        warn_deprecated("
          },
          {
            "type": "delete",
            "line": "            since=\"0.0.314\","
          },
          {
            "type": "delete",
            "line": "            message=("
          },
          {
            "type": "delete",
            "line": "                \"On 2023-10-27 this module will be be deprecated from langchain, and \""
          },
          {
            "type": "delete",
            "line": "                \"will be available from the langchain-experimental package.\""
          },
          {
            "type": "delete",
            "line": "                \"This code is already available in langchain-experimental.\""
          },
          {
            "type": "delete",
            "line": "                \"See https://github.com/langchain-ai/langchain/discussions/11680.\""
          },
          {
            "type": "delete",
            "line": "            ),"
          },
          {
            "type": "delete",
            "line": "            pending=True,"
          },
          {
            "type": "delete",
            "line": "        )"
          },
          {
            "type": "delete",
            "line": "        loop = asyncio.get_running_loop()"
          },
          {
            "type": "delete",
            "line": "        result = await loop.run_in_executor(None, self._run, query)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        return result"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/integration_tests/agent/test_csv_agent.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 08169edb6e..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/integration_tests/agent/test_csv_agent.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "import io"
          },
          {
            "type": "delete",
            "line": "import re"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import numpy as np"
          },
          {
            "type": "delete",
            "line": "import pytest"
          },
          {
            "type": "delete",
            "line": "from _pytest.tmpdir import TempPathFactory"
          },
          {
            "type": "delete",
            "line": "from pandas import DataFrame"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain.agents import create_csv_agent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor"
          },
          {
            "type": "delete",
            "line": "from langchain.llms import OpenAI"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.fixture(scope=\"module\")"
          },
          {
            "type": "delete",
            "line": "def csv(tmp_path_factory: TempPathFactory) -> DataFrame:"
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(4, 4)"
          },
          {
            "type": "delete",
            "line": "    df = DataFrame(random_data, columns=[\"name\", \"age\", \"food\", \"sport\"])"
          },
          {
            "type": "delete",
            "line": "    filename = str(tmp_path_factory.mktemp(\"data\") / \"test.csv\")"
          },
          {
            "type": "delete",
            "line": "    df.to_csv(filename)"
          },
          {
            "type": "delete",
            "line": "    return filename"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.fixture(scope=\"module\")"
          },
          {
            "type": "delete",
            "line": "def csv_list(tmp_path_factory: TempPathFactory) -> DataFrame:"
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(4, 4)"
          },
          {
            "type": "delete",
            "line": "    df1 = DataFrame(random_data, columns=[\"name\", \"age\", \"food\", \"sport\"])"
          },
          {
            "type": "delete",
            "line": "    filename1 = str(tmp_path_factory.mktemp(\"data\") / \"test1.csv\")"
          },
          {
            "type": "delete",
            "line": "    df1.to_csv(filename1)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(2, 2)"
          },
          {
            "type": "delete",
            "line": "    df2 = DataFrame(random_data, columns=[\"name\", \"height\"])"
          },
          {
            "type": "delete",
            "line": "    filename2 = str(tmp_path_factory.mktemp(\"data\") / \"test2.csv\")"
          },
          {
            "type": "delete",
            "line": "    df2.to_csv(filename2)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    return [filename1, filename2]"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.fixture(scope=\"module\")"
          },
          {
            "type": "delete",
            "line": "def csv_file_like(tmp_path_factory: TempPathFactory) -> io.BytesIO:"
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(4, 4)"
          },
          {
            "type": "delete",
            "line": "    df = DataFrame(random_data, columns=[\"name\", \"age\", \"food\", \"sport\"])"
          },
          {
            "type": "delete",
            "line": "    buffer = io.BytesIO()"
          },
          {
            "type": "delete",
            "line": "    df.to_pickle(buffer)"
          },
          {
            "type": "delete",
            "line": "    return buffer"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_csv_agent_creation(csv: str) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_csv_agent(OpenAI(temperature=0), csv)"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_single_csv(csv: str) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_csv_agent(OpenAI(temperature=0), csv)"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"How many rows in the csv? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(r\".*(4).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_multi_csv(csv_list: list) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_csv_agent(OpenAI(temperature=0), csv_list, verbose=True)"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"How many combined rows in the two csvs? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(r\".*(6).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_file_like(file_like: io.BytesIO) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_csv_agent(OpenAI(temperature=0), file_like, verbose=True)"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"How many rows in the csv? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(r\".*(4).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/integration_tests/agent/test_pandas_agent.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 5ddc84c675..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/integration_tests/agent/test_pandas_agent.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "import re"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import numpy as np"
          },
          {
            "type": "delete",
            "line": "import pytest"
          },
          {
            "type": "delete",
            "line": "from pandas import DataFrame"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain.agents import create_pandas_dataframe_agent"
          },
          {
            "type": "delete",
            "line": "from langchain.agents.agent import AgentExecutor"
          },
          {
            "type": "delete",
            "line": "from langchain.llms import OpenAI"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.fixture(scope=\"module\")"
          },
          {
            "type": "delete",
            "line": "def df() -> DataFrame:"
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(4, 4)"
          },
          {
            "type": "delete",
            "line": "    df = DataFrame(random_data, columns=[\"name\", \"age\", \"food\", \"sport\"])"
          },
          {
            "type": "delete",
            "line": "    return df"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "# Figure out type hint here"
          },
          {
            "type": "delete",
            "line": "@pytest.fixture(scope=\"module\")"
          },
          {
            "type": "delete",
            "line": "def df_list() -> list:"
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(4, 4)"
          },
          {
            "type": "delete",
            "line": "    df1 = DataFrame(random_data, columns=[\"name\", \"age\", \"food\", \"sport\"])"
          },
          {
            "type": "delete",
            "line": "    random_data = np.random.rand(2, 2)"
          },
          {
            "type": "delete",
            "line": "    df2 = DataFrame(random_data, columns=[\"name\", \"height\"])"
          },
          {
            "type": "delete",
            "line": "    df_list = [df1, df2]"
          },
          {
            "type": "delete",
            "line": "    return df_list"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_pandas_agent_creation(df: DataFrame) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_pandas_dataframe_agent(OpenAI(temperature=0), df)"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_data_reading(df: DataFrame) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_pandas_dataframe_agent(OpenAI(temperature=0), df)"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"how many rows in df? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(rf\".*({df.shape[0]}).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_data_reading_no_df_in_prompt(df: DataFrame) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_pandas_dataframe_agent("
          },
          {
            "type": "delete",
            "line": "        OpenAI(temperature=0), df, include_df_in_prompt=False"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    assert isinstance(agent, AgentExecutor)"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"how many rows in df? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(rf\".*({df.shape[0]}).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_multi_df(df_list: list) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_pandas_dataframe_agent(OpenAI(temperature=0), df_list, verbose=True)"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"how many total rows in the two dataframes? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(r\".*(6).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_multi_df_no_df_in_prompt(df_list: list) -> None:"
          },
          {
            "type": "delete",
            "line": "    agent = create_pandas_dataframe_agent("
          },
          {
            "type": "delete",
            "line": "        OpenAI(temperature=0), df_list, include_df_in_prompt=False"
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    response = agent.run(\"how many total rows in the two dataframes? Give me a number.\")"
          },
          {
            "type": "delete",
            "line": "    result = re.search(r\".*(6).*\", response)"
          },
          {
            "type": "delete",
            "line": "    assert result is not None"
          },
          {
            "type": "delete",
            "line": "    assert result.group(1) is not None"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/_api/test_path.py",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 0000000000..73da680eab"
          },
          {
            "type": "context",
            "line": "--- /dev/null"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/_api/test_path.py"
          },
          {
            "type": "add",
            "line": "from pathlib import Path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "from langchain._api import path"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "HERE = Path(__file__).parent"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "ROOT = HERE.parent.parent.parent"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def test_as_import_path() -> None:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Test that the path is converted to a LangChain import path.\"\"\""
          },
          {
            "type": "add",
            "line": "    # Verify that default paths are correct"
          },
          {
            "type": "add",
            "line": "    assert path.PACKAGE_DIR == ROOT / \"langchain\""
          },
          {
            "type": "add",
            "line": "    # Verify that as import path works correctly"
          },
          {
            "type": "add",
            "line": "    assert path.as_import_path(HERE, relative_to=ROOT) == \"tests.unit_tests._api\""
          },
          {
            "type": "add",
            "line": "    assert ("
          },
          {
            "type": "add",
            "line": "        path.as_import_path(__file__, relative_to=ROOT)"
          },
          {
            "type": "add",
            "line": "        == \"tests.unit_tests._api.test_path\""
          },
          {
            "type": "add",
            "line": "    )"
          },
          {
            "type": "add",
            "line": "    assert ("
          },
          {
            "type": "add",
            "line": "        path.as_import_path(__file__, suffix=\"create_agent\", relative_to=ROOT)"
          },
          {
            "type": "add",
            "line": "        == \"tests.unit_tests._api.test_path.create_agent\""
          },
          {
            "type": "add",
            "line": "    )"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/agents/test_public_api.py",
        "changes": [
          {
            "type": "context",
            "line": "index 2e23fa5478..770e66cbbc 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/unit_tests/agents/test_public_api.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/agents/test_public_api.py"
          },
          {
            "type": "context",
            "line": "     \"Tool\","
          },
          {
            "type": "context",
            "line": "     \"XMLAgent\","
          },
          {
            "type": "context",
            "line": "     \"ZeroShotAgent\","
          },
          {
            "type": "delete",
            "line": "    \"create_csv_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_json_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_openapi_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_pandas_dataframe_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_pbi_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_pbi_chat_agent\","
          },
          {
            "type": "delete",
            "line": "    \"create_spark_dataframe_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_spark_sql_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_sql_agent\","
          },
          {
            "type": "context",
            "line": "     \"create_vectorstore_agent\","
          },
          {
            "type": "context",
            "line": "     \"load_huggingface_tool\","
          },
          {
            "type": "context",
            "line": "     \"load_tools\","
          },
          {
            "type": "context",
            "line": "     \"tool\","
          },
          {
            "type": "delete",
            "line": "    \"create_xorbits_agent\","
          },
          {
            "type": "context",
            "line": " ]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/test_python.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index 33bf70e961..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/unit_tests/test_python.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"Test functionality of Python REPL.\"\"\""
          },
          {
            "type": "delete",
            "line": "import sys"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import pytest"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import PythonAstREPLTool, PythonREPLTool"
          },
          {
            "type": "delete",
            "line": "from langchain.utilities import PythonREPL"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "_SAMPLE_CODE = \"\"\""
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "def multiply():"
          },
          {
            "type": "delete",
            "line": "    print(5*6)"
          },
          {
            "type": "delete",
            "line": "multiply()"
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "_AST_SAMPLE_CODE = \"\"\""
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "def multiply():"
          },
          {
            "type": "delete",
            "line": "    return(5*6)"
          },
          {
            "type": "delete",
            "line": "multiply()"
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "_AST_SAMPLE_CODE_EXECUTE = \"\"\""
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "def multiply(a, b):"
          },
          {
            "type": "delete",
            "line": "    return(5*6)"
          },
          {
            "type": "delete",
            "line": "a = 5"
          },
          {
            "type": "delete",
            "line": "b = 6"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "multiply(a, b)"
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_repl() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test functionality when globals/locals are not provided.\"\"\""
          },
          {
            "type": "delete",
            "line": "    repl = PythonREPL()"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    # Run a simple initial command."
          },
          {
            "type": "delete",
            "line": "    repl.run(\"foo = 1\")"
          },
          {
            "type": "delete",
            "line": "    assert repl.locals is not None"
          },
          {
            "type": "delete",
            "line": "    assert repl.locals[\"foo\"] == 1"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    # Now run a command that accesses `foo` to make sure it still has it."
          },
          {
            "type": "delete",
            "line": "    repl.run(\"bar = foo * 2\")"
          },
          {
            "type": "delete",
            "line": "    assert repl.locals is not None"
          },
          {
            "type": "delete",
            "line": "    assert repl.locals[\"bar\"] == 2"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_repl_no_previous_variables() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test that it does not have access to variables created outside the scope.\"\"\""
          },
          {
            "type": "delete",
            "line": "    foo = 3  # noqa: F841"
          },
          {
            "type": "delete",
            "line": "    repl = PythonREPL()"
          },
          {
            "type": "delete",
            "line": "    output = repl.run(\"print(foo)\")"
          },
          {
            "type": "delete",
            "line": "    assert output == \"\"\"NameError(\"name 'foo' is not defined\")\"\"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_repl_pass_in_locals() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test functionality when passing in locals.\"\"\""
          },
          {
            "type": "delete",
            "line": "    _locals = {\"foo\": 4}"
          },
          {
            "type": "delete",
            "line": "    repl = PythonREPL(_locals=_locals)"
          },
          {
            "type": "delete",
            "line": "    repl.run(\"bar = foo * 2\")"
          },
          {
            "type": "delete",
            "line": "    assert repl.locals is not None"
          },
          {
            "type": "delete",
            "line": "    assert repl.locals[\"bar\"] == 8"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_functionality() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test correct functionality.\"\"\""
          },
          {
            "type": "delete",
            "line": "    chain = PythonREPL()"
          },
          {
            "type": "delete",
            "line": "    code = \"print(1 + 1)\""
          },
          {
            "type": "delete",
            "line": "    output = chain.run(code)"
          },
          {
            "type": "delete",
            "line": "    assert output == \"2\\n\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_functionality_multiline() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test correct functionality for ChatGPT multiline commands.\"\"\""
          },
          {
            "type": "delete",
            "line": "    chain = PythonREPL()"
          },
          {
            "type": "delete",
            "line": "    tool = PythonREPLTool(python_repl=chain)"
          },
          {
            "type": "delete",
            "line": "    output = tool.run(_SAMPLE_CODE)"
          },
          {
            "type": "delete",
            "line": "    assert output == \"30\\n\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_multiline() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test correct functionality for ChatGPT multiline commands.\"\"\""
          },
          {
            "type": "delete",
            "line": "    if sys.version_info < (3, 9):"
          },
          {
            "type": "delete",
            "line": "        pytest.skip(\"Python 3.9+ is required for this test\")"
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    output = tool.run(_AST_SAMPLE_CODE)"
          },
          {
            "type": "delete",
            "line": "    assert output == 30"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_multi_statement() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test correct functionality for ChatGPT multi statement commands.\"\"\""
          },
          {
            "type": "delete",
            "line": "    if sys.version_info < (3, 9):"
          },
          {
            "type": "delete",
            "line": "        pytest.skip(\"Python 3.9+ is required for this test\")"
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    output = tool.run(_AST_SAMPLE_CODE_EXECUTE)"
          },
          {
            "type": "delete",
            "line": "    assert output == 30"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_function() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test correct functionality.\"\"\""
          },
          {
            "type": "delete",
            "line": "    chain = PythonREPL()"
          },
          {
            "type": "delete",
            "line": "    code = \"def add(a, b): \" \"    return a + b\""
          },
          {
            "type": "delete",
            "line": "    output = chain.run(code)"
          },
          {
            "type": "delete",
            "line": "    assert output == \"\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    code = \"print(add(1, 2))\""
          },
          {
            "type": "delete",
            "line": "    output = chain.run(code)"
          },
          {
            "type": "delete",
            "line": "    assert output == \"3\\n\""
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/tools/python/__init__.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index e69de29bb2..0000000000"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/tools/python/test_python.py",
        "changes": [
          {
            "type": "context",
            "line": "deleted file mode 100644"
          },
          {
            "type": "context",
            "line": "index c46f168fca..0000000000"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/unit_tests/tools/python/test_python.py"
          },
          {
            "type": "context",
            "line": "+++ /dev/null"
          },
          {
            "type": "delete",
            "line": "\"\"\"Test Python REPL Tools.\"\"\""
          },
          {
            "type": "delete",
            "line": "import sys"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "import numpy as np"
          },
          {
            "type": "delete",
            "line": "import pytest"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from langchain.tools.python.tool import ("
          },
          {
            "type": "delete",
            "line": "    PythonAstREPLTool,"
          },
          {
            "type": "delete",
            "line": "    PythonREPLTool,"
          },
          {
            "type": "delete",
            "line": "    sanitize_input,"
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_repl_tool_single_input() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test that the python REPL tool works with a single input.\"\"\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.is_single_input"
          },
          {
            "type": "delete",
            "line": "    assert int(tool.run(\"print(1 + 1)\").strip()) == 2"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_python_repl_print() -> None:"
          },
          {
            "type": "delete",
            "line": "    program = \"\"\""
          },
          {
            "type": "delete",
            "line": "import numpy as np"
          },
          {
            "type": "delete",
            "line": "v1 = np.array([1, 2, 3])"
          },
          {
            "type": "delete",
            "line": "v2 = np.array([4, 5, 6])"
          },
          {
            "type": "delete",
            "line": "dot_product = np.dot(v1, v2)"
          },
          {
            "type": "delete",
            "line": "print(\"The dot product is {:d}.\".format(dot_product))"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == \"The dot product is 32.\\n\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_tool_single_input() -> None:"
          },
          {
            "type": "delete",
            "line": "    \"\"\"Test that the python REPL tool works with a single input.\"\"\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.is_single_input"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(\"1 + 1\") == 2"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_return() -> None:"
          },
          {
            "type": "delete",
            "line": "    program = \"\"\""
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "import numpy as np"
          },
          {
            "type": "delete",
            "line": "v1 = np.array([1, 2, 3])"
          },
          {
            "type": "delete",
            "line": "v2 = np.array([4, 5, 6])"
          },
          {
            "type": "delete",
            "line": "dot_product = np.dot(v1, v2)"
          },
          {
            "type": "delete",
            "line": "int(dot_product)"
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == 32"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    program = \"\"\""
          },
          {
            "type": "delete",
            "line": "```python"
          },
          {
            "type": "delete",
            "line": "import numpy as np"
          },
          {
            "type": "delete",
            "line": "v1 = np.array([1, 2, 3])"
          },
          {
            "type": "delete",
            "line": "v2 = np.array([4, 5, 6])"
          },
          {
            "type": "delete",
            "line": "dot_product = np.dot(v1, v2)"
          },
          {
            "type": "delete",
            "line": "int(dot_product)"
          },
          {
            "type": "delete",
            "line": "```"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == 32"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_print() -> None:"
          },
          {
            "type": "delete",
            "line": "    program = \"\"\"python"
          },
          {
            "type": "delete",
            "line": "string = \"racecar\""
          },
          {
            "type": "delete",
            "line": "if string == string[::-1]:"
          },
          {
            "type": "delete",
            "line": "    print(string, \"is a palindrome\")"
          },
          {
            "type": "delete",
            "line": "else:"
          },
          {
            "type": "delete",
            "line": "    print(string, \"is not a palindrome\")\"\"\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == \"racecar is a palindrome\\n\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_repl_print_python_backticks() -> None:"
          },
          {
            "type": "delete",
            "line": "    program = \"`print('`python` is a great language.')`\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == \"`python` is a great language.\\n\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_raise_exception() -> None:"
          },
          {
            "type": "delete",
            "line": "    data = {\"Name\": [\"John\", \"Alice\"], \"Age\": [30, 25]}"
          },
          {
            "type": "delete",
            "line": "    program = \"\"\""
          },
          {
            "type": "delete",
            "line": "import pandas as pd"
          },
          {
            "type": "delete",
            "line": "df = pd.DataFrame(data)"
          },
          {
            "type": "delete",
            "line": "df['Gender']"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool(locals={\"data\": data})"
          },
          {
            "type": "delete",
            "line": "    expected_outputs = ("
          },
          {
            "type": "delete",
            "line": "        \"KeyError: 'Gender'\","
          },
          {
            "type": "delete",
            "line": "        \"ModuleNotFoundError: No module named 'pandas'\","
          },
          {
            "type": "delete",
            "line": "    )"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) in expected_outputs"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_one_line_print() -> None:"
          },
          {
            "type": "delete",
            "line": "    program = 'print(\"The square of {} is {:.2f}\".format(3, 3**2))'"
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == \"The square of 3 is 9.00\\n\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_one_line_return() -> None:"
          },
          {
            "type": "delete",
            "line": "    arr = np.array([1, 2, 3, 4, 5])"
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool(locals={\"arr\": arr})"
          },
          {
            "type": "delete",
            "line": "    program = \"`(arr**2).sum()   # Returns sum of squares`\""
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == 55"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "@pytest.mark.skipif("
          },
          {
            "type": "delete",
            "line": "    sys.version_info < (3, 9), reason=\"Requires python version >= 3.9 to run.\""
          },
          {
            "type": "delete",
            "line": ")"
          },
          {
            "type": "delete",
            "line": "def test_python_ast_repl_one_line_exception() -> None:"
          },
          {
            "type": "delete",
            "line": "    program = \"[1, 2, 3][4]\""
          },
          {
            "type": "delete",
            "line": "    tool = PythonAstREPLTool()"
          },
          {
            "type": "delete",
            "line": "    assert tool.run(program) == \"IndexError: list index out of range\""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def test_sanitize_input() -> None:"
          },
          {
            "type": "delete",
            "line": "    query = \"\"\""
          },
          {
            "type": "delete",
            "line": "    ```"
          },
          {
            "type": "delete",
            "line": "        p = 5"
          },
          {
            "type": "delete",
            "line": "    ```"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    expected = \"p = 5\""
          },
          {
            "type": "delete",
            "line": "    actual = sanitize_input(query)"
          },
          {
            "type": "delete",
            "line": "    assert expected == actual"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    query = \"\"\""
          },
          {
            "type": "delete",
            "line": "       ```python"
          },
          {
            "type": "delete",
            "line": "        p = 5"
          },
          {
            "type": "delete",
            "line": "    ```"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    expected = \"p = 5\""
          },
          {
            "type": "delete",
            "line": "    actual = sanitize_input(query)"
          },
          {
            "type": "delete",
            "line": "    assert expected == actual"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    query = \"\"\""
          },
          {
            "type": "delete",
            "line": "    p = 5"
          },
          {
            "type": "delete",
            "line": "    \"\"\""
          },
          {
            "type": "delete",
            "line": "    expected = \"p = 5\""
          },
          {
            "type": "delete",
            "line": "    actual = sanitize_input(query)"
          },
          {
            "type": "delete",
            "line": "    assert expected == actual"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/tools/test_exported.py",
        "changes": [
          {
            "type": "context",
            "line": "index 90cb42845e..1e6c0f1953 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/unit_tests/tools/test_exported.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/tools/test_exported.py"
          },
          {
            "type": "context",
            "line": " from typing import List, Type"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import langchain.tools"
          },
          {
            "type": "add",
            "line": "from langchain.tools import _DEPRECATED_TOOLS"
          },
          {
            "type": "context",
            "line": " from langchain.tools import __all__ as tools_all"
          },
          {
            "type": "context",
            "line": " from langchain.tools.base import BaseTool, StructuredTool"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def _get_tool_classes(skip_tools_without_default_names: bool) -> List[Type[BaseTool]]:"
          },
          {
            "type": "context",
            "line": "     results = []"
          },
          {
            "type": "context",
            "line": "     for tool_class_name in tools_all:"
          },
          {
            "type": "add",
            "line": "        if tool_class_name in _DEPRECATED_TOOLS:"
          },
          {
            "type": "add",
            "line": "            continue"
          },
          {
            "type": "context",
            "line": "         # Resolve the str to the class"
          },
          {
            "type": "context",
            "line": "         tool_class = getattr(langchain.tools, tool_class_name)"
          },
          {
            "type": "context",
            "line": "         if isinstance(tool_class, type) and issubclass(tool_class, BaseTool):"
          }
        ]
      },
      {
        "file": "libs/langchain/tests/unit_tests/tools/test_public_api.py",
        "changes": [
          {
            "type": "context",
            "line": "index 44ae3e061e..f5b6c329da 100644"
          },
          {
            "type": "context",
            "line": "--- a/libs/langchain/tests/unit_tests/tools/test_public_api.py"
          },
          {
            "type": "context",
            "line": "+++ b/libs/langchain/tests/unit_tests/tools/test_public_api.py"
          },
          {
            "type": "context",
            "line": "     \"OpenAPISpec\","
          },
          {
            "type": "context",
            "line": "     \"OpenWeatherMapQueryRun\","
          },
          {
            "type": "context",
            "line": "     \"PubmedQueryRun\","
          },
          {
            "type": "delete",
            "line": "    \"PythonAstREPLTool\","
          },
          {
            "type": "delete",
            "line": "    \"PythonREPLTool\","
          },
          {
            "type": "context",
            "line": "     \"QueryCheckerTool\","
          },
          {
            "type": "context",
            "line": "     \"QueryPowerBITool\","
          },
          {
            "type": "context",
            "line": "     \"QuerySQLCheckerTool\","
          }
        ]
      }
    ]
  },
  {
    "commit": "cf03f67621b7bb20e2c768bc62b30e976206aa17",
    "files": [
      {
        "file": "plugins/plugins-available/panorama/liThruk/Controller/panorama.pm",
        "changes": [
          {
            "type": "context",
            "line": "index b921703f4..38991f7c8 100644"
          },
          {
            "type": "context",
            "line": "--- a/plugins/plugins-available/panorama/lib/Thruk/Controller/panorama.pm"
          },
          {
            "type": "context",
            "line": "+++ b/plugins/plugins-available/panorama/lib/Thruk/Controller/panorama.pm"
          },
          {
            "type": "context",
            "line": " use strict;"
          },
          {
            "type": "context",
            "line": " use Carp qw/confess/;"
          },
          {
            "type": "context",
            "line": " use Cpanel::JSON::XS qw/decode_json/;"
          },
          {
            "type": "add",
            "line": "use Cwd qw/abs_path/;"
          },
          {
            "type": "context",
            "line": " use Data::Dumper qw/Dumper/;"
          },
          {
            "type": "context",
            "line": " use Encode qw(encode_utf8);"
          },
          {
            "type": "context",
            "line": " use File::Copy qw/move copy/;"
          },
          {
            "type": "context",
            "line": "     my $upload = $c->req->uploads->{$type};"
          },
          {
            "type": "context",
            "line": "     my $folder = $c->stash->{'usercontent_folder'}.'/'.$location;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # make sure folder is a subfolder of the usercontent folder"
          },
          {
            "type": "add",
            "line": "    my $abs_user   = abs_path($c->stash->{'usercontent_folder'});"
          },
          {
            "type": "add",
            "line": "    my $abs_target = abs_path($folder);"
          },
          {
            "type": "add",
            "line": "    if($abs_target !~ m/^\\Q$abs_user\\E/mx) {"
          },
          {
            "type": "add",
            "line": "        $c->stash->{text} = Thruk::Utils::Filter::json_encode({ 'msg' => 'Fileupload must be a subfolder of the user content folder.', success => Cpanel::JSON::XS::false });"
          },
          {
            "type": "add",
            "line": "        return;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if(!-w $folder.'/.') {"
          },
          {
            "type": "context",
            "line": "         # must be text/html result, otherwise extjs form result handler dies"
          },
          {
            "type": "context",
            "line": "         $c->stash->{text} = Thruk::Utils::Filter::json_encode({ 'msg' => 'Fileupload must use existing and writable folder.', success => Cpanel::JSON::XS::false });"
          }
        ]
      }
    ]
  },
  {
    "commit": "d47f157e83b0c353bb2b697f911882c71cf90ca0",
    "files": [
      {
        "file": "nautobot/core/settings.py",
        "changes": [
          {
            "type": "context",
            "line": "index 944e11172..a5b84fdcb 100644"
          },
          {
            "type": "context",
            "line": "--- a/nautobot/core/settings.py"
          },
          {
            "type": "context",
            "line": "+++ b/nautobot/core/settings.py"
          },
          {
            "type": "context",
            "line": "                 \"nautobot.core.context_processors.settings\","
          },
          {
            "type": "context",
            "line": "                 \"nautobot.core.context_processors.sso_auth\","
          },
          {
            "type": "context",
            "line": "             ],"
          },
          {
            "type": "add",
            "line": "            \"environment\": \"jinja2.sandbox.SandboxedEnvironment\","
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "context",
            "line": "     },"
          },
          {
            "type": "context",
            "line": " ]"
          }
        ]
      },
      {
        "file": "nautobot/docs/models/dcim/deviceredundancygroup.md",
        "changes": [
          {
            "type": "context",
            "line": "index 240bb3ffd..a90e68108 100644"
          },
          {
            "type": "context",
            "line": "--- a/nautobot/docs/models/dcim/deviceredundancygroup.md"
          },
          {
            "type": "context",
            "line": "+++ b/nautobot/docs/models/dcim/deviceredundancygroup.md"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ```python"
          },
          {
            "type": "context",
            "line": " # Configuration Template for Cisco ASA"
          },
          {
            "type": "delete",
            "line": "template_body=\"\"\""
          },
          {
            "type": "add",
            "line": "template_code = \"\"\""
          },
          {
            "type": "context",
            "line": " {% set redundancy_members = gql_data['data']['devices'][0]['device_redundancy_group']['members'] %}"
          },
          {
            "type": "context",
            "line": " {% set failover_device_local = redundancy_members[0] if redundancy_members[0].name == device else redundancy_members[1] %}"
          },
          {
            "type": "context",
            "line": " {% set failover_device_peer = redundancy_members[0] if redundancy_members[0].name != device else redundancy_members[1] %}"
          },
          {
            "type": "context",
            "line": " Following snippet represents an example Cisco ASA Failover rendered configuration:"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " ```python"
          },
          {
            "type": "delete",
            "line": "from jinja2 import Template"
          },
          {
            "type": "add",
            "line": "from nautobot.utilities.utils import render_jinja2"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "tm=Template(template_body)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "nyc_fw_primary_config = tm.render("
          },
          {
            "type": "add",
            "line": "context = dict("
          },
          {
            "type": "context",
            "line": "     device=hostname,"
          },
          {
            "type": "context",
            "line": "     gql_data=gql_data,"
          },
          {
            "type": "context",
            "line": "     priority_mapping={50: 'secondary', 100: 'primary'}"
          },
          {
            "type": "context",
            "line": " )"
          },
          {
            "type": "add",
            "line": "nyc_fw_primary_config = render_jinja2(template_code=template_code, context=context)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " print(nyc_fw_primary_config)"
          },
          {
            "type": "context",
            "line": " ```"
          }
        ]
      },
      {
        "file": "nautobot/utilities/tests/test_jinja_filters.py",
        "changes": [
          {
            "type": "context",
            "line": "index cdb1a89f3..1d6218b4b 100644"
          },
          {
            "type": "context",
            "line": "--- a/nautobot/utilities/tests/test_jinja_filters.py"
          },
          {
            "type": "context",
            "line": "+++ b/nautobot/utilities/tests/test_jinja_filters.py"
          },
          {
            "type": "context",
            "line": " from django.test import TestCase"
          },
          {
            "type": "delete",
            "line": "from jinja2.exceptions import TemplateAssertionError"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": "from jinja2.exceptions import SecurityError, TemplateAssertionError"
          },
          {
            "type": "context",
            "line": " from netutils.utils import jinja2_convenience_function"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from nautobot.utilities.utils import render_jinja2"
          },
          {
            "type": "add",
            "line": "from nautobot.dcim.models import Site"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class NautobotJinjaFilterTest(TestCase):"
          },
          {
            "type": "context",
            "line": "                 raise"
          },
          {
            "type": "context",
            "line": "             except Exception:"
          },
          {
            "type": "context",
            "line": "                 pass"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_sandboxed_render(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\"Assert that Jinja template rendering is sandboxed.\"\"\""
          },
          {
            "type": "add",
            "line": "        template_code = \"{{ ''.__class__.__name__ }}\""
          },
          {
            "type": "add",
            "line": "        with self.assertRaises(SecurityError):"
          },
          {
            "type": "add",
            "line": "            render_jinja2(template_code=template_code, context={})"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def test_safe_render(self):"
          },
          {
            "type": "add",
            "line": "        \"\"\"Assert that safe Jinja rendering still works.\"\"\""
          },
          {
            "type": "add",
            "line": "        site = Site.objects.filter(region__isnull=False).first()"
          },
          {
            "type": "add",
            "line": "        template_code = \"{{ obj.region.name }}\""
          },
          {
            "type": "add",
            "line": "        try:"
          },
          {
            "type": "add",
            "line": "            value = render_jinja2(template_code=template_code, context={\"obj\": site})"
          },
          {
            "type": "add",
            "line": "        except SecurityError:"
          },
          {
            "type": "add",
            "line": "            self.fail(\"SecurityError raised on safe Jinja template render\")"
          },
          {
            "type": "add",
            "line": "        else:"
          },
          {
            "type": "add",
            "line": "            self.assertEqual(value, site.region.name)"
          }
        ]
      }
    ]
  },
  {
    "commit": "dc3dfbf31495fe316b21ee184b9317b38101d30e",
    "files": [
      {
        "file": "server/endpoints/admin.js",
        "changes": [
          {
            "type": "context",
            "line": "index e7201100..0f3e0c55 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/admin.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/admin.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": " const { ApiKey } = require(\"../models/apiKeys\");"
          },
          {
            "type": "context",
            "line": " const { Document } = require(\"../models/documents\");"
          },
          {
            "type": "context",
            "line": " const { Invite } = require(\"../models/invite\");"
          },
          {
            "type": "context",
            "line": "         const { workspaceId } = request.params;"
          },
          {
            "type": "context",
            "line": "         const { userIds } = reqBody(request);"
          },
          {
            "type": "context",
            "line": "         const { success, error } = await Workspace.updateUsers("
          },
          {
            "type": "delete",
            "line": "          workspaceId,"
          },
          {
            "type": "add",
            "line": "          escape(Number(workspaceId)),"
          },
          {
            "type": "context",
            "line": "           userIds"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ success, error });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         const { id } = request.params;"
          },
          {
            "type": "context",
            "line": "         const VectorDb = getVectorDbClass();"
          },
          {
            "type": "delete",
            "line": "        const workspace = Workspace.get(`id = ${id}`);"
          },
          {
            "type": "add",
            "line": "        const workspace = Workspace.get(`id = ${escape(id)}`);"
          },
          {
            "type": "context",
            "line": "         if (!workspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(404).end();"
          },
          {
            "type": "context",
            "line": "           return;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        await Workspace.delete(`id = ${id}`);"
          },
          {
            "type": "delete",
            "line": "        await DocumentVectors.deleteForWorkspace(id);"
          },
          {
            "type": "delete",
            "line": "        await Document.delete(`workspaceId = ${Number(id)}`);"
          },
          {
            "type": "delete",
            "line": "        await WorkspaceChats.delete(`workspaceId = ${Number(id)}`);"
          },
          {
            "type": "add",
            "line": "        await Workspace.delete(`id = ${workspace.id}`);"
          },
          {
            "type": "add",
            "line": "        await DocumentVectors.deleteForWorkspace(workspace.id);"
          },
          {
            "type": "add",
            "line": "        await Document.delete(`workspaceId = ${Number(workspace.id)}`);"
          },
          {
            "type": "add",
            "line": "        await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "         try {"
          },
          {
            "type": "context",
            "line": "           await VectorDb[\"delete-namespace\"]({ namespace: workspace.slug });"
          },
          {
            "type": "context",
            "line": "         } catch (e) {"
          },
          {
            "type": "context",
            "line": "           return;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         const { offset = 0 } = reqBody(request);"
          },
          {
            "type": "delete",
            "line": "        const chats = await WorkspaceChats.whereWithData(`id >= ${offset}`, 20);"
          },
          {
            "type": "add",
            "line": "        const chats = await WorkspaceChats.whereWithData("
          },
          {
            "type": "add",
            "line": "          `id >= ${escape(offset)}`,"
          },
          {
            "type": "add",
            "line": "          20"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "context",
            "line": "         const hasPages = (await WorkspaceChats.count()) > 20;"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ chats: chats.reverse(), hasPages });"
          },
          {
            "type": "context",
            "line": "       } catch (e) {"
          }
        ]
      },
      {
        "file": "server/endpoints/api/admin/index.js",
        "changes": [
          {
            "type": "context",
            "line": "index bc39e24e..73d9efe6 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/api/admin/index.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/api/admin/index.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": " const { Invite } = require(\"../../../models/invite\");"
          },
          {
            "type": "context",
            "line": " const { SystemSettings } = require(\"../../../models/systemSettings\");"
          },
          {
            "type": "context",
            "line": " const { User } = require(\"../../../models/user\");"
          },
          {
            "type": "context",
            "line": "         const { workspaceId } = request.params;"
          },
          {
            "type": "context",
            "line": "         const { userIds } = reqBody(request);"
          },
          {
            "type": "context",
            "line": "         const { success, error } = await Workspace.updateUsers("
          },
          {
            "type": "delete",
            "line": "          workspaceId,"
          },
          {
            "type": "add",
            "line": "          escape(Number(workspaceId)),"
          },
          {
            "type": "context",
            "line": "           userIds"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ success, error });"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         const { offset = 0 } = reqBody(request);"
          },
          {
            "type": "delete",
            "line": "        const chats = await WorkspaceChats.whereWithData(`id >= ${offset}`, 20);"
          },
          {
            "type": "add",
            "line": "        const chats = await WorkspaceChats.whereWithData("
          },
          {
            "type": "add",
            "line": "          `id >= ${escape(offset)}`,"
          },
          {
            "type": "add",
            "line": "          20"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "context",
            "line": "         const hasPages = (await WorkspaceChats.count()) > 20;"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ chats: chats.reverse(), hasPages });"
          },
          {
            "type": "context",
            "line": "       } catch (e) {"
          }
        ]
      },
      {
        "file": "server/endpoints/api/workspace/index.js",
        "changes": [
          {
            "type": "context",
            "line": "index 35a16edc..f117c5f7 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/api/workspace/index.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/api/workspace/index.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": " const { Document } = require(\"../../../models/documents\");"
          },
          {
            "type": "context",
            "line": " const { Telemetry } = require(\"../../../models/telemetry\");"
          },
          {
            "type": "context",
            "line": " const { DocumentVectors } = require(\"../../../models/vectors\");"
          },
          {
            "type": "context",
            "line": "     */"
          },
          {
            "type": "context",
            "line": "     try {"
          },
          {
            "type": "context",
            "line": "       const { slug } = request.params;"
          },
          {
            "type": "delete",
            "line": "      const workspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "      const workspace = await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": "       response.status(200).json({ workspace });"
          },
          {
            "type": "context",
            "line": "     } catch (e) {"
          },
          {
            "type": "context",
            "line": "       console.log(e.message, e);"
          },
          {
            "type": "context",
            "line": "       try {"
          },
          {
            "type": "context",
            "line": "         const { slug = \"\" } = request.params;"
          },
          {
            "type": "context",
            "line": "         const VectorDb = getVectorDbClass();"
          },
          {
            "type": "delete",
            "line": "        const workspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        const workspace = await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!workspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": "           return;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        await Workspace.delete(`slug = '${slug.toLowerCase()}'`);"
          },
          {
            "type": "add",
            "line": "        await Workspace.delete(`id = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "         await DocumentVectors.deleteForWorkspace(workspace.id);"
          },
          {
            "type": "context",
            "line": "         await Document.delete(`workspaceId = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "         await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "       try {"
          },
          {
            "type": "context",
            "line": "         const { slug = null } = request.params;"
          },
          {
            "type": "context",
            "line": "         const data = reqBody(request);"
          },
          {
            "type": "delete",
            "line": "        const currWorkspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        const currWorkspace = await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!currWorkspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": "     */"
          },
          {
            "type": "context",
            "line": "       try {"
          },
          {
            "type": "context",
            "line": "         const { slug } = request.params;"
          },
          {
            "type": "delete",
            "line": "        const workspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        const workspace = await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!workspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": "       try {"
          },
          {
            "type": "context",
            "line": "         const { slug = null } = request.params;"
          },
          {
            "type": "context",
            "line": "         const { adds = [], deletes = [] } = reqBody(request);"
          },
          {
            "type": "delete",
            "line": "        const currWorkspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        const currWorkspace = await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!currWorkspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         await Document.removeDocuments(currWorkspace, deletes);"
          },
          {
            "type": "context",
            "line": "         await Document.addDocuments(currWorkspace, adds);"
          },
          {
            "type": "delete",
            "line": "        const updatedWorkspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        const updatedWorkspace = await Workspace.get("
          },
          {
            "type": "add",
            "line": "          `id = ${Number(currWorkspace.id)}`"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ workspace: updatedWorkspace });"
          },
          {
            "type": "context",
            "line": "       } catch (e) {"
          },
          {
            "type": "context",
            "line": "         console.log(e.message, e);"
          }
        ]
      },
      {
        "file": "server/endpoints/chat.js",
        "changes": [
          {
            "type": "context",
            "line": "index 5582dd91..365f0d33 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/chat.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/chat.js"
          },
          {
            "type": "context",
            "line": " const { WorkspaceChats } = require(\"../models/workspaceChats\");"
          },
          {
            "type": "context",
            "line": " const { SystemSettings } = require(\"../models/systemSettings\");"
          },
          {
            "type": "context",
            "line": " const { Telemetry } = require(\"../models/telemetry\");"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " function chatEndpoints(app) {"
          },
          {
            "type": "context",
            "line": "   if (!app) return;"
          },
          {
            "type": "context",
            "line": "         const { slug } = request.params;"
          },
          {
            "type": "context",
            "line": "         const { message, mode = \"query\" } = reqBody(request);"
          },
          {
            "type": "context",
            "line": "         const workspace = multiUserMode(response)"
          },
          {
            "type": "delete",
            "line": "          ? await Workspace.getWithUser(user, `slug = '${slug}'`)"
          },
          {
            "type": "delete",
            "line": "          : await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)"
          },
          {
            "type": "add",
            "line": "          : await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!workspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          }
        ]
      },
      {
        "file": "server/endpoints/invite.js",
        "changes": [
          {
            "type": "context",
            "line": "index 3f3b1452..24575f20 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/invite.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/invite.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": " const { Invite } = require(\"../models/invite\");"
          },
          {
            "type": "context",
            "line": " const { User } = require(\"../models/user\");"
          },
          {
            "type": "context",
            "line": " const { reqBody } = require(\"../utils/http\");"
          },
          {
            "type": "context",
            "line": "   app.get(\"/invite/:code\", async (request, response) => {"
          },
          {
            "type": "context",
            "line": "     try {"
          },
          {
            "type": "context",
            "line": "       const { code } = request.params;"
          },
          {
            "type": "delete",
            "line": "      const invite = await Invite.get(`code = '${code}'`);"
          },
          {
            "type": "add",
            "line": "      const invite = await Invite.get(`code = ${escape(code)}`);"
          },
          {
            "type": "context",
            "line": "       if (!invite) {"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ invite: null, error: \"Invite not found.\" });"
          },
          {
            "type": "context",
            "line": "         return;"
          },
          {
            "type": "context",
            "line": "     try {"
          },
          {
            "type": "context",
            "line": "       const { code } = request.params;"
          },
          {
            "type": "context",
            "line": "       const userParams = reqBody(request);"
          },
          {
            "type": "delete",
            "line": "      const invite = await Invite.get(`code = '${code}'`);"
          },
          {
            "type": "add",
            "line": "      const invite = await Invite.get(`code = ${escape(code)}`);"
          },
          {
            "type": "context",
            "line": "       if (!invite || invite.status !== \"pending\") {"
          },
          {
            "type": "context",
            "line": "         response"
          },
          {
            "type": "context",
            "line": "           .status(200)"
          }
        ]
      },
      {
        "file": "server/endpoints/system.js",
        "changes": [
          {
            "type": "context",
            "line": "index d493a2c2..f7fa13cb 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/system.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/system.js"
          },
          {
            "type": "context",
            "line": " const { Telemetry } = require(\"../models/telemetry\");"
          },
          {
            "type": "context",
            "line": " const { WelcomeMessages } = require(\"../models/welcomeMessages\");"
          },
          {
            "type": "context",
            "line": " const { ApiKey } = require(\"../models/apiKeys\");"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " function systemEndpoints(app) {"
          },
          {
            "type": "context",
            "line": "   if (!app) return;"
          },
          {
            "type": "context",
            "line": "     try {"
          },
          {
            "type": "context",
            "line": "       if (await SystemSettings.isMultiUserMode()) {"
          },
          {
            "type": "context",
            "line": "         const { username, password } = reqBody(request);"
          },
          {
            "type": "delete",
            "line": "        const existingUser = await User.get(`username = '${username}'`);"
          },
          {
            "type": "add",
            "line": "        const existingUser = await User.get(`username = ${escape(username)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!existingUser) {"
          },
          {
            "type": "context",
            "line": "           response.status(200).json({"
          }
        ]
      },
      {
        "file": "server/endpoints/workspaces.js",
        "changes": [
          {
            "type": "context",
            "line": "index 6d974065..923e3fdb 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/endpoints/workspaces.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/endpoints/workspaces.js"
          },
          {
            "type": "context",
            "line": " const { validatedRequest } = require(\"../utils/middleware/validatedRequest\");"
          },
          {
            "type": "context",
            "line": " const { SystemSettings } = require(\"../models/systemSettings\");"
          },
          {
            "type": "context",
            "line": " const { Telemetry } = require(\"../models/telemetry\");"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": " const { handleUploads } = setupMulter();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " function workspaceEndpoints(app) {"
          },
          {
            "type": "context",
            "line": "         const { slug = null } = request.params;"
          },
          {
            "type": "context",
            "line": "         const data = reqBody(request);"
          },
          {
            "type": "context",
            "line": "         const currWorkspace = multiUserMode(response)"
          },
          {
            "type": "delete",
            "line": "          ? await Workspace.getWithUser(user, `slug = '${slug}'`)"
          },
          {
            "type": "delete",
            "line": "          : await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)"
          },
          {
            "type": "add",
            "line": "          : await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!currWorkspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": "         const { slug = null } = request.params;"
          },
          {
            "type": "context",
            "line": "         const { adds = [], deletes = [] } = reqBody(request);"
          },
          {
            "type": "context",
            "line": "         const currWorkspace = multiUserMode(response)"
          },
          {
            "type": "delete",
            "line": "          ? await Workspace.getWithUser(user, `slug = '${slug}'`)"
          },
          {
            "type": "delete",
            "line": "          : await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)"
          },
          {
            "type": "add",
            "line": "          : await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!currWorkspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         await Document.removeDocuments(currWorkspace, deletes);"
          },
          {
            "type": "context",
            "line": "         await Document.addDocuments(currWorkspace, adds);"
          },
          {
            "type": "delete",
            "line": "        const updatedWorkspace = await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        const updatedWorkspace = await Workspace.get("
          },
          {
            "type": "add",
            "line": "          `id = ${currWorkspace.id}`"
          },
          {
            "type": "add",
            "line": "        );"
          },
          {
            "type": "context",
            "line": "         response.status(200).json({ workspace: updatedWorkspace });"
          },
          {
            "type": "context",
            "line": "       } catch (e) {"
          },
          {
            "type": "context",
            "line": "         console.log(e.message, e);"
          },
          {
            "type": "context",
            "line": "         const user = await userFromSession(request, response);"
          },
          {
            "type": "context",
            "line": "         const VectorDb = getVectorDbClass();"
          },
          {
            "type": "context",
            "line": "         const workspace = multiUserMode(response)"
          },
          {
            "type": "delete",
            "line": "          ? await Workspace.getWithUser(user, `slug = '${slug}'`)"
          },
          {
            "type": "delete",
            "line": "          : await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)"
          },
          {
            "type": "add",
            "line": "          : await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!workspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          },
          {
            "type": "context",
            "line": "           }"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        await Workspace.delete(`slug = '${slug.toLowerCase()}'`);"
          },
          {
            "type": "add",
            "line": "        await Workspace.delete(`id = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "         await DocumentVectors.deleteForWorkspace(workspace.id);"
          },
          {
            "type": "context",
            "line": "         await Document.delete(`workspaceId = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "         await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);"
          },
          {
            "type": "context",
            "line": "       const { slug } = request.params;"
          },
          {
            "type": "context",
            "line": "       const user = await userFromSession(request, response);"
          },
          {
            "type": "context",
            "line": "       const workspace = multiUserMode(response)"
          },
          {
            "type": "delete",
            "line": "        ? await Workspace.getWithUser(user, `slug = '${slug}'`)"
          },
          {
            "type": "delete",
            "line": "        : await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "        ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)"
          },
          {
            "type": "add",
            "line": "        : await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       response.status(200).json({ workspace });"
          },
          {
            "type": "context",
            "line": "     } catch (e) {"
          },
          {
            "type": "context",
            "line": "         const { slug } = request.params;"
          },
          {
            "type": "context",
            "line": "         const user = await userFromSession(request, response);"
          },
          {
            "type": "context",
            "line": "         const workspace = multiUserMode(response)"
          },
          {
            "type": "delete",
            "line": "          ? await Workspace.getWithUser(user, `slug = '${slug}'`)"
          },
          {
            "type": "delete",
            "line": "          : await Workspace.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)"
          },
          {
            "type": "add",
            "line": "          : await Workspace.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if (!workspace) {"
          },
          {
            "type": "context",
            "line": "           response.sendStatus(400).end();"
          }
        ]
      },
      {
        "file": "server/models/invite.js",
        "changes": [
          {
            "type": "context",
            "line": "index e32c9dcb..a65e7cd3 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/models/invite.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/models/invite.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " const Invite = {"
          },
          {
            "type": "context",
            "line": "   tablename: \"invites\","
          },
          {
            "type": "context",
            "line": "   writable: [],"
          },
          {
            "type": "context",
            "line": "     return { invite, error: null };"
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   deactivate: async function (inviteId = null) {"
          },
          {
            "type": "delete",
            "line": "    const invite = await this.get(`id = ${inviteId}`);"
          },
          {
            "type": "add",
            "line": "    const invite = await this.get(`id = ${escape(inviteId)}`);"
          },
          {
            "type": "context",
            "line": "     if (!invite) return { success: false, error: \"Invite does not exist.\" };"
          },
          {
            "type": "context",
            "line": "     if (invite.status !== \"pending\")"
          },
          {
            "type": "context",
            "line": "       return { success: false, error: \"Invite is not in pending status.\" };"
          },
          {
            "type": "context",
            "line": "     return { success: true, error: null };"
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   markClaimed: async function (inviteId = null, user) {"
          },
          {
            "type": "delete",
            "line": "    const invite = await this.get(`id = ${inviteId}`);"
          },
          {
            "type": "add",
            "line": "    const invite = await this.get(`id = ${escape(inviteId)}`);"
          },
          {
            "type": "context",
            "line": "     if (!invite) return { success: false, error: \"Invite does not exist.\" };"
          },
          {
            "type": "context",
            "line": "     if (invite.status !== \"pending\")"
          },
          {
            "type": "context",
            "line": "       return { success: false, error: \"Invite is not in pending status.\" };"
          }
        ]
      },
      {
        "file": "server/models/user.js",
        "changes": [
          {
            "type": "context",
            "line": "index 9bfee350..50203770 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/models/user.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/models/user.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " const User = {"
          },
          {
            "type": "context",
            "line": "   tablename: \"users\","
          },
          {
            "type": "context",
            "line": "   writable: [],"
          },
          {
            "type": "context",
            "line": "     return { user, error: null };"
          },
          {
            "type": "context",
            "line": "   },"
          },
          {
            "type": "context",
            "line": "   update: async function (userId, updates = {}) {"
          },
          {
            "type": "delete",
            "line": "    const user = await this.get(`id = ${userId}`);"
          },
          {
            "type": "add",
            "line": "    const user = await this.get(`id = ${escape(userId)}`);"
          },
          {
            "type": "context",
            "line": "     if (!user) return { success: false, error: \"User does not exist.\" };"
          },
          {
            "type": "context",
            "line": "     const { username, password, role, suspended = 0 } = updates;"
          },
          {
            "type": "context",
            "line": "     const toUpdate = { suspended };"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if (user.username !== username && username?.length > 0) {"
          },
          {
            "type": "delete",
            "line": "      const usedUsername = !!(await this.get(`username = '${username}'`));"
          },
          {
            "type": "add",
            "line": "      const usedUsername = !!(await this.get(`username = ${escape(username)}`));"
          },
          {
            "type": "context",
            "line": "       if (usedUsername)"
          },
          {
            "type": "context",
            "line": "         return { success: false, error: `${username} is already in use.` };"
          },
          {
            "type": "context",
            "line": "       toUpdate.username = username;"
          }
        ]
      },
      {
        "file": "server/models/workspace.js",
        "changes": [
          {
            "type": "context",
            "line": "index 5049a2ba..ac0361d4 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/models/workspace.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/models/workspace.js"
          },
          {
            "type": "context",
            "line": " const { Document } = require(\"./documents\");"
          },
          {
            "type": "context",
            "line": " const { checkForMigrations } = require(\"../utils/database\");"
          },
          {
            "type": "context",
            "line": " const { WorkspaceUser } = require(\"./workspaceUsers\");"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " const Workspace = {"
          },
          {
            "type": "context",
            "line": "   tablename: \"workspaces\","
          },
          {
            "type": "context",
            "line": "     if (!name) return { result: null, message: \"name cannot be null\" };"
          },
          {
            "type": "context",
            "line": "     var slug = slugify(name, { lower: true });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "    const existingBySlug = await this.get(`slug = '${slug}'`);"
          },
          {
            "type": "add",
            "line": "    const existingBySlug = await this.get(`slug = ${escape(slug)}`);"
          },
          {
            "type": "context",
            "line": "     if (existingBySlug !== null) {"
          },
          {
            "type": "context",
            "line": "       const slugSeed = Math.floor(10000000 + Math.random() * 90000000);"
          },
          {
            "type": "context",
            "line": "       slug = slugify(`${name}-${slugSeed}`, { lower: true });"
          }
        ]
      },
      {
        "file": "server/package.json",
        "changes": [
          {
            "type": "context",
            "line": "index c1763380..187304e9 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/server/package.json"
          },
          {
            "type": "context",
            "line": "     \"slugify\": \"^1.6.6\","
          },
          {
            "type": "context",
            "line": "     \"sqlite\": \"^4.2.1\","
          },
          {
            "type": "context",
            "line": "     \"sqlite3\": \"^5.1.6\","
          },
          {
            "type": "add",
            "line": "    \"sqlstring-sqlite\": \"^0.1.1\","
          },
          {
            "type": "context",
            "line": "     \"swagger-autogen\": \"^2.23.5\","
          },
          {
            "type": "context",
            "line": "     \"swagger-ui-express\": \"^5.0.0\","
          },
          {
            "type": "context",
            "line": "     \"uuid\": \"^9.0.0\","
          },
          {
            "type": "context",
            "line": "     \"nodemon\": \"^2.0.22\","
          },
          {
            "type": "context",
            "line": "     \"prettier\": \"^2.4.1\""
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "context",
            "line": "\\ No newline at end of file"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "server/utils/middleware/validApiKey.js",
        "changes": [
          {
            "type": "context",
            "line": "index 6c743106..3e819ab0 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/utils/middleware/validApiKey.js"
          },
          {
            "type": "context",
            "line": "+++ b/server/utils/middleware/validApiKey.js"
          },
          {
            "type": "add",
            "line": "const { escape } = require(\"sqlstring-sqlite\");"
          },
          {
            "type": "context",
            "line": " const { ApiKey } = require(\"../../models/apiKeys\");"
          },
          {
            "type": "context",
            "line": " const { SystemSettings } = require(\"../../models/systemSettings\");"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return;"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "  const apiKey = await ApiKey.get(`secret = '${bearerKey}'`);"
          },
          {
            "type": "delete",
            "line": "  if (!apiKey) {"
          },
          {
            "type": "add",
            "line": "  if (!(await ApiKey.get(`secret = ${escape(bearerKey)}`))) {"
          },
          {
            "type": "context",
            "line": "     response.status(403).json({"
          },
          {
            "type": "context",
            "line": "       error: \"No valid api key found.\","
          },
          {
            "type": "context",
            "line": "     });"
          }
        ]
      },
      {
        "file": "server/yarn.lock",
        "changes": [
          {
            "type": "context",
            "line": "index 1d47eb61..3350ab37 100644"
          },
          {
            "type": "context",
            "line": "--- a/server/yarn.lock"
          },
          {
            "type": "context",
            "line": "+++ b/server/yarn.lock"
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/sqlite/-/sqlite-4.2.1.tgz#d4eedfd1ad702f79110792375f4241a90c75c828\""
          },
          {
            "type": "context",
            "line": "   integrity sha512-Tll0Ndvnwkuv5Hn6WIbh26rZiYQORuH1t5m/or9LUpSmDmmyFG89G9fKrSeugMPxwmEIXoVxqTun4LbizTs4uw=="
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "sqlstring-sqlite@^0.1.1:"
          },
          {
            "type": "add",
            "line": "  version \"0.1.1\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/sqlstring-sqlite/-/sqlstring-sqlite-0.1.1.tgz#c8c61810663f2e59a6b0d737b70a8752bda3a078\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-9CAYUJ0lEUPYJrswqiqdINNSfq3jqWo/bFJ7tufdoNeSK0Fy+d1kFTxjqO9PIqza0Kri+ZtYMfPVf1aZaFOvrQ=="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " ssri@^8.0.0, ssri@^8.0.1:"
          },
          {
            "type": "context",
            "line": "   version \"8.0.1\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/ssri/-/ssri-8.0.1.tgz#638e4e439e2ffbd2cd289776d5ca457c4f51a2af\""
          }
        ]
      }
    ]
  },
  {
    "commit": "deee944f9a12c9fd399ce52f3e2526bb573a9470",
    "files": [
      {
        "file": "src/time/rfc1123.cc",
        "changes": [
          {
            "type": "context",
            "line": "index d89d22262..7524959ed 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/time/rfc1123.cc"
          },
          {
            "type": "context",
            "line": "+++ b/src/time/rfc1123.cc"
          },
          {
            "type": "context",
            "line": "     char month[3];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     month[0] = xtoupper(*s);"
          },
          {
            "type": "add",
            "line": "    if (!month[0])"
          },
          {
            "type": "add",
            "line": "        return -1; // protects *(s + 1) below"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     month[1] = xtolower(*(s + 1));"
          },
          {
            "type": "add",
            "line": "    if (!month[1])"
          },
          {
            "type": "add",
            "line": "        return -1; // protects *(s + 2) below"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     month[2] = xtolower(*(s + 2));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     for (i = 0; i < 12; i++)"
          }
        ]
      }
    ]
  },
  {
    "commit": "e1a8b158e04ad567d92d8daf3cc0898ee18f1a2e",
    "files": [
      {
        "file": ".config/example.yml",
        "changes": [
          {
            "type": "context",
            "line": "index d5ea4ba607..2e13b63977 100644"
          },
          {
            "type": "context",
            "line": "--- a/.config/example.yml"
          },
          {
            "type": "context",
            "line": "+++ b/.config/example.yml"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " # Sign to ActivityPub GET request (default: false)"
          },
          {
            "type": "context",
            "line": " #signToActivityPubGet: true"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "#allowedPrivateNetworks: ["
          },
          {
            "type": "add",
            "line": "#  '127.0.0.1/32'"
          },
          {
            "type": "add",
            "line": "#]"
          }
        ]
      },
      {
        "file": "package.json",
        "changes": [
          {
            "type": "context",
            "line": "index 1f9baa3ca2..53dead5ef7 100644"
          },
          {
            "type": "context",
            "line": "--- a/package.json"
          },
          {
            "type": "context",
            "line": "+++ b/package.json"
          },
          {
            "type": "context",
            "line": " \t\t\"http-signature\": \"1.3.5\","
          },
          {
            "type": "context",
            "line": " \t\t\"idb-keyval\": \"5.1.3\","
          },
          {
            "type": "context",
            "line": " \t\t\"insert-text-at-cursor\": \"0.3.0\","
          },
          {
            "type": "add",
            "line": "\t\t\"ip-cidr\": \"3.0.4\","
          },
          {
            "type": "context",
            "line": " \t\t\"is-svg\": \"4.3.1\","
          },
          {
            "type": "context",
            "line": " \t\t\"js-yaml\": \"4.1.0\","
          },
          {
            "type": "context",
            "line": " \t\t\"jsdom\": \"16.7.0\","
          },
          {
            "type": "context",
            "line": " \t\t\"postcss\": \"8.3.6\","
          },
          {
            "type": "context",
            "line": " \t\t\"postcss-loader\": \"6.1.1\","
          },
          {
            "type": "context",
            "line": " \t\t\"prismjs\": \"1.24.1\","
          },
          {
            "type": "add",
            "line": "\t\t\"private-ip\": \"2.2.1\","
          },
          {
            "type": "context",
            "line": " \t\t\"probe-image-size\": \"7.2.1\","
          },
          {
            "type": "context",
            "line": " \t\t\"promise-limit\": \"2.7.0\","
          },
          {
            "type": "context",
            "line": " \t\t\"pug\": \"3.0.2\","
          }
        ]
      },
      {
        "file": "src/config/types.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 8084be1864..55beac6f55 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/config/types.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/config/types.ts"
          },
          {
            "type": "context",
            "line": " \tproxySmtp?: string;"
          },
          {
            "type": "context",
            "line": " \tproxyBypassHosts?: string[];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tallowedPrivateNetworks?: string[];"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " \taccesslog?: string;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tclusterLimit?: number;"
          }
        ]
      },
      {
        "file": "src/misc/download-url.ts",
        "changes": [
          {
            "type": "context",
            "line": "index 43e061c715..463fb555bb 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/misc/download-url.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/misc/download-url.ts"
          },
          {
            "type": "context",
            "line": " import * as fs from 'fs';"
          },
          {
            "type": "context",
            "line": " import * as stream from 'stream';"
          },
          {
            "type": "context",
            "line": " import * as util from 'util';"
          },
          {
            "type": "delete",
            "line": "import { URL } from 'url';"
          },
          {
            "type": "delete",
            "line": "import fetch from 'node-fetch';"
          },
          {
            "type": "delete",
            "line": "import { getAgentByUrl } from './fetch';"
          },
          {
            "type": "delete",
            "line": "import { AbortController } from 'abort-controller';"
          },
          {
            "type": "add",
            "line": "import got, * as Got from 'got';"
          },
          {
            "type": "add",
            "line": "import { httpAgent, httpsAgent } from './fetch';"
          },
          {
            "type": "context",
            "line": " import config from '@/config/index';"
          },
          {
            "type": "context",
            "line": " import * as chalk from 'chalk';"
          },
          {
            "type": "context",
            "line": " import Logger from '@/services/logger';"
          },
          {
            "type": "add",
            "line": "import * as IPCIDR from 'ip-cidr';"
          },
          {
            "type": "add",
            "line": "const PrivateIp = require('private-ip');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " const pipeline = util.promisify(stream.pipeline);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tconst logger = new Logger('download');"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tlogger.info(`Downloading ${chalk.cyan(url)} ...`);"
          },
          {
            "type": "delete",
            "line": "\tconst controller = new AbortController();"
          },
          {
            "type": "delete",
            "line": "\tsetTimeout(() => {"
          },
          {
            "type": "delete",
            "line": "\t\tcontroller.abort();"
          },
          {
            "type": "delete",
            "line": "\t}, 60 * 1000);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tconst response = await fetch(new URL(url).href, {"
          },
          {
            "type": "add",
            "line": "\tconst timeout = 30 * 1000;"
          },
          {
            "type": "add",
            "line": "\tconst operationTimeout = 60 * 1000;"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\tconst req = got.stream(url, {"
          },
          {
            "type": "context",
            "line": " \t\theaders: {"
          },
          {
            "type": "context",
            "line": " \t\t\t'User-Agent': config.userAgent"
          },
          {
            "type": "context",
            "line": " \t\t},"
          },
          {
            "type": "delete",
            "line": "\t\ttimeout: 10 * 1000,"
          },
          {
            "type": "delete",
            "line": "\t\tsignal: controller.signal,"
          },
          {
            "type": "delete",
            "line": "\t\tagent: getAgentByUrl,"
          },
          {
            "type": "add",
            "line": "\t\ttimeout: {"
          },
          {
            "type": "add",
            "line": "\t\t\tlookup: timeout,"
          },
          {
            "type": "add",
            "line": "\t\t\tconnect: timeout,"
          },
          {
            "type": "add",
            "line": "\t\t\tsecureConnect: timeout,"
          },
          {
            "type": "add",
            "line": "\t\t\tsocket: timeout,\t// read timeout"
          },
          {
            "type": "add",
            "line": "\t\t\tresponse: timeout,"
          },
          {
            "type": "add",
            "line": "\t\t\tsend: timeout,"
          },
          {
            "type": "add",
            "line": "\t\t\trequest: operationTimeout,\t// whole operation timeout"
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t\tagent: {"
          },
          {
            "type": "add",
            "line": "\t\t\thttp: httpAgent,"
          },
          {
            "type": "add",
            "line": "\t\t\thttps: httpsAgent,"
          },
          {
            "type": "add",
            "line": "\t\t},"
          },
          {
            "type": "add",
            "line": "\t\tretry: 0,"
          },
          {
            "type": "add",
            "line": "\t}).on('response', (res: Got.Response) => {"
          },
          {
            "type": "add",
            "line": "\t\tif ((process.env.NODE_ENV === 'production' || process.env.NODE_ENV === 'test') && !config.proxy && res.ip) {"
          },
          {
            "type": "add",
            "line": "\t\t\tif (isPrivateIp(res.ip)) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\tlogger.warn(`Blocked address: ${res.ip}`);"
          },
          {
            "type": "add",
            "line": "\t\t\t\treq.destroy();"
          },
          {
            "type": "add",
            "line": "\t\t\t}"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}).on('error', (e: any) => {"
          },
          {
            "type": "add",
            "line": "\t\tif (e.name === 'HTTPError') {"
          },
          {
            "type": "add",
            "line": "\t\t\tconst statusCode = e.response?.statusCode;"
          },
          {
            "type": "add",
            "line": "\t\t\tconst statusMessage = e.response?.statusMessage;"
          },
          {
            "type": "add",
            "line": "\t\t\te.name = `StatusError`;"
          },
          {
            "type": "add",
            "line": "\t\t\te.statusCode = statusCode;"
          },
          {
            "type": "add",
            "line": "\t\t\te.message = `${statusCode} ${statusMessage}`;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "context",
            "line": " \t});"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tif (!response.ok) {"
          },
          {
            "type": "delete",
            "line": "\t\tlogger.error(`Got ${response.status} (${url})`);"
          },
          {
            "type": "delete",
            "line": "\t\tthrow response.status;"
          },
          {
            "type": "delete",
            "line": "\t}"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\tawait pipeline(response.body, fs.createWriteStream(path));"
          },
          {
            "type": "add",
            "line": "\tawait pipeline(req, fs.createWriteStream(path));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \tlogger.succ(`Download finished: ${chalk.cyan(url)}`);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "function isPrivateIp(ip: string) {"
          },
          {
            "type": "add",
            "line": "\tfor (const net of config.allowedPrivateNetworks || []) {"
          },
          {
            "type": "add",
            "line": "\t\tconst cidr = new IPCIDR(net);"
          },
          {
            "type": "add",
            "line": "\t\tif (cidr.contains(ip)) {"
          },
          {
            "type": "add",
            "line": "\t\t\treturn false;"
          },
          {
            "type": "add",
            "line": "\t\t}"
          },
          {
            "type": "add",
            "line": "\t}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\treturn PrivateIp(ip);"
          },
          {
            "type": "add",
            "line": "}"
          }
        ]
      },
      {
        "file": "src/server/file/send-drive-file.ts",
        "changes": [
          {
            "type": "context",
            "line": "index c455de6447..a73164ed21 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/server/file/send-drive-file.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/server/file/send-drive-file.ts"
          },
          {
            "type": "context",
            "line": " \t\t\t\tctx.set('Content-Type', image.type);"
          },
          {
            "type": "context",
            "line": " \t\t\t\tctx.set('Cache-Control', 'max-age=31536000, immutable');"
          },
          {
            "type": "context",
            "line": " \t\t\t} catch (e) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\tserverLogger.error(e);"
          },
          {
            "type": "add",
            "line": "\t\t\t\tserverLogger.error(e.statusCode);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t\t\tif (typeof e == 'number' && e >= 400 && e < 500) {"
          },
          {
            "type": "delete",
            "line": "\t\t\t\t\tctx.status = e;"
          },
          {
            "type": "add",
            "line": "\t\t\t\tif (typeof e.statusCode === 'number' && e.statusCode >= 400 && e.statusCode < 500) {"
          },
          {
            "type": "add",
            "line": "\t\t\t\t\tctx.status = e.statusCode;"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tctx.set('Cache-Control', 'max-age=86400');"
          },
          {
            "type": "context",
            "line": " \t\t\t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\t\t\tctx.status = 500;"
          }
        ]
      },
      {
        "file": "src/server/proxy/proxy-media.ts",
        "changes": [
          {
            "type": "context",
            "line": "index fb38a5c07b..3bd65dfe67 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/server/proxy/proxy-media.ts"
          },
          {
            "type": "context",
            "line": "+++ b/src/server/proxy/proxy-media.ts"
          },
          {
            "type": "context",
            "line": " \t} catch (e) {"
          },
          {
            "type": "context",
            "line": " \t\tserverLogger.error(e);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\tif (typeof e == 'number' && e >= 400 && e < 500) {"
          },
          {
            "type": "delete",
            "line": "\t\t\tctx.status = e;"
          },
          {
            "type": "add",
            "line": "\t\tif (typeof e.statusCode === 'number' && e.statusCode >= 400 && e.statusCode < 500) {"
          },
          {
            "type": "add",
            "line": "\t\t\tctx.status = e.statusCode;"
          },
          {
            "type": "context",
            "line": " \t\t} else {"
          },
          {
            "type": "context",
            "line": " \t\t\tctx.status = 500;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          }
        ]
      },
      {
        "file": "yarn.lock",
        "changes": [
          {
            "type": "context",
            "line": "index ccfee76557..8151dfe089 100644"
          },
          {
            "type": "context",
            "line": "--- a/yarn.lock"
          },
          {
            "type": "context",
            "line": "+++ b/yarn.lock"
          },
          {
            "type": "context",
            "line": "     redis-parser \"^3.0.0\""
          },
          {
            "type": "context",
            "line": "     standard-as-callback \"^2.1.0\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "ip-address@^7.1.0:"
          },
          {
            "type": "add",
            "line": "  version \"7.1.0\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/ip-address/-/ip-address-7.1.0.tgz#4a9c699e75b51cbeb18b38de8ed216efa1a490c5\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-V9pWC/VJf2lsXqP7IWJ+pe3P1/HCYGBMZrrnT62niLGjAfCbeiwXMUxaeHvnVlz19O27pvXP4azs+Pj/A0x+SQ=="
          },
          {
            "type": "add",
            "line": "  dependencies:"
          },
          {
            "type": "add",
            "line": "    jsbn \"1.1.0\""
          },
          {
            "type": "add",
            "line": "    sprintf-js \"1.1.2\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "ip-cidr@3.0.4:"
          },
          {
            "type": "add",
            "line": "  version \"3.0.4\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/ip-cidr/-/ip-cidr-3.0.4.tgz#a915c47e00f47ea8d5f8ed662ea6161471c44375\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-pKNiqmBlTvEkhaLAa3+FOmYSY0/jjADVxxjA3NbujZZTT8mjLI90Q+6mwg6kd0fNm0RuAOkWJ1u1a/ETmlrPNQ=="
          },
          {
            "type": "add",
            "line": "  dependencies:"
          },
          {
            "type": "add",
            "line": "    ip-address \"^7.1.0\""
          },
          {
            "type": "add",
            "line": "    jsbn \"^1.1.0\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "ip-regex@^4.3.0:"
          },
          {
            "type": "add",
            "line": "  version \"4.3.0\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/ip-regex/-/ip-regex-4.3.0.tgz#687275ab0f57fa76978ff8f4dddc8a23d5990db5\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-B9ZWJxHHOHUhUjCPrMpLD4xEq35bUTClHM1S6CBU5ixQnkZmwipwgc96vAd7AAGM9TGHvJR+Uss+/Ak6UphK+Q=="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " ip@^1.1.5:"
          },
          {
            "type": "context",
            "line": "   version \"1.1.5\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/ip/-/ip-1.1.5.tgz#bdded70114290828c0a039e72ef25f5aaec4354a\""
          },
          {
            "type": "context",
            "line": "     argparse \"^1.0.7\""
          },
          {
            "type": "context",
            "line": "     esprima \"^2.6.0\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "jsbn@1.1.0, jsbn@^1.1.0:"
          },
          {
            "type": "add",
            "line": "  version \"1.1.0\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/jsbn/-/jsbn-1.1.0.tgz#b01307cb29b618a1ed26ec79e911f803c4da0040\""
          },
          {
            "type": "add",
            "line": "  integrity sha1-sBMHyym2GKHtJux56RH4A8TaAEA="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " jsbn@~0.1.0:"
          },
          {
            "type": "context",
            "line": "   version \"0.1.1\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/jsbn/-/jsbn-0.1.1.tgz#a5e654c2e5a2deb5f201d96cefbca80c0ef2f513\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/nested-property/-/nested-property-4.0.0.tgz#a67b5a31991e701e03cdbaa6453bc5b1011bb88d\""
          },
          {
            "type": "context",
            "line": "   integrity sha512-yFehXNWRs4cM0+dz7QxCd06hTbWbSkV0ISsqBfkntU6TOY4Qm3Q88fRRLOddkGh2Qq6dZvnKVAahfhjcUvLnyA=="
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "netmask@^2.0.2:"
          },
          {
            "type": "add",
            "line": "  version \"2.0.2\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/netmask/-/netmask-2.0.2.tgz#8b01a07644065d536383835823bc52004ebac5e7\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-dBpDMdxv9Irdq66304OLfEmQ9tbNRFnFTuZiLo+bD+r332bBmMJ8GBLXklIXXgxd3+v9+KUnZaUR5PJMa75Gsg=="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " next-line@^1.1.0:"
          },
          {
            "type": "context",
            "line": "   version \"1.1.0\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/next-line/-/next-line-1.1.0.tgz#fcae57853052b6a9bae8208e40dd7d3c2d304603\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/prismjs/-/prismjs-1.24.1.tgz#c4d7895c4d6500289482fa8936d9cdd192684036\""
          },
          {
            "type": "context",
            "line": "   integrity sha512-mNPsedLuk90RVJioIky8ANZEwYm5w9LcvCXrxHlwf4fNVSn8jEipMybMkWUyyF0JhnC+C4VcOVSBuHRKs1L5Ow=="
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "private-ip@2.2.1:"
          },
          {
            "type": "add",
            "line": "  version \"2.2.1\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/private-ip/-/private-ip-2.2.1.tgz#4fe167d04e12eca5c67cdcbd3224e86b38c79253\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-jN1WT/br/VNW9xEcwHr6DjtOKxQ5qOIqmh7o+co2TWgq56pZJw99iO3UT1tWdfgsQiyK9FqG4ji3ykwpjFqITA=="
          },
          {
            "type": "add",
            "line": "  dependencies:"
          },
          {
            "type": "add",
            "line": "    ip-regex \"^4.3.0\""
          },
          {
            "type": "add",
            "line": "    netmask \"^2.0.2\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " probe-image-size@7.2.1:"
          },
          {
            "type": "context",
            "line": "   version \"7.2.1\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/probe-image-size/-/probe-image-size-7.2.1.tgz#df0c924e67e247bc94f8fcb0fad7f0081061fc44\""
          },
          {
            "type": "context",
            "line": "   dependencies:"
          },
          {
            "type": "context",
            "line": "     through \"2\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "sprintf-js@1.1.2:"
          },
          {
            "type": "add",
            "line": "  version \"1.1.2\""
          },
          {
            "type": "add",
            "line": "  resolved \"https://registry.yarnpkg.com/sprintf-js/-/sprintf-js-1.1.2.tgz#da1765262bf8c0f571749f2ad6c26300207ae673\""
          },
          {
            "type": "add",
            "line": "  integrity sha512-VE0SOVEHCk7Qc8ulkWw3ntAzXuqf7S2lvwQaDLRnUeIEaKNQJzV6BwmLKhOqT61aGhfUMrXeaBk+oDGCzvhcug=="
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " sprintf-js@~1.0.2:"
          },
          {
            "type": "context",
            "line": "   version \"1.0.3\""
          },
          {
            "type": "context",
            "line": "   resolved \"https://registry.yarnpkg.com/sprintf-js/-/sprintf-js-1.0.3.tgz#04e6926f662895354f3dd015203633b857297e2c\""
          }
        ]
      }
    ]
  },
  {
    "commit": "e2256ec81e56f792623e90d89786d8a9fcad28bf",
    "files": [
      {
        "file": "Framework/DataAbstractionLayer/Dbal/EntityAggregator.php",
        "changes": [
          {
            "type": "context",
            "line": "index 6e61e2177d..ca679e5470 100644"
          },
          {
            "type": "context",
            "line": "--- a/Framework/DataAbstractionLayer/Dbal/EntityAggregator.php"
          },
          {
            "type": "context",
            "line": "+++ b/Framework/DataAbstractionLayer/Dbal/EntityAggregator.php"
          },
          {
            "type": "context",
            "line": "         $query->addGroupBy($groupBy);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $key = $aggregation->getName() . '.key';"
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('MIN(%s) as `%s`', $accessor, $key));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('MIN(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($key)));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $key = $aggregation->getName() . '.count';"
          },
          {
            "type": "context",
            "line": "         $countAccessor = $this->queryHelper->getFieldAccessor('id', $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('COUNT(%s) as `%s`', $countAccessor, $key));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('COUNT(%s) as %s', $countAccessor, EntityDefinitionQueryHelper::escape($key)));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if ($aggregation->getSorting()) {"
          },
          {
            "type": "context",
            "line": "             $this->addSorting($aggregation->getSorting(), $definition, $query, $context);"
          },
          {
            "type": "context",
            "line": "             $keyAccessor = 'LOWER(HEX(' . $keyAccessor . '))';"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('%s as `%s`', $keyAccessor, $key));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('%s as %s', $keyAccessor, EntityDefinitionQueryHelper::escape($key)));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $key = $aggregation->getName() . '.count';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $countAccessor = $this->queryHelper->getFieldAccessor('id', $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('COUNT(%s) as `%s`', $countAccessor, $key));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('COUNT(%s) as %s', $countAccessor, EntityDefinitionQueryHelper::escape($key)));"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if ($aggregation->getLimit()) {"
          },
          {
            "type": "context",
            "line": "             $query->setMaxResults($aggregation->getLimit());"
          },
          {
            "type": "context",
            "line": "     ): void {"
          },
          {
            "type": "context",
            "line": "         $accessor = $this->queryHelper->getFieldAccessor($aggregation->getField(), $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('AVG(%s) as `%s`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('AVG(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName())));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function parseSumAggregation("
          },
          {
            "type": "context",
            "line": "     ): void {"
          },
          {
            "type": "context",
            "line": "         $accessor = $this->queryHelper->getFieldAccessor($aggregation->getField(), $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('SUM(%s) as `%s`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('SUM(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName())));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function parseMaxAggregation("
          },
          {
            "type": "context",
            "line": "     ): void {"
          },
          {
            "type": "context",
            "line": "         $accessor = $this->queryHelper->getFieldAccessor($aggregation->getField(), $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('MAX(%s) as `%s`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('MAX(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName())));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function parseMinAggregation("
          },
          {
            "type": "context",
            "line": "     ): void {"
          },
          {
            "type": "context",
            "line": "         $accessor = $this->queryHelper->getFieldAccessor($aggregation->getField(), $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('MIN(%s) as `%s`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('MIN(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName())));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function parseCountAggregation("
          },
          {
            "type": "context",
            "line": "     ): void {"
          },
          {
            "type": "context",
            "line": "         $accessor = $this->queryHelper->getFieldAccessor($aggregation->getField(), $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('COUNT(DISTINCT %s) as `%s`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('COUNT(DISTINCT %s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName())));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function parseStatsAggregation("
          },
          {
            "type": "context",
            "line": "         $accessor = $this->queryHelper->getFieldAccessor($aggregation->getField(), $definition, $definition->getEntityName(), $context);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if ($aggregation->fetchAvg()) {"
          },
          {
            "type": "delete",
            "line": "            $query->addSelect(sprintf('AVG(%s) as `%s.avg`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "            $query->addSelect(sprintf('AVG(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName() . '.avg')));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         if ($aggregation->fetchMin()) {"
          },
          {
            "type": "delete",
            "line": "            $query->addSelect(sprintf('MIN(%s) as `%s.min`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "            $query->addSelect(sprintf('MIN(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName() . '.min')));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         if ($aggregation->fetchMax()) {"
          },
          {
            "type": "delete",
            "line": "            $query->addSelect(sprintf('MAX(%s) as `%s.max`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "            $query->addSelect(sprintf('MAX(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName() . '.max')));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "         if ($aggregation->fetchSum()) {"
          },
          {
            "type": "delete",
            "line": "            $query->addSelect(sprintf('SUM(%s) as `%s.sum`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "            $query->addSelect(sprintf('SUM(%s) as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName() . '.sum')));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 $sum .= sprintf(' AND %s < %f', $accessor, $range['to']);"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            $query->addSelect(sprintf('SUM(%s) as `%s.%s`', $sum, $aggregation->getName(), $id));"
          },
          {
            "type": "add",
            "line": "            $query->addSelect(sprintf('SUM(%s) as %s', $sum, EntityDefinitionQueryHelper::escape($aggregation->getName() . '.' . $id)));"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $query->addGroupBy($accessor);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $accessor = 'LOWER(HEX(' . $accessor . '))';"
          },
          {
            "type": "delete",
            "line": "        $query->addSelect(sprintf('%s as `%s`', $accessor, $aggregation->getName()));"
          },
          {
            "type": "add",
            "line": "        $query->addSelect(sprintf('%s as %s', $accessor, EntityDefinitionQueryHelper::escape($aggregation->getName())));"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     /**"
          }
        ]
      },
      {
        "file": "Framework/DataAbstractionLayer/Dbal/FieldAccessorBuilder/JsonFieldAccessorBuilder.php",
        "changes": [
          {
            "type": "context",
            "line": "index 9a0b8347c0..6e7a02b0fe 100644"
          },
          {
            "type": "context",
            "line": "--- a/Framework/DataAbstractionLayer/Dbal/FieldAccessorBuilder/JsonFieldAccessorBuilder.php"
          },
          {
            "type": "context",
            "line": "+++ b/Framework/DataAbstractionLayer/Dbal/FieldAccessorBuilder/JsonFieldAccessorBuilder.php"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $jsonValueExpr = sprintf("
          },
          {
            "type": "delete",
            "line": "            'JSON_EXTRACT(`%s`.`%s`, %s)',"
          },
          {
            "type": "delete",
            "line": "            $root,"
          },
          {
            "type": "delete",
            "line": "            $field->getStorageName(),"
          },
          {
            "type": "add",
            "line": "            'JSON_EXTRACT(%s.%s, %s)',"
          },
          {
            "type": "add",
            "line": "            EntityDefinitionQueryHelper::escape($root),"
          },
          {
            "type": "add",
            "line": "            EntityDefinitionQueryHelper::escape($field->getStorageName()),"
          },
          {
            "type": "context",
            "line": "             (string) $this->connection->quote('$' . $jsonPath)"
          },
          {
            "type": "context",
            "line": "         );"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         return sprintf('IF(JSON_TYPE(%s) != \"NULL\", %s, NULL)', $jsonValueExpr, $accessor);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    /**"
          },
          {
            "type": "add",
            "line": "     * @param Field[] $fields"
          },
          {
            "type": "add",
            "line": "     */"
          },
          {
            "type": "context",
            "line": "     private function getField(string $path, array $fields): ?Field"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         /** @var string $fieldName */"
          }
        ]
      },
      {
        "file": "Framework/DataAbstractionLayer/Dbal/FieldAccessorBuilder/PriceFieldAccessorBuilder.php",
        "changes": [
          {
            "type": "context",
            "line": "index ee1f1cb0ba..a368e4b94c 100644"
          },
          {
            "type": "context",
            "line": "--- a/Framework/DataAbstractionLayer/Dbal/FieldAccessorBuilder/PriceFieldAccessorBuilder.php"
          },
          {
            "type": "context",
            "line": "+++ b/Framework/DataAbstractionLayer/Dbal/FieldAccessorBuilder/PriceFieldAccessorBuilder.php"
          },
          {
            "type": "context",
            "line": " use Shopware\\Core\\Checkout\\Cart\\Price\\Struct\\CartPrice;"
          },
          {
            "type": "context",
            "line": " use Shopware\\Core\\Defaults;"
          },
          {
            "type": "context",
            "line": " use Shopware\\Core\\Framework\\Context;"
          },
          {
            "type": "add",
            "line": "use Shopware\\Core\\Framework\\DataAbstractionLayer\\Dbal\\EntityDefinitionQueryHelper;"
          },
          {
            "type": "context",
            "line": " use Shopware\\Core\\Framework\\DataAbstractionLayer\\Field\\Field;"
          },
          {
            "type": "context",
            "line": " use Shopware\\Core\\Framework\\DataAbstractionLayer\\Field\\PriceField;"
          },
          {
            "type": "context",
            "line": " use Shopware\\Core\\Framework\\Log\\Package;"
          },
          {
            "type": "context",
            "line": "          * We can indirectly cast to float by adding 0.0"
          },
          {
            "type": "context",
            "line": "          */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $template = '(JSON_UNQUOTE(JSON_EXTRACT(`#root#`.`#field#`, \"$.c#currencyId#.#property#\")) #factor#)';"
          },
          {
            "type": "add",
            "line": "        $template = '(JSON_UNQUOTE(JSON_EXTRACT(#root#.#field#, \"$.c#currencyId#.#property#\")) #factor#)';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $variables = ["
          },
          {
            "type": "delete",
            "line": "            '#root#' => $root,"
          },
          {
            "type": "delete",
            "line": "            '#field#' => $field->getStorageName(),"
          },
          {
            "type": "add",
            "line": "            '#root#' => EntityDefinitionQueryHelper::escape($root),"
          },
          {
            "type": "add",
            "line": "            '#field#' => EntityDefinitionQueryHelper::escape($field->getStorageName()),"
          },
          {
            "type": "context",
            "line": "             '#currencyId#' => $currencyId,"
          },
          {
            "type": "context",
            "line": "             '#property#' => $jsonAccessor,"
          },
          {
            "type": "context",
            "line": "             '#factor#' => '+ 0.0',"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         if ($currencyId !== Defaults::CURRENCY) {"
          },
          {
            "type": "context",
            "line": "             $variables = ["
          },
          {
            "type": "delete",
            "line": "                '#root#' => $root,"
          },
          {
            "type": "delete",
            "line": "                '#field#' => $field->getStorageName(),"
          },
          {
            "type": "add",
            "line": "                '#root#' => EntityDefinitionQueryHelper::escape($root),"
          },
          {
            "type": "add",
            "line": "                '#field#' => EntityDefinitionQueryHelper::escape($field->getStorageName()),"
          },
          {
            "type": "context",
            "line": "                 '#currencyId#' => Defaults::CURRENCY,"
          },
          {
            "type": "context",
            "line": "                 '#property#' => $jsonAccessor,"
          },
          {
            "type": "context",
            "line": "                 '#factor#' => $currencyFactor,"
          }
        ]
      },
      {
        "file": "Framework/Test/DataAbstractionLayer/Search/EntityAggregatorTest.php",
        "changes": [
          {
            "type": "context",
            "line": "index 12f5efed9f..b678b58e33 100644"
          },
          {
            "type": "context",
            "line": "--- a/Framework/Test/DataAbstractionLayer/Search/EntityAggregatorTest.php"
          },
          {
            "type": "context",
            "line": "+++ b/Framework/Test/DataAbstractionLayer/Search/EntityAggregatorTest.php"
          },
          {
            "type": "context",
            "line": "         $this->aggregator->aggregate($this->getContainer()->get(TaxDefinition::class), $criteria, $context);"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    public function testAggregationWithBacktickInName(): void"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "        $context = Context::createDefaultContext();"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        $criteria = new Criteria();"
          },
          {
            "type": "add",
            "line": "        $criteria->addAggregation(new SumAggregation('`taxRate`', 'taxRate'));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        static::expectException(\\InvalidArgumentException::class);"
          },
          {
            "type": "add",
            "line": "        static::expectExceptionMessage('Backtick not allowed in identifier');"
          },
          {
            "type": "add",
            "line": "        $this->aggregator->aggregate($this->getContainer()->get(TaxDefinition::class), $criteria, $context);"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     private function insertData(): void"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "context",
            "line": "         $repository = $this->getContainer()->get('product.repository');"
          }
        ]
      }
    ]
  },
  {
    "commit": "e412b0597830ae564a604e2579eb40e76f7f0628",
    "files": [
      {
        "file": "src/Security/PimcoreUserTwoFactorCondition.php",
        "changes": [
          {
            "type": "context",
            "line": "index c74cac25d..81ea7a3ca 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/Security/PimcoreUserTwoFactorCondition.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/Security/PimcoreUserTwoFactorCondition.php"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     public function shouldPerformTwoFactorAuthentication(AuthenticationContextInterface $context): bool"
          },
          {
            "type": "context",
            "line": "     {"
          },
          {
            "type": "add",
            "line": "        //return true for performing two factor for firewalls other than admin"
          },
          {
            "type": "context",
            "line": "         if ($context->getFirewallName() !== 'pimcore_admin') {"
          },
          {
            "type": "delete",
            "line": "            return false;"
          },
          {
            "type": "add",
            "line": "            return true;"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         $user = $context->getUser();"
          }
        ]
      }
    ]
  },
  {
    "commit": "e73309665508c17e48a67e302d3ab02a38d3ef50",
    "files": [
      {
        "file": "browser/net/ipfs_redirect_network_delegate_helper.cc",
        "changes": [
          {
            "type": "context",
            "line": "index 410cc26ebe0..97030d75135 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/net/ipfs_redirect_network_delegate_helper.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/net/ipfs_redirect_network_delegate_helper.cc"
          },
          {
            "type": "context",
            "line": "     } else {"
          },
          {
            "type": "context",
            "line": "       ctx->blocked_by = brave::kOtherBlocked;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": "  } else if (has_ipfs_scheme) {"
          },
          {
            "type": "add",
            "line": "    // Block incorrect url."
          },
          {
            "type": "add",
            "line": "    ctx->blocked_by = brave::kOtherBlocked;"
          },
          {
            "type": "context",
            "line": "   }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   return net::OK;"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "browser/net/ipfs_redirect_network_delegate_helper_unittest.cc",
        "changes": [
          {
            "type": "context",
            "line": "index b4bad3041ad..1ec9dfc6657 100644"
          },
          {
            "type": "context",
            "line": "--- a/browser/net/ipfs_redirect_network_delegate_helper_unittest.cc"
          },
          {
            "type": "context",
            "line": "+++ b/browser/net/ipfs_redirect_network_delegate_helper_unittest.cc"
          },
          {
            "type": "context",
            "line": "   EXPECT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "context",
            "line": " }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "add",
            "line": "       LoadDisabledWhenIPFS_WhenWrongIPFSUrl) {"
          },
          {
            "type": "add",
            "line": "  profile()->GetPrefs()->SetInteger("
          },
          {
            "type": "add",
            "line": "      kIPFSResolveMethod, static_cast<int>(IPFSResolveMethodTypes::IPFS_LOCAL));"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // IPFS Subframe"
          },
          {
            "type": "add",
            "line": "  {"
          },
          {
            "type": "add",
            "line": "    GURL url(\"ipfs://10.10.10.1\");"
          },
          {
            "type": "add",
            "line": "    auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "    brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "    brave_request_info->browser_context = profile();"
          },
          {
            "type": "add",
            "line": "    int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork("
          },
          {
            "type": "add",
            "line": "        brave::ResponseCallback(), brave_request_info);"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "    ASSERT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // IPFS Mainframe"
          },
          {
            "type": "add",
            "line": "  {"
          },
          {
            "type": "add",
            "line": "    GURL url(\"ipfs://10.10.10.1\");"
          },
          {
            "type": "add",
            "line": "    auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "    brave_request_info->resource_type = blink::mojom::ResourceType::kMainFrame;"
          },
          {
            "type": "add",
            "line": "    brave_request_info->browser_context = profile();"
          },
          {
            "type": "add",
            "line": "    int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork("
          },
          {
            "type": "add",
            "line": "        brave::ResponseCallback(), brave_request_info);"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "    ASSERT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // IPNS Subframe"
          },
          {
            "type": "add",
            "line": "  {"
          },
          {
            "type": "add",
            "line": "    GURL url(\"ipns://10.10.10.1\");"
          },
          {
            "type": "add",
            "line": "    auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "    brave_request_info->resource_type = blink::mojom::ResourceType::kSubFrame;"
          },
          {
            "type": "add",
            "line": "    brave_request_info->browser_context = profile();"
          },
          {
            "type": "add",
            "line": "    int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork("
          },
          {
            "type": "add",
            "line": "        brave::ResponseCallback(), brave_request_info);"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "    ASSERT_EQ(brave_request_info->blocked_by, brave::kOtherBlocked);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "  // IPFS Mainframe"
          },
          {
            "type": "add",
            "line": "  {"
          },
          {
            "type": "add",
            "line": "    GURL url(\"ipns://10.10.10.1\");"
          },
          {
            "type": "add",
            "line": "    auto brave_request_info = std::make_shared<brave::BraveRequestInfo>(url);"
          },
          {
            "type": "add",
            "line": "    brave_request_info->resource_type = blink::mojom::ResourceType::kMainFrame;"
          },
          {
            "type": "add",
            "line": "    brave_request_info->browser_context = profile();"
          },
          {
            "type": "add",
            "line": "    int rc = ipfs::OnBeforeURLRequest_IPFSRedirectWork("
          },
          {
            "type": "add",
            "line": "        brave::ResponseCallback(), brave_request_info);"
          },
          {
            "type": "add",
            "line": "    EXPECT_EQ(rc, net::OK);"
          },
          {
            "type": "add",
            "line": "    // It is correct ipns url."
          },
          {
            "type": "add",
            "line": "    ASSERT_EQ(brave_request_info->blocked_by, brave::kNotBlocked);"
          },
          {
            "type": "add",
            "line": "  }"
          },
          {
            "type": "add",
            "line": "}"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " TEST_F(IPFSRedirectNetworkDelegateHelperTest,"
          },
          {
            "type": "context",
            "line": "        SubFrameRequestDisabledWhen_NoContext) {"
          },
          {
            "type": "context",
            "line": "   profile()->GetPrefs()->SetInteger("
          }
        ]
      }
    ]
  },
  {
    "commit": "e8118a7381213f5cfcdeb4cec1d2d854bfd261c8",
    "files": [
      {
        "file": "ChangeLog",
        "changes": [
          {
            "type": "context",
            "line": "index 96e2ee5a6..e18646c91 100644"
          },
          {
            "type": "context",
            "line": "--- a/ChangeLog"
          },
          {
            "type": "context",
            "line": "+++ b/ChangeLog"
          },
          {
            "type": "add",
            "line": "Changes in squid-6.6 (5 Dec 2023):"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "\t- Bug 5328: Fix ESI build with libxml2 v2.12.0"
          },
          {
            "type": "add",
            "line": "\t- Bug 5319: QOS Netfilter MARK preservation is always disabled"
          },
          {
            "type": "add",
            "line": "\t- Bug 5318: peer_digest.cc:399: \"fetch->pd && receivedData.data\""
          },
          {
            "type": "add",
            "line": "\t- Bug 5317: FATAL attempt to read data from memory"
          },
          {
            "type": "add",
            "line": "\t- Bug 5154: Do not open IPv6 sockets when IPv6 is disabled"
          },
          {
            "type": "add",
            "line": "\t- FTP: Ignore credentials with a NUL-prefixed username"
          },
          {
            "type": "add",
            "line": "\t- log_db_daemon: Fix DSN construction"
          },
          {
            "type": "add",
            "line": "\t- Limit the number of allowed X-Forwarded-For hops"
          },
          {
            "type": "add",
            "line": "\t- Do not update StoreEntry expiration after errorAppendEntry()"
          },
          {
            "type": "add",
            "line": "\t- improve handling of response sending errors"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": " Changes in squid-6.5 (5 Nov 2023):"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t- Bug 5309: frequent \"lowestOffset () <= target_offset\" assertion"
          }
        ]
      },
      {
        "file": "configure.ac",
        "changes": [
          {
            "type": "context",
            "line": "index aac6cab5a..93fce775b 100644"
          },
          {
            "type": "context",
            "line": "--- a/configure.ac"
          },
          {
            "type": "context",
            "line": "+++ b/configure.ac"
          },
          {
            "type": "context",
            "line": " ## Please see the COPYING and CONTRIBUTORS files for details."
          },
          {
            "type": "context",
            "line": " ##"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "AC_INIT([Squid Web Proxy],[6.5-VCS],[https://bugs.squid-cache.org/],[squid])"
          },
          {
            "type": "add",
            "line": "AC_INIT([Squid Web Proxy],[6.6-VCS],[https://bugs.squid-cache.org/],[squid])"
          },
          {
            "type": "context",
            "line": " AC_PREREQ(2.61)"
          },
          {
            "type": "context",
            "line": " AC_CONFIG_HEADERS([include/autoconf.h])"
          },
          {
            "type": "context",
            "line": " AC_CONFIG_AUX_DIR(cfgaux)"
          }
        ]
      }
    ]
  },
  {
    "commit": "ea71ec7ee062aae8d1fa7a7325aaa759205c17d8",
    "files": [
      {
        "file": "src/www/file/file_utils.php",
        "changes": [
          {
            "type": "context",
            "line": "index 7e52811a041..6b96ba8fb13 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/www/file/file_utils.php"
          },
          {
            "type": "context",
            "line": "+++ b/src/www/file/file_utils.php"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " */"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "function frs_show_release_popup($group_id, $name = 'release_id', $checked_val = \"xzxz\")"
          },
          {
            "type": "delete",
            "line": "{"
          },
          {
            "type": "delete",
            "line": "    /*"
          },
          {
            "type": "delete",
            "line": "        return a pop-up select box of releases for the project"
          },
          {
            "type": "delete",
            "line": "    */"
          },
          {
            "type": "delete",
            "line": "    global $FRS_RELEASE_ID_RES,$FRS_RELEASE_NAME_RES,$Language;"
          },
          {
            "type": "delete",
            "line": "    $release_factory = new FRSReleaseFactory();"
          },
          {
            "type": "delete",
            "line": "    if (! $group_id) {"
          },
          {
            "type": "delete",
            "line": "        return $Language->getText('file_file_utils', 'g_id_err');"
          },
          {
            "type": "delete",
            "line": "    } else {"
          },
          {
            "type": "delete",
            "line": "        if (! isset($FRS_RELEASE_ID_RES)) {"
          },
          {
            "type": "delete",
            "line": "            $res                  = $release_factory->getFRSReleasesInfoListFromDb($group_id);"
          },
          {
            "type": "delete",
            "line": "            $FRS_RELEASE_ID_RES   = [];"
          },
          {
            "type": "delete",
            "line": "            $FRS_RELEASE_NAME_RES = [];"
          },
          {
            "type": "delete",
            "line": "            foreach ($res as $release) {"
          },
          {
            "type": "delete",
            "line": "                $FRS_RELEASE_ID_RES[]   = $release['release_id'];"
          },
          {
            "type": "delete",
            "line": "                $FRS_RELEASE_NAME_RES[] = $release['package_name'] . ':' . $release['release_name'];"
          },
          {
            "type": "delete",
            "line": "            }"
          },
          {
            "type": "delete",
            "line": "        }"
          },
          {
            "type": "delete",
            "line": "        return html_build_select_box_from_arrays($FRS_RELEASE_ID_RES, $FRS_RELEASE_NAME_RES, $name, $checked_val, false);"
          },
          {
            "type": "delete",
            "line": "    }"
          },
          {
            "type": "delete",
            "line": "}"
          },
          {
            "type": "context",
            "line": " function frs_show_release_popup2($group_id, $name = 'release_id', $checked_val = \"xzxz\")"
          },
          {
            "type": "context",
            "line": " {"
          },
          {
            "type": "context",
            "line": "     /*"
          },
          {
            "type": "context",
            "line": "             $p[$release['package_name']][$release['release_id']] = $release['release_name'];"
          },
          {
            "type": "context",
            "line": "         }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "        $select = '<select name=\"' . $name . '\">';"
          },
          {
            "type": "add",
            "line": "        $select = '<select name=\"' . $hp->purify($name) . '\">';"
          },
          {
            "type": "context",
            "line": "         foreach ($p as $package_name => $releases) {"
          },
          {
            "type": "delete",
            "line": "            $select .= '<optgroup label=\"' . $package_name . '\">';"
          },
          {
            "type": "add",
            "line": "            $select .= '<optgroup label=\"' . $hp->purify($package_name) . '\">';"
          },
          {
            "type": "context",
            "line": "             foreach ($releases as $id => $name) {"
          },
          {
            "type": "delete",
            "line": "                $select .= '<option value=\"' . $id . '\" ' . ($id == $checked_val ? 'selected=\"selected\"' : '') . '>' . $hp->purify($name) . '</option>';"
          },
          {
            "type": "add",
            "line": "                $select .= '<option value=\"' . $hp->purify($id) . '\" ' . ($id == $checked_val ? 'selected=\"selected\"' : '') . '>' . $hp->purify($name) . '</option>';"
          },
          {
            "type": "context",
            "line": "             }"
          },
          {
            "type": "context",
            "line": "             $select .= '</optgroup>';"
          },
          {
            "type": "context",
            "line": "         }"
          }
        ]
      }
    ]
  },
  {
    "commit": "f3fc5808fe9ff74042d639839610d03b8fdcc015",
    "files": [
      {
        "file": "crypto/poly1305/asm/poly1305-ppc.pl",
        "changes": [
          {
            "type": "context",
            "line": "index 9f86134d92..2e601bb9c2 100755"
          },
          {
            "type": "context",
            "line": "--- a/crypto/poly1305/asm/poly1305-ppc.pl"
          },
          {
            "type": "context",
            "line": "+++ b/crypto/poly1305/asm/poly1305-ppc.pl"
          },
          {
            "type": "context",
            "line": " my $LOCALS= 6*$SIZE_T;"
          },
          {
            "type": "context",
            "line": " my $VSXFRAME = $LOCALS + 6*$SIZE_T;"
          },
          {
            "type": "context",
            "line": "    $VSXFRAME += 128;\t# local variables"
          },
          {
            "type": "delete",
            "line": "   $VSXFRAME += 13*16;\t# v20-v31 offload"
          },
          {
            "type": "add",
            "line": "   $VSXFRAME += 12*16;\t# v20-v31 offload"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " my $BIG_ENDIAN = ($flavour !~ /le/) ? 4 : 0;"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv22,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv23,r10,$sp"
          },
          {
            "type": "delete",
            "line": "\taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv24,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv23,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv25,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv24,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "add",
            "line": "\tstvx\tv25,r11,$sp"
          },
          {
            "type": "add",
            "line": "\taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv26,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv27,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv22,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv23,r10,$sp"
          },
          {
            "type": "delete",
            "line": "\taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv24,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv23,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tstvx\tv25,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tstvx\tv24,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "add",
            "line": "\tstvx\tv25,r11,$sp"
          },
          {
            "type": "add",
            "line": "\taddi\tr11,r11,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv26,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "context",
            "line": " \tstvx\tv27,r11,$sp"
          },
          {
            "type": "context",
            "line": " \tmtspr\t256,r12\t\t\t\t# restore vrsave"
          },
          {
            "type": "context",
            "line": " \tlvx\tv20,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv21,r10,$sp"
          },
          {
            "type": "delete",
            "line": "\taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv22,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv21,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv23,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv22,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv24,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv23,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv25,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv24,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv26,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv25,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv27,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv26,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv28,r11,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv27,r11,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr11,r11,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv29,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv28,r10,$sp"
          },
          {
            "type": "context",
            "line": " \taddi\tr10,r10,32"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv30,r11,$sp"
          },
          {
            "type": "delete",
            "line": "\tlvx\tv31,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv29,r11,$sp"
          },
          {
            "type": "add",
            "line": "\taddi\tr11,r11,32"
          },
          {
            "type": "add",
            "line": "\tlvx\tv30,r10,$sp"
          },
          {
            "type": "add",
            "line": "\tlvx\tv31,r11,$sp"
          },
          {
            "type": "context",
            "line": " \t$POP\tr27,`$VSXFRAME-$SIZE_T*5`($sp)"
          },
          {
            "type": "context",
            "line": " \t$POP\tr28,`$VSXFRAME-$SIZE_T*4`($sp)"
          },
          {
            "type": "context",
            "line": " \t$POP\tr29,`$VSXFRAME-$SIZE_T*3`($sp)"
          }
        ]
      }
    ]
  },
  {
    "commit": "f698b5d5066cfe594102ae252cd58a1fe57cf56f",
    "files": [
      {
        "file": "ctx.go",
        "changes": [
          {
            "type": "context",
            "line": "index abac99f1..603a7ba0 100644"
          },
          {
            "type": "context",
            "line": "--- a/ctx.go"
          },
          {
            "type": "context",
            "line": "+++ b/ctx.go"
          },
          {
            "type": "context",
            "line": " \tif len(filename) > 0 {"
          },
          {
            "type": "context",
            "line": " \t\tfname := filepath.Base(filename[0])"
          },
          {
            "type": "context",
            "line": " \t\tctx.Type(filepath.Ext(fname))"
          },
          {
            "type": "delete",
            "line": "\t\tctx.Set(HeaderContentDisposition, `attachment; filename=\"`+fname+`\"`)"
          },
          {
            "type": "add",
            "line": "\t\tctx.Set(HeaderContentDisposition, `attachment; filename=\"`+url.QueryEscape(fname)+`\"`)"
          },
          {
            "type": "context",
            "line": " \t\treturn"
          },
          {
            "type": "context",
            "line": " \t}"
          },
          {
            "type": "context",
            "line": " \tctx.Set(HeaderContentDisposition, \"attachment\")"
          }
        ]
      }
    ]
  },
  {
    "commit": "f6d28fe2c95c678cc3202cc5dc825a3fcc709e93",
    "files": [
      {
        "file": "src/ex_cmds.c",
        "changes": [
          {
            "type": "context",
            "line": "index 4f1d93244..566ed7dad 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/ex_cmds.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/ex_cmds.c"
          },
          {
            "type": "context",
            "line": " \t\t{"
          },
          {
            "type": "context",
            "line": " \t\t    nmatch = curbuf->b_ml.ml_line_count - sub_firstlnum + 1;"
          },
          {
            "type": "context",
            "line": " \t\t    skip_match = TRUE;"
          },
          {
            "type": "add",
            "line": "\t\t    // safety check"
          },
          {
            "type": "add",
            "line": "\t\t    if (nmatch < 0)"
          },
          {
            "type": "add",
            "line": "\t\t\tgoto skip;"
          },
          {
            "type": "context",
            "line": " \t\t}"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\t// Need room for:"
          }
        ]
      },
      {
        "file": "src/testdir/crash/vim_regsub_both_poc",
        "changes": [
          {
            "type": "context",
            "line": "new file mode 100644"
          },
          {
            "type": "context",
            "line": "index 000000000..19a57114b"
          },
          {
            "type": "context",
            "line": "Binary files /dev/null and b/src/testdir/crash/vim_regsub_both_poc differ"
          }
        ]
      },
      {
        "file": "src/testdir/test_crash.vim",
        "changes": [
          {
            "type": "context",
            "line": "index e0884e5a0..f7b528c3e 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/testdir/test_crash.vim"
          },
          {
            "type": "context",
            "line": "+++ b/src/testdir/test_crash.vim"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   let file = 'crash/poc_tagfunc.vim'"
          },
          {
            "type": "context",
            "line": "   let args = printf(cmn_args, vim, file)"
          },
          {
            "type": "add",
            "line": "  \" using || because this poc causes vim to exit with exitstatus != 0"
          },
          {
            "type": "context",
            "line": "   call term_sendkeys(buf, args .."
          },
          {
            "type": "context",
            "line": "     \\ '  || echo \"crash 5: [OK]\" >> X_crash1_result.txt' .. \"\\<cr>\")"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   call delete('X')"
          },
          {
            "type": "context",
            "line": "   call TermWait(buf, 3000)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "  let file = 'crash/vim_regsub_both_poc'"
          },
          {
            "type": "add",
            "line": "  let args = printf(cmn_args, vim, file)"
          },
          {
            "type": "add",
            "line": "  \" using || because this poc causes vim to exit with exitstatus != 0"
          },
          {
            "type": "add",
            "line": "  call term_sendkeys(buf, args .."
          },
          {
            "type": "add",
            "line": "    \\ '  && echo \"crash 7: [OK]\" >> X_crash1_result.txt' .. \"\\<cr>\")"
          },
          {
            "type": "add",
            "line": "  call TermWait(buf, 1000)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   \" clean up"
          },
          {
            "type": "context",
            "line": "   exe buf .. \"bw!\""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "       \\ 'crash 4: [OK]',"
          },
          {
            "type": "context",
            "line": "       \\ 'crash 5: [OK]',"
          },
          {
            "type": "context",
            "line": "       \\ 'crash 6: [OK]',"
          },
          {
            "type": "add",
            "line": "      \\ 'crash 7: [OK]',"
          },
          {
            "type": "context",
            "line": "       \\ ]"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "   call assert_equal(expected, getline(1, '$'))"
          }
        ]
      },
      {
        "file": "src/version.c",
        "changes": [
          {
            "type": "context",
            "line": "index a5e570e93..2faa9e668 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/version.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/version.c"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " static int included_patches[] ="
          },
          {
            "type": "context",
            "line": " {   /* Add new patch number below this line */"
          },
          {
            "type": "add",
            "line": "/**/"
          },
          {
            "type": "add",
            "line": "    1873,"
          },
          {
            "type": "context",
            "line": " /**/"
          },
          {
            "type": "context",
            "line": "     1872,"
          },
          {
            "type": "context",
            "line": " /**/"
          }
        ]
      },
      {
        "file": "src/window.c",
        "changes": [
          {
            "type": "context",
            "line": "index 1af2395df..f77ede330 100644"
          },
          {
            "type": "context",
            "line": "--- a/src/window.c"
          },
          {
            "type": "context",
            "line": "+++ b/src/window.c"
          },
          {
            "type": "context",
            "line": " \tbeep_flush();"
          },
          {
            "type": "context",
            "line": " \treturn;"
          },
          {
            "type": "context",
            "line": "     }"
          },
          {
            "type": "add",
            "line": "    if (text_or_buf_locked())"
          },
          {
            "type": "add",
            "line": "    {"
          },
          {
            "type": "add",
            "line": "\tbeep_flush();"
          },
          {
            "type": "add",
            "line": "\treturn;"
          },
          {
            "type": "add",
            "line": "    }"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " #ifdef FEAT_GUI"
          },
          {
            "type": "context",
            "line": "     need_mouse_correct = TRUE;"
          }
        ]
      }
    ]
  },
  {
    "commit": "f931d9d129002f54a495995774ce7384174cef5c",
    "files": [
      {
        "file": "label_studio/core/settings/base.py",
        "changes": [
          {
            "type": "context",
            "line": "index 26ab1861a..57b8ac9a7 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/core/settings/base.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/core/settings/base.py"
          },
          {
            "type": "context",
            "line": " import re"
          },
          {
            "type": "context",
            "line": " from datetime import timedelta"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "from label_studio.core.utils.params import get_bool_env"
          },
          {
            "type": "add",
            "line": "from label_studio.core.utils.params import get_bool_env, get_env_list"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " formatter = 'standard'"
          },
          {
            "type": "context",
            "line": " JSON_LOG = get_bool_env('JSON_LOG', False)"
          },
          {
            "type": "context",
            "line": " REAL_HOSTNAME = os.getenv('HOSTNAME')  # we have to use getenv, because we don't use LABEL_STUDIO_ prefix"
          },
          {
            "type": "context",
            "line": " GCS_CLOUD_STORAGE_FORCE_DEFAULT_CREDENTIALS = get_bool_env('GCS_CLOUD_STORAGE_FORCE_DEFAULT_CREDENTIALS', False)"
          },
          {
            "type": "context",
            "line": " PUBLIC_API_DOCS = get_bool_env('PUBLIC_API_DOCS', False)"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# By default, we disallow filters with foreign keys in data manager for security reasons."
          },
          {
            "type": "add",
            "line": "# Add to this list (either here in code, or via the env) to allow specific filters that rely on foreign keys."
          },
          {
            "type": "add",
            "line": "DATA_MANAGER_FILTER_ALLOWLIST = list("
          },
          {
            "type": "add",
            "line": "    set(get_env_list('DATA_MANAGER_FILTER_ALLOWLIST') + ['updated_by__active_organization'])"
          },
          {
            "type": "add",
            "line": ")"
          }
        ]
      },
      {
        "file": "label_studio/core/utils/params.py",
        "changes": [
          {
            "type": "context",
            "line": "index 1b083e308..af6043538 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/core/utils/params.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/core/utils/params.py"
          },
          {
            "type": "context",
            "line": " import os"
          },
          {
            "type": "add",
            "line": "from typing import Callable, Optional, Sequence, TypeVar"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " from rest_framework.exceptions import ValidationError"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return get_env(key, default, is_bool=True)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def get_env_list_int(key, default=None):"
          },
          {
            "type": "add",
            "line": "T = TypeVar('T')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def get_env_list("
          },
          {
            "type": "add",
            "line": "    key: str, default: Optional[Sequence[T]] = None, value_transform: Callable[[str], T] = str"
          },
          {
            "type": "add",
            "line": ") -> Sequence[T]:"
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "delete",
            "line": "    \"1,2,3\" in env variable => [1, 2, 3] in python"
          },
          {
            "type": "add",
            "line": "    \"foo,bar,baz\" in env variable => [\"foo\", \"bar\", \"baz\"] in python."
          },
          {
            "type": "add",
            "line": "    Use value_transform to convert the strings to any other type."
          },
          {
            "type": "context",
            "line": "     \"\"\""
          },
          {
            "type": "context",
            "line": "     value = get_env(key)"
          },
          {
            "type": "context",
            "line": "     if not value:"
          },
          {
            "type": "context",
            "line": "         if default is None:"
          },
          {
            "type": "context",
            "line": "             return []"
          },
          {
            "type": "context",
            "line": "         return default"
          },
          {
            "type": "delete",
            "line": "    return [int(el) for el in value.split(',')]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    return [value_transform(el) for el in value.split(',')]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "def get_env_list_int(key, default=None) -> Sequence[int]:"
          },
          {
            "type": "add",
            "line": "    return get_env_list(key, default=default, value_transform=int)"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " def get_all_env_with_prefix(prefix=None, is_bool=True, default_value=None):"
          }
        ]
      },
      {
        "file": "label_studio/data_manager/functions.py",
        "changes": [
          {
            "type": "context",
            "line": "index ba738b592..c0ab3f18c 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/data_manager/functions.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/data_manager/functions.py"
          },
          {
            "type": "context",
            "line": " \"\"\""
          },
          {
            "type": "context",
            "line": " import logging"
          },
          {
            "type": "context",
            "line": " from collections import OrderedDict"
          },
          {
            "type": "add",
            "line": "from typing import Tuple"
          },
          {
            "type": "context",
            "line": " from urllib.parse import unquote"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import ujson as json"
          },
          {
            "type": "context",
            "line": "     return _filter"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "def preprocess_field_name(raw_field_name, only_undefined_field=False):"
          },
          {
            "type": "delete",
            "line": "    field_name = raw_field_name.replace('filter:', '')"
          },
          {
            "type": "delete",
            "line": "    field_name = field_name.replace('tasks:', '')"
          },
          {
            "type": "delete",
            "line": "    ascending = False if field_name[0] == '-' else True  # detect direction"
          },
          {
            "type": "delete",
            "line": "    field_name = field_name[1:] if field_name[0] == '-' else field_name  # remove direction"
          },
          {
            "type": "add",
            "line": "def preprocess_field_name(raw_field_name, only_undefined_field=False) -> Tuple[str, bool]:"
          },
          {
            "type": "add",
            "line": "    \"\"\"Transform a field name (as specified in the datamanager views endpoint) to"
          },
          {
            "type": "add",
            "line": "    a django ORM field name. Also handle dotted accesses to task.data."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    Edit with care; it's critical that this function not be changed in ways that"
          },
          {
            "type": "add",
            "line": "    introduce vulnerabilities in the vein of the ORM Leak (see #5012). In particular"
          },
          {
            "type": "add",
            "line": "    it is not advisable to use `replace` or other calls that replace all instances"
          },
          {
            "type": "add",
            "line": "    of a string within this function."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    Returns: Django ORM field name: str, Sort is ascending: bool"
          },
          {
            "type": "add",
            "line": "    \"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    field_name = raw_field_name"
          },
          {
            "type": "add",
            "line": "    ascending = True"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # Descending marker `-` may come at the beginning of the string"
          },
          {
            "type": "add",
            "line": "    if field_name.startswith('-'):"
          },
          {
            "type": "add",
            "line": "        ascending = False"
          },
          {
            "type": "add",
            "line": "        field_name = field_name[1:]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # For security reasons, these must only be removed when they fall at the beginning of the string (or after `-`)."
          },
          {
            "type": "add",
            "line": "    optional_prefixes = ['filter:', 'tasks:']"
          },
          {
            "type": "add",
            "line": "    for prefix in optional_prefixes:"
          },
          {
            "type": "add",
            "line": "        if field_name.startswith(prefix):"
          },
          {
            "type": "add",
            "line": "            field_name = field_name[len(prefix) :]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "    # Descending marker may also come after other prefixes. Double negative is not allowed."
          },
          {
            "type": "add",
            "line": "    if ascending and field_name.startswith('-'):"
          },
          {
            "type": "add",
            "line": "        ascending = False"
          },
          {
            "type": "add",
            "line": "        field_name = field_name[1:]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "     if field_name.startswith('data.'):"
          },
          {
            "type": "context",
            "line": "         if only_undefined_field:"
          },
          {
            "type": "context",
            "line": "             field_name = f'data__{settings.DATA_UNDEFINED_NAME}'"
          }
        ]
      },
      {
        "file": "label_studio/data_manager/serializers.py",
        "changes": [
          {
            "type": "context",
            "line": "index 444207764..8451e3279 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/data_manager/serializers.py"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/data_manager/serializers.py"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " import ujson as json"
          },
          {
            "type": "context",
            "line": " from data_manager.models import Filter, FilterGroup, View"
          },
          {
            "type": "add",
            "line": "from django.conf import settings"
          },
          {
            "type": "context",
            "line": " from django.db import transaction"
          },
          {
            "type": "context",
            "line": " from projects.models import Project"
          },
          {
            "type": "context",
            "line": " from rest_framework import serializers"
          },
          {
            "type": "context",
            "line": "         model = Filter"
          },
          {
            "type": "context",
            "line": "         fields = '__all__'"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "add",
            "line": "    def validate_column(self, column: str) -> str:"
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": "        Ensure that the passed filter expression starts with 'filter:tasks:' and contains"
          },
          {
            "type": "add",
            "line": "        no foreign key traversals. This means either the filter expression contains no '__'"
          },
          {
            "type": "add",
            "line": "        substrings, or that it's the task.data json field that's accessed."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        Users depending on foreign key traversals in views can allowlist them via the"
          },
          {
            "type": "add",
            "line": "        DATA_MANAGER_FILTER_ALLOWLIST setting in the env."
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        Edit with care. The validations below are critical for security."
          },
          {
            "type": "add",
            "line": "        \"\"\""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        column_copy = column"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # We may support 'filter:annotations:' in the future, but we don't as of yet."
          },
          {
            "type": "add",
            "line": "        required_prefix = 'filter:tasks:'"
          },
          {
            "type": "add",
            "line": "        optional_prefix = '-'"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if not column_copy.startswith(required_prefix):"
          },
          {
            "type": "add",
            "line": "            raise serializers.ValidationError(f'Filter \"{column}\" should start with \"{required_prefix}\"')"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        column_copy = column_copy[len(required_prefix) :]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if column_copy.startswith(optional_prefix):"
          },
          {
            "type": "add",
            "line": "            column_copy = column_copy[len(optional_prefix) :]"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        if column_copy.startswith('data.'):"
          },
          {
            "type": "add",
            "line": "            # Allow underscores if the filter is based on the `task.data` JSONField, because these don't leverage foreign keys."
          },
          {
            "type": "add",
            "line": "            return column"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # Specific filters relying on foreign keys can be allowlisted"
          },
          {
            "type": "add",
            "line": "        if column_copy in settings.DATA_MANAGER_FILTER_ALLOWLIST:"
          },
          {
            "type": "add",
            "line": "            return column"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        # But in general, we don't allow foreign keys"
          },
          {
            "type": "add",
            "line": "        if '__' in column_copy:"
          },
          {
            "type": "add",
            "line": "            raise serializers.ValidationError("
          },
          {
            "type": "add",
            "line": "                f'\"__\" is not generally allowed in filters. Consider asking your administrator to add \"{column_copy}\" '"
          },
          {
            "type": "add",
            "line": "                'to DATA_MANAGER_FILTER_ALLOWLIST, but note that some filter expressions may pose a security risk'"
          },
          {
            "type": "add",
            "line": "            )"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        return column"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " class FilterGroupSerializer(serializers.ModelSerializer):"
          },
          {
            "type": "context",
            "line": "     filters = FilterSerializer(many=True)"
          }
        ]
      },
      {
        "file": "label_studio/tests/data_manager/api_tasks.tavern.yml",
        "changes": [
          {
            "type": "context",
            "line": "index 430ccd1f1..14026e830 100644"
          },
          {
            "type": "context",
            "line": "--- a/label_studio/tests/data_manager/api_tasks.tavern.yml"
          },
          {
            "type": "context",
            "line": "+++ b/label_studio/tests/data_manager/api_tasks.tavern.yml"
          },
          {
            "type": "context",
            "line": "   - usefixtures:"
          },
          {
            "type": "context",
            "line": "       - django_live_url"
          },
          {
            "type": "context",
            "line": " stages:"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "context",
            "line": "   - id: signup"
          },
          {
            "type": "context",
            "line": "     type: ref"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         \"total_predictions\": 0,"
          },
          {
            "type": "context",
            "line": "         \"total\": 1,"
          },
          {
            "type": "context",
            "line": "       }"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "---"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# See FilterSerializer; test logic preventing exploit that traverses the ORM"
          },
          {
            "type": "add",
            "line": "# to leak sensitive data character-by-character"
          },
          {
            "type": "add",
            "line": "test_name: tasks_api_filter_security_restrictions"
          },
          {
            "type": "add",
            "line": "strict: false"
          },
          {
            "type": "add",
            "line": "marks:"
          },
          {
            "type": "add",
            "line": "- usefixtures:"
          },
          {
            "type": "add",
            "line": "  - django_live_url"
          },
          {
            "type": "add",
            "line": "stages:"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- id: signup"
          },
          {
            "type": "add",
            "line": "  type: ref"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- id: create_project"
          },
          {
            "type": "add",
            "line": "  name: create_project"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    data:"
          },
          {
            "type": "add",
            "line": "      title: Test Draft 1"
          },
          {
            "type": "add",
            "line": "      show_collab_predictions: true"
          },
          {
            "type": "add",
            "line": "    method: POST"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/projects'"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    save:"
          },
          {
            "type": "add",
            "line": "      json:"
          },
          {
            "type": "add",
            "line": "        project_pk: id"
          },
          {
            "type": "add",
            "line": "        created_by: created_by.id"
          },
          {
            "type": "add",
            "line": "    status_code: 201"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: create view with exploit filter should fail"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: POST"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:updated_by__sensitive_field\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 400"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      validation_errors:"
          },
          {
            "type": "add",
            "line": "        filter_group:"
          },
          {
            "type": "add",
            "line": "          filters:"
          },
          {
            "type": "add",
            "line": "            - column:"
          },
          {
            "type": "add",
            "line": "              - '\"__\" is not generally allowed in filters. Consider asking your administrator to add \"updated_by__sensitive_field\" to DATA_MANAGER_FILTER_ALLOWLIST, but note that some filter expressions may pose a security risk'"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: create view with allowlisted filter should succeed"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: POST"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:updated_by__active_organization\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 201"
          },
          {
            "type": "add",
            "line": "    save:"
          },
          {
            "type": "add",
            "line": "      json:"
          },
          {
            "type": "add",
            "line": "        view_pk: id"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: change filter to typical column succeeds"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: PUT"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views/{view_pk}?interaction=filter&project={project_pk}'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:updated_by\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 200"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: change filter to unexpected prefix fails"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: PUT"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views/{view_pk}?interaction=filter&project={project_pk}'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"tasks:filter:annotations_results\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 400"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      validation_errors:"
          },
          {
            "type": "add",
            "line": "        filter_group:"
          },
          {
            "type": "add",
            "line": "          filters:"
          },
          {
            "type": "add",
            "line": "            - column:"
          },
          {
            "type": "add",
            "line": "              - 'Filter \"tasks:filter:annotations_results\" should start with \"filter:tasks:\"'"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: change filter to include direction marker succeeds"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: PUT"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views/{view_pk}?interaction=filter&project={project_pk}'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:-annotations_results\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 200"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: invalid filter with direction marker fails, but suggests correct allowlist"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: PUT"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views/{view_pk}?interaction=filter&project={project_pk}'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:-updated_by__sensitive_field\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 400"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      validation_errors:"
          },
          {
            "type": "add",
            "line": "        filter_group:"
          },
          {
            "type": "add",
            "line": "          filters:"
          },
          {
            "type": "add",
            "line": "            - column:"
          },
          {
            "type": "add",
            "line": "              - '\"__\" is not generally allowed in filters. Consider asking your administrator to add \"updated_by__sensitive_field\" to DATA_MANAGER_FILTER_ALLOWLIST, but note that some filter expressions may pose a security risk'"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: change filter to dotted data field with underscores succeeds"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: PUT"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views/{view_pk}?interaction=filter&project={project_pk}'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:data.images__0\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 200"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: change filter to valid column without prefix fails"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: PUT"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views/{view_pk}?interaction=filter&project={project_pk}'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            - filter: \"annotations_results\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 400"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      validation_errors:"
          },
          {
            "type": "add",
            "line": "        filter_group:"
          },
          {
            "type": "add",
            "line": "          filters:"
          },
          {
            "type": "add",
            "line": "            - column:"
          },
          {
            "type": "add",
            "line": "              - 'Filter \"annotations_results\" should start with \"filter:tasks:\"'"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "---"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# Regression test preventing replace-all of prefixes from being used to construct exploit filters"
          },
          {
            "type": "add",
            "line": "test_name: tasks_api_prevent_prefix_regression"
          },
          {
            "type": "add",
            "line": "strict: false"
          },
          {
            "type": "add",
            "line": "marks:"
          },
          {
            "type": "add",
            "line": "- usefixtures:"
          },
          {
            "type": "add",
            "line": "  - django_live_url"
          },
          {
            "type": "add",
            "line": "stages:"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- id: signup"
          },
          {
            "type": "add",
            "line": "  type: ref"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- id: create_project"
          },
          {
            "type": "add",
            "line": "  name: create_project"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    data:"
          },
          {
            "type": "add",
            "line": "      title: Test Draft 1"
          },
          {
            "type": "add",
            "line": "      show_collab_predictions: true"
          },
          {
            "type": "add",
            "line": "    method: POST"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/projects'"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    save:"
          },
          {
            "type": "add",
            "line": "      json:"
          },
          {
            "type": "add",
            "line": "        project_pk: id"
          },
          {
            "type": "add",
            "line": "        created_by: created_by.id"
          },
          {
            "type": "add",
            "line": "    status_code: 201"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "# Perhaps our validation should be further improved, but for now, it's"
          },
          {
            "type": "add",
            "line": "# garbage in, garbage out."
          },
          {
            "type": "add",
            "line": "- name: create view with prefix in middle of filter should succeed"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: POST"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/dm/views'"
          },
          {
            "type": "add",
            "line": "    json:"
          },
          {
            "type": "add",
            "line": "      project: '{project_pk}'"
          },
          {
            "type": "add",
            "line": "      data:"
          },
          {
            "type": "add",
            "line": "        filters:"
          },
          {
            "type": "add",
            "line": "          conjunction: and"
          },
          {
            "type": "add",
            "line": "          items:"
          },
          {
            "type": "add",
            "line": "            # in an earlier version, preprocess_field_name would have"
          },
          {
            "type": "add",
            "line": "            # transformed this to updated_by__sensitive_field"
          },
          {
            "type": "add",
            "line": "            - filter: \"filter:tasks:updated_by_tasks:_sensitive_field\""
          },
          {
            "type": "add",
            "line": "              operator: empty"
          },
          {
            "type": "add",
            "line": "              value: \"true\""
          },
          {
            "type": "add",
            "line": "              type: String"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    status_code: 201"
          },
          {
            "type": "add",
            "line": "    save:"
          },
          {
            "type": "add",
            "line": "      json:"
          },
          {
            "type": "add",
            "line": "        view_pk: id"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "- name: get_tasks fails because \"updated_by_tasks:_sensitive_field\" doesn't resolve to a field"
          },
          {
            "type": "add",
            "line": "  request:"
          },
          {
            "type": "add",
            "line": "    method: GET"
          },
          {
            "type": "add",
            "line": "    url: '{django_live_url}/api/tasks?view={view_pk}'"
          },
          {
            "type": "add",
            "line": "  response:"
          },
          {
            "type": "add",
            "line": "    # 500 actually expected here"
          },
          {
            "type": "add",
            "line": "    status_code: 500"
          }
        ]
      }
    ]
  },
  {
    "commit": "fd90a490c0e5cacd17bfe0ffc422be1d2a9b1c13",
    "files": [
      {
        "file": "ReactNativeClient/lijoplin-renderer/htmlUtils.js",
        "changes": [
          {
            "type": "context",
            "line": "index f9af4d978..a9581f70a 100644"
          },
          {
            "type": "context",
            "line": "--- a/ReactNativeClient/lib/joplin-renderer/htmlUtils.js"
          },
          {
            "type": "context",
            "line": "+++ b/ReactNativeClient/lib/joplin-renderer/htmlUtils.js"
          },
          {
            "type": "context",
            "line": " \t\t\treturn tagStack[tagStack.length - 1];"
          },
          {
            "type": "context",
            "line": " \t\t};"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "\t\t// The BASE tag allows changing the base URL from which files are loaded, and"
          },
          {
            "type": "delete",
            "line": "\t\t// that can break several plugins, such as Katex (which needs to load CSS"
          },
          {
            "type": "delete",
            "line": "\t\t// files using a relative URL). For that reason it is disabled."
          },
          {
            "type": "delete",
            "line": "\t\t// More info: https://github.com/laurent22/joplin/issues/3021"
          },
          {
            "type": "delete",
            "line": "\t\tconst disallowedTags = ['script', 'iframe', 'frameset', 'frame', 'object', 'base', 'embed'];"
          },
          {
            "type": "add",
            "line": "\t\t// The BASE tag allows changing the base URL from which files are"
          },
          {
            "type": "add",
            "line": "\t\t// loaded, and that can break several plugins, such as Katex (which"
          },
          {
            "type": "add",
            "line": "\t\t// needs to load CSS files using a relative URL). For that reason"
          },
          {
            "type": "add",
            "line": "\t\t// it is disabled. More info:"
          },
          {
            "type": "add",
            "line": "\t\t// https://github.com/laurent22/joplin/issues/3021"
          },
          {
            "type": "add",
            "line": "\t\t//"
          },
          {
            "type": "add",
            "line": "\t\t// \"link\" can be used to escape the parser and inject JavaScript."
          },
          {
            "type": "add",
            "line": "\t\t// Adding \"meta\" too for the same reason as it shouldn't be used in"
          },
          {
            "type": "add",
            "line": "\t\t// notes anyway."
          },
          {
            "type": "add",
            "line": "\t\tconst disallowedTags = ['script', 'iframe', 'frameset', 'frame', 'object', 'base', 'embed', 'link', 'meta'];"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": " \t\tconst parser = new htmlparser2.Parser({"
          }
        ]
      }
    ]
  },
  {
    "commit": "ffd3f762ce4a8de3b8962f33513e073c55d943b5",
    "files": [
      {
        "file": "client/res/templates/attachment/fields/name/detail.tpl",
        "changes": [
          {
            "type": "context",
            "line": "index 454f6eebaf..ee4a129e43 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/res/templates/attachment/fields/name/detail.tpl"
          },
          {
            "type": "context",
            "line": "+++ b/client/res/templates/attachment/fields/name/detail.tpl"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "<span class=\"fas fa-paperclip small\"></span> <a href=\"{{url}}\">{{{value}}}</a>"
          },
          {
            "type": "add",
            "line": "<span class=\"fas fa-paperclip small\"></span> <a href=\"{{url}}\">{{value}}</a>"
          }
        ]
      },
      {
        "file": "client/src/view-helper.js",
        "changes": [
          {
            "type": "context",
            "line": "index be2724fb64..40b31acf73 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/view-helper.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/view-helper.js"
          },
          {
            "type": "context",
            "line": "         sanitizeHtml: function (text, options) {"
          },
          {
            "type": "context",
            "line": "             return DOMPurify.sanitize(text, options);"
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        moderateSanitizeHtml: function (value) {"
          },
          {
            "type": "add",
            "line": "            value = value || '';"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[\\/]{0,1}(base)[^><]*>/gi, '');"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[\\/]{0,1}(object)[^><]*>/gi, '');"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[\\/]{0,1}(embed)[^><]*>/gi, '');"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[\\/]{0,1}(applet)[^><]*>/gi, '');"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[\\/]{0,1}(iframe)[^><]*>/gi, '');"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[\\/]{0,1}(script)[^><]*>/gi, '');"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/<[^><]*([^a-z]{1}on[a-z]+)=[^><]*>/gi, function (match) {"
          },
          {
            "type": "add",
            "line": "                return match.replace(/[^a-z]{1}on[a-z]+=/gi, ' data-handler-stripped=');"
          },
          {
            "type": "add",
            "line": "            });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            value = this.stripEventHandlersInHtml(value);"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            value = value.replace(/href=\" *javascript\\:(.*?)\"/gi, function(m, $1) {"
          },
          {
            "type": "add",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "add",
            "line": "            });"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/href=' *javascript\\:(.*?)'/gi, function(m, $1) {"
          },
          {
            "type": "add",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "add",
            "line": "            });"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/src=\" *javascript\\:(.*?)\"/gi, function(m, $1) {"
          },
          {
            "type": "add",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "add",
            "line": "            });"
          },
          {
            "type": "add",
            "line": "            value = value.replace(/src=' *javascript\\:(.*?)'/gi, function(m, $1) {"
          },
          {
            "type": "add",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "add",
            "line": "            });"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "            return value;"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "add",
            "line": ""
          },
          {
            "type": "add",
            "line": "        stripEventHandlersInHtml: function (html) {"
          },
          {
            "type": "add",
            "line": "            function stripHTML(){"
          },
          {
            "type": "add",
            "line": "                html = html.slice(0, strip) + html.slice(j);"
          },
          {
            "type": "add",
            "line": "                j = strip;"
          },
          {
            "type": "add",
            "line": "                strip = false;"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            function isValidTagChar(str) {"
          },
          {
            "type": "add",
            "line": "                return str.match(/[a-z?\\\\\\/!]/i);"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            var strip = false;"
          },
          {
            "type": "add",
            "line": "            var lastQuote = false;"
          },
          {
            "type": "add",
            "line": "            for (var i = 0; i<html.length; i++){"
          },
          {
            "type": "add",
            "line": "                if (html[i] === \"<\" && html[i+1] && isValidTagChar(html[i+1])) {"
          },
          {
            "type": "add",
            "line": "                    i++;"
          },
          {
            "type": "add",
            "line": "                    for (var j = i; j<html.length; j++){"
          },
          {
            "type": "add",
            "line": "                        if (!lastQuote && html[j] === \">\"){"
          },
          {
            "type": "add",
            "line": "                            if (strip) {"
          },
          {
            "type": "add",
            "line": "                                stripHTML();"
          },
          {
            "type": "add",
            "line": "                            }"
          },
          {
            "type": "add",
            "line": "                            i = j;"
          },
          {
            "type": "add",
            "line": "                            break;"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "add",
            "line": "                        if (lastQuote === html[j]){"
          },
          {
            "type": "add",
            "line": "                            lastQuote = false;"
          },
          {
            "type": "add",
            "line": "                            continue;"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "add",
            "line": "                        if (!lastQuote && html[j-1] === \"=\" && (html[j] === \"'\" || html[j] === '\"')){"
          },
          {
            "type": "add",
            "line": "                            lastQuote = html[j];"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "add",
            "line": "                        if (!lastQuote && html[j-2] === \" \" && html[j-1] === \"o\" && html[j] === \"n\"){"
          },
          {
            "type": "add",
            "line": "                            strip = j-2;"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "add",
            "line": "                        if (strip && html[j] === \" \" && !lastQuote){"
          },
          {
            "type": "add",
            "line": "                            stripHTML();"
          },
          {
            "type": "add",
            "line": "                        }"
          },
          {
            "type": "add",
            "line": "                    }"
          },
          {
            "type": "add",
            "line": "                }"
          },
          {
            "type": "add",
            "line": "            }"
          },
          {
            "type": "add",
            "line": "            return html;"
          },
          {
            "type": "add",
            "line": "        },"
          },
          {
            "type": "context",
            "line": "     });"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return ViewHelper;"
          }
        ]
      },
      {
        "file": "client/src/views/attachment/fields/name.js",
        "changes": [
          {
            "type": "context",
            "line": "index 0f0cb268f4..ee012ede06 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/attachment/fields/name.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/attachment/fields/name.js"
          },
          {
            "type": "context",
            "line": "  * these Appropriate Legal Notices must retain the display of tтhe \"EspoCRM\" word."
          },
          {
            "type": "context",
            "line": "  ************************************************************************/"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Espo.define('views/attachment/fields/name', 'views/fields/varchar', function (Dep) {"
          },
          {
            "type": "add",
            "line": "define('views/attachment/fields/name', 'views/fields/varchar', function (Dep) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return Dep.extend({"
          },
          {
            "type": "context",
            "line": ""
          }
        ]
      },
      {
        "file": "client/src/views/fields/wysiwyg.js",
        "changes": [
          {
            "type": "context",
            "line": "index a7b2c02d4d..b96086eb1c 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/fields/wysiwyg.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/fields/wysiwyg.js"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         sanitizeHtmlLight: function (value) {"
          },
          {
            "type": "delete",
            "line": "            value = value || '';"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[\\/]{0,1}(base)[^><]*>/gi, '');"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[\\/]{0,1}(object)[^><]*>/gi, '');"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[\\/]{0,1}(embed)[^><]*>/gi, '');"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[\\/]{0,1}(applet)[^><]*>/gi, '');"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[\\/]{0,1}(iframe)[^><]*>/gi, '');"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[\\/]{0,1}(script)[^><]*>/gi, '');"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/<[^><]*([^a-z]{1}on[a-z]+)=[^><]*>/gi, function (match) {"
          },
          {
            "type": "delete",
            "line": "                return match.replace(/[^a-z]{1}on[a-z]+=/gi, ' data-handler-stripped=');"
          },
          {
            "type": "delete",
            "line": "            });"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/href=\" *javascript\\:(.*?)\"/gi, function(m, $1) {"
          },
          {
            "type": "delete",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "delete",
            "line": "            });"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/href=' *javascript\\:(.*?)'/gi, function(m, $1) {"
          },
          {
            "type": "delete",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "delete",
            "line": "            });"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/src=\" *javascript\\:(.*?)\"/gi, function(m, $1) {"
          },
          {
            "type": "delete",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "delete",
            "line": "            });"
          },
          {
            "type": "delete",
            "line": "            value = value.replace(/src=' *javascript\\:(.*?)'/gi, function(m, $1) {"
          },
          {
            "type": "delete",
            "line": "                return 'removed=\"\"';"
          },
          {
            "type": "delete",
            "line": "            });"
          },
          {
            "type": "delete",
            "line": "            return value;"
          },
          {
            "type": "add",
            "line": "           return this.getHelper().moderateSanitizeHtml(value);"
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "         getValueForEdit: function () {"
          }
        ]
      },
      {
        "file": "client/src/views/preferences/fields/dashboard-tab-list.js",
        "changes": [
          {
            "type": "context",
            "line": "index b8a855f2c7..c043154ef7 100644"
          },
          {
            "type": "context",
            "line": "--- a/client/src/views/preferences/fields/dashboard-tab-list.js"
          },
          {
            "type": "context",
            "line": "+++ b/client/src/views/preferences/fields/dashboard-tab-list.js"
          },
          {
            "type": "context",
            "line": "  * these Appropriate Legal Notices must retain the display of the \"EspoCRM\" word."
          },
          {
            "type": "context",
            "line": "  ************************************************************************/"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "delete",
            "line": "Espo.define('views/preferences/fields/dashboard-tab-list', 'views/fields/array', function (Dep) {"
          },
          {
            "type": "add",
            "line": "define('views/preferences/fields/dashboard-tab-list', 'views/fields/array', function (Dep) {"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "     return Dep.extend({"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "                 this.translatedOptions[value] = value;"
          },
          {
            "type": "context",
            "line": "             }, this);"
          },
          {
            "type": "context",
            "line": "         },"
          },
          {
            "type": "delete",
            "line": ""
          },
          {
            "type": "context",
            "line": "         getItemHtml: function (value) {"
          },
          {
            "type": "delete",
            "line": "            var translatedValue = this.translatedOptions[value] || value;"
          },
          {
            "type": "add",
            "line": "            value = value.toString();"
          },
          {
            "type": "add",
            "line": "            var valueSanitized = this.escapeValue(value);"
          },
          {
            "type": "add",
            "line": "            var translatedValue = this.escapeValue(this.translatedOptions[value] || value);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var html = '' +"
          },
          {
            "type": "delete",
            "line": "            '<div class=\"list-group-item link-with-role form-inline\" data-value=\"' + value + '\">' +"
          },
          {
            "type": "add",
            "line": "            '<div class=\"list-group-item link-with-role form-inline\" data-value=\"' + valueSanitized + '\">' +"
          },
          {
            "type": "context",
            "line": "                 '<div class=\"pull-left\" style=\"width: 92%; display: inline-block;\">' +"
          },
          {
            "type": "delete",
            "line": "                    '<input data-name=\"translatedValue\" data-value=\"' + value + '\" class=\"role form-control input-sm\" value=\"'+translatedValue+'\">' +"
          },
          {
            "type": "add",
            "line": "                    '<input data-name=\"translatedValue\" data-value=\"' + valueSanitized + '\" class=\"role form-control input-sm\" value=\"'+translatedValue+'\">' +"
          },
          {
            "type": "context",
            "line": "                 '</div>' +"
          },
          {
            "type": "context",
            "line": "                 '<div style=\"width: 8%; display: inline-block; vertical-align: top;\">' +"
          },
          {
            "type": "delete",
            "line": "                    '<a href=\"javascript:\" class=\"pull-right\" data-value=\"' + value + '\" data-action=\"removeValue\"><span class=\"fas fa-times\"></a>' +"
          },
          {
            "type": "add",
            "line": "                    '<a href=\"javascript:\" class=\"pull-right\" data-value=\"' + valueSanitized + '\" data-action=\"removeValue\"><span class=\"fas fa-times\"></a>' +"
          },
          {
            "type": "context",
            "line": "                 '</div><br style=\"clear: both;\" />' +"
          },
          {
            "type": "context",
            "line": "             '</div>';"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             var data = Dep.prototype.fetch.call(this);"
          },
          {
            "type": "context",
            "line": "             data.translatedOptions = {};"
          },
          {
            "type": "context",
            "line": "             (data[this.name] || []).forEach(function (value) {"
          },
          {
            "type": "delete",
            "line": "                data.translatedOptions[value] = this.$el.find('input[data-name=\"translatedValue\"][data-value=\"'+value+'\"]').val() || value;"
          },
          {
            "type": "add",
            "line": "                var valueInternal = value.replace(/\"/g, '\\\\\"');"
          },
          {
            "type": "add",
            "line": "                data.translatedOptions[value] = this.$el.find('input[data-name=\"translatedValue\"][data-value=\"'+valueInternal+'\"]').val() || value;"
          },
          {
            "type": "context",
            "line": "             }, this);"
          },
          {
            "type": "context",
            "line": ""
          },
          {
            "type": "context",
            "line": "             return data;"
          }
        ]
      }
    ]
  }
]