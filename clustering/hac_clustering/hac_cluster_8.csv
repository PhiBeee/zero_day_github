commit,file,added_code,deleted_code,hash_clean,cve_id,hash,repo_url,rel_type,score,extraction_status,text_norm,cluster_kmeans,cluster_hac
xwiki-platform_1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392,xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-ui/src/test/java/org/xwikiplatform/appwithinminutes/ClassEditSheetPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwikiplatform.appwithinminutes;

import java.util.List;

import org.jsoup.nodes.Document;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.xwiki.groovy.internal.DefaultGroovyConfiguration;
import org.xwiki.groovy.internal.GroovyScriptEngineFactory;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.query.Query;
import org.xwiki.query.script.QueryManagerScriptService;
import org.xwiki.rendering.internal.macro.groovy.GroovyMacro;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.script.service.ScriptService;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.when;

/**
 * Page Test of {@code AppWithinMinutes.ClassEditSheet}.
 *
 * @version $Id$
 * @since 14.4.8
 * @since 14.10.4
 * @since 15.0
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@ComponentList({
    // Start GroovyMacro
    GroovyMacro.class,
    GroovyScriptEngineFactory.class,
    DefaultGroovyConfiguration.class
    // End GroovyMacro
})
class ClassEditSheetPageTest extends PageTest
{
    private QueryManagerScriptService queryManagerScriptService;

    @Mock
    private Query query;

    @BeforeEach
    void setUp() throws Exception
    {
        this.queryManagerScriptService =
            this.componentManager.registerMockComponent(ScriptService.class, ""query"", QueryManagerScriptService.class,
                false);
    }

    @Test
    void displayFieldPalette() throws Exception
    {
        loadPage(new DocumentReference(""xwiki"", ""AppWithinMinutes"", ""VelocityMacros""));
        loadPage(new DocumentReference(""xwiki"", ""AppWithinMinutes"", ""ClassEditSheet""));

        when(this.queryManagerScriptService.xwql(""from doc.object(AppWithinMinutes.FormFieldCategoryClass) as category ""
            + ""order by category.priority"")).thenReturn(this.query);
        when(this.query.execute()).thenReturn(List.of(""xwiki:XWiki.Category""));

        XWikiDocument xWikiDocumentCategory =
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""XWiki"", ""Category""), this.context);
        xWikiDocumentCategory.setTitle(""<strong>TITLE</strong>"");
        this.xwiki.saveDocument(xWikiDocumentCategory, this.context);

        XWikiDocument xwikiDocument =
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""Space"", ""Page""), this.context);

        xwikiDocument.setContent(""{{include reference=\""AppWithinMinutes.ClassEditSheet\"" /}}\n""
            + ""\n""
            + ""{{velocity}}\n""
            + ""#displayFieldPalette()\n""
            + ""{{/velocity}}\n"");
        xwikiDocument.setSyntax(Syntax.XWIKI_2_1);
        this.xwiki.saveDocument(xwikiDocument, this.context);

        Document document = renderHTMLPage(xwikiDocument);

        assertEquals(""<strong>TITLE</strong>"", document.selectFirst("".category"").text());
    }
}",,1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392,CVE-2023-35153,1b87fec1e5b5ec00b7a8c3c3f94f6c5e22547392,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 14.4.8 * @VAR 14.10.4 * @VAR 15.0 */ @VAR @VAR @VAR({  VAR.VAR, VAR.VAR, VAR.VAR  }) VAR VAR VAR VAR { VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR.VAR = VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR, VAR); } @VAR VAR VAR() VAR VAR { VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(VAR.VAR.VAR(""VAR VAR.VAR(VAR.VAR) VAR VAR "" + ""VAR VAR VAR.VAR"")).VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR.VAR(""VAR:VAR.VAR"")); VAR VAR = VAR.VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR); VAR.VAR(""<VAR>VAR</VAR>""); VAR.VAR.VAR(VAR, VAR.VAR); VAR VAR = VAR.VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR); VAR.VAR(""{{VAR VAR=\""VAR.VAR\"" /}}\VAR"" + ""\VAR"" + ""{{VAR}}\VAR"" + "" + ""{{/VAR}}\VAR""); VAR.VAR(VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR VAR = VAR(VAR); VAR(""<VAR>VAR</VAR>"", VAR.VAR("".VAR"").VAR()); } } ",5,8
xwiki-platform_217e5bb7a657f2991b154a16ef4d5ae9c29ad39c,xwiki-platform-core/xwiki-platform-notifications/xwiki-platform-notifications-ui/src/test/java/org/xwiki/notifications/NotificationRSSServicePageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.notifications;

import java.io.IOException;
import java.io.PrintWriter;
import java.io.Reader;
import java.io.StringWriter;
import java.util.List;

import org.apache.commons.io.IOUtils;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.notifications.notifiers.script.NotificationNotifiersScriptService;
import org.xwiki.notifications.script.NotificationScriptService;
import org.xwiki.rendering.block.WordBlock;
import org.xwiki.rendering.internal.code.layout.PlainLayoutHandler;
import org.xwiki.rendering.internal.macro.code.CodeMacro;
import org.xwiki.rendering.internal.macro.code.source.DefaultCodeMacroSourceFactory;
import org.xwiki.rendering.internal.macro.code.source.ScriptCodeMacroSourceFactory;
import org.xwiki.rendering.internal.macro.script.source.ScriptMacroContentWikiSourceFactory;
import org.xwiki.rendering.internal.macro.source.MacroContentSourceReferenceConverter;
import org.xwiki.rendering.parser.HighlightParser;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.script.service.ScriptService;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.test.mockito.MockitoComponentManager;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.text.StringUtils;

import com.xpn.xwiki.web.XWikiServletResponseStub;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyInt;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.when;

/**
 * Test for {@code NotificationRSSService}.
 *
 * @version $Id$
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@ComponentList({
    CodeMacro.class,
    DefaultCodeMacroSourceFactory.class,
    ScriptCodeMacroSourceFactory.class,
    ScriptMacroContentWikiSourceFactory.class,
    MacroContentSourceReferenceConverter.class,
    PlainLayoutHandler.class
})
class NotificationRSSServicePageTest extends PageTest
{
    private static final DocumentReference RSS_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", List.of(""XWiki"", ""Notifications"", ""Code""), ""NotificationRSSService"");

    private static final String NOTIFIERS_HINT = ""notification.notifiers"";

    private NotificationNotifiersScriptService notifiersScriptService;

    @MockComponent
    private HighlightParser highlightParser;

    @BeforeEach
    public void setUp(MockitoComponentManager componentManager) throws Exception
    {
        NotificationScriptService notificationScriptService =
            componentManager.registerMockComponent(ScriptService.class, ""notification"",
                NotificationScriptService.class, false);
        this.notifiersScriptService = componentManager.registerMockComponent(ScriptService.class,
            NOTIFIERS_HINT, NotificationNotifiersScriptService.class, false);
        when(notificationScriptService.get(""notifiers"")).thenReturn(this.notifiersScriptService);
    }

    @Test
    void rssResult() throws Exception
    {
        loadPage(RSS_DOCUMENT_REFERENCE);
        this.request.put(""outputSyntax"", ""plain"");
        this.setOutputSyntax(Syntax.PLAIN_1_0);
        this.context.setAction(""get"");

        String testContent = ""//Test//"";
        when(this.notifiersScriptService.getFeed(anyInt())).thenReturn(testContent);

        StringWriter out = new StringWriter();
        PrintWriter writer = new PrintWriter(out);

        this.response = new XWikiServletResponseStub() {
            @Override
            public PrintWriter getWriter() throws IOException
            {
                return writer;
            }
        };
        this.context.setResponse(this.response);

        String result = renderPage(RSS_DOCUMENT_REFERENCE);
        assertTrue(StringUtils.isAllBlank(result));
        assertEquals(testContent, out.toString());
    }

    @Test
    void codeMacroResult() throws Exception
    {
        loadPage(RSS_DOCUMENT_REFERENCE);

        String testContent = ""{{/code}}"";
        when(this.notifiersScriptService.getFeed(anyInt())).thenReturn(testContent);
        when(this.highlightParser.highlight(eq(""xml""), any())).then(invocation ->
        {
            Reader source = invocation.getArgument(1);
            return List.of(new WordBlock(IOUtils.toString(source)));
        });
        String result = renderPage(RSS_DOCUMENT_REFERENCE);
        assertEquals(""<div class=\""box\""><div class=\""code\"">&#123;&#123;/code}}</div></div>"", result);
    }
}",,217e5bb7a657f2991b154a16ef4d5ae9c29ad39c,CVE-2023-36469,217e5bb7a657f2991b154a16ef4d5ae9c29ad39c,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", VAR.VAR(""VAR"", ""VAR"", ""VAR""), ""VAR""); VAR VAR VAR VAR VAR = ""VAR.VAR""; VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR(VAR VAR) VAR VAR { VAR VAR = VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR, VAR); VAR.VAR = VAR.VAR(VAR.VAR, VAR, VAR.VAR, VAR); VAR(VAR.VAR(""VAR"")).VAR(VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR(VAR); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR(VAR.VAR); VAR.VAR.VAR(""VAR""); VAR VAR = "" VAR(VAR.VAR.VAR(VAR())).VAR(VAR); VAR VAR = VAR VAR(); VAR VAR = VAR VAR(VAR); VAR.VAR = VAR VAR() { @VAR VAR VAR VAR() VAR VAR { VAR VAR; } }; VAR.VAR.VAR(VAR.VAR); VAR VAR = VAR(VAR); VAR(VAR.VAR(VAR)); VAR(VAR, VAR.VAR()); } @VAR VAR VAR() VAR VAR { VAR(VAR); VAR VAR = ""{{/VAR}}""; VAR(VAR.VAR.VAR(VAR())).VAR(VAR); VAR(VAR.VAR.VAR(VAR(""VAR""), VAR())).VAR(VAR -> { VAR VAR = VAR.VAR(1); VAR VAR.VAR(VAR VAR(VAR.VAR(VAR))); }); VAR VAR = VAR(VAR); VAR(""<VAR VAR=\""VAR\""><VAR VAR=\""VAR\"">& } } ",5,8
xwiki-platform_22f249a0eb9f2a64214628217e812a994419b69f,xwiki-platform-core/xwiki-platform-panels/xwiki-platform-panels-ui/src/test/java/org/xwiki/panels/IncludedPagesDocumentInformationPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.panels;

import org.jsoup.nodes.Document;
import org.jsoup.select.Elements;
import org.junit.jupiter.api.Test;
import org.xwiki.bridge.event.DocumentCreatedEvent;
import org.xwiki.component.manager.ComponentManager;
import org.xwiki.component.wiki.internal.DefaultWikiComponentManager;
import org.xwiki.component.wiki.internal.DefaultWikiComponentManagerContext;
import org.xwiki.component.wiki.internal.WikiComponentManagerEventListenerHelper;
import org.xwiki.component.wiki.internal.bridge.DefaultContentParser;
import org.xwiki.component.wiki.internal.bridge.DefaultWikiObjectComponentManagerEventListener;
import org.xwiki.component.wiki.internal.bridge.WikiObjectComponentManagerEventListenerProxy;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.observation.EventListener;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.async.internal.block.DefaultBlockAsyncRenderer;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.security.authorization.AuthorizationManager;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.uiextension.internal.DefaultUIExtensionManager;
import org.xwiki.uiextension.internal.WikiUIExtensionComponentBuilder;
import org.xwiki.uiextension.script.UIExtensionScriptService;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.xwiki.component.wiki.internal.bridge.DefaultWikiObjectComponentManagerEventListener.EVENT_LISTENER_NAME;

/**
 * Test of {@code Panels.IncludedPagesDocumentInformation}.
 *
 * @version $Id$
 * @since 14.10RC1
 * @since 14.4.7
 */
@XWikiSyntax21ComponentList
@HTML50ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    UIExtensionScriptService.class,
    DefaultUIExtensionManager.class,
    DefaultWikiObjectComponentManagerEventListener.class,
    WikiObjectComponentManagerEventListenerProxy.class,
    WikiComponentManagerEventListenerHelper.class,
    DefaultWikiComponentManager.class,
    DefaultWikiComponentManagerContext.class,
    WikiUIExtensionComponentBuilder.class,
    DefaultContentParser.class,
    // Start - Required in addition of RenderingScriptServiceComponentList
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    // End - Required in additional of RenderingScriptServiceComponentList
    DefaultBlockAsyncRenderer.class,
    TestNoScriptMacro.class
})
class IncludedPagesDocumentInformationPageTest extends PageTest
{
    @Test
    void render() throws Exception
    {
        // Load the UIX.
        XWikiDocument includedPagesDoc =
            loadPage(new DocumentReference(""xwiki"", ""Panels"", ""IncludedPagesDocumentInformation""));
        this.componentManager.registerComponent(ComponentManager.class, ""wiki"", this.componentManager);
        AuthorizationManager authorizationManager =
            this.componentManager.registerMockComponent(AuthorizationManager.class);
        when(authorizationManager.hasAccess(any(), any(), any())).thenReturn(true);
        // The listeners are not registered by default. We trigger it manually so that the UIX is registered and can be
        // found and rendered.
        this.componentManager.<EventListener>getInstance(EventListener.class, EVENT_LISTENER_NAME)
            .onEvent(new DocumentCreatedEvent(), includedPagesDoc, null);

        // We initialize a document with an include macro, so that the UIX has something to render.
        this.context.setDoc(initDocWithInclude());
        // Create the UIXP so that the UIX can be rendered.
        Document document = renderHTMLPage(initUIXPDoc());
        Elements as = document.select(""a"");
        assertEquals(""XWiki.{{noscript}}\"">]]<strong>bold</strong>\"""", as.get(0).attr(""href""));
        assertEquals(""path:/xwiki/bin/edit/XWiki/%7B%7Bnoscript%7D%7D%22%3E%5D%5D%3Cstrong%3Ebold%3C%2Fstrong%3E%22"",
            as.get(1).attr(""href""));
        assertEquals(""panels.documentInformation.editIncluded [XWiki.{{noscript}}\"">]]<strong>bold</strong>\""]"",
            as.get(1).selectFirst(""img"").attr(""alt""));
    }

    private XWikiDocument initDocWithInclude()
    {
        XWikiDocument document = new XWikiDocument(new DocumentReference(""xwiki"", ""XWiki"", ""PageWithReference""));
        document.setSyntax(Syntax.XWIKI_2_0);
        document.setContent(""{{display reference=\""{{noscript~}~}~\"">]]<strong>bold</strong>~\""\""/}}"");
        return document;
    }

    private static XWikiDocument initUIXPDoc()
    {
        XWikiDocument document = new XWikiDocument(new DocumentReference(""xwiki"", ""XWiki"", ""Test""));
        document.setSyntax(Syntax.XWIKI_2_0);
        document.setContent(""{{velocity}}\n""
            + ""{{html}}\n""
            + ""#foreach ($extension in $services.uix.getExtensions('org.xwiki.platform.panels.documentInformation'))\n""
            + ""  $services.rendering.render($extension.execute(), 'html/5.0')\n""
            + ""#end\n""
            + ""{{/html}}""
            + ""{{/velocity}}"");
        return document;
    }
}",,22f249a0eb9f2a64214628217e812a994419b69f,CVE-2023-29212,22f249a0eb9f2a64214628217e812a994419b69f,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 14.10RC1 * @VAR 14.4.7 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { @VAR VAR VAR() VAR VAR {  VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR); VAR VAR = VAR.VAR.VAR(VAR.VAR); VAR(VAR.VAR(VAR(), VAR(), VAR())).VAR(VAR);   VAR.VAR.<VAR>VAR(VAR.VAR, VAR) .VAR(VAR VAR(), VAR, VAR);  VAR.VAR.VAR(VAR());  VAR VAR = VAR(VAR()); VAR VAR = VAR.VAR(""VAR""); VAR(""VAR.{{VAR}}\"">]]<VAR>VAR</VAR>\"""", VAR.VAR(0).VAR(""VAR"")); VAR(""VAR:/VAR/VAR/VAR/VAR/%7B%7Bnoscript%7D%7D%22%3E%5D%5D%3Cstrong%3Ebold%3C%2Fstrong%3E%22"", VAR.VAR(1).VAR(""VAR"")); VAR(""VAR.VAR.VAR [VAR.{{VAR}}\"">]]<VAR>VAR</VAR>\""]"", VAR.VAR(1).VAR(""VAR"").VAR(""VAR"")); } VAR VAR VAR() { VAR VAR = VAR VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR.VAR(VAR.VAR); VAR.VAR(""{{VAR VAR=\""{{VAR~}~}~\"">]]<VAR>VAR</VAR>~\""\""/}}""); VAR VAR; } VAR VAR VAR VAR() { VAR VAR = VAR VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR.VAR(VAR.VAR); VAR.VAR(""{{VAR}}\VAR"" + ""{{VAR}}\VAR"" + "" + "" $VAR.VAR.VAR($VAR.VAR(), 'VAR/5.0')\VAR"" + "" + ""{{/VAR}}"" + ""{{/VAR}}""); VAR VAR; } } ",5,8
xwiki-platform_38dc1aa1a4435f24d58f5b8e4566cbcb0971f8ff,xwiki-platform-core/xwiki-platform-rest/xwiki-platform-rest-server/src/test/java/org/xwiki/rest/internal/resources/ModificationsResourceImplTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.rest.internal.resources;

import java.net.URI;
import java.sql.Timestamp;
import java.util.Calendar;
import java.util.Date;

import javax.inject.Named;
import javax.inject.Provider;
import javax.ws.rs.core.UriInfo;

import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.suigeneris.jrcs.rcs.Version;
import org.xwiki.component.manager.ComponentManager;
import org.xwiki.component.util.ReflectionUtils;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.reference.DocumentReferenceResolver;
import org.xwiki.model.reference.EntityReferenceSerializer;
import org.xwiki.model.reference.SpaceReference;
import org.xwiki.model.reference.SpaceReferenceResolver;
import org.xwiki.model.reference.WikiReference;
import org.xwiki.query.Query;
import org.xwiki.query.QueryManager;
import org.xwiki.rest.model.jaxb.History;
import org.xwiki.rest.model.jaxb.HistorySummary;
import org.xwiki.rest.model.jaxb.Link;
import org.xwiki.security.authorization.ContextualAuthorizationManager;
import org.xwiki.test.annotation.BeforeComponent;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectComponentManager;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.test.mockito.MockitoComponentManager;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.doc.rcs.XWikiRCSNodeId;
import com.xpn.xwiki.web.Utils;

import static java.util.Arrays.asList;
import static java.util.Collections.singleton;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyInt;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;
import static org.xwiki.security.authorization.Right.VIEW;

/**
 * Test of {@link ModificationsResourceImpl}.
 *
 * @version $Id$
 * @since 14.6
 * @since 14.4.3
 * @since 13.10.8
 */
@ComponentTest
class ModificationsResourceImplTest
{
    @InjectMockComponents
    private ModificationsResourceImpl modificationsResource;

    @MockComponent
    private ContextualAuthorizationManager authorizationManager;

    @MockComponent
    private DocumentReferenceResolver<String> resolver;

    @MockComponent
    private QueryManager queryManager;

    @MockComponent
    private SpaceReferenceResolver<String> spaceReferenceResolver;

    @MockComponent
    private EntityReferenceSerializer<String> entityReferenceSerializer;

    @MockComponent
    private Provider<XWikiContext> xcontextProvider;

    @MockComponent
    @Named(""local"")
    private EntityReferenceSerializer<String> localEntityReferenceSerializer;

    @InjectComponentManager
    private MockitoComponentManager componentManager;

    @Mock
    private Query query;

    @Mock
    private XWikiContext xcontext;

    @BeforeComponent
    void beforeComponent() throws Exception
    {
        this.xcontext = mock(XWikiContext.class);
        when(this.xcontextProvider.get()).thenReturn(this.xcontext);
        this.componentManager.registerComponent(ComponentManager.class, ""context"", this.componentManager);
    }

    @Test
    void getModifications() throws Exception
    {
        when(this.xcontextProvider.get()).thenReturn(this.xcontext);
        UriInfo uriInfo = mock(UriInfo.class);
        when(uriInfo.getBaseUri()).thenReturn(new URI(""/xwiki/rest""));
        ReflectionUtils.setFieldValue(this.modificationsResource, ""uriInfo"", uriInfo);
        Utils.setComponentManager(this.componentManager);

        when(this.queryManager.createQuery(
            ""select doc.space, doc.name, doc.language, rcs.id, rcs.date, rcs.author, rcs.comment ""
                + ""from XWikiRCSNodeInfo as rcs, XWikiDocument as doc ""
                + ""where rcs.id.docId = doc.id ""
                + ""and rcs.date > :date ""
                + ""order by rcs.date desc, rcs.id.version1 desc, rcs.id.version2 desc"",
            Query.XWQL)).thenReturn(this.query);
        when(this.query.bindValue(any(), any())).thenReturn(this.query);
        when(this.query.setLimit(anyInt())).thenReturn(this.query);
        when(this.query.setOffset(anyInt())).thenReturn(this.query);
        when(this.query.setWiki(any())).thenReturn(this.query);
        when(this.query.execute()).thenReturn(asList(
            new Object[] {
                ""Space"",
                ""Viewable"",
                ""en"",
                new XWikiRCSNodeId(new WikiReference(""wikiId""), 42, new Version(1, 1)),
                new Timestamp(1),
                ""modifierViewable"",
                ""commentViewable""
            },
            new Object[] {
                ""Space"",
                ""NotViewable"",
                ""fr"",
                new XWikiRCSNodeId(new WikiReference(""wikiId""), 43, new Version(1, 2)),
                new Timestamp(2),
                ""modifierNotViewable"",
                ""commentNotViewable""
            }
        ));

        DocumentReference viewableDocumentReference = new DocumentReference(""wikiId"", ""Space"", ""Viewable"");
        DocumentReference notViewableDocumentReference = new DocumentReference(""wikiId"", ""Space"", ""NotViewable"");
        SpaceReference whateverSpaceReference = new SpaceReference(""Space"", new WikiReference(""whatever""));
        String viewableSerializedReference = ""wikiId:Space.Viewable"";
        String notViewableSerializedReference = ""wikiId:Space.NotViewable"";

        when(this.authorizationManager.hasAccess(VIEW, viewableDocumentReference)).thenReturn(true);
        when(this.authorizationManager.hasAccess(VIEW, notViewableDocumentReference)).thenReturn(false);
        when(this.spaceReferenceResolver.resolve(""Space"", new WikiReference(""whatever"")))
            .thenReturn(whateverSpaceReference);
        when(this.entityReferenceSerializer.serialize(viewableDocumentReference))
            .thenReturn(viewableSerializedReference);
        when(this.resolver.resolve(viewableSerializedReference)).thenReturn(viewableDocumentReference);
        when(this.entityReferenceSerializer.serialize(notViewableDocumentReference))
            .thenReturn(notViewableSerializedReference);
        when(this.resolver.resolve(notViewableSerializedReference)).thenReturn(notViewableDocumentReference);
        when(this.localEntityReferenceSerializer.serialize(whateverSpaceReference)).thenReturn(""Space"");

        History history = this.modificationsResource.getModifications(""wikiId"", 0, 10, ""desc"", 1L, false);

        HistorySummary expectedHistorySummary = new HistorySummary();
        expectedHistorySummary.setPageId(""wikiId:Space.Viewable"");
        expectedHistorySummary.setWiki(""wikiId"");
        expectedHistorySummary.setSpace(""Space"");
        expectedHistorySummary.setName(""Viewable"");
        expectedHistorySummary.setVersion(""1.1"");
        expectedHistorySummary.setMajorVersion(1);
        expectedHistorySummary.setMinorVersion(1);
        Calendar expectedCalendar = Calendar.getInstance();
        expectedCalendar.setTime(new Date(new Timestamp(1).getTime()));
        expectedHistorySummary.setModified(expectedCalendar);
        expectedHistorySummary.setModifier(""modifierViewable"");
        expectedHistorySummary.setLanguage(""en"");
        expectedHistorySummary.setComment(""commentViewable"");
        Link expectedLink = new Link();
        expectedLink.setHref(""/xwiki/rest/wikis/wikiId/spaces/Space/pages/Viewable/translations/en/history/1.1"");
        expectedLink.setRel(""http://www.xwiki.org/rel/page"");
        expectedHistorySummary.withLinks(expectedLink);
        ObjectMapper objectMapper = new ObjectMapper();
        assertEquals(objectMapper.writeValueAsString(singleton(expectedHistorySummary)),
            objectMapper.writeValueAsString(history.getHistorySummaries()));
    }
}",,38dc1aa1a4435f24d58f5b8e4566cbcb0971f8ff,CVE-2022-41936,38dc1aa1a4435f24d58f5b8e4566cbcb0971f8ff,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.6 * @VAR 14.4.3 * @VAR 13.10.8 */ @VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR<VAR> VAR; @VAR @VAR(""VAR"") VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR.VAR = VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR()).VAR(VAR VAR(""/VAR/VAR"")); VAR.VAR(VAR.VAR, ""VAR"", VAR); VAR.VAR(VAR.VAR); VAR(VAR.VAR.VAR( ""VAR VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR "" + ""VAR VAR VAR VAR, VAR VAR VAR "" + ""VAR VAR.VAR.VAR = VAR.VAR "" + ""VAR VAR.VAR > :VAR "" + ""VAR VAR VAR.VAR VAR, VAR.VAR.VAR VAR, VAR.VAR.VAR VAR"", VAR.VAR)).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR(), VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR( VAR VAR[] { ""VAR"", ""VAR"", ""VAR"", VAR VAR(VAR VAR(""VAR""), 42, VAR VAR(1, 1)), VAR VAR(1), ""VAR"", ""VAR"" }, VAR VAR[] { ""VAR"", ""VAR"", ""VAR"", VAR VAR(VAR VAR(""VAR""), 43, VAR VAR(1, 2)), VAR VAR(2), ""VAR"", ""VAR"" } )); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR = VAR VAR(""VAR"", VAR VAR(""VAR"")); VAR VAR = ""VAR:VAR.VAR""; VAR VAR = ""VAR:VAR.VAR""; VAR(VAR.VAR.VAR(VAR, VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR, VAR)).VAR(VAR); VAR(VAR.VAR.VAR(""VAR"", VAR VAR(""VAR""))) .VAR(VAR); VAR(VAR.VAR.VAR(VAR)) .VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)) .VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(""VAR""); VAR VAR = VAR.VAR.VAR(""VAR"", 0, 10, ""VAR"", 1L, VAR); VAR VAR = VAR VAR(); VAR.VAR(""VAR:VAR.VAR""); VAR.VAR(""VAR""); VAR.VAR(""VAR""); VAR.VAR(""VAR""); VAR.VAR(""1.1""); VAR.VAR(1); VAR.VAR(1); VAR VAR = VAR.VAR(); VAR.VAR(VAR VAR(VAR VAR(1).VAR())); VAR.VAR(VAR); VAR.VAR(""VAR""); VAR.VAR(""VAR""); VAR.VAR(""VAR""); VAR VAR = VAR VAR(); VAR.VAR(""/VAR/VAR/VAR/VAR/VAR/VAR/VAR/VAR/VAR/VAR/VAR/1.1""); VAR.VAR(""VAR: VAR.VAR(VAR); VAR VAR = VAR VAR(); VAR(VAR.VAR(VAR(VAR)), VAR.VAR(VAR.VAR())); } } ",5,8
xwiki-platform_3c73c59e39b6436b1074d8834cf276916010014d,xwiki-platform-core/xwiki-platform-store/xwiki-platform-store-filesystem-oldcore/src/test/java/org/xwiki/store/script/TemporaryAttachmentsScriptServiceTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.store.script;

import java.io.IOException;
import java.util.stream.Stream;

import javax.inject.Provider;
import javax.servlet.ServletException;
import javax.servlet.http.Part;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.RegisterExtension;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.MethodSource;
import org.mockito.Mock;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.store.TemporaryAttachmentException;
import org.xwiki.store.TemporaryAttachmentSessionsManager;
import org.xwiki.test.LogLevel;
import org.xwiki.test.junit5.LogCaptureExtension;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;

import com.xpn.xwiki.XWiki;
import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.api.Attachment;
import com.xpn.xwiki.doc.XWikiAttachment;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.user.api.XWikiRightService;
import com.xpn.xwiki.web.XWikiRequest;

import ch.qos.logback.classic.Level;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNull;
import static org.junit.jupiter.api.Assertions.assertSame;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Test of {@link TemporaryAttachmentsScriptService}.
 *
 * @version $Id$
 * @since 14.9RC1
 */
@ComponentTest
class TemporaryAttachmentsScriptServiceTest
{
    private static final DocumentReference DOCUMENT_REFERENCE = new DocumentReference(""xwiki"", ""XWiki"", ""Doc"");

    @InjectMockComponents
    private TemporaryAttachmentsScriptService temporaryAttachmentsScriptService;

    @MockComponent
    private Provider<XWikiContext> contextProvider;

    @MockComponent
    private TemporaryAttachmentSessionsManager temporaryAttachmentSessionsManager;

    @Mock
    private XWikiContext context;

    @Mock
    private XWikiRequest request;

    @Mock
    private Part part;

    @Mock
    private XWiki wiki;

    @Mock
    private XWikiDocument xWikiDocument;

    @RegisterExtension
    LogCaptureExtension logCapture = new LogCaptureExtension(LogLevel.WARN);

    @BeforeEach
    void setUp() throws Exception
    {
        when(this.contextProvider.get()).thenReturn(this.context);
        when(this.context.getRequest()).thenReturn(this.request);
        when(this.context.getWiki()).thenReturn(this.wiki);
        when(this.wiki.getDocument(DOCUMENT_REFERENCE, this.context)).thenReturn(this.xWikiDocument);
        XWikiRightService xWikiRightService = mock(XWikiRightService.class);
        when(this.wiki.getRightService()).thenReturn(xWikiRightService);
        when(xWikiRightService.hasProgrammingRights(this.context)).thenReturn(true);
    }

    @Test
    void uploadTemporaryAttachment() throws Exception
    {
        XWikiAttachment xWikiAttachment = mock(XWikiAttachment.class);

        when(this.request.getPart(""upload"")).thenReturn(this.part);
        when(this.temporaryAttachmentSessionsManager.uploadAttachment(DOCUMENT_REFERENCE, this.part))
            .thenReturn(xWikiAttachment);

        Attachment temporaryAttachment =
            this.temporaryAttachmentsScriptService.uploadTemporaryAttachment(DOCUMENT_REFERENCE, ""upload"");

        assertSame(xWikiAttachment, temporaryAttachment.getAttachment());

        verify(this.temporaryAttachmentSessionsManager).uploadAttachment(DOCUMENT_REFERENCE, this.part);
    }

    @ParameterizedTest
    @MethodSource(""provideUploadTemporaryAttachmentWithException"")
    void uploadTemporaryAttachmentPartWithException(Class<? extends Throwable> exceptionType, String expectedMessage)
        throws Exception
    {
        when(this.request.getPart(""upload"")).thenThrow(exceptionType);

        assertNull(this.temporaryAttachmentsScriptService.uploadTemporaryAttachment(DOCUMENT_REFERENCE,
            ""upload""));

        verify(this.temporaryAttachmentSessionsManager, never()).uploadAttachment(DOCUMENT_REFERENCE, this.part);
        assertEquals(expectedMessage, this.logCapture.getMessage(0));
        assertEquals(Level.WARN, this.logCapture.getLogEvent(0).getLevel());
    }

    public static Stream<Arguments> provideUploadTemporaryAttachmentWithException()
    {
        return Stream.of(
            Arguments.of(IOException.class, ""Error while reading the request content part: [IOException: ]""),
            Arguments.of(ServletException.class, ""Error while reading the request content part: [ServletException: ]"")
        );
    }

    @Test
    void uploadTemporaryAttachmentWithException()
        throws Exception
    {
        when(this.request.getPart(""upload"")).thenReturn(this.part);
        when(this.temporaryAttachmentSessionsManager.uploadAttachment(DOCUMENT_REFERENCE, this.part))
            .thenThrow(TemporaryAttachmentException.class);

        assertNull(this.temporaryAttachmentsScriptService.uploadTemporaryAttachment(DOCUMENT_REFERENCE,
            ""upload""));

        assertEquals(""Error while uploading the attachment: [TemporaryAttachmentException: ]"",
            this.logCapture.getMessage(0));
        assertEquals(Level.WARN, this.logCapture.getLogEvent(0).getLevel());
    }
}
",,3c73c59e39b6436b1074d8834cf276916010014d,CVE-2023-26478,3c73c59e39b6436b1074d8834cf276916010014d,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.9RC1 */ @VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR = VAR VAR(VAR.VAR); @VAR VAR VAR() VAR VAR { VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR, VAR.VAR)).VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR); VAR(VAR.VAR(VAR.VAR)).VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR.VAR(""VAR"")).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR, VAR.VAR)) .VAR(VAR); VAR VAR = VAR.VAR.VAR(VAR, ""VAR""); VAR(VAR, VAR.VAR()); VAR(VAR.VAR).VAR(VAR, VAR.VAR); } @VAR @VAR(""VAR"") VAR VAR(VAR<? VAR VAR> VAR, VAR VAR) VAR VAR { VAR(VAR.VAR.VAR(""VAR"")).VAR(VAR); VAR(VAR.VAR.VAR(VAR, ""VAR"")); VAR(VAR.VAR, VAR()).VAR(VAR, VAR.VAR); VAR(VAR, VAR.VAR.VAR(0)); VAR(VAR.VAR, VAR.VAR.VAR(0).VAR()); } VAR VAR VAR<VAR> VAR() { VAR VAR.VAR( VAR.VAR(VAR.VAR, ""VAR VAR VAR VAR VAR VAR VAR: [VAR: ]""), VAR.VAR(VAR.VAR, ""VAR VAR VAR VAR VAR VAR VAR: [VAR: ]"") ); } @VAR VAR VAR() VAR VAR { VAR(VAR.VAR.VAR(""VAR"")).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR, VAR.VAR)) .VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR, ""VAR"")); VAR(""VAR VAR VAR VAR VAR: [VAR: ]"", VAR.VAR.VAR(0)); VAR(VAR.VAR, VAR.VAR.VAR(0).VAR()); } } ",5,8
xwiki-platform_45d182a4141ff22f3ff289cf71e4669bdc714544,xwiki-platform-core/xwiki-platform-office/xwiki-platform-office-importer/src/main/java/org/xwiki/officeimporter/document/OfficeDocumentArtifact.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.officeimporter.document;

import java.io.InputStream;

import org.xwiki.officeimporter.OfficeImporterException;
import org.xwiki.stability.Unstable;

/**
 * An artifact for an office document.
 *
 * @version $Id$
 * @since 14.10.8
 * @since 15.3RC1
 */
@Unstable
public interface OfficeDocumentArtifact
{
    /**
     * @return the name of the artifact
     */
    String getName();

    /**
     * @return an input stream for reading the artifact's content
     */
    InputStream getContentInputStream() throws OfficeImporterException;
}",,45d182a4141ff22f3ff289cf71e4669bdc714544,CVE-2023-37913,45d182a4141ff22f3ff289cf71e4669bdc714544,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10.8 * @VAR 15.3RC1 */ @VAR VAR VAR VAR { /** * @VAR VAR VAR VAR VAR VAR */ VAR VAR(); /** * @VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR */ VAR VAR() VAR VAR; } ",5,8
xwiki-platform_45d182a4141ff22f3ff289cf71e4669bdc714544,xwiki-platform-core/xwiki-platform-office/xwiki-platform-office-importer/src/main/java/org/xwiki/officeimporter/internal/document/ByteArrayOfficeDocumentArtifact.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.officeimporter.internal.document;

import java.io.ByteArrayInputStream;
import java.io.InputStream;

import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.xwiki.officeimporter.document.OfficeDocumentArtifact;

/**
 * A {@link OfficeDocumentArtifact} backed by a byte array.
 *
 * @version $Id$
 * @since 14.10.8
 * @since 15.3RC1
 */
public class ByteArrayOfficeDocumentArtifact implements OfficeDocumentArtifact
{
    private final String name;

    private final byte[] content;

    /**
     * Construct a new {@link OfficeDocumentArtifact} backed by a byte array.
     *
     * @param name the name of the artifact
     * @param content the content as byte array
     */
    public ByteArrayOfficeDocumentArtifact(String name, byte[] content)
    {
        this.name = name;
        this.content = content;
    }

    @Override
    public String getName()
    {
        return this.name;
    }

    @Override
    public InputStream getContentInputStream()
    {
        return new ByteArrayInputStream(this.content);
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) {
            return true;
        }

        if (o == null || getClass() != o.getClass()) {
            return false;
        }

        ByteArrayOfficeDocumentArtifact that = (ByteArrayOfficeDocumentArtifact) o;

        return new EqualsBuilder().append(getName(), that.getName())
            .append(this.content, that.content).isEquals();
    }

    @Override
    public int hashCode()
    {
        return new HashCodeBuilder(17, 37).append(getName()).toHashCode();
    }
}",,45d182a4141ff22f3ff289cf71e4669bdc714544,CVE-2023-37913,45d182a4141ff22f3ff289cf71e4669bdc714544,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR {@VAR VAR} VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10.8 * @VAR 15.3RC1 */ VAR VAR VAR VAR VAR { VAR VAR VAR VAR; VAR VAR VAR[] VAR; /** * VAR VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR. * * @VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(VAR VAR, VAR[] VAR) { VAR.VAR = VAR; VAR.VAR = VAR; } @VAR VAR VAR VAR() { VAR VAR.VAR; } @VAR VAR VAR VAR() { VAR VAR VAR(VAR.VAR); } @VAR VAR VAR VAR(VAR VAR) { VAR (VAR == VAR) { VAR VAR; } VAR (VAR == VAR || VAR() != VAR.VAR()) { VAR VAR; } VAR VAR = (VAR) VAR; VAR VAR VAR().VAR(VAR(), VAR.VAR()) .VAR(VAR.VAR, VAR.VAR).VAR(); } @VAR VAR VAR VAR() { VAR VAR VAR(17, 37).VAR(VAR()).VAR(); } } ",5,8
xwiki-platform_45d182a4141ff22f3ff289cf71e4669bdc714544,xwiki-platform-core/xwiki-platform-office/xwiki-platform-office-importer/src/main/java/org/xwiki/officeimporter/internal/document/FileOfficeDocumentArtifact.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.officeimporter.internal.document;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.InputStream;

import org.apache.commons.lang3.builder.EqualsBuilder;
import org.apache.commons.lang3.builder.HashCodeBuilder;
import org.xwiki.officeimporter.OfficeImporterException;
import org.xwiki.officeimporter.document.OfficeDocumentArtifact;

/**
 * A {@link OfficeDocumentArtifact} backed by a file.
 *
 * @version $Id$
 * @since 14.10.8
 * @since 15.3RC1
 */
public class FileOfficeDocumentArtifact implements OfficeDocumentArtifact
{
    private final String name;

    private final File content;

    /**
     * Construct a new {@link OfficeDocumentArtifact} backed by a file.
     *
     * @param name the name of the artifact
     * @param content the content of the artifact
     */
    public FileOfficeDocumentArtifact(String name, File content)
    {
        this.name = name;
        this.content = content;
    }

    @Override
    public String getName()
    {
        return this.name;
    }

    @Override
    public InputStream getContentInputStream() throws OfficeImporterException
    {
        try {
            return new FileInputStream(this.content);
        } catch (FileNotFoundException e) {
            throw new OfficeImporterException(""Artifact file not found"", e);
        }
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) {
            return true;
        }

        if (o == null || getClass() != o.getClass()) {
            return false;
        }

        FileOfficeDocumentArtifact that = (FileOfficeDocumentArtifact) o;

        return new EqualsBuilder().append(getName(), that.getName())
            .append(this.content, that.content).isEquals();
    }

    @Override
    public int hashCode()
    {
        return new HashCodeBuilder(17, 37).append(getName()).append(this.content).toHashCode();
    }
}",,45d182a4141ff22f3ff289cf71e4669bdc714544,CVE-2023-37913,45d182a4141ff22f3ff289cf71e4669bdc714544,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR {@VAR VAR} VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10.8 * @VAR 15.3RC1 */ VAR VAR VAR VAR VAR { VAR VAR VAR VAR; VAR VAR VAR VAR; /** * VAR VAR VAR {@VAR VAR} VAR VAR VAR VAR. * * @VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(VAR VAR, VAR VAR) { VAR.VAR = VAR; VAR.VAR = VAR; } @VAR VAR VAR VAR() { VAR VAR.VAR; } @VAR VAR VAR VAR() VAR VAR { VAR { VAR VAR VAR(VAR.VAR); } VAR (VAR VAR) { VAR VAR VAR(""VAR VAR VAR VAR"", VAR); } } @VAR VAR VAR VAR(VAR VAR) { VAR (VAR == VAR) { VAR VAR; } VAR (VAR == VAR || VAR() != VAR.VAR()) { VAR VAR; } VAR VAR = (VAR) VAR; VAR VAR VAR().VAR(VAR(), VAR.VAR()) .VAR(VAR.VAR, VAR.VAR).VAR(); } @VAR VAR VAR VAR() { VAR VAR VAR(17, 37).VAR(VAR()).VAR(VAR.VAR).VAR(); } } ",5,8
xwiki-platform_45d182a4141ff22f3ff289cf71e4669bdc714544,xwiki-platform-core/xwiki-platform-office/xwiki-platform-office-importer/src/test/java/org/xwiki/officeimporter/internal/converter/OfficeConverterFileStorageStorageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.officeimporter.internal.converter;

import java.io.File;
import java.io.IOException;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.xwiki.test.junit5.XWikiTempDir;
import org.xwiki.test.junit5.XWikiTempDirExtension;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

/**
 * Unit test for {@link OfficeConverterFileStorage}.
 *
 * @version $Id$
 */
@ExtendWith(XWikiTempDirExtension.class)
class OfficeConverterFileStorageStorageTest
{
    @XWikiTempDir
    private File tmpDir;

    @Test
    void invalidCharacters() throws IOException
    {
        OfficeConverterFileStorage storage =
            new OfficeConverterFileStorage(this.tmpDir, ""{/in\\.ext"", ""{/out\\$.out"");

        assertEquals(""{_in_a.ext"", storage.getInputFile().getName());
        assertEquals(""{_out_$a.out"", storage.getOutputFile().getName());
        assertEquals(storage.getInputDir(), storage.getInputFile().getParentFile());
        assertEquals(storage.getOutputDir(), storage.getOutputFile().getParentFile());

        assertTrue(storage.getInputDir().isDirectory());
        assertTrue(storage.getOutputDir().isDirectory());
    }

    @Test
    void longFilename() throws IOException
    {
        String longName = "" "".repeat(300) + "".ext"";
        OfficeConverterFileStorage storage = new OfficeConverterFileStorage(this.tmpDir, longName, longName);

        String expectedName = "" "".repeat(251) + "".ext"";
        assertEquals(expectedName, storage.getInputFile().getName());
        assertEquals(expectedName, storage.getOutputFile().getName());
    }

    @Test
    void fallback() throws IOException
    {
        OfficeConverterFileStorage storage = new OfficeConverterFileStorage(this.tmpDir, """", """");

        String fallback = ""fallback"";
        assertEquals(fallback, storage.getInputFile().getName());
        assertEquals(fallback, storage.getOutputFile().getName());
    }
}",,45d182a4141ff22f3ff289cf71e4669bdc714544,CVE-2023-37913,45d182a4141ff22f3ff289cf71e4669bdc714544,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR(VAR.VAR) VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(VAR.VAR, ""{/VAR\\.VAR"", ""{/VAR\\$.VAR""); VAR(""{VARVAR.VAR"", VAR.VAR().VAR()); VAR(""{VAR$VAR.VAR"", VAR.VAR().VAR()); VAR(VAR.VAR(), VAR.VAR().VAR()); VAR(VAR.VAR(), VAR.VAR().VAR()); VAR(VAR.VAR().VAR()); VAR(VAR.VAR().VAR()); } @VAR VAR VAR() VAR VAR { VAR VAR = "" "".VAR(300) + "".VAR""; VAR VAR = VAR VAR(VAR.VAR, VAR, VAR); VAR VAR = "" "".VAR(251) + "".VAR""; VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(VAR.VAR, """", """"); VAR VAR = ""VAR""; VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); } } ",5,8
xwiki-platform_48caf7491595238af2b531026a614221d5d61f38,xwiki-platform-core/xwiki-platform-icon/xwiki-platform-icon-test/xwiki-platform-icon-test-docker/src/test/it/org/xwiki/icon/test/ui/IconThemesSheetIT.java,,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.icon.test.ui;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;
import org.openqa.selenium.By;
import org.xwiki.test.docker.junit5.TestReference;
import org.xwiki.test.docker.junit5.UITest;
import org.xwiki.test.ui.TestUtils;

import static org.junit.jupiter.api.Assertions.assertTrue;

/**
 * Functional tests of the icon theme sheet.
 *
 * @version $Id$
 */
@UITest
class IconThemesSheetIT
{
    @BeforeEach
    void setUp(TestUtils testUtils)
    {
        // Login as superadmin to define the preferences.
        testUtils.loginAsSuperAdmin();
    }

    @Test
    @Order(1)
    void createIconTheme(TestUtils testUtils, TestReference testReference) throws Exception
    {
        testUtils.createPage(testReference, "")))**not bold**"");
        testUtils.addObject(testReference, ""IconThemesCode.IconThemeClass"");

        testUtils.gotoPage(testReference);

        String content = testUtils.getDriver().findElementWithoutWaiting(By.id(""xwikicontent"")).getText();

        // Make sure the wiki syntax was not interpreted
        assertTrue(content.contains(""**not bold**""));
    }
}",48caf7491595238af2b531026a614221d5d61f38,CVE-2023-26472,48caf7491595238af2b531026a614221d5d61f38,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED," /* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ */ @VAR VAR VAR { @VAR VAR VAR(VAR VAR) {  VAR.VAR(); } @VAR @VAR(1) VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR.VAR(VAR, "")))**VAR VAR**""); VAR.VAR(VAR, ""VAR.VAR""); VAR.VAR(VAR); VAR VAR = VAR.VAR().VAR(VAR.VAR(""VAR"")).VAR();  VAR(VAR.VAR(""**VAR VAR**"")); } }",5,8
xwiki-platform_49fdfd633ddfa346c522d2fe71754dc72c9496ca,xwiki-platform-core/xwiki-platform-logging/xwiki-platform-logging-script/src/test/java/org/xwiki/logging/LoggingScriptServiceComponentList.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.logging;

import java.lang.annotation.Documented;
import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import org.xwiki.logging.script.LoggingScriptService;
import org.xwiki.test.annotation.ComponentList;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

/**
 * Component list for {@link LoggingScriptService}.
 *
 * @version $Id$
 * @since 13.10.11
 * @since 14.4.7
 * @since 14.10RC1
 */
@Documented
@Retention(RUNTIME)
@Target({ TYPE, METHOD, ANNOTATION_TYPE })
@ComponentList({
    LoggingScriptService.class,
    NullLoggerManager.class
})
@Inherited
public @interface LoggingScriptServiceComponentList
{
}",,49fdfd633ddfa346c522d2fe71754dc72c9496ca,CVE-2023-29213,49fdfd633ddfa346c522d2fe71754dc72c9496ca,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 13.10.11 * @VAR 14.4.7 * @VAR 14.10RC1 */ @VAR @VAR(VAR) @VAR({ VAR, VAR, VAR }) @VAR({ VAR.VAR, VAR.VAR }) @VAR VAR @VAR VAR { } ",5,8
xwiki-platform_49fdfd633ddfa346c522d2fe71754dc72c9496ca,xwiki-platform-core/xwiki-platform-logging/xwiki-platform-logging-script/src/test/java/org/xwiki/logging/NullLoggerManager.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.logging;

import java.util.Collection;

import org.slf4j.Logger;
import org.xwiki.observation.EventListener;

/**
 * Null logger manager, to be overridden if need be.
 *
 * @version $Id$
 * @since 13.10.11
 * @since 14.4.7
 * @since 14.10RC1
 */
public class NullLoggerManager implements LoggerManager
{
    @Override
    public void pushLogListener(EventListener listener)
    {

    }

    @Override
    public EventListener popLogListener()
    {
        return null;
    }

    @Override
    public void setLoggerLevel(String loggerName, LogLevel level)
    {

    }

    @Override
    public LogLevel getLoggerLevel(String loggerName)
    {
        return null;
    }

    @Override
    public Collection<Logger> getLoggers()
    {
        return null;
    }
}",,49fdfd633ddfa346c522d2fe71754dc72c9496ca,CVE-2023-29213,49fdfd633ddfa346c522d2fe71754dc72c9496ca,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR, VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 13.10.11 * @VAR 14.4.7 * @VAR 14.10RC1 */ VAR VAR VAR VAR VAR { @VAR VAR VAR VAR(VAR VAR) { } @VAR VAR VAR VAR() { VAR VAR; } @VAR VAR VAR VAR(VAR VAR, VAR VAR) { } @VAR VAR VAR VAR(VAR VAR) { VAR VAR; } @VAR VAR VAR<VAR> VAR() { VAR VAR; } } ",5,8
xwiki-platform_49fdfd633ddfa346c522d2fe71754dc72c9496ca,xwiki-platform-core/xwiki-platform-logging/xwiki-platform-logging-ui/src/main/resources/XWiki/Logging/Code/Translations.xml,"<?xml version=""1.1"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version=""1.5"" reference=""XWiki.Logging.Code.Translations"" locale="""">
  <web>XWiki.Logging.Code</web>
  <name>Translations</name>
  <language/>
  <defaultLanguage>en</defaultLanguage>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <parent>WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title>Translations</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>plain/1.0</syntaxId>
  <hidden>true</hidden>
  <content>logging.admin.unsetLevel.success=Logger ""{0}"" level has been unset.
logging.admin.setLevel.success=Logger ""{0}"" level has been set to ""{1}"".
logging.admin.setLevel.error=Failed to set log level: the logger ""{0}"" doesn't exist.</content>
  <object>
    <name>XWiki.Logging.Code.Translations</name>
    <number>0</number>
    <className>XWiki.TranslationDocumentClass</className>
    <guid>fc29bfac-011a-4573-80ba-3f5713f1e847</guid>
    <class>
      <name>XWiki.TranslationDocumentClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <scope>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <freeText>forbidden</freeText>
        <largeStorage>0</largeStorage>
        <multiSelect>0</multiSelect>
        <name>scope</name>
        <number>1</number>
        <prettyName>Scope</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <unmodifiable>0</unmodifiable>
        <values>GLOBAL|WIKI|USER|ON_DEMAND</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </scope>
    </class>
    <property>
      <scope>WIKI</scope>
    </property>
  </object>
</xwikidoc>",,49fdfd633ddfa346c522d2fe71754dc72c9496ca,CVE-2023-29213,49fdfd633ddfa346c522d2fe71754dc72c9496ca,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.1"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""1.5"" VAR=""VAR.VAR.VAR.VAR"" VAR=""""> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR</VAR> <VAR/> <VAR>VAR</VAR> <VAR>0</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>VAR</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>1.1</VAR> <VAR>VAR</VAR> <VAR/> <VAR>VAR</VAR> <VAR>VAR/1.0</VAR> <VAR>VAR</VAR> <VAR>VAR.VAR.VAR.VAR=VAR ""{0}"" VAR VAR VAR VAR. VAR.VAR.VAR.VAR=VAR ""{0}"" VAR VAR VAR VAR VAR ""{1}"". VAR.VAR.VAR.VAR=VAR VAR VAR VAR VAR: VAR VAR ""{0}"" VAR'VAR VAR.</VAR> <VAR> <VAR>VAR.VAR.VAR.VAR</VAR> <VAR>0</VAR> <VAR>VAR.VAR</VAR> <VAR>VAR-011a-4573-80ba-3f5713f1e847</VAR> <VAR> <VAR>VAR.VAR</VAR> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR> <VAR>0</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR> </VAR> <VAR>|, </VAR> <VAR>1</VAR> <VAR>0</VAR> <VAR>VAR|VAR|VAR|VAR</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> </VAR> <VAR> <VAR>VAR</VAR> </VAR> </VAR> </VAR> ",5,8
xwiki-platform_49fdfd633ddfa346c522d2fe71754dc72c9496ca,xwiki-platform-core/xwiki-platform-logging/xwiki-platform-logging-ui/src/test/java/org/xwiki/logging/LoggingAdminPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.logging;

import java.util.HashMap;

import org.jsoup.nodes.Document;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.icon.IconManager;
import org.xwiki.livedata.internal.macro.LiveDataMacroComponentList;
import org.xwiki.localization.macro.internal.TranslationMacro;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.properties.internal.converter.EnumConverter;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;
import org.xwiki.rendering.internal.macro.message.SuccessMessageMacro;
import org.xwiki.security.authorization.ContextualAuthorizationManager;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.plugin.skinx.SkinExtensionPluginApi;

import static java.util.Arrays.asList;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.doReturn;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Test of {@code XWiki.LoggingAdmin}.
 *
 * @version $Id$
 * @since 13.10.11
 * @since 14.4.7
 * @since 14.10RC1
 */
@XWikiSyntax21ComponentList
@HTML50ComponentList
@RenderingScriptServiceComponentList
@LiveDataMacroComponentList
@LoggingScriptServiceComponentList
@ComponentList({
    TranslationMacro.class,
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    ErrorMessageMacro.class,
    SuccessMessageMacro.class,
    EnumConverter.class
})
class LoggingAdminPageTest extends PageTest
{
    private LoggerManager loggerManager;

    @BeforeEach
    void setUp() throws Exception
    {
        // Spy the jsfx plugin used during the macro rendering to return a mock of its API when required.
        when(this.oldcore.getSpyXWiki().getPluginApi(""jsfx"", this.context))
            .thenReturn(mock(SkinExtensionPluginApi.class));
        // Return minimal icons metadata since this is not what we want to test here.
        IconManager iconManager = this.componentManager.registerMockComponent(IconManager.class);
        doReturn(new HashMap<>()).when(iconManager).getMetaData(anyString());
        // Setting all rights as allowed by default.
        when(this.xwiki.getRightService().hasAccessLevel(any(), any(), anyString(), eq(this.context)))
            .thenReturn(true);
        when(this.componentManager.<ContextualAuthorizationManager>getInstance(ContextualAuthorizationManager.class)
            .hasAccess(any())).thenReturn(true);
        // Register a mocked LoggerManager as we want to control the logger level.
        this.loggerManager = this.componentManager.registerMockComponent(LoggerManager.class);
        Logger loggerA = mock(Logger.class);
        when(loggerA.getName()).thenReturn(""loggerA"");
        when(this.loggerManager.getLoggers()).thenReturn(asList(loggerA));
    }

    @Test
    void unknownLogger() throws Exception
    {
        this.request.put(""loggeraction_set"", ""1"");
        this.request.put(""logger_name"", ""{{cache}}{{groovy}}new File(\""/tmp/exploit.txt\"").withWriter { out -> ""
            + ""out.println(\""created from notification filter preferences!\""); ""
            + ""}{{/groovy}}{{/cache}}<strong>bold</strong>\""'"");
        this.request.put(""logger_level"", ""TRACE"");
        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""XWiki"", ""LoggingAdmin""));
        assertEquals(""logging.admin.setLevel.error [{{cache}}{{groovy}}new File(\""/tmp/exploit.txt\"")""
            + "".withWriter { out -> out.println(\""created from notification filter preferences!\""); }{{/groovy}}""
            + ""{{/cache}}<strong>bold</strong>\""']"", document.select("".box.errormessage"").text());
        verify(this.loggerManager, never()).setLoggerLevel(any(), any());
    }

    @Test
    void unsetLogger() throws Exception
    {
        this.request.put(""loggeraction_set"", ""1"");
        this.request.put(""logger_name"", ""loggerA"");
        this.request.put(""logger_level"", """");
        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""XWiki"", ""LoggingAdmin""));
        assertEquals(""logging.admin.unsetLevel.success [loggerA]"", document.select("".box.successmessage"").text());
        verify(this.loggerManager).setLoggerLevel(""loggerA"", null);
    }

    @Test
    void setLogger() throws Exception
    {
        this.request.put(""loggeraction_set"", ""1"");
        this.request.put(""logger_name"", ""loggerA"");
        this.request.put(""logger_level"", ""TRACE"");
        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""XWiki"", ""LoggingAdmin""));
        assertEquals(""logging.admin.setLevel.success [loggerA, TRACE]"", document.select("".box.successmessage"").text());
        verify(this.loggerManager).setLoggerLevel(""loggerA"", LogLevel.TRACE);
    }
}",,49fdfd633ddfa346c522d2fe71754dc72c9496ca,CVE-2023-29213,49fdfd633ddfa346c522d2fe71754dc72c9496ca,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 13.10.11 * @VAR 14.4.7 * @VAR 14.10RC1 */ @VAR @VAR @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR; @VAR VAR VAR() VAR VAR {  VAR(VAR.VAR.VAR().VAR(""VAR"", VAR.VAR)) .VAR(VAR(VAR.VAR));  VAR VAR = VAR.VAR.VAR(VAR.VAR); VAR(VAR VAR<>()).VAR(VAR).VAR(VAR());  VAR(VAR.VAR.VAR().VAR(VAR(), VAR(), VAR(), VAR(VAR.VAR))) .VAR(VAR); VAR(VAR.VAR.<VAR>VAR(VAR.VAR) .VAR(VAR())).VAR(VAR);  VAR.VAR = VAR.VAR.VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR()).VAR(""VAR""); VAR(VAR.VAR.VAR()).VAR(VAR(VAR)); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""1""); VAR.VAR.VAR(""VAR"", ""{{VAR}}{{VAR}}VAR VAR(\""/VAR/VAR.VAR\"").VAR { VAR -> "" + ""VAR.VAR(\""VAR VAR VAR VAR VAR!\""); "" + ""}{{/VAR}}{{/VAR}}<VAR>VAR</VAR>\""'""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(""VAR.VAR.VAR.VAR [{{VAR}}{{VAR}}VAR VAR(\""/VAR/VAR.VAR\"")"" + "".VAR { VAR -> VAR.VAR(\""VAR VAR VAR VAR VAR!\""); }{{/VAR}}"" + ""{{/VAR}}<VAR>VAR</VAR>\""']"", VAR.VAR("".VAR.VAR"").VAR()); VAR(VAR.VAR, VAR()).VAR(VAR(), VAR()); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""1""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", """"); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(""VAR.VAR.VAR.VAR [VAR]"", VAR.VAR("".VAR.VAR"").VAR()); VAR(VAR.VAR).VAR(""VAR"", VAR); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""1""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(""VAR.VAR.VAR.VAR [VAR, VAR]"", VAR.VAR("".VAR.VAR"").VAR()); VAR(VAR.VAR).VAR(""VAR"", VAR.VAR); } } ",5,8
xwiki-platform_4c175405faa0e62437df397811c7526dfc0fbae7,xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/resources/FormTokenInjectionIT/testCode.js,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
require(['xwiki-meta'], function (xm) {
  const postURL = xm.restURL + '/comments';
  const resultDiv = document.getElementById('results');

  async function addComments() {
    // Wait after each request as the REST API is not thread-safe (object ids aren't properly incremented and integrity
    // constraints are violated, see also https://jira.xwiki.org/browse/XWIKI-13473).
    await fetch(postURL, {
      method: ""POST"",
      body: ""Simple POST""
    }).then(response => resultDiv.textContent += 'Simple POST: ' + response.status);

    await fetch(new Request(postURL, {
      method: ""POST"",
      body: ""Request Body"",
      headers: {""Accept"": ""application/json""}
    })).then(async response => {
      resultDiv.textContent += 'Only Request: ' + response.status;
      return response.json();
    }).then(comment => resultDiv.textContent += comment.text);

    await fetch(new Request(postURL), {
      method: ""POST"",
      body: ""Request with init body"",
      headers: {""Accept"": ""application/json""}
    }).then(response => {
      resultDiv.textContent += 'Request with init: ' + response.status;
      return response.json();
    }).then(comment => resultDiv.textContent += comment.text);

    await fetch(postURL, {
      method: ""POST"",
      body: ""Simple with array headers body"",
      headers: [[""Accept"", ""application/json""]]
    }).then(response => {
      resultDiv.textContent += 'Simple with array headers: ' + response.status;
      return response.json();
    }).then(comment => resultDiv.textContent += comment.text);
  }

  addComments();
});",,4c175405faa0e62437df397811c7526dfc0fbae7,CVE-2023-37277,4c175405faa0e62437df397811c7526dfc0fbae7,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR(['VAR-VAR'], VAR (VAR) { VAR VAR = VAR.VAR + '/VAR'; VAR VAR = VAR.VAR('VAR'); VAR VAR VAR() {   VAR VAR(VAR, { VAR: ""VAR"", VAR: ""VAR VAR"" }).VAR(VAR => VAR.VAR += 'VAR VAR: ' + VAR.VAR); VAR VAR(VAR VAR(VAR, { VAR: ""VAR"", VAR: ""VAR VAR"", VAR: {""VAR"": ""VAR/VAR""} })).VAR(VAR VAR => { VAR.VAR += 'VAR VAR: ' + VAR.VAR; VAR VAR.VAR(); }).VAR(VAR => VAR.VAR += VAR.VAR); VAR VAR(VAR VAR(VAR), { VAR: ""VAR"", VAR: ""VAR VAR VAR VAR"", VAR: {""VAR"": ""VAR/VAR""} }).VAR(VAR => { VAR.VAR += 'VAR VAR VAR: ' + VAR.VAR; VAR VAR.VAR(); }).VAR(VAR => VAR.VAR += VAR.VAR); VAR VAR(VAR, { VAR: ""VAR"", VAR: ""VAR VAR VAR VAR VAR"", VAR: [[""VAR"", ""VAR/VAR""]] }).VAR(VAR => { VAR.VAR += 'VAR VAR VAR VAR: ' + VAR.VAR; VAR VAR.VAR(); }).VAR(VAR => VAR.VAR += VAR.VAR); } VAR(); }); ",5,8
xwiki-platform_4de72875ca49602796165412741033bfdbf1e680,xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/main/java/org/xwiki/test/CustomUserUpdatedDocumentEventListener.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.test;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.observation.AbstractEventListener;
import org.xwiki.observation.event.Event;

import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.internal.event.UserUpdatingDocumentEvent;

/**
 * Listener dedicated to cancel a specific rolling back event triggered in VersionIT test.
 *
 * @version $Id$
 * @since 14.10.17
 * @since 15.5.3
 * @since 15.8RC1
 */
@Component
@Singleton
@Named(CustomUserUpdatedDocumentEventListener.NAME)
public class CustomUserUpdatedDocumentEventListener extends AbstractEventListener
{
    static final String NAME = ""CustomUserUpdatedDocumentEventListener"";

    @Inject
    private Logger logger;

    /**
     * Default constructor.
     */
    public CustomUserUpdatedDocumentEventListener()
    {
        super(NAME, new UserUpdatingDocumentEvent());
    }

    @Override
    public void onEvent(Event event, Object source, Object data)
    {
        UserUpdatingDocumentEvent userEvent = (UserUpdatingDocumentEvent) event;
        XWikiDocument sourceDoc = (XWikiDocument) source;
        DocumentReference expectedReference = new DocumentReference(""xwiki"", ""XWiki"", ""XWikiPreferences"");
        if (StringUtils.equals(userEvent.getUserReference().getName(), ""DeleteVersionTestUserCancelEvent"")
            && sourceDoc.getDocumentReference().equals(expectedReference)) {
            logger.info(""Cancelling user event on purpose"");
            userEvent.cancel();
        }
    }
}",,4de72875ca49602796165412741033bfdbf1e680,CVE-2024-21648,4de72875ca49602796165412741033bfdbf1e680,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10.17 * @VAR 15.5.3 * @VAR 15.8RC1 */ @VAR @VAR @VAR(VAR.VAR) VAR VAR VAR VAR VAR { VAR VAR VAR VAR = ""VAR""; @VAR VAR VAR VAR; /** * VAR VAR. */ VAR VAR() { VAR(VAR, VAR VAR()); } @VAR VAR VAR VAR(VAR VAR, VAR VAR, VAR VAR) { VAR VAR = (VAR) VAR; VAR VAR = (VAR) VAR; VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR (VAR.VAR(VAR.VAR().VAR(), ""VAR"") && VAR.VAR().VAR(VAR)) { VAR.VAR(""VAR VAR VAR VAR VAR""); VAR.VAR(); } } } ",5,8
xwiki-platform_5251c02080466bf9fb55288f04a37671108f8096,xwiki-platform-core/xwiki-platform-url/xwiki-platform-url-api/src/main/java/org/xwiki/url/URLSecurityManager.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.url;

import java.net.URL;

import org.xwiki.component.annotation.Role;
import org.xwiki.stability.Unstable;

/**
 * Dedicated component to perform security checks on URLs.
 *
 * @version $Id$
 * @since 13.3RC1
 * @since 12.10.7
 */
@Role
@Unstable
public interface URLSecurityManager
{
    /**
     * Constant to be used in {@link org.xwiki.context.ExecutionContext} with the value {@code ""true""} to bypass a
     * check of {@link #isDomainTrusted(URL)}.
     */
    String BYPASS_DOMAIN_SECURITY_CHECK_CONTEXT_PROPERTY = ""bypassDomainSecurityCheck"";

    /**
     * Check if the given {@link URL} can be trusted based on the trusted domains of the wiki.
     * This method check on both the list of trusted domains given by the configuration
     * (see {@link URLConfiguration#getTrustedDomains()}) and the list of aliases used by the wiki descriptors.
     * Note that this method always returns {@code true} if {@link URLConfiguration#isTrustedDomainsEnabled()} returns
     * {@code true}. Also the method will return {@code true} whenever the {@link org.xwiki.context.ExecutionContext}
     * contains a property named {@link #BYPASS_DOMAIN_SECURITY_CHECK_CONTEXT_PROPERTY} with the value {@code ""true""}.
     *
     * @param urlToCheck the URL for which we want to know if the domain is trusted or not.
     * @return {@code true} if the URL domain can be trusted or if the check is skipped, {@code false} otherwise
     */
    boolean isDomainTrusted(URL urlToCheck);
}",,5251c02080466bf9fb55288f04a37671108f8096,CVE-2022-23618,5251c02080466bf9fb55288f04a37671108f8096,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 13.3RC1 * @VAR 12.10.7 */ @VAR @VAR VAR VAR VAR { /** * VAR VAR VAR VAR VAR {@VAR VAR.VAR.VAR.VAR} VAR VAR VAR {@VAR ""VAR""} VAR VAR VAR * VAR VAR {@VAR  */ VAR VAR = ""VAR""; /** * VAR VAR VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * (VAR {@VAR VAR * VAR VAR VAR VAR VAR VAR {@VAR VAR} VAR {@VAR VAR * {@VAR VAR}. VAR VAR VAR VAR VAR {@VAR VAR} VAR VAR {@VAR VAR.VAR.VAR.VAR} * VAR VAR VAR VAR {@VAR  * * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * @VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, {@VAR VAR} VAR */ VAR VAR(VAR VAR); } ",5,8
xwiki-platform_5251c02080466bf9fb55288f04a37671108f8096,xwiki-platform-core/xwiki-platform-url/xwiki-platform-url-default/pom.xml,"<?xml version=""1.0"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.xwiki.platform</groupId>
    <artifactId>xwiki-platform-url</artifactId>
    <version>13.3-SNAPSHOT</version>
  </parent>
  <artifactId>xwiki-platform-url-default</artifactId>
  <name>XWiki Platform - URL - Default</name>
  <packaging>jar</packaging>
  <description>Default implementations of the API defined in xwiki-platform-url-api</description>
  <properties>
    <!-- The reason for this low TPC value is because this module is tested using integration tests in the various
    URL Scheme modules -->
    <xwiki.jacoco.instructionRatio>0.31</xwiki.jacoco.instructionRatio>
  </properties>
  <dependencies>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-url-api</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-oldcore</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-wiki-api</artifactId>
      <version>${project.version}</version>
    </dependency>
    <!-- Testing Dependencies -->
    <dependency>
      <groupId>org.xwiki.commons</groupId>
      <artifactId>xwiki-commons-tool-test-component</artifactId>
      <version>${commons.version}</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
</project>",,5251c02080466bf9fb55288f04a37671108f8096,CVE-2022-23618,5251c02080466bf9fb55288f04a37671108f8096,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.0"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""VAR: <VAR>4.0.0</VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR>13.3-VAR</VAR> </VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>VAR VAR - VAR - VAR</VAR> <VAR>VAR</VAR> <VAR>VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR-VAR</VAR> <VAR> <!-- VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR --> <VAR.VAR.VAR>0.31</VAR.VAR.VAR> </VAR> <VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> </VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> </VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> </VAR> <!-- VAR VAR --> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> <VAR>VAR</VAR> </VAR> </VAR> </VAR> ",5,8
xwiki-platform_5251c02080466bf9fb55288f04a37671108f8096,xwiki-platform-core/xwiki-platform-url/xwiki-platform-url-default/src/main/java/org/xwiki/url/internal/DefaultURLSecurityManager.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.url.internal;

import java.net.URL;
import java.util.HashSet;
import java.util.Set;
import java.util.regex.Pattern;

import javax.inject.Inject;
import javax.inject.Singleton;

import org.apache.commons.lang3.StringUtils;
import org.apache.commons.lang3.exception.ExceptionUtils;
import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.context.Execution;
import org.xwiki.url.URLConfiguration;
import org.xwiki.url.URLSecurityManager;
import org.xwiki.wiki.descriptor.WikiDescriptor;
import org.xwiki.wiki.descriptor.WikiDescriptorManager;
import org.xwiki.wiki.manager.WikiManagerException;

/**
 * Default implementation of {@link URLSecurityManager}.
 * This implementation keeps a HashSet in memory containing the trusted domains defined in the configuration and
 * for all subwikis. Use {@link #invalidateCache()} to compute back this hashset.
 *
 * @version $Id$
 * @since 13.3RC1
 * @since 12.10.7
 */
@Component
@Singleton
public class DefaultURLSecurityManager implements URLSecurityManager
{
    private static final Pattern ACCEPTED_DOMAIN_PATTERN = Pattern.compile(""([^.]+\\.[^.]+)+"");
    private static final char DOT = '.';

    @Inject
    private URLConfiguration urlConfiguration;

    @Inject
    private WikiDescriptorManager wikiDescriptorManager;

    @Inject
    private Execution execution;

    @Inject
    private Logger logger;

    private Set<String> trustedDomains;

    private void computeTrustedDomains()
    {
        Set<String> domains;
        domains = new HashSet<>(this.urlConfiguration.getTrustedDomains());

        try {
            for (WikiDescriptor wikiDescriptor : wikiDescriptorManager.getAll()) {
                domains.addAll(wikiDescriptor.getAliases());
            }
        } catch (WikiManagerException e) {
            logger.warn(""Error while getting wiki descriptor to fill list of trusted domains: [{}]. ""
                + ""The subwikis won't be taken into account for the list of trusted domains."",
                ExceptionUtils.getRootCauseMessage(e));
        }
        this.trustedDomains = new HashSet<>();

        for (String domain : domains) {
            if (ACCEPTED_DOMAIN_PATTERN.matcher(domain).matches()) {
                this.trustedDomains.add(domain);
            } else {
                logger.warn(""The domain [{}] specified in the trusted domains configuration won't be taken into ""
                    + ""account since it doesn't respect the documented format."", domain);
            }
        }
    }

    @Override
    public boolean isDomainTrusted(URL urlToCheck)
    {
        if (this.urlConfiguration.isTrustedDomainsEnabled()) {
            if (this.trustedDomains == null) {
                computeTrustedDomains();
            }

            String host = urlToCheck.getHost();

            while (StringUtils.contains(host, DOT)) {
                if (trustedDomains.contains(host)) {
                    return true;
                } else {
                    host = host.substring(host.indexOf(DOT) + 1);
                }
            }

            Object bypassCheckProperty = execution.getContext()
                .getProperty(URLSecurityManager.BYPASS_DOMAIN_SECURITY_CHECK_CONTEXT_PROPERTY);
            boolean bypassCheck = bypassCheckProperty != null && Boolean.parseBoolean(bypassCheckProperty.toString());

            if (bypassCheck) {
                logger.info(""Domain of URL [{}] does not belong to the list of trusted domains but it's considered as ""
                    + ""trusted since the check has been bypassed."", urlToCheck);
            }

            return bypassCheck;
        } else {
            return true;
        }
    }

    /**
     * Invalidate the set of trusted domains: this should mainly be used when a subwiki is added/edited/deleted.
     */
    public void invalidateCache()
    {
        this.trustedDomains = null;
    }
}",,5251c02080466bf9fb55288f04a37671108f8096,CVE-2022-23618,5251c02080466bf9fb55288f04a37671108f8096,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR. VAR {@VAR  * * @VAR $VAR$ * @VAR 13.3RC1 * @VAR 12.10.7 */ @VAR @VAR VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR.VAR(""([^.]+\\.[^.]+)+""); VAR VAR VAR VAR VAR = '.'; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; VAR VAR<VAR> VAR; VAR VAR VAR() { VAR<VAR> VAR; VAR = VAR VAR<>(VAR.VAR.VAR()); VAR { VAR (VAR VAR : VAR.VAR()) { VAR.VAR(VAR.VAR()); } } VAR (VAR VAR) { VAR.VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR: [{}]. "" + ""VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", VAR.VAR(VAR)); } VAR.VAR = VAR VAR<>(); VAR (VAR VAR : VAR) { VAR (VAR.VAR(VAR).VAR()) { VAR.VAR.VAR(VAR); } VAR { VAR.VAR(""VAR VAR [{}] VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR "" + ""VAR VAR VAR VAR'VAR VAR VAR VAR VAR."", VAR); } } } @VAR VAR VAR VAR(VAR VAR) { VAR (VAR.VAR.VAR()) { VAR (VAR.VAR == VAR) { VAR(); } VAR VAR = VAR.VAR(); VAR (VAR.VAR(VAR, VAR)) { VAR (VAR.VAR(VAR)) { VAR VAR; } VAR { VAR = VAR.VAR(VAR.VAR(VAR) + 1); } } VAR VAR = VAR.VAR() .VAR(VAR.VAR); VAR VAR = VAR != VAR && VAR.VAR(VAR.VAR()); VAR (VAR) { VAR.VAR(""VAR VAR VAR [{}] VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR "" + ""VAR VAR VAR VAR VAR VAR VAR."", VAR); } VAR VAR; } VAR { VAR VAR; } } /** * VAR VAR VAR VAR VAR VAR: VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR/VAR/VAR. */ VAR VAR VAR() { VAR.VAR = VAR; } } ",5,8
xwiki-platform_5251c02080466bf9fb55288f04a37671108f8096,xwiki-platform-core/xwiki-platform-url/xwiki-platform-url-default/src/main/java/org/xwiki/url/internal/XWikiServerClassListener.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.url.internal;

import java.util.Arrays;
import java.util.List;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.model.reference.LocalDocumentReference;
import org.xwiki.observation.AbstractEventListener;
import org.xwiki.observation.event.Event;
import org.xwiki.url.URLSecurityManager;

import com.xpn.xwiki.internal.event.XObjectAddedEvent;
import com.xpn.xwiki.internal.event.XObjectDeletedEvent;
import com.xpn.xwiki.internal.event.XObjectUpdatedEvent;

/**
 * Listener for changes on XWikiServerClass xobjects to ensure the {@link URLSecurityManager} cache is invalidated
 * in case of change on XWikiServerClass objects.
 *
 * @version $Id$
 * @since 13.3RC1
 * @since 12.10.7
 */
@Component
@Singleton
@Named(XWikiServerClassListener.NAME)
public class XWikiServerClassListener extends AbstractEventListener
{
    /**
     * Name of the listener.
     */
    public static final String NAME = ""org.xwiki.url.internal.XWikiServerClassListener"";

    private static final LocalDocumentReference XWIKISERVER_CLASS =
        new LocalDocumentReference(""XWiki"", ""XWikiServerClass"");

    private static final List<Event> EVENTS = Arrays.asList(
        new XObjectAddedEvent(XWIKISERVER_CLASS),
        new XObjectDeletedEvent(XWIKISERVER_CLASS),
        new XObjectUpdatedEvent(XWIKISERVER_CLASS)
    );

    @Inject
    private URLSecurityManager securityManager;

    /**
     * Default constructor.
     */
    public XWikiServerClassListener()
    {
        super(NAME, EVENTS);
    }

    @Override
    public void onEvent(Event event, Object source, Object data)
    {
        if (this.securityManager instanceof DefaultURLSecurityManager) {
            ((DefaultURLSecurityManager) this.securityManager).invalidateCache();
        }
    }
}",,5251c02080466bf9fb55288f04a37671108f8096,CVE-2022-23618,5251c02080466bf9fb55288f04a37671108f8096,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR {@VAR VAR} VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 13.3RC1 * @VAR 12.10.7 */ @VAR @VAR @VAR(VAR.VAR) VAR VAR VAR VAR VAR { /** * VAR VAR VAR VAR. */ VAR VAR VAR VAR VAR = ""VAR.VAR.VAR.VAR.VAR""; VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR""); VAR VAR VAR VAR<VAR> VAR = VAR.VAR( VAR VAR(VAR), VAR VAR(VAR), VAR VAR(VAR) ); @VAR VAR VAR VAR; /** * VAR VAR. */ VAR VAR() { VAR(VAR, VAR); } @VAR VAR VAR VAR(VAR VAR, VAR VAR, VAR VAR) { VAR (VAR.VAR VAR VAR) { ((VAR) VAR.VAR).VAR(); } } } ",5,8
xwiki-platform_5251c02080466bf9fb55288f04a37671108f8096,xwiki-platform-core/xwiki-platform-url/xwiki-platform-url-default/src/test/java/org/xwiki/url/internal/DefaultURLSecurityManagerTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.url.internal;

import java.net.MalformedURLException;
import java.net.URL;
import java.util.Arrays;
import java.util.Collections;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.RegisterExtension;
import org.xwiki.context.Execution;
import org.xwiki.context.ExecutionContext;
import org.xwiki.test.LogLevel;
import org.xwiki.test.junit5.LogCaptureExtension;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.url.URLConfiguration;
import org.xwiki.url.URLSecurityManager;
import org.xwiki.wiki.descriptor.WikiDescriptor;
import org.xwiki.wiki.descriptor.WikiDescriptorManager;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

/**
 * Tests for {@link DefaultURLSecurityManager}.
 *
 * @version $Id$
 * @since 13.3RC1
 * @since 12.10.7
 */
@ComponentTest
class DefaultURLSecurityManagerTest
{
    @InjectMockComponents
    private DefaultURLSecurityManager urlSecurityManager;

    @MockComponent
    private URLConfiguration urlConfiguration;

    @MockComponent
    private WikiDescriptorManager wikiDescriptorManager;

    @MockComponent
    private Execution execution;

    private ExecutionContext executionContext;

    @RegisterExtension
    LogCaptureExtension logCapture = new LogCaptureExtension(LogLevel.INFO);

    @BeforeEach
    void setup()
    {
        this.executionContext = mock(ExecutionContext.class);
        when(this.execution.getContext()).thenReturn(this.executionContext);
        when(this.urlConfiguration.isTrustedDomainsEnabled()).thenReturn(true);
    }

    @Test
    void isDomainTrusted() throws Exception
    {
        when(urlConfiguration.getTrustedDomains()).thenReturn(Arrays.asList(
            ""foo.acme.org"",
            ""com"" // this should not be taken into account
        ));

        WikiDescriptor wikiDescriptor1 = mock(WikiDescriptor.class);
        when(wikiDescriptor1.getAliases()).thenReturn(Arrays.asList(
            ""www.xwiki.org"",
            ""something.bar.com""
        ));

        WikiDescriptor wikiDescriptor2 = mock(WikiDescriptor.class);
        when(wikiDescriptor2.getAliases()).thenReturn(Collections.singletonList(
            ""enterprise.eu""
        ));

        when(this.wikiDescriptorManager.getAll()).thenReturn(Arrays.asList(wikiDescriptor1, wikiDescriptor2));

        assertThat(""www.xwiki.org is trusted"", this.urlSecurityManager
            .isDomainTrusted(new URL(""http://www.xwiki.org/xwiki/bin/view/XWiki/Login"")));
        assertThat(""www.xwiki.org is trusted"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://www.xwiki.org/xwiki/bin/view/XWiki/Login"")));
        assertThat(""www.xwiki.com is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://www.xwiki.com/xwiki/bin/view/XWiki/Login"")));
        assertThat(""xwiki.org is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://xwiki.org/xwiki/bin/view/XWiki/Login"")));
        assertThat(""foo.acme.org is trusted"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://foo.acme.org/something/else"")));
        assertThat(""bar.foo.acme.org is trusted since foo.acme.org is"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://bar.foo.acme.org/something/else"")));
        assertThat(""buz.bar.foo.acme.org is trusted since foo.acme.org is"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://buz.bar.foo.acme.org/something/else"")));
        assertThat(""acme.org is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://acme.org/something/else"")));
        assertThat(""www.acme.org is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://www.acme.org/something/else"")));
        assertThat(""something.bar.thing.com is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://something.bar.thing.com"")));
        assertThat(""bar.thing.com is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://bar.thing.com"")));
        assertThat(""something.bar.com is tristed"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://something.bar.com"")));
        assertThat(""enterprise.eu is trusted"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://enterprise.eu/xwiki/"")));
        assertThat(""enterprise.eu. is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://enterprise.eu./xwiki/"")));

        assertEquals(""The domain [com] specified in the trusted domains configuration won't be taken into account ""
                + ""since it doesn't respect the documented format."",
            logCapture.getMessage(0));
    }

    @Test
    void invalidateCache() throws Exception
    {
        when(urlConfiguration.getTrustedDomains()).thenReturn(Collections.singletonList(
            ""xwiki.org""
        ));
        assertThat(""www.xwiki.org is trusted"", this.urlSecurityManager
            .isDomainTrusted(new URL(""http://www.xwiki.org"")));
        assertThat(""foo.acme.org is not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://foo.acme.org/something/else"")));

        when(urlConfiguration.getTrustedDomains()).thenReturn(Collections.singletonList(
            ""foo.acme.org""
        ));

        // the asserts are still the same because we rely on cached values
        assertThat(""www.xwiki.org is still trusted"", this.urlSecurityManager
            .isDomainTrusted(new URL(""http://www.xwiki.org"")));
        assertThat(""foo.acme.org is still not trusted"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""https://foo.acme.org/something/else"")));

        // after invalidation the cache has been recomputed.
        this.urlSecurityManager.invalidateCache();
        assertThat(""www.xwiki.org is not trusted anymore"", !this.urlSecurityManager
            .isDomainTrusted(new URL(""http://www.xwiki.org"")));
        assertThat(""foo.acme.org is trusted now"", this.urlSecurityManager
            .isDomainTrusted(new URL(""https://foo.acme.org/something/else"")));
    }

    @Test
    void isDomainTrustedWhenCheckSkipped() throws MalformedURLException
    {
        when(urlConfiguration.getTrustedDomains()).thenReturn(Collections.singletonList(
            ""foo.acme.org""
        ));
        when(urlConfiguration.isTrustedDomainsEnabled()).thenReturn(false);
        assertThat(""Any domain can be trusted when check is skipped: check with www.xwiki.org"",
            this.urlSecurityManager.isDomainTrusted(new URL(""http://www.xwiki.org"")));
        assertThat(""Any domain can be trusted when check is skipped: check with www.bar.eu"",
            this.urlSecurityManager.isDomainTrusted(new URL(""http://www.bar.eu"")));
        assertThat(""Any domain can be trusted when check is skipped: check with foo.acme.org"",
            this.urlSecurityManager.isDomainTrusted(new URL(""http://foo.acme.org"")));

        when(urlConfiguration.isTrustedDomainsEnabled()).thenReturn(true);
        assertThat(""www.xwiki.org should not be trusted"",
            !this.urlSecurityManager.isDomainTrusted(new URL(""http://www.xwiki.org"")));
        assertThat(""www.bar.eu should not be trusted"",
            !this.urlSecurityManager.isDomainTrusted(new URL(""http://www.bar.eu"")));
        assertThat(""foo.acme.org should be trusted"",
            this.urlSecurityManager.isDomainTrusted(new URL(""http://foo.acme.org"")));

        when(this.executionContext.getProperty(URLSecurityManager.BYPASS_DOMAIN_SECURITY_CHECK_CONTEXT_PROPERTY))
            .thenReturn(true);
        assertThat(""www.xwiki.org should be trusted when check is bypassed"",
            this.urlSecurityManager.isDomainTrusted(new URL(""http://www.xwiki.org"")));

        assertEquals(""Domain of URL [http://www.xwiki.org] does not belong to the list of trusted domains but ""
                + ""it's considered as trusted since the check has been bypassed."",
            logCapture.getMessage(0));
    }
}",,5251c02080466bf9fb55288f04a37671108f8096,CVE-2022-23618,5251c02080466bf9fb55288f04a37671108f8096,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 13.3RC1 * @VAR 12.10.7 */ @VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR = VAR VAR(VAR.VAR); @VAR VAR VAR() { VAR.VAR = VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR(VAR.VAR.VAR()).VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR(VAR.VAR()).VAR(VAR.VAR( ""VAR.VAR.VAR"", ""VAR""  )); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR()).VAR(VAR.VAR( ""VAR.VAR.VAR"", ""VAR.VAR.VAR"" )); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR()).VAR(VAR.VAR( ""VAR.VAR"" )); VAR(VAR.VAR.VAR()).VAR(VAR.VAR(VAR, VAR)); VAR(""VAR.VAR.VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR. VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR VAR [VAR] VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR "" + ""VAR VAR VAR'VAR VAR VAR VAR VAR."", VAR.VAR(0)); } @VAR VAR VAR() VAR VAR { VAR(VAR.VAR()).VAR(VAR.VAR( ""VAR.VAR"" )); VAR(""VAR.VAR.VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(VAR.VAR()).VAR(VAR.VAR( ""VAR.VAR.VAR"" ));  VAR(""VAR.VAR.VAR VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR:  VAR.VAR.VAR(); VAR(""VAR.VAR.VAR VAR VAR VAR VAR"", !VAR.VAR .VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR"", VAR.VAR .VAR(VAR VAR(""VAR: } @VAR VAR VAR() VAR VAR { VAR(VAR.VAR()).VAR(VAR.VAR( ""VAR.VAR.VAR"" )); VAR(VAR.VAR()).VAR(VAR); VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR.VAR.VAR"", VAR.VAR.VAR(VAR VAR(""VAR: VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR.VAR.VAR"", VAR.VAR.VAR(VAR VAR(""VAR: VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR.VAR.VAR"", VAR.VAR.VAR(VAR VAR(""VAR: VAR(VAR.VAR()).VAR(VAR); VAR(""VAR.VAR.VAR VAR VAR VAR VAR"", !VAR.VAR.VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR VAR"", !VAR.VAR.VAR(VAR VAR(""VAR: VAR(""VAR.VAR.VAR VAR VAR VAR"", VAR.VAR.VAR(VAR VAR(""VAR: VAR(VAR.VAR.VAR(VAR.VAR)) .VAR(VAR); VAR(""VAR.VAR.VAR VAR VAR VAR VAR VAR VAR VAR"", VAR.VAR.VAR(VAR VAR(""VAR: VAR(""VAR VAR VAR [VAR: + ""VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", VAR.VAR(0)); } } ",5,8
xwiki-platform_556e7823260b826f344c1a6e95d935774587e028,xwiki-platform-core/xwiki-platform-livedata/xwiki-platform-livedata-macro/src/main/java/org/xwiki/livedata/internal/macro/LiveDataMacroConfiguration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.livedata.internal.macro;

import java.net.URL;
import java.net.URLDecoder;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.regex.Pattern;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import javax.inject.Inject;
import javax.inject.Singleton;

import org.apache.commons.lang3.StringUtils;
import org.xwiki.component.annotation.Component;
import org.xwiki.livedata.LiveDataConfiguration;
import org.xwiki.livedata.LiveDataConfigurationResolver;
import org.xwiki.livedata.LiveDataLayoutDescriptor;
import org.xwiki.livedata.LiveDataMeta;
import org.xwiki.livedata.LiveDataPaginationConfiguration;
import org.xwiki.livedata.LiveDataQuery;
import org.xwiki.livedata.internal.JSONMerge;
import org.xwiki.livedata.macro.LiveDataMacroParameters;

/**
 * Provides services to manipulate configurations for the {@link LiveDataMacroConfiguration}.
 *
 * @version $Id$
 * @since 14.9
 * @since 14.4.7
 * @since 13.10.10
 */
@Component(roles = LiveDataMacroConfiguration.class)
@Singleton
public class LiveDataMacroConfiguration
{
    private static final Pattern PATTERN_COMMA = Pattern.compile(""\\s*,\\s*"");

    private static final String UTF8 = ""UTF-8"";

    /**
     * Used to read the Live Data configuration from the macro content.
     */
    @Inject
    private LiveDataConfigurationResolver<String> stringLiveDataConfigResolver;

    /**
     * Used to merge the Live Data configuration built from the macro parameters with the live data configuration read
     * from the macro content.
     */
    private JSONMerge jsonMerge = new JSONMerge();

    /**
     * Resolve a complete Live Data configuration from a json advanced configuration (the content) and a set of macro
     * parameters.
     *
     * @param content the string representation of the json live data advanced configuration
     * @param parameters the Live Data macro parameters
     * @return the complete Live Data configuration
     * @throws Exception in case of error when resolving the configuration
     */
    public LiveDataConfiguration getLiveDataConfiguration(String content, LiveDataMacroParameters parameters)
        throws Exception
    {
        String json = StringUtils.defaultIfBlank(content, ""{}"");
        LiveDataConfiguration advancedConfig = this.stringLiveDataConfigResolver.resolve(json);
        LiveDataConfiguration basicConfig = getLiveDataConfiguration(parameters);
        // Make sure both configurations have the same id so that they are properly merged.
        advancedConfig.setId(basicConfig.getId());
        return this.jsonMerge.merge(advancedConfig, basicConfig);
    }

    private LiveDataConfiguration getLiveDataConfiguration(LiveDataMacroParameters parameters) throws Exception
    {
        LiveDataConfiguration liveDataConfig = new LiveDataConfiguration();
        liveDataConfig.setId(parameters.getId());
        liveDataConfig.setQuery(getQuery(parameters));
        liveDataConfig.setMeta(getMeta(parameters));
        return liveDataConfig;
    }

    private LiveDataQuery getQuery(LiveDataMacroParameters parameters) throws Exception
    {
        LiveDataQuery query = new LiveDataQuery();
        query.setProperties(getProperties(parameters.getProperties()));
        query.setSource(new LiveDataQuery.Source(parameters.getSource()));
        query.getSource().getParameters().putAll(getSourceParameters(parameters.getSourceParameters()));
        query.setSort(getSortEntries(parameters.getSort()));
        query.setFilters(getFilters(parameters.getFilters()));
        query.setLimit(parameters.getLimit());
        query.setOffset(parameters.getOffset());
        return query;
    }

    private List<String> getProperties(String properties)
    {
        if (properties == null) {
            return null;
        } else {
            return Stream.of(PATTERN_COMMA.split(properties)).collect(Collectors.toList());
        }
    }

    private Map<String, Object> getSourceParameters(String sourceParametersString) throws Exception
    {
        if (StringUtils.isEmpty(sourceParametersString)) {
            return Collections.emptyMap();
        }

        Map<String, List<String>> urlParams = getURLParameters('?' + sourceParametersString);
        Map<String, Object> sourceParams = new HashMap<>();
        for (Map.Entry<String, List<String>> entry : urlParams.entrySet()) {
            if (entry.getValue().size() > 1) {
                sourceParams.put(entry.getKey(), entry.getValue());
            } else {
                sourceParams.put(entry.getKey(), entry.getValue().get(0));
            }
        }
        return sourceParams;
    }

    private List<LiveDataQuery.SortEntry> getSortEntries(String sort)
    {
        if (sort == null) {
            return null;
        } else {
            return Stream.of(PATTERN_COMMA.split(sort)).filter(StringUtils::isNotEmpty).map(this::getSortEntry)
                .collect(Collectors.toList());
        }
    }

    private LiveDataQuery.SortEntry getSortEntry(String sortEntryString)
    {
        LiveDataQuery.SortEntry sortEntry = new LiveDataQuery.SortEntry();
        sortEntry.setDescending(sortEntryString.endsWith("":desc""));
        if (sortEntry.isDescending() || sortEntryString.endsWith("":asc"")) {
            sortEntry.setProperty(StringUtils.substringBeforeLast(sortEntryString, "":""));
        } else {
            sortEntry.setProperty(sortEntryString);
        }
        return sortEntry;
    }

    private List<LiveDataQuery.Filter> getFilters(String filtersString) throws Exception
    {
        List<LiveDataQuery.Filter> filters =
            getURLParameters('?' + StringUtils.defaultString(filtersString)).entrySet().stream()
                .map(this::getFilter).collect(Collectors.toList());
        return filters.isEmpty() ? null : filters;
    }

    private LiveDataQuery.Filter getFilter(Map.Entry<String, List<String>> entry)
    {
        LiveDataQuery.Filter filter = new LiveDataQuery.Filter();
        filter.setProperty(entry.getKey());
        filter.getConstraints()
            .addAll(entry.getValue().stream().map(LiveDataQuery.Constraint::new).collect(Collectors.toList()));
        return filter;
    }

    private LiveDataMeta getMeta(LiveDataMacroParameters parameters)
    {
        LiveDataMeta meta = new LiveDataMeta();
        meta.setLayouts(getLayouts(parameters));
        meta.setPagination(getPagination(parameters));
        return meta;
    }

    private List<LiveDataLayoutDescriptor> getLayouts(LiveDataMacroParameters parameters)
    {
        if (parameters.getLayouts() == null) {
            return null;
        } else {
            return Stream.of(PATTERN_COMMA.split(parameters.getLayouts())).map(LiveDataLayoutDescriptor::new)
                .collect(Collectors.toList());
        }
    }

    private LiveDataPaginationConfiguration getPagination(LiveDataMacroParameters parameters)
    {
        LiveDataPaginationConfiguration pagination = new LiveDataPaginationConfiguration();
        pagination.setShowPageSizeDropdown(parameters.getShowPageSizeDropdown());
        if (parameters.getPageSizes() != null) {
            pagination.setPageSizes(Stream.of(PATTERN_COMMA.split(parameters.getPageSizes())).map(Integer::parseInt)
                .collect(Collectors.toList()));
        }
        return pagination;
    }

    private Map<String, List<String>> getURLParameters(String url) throws Exception
    {
        URL baseURL = new URL(""http://www.xwiki.org"");
        String queryString = new URL(baseURL, url).getQuery();
        Map<String, List<String>> parameters = new HashMap<>();
        for (String entry : queryString.split(""&"")) {
            String[] parts = entry.split(""="", 2);
            String key = URLDecoder.decode(parts[0], UTF8);
            if (key.isEmpty()) {
                continue;
            }
            String value = parts.length == 2 ? URLDecoder.decode(parts[1], UTF8) : """";
            List<String> values = parameters.get(key);
            if (values == null) {
                values = new ArrayList<>();
                parameters.put(key, values);
            }
            values.add(value);
        }
        return parameters;
    }
}",,556e7823260b826f344c1a6e95d935774587e028,CVE-2023-26480,556e7823260b826f344c1a6e95d935774587e028,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.9 * @VAR 14.4.7 * @VAR 13.10.10 */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR.VAR(""\\VAR*,\\VAR*""); VAR VAR VAR VAR VAR = ""VAR-8""; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. */ @VAR VAR VAR<VAR> VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. */ VAR VAR VAR = VAR VAR(); /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR (VAR VAR) VAR VAR VAR VAR VAR * VAR. * * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR VAR = VAR.VAR(VAR, ""{}""); VAR VAR = VAR.VAR.VAR(VAR); VAR VAR = VAR(VAR);  VAR.VAR(VAR.VAR()); VAR VAR.VAR.VAR(VAR, VAR); } VAR VAR VAR(VAR VAR) VAR VAR { VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR()); VAR.VAR(VAR(VAR)); VAR.VAR(VAR(VAR)); VAR VAR; } VAR VAR VAR(VAR VAR) VAR VAR { VAR VAR = VAR VAR(); VAR.VAR(VAR(VAR.VAR())); VAR.VAR(VAR VAR.VAR(VAR.VAR())); VAR.VAR().VAR().VAR(VAR(VAR.VAR())); VAR.VAR(VAR(VAR.VAR())); VAR.VAR(VAR(VAR.VAR())); VAR.VAR(VAR.VAR()); VAR.VAR(VAR.VAR()); VAR VAR; } VAR VAR<VAR> VAR(VAR VAR) { VAR (VAR == VAR) { VAR VAR; } VAR { VAR VAR.VAR(VAR.VAR(VAR)).VAR(VAR.VAR()); } } VAR VAR<VAR, VAR> VAR(VAR VAR) VAR VAR { VAR (VAR.VAR(VAR)) { VAR VAR.VAR(); } VAR<VAR, VAR<VAR>> VAR = VAR('?' + VAR); VAR<VAR, VAR> VAR = VAR VAR<>(); VAR (VAR.VAR<VAR, VAR<VAR>> VAR : VAR.VAR()) { VAR (VAR.VAR().VAR() > 1) { VAR.VAR(VAR.VAR(), VAR.VAR()); } VAR { VAR.VAR(VAR.VAR(), VAR.VAR().VAR(0)); } } VAR VAR; } VAR VAR<VAR.VAR> VAR(VAR VAR) { VAR (VAR == VAR) { VAR VAR; } VAR { VAR VAR.VAR(VAR.VAR(VAR)).VAR(VAR::VAR).VAR(VAR::VAR) .VAR(VAR.VAR()); } } VAR VAR.VAR VAR(VAR VAR) { VAR.VAR VAR = VAR VAR.VAR(); VAR.VAR(VAR.VAR("":VAR"")); VAR (VAR.VAR() || VAR.VAR("":VAR"")) { VAR.VAR(VAR.VAR(VAR, "":"")); } VAR { VAR.VAR(VAR); } VAR VAR; } VAR VAR<VAR.VAR> VAR(VAR VAR) VAR VAR { VAR<VAR.VAR> VAR = VAR('?' + VAR.VAR(VAR)).VAR().VAR() .VAR(VAR::VAR).VAR(VAR.VAR()); VAR VAR.VAR() ? VAR : VAR; } VAR VAR.VAR VAR(VAR.VAR<VAR, VAR<VAR>> VAR) { VAR.VAR VAR = VAR VAR.VAR(); VAR.VAR(VAR.VAR()); VAR.VAR() .VAR(VAR.VAR().VAR().VAR(VAR.VAR::VAR).VAR(VAR.VAR())); VAR VAR; } VAR VAR VAR(VAR VAR) { VAR VAR = VAR VAR(); VAR.VAR(VAR(VAR)); VAR.VAR(VAR(VAR)); VAR VAR; } VAR VAR<VAR> VAR(VAR VAR) { VAR (VAR.VAR() == VAR) { VAR VAR; } VAR { VAR VAR.VAR(VAR.VAR(VAR.VAR())).VAR(VAR::VAR) .VAR(VAR.VAR()); } } VAR VAR VAR(VAR VAR) { VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR()); VAR (VAR.VAR() != VAR) { VAR.VAR(VAR.VAR(VAR.VAR(VAR.VAR())).VAR(VAR::VAR) .VAR(VAR.VAR())); } VAR VAR; } VAR VAR<VAR, VAR<VAR>> VAR(VAR VAR) VAR VAR { VAR VAR = VAR VAR(""VAR: VAR VAR = VAR VAR(VAR, VAR).VAR(); VAR<VAR, VAR<VAR>> VAR = VAR VAR<>(); VAR (VAR VAR : VAR.VAR(""&"")) { VAR[] VAR = VAR.VAR(""="", 2); VAR VAR = VAR.VAR(VAR[0], VAR); VAR (VAR.VAR()) { VAR; } VAR VAR = VAR.VAR == 2 ? VAR.VAR(VAR[1], VAR) : """"; VAR<VAR> VAR = VAR.VAR(VAR); VAR (VAR == VAR) { VAR = VAR VAR<>(); VAR.VAR(VAR, VAR); } VAR.VAR(VAR); } VAR VAR; } } ",5,8
xwiki-platform_556e7823260b826f344c1a6e95d935774587e028,xwiki-platform-core/xwiki-platform-livedata/xwiki-platform-livedata-macro/src/main/java/org/xwiki/livedata/internal/macro/LiveDataMacroRights.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.livedata.internal.macro;

import javax.inject.Inject;
import javax.inject.Singleton;

import org.xwiki.bridge.DocumentAccessBridge;
import org.xwiki.component.annotation.Component;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.security.authorization.AuthorizationManager;

import static org.xwiki.security.authorization.Right.SCRIPT;

/**
 * Provides the services related to rights for {@link LiveDataMacro}.
 *
 * @version $Id$
 * @since 14.9
 * @since 14.4.7
 * @since 13.10.10
 */
@Component(roles = LiveDataMacroRights.class)
@Singleton
public class LiveDataMacroRights
{
    @Inject
    private DocumentAccessBridge documentAccessBridge;

    @Inject
    private AuthorizationManager authorizationManager;

    /**
     * @return {@code true} if the last author of the document where the Live Data macro is executed has script rights
     *     on said document, {@code false} otherwise
     */
    public boolean authorHasScriptRight()
    {
        DocumentReference currentDocumentReference = this.documentAccessBridge.getCurrentDocumentReference();
        DocumentReference currentAuthorReference = this.documentAccessBridge.getCurrentAuthorReference();
        return this.authorizationManager.hasAccess(SCRIPT, currentAuthorReference, currentDocumentReference);
    }
}",,556e7823260b826f344c1a6e95d935774587e028,CVE-2023-26480,556e7823260b826f344c1a6e95d935774587e028,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.9 * @VAR 14.4.7 * @VAR 13.10.10 */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR VAR; /** * @VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR, {@VAR VAR} VAR */ VAR VAR VAR() { VAR VAR = VAR.VAR.VAR(); VAR VAR = VAR.VAR.VAR(); VAR VAR.VAR.VAR(VAR, VAR, VAR); } } ",5,8
xwiki-platform_62863736d78ffd60d822279c5fb7fb9593042766,xwiki-platform-core/xwiki-platform-search/xwiki-platform-search-ui/src/test/java/org/xwiki/search/ui/SearchAdminPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.search.ui;

import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.bridge.event.DocumentCreatedEvent;
import org.xwiki.component.manager.ComponentManager;
import org.xwiki.component.wiki.internal.bridge.DefaultWikiObjectComponentManagerEventListener;
import org.xwiki.context.internal.concurrent.DefaultContextStoreManager;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.observation.EventListener;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultRenderingConfigurationComponentList;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.uiextension.internal.UIExtensionClassDocumentInitializer;
import org.xwiki.uiextension.internal.WikiUIExtensionConstants;
import org.xwiki.uiextension.script.UIExtensionScriptServiceComponentList;

import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.objects.BaseObject;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.when;

/**
 * Page test for {@code XWiki.SearchAdmin}.
 *
 * @version $Id$
 */
@ComponentList({ UIExtensionClassDocumentInitializer.class, DefaultContextStoreManager.class, TestNoScriptMacro.class })
@UIExtensionScriptServiceComponentList
@RenderingScriptServiceComponentList
@DefaultRenderingConfigurationComponentList
@HTML50ComponentList
@XWikiSyntax21ComponentList
class SearchAdminPageTest extends PageTest
{
    private static final String WIKI_NAME = ""xwiki"";

    private static final String XWIKI_SPACE = ""XWiki"";

    private static final DocumentReference SEARCH_ADMIN_SHEET =
        new DocumentReference(WIKI_NAME, XWIKI_SPACE, ""SearchAdmin"");

    private static final DocumentReference ADMIN_REFERENCE = new DocumentReference(WIKI_NAME, XWIKI_SPACE, ""Admin"");

    @BeforeEach
    void setUp() throws Exception
    {
        // Initialize the UIExtension class.
        this.xwiki.initializeMandatoryDocuments(this.context);

        when(this.oldcore.getMockAuthorizationManager().hasAccess(any(), eq(ADMIN_REFERENCE), any())).thenReturn(true);

        // Register the component manager as wiki component manager so that the UIX can be registered on the wiki.
        this.componentManager.registerComponent(ComponentManager.class, ""wiki"", this.componentManager);
    }

    @Test
    void escapesExtensionProperties() throws Exception
    {
        // Create a document with a UI extension to test on.
        DocumentReference docRef = new DocumentReference(WIKI_NAME, XWIKI_SPACE, ""Test"");
        XWikiDocument document = new XWikiDocument(docRef);
        // Set the author to admin so the UIX can be registered at wiki level.
        document.setAuthorReference(ADMIN_REFERENCE);
        BaseObject uiExtensionObject =
            document.newXObject(WikiUIExtensionConstants.UI_EXTENSION_CLASS, this.context);
        uiExtensionObject.setStringValue(WikiUIExtensionConstants.EXTENSION_POINT_ID_PROPERTY,
            ""org.xwiki.platform.search"");
        String id = ""\"")}}{{noscript /}}"";
        uiExtensionObject.setStringValue(WikiUIExtensionConstants.ID_PROPERTY, id);
        String label = ""Label {{noscript /}}"";
        String adminPageName = ""\""}}{{noscript /}}Admin"";
        String adminPage = XWIKI_SPACE + ""."" + adminPageName;
        uiExtensionObject.setLargeStringValue(WikiUIExtensionConstants.PARAMETERS_PROPERTY, ""label="" + label + ""\n""
            + ""admin="" + adminPage);
        uiExtensionObject.setStringValue(WikiUIExtensionConstants.SCOPE_PROPERTY, ""wiki"");
        this.xwiki.saveDocument(document, this.context);

        // The event listeners are not registered by default. We trigger it manually so that the UIX is registered and
        // can be found and rendered.
        this.componentManager
            .<EventListener>getInstance(EventListener.class,
                DefaultWikiObjectComponentManagerEventListener.EVENT_LISTENER_NAME)
            .onEvent(new DocumentCreatedEvent(), document, null);

        // Create the fake search admin page.
        DocumentReference searchAdminReference = new DocumentReference(WIKI_NAME, XWIKI_SPACE, adminPageName);
        XWikiDocument searchAdminDocument = new XWikiDocument(searchAdminReference);
        String searchAdminPageContent = ""Search Admin Page Content"";
        searchAdminDocument.setContent(searchAdminPageContent);
        this.xwiki.saveDocument(searchAdminDocument, this.context);

        // Load XWiki.SearchCode and XWiki.SearchConfigClass as the SearchAdmin page uses them.
        loadPage(new DocumentReference(WIKI_NAME, XWIKI_SPACE, ""SearchCode""));
        loadPage(new DocumentReference(WIKI_NAME, XWIKI_SPACE, ""SearchConfigClass""));

        Document htmlPage = renderHTMLPage(SEARCH_ADMIN_SHEET);

        Element optionElement = htmlPage.selectFirst(""select option"");
        assertNotNull(optionElement);
        assertEquals(id, optionElement.attr(""value""));
        assertEquals(label, optionElement.text());

        Element tabLink = htmlPage.selectFirst(""ul.nav-tabs li a"");
        assertNotNull(tabLink);
        String tabId = String.format(""%sConfig"", id);
        assertEquals(""#"" + tabId, tabLink.attr(""href""));
        assertEquals(tabId, tabLink.attr(""aria-controls""));
        assertEquals(label, tabLink.text());

        Element tabContent = htmlPage.selectFirst(""div.tab-content div.tab-pane"");
        assertNotNull(tabContent);
        assertEquals(tabId, tabContent.attr(""id""));
        assertEquals(searchAdminPageContent, tabContent.text());
    }
}",,62863736d78ffd60d822279c5fb7fb9593042766,CVE-2023-50721,62863736d78ffd60d822279c5fb7fb9593042766,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ */ @VAR({ VAR.VAR, VAR.VAR, VAR.VAR }) @VAR @VAR @VAR @VAR @VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR VAR VAR = VAR VAR(VAR, VAR, ""VAR""); VAR VAR VAR VAR VAR = VAR VAR(VAR, VAR, ""VAR""); @VAR VAR VAR() VAR VAR {  VAR.VAR.VAR(VAR.VAR); VAR(VAR.VAR.VAR().VAR(VAR(), VAR(VAR), VAR())).VAR(VAR);  VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR); } @VAR VAR VAR() VAR VAR {  VAR VAR = VAR VAR(VAR, VAR, ""VAR""); VAR VAR = VAR VAR(VAR);  VAR.VAR(VAR); VAR VAR = VAR.VAR(VAR.VAR, VAR.VAR); VAR.VAR(VAR.VAR, ""VAR.VAR.VAR.VAR""); VAR VAR = ""\"")}}{{VAR /}}""; VAR.VAR(VAR.VAR, VAR); VAR VAR = ""VAR {{VAR /}}""; VAR VAR = ""\""}}{{VAR /}}VAR""; VAR VAR = VAR + ""."" + VAR; VAR.VAR(VAR.VAR, ""VAR="" + VAR + ""\VAR"" + ""VAR="" + VAR); VAR.VAR(VAR.VAR, ""VAR""); VAR.VAR.VAR(VAR, VAR.VAR);   VAR.VAR .<VAR>VAR(VAR.VAR, VAR.VAR) .VAR(VAR VAR(), VAR, VAR);  VAR VAR = VAR VAR(VAR, VAR, VAR); VAR VAR = VAR VAR(VAR); VAR VAR = ""VAR VAR VAR VAR""; VAR.VAR(VAR); VAR.VAR.VAR(VAR, VAR.VAR);  VAR(VAR VAR(VAR, VAR, ""VAR"")); VAR(VAR VAR(VAR, VAR, ""VAR"")); VAR VAR = VAR(VAR); VAR VAR = VAR.VAR(""VAR VAR""); VAR(VAR); VAR(VAR, VAR.VAR(""VAR"")); VAR(VAR, VAR.VAR()); VAR VAR = VAR.VAR(""VAR.VAR-VAR VAR VAR""); VAR(VAR); VAR VAR = VAR.VAR(""%VAR"", VAR); VAR("" VAR(VAR, VAR.VAR(""VAR-VAR"")); VAR(VAR, VAR.VAR()); VAR VAR = VAR.VAR(""VAR.VAR-VAR VAR.VAR-VAR""); VAR(VAR); VAR(VAR, VAR.VAR(""VAR"")); VAR(VAR, VAR.VAR()); } } ",5,8
xwiki-platform_6ce2d04a5779e07f6d3ed3f37d4761049b4fc3ac,xwiki-platform-core/xwiki-platform-like/xwiki-platform-like-ui/src/test/java/org/xwiki/like/LiveTableResultPagePageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.like;

import java.util.List;

import javax.inject.Named;

import org.junit.jupiter.api.Test;
import org.xwiki.like.script.LikeScriptServiceComponentList;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.script.ModelScriptService;
import org.xwiki.ratings.RatingsManager;
import org.xwiki.ratings.internal.DefaultRating;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.template.script.TemplateScriptService;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.user.UserReferenceComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import net.sf.json.JSONObject;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.ArgumentMatchers.anyInt;
import static org.mockito.ArgumentMatchers.anyMap;
import static org.mockito.Mockito.when;

/**
 * Test of {@code XWiki.Like.Code.LiveTableResultPage}.
 *
 * @version $Id$
 * @since 15.1
 * @since 14.10.6
 */
@XWikiSyntax21ComponentList
@LikeScriptServiceComponentList
@UserReferenceComponentList
@ComponentList({
    TemplateScriptService.class,
    ModelScriptService.class
})
class LiveTableResultPagePageTest extends PageTest
{
    private static final DocumentReference DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", List.of(""XWiki"", ""Like"", ""Code""), ""LiveTableResultPage"");

    @MockComponent
    @Named(""solr"")
    private RatingsManager ratingsManager;

    @Test
    void likedPageWithADot() throws Exception
    {
        DocumentReference likedPageReference = new DocumentReference(""xwiki"", ""Space"", ""With.ADot"");

        // Create an empty page to be returned as a liked page.
        XWikiDocument likedDocument = this.xwiki.getDocument(likedPageReference, this.context);
        this.xwiki.saveDocument(likedDocument, this.context);

        // The rating manager is mocked for now as the focus of the tests is currently not to test the likes indexing.
        when(this.ratingsManager.getRatings(anyMap(), anyInt(), anyInt(), any(RatingsManager.RatingQueryField.class),
            anyBoolean())).thenReturn(List.of(new DefaultRating(""id1"").setReference(likedPageReference)));

        setOutputSyntax(Syntax.PLAIN_1_0);
        this.context.setAction(""get"");

        this.request.put(""offset"", ""1"");
        this.request.put(""reqNo"", ""1"");
        this.request.put(""limit"", ""10"");

        JSONObject object = renderJSONPage(DOCUMENT_REFERENCE);

        assertEquals(""xwiki:Space.With\\.ADot"", object.getJSONArray(""rows"").getJSONObject(0).getString(""doc_fullName""));
    }
}",,6ce2d04a5779e07f6d3ed3f37d4761049b4fc3ac,CVE-2023-35152,6ce2d04a5779e07f6d3ed3f37d4761049b4fc3ac,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR.VAR.VAR}. * * @VAR $VAR$ * @VAR 15.1 * @VAR 14.10.6 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", VAR.VAR(""VAR"", ""VAR"", ""VAR""), ""VAR""); @VAR @VAR(""VAR"") VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR.VAR"");  VAR VAR = VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR);  VAR(VAR.VAR.VAR(VAR(), VAR(), VAR(), VAR(VAR.VAR.VAR), VAR())).VAR(VAR.VAR(VAR VAR(""VAR"").VAR(VAR))); VAR(VAR.VAR); VAR.VAR.VAR(""VAR""); VAR.VAR.VAR(""VAR"", ""1""); VAR.VAR.VAR(""VAR"", ""1""); VAR.VAR.VAR(""VAR"", ""10""); VAR VAR = VAR(VAR); VAR(""VAR:VAR.VAR\\.VAR"", VAR.VAR(""VAR"").VAR(0).VAR(""VAR"")); } } ",5,8
xwiki-platform_70c64c23f4404f33289458df2a08f7c4be022755,xwiki-platform-core/xwiki-platform-wexwiki-platform-web-templates/src/test/java/org/xwiki/weXPartPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.web;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.template.TemplateManager;
import org.xwiki.test.page.PageTest;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

/**
 * Tests the {@code xpart.vm} template.
 *
 * @version $Id$
 * @since 14.3RC1
 * @since 13.10.5
 */
class XPartPageTest extends PageTest
{
    private static final String X_PART_VM = ""xpart.vm"";

    private static final String VM_PARAMETER = ""vm"";

    private TemplateManager templateManager;

    @BeforeEach
    void setUp() throws Exception
    {
        this.templateManager = this.componentManager.getInstance(TemplateManager.class);
        this.request.put(""xpage"", ""xpart"");
    }

    @Test
    void renderRegisterTemplate() throws Exception
    {
        this.request.put(VM_PARAMETER, ""register.vm"");
        String result = this.templateManager.render(X_PART_VM);
        assertTrue(result.contains(""<form id=\""register\""""));
    }

    @Test
    void renderForbiddenTemplate() throws Exception
    {
        this.request.put(VM_PARAMETER, ""distribution/firstadminuser.wiki"");
        String result = this.templateManager.render(X_PART_VM);
        assertEquals(""Invalid template."", result.trim());
    }
}",,70c64c23f4404f33289458df2a08f7c4be022755,CVE-2022-36093,70c64c23f4404f33289458df2a08f7c4be022755,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR} VAR. * * @VAR $VAR$ * @VAR 14.3RC1 * @VAR 13.10.5 */ VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR""; VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR.VAR = VAR.VAR.VAR(VAR.VAR); VAR.VAR.VAR(""VAR"", ""VAR""); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(VAR, ""VAR.VAR""); VAR VAR = VAR.VAR.VAR(VAR); VAR(VAR.VAR(""<VAR VAR=\""VAR\"""")); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(VAR, ""VAR/VAR.VAR""); VAR VAR = VAR.VAR.VAR(VAR); VAR(""VAR VAR."", VAR.VAR()); } } ",5,8
xwiki-platform_71f889db9962df2d385f4298e29cfbc9050b828a,xwiki-platform-core/xwiki-platform-mail/xwiki-platform-mail-script/src/test/java/org/xwiki/mail/script/MailScriptServiceComponentList.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.mail.script;

import java.lang.annotation.Documented;
import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import org.xwiki.mail.internal.DefaultEmailAddressObfuscator;
import org.xwiki.mail.internal.DefaultSessionFactory;
import org.xwiki.mail.internal.InternetAddressConverter;
import org.xwiki.mail.internal.configuration.DefaultMailSenderConfiguration;
import org.xwiki.mail.internal.configuration.GeneralMailConfigClassDocumentConfigurationSource;
import org.xwiki.mail.internal.configuration.MainWikiGeneralMailConfigClassDocumentConfigurationSource;
import org.xwiki.mail.internal.configuration.MainWikiSendMailConfigClassDocumentConfigurationSource;
import org.xwiki.mail.internal.configuration.SendMailConfigClassDocumentConfigurationSource;
import org.xwiki.test.annotation.ComponentList;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

/**
 * Pack of default components list for {@link MailScriptService}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.3
 */
@Documented
@Retention(RUNTIME)
@Target({ TYPE, METHOD, ANNOTATION_TYPE })
@ComponentList({
    MailScriptService.class,
    MailSenderScriptService.class,
    DefaultSessionFactory.class,
    DefaultMailSenderConfiguration.class,
    SendMailConfigClassDocumentConfigurationSource.class,
    MainWikiSendMailConfigClassDocumentConfigurationSource.class,
    GeneralMailConfigClassDocumentConfigurationSource.class,
    MainWikiGeneralMailConfigClassDocumentConfigurationSource.class,
    DefaultEmailAddressObfuscator.class,
    GeneralMailScriptService.class,
    InternetAddressConverter.class
})
@Inherited
public @interface MailScriptServiceComponentList
{
}",,71f889db9962df2d385f4298e29cfbc9050b828a,CVE-2023-34467,71f889db9962df2d385f4298e29cfbc9050b828a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.3 */ @VAR @VAR(VAR) @VAR({ VAR, VAR, VAR }) @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) @VAR VAR @VAR VAR { } ",5,8
xwiki-platform_905cdd7c421dbf8c565557cdc773ab1aa9028f83,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/org/xwiki/model/internal/document/SafeDocumentAuthors.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.model.internal.document;

import java.util.Objects;

import org.xwiki.model.document.DocumentAuthors;
import org.xwiki.script.internal.safe.AbstractSafeObject;
import org.xwiki.script.wrap.AbstractWrappingObject;
import org.xwiki.user.UserReference;

/**
 * Safe implementation of {@link DocumentAuthors} that doesn't allow to use any setters. This implementation aims at
 * being used in script services. All setters throw an {@link UnsupportedOperationException}.
 *
 * @version $Id$
 * @since 14.10RC1
 * @since 14.4.7
 */
public class SafeDocumentAuthors extends AbstractWrappingObject<DocumentAuthors> implements DocumentAuthors
{
    /**
     * Default constructor.
     *
     * @param documentAuthors the wrapped authors to use for getters.
     */
    public SafeDocumentAuthors(DocumentAuthors documentAuthors)
    {
        super(documentAuthors);
    }

    @Override
    public UserReference getContentAuthor()
    {
        return getWrapped().getContentAuthor();
    }

    @Override
    public void setContentAuthor(UserReference contentAuthor)
    {
        throw new UnsupportedOperationException(AbstractSafeObject.FORBIDDEN);
    }

    @Override
    public UserReference getEffectiveMetadataAuthor()
    {
        return getWrapped().getEffectiveMetadataAuthor();
    }

    @Override
    public void setEffectiveMetadataAuthor(UserReference metadataAuthor)
    {
        throw new UnsupportedOperationException(AbstractSafeObject.FORBIDDEN);
    }

    @Override
    public UserReference getOriginalMetadataAuthor()
    {
        return getWrapped().getOriginalMetadataAuthor();
    }

    @Override
    public void setOriginalMetadataAuthor(UserReference originalMetadataAuthor)
    {
        throw new UnsupportedOperationException(AbstractSafeObject.FORBIDDEN);
    }

    @Override
    public UserReference getCreator()
    {
        return getWrapped().getCreator();
    }

    @Override
    public void setCreator(UserReference creator)
    {
        throw new UnsupportedOperationException(AbstractSafeObject.FORBIDDEN);
    }

    @Override
    public void copyAuthors(DocumentAuthors documentAuthors)
    {
        throw new UnsupportedOperationException(AbstractSafeObject.FORBIDDEN);
    }

    @Override
    public boolean equals(Object obj)
    {
        if (obj instanceof SafeDocumentAuthors) {
            return Objects.equals(this.getWrapped(), ((SafeDocumentAuthors) obj).getWrapped());
        }
        return super.equals(obj);
    }

    @Override
    public int hashCode()
    {
        return super.hashCode();
    }
}",,905cdd7c421dbf8c565557cdc773ab1aa9028f83,CVE-2023-29507,905cdd7c421dbf8c565557cdc773ab1aa9028f83,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR} VAR VAR'VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR * VAR VAR VAR VAR VAR. VAR VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.10RC1 * @VAR 14.4.7 */ VAR VAR VAR VAR VAR<VAR> VAR VAR { /** * VAR VAR. * * @VAR VAR VAR VAR VAR VAR VAR VAR VAR. */ VAR VAR(VAR VAR) { VAR(VAR); } @VAR VAR VAR VAR() { VAR VAR().VAR(); } @VAR VAR VAR VAR(VAR VAR) { VAR VAR VAR(VAR.VAR); } @VAR VAR VAR VAR() { VAR VAR().VAR(); } @VAR VAR VAR VAR(VAR VAR) { VAR VAR VAR(VAR.VAR); } @VAR VAR VAR VAR() { VAR VAR().VAR(); } @VAR VAR VAR VAR(VAR VAR) { VAR VAR VAR(VAR.VAR); } @VAR VAR VAR VAR() { VAR VAR().VAR(); } @VAR VAR VAR VAR(VAR VAR) { VAR VAR VAR(VAR.VAR); } @VAR VAR VAR VAR(VAR VAR) { VAR VAR VAR(VAR.VAR); } @VAR VAR VAR VAR(VAR VAR) { VAR (VAR VAR VAR) { VAR VAR.VAR(VAR.VAR(), ((VAR) VAR).VAR()); } VAR VAR.VAR(VAR); } @VAR VAR VAR VAR() { VAR VAR.VAR(); } } ",5,8
xwiki-platform_98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,xwiki-platform-core/xwiki-platform-help/xwiki-platform-help-test/pom.xml,"<?xml version=""1.0"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.xwiki.platform</groupId>
    <artifactId>xwiki-platform-help</artifactId>
    <version>15.1-SNAPSHOT</version>
  </parent>
  <artifactId>xwiki-platform-help-test</artifactId>
  <name>XWiki Platform - Panels - Help - Parent POM</name>
  <packaging>pom</packaging>
  <description>XWiki Platform - Help - Tests - Parent POM</description>
  <properties>
    <!-- Don't run backward-compatibility checks in test modules since we don't consider them as public APIs -->
    <xwiki.revapi.skip>true</xwiki.revapi.skip>
    <!-- Don't run Checkstyle in test modules -->
    <xwiki.checkstyle.skip>true</xwiki.checkstyle.skip>
  </properties>
  <profiles>
    <profile>
      <id>docker</id>
      <modules>
        <module>xwiki-platform-panels-test-docker</module>
      </modules>
    </profile>
  </profiles>
</project>",,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,CVE-2023-35166,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.0"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""VAR: <VAR>4.0.0</VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR>15.1-VAR</VAR> </VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>VAR VAR - VAR - VAR - VAR VAR</VAR> <VAR>VAR</VAR> <VAR>VAR VAR - VAR - VAR - VAR VAR</VAR> <VAR> <!-- VAR'VAR VAR VAR-VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR --> <VAR.VAR.VAR>VAR</VAR.VAR.VAR> <!-- VAR'VAR VAR VAR VAR VAR VAR --> <VAR.VAR.VAR>VAR</VAR.VAR.VAR> </VAR> <VAR> <VAR> <VAR>VAR</VAR> <VAR> <VAR>VAR-VAR-VAR-VAR-VAR</VAR> </VAR> </VAR> </VAR> </VAR> ",5,8
xwiki-platform_98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,xwiki-platform-core/xwiki-platform-help/xwiki-platform-help-test/xwiki-platform-help-test-docker/pom.xml,"<?xml version=""1.0"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"">
  <parent>
    <artifactId>xwiki-platform-help-test</artifactId>
    <groupId>org.xwiki.platform</groupId>
    <version>15.1-SNAPSHOT</version>
  </parent>
  <modelVersion>4.0.0</modelVersion>
  <artifactId>xwiki-platform-help-test-docker</artifactId>
  <!-- TODO: Move to use ""functional-test"" in the future when http://jira.codehaus.org/browse/MNG-1911 is fixed,
       see https://jira.xwiki.org/browse/XWIKI-7683 -->
  <packaging>jar</packaging>
  <name>XWiki Platform - Help - Tests - Functional Docker Tests</name>
  <description>XWiki Platform - Help - Tests - Functional Tests in Docker</description>
  <properties>
    <!-- Functional tests are allowed to output content to the console -->
    <xwiki.surefire.captureconsole.skip>true</xwiki.surefire.captureconsole.skip>
  </properties>
  <dependencies>
    <!-- =========================================
         Runtime Dependencies for tested features.
         ========================================= -->
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-help-ui</artifactId>
      <version>${project.version}</version>
      <scope>runtime</scope>
      <type>xar</type>
    </dependency>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-panels-ui</artifactId>
      <version>${project.version}</version>
      <scope>runtime</scope>
      <type>xar</type>
    </dependency>

    <!-- ================================
         Test only dependencies
         ================================ -->
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-test-docker</artifactId>
      <version>${project.version}</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-panels-test-pageobjects</artifactId>
      <version>${project.version}</version>
      <scope>test</scope>
    </dependency>
  </dependencies>
  <build>
    <testSourceDirectory>src/test/it</testSourceDirectory>
    <plugins>
      <!-- We need to explicitly include the failsafe plugin since it's not part of the default maven lifecycle -->
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-failsafe-plugin</artifactId>
      </plugin>
    </plugins>
  </build>
  <profiles>
    <profile>
      <id>clover</id>
      <!-- Add the Clover JAR to the WAR so that it's available at runtime when XWiki executes.
           It's needed because instrumented jars in the WAR will call Clover APIs at runtime when they execute. -->
      <dependencies>
        <dependency>
          <groupId>org.openclover</groupId>
          <artifactId>clover</artifactId>
        </dependency>
      </dependencies>
      <build>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-failsafe-plugin</artifactId>
            <configuration>
              <systemProperties combine.children=""append"">
                <!-- Tell the Docker-based test to activate the Clover profile so that the Clover JAR is added to
                     WEB-INF/lib -->
                <property>
                  <name>xwiki.test.ui.profiles</name>
                  <value>clover</value>
                </property>
              </systemProperties>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
</project>",,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,CVE-2023-35166,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.0"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""VAR: <VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>15.1-VAR</VAR> </VAR> <VAR>4.0.0</VAR> <VAR>VAR-VAR-VAR-VAR-VAR</VAR> <!-- VAR: VAR VAR VAR ""VAR-VAR"" VAR VAR VAR VAR VAR: VAR VAR: <VAR>VAR</VAR> <VAR>VAR VAR - VAR - VAR - VAR VAR VAR</VAR> <VAR>VAR VAR - VAR - VAR - VAR VAR VAR VAR</VAR> <VAR> <!-- VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR --> <VAR.VAR.VAR.VAR>VAR</VAR.VAR.VAR.VAR> </VAR> <VAR> <!-- ========================================= VAR VAR VAR VAR VAR. ========================================= --> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> </VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> </VAR> <!-- ================================ VAR VAR VAR ================================ --> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> <VAR>VAR</VAR> </VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> <VAR>VAR</VAR> </VAR> </VAR> <VAR> <VAR>VAR/VAR/VAR</VAR> <VAR> <!-- VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR --> <VAR> <VAR>VAR.VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> </VAR> </VAR> </VAR> <VAR> <VAR> <VAR>VAR</VAR> <!-- VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR. VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. --> <VAR> <VAR> <VAR>VAR.VAR</VAR> <VAR>VAR</VAR> </VAR> </VAR> <VAR> <VAR> <VAR> <VAR>VAR.VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR> <VAR VAR.VAR=""VAR""> <!-- VAR VAR VAR-VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR/VAR --> <VAR> <VAR>VAR.VAR.VAR.VAR</VAR> <VAR>VAR</VAR> </VAR> </VAR> </VAR> </VAR> </VAR> </VAR> </VAR> </VAR> </VAR> ",5,8
xwiki-platform_98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,xwiki-platform-core/xwiki-platform-help/xwiki-platform-help-test/xwiki-platform-help-test-docker/src/test/it/org/xwiki/help/test/ui/docker/AllITs.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.help.test.ui.docker;

import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.xwiki.test.docker.junit5.UITest;

/**
 * All UI Tests for the Help Application.
 *
 * @version $Id$
 */
@UITest
class AllITs
{
    @Nested
    @DisplayName(""Tips panel"")
    class NestedPanelIT extends TipsPanelIT
    {
    }
}",,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,CVE-2023-35166,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ */ @VAR VAR VAR { @VAR @VAR(""VAR VAR"") VAR VAR VAR VAR { } } ",5,8
xwiki-platform_98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,xwiki-platform-core/xwiki-platform-help/xwiki-platform-help-test/xwiki-platform-help-test-docker/src/test/it/org/xwiki/help/test/ui/docker/TipsPanelIT.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.help.test.ui.docker;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.reference.LocalDocumentReference;
import org.xwiki.panels.test.po.PanelViewPage;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.rendering.wikimacro.internal.WikiMacroClassDocumentInitializer;
import org.xwiki.rest.model.jaxb.Objects;
import org.xwiki.rest.model.jaxb.Page;
import org.xwiki.test.docker.junit5.TestReference;
import org.xwiki.test.docker.junit5.UITest;
import org.xwiki.test.ui.TestUtils;
import org.xwiki.uiextension.internal.UIExtensionClassDocumentInitializer;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.xwiki.test.ui.TestUtils.RestTestUtils.object;
import static org.xwiki.test.ui.TestUtils.RestTestUtils.property;

/**
 * Validate the Tips panel.
 *
 * @version $Id$
 */
@UITest
class TipsPanelIT
{
    private final static String TIPS_UIXP = ""org.xwiki.platform.help.tipsPanel"";

    private final static String TIPS_UIXP_DISABLED = TIPS_UIXP + "".disabled"";

    @BeforeEach
    void setUp(TestUtils testUtils)
    {
        testUtils.loginAsSuperAdmin();
    }

    @Test
    @Order(1)
    void verifyTipsPropertyIsRestricted(TestUtils testUtils, TestReference testReference) throws Exception
    {
        // Unregister all tips
        switchUIXs(TIPS_UIXP, TIPS_UIXP_DISABLED, testUtils);

        // Register a macro to check if the context is restricted
        registerIsrestrictedMacro(testUtils);

        // Create a tip with tip property
        Page tipPage = testUtils.rest().page(testReference);
        tipPage.setObjects(new Objects());
        org.xwiki.rest.model.jaxb.Object tipObject = object(UIExtensionClassDocumentInitializer.CLASS_REFERENCE_STRING);
        tipObject.getProperties().add(property(""extensionPointId"", ""org.xwiki.platform.help.tipsPanel""));
        tipObject.getProperties().add(property(""parameters"",
            ""tip=execution is restricted: {{isrestricted/}}""));
        tipPage.getObjects().getObjectSummaries().add(tipObject);
        testUtils.rest().save(tipPage);

        // Execute the tip panel and verify the result is restricted (the velocity macro is forbidden)
        testUtils.gotoPage(new DocumentReference(""xwiki"", ""Help"", ""TipsPanel"", ""WebHome""));
        PanelViewPage panelPage = new PanelViewPage();
        assertEquals(""execution is restricted: true"", panelPage.getPanelContent().getText());

        // Put back all tips
        switchUIXs(TIPS_UIXP_DISABLED, TIPS_UIXP, testUtils);
    }

    private void switchUIXs(String oldid, String newid, TestUtils testUtils) throws Exception
    {
        testUtils.executeWiki(String.format(
        // @formatter:off
            ""{{velocity}}\n""
            + ""#foreach($uix in $services.uix.getExtensions('%s'))\n""
            + ""  #set ($uixDocument = $xwiki.getDocument($uix.documentReference))\n""
            + ""  $uixDocument.set('extensionPointId', '%s')\n""
            + ""  $uixDocument.save()\n""
            + ""#end\n""
            + ""{{/velocity}}"", oldid, newid)
            // @formatter:on
            , Syntax.XWIKI_2_1);
    }

    private void registerIsrestrictedMacro(TestUtils testUtils) throws Exception
    {
        LocalDocumentReference macroReference = new LocalDocumentReference(""Test"", ""IsrestrictedMacro"");
        Page macroPage = testUtils.rest().page(macroReference);
        macroPage.setObjects(new Objects());
        org.xwiki.rest.model.jaxb.Object tipObject = object(WikiMacroClassDocumentInitializer.WIKI_MACRO_CLASS);
        tipObject.getProperties().add(property(""id"", ""isrestricted""));
        tipObject.getProperties().add(property(""supportsInlineMode"", 1));
        tipObject.getProperties().add(property(""code"",
            ""{{velocity}}$wikimacro.context.transformationContext.isRestricted(){{/velocity}}""));
        macroPage.getObjects().getObjectSummaries().add(tipObject);
        testUtils.rest().save(macroPage);
    }
}",,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,CVE-2023-35166,98208c5bb1e8cdf3ff1ac35d8b3d1cb3c28b3263,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR. * * @VAR $VAR$ */ @VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR.VAR.VAR.VAR""; VAR VAR VAR VAR VAR = VAR + "".VAR""; @VAR VAR VAR(VAR VAR) { VAR.VAR(); } @VAR @VAR(1) VAR VAR(VAR VAR, VAR VAR) VAR VAR {  VAR(VAR, VAR, VAR);  VAR(VAR);  VAR VAR = VAR.VAR().VAR(VAR); VAR.VAR(VAR VAR()); VAR.VAR.VAR.VAR.VAR.VAR VAR = VAR(VAR.VAR); VAR.VAR().VAR(VAR(""VAR"", ""VAR.VAR.VAR.VAR.VAR"")); VAR.VAR().VAR(VAR(""VAR"", ""VAR=VAR VAR VAR: {{VAR/}}"")); VAR.VAR().VAR().VAR(VAR); VAR.VAR().VAR(VAR);  VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"", ""VAR"")); VAR VAR = VAR VAR(); VAR(""VAR VAR VAR: VAR"", VAR.VAR().VAR());  VAR(VAR, VAR, VAR); } VAR VAR VAR(VAR VAR, VAR VAR, VAR VAR) VAR VAR { VAR.VAR(VAR.VAR(  ""{{VAR}}\VAR"" + "" + ""  + "" $VAR.VAR('VAR', '%VAR')\VAR"" + "" $VAR.VAR()\VAR"" + "" + ""{{/VAR}}"", VAR, VAR)  , VAR.VAR); } VAR VAR VAR(VAR VAR) VAR VAR { VAR VAR = VAR VAR(""VAR"", ""VAR""); VAR VAR = VAR.VAR().VAR(VAR); VAR.VAR(VAR VAR()); VAR.VAR.VAR.VAR.VAR.VAR VAR = VAR(VAR.VAR); VAR.VAR().VAR(VAR(""VAR"", ""VAR"")); VAR.VAR().VAR(VAR(""VAR"", 1)); VAR.VAR().VAR(VAR(""VAR"", ""{{VAR}}$VAR.VAR.VAR.VAR(){{/VAR}}"")); VAR.VAR().VAR().VAR(VAR); VAR.VAR().VAR(VAR); } } ",5,8
xwiki-platform_9d9d86179457cb8dc48b4491510537878800be4f,xwiki-platform-core/xwiki-platform-ckeditor/xwiki-platform-ckeditor-ui/src/main/resources/CKEditor/WebPreferences.xml,"<?xml version=""1.1"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version=""1.5"" reference=""CKEditor.WebPreferences"" locale="""">
  <web>CKEditor</web>
  <name>WebPreferences</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <parent>CKEditor.WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title>$services.localization.render('admin.preferences.title')</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>true</hidden>
  <content/>
  <object>
    <name>CKEditor.WebPreferences</name>
    <number>0</number>
    <className>XWiki.XWikiGlobalRights</className>
    <guid>71ae5d9d-eb05-41e1-9794-8011646619ed</guid>
    <class>
      <name>XWiki.XWikiGlobalRights</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <allow>
        <defaultValue>1</defaultValue>
        <disabled>0</disabled>
        <displayFormType>select</displayFormType>
        <displayType>allow</displayType>
        <name>allow</name>
        <number>4</number>
        <prettyName>Allow/Deny</prettyName>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
      </allow>
      <groups>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>groups</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Groups</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.GroupsClass</classType>
      </groups>
      <levels>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>1</multiSelect>
        <name>levels</name>
        <number>2</number>
        <prettyName>Levels</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>3</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.LevelsClass</classType>
      </levels>
      <users>
        <cache>0</cache>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <multiSelect>1</multiSelect>
        <name>users</name>
        <number>3</number>
        <picker>1</picker>
        <prettyName>Users</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.UsersClass</classType>
      </users>
    </class>
    <property>
      <allow>1</allow>
    </property>
    <property>
      <groups>XWiki.XWikiAdminGroup</groups>
    </property>
    <property>
      <levels>edit,delete</levels>
    </property>
    <property>
      <users/>
    </property>
  </object>
</xwikidoc>",,9d9d86179457cb8dc48b4491510537878800be4f,CVE-2023-36477,9d9d86179457cb8dc48b4491510537878800be4f,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.1"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""1.5"" VAR=""VAR.VAR"" VAR=""""> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR/> <VAR/> <VAR>0</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>VAR.VAR</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>1.1</VAR> <VAR>$VAR.VAR.VAR('VAR.VAR.VAR')</VAR> <VAR/> <VAR>VAR</VAR> <VAR>VAR/2.1</VAR> <VAR>VAR</VAR> <VAR/> <VAR> <VAR>VAR.VAR</VAR> <VAR>0</VAR> <VAR>VAR.VAR</VAR> <VAR>71ae5d9d-VAR-41e1-9794-8011646619ed</VAR> <VAR> <VAR>VAR.VAR</VAR> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR> <VAR>1</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR>4</VAR> <VAR>VAR/VAR</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> <VAR> <VAR>0</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>1</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR> </VAR> <VAR>5</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> <VAR> <VAR>0</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>2</VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR> </VAR> <VAR>3</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> <VAR> <VAR>0</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>3</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR> </VAR> <VAR>5</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> </VAR> <VAR> <VAR>1</VAR> </VAR> <VAR> <VAR>VAR.VAR</VAR> </VAR> <VAR> <VAR>VAR,VAR</VAR> </VAR> <VAR> <VAR/> </VAR> </VAR> </VAR> ",5,8
xwiki-platform_9e8f080094333dec63a8583229a3799208d773be,xwiki-platform-core/xwiki-platform-menu/xwiki-platform-menu-ui/src/test/java/org/xwiki/menu/UIExtensionSheetPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.menu;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.uiextension.internal.UIExtensionClassDocumentInitializer;

import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.objects.BaseObject;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

/**
 * Page test for the document {@code Menu.UIExtensionSheet}.
 *
 * @version $Id$
 */
@ComponentList({
    UIExtensionClassDocumentInitializer.class
})
@HTML50ComponentList
@XWikiSyntax21ComponentList
class UIExtensionSheetPageTest extends PageTest
{
    private static final DocumentReference SHEET_REFERENCE = new DocumentReference(""xwiki"", ""Menu"", ""UIExtensionSheet"");

    @Test
    void escaping() throws Exception
    {
        DocumentReference testDocumentReference = new DocumentReference(""xwiki"", ""space"", ""test"");
        XWikiDocument testDocument = new XWikiDocument(testDocumentReference);
        BaseObject uiExtension =
            testDocument.newXObject(UIExtensionClassDocumentInitializer.UI_EXTENSION_CLASS, this.context);
        String extensionID = ""\""{{/html}}</option>"";
        String contentValue = ""content +"" + extensionID;
        uiExtension.setLargeStringValue(UIExtensionClassDocumentInitializer.CONTENT_PROPERTY, contentValue);
        uiExtension.setStringValue(UIExtensionClassDocumentInitializer.EXTENSION_POINT_ID_PROPERTY, extensionID);
        this.xwiki.saveDocument(testDocument, this.context);

        this.context.setDoc(testDocument);
        this.context.setAction(""edit"");

        XWikiDocument sheet = loadPage(SHEET_REFERENCE);
        String htmlContent = sheet.getRenderedContent(this.context);
        Document renderedDocument = Jsoup.parse(htmlContent);

        Element selectElement = renderedDocument.getElementById(""XWiki.UIExtensionClass_0_extensionPointId"");
        assertNotNull(selectElement);
        Elements optionElement = selectElement.getElementsByAttributeValue(""value"", extensionID);
        assertEquals(1, optionElement.size());
        String extensionIdTitle = ""menu.uix.extensionPoint.value."" + extensionID;
        assertEquals(extensionIdTitle, optionElement.get(0).text());

        selectElement = renderedDocument.getElementById(""XWiki.UIExtensionClass_0_content"");
        assertNotNull(selectElement);
        optionElement = selectElement.getElementsByAttributeValue(""value"", contentValue);
        assertEquals(1, optionElement.size());
        assertEquals(extensionIdTitle, optionElement.get(0).text());
    }
}",,9e8f080094333dec63a8583229a3799208d773be,CVE-2023-37909,9e8f080094333dec63a8583229a3799208d773be,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ */ @VAR({ VAR.VAR }) @VAR @VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR = VAR VAR(VAR); VAR VAR = VAR.VAR(VAR.VAR, VAR.VAR); VAR VAR = ""\""{{/VAR}}</VAR>""; VAR VAR = ""VAR +"" + VAR; VAR.VAR(VAR.VAR, VAR); VAR.VAR(VAR.VAR, VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR.VAR(VAR); VAR.VAR.VAR(""VAR""); VAR VAR = VAR(VAR); VAR VAR = VAR.VAR(VAR.VAR); VAR VAR = VAR.VAR(VAR); VAR VAR = VAR.VAR(""VAR.VAR""); VAR(VAR); VAR VAR = VAR.VAR(""VAR"", VAR); VAR(1, VAR.VAR()); VAR VAR = ""VAR.VAR.VAR.VAR."" + VAR; VAR(VAR, VAR.VAR(0).VAR()); VAR = VAR.VAR(""VAR.VAR""); VAR(VAR); VAR = VAR.VAR(""VAR"", VAR); VAR(1, VAR.VAR()); VAR(VAR, VAR.VAR(0).VAR()); } } ",5,8
xwiki-platform_a0e6ca083b36be6f183b9af33ae735c1e02010f4,xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/weEditActionTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.web;

import javax.inject.Named;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.store.TemporaryAttachmentSessionsManager;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.user.UserReference;
import org.xwiki.user.UserReferenceResolver;
import org.xwiki.user.UserReferenceSerializer;

import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.test.MockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.InjectMockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;
import com.xpn.xwiki.test.reference.ReferenceComponentList;

import static org.junit.jupiter.api.Assertions.assertSame;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

/**
 * Validate {@link EditAction}.
 *
 * @version $Id$
 */
@OldcoreTest
@ReferenceComponentList
public class EditActionTest
{
    private static final DocumentReference USER_DOCUMENT_REFERENCE = new DocumentReference(""wiki"", ""XWiki"", ""user"");

    private static final UserReference USER_REFERENCE = mock(UserReference.class);

    private static final UserReference OTHERUSER_REFERENCE = mock(UserReference.class);

    @InjectMockComponents
    private EditAction action;

    @InjectMockitoOldcore
    private MockitoOldcore oldcore;

    @MockComponent
    private TemporaryAttachmentSessionsManager temporaryAttachmentSessionsManager;

    @MockComponent
    @Named(""document"")
    private UserReferenceResolver<DocumentReference> documentReferenceUserReferenceResolver;

    @MockComponent
    @Named(""document"")
    private UserReferenceSerializer<DocumentReference> documentReferenceUserReferenceSerializer;

    @Mock
    private XWikiRequest request;

    @BeforeEach
    public void beforeEach()
    {
        when(this.documentReferenceUserReferenceResolver.resolve(USER_DOCUMENT_REFERENCE)).thenReturn(USER_REFERENCE);
        when(this.documentReferenceUserReferenceSerializer.serialize(USER_REFERENCE)).thenReturn(USER_DOCUMENT_REFERENCE);

        this.oldcore.getXWikiContext().setUserReference(USER_DOCUMENT_REFERENCE);
    }

    private String initAndRenderAction() throws XWikiException
    {
        EditForm form = new EditForm();
        form.reset(this.request);

        this.oldcore.getXWikiContext().setForm(form);

        return this.action.render(this.oldcore.getXWikiContext());
    }

    @Test
    void documentAuthorsWhenDocumentDoesNotExist() throws XWikiException
    {
        XWikiDocument document = oldcore.getSpyXWiki().getDocument(new DocumentReference(""wiki"", ""space"", ""page""),
            this.oldcore.getXWikiContext());
        this.oldcore.getXWikiContext().setDoc(document);

        initAndRenderAction();

        document = this.oldcore.getXWikiContext().getDoc();

        assertSame(USER_REFERENCE, document.getAuthors().getContentAuthor());
        assertSame(USER_REFERENCE, document.getAuthors().getCreator());
        assertSame(USER_REFERENCE, document.getAuthors().getEffectiveMetadataAuthor());
        assertSame(USER_REFERENCE, document.getAuthors().getOriginalMetadataAuthor());
    }

    @Test
    void documentAuthorsWhenDocumentExist() throws XWikiException
    {
        XWikiDocument document = this.oldcore.getSpyXWiki().getDocument(new DocumentReference(""wiki"", ""space"", ""page""),
            this.oldcore.getXWikiContext());
        document.getAuthors().setCreator(OTHERUSER_REFERENCE);
        document.getAuthors().setContentAuthor(OTHERUSER_REFERENCE);
        document.getAuthors().setEffectiveMetadataAuthor(OTHERUSER_REFERENCE);
        document.getAuthors().setOriginalMetadataAuthor(OTHERUSER_REFERENCE);
        this.oldcore.getSpyXWiki().saveDocument(document, this.oldcore.getXWikiContext());

        document = this.oldcore.getSpyXWiki().getDocument(new DocumentReference(""wiki"", ""space"", ""page""),
            this.oldcore.getXWikiContext());
        this.oldcore.getXWikiContext().setDoc(document);
        this.oldcore.getXWikiContext().put(""tdoc"", document);

        initAndRenderAction();

        document = this.oldcore.getXWikiContext().getDoc();

        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getContentAuthor());
        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getCreator());
        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getEffectiveMetadataAuthor());
        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getOriginalMetadataAuthor());
    }

    @Test
    void documentAuthorsWhenDocumentExistAndContentIsModified() throws XWikiException
    {
        XWikiDocument document = this.oldcore.getSpyXWiki().getDocument(new DocumentReference(""wiki"", ""space"", ""page""),
            this.oldcore.getXWikiContext());
        document.getAuthors().setCreator(OTHERUSER_REFERENCE);
        document.getAuthors().setContentAuthor(OTHERUSER_REFERENCE);
        document.getAuthors().setEffectiveMetadataAuthor(OTHERUSER_REFERENCE);
        document.getAuthors().setOriginalMetadataAuthor(OTHERUSER_REFERENCE);
        this.oldcore.getSpyXWiki().saveDocument(document, this.oldcore.getXWikiContext());

        document = this.oldcore.getSpyXWiki().getDocument(new DocumentReference(""wiki"", ""space"", ""page""),
            this.oldcore.getXWikiContext());
        this.oldcore.getXWikiContext().setDoc(document);
        this.oldcore.getXWikiContext().put(""tdoc"", document);

        when(this.request.getParameter(""content"")).thenReturn(""modified content"");

        initAndRenderAction();

        document = this.oldcore.getXWikiContext().getDoc();

        assertSame(USER_REFERENCE, document.getAuthors().getContentAuthor());
        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getCreator());
        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getEffectiveMetadataAuthor());
        assertSame(OTHERUSER_REFERENCE, document.getAuthors().getOriginalMetadataAuthor());
    }
}",,a0e6ca083b36be6f183b9af33ae735c1e02010f4,CVE-2023-46243,a0e6ca083b36be6f183b9af33ae735c1e02010f4,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR @VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR VAR VAR VAR = VAR(VAR.VAR); VAR VAR VAR VAR VAR = VAR(VAR.VAR); @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR @VAR(""VAR"") VAR VAR<VAR> VAR; @VAR @VAR(""VAR"") VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR() { VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR().VAR(VAR); } VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR); VAR.VAR.VAR().VAR(VAR); VAR VAR.VAR.VAR(VAR.VAR.VAR()); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR.VAR().VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR.VAR()); VAR.VAR.VAR().VAR(VAR); VAR(); VAR = VAR.VAR.VAR().VAR(); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR.VAR.VAR().VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR.VAR()); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR); VAR.VAR.VAR().VAR(VAR, VAR.VAR.VAR()); VAR = VAR.VAR.VAR().VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR.VAR()); VAR.VAR.VAR().VAR(VAR); VAR.VAR.VAR().VAR(""VAR"", VAR); VAR(); VAR = VAR.VAR.VAR().VAR(); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR.VAR.VAR().VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR.VAR()); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR); VAR.VAR.VAR().VAR(VAR, VAR.VAR.VAR()); VAR = VAR.VAR.VAR().VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR.VAR()); VAR.VAR.VAR().VAR(VAR); VAR.VAR.VAR().VAR(""VAR"", VAR); VAR(VAR.VAR.VAR(""VAR"")).VAR(""VAR VAR""); VAR(); VAR = VAR.VAR.VAR().VAR(); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); } } ",5,8
xwiki-platform_b0cdfd893912baaa053d106a92e39fa1858843c7,xwiki-platform-core/xwiki-platform-bridge/src/main/java/org/xwiki/bridge/internal/DefaultDocumentContextExecutor.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.bridge.internal;

import java.util.HashMap;
import java.util.Map;
import java.util.concurrent.Callable;

import javax.inject.Inject;
import javax.inject.Singleton;

import org.xwiki.bridge.DocumentAccessBridge;
import org.xwiki.bridge.DocumentModelBridge;
import org.xwiki.component.annotation.Component;
import org.xwiki.model.ModelContext;
import org.xwiki.model.reference.EntityReference;

/**
 * Default implementation of {@link DocumentContextExecutor}.
 *
 * @version $Id$
 * @since 14.10.6
 * @since 15.2RC1
 */
@Component
@Singleton
public class DefaultDocumentContextExecutor implements DocumentContextExecutor
{
    @Inject
    private DocumentAccessBridge documentAccessBridge;

    @Inject
    private ModelContext modelContext;

    @Override
    public <V> V call(Callable<V> callable, DocumentModelBridge document) throws Exception
    {
        Map<String, Object> backupObjects = new HashMap<>();
        EntityReference currentWikiReference = this.modelContext.getCurrentEntityReference();
        boolean canPop = false;

        try {
            this.documentAccessBridge.pushDocumentInContext(backupObjects, document);
            canPop = true;
            // Make sure to synchronize the context wiki with the context document's wiki.
            this.modelContext.setCurrentEntityReference(document.getDocumentReference().getWikiReference());

            return callable.call();
        } finally {
            if (canPop) {
                this.documentAccessBridge.popDocumentFromContext(backupObjects);
                // Also restore the context wiki.
                this.modelContext.setCurrentEntityReference(currentWikiReference);
            }
        }
    }
}",,b0cdfd893912baaa053d106a92e39fa1858843c7,CVE-2023-36470,b0cdfd893912baaa053d106a92e39fa1858843c7,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.10.6 * @VAR 15.2RC1 */ @VAR @VAR VAR VAR VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR <VAR> VAR VAR(VAR<VAR> VAR, VAR VAR) VAR VAR { VAR<VAR, VAR> VAR = VAR VAR<>(); VAR VAR = VAR.VAR.VAR(); VAR VAR = VAR; VAR { VAR.VAR.VAR(VAR, VAR); VAR = VAR;  VAR.VAR.VAR(VAR.VAR().VAR()); VAR VAR.VAR(); } VAR { VAR (VAR) { VAR.VAR.VAR(VAR);  VAR.VAR.VAR(VAR); } } } } ",5,8
xwiki-platform_b0cdfd893912baaa053d106a92e39fa1858843c7,xwiki-platform-core/xwiki-platform-bridge/src/main/java/org/xwiki/bridge/internal/DocumentContextExecutor.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.bridge.internal;

import java.util.concurrent.Callable;

import org.xwiki.bridge.DocumentModelBridge;
import org.xwiki.component.annotation.Role;

/**
 * Executes a {@link Callable} with the given document in context.
 *
 * @version $Id$
 * @since 14.10.6
 * @since 15.2RC1
 */
@Role
public interface DocumentContextExecutor
{
    /**
     * Execute the passed {@link Callable} with the given document in context.
     *
     * @param callable the task to execute
     * @param document the document to put in context
     * @return computed result
     * @param <V> the result type of method {@code call}
     */
    <V> V call(Callable<V> callable, DocumentModelBridge document) throws Exception;
}",,b0cdfd893912baaa053d106a92e39fa1858843c7,CVE-2023-36470,b0cdfd893912baaa053d106a92e39fa1858843c7,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10.6 * @VAR 15.2RC1 */ @VAR VAR VAR VAR { /** * VAR VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR. * * @VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR * @VAR <VAR> VAR VAR VAR VAR VAR {@VAR VAR} */ <VAR> VAR VAR(VAR<VAR> VAR, VAR VAR) VAR VAR; } ",5,8
xwiki-platform_b0cdfd893912baaa053d106a92e39fa1858843c7,xwiki-platform-core/xwiki-platform-bridge/src/test/java/org/xwiki/bridge/internal/DefaultDocumentContextExecutorTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.bridge.internal;

import java.util.Map;
import java.util.concurrent.Callable;
import java.util.concurrent.atomic.AtomicReference;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.InOrder;
import org.mockito.Mock;
import org.xwiki.bridge.DocumentAccessBridge;
import org.xwiki.bridge.DocumentModelBridge;
import org.xwiki.model.EntityType;
import org.xwiki.model.ModelContext;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.reference.EntityReference;
import org.xwiki.model.reference.WikiReference;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;

import static org.junit.jupiter.api.Assertions.assertSame;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.same;
import static org.mockito.Mockito.doAnswer;
import static org.mockito.Mockito.doThrow;
import static org.mockito.Mockito.inOrder;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.verifyNoInteractions;
import static org.mockito.Mockito.when;

/**
 * Unit test for {@link DefaultDocumentContextExecutor}.
 *
 * @version $Id$
 */
@ComponentTest
class DefaultDocumentContextExecutorTest
{
    private static final WikiReference TEST_WIKI_REFERENCE = new WikiReference(""xwiki"");

    private static final DocumentReference TEST_DOCUMENT_REFERENCE =
        new DocumentReference(TEST_WIKI_REFERENCE.getName(), ""Space"", ""WebHome"");

    private static final WikiReference INITIAL_WIKI_REFERENCE = new WikiReference(""initial"");

    @MockComponent
    private ModelContext modelContext;

    @MockComponent
    private DocumentAccessBridge documentAccessBridge;

    @InjectMockComponents
    private DefaultDocumentContextExecutor executor;

    @Mock
    private Callable<Object> mockCallable;

    @Mock
    private DocumentModelBridge documentModelBridge;

    private WikiReference modelWikiReference;

    @BeforeEach
    public void beforeEach()
    {
        when(this.documentModelBridge.getDocumentReference()).thenReturn(TEST_DOCUMENT_REFERENCE);

        // Mock actually storing the wiki reference
        this.modelWikiReference = INITIAL_WIKI_REFERENCE;
        when(this.modelContext.getCurrentEntityReference()).thenReturn(this.modelWikiReference);
        doAnswer(invocationOnMock -> {
            EntityReference entityWikiReference =
                invocationOnMock.getArgument(0, EntityReference.class).extractReference(EntityType.WIKI);
            this.modelWikiReference = new WikiReference(entityWikiReference.getName());
            return null;
        }).when(this.modelContext).setCurrentEntityReference(any(EntityReference.class));
    }

    @Test
    void call() throws Exception
    {
        String callResult = ""callResult"";
        when(this.mockCallable.call()).thenReturn(callResult);
        AtomicReference<Map<String, Object>> backupObjects = new AtomicReference<>();
        doAnswer(invocationOnMock -> {
            backupObjects.set(invocationOnMock.getArgument(0));
            return null;
        }).when(this.documentAccessBridge).pushDocumentInContext(any(), same(this.documentModelBridge));

        Object actualResult = this.executor.call(this.mockCallable, this.documentModelBridge);

        assertSame(callResult, actualResult);
        InOrder inOrder = inOrder(this.documentAccessBridge, this.modelContext);
        inOrder.verify(this.documentAccessBridge).pushDocumentInContext(any(), same(this.documentModelBridge));
        inOrder.verify(this.modelContext).setCurrentEntityReference(TEST_WIKI_REFERENCE);
        inOrder.verify(this.documentAccessBridge).popDocumentFromContext(backupObjects.get());
        inOrder.verify(this.modelContext).setCurrentEntityReference(INITIAL_WIKI_REFERENCE);
    }

    @Test
    void popWhenCallableThrows() throws Exception
    {
        Exception testException = new Exception(""Callable failed"");
        when(this.mockCallable.call()).thenThrow(testException);

        assertThrows(Exception.class, () -> this.executor.call(this.mockCallable, this.documentModelBridge));
        InOrder inOrder = inOrder(this.documentAccessBridge, this.modelContext);
        inOrder.verify(this.modelContext).setCurrentEntityReference(TEST_WIKI_REFERENCE);
        inOrder.verify(this.documentAccessBridge).popDocumentFromContext(any());
        inOrder.verify(this.modelContext).setCurrentEntityReference(INITIAL_WIKI_REFERENCE);
    }

    @Test
    void doNothingWhenPushThrows() throws Exception
    {
        Exception testException = new Exception(""Test"");
        doThrow(testException)
            .when(this.documentAccessBridge).pushDocumentInContext(any(), same(this.documentModelBridge));

        assertThrows(Exception.class, () -> this.executor.call(this.mockCallable, this.documentModelBridge));

        verifyNoInteractions(this.mockCallable);
        verify(this.modelContext, never()).setCurrentEntityReference(any());
    }
}",,b0cdfd893912baaa053d106a92e39fa1858843c7,CVE-2023-36470,b0cdfd893912baaa053d106a92e39fa1858843c7,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR""); VAR VAR VAR VAR VAR = VAR VAR(VAR.VAR(), ""VAR"", ""VAR""); VAR VAR VAR VAR VAR = VAR VAR(""VAR""); @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR VAR() { VAR(VAR.VAR.VAR()).VAR(VAR);  VAR.VAR = VAR; VAR(VAR.VAR.VAR()).VAR(VAR.VAR); VAR(VAR -> { VAR VAR = VAR.VAR(0, VAR.VAR).VAR(VAR.VAR); VAR.VAR = VAR VAR(VAR.VAR()); VAR VAR; }).VAR(VAR.VAR).VAR(VAR(VAR.VAR)); } @VAR VAR VAR() VAR VAR { VAR VAR = ""VAR""; VAR(VAR.VAR.VAR()).VAR(VAR); VAR<VAR<VAR, VAR>> VAR = VAR VAR<>(); VAR(VAR -> { VAR.VAR(VAR.VAR(0)); VAR VAR; }).VAR(VAR.VAR).VAR(VAR(), VAR(VAR.VAR)); VAR VAR = VAR.VAR.VAR(VAR.VAR, VAR.VAR); VAR(VAR, VAR); VAR VAR = VAR(VAR.VAR, VAR.VAR); VAR.VAR(VAR.VAR).VAR(VAR(), VAR(VAR.VAR)); VAR.VAR(VAR.VAR).VAR(VAR); VAR.VAR(VAR.VAR).VAR(VAR.VAR()); VAR.VAR(VAR.VAR).VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(""VAR VAR""); VAR(VAR.VAR.VAR()).VAR(VAR); VAR(VAR.VAR, () -> VAR.VAR.VAR(VAR.VAR, VAR.VAR)); VAR VAR = VAR(VAR.VAR, VAR.VAR); VAR.VAR(VAR.VAR).VAR(VAR); VAR.VAR(VAR.VAR).VAR(VAR()); VAR.VAR(VAR.VAR).VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(""VAR""); VAR(VAR) .VAR(VAR.VAR).VAR(VAR(), VAR(VAR.VAR)); VAR(VAR.VAR, () -> VAR.VAR.VAR(VAR.VAR, VAR.VAR)); VAR(VAR.VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); } } ",5,8
xwiki-platform_b0cdfd893912baaa053d106a92e39fa1858843c7,xwiki-platform-core/xwiki-platform-rendering/xwiki-platform-rendering-xwiki/src/main/java/org/xwiki/rendering/internal/util/XWikiSyntaxEscaper.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.rendering.internal.util;

import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.rendering.syntax.Syntax;

/**
 * Escaping helpers.
 *
 * @version $Id$
 * @since 14.10.6
 * @since 15.2RC1
 */
@Component(roles = XWikiSyntaxEscaper.class)
@Singleton
public class XWikiSyntaxEscaper
{
    /**
     * Escapes a give text using the escaping method specific to the given syntax.
     * <p>
     * One example of escaping method is using escape characters like {@code ~} for the {@link Syntax#XWIKI_2_1} syntax
     * on all or just some characters of the given text.
     * <p>
     * The current implementation only escapes XWiki 1.0, 2.0 and 2.1 syntaxes.
     *
     * @param content the text to escape
     * @param syntax the syntax to escape the content in (e.g. {@link Syntax#XWIKI_1_0}, {@link Syntax#XWIKI_2_0},
     *     {@link Syntax#XWIKI_2_1}, etc.). This is the syntax where the output will be used and not necessarily the
     *     same syntax of the input content
     * @return the escaped text or {@code null} if the given content or the given syntax are {@code null}, or if the
     *     syntax is not supported
     */
    public String escape(String content, Syntax syntax)
    {
        if (content == null || syntax == null) {
            return null;
        }

        // Determine the escape character for the syntax.
        char escapeChar;
        try {
            escapeChar = getEscapeCharacter(syntax);
        } catch (Exception e) {
            // We don`t know how to proceed, so we just return null.
            return null;
        }

        // Since we prefix all characters, the result size will be double the input's, so we can just use char[].
        char[] result = new char[content.length() * 2];

        // Escape the content.
        for (int i = 0; i < content.length(); i++) {
            result[2 * i] = escapeChar;
            result[2 * i + 1] = content.charAt(i);
        }

        return String.valueOf(result);
    }

    private char getEscapeCharacter(Syntax syntax) throws IllegalArgumentException
    {
        if (Syntax.XWIKI_1_0.equals(syntax)) {
            return '\\';
        } else if (Syntax.XWIKI_2_0.equals(syntax) || Syntax.XWIKI_2_1.equals(syntax)) {
            return '~';
        }

        throw new IllegalArgumentException(String.format(""Escaping is not supported for Syntax [%s]"", syntax));
    }
}",,b0cdfd893912baaa053d106a92e39fa1858843c7,CVE-2023-36470,b0cdfd893912baaa053d106a92e39fa1858843c7,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR. * * @VAR $VAR$ * @VAR 14.10.6 * @VAR 15.2RC1 */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * <VAR> * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR {@VAR ~} VAR VAR {@VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * <VAR> * VAR VAR VAR VAR VAR VAR 1.0, 2.0 VAR 2.1 VAR. * * @VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR VAR VAR (VAR.VAR. {@VAR VAR * {@VAR VAR * VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR VAR VAR VAR {@VAR VAR}, VAR VAR VAR * VAR VAR VAR VAR */ VAR VAR VAR(VAR VAR, VAR VAR) { VAR (VAR == VAR || VAR == VAR) { VAR VAR; }  VAR VAR; VAR { VAR = VAR(VAR); } VAR (VAR VAR) {  VAR VAR; }  VAR[] VAR = VAR VAR[VAR.VAR() * 2];  VAR (VAR VAR = 0; VAR < VAR.VAR(); VAR++) { VAR[2 * VAR] = VAR; VAR[2 * VAR + 1] = VAR.VAR(VAR); } VAR VAR.VAR(VAR); } VAR VAR VAR(VAR VAR) VAR VAR { VAR (VAR.VAR.VAR(VAR)) { VAR '\\'; } VAR VAR (VAR.VAR.VAR(VAR) || VAR.VAR.VAR(VAR)) { VAR '~'; } VAR VAR VAR(VAR.VAR(""VAR VAR VAR VAR VAR VAR [%VAR]"", VAR)); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-extension/xwiki-platform-extension-handlers/xwiki-platform-extension-handler-xar/src/main/java/org/xwiki/extension/xar/internal/DefaultXARExtensionIndex.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.extension.xar.internal;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.extension.repository.InstalledExtensionRepository;
import org.xwiki.extension.xar.internal.handler.XarExtensionHandler;
import org.xwiki.extension.xar.internal.repository.XarInstalledExtensionRepository;
import org.xwiki.internal.extension.XARExtensionIndex;
import org.xwiki.model.reference.DocumentReference;

/**
 * Default implementation of {@link XARExtensionIndex}. Uses {@link XarInstalledExtensionRepository} to implement the
 * operations.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@Component
@Singleton
public class DefaultXARExtensionIndex implements XARExtensionIndex
{
    @Inject
    @Named(XarExtensionHandler.TYPE)
    private InstalledExtensionRepository installedXARs;

    @Override
    public boolean isExtensionDocument(DocumentReference documentReference)
    {
        return !((XarInstalledExtensionRepository) this.installedXARs).getXarInstalledExtensions(documentReference)
            .isEmpty();
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. VAR {@VAR VAR} VAR VAR VAR * VAR. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR VAR VAR VAR VAR VAR { @VAR @VAR(VAR.VAR) VAR VAR VAR; @VAR VAR VAR VAR(VAR VAR) { VAR !((VAR) VAR.VAR).VAR(VAR) .VAR(); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-index/xwiki-platform-index-default/pom.xml,"<?xml version=""1.0"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<project xmlns=""http://maven.apache.org/POM/4.0.0"" xmlns:xsi=""http://www.w3.org/2001/XMLSchema-instance"" xsi:schemaLocation=""http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <groupId>org.xwiki.platform</groupId>
    <artifactId>xwiki-platform-index</artifactId>
    <version>15.1-SNAPSHOT</version>
  </parent>
  <artifactId>xwiki-platform-index-default</artifactId>
  <name>XWiki Platform - Index - Default</name>
  <description>Default implementation of the API to queue asynchronous tasks dedicated to the analysis of wiki pages.</description>
  <packaging>jar</packaging>
  <properties>
    <xwiki.jacoco.instructionRatio>0.84</xwiki.jacoco.instructionRatio>
    <!-- Name to display by the Extension Manager -->
    <xwiki.extension.name>Default implementation of the Index API</xwiki.extension.name>
  </properties>
  <dependencies>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-index-api</artifactId>
      <version>${project.version}</version>
    </dependency>
    <dependency>
      <groupId>org.xwiki.commons</groupId>
      <artifactId>xwiki-commons-component-api</artifactId>
      <version>${commons.version}</version>
    </dependency>
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-oldcore</artifactId>
      <version>${project.version}</version>
    </dependency>
    <!-- Test dependencies. -->
    <dependency>
      <groupId>org.xwiki.commons</groupId>
      <artifactId>xwiki-commons-tool-test-component</artifactId>
      <version>${commons.version}</version>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>javax.servlet-api</artifactId>
      <scope>test</scope>
    </dependency>
  </dependencies>
  <build>
    <plugins>
      <plugin>
        <!-- Apply the Checkstyle configurations defined in the top level pom.xml file -->
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-checkstyle-plugin</artifactId>
        <executions>
          <execution>
            <!-- Specify the ""default"" execution id so that the ""blocker"" one is always executed -->
            <id>default</id>
            <configuration>
              <failsOnError>true</failsOnError>
              <suppressionsLocation>${basedir}/src/checkstyle/checkstyle-suppressions.xml</suppressionsLocation>
            </configuration>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project>",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.0"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""VAR: <VAR>4.0.0</VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR>15.1-VAR</VAR> </VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>VAR VAR - VAR - VAR</VAR> <VAR>VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.</VAR> <VAR>VAR</VAR> <VAR> <VAR.VAR.VAR>0.84</VAR.VAR.VAR> <!-- VAR VAR VAR VAR VAR VAR VAR --> <VAR.VAR.VAR>VAR VAR VAR VAR VAR VAR</VAR.VAR.VAR> </VAR> <VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> </VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> </VAR> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> </VAR> <!-- VAR VAR. --> <VAR> <VAR>VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR-VAR-VAR</VAR> <VAR>${VAR.VAR}</VAR> <VAR>VAR</VAR> </VAR> <VAR> <VAR>VAR.VAR</VAR> <VAR>VAR.VAR-VAR</VAR> <VAR>VAR</VAR> </VAR> </VAR> <VAR> <VAR> <VAR> <!-- VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR --> <VAR>VAR.VAR.VAR.VAR</VAR> <VAR>VAR-VAR-VAR</VAR> <VAR> <VAR> <!-- VAR VAR ""VAR"" VAR VAR VAR VAR VAR ""VAR"" VAR VAR VAR VAR --> <VAR>VAR</VAR> <VAR> <VAR>VAR</VAR> <VAR>${VAR}/VAR/VAR/VAR-VAR.VAR</VAR> </VAR> </VAR> </VAR> </VAR> </VAR> </VAR> </VAR> ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/test/java/org/xwiki/invitation/InvitationConfigPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.invitation;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of {@code Invitation.InvitationConfig}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    InfoMessageMacro.class,
    TestNoScriptMacro.class,
    // Start - Required in addition of RenderingScriptServiceComponentList
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    // End - Required in additional of RenderingScriptServiceComponentList
})
class InvitationConfigPageTest extends PageTest
{
    private static final DocumentReference INVITATION_CONFIG_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationConfig"");

    @Test
    void escapeInfoMessageInternalDocumentParameter() throws Exception
    {
        XWikiDocument invitationGuestActionsDocument = loadPage(INVITATION_CONFIG_DOCUMENT_REFERENCE);

        // Set up the current doc in the context so that $doc is bound in scripts
        this.context.setDoc(
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""]] {{noscript/}}"", ""Page""), this.context));

        Document document = Jsoup.parse(invitationGuestActionsDocument.getRenderedContent(this.context));
        Element infomessage = document.selectFirst("".infomessage"");
        assertEquals(""xe.invitation.internalDocument [Invitation.WebHome]"", infomessage.text());
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR,  }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR);  VAR.VAR.VAR( VAR.VAR.VAR(VAR VAR(""VAR"", ""]] {{VAR/}}"", ""VAR""), VAR.VAR)); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR)); VAR VAR = VAR.VAR("".VAR""); VAR(""VAR.VAR.VAR [VAR.VAR]"", VAR.VAR()); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/test/java/org/xwiki/invitation/InvitationGuestActionsPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.invitation;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of {@code Invitation.InvitationGuestActions}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    InfoMessageMacro.class,
    TestNoScriptMacro.class,
    // Start - Required in addition of RenderingScriptServiceComponentList
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    // End - Required in additional of RenderingScriptServiceComponentList
})
class InvitationGuestActionsPageTest extends PageTest
{
    private static final DocumentReference INVITATION_COMMON_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationCommon"");

    private static final DocumentReference INVITATION_GUEST_ACTIONS_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationGuestActions"");

    @BeforeEach
    void setUp() throws Exception
    {
        loadPage(INVITATION_COMMON_DOCUMENT_REFERENCE);
    }

    @Test
    void escapeInfoMessageInternalDocumentParameter() throws Exception
    {
        XWikiDocument invitationGuestActionsDocument = loadPage(INVITATION_GUEST_ACTIONS_DOCUMENT_REFERENCE);

        // Set up the current doc in the context so that $doc is bound in scripts
        this.context.setDoc(
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""]] {{noscript/}}"", ""Page""), this.context));

        Document document = Jsoup.parse(invitationGuestActionsDocument.getRenderedContent(this.context));
        Element infomessage = document.selectFirst("".infomessage"");
        assertEquals(""xe.invitation.internalDocument []] {{noscript/}}.WebHome]"", infomessage.text());
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR,  }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR);  VAR.VAR.VAR( VAR.VAR.VAR(VAR VAR(""VAR"", ""]] {{VAR/}}"", ""VAR""), VAR.VAR)); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR)); VAR VAR = VAR.VAR("".VAR""); VAR(""VAR.VAR.VAR []] {{VAR/}}.VAR]"", VAR.VAR()); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/test/java/org/xwiki/invitation/InvitationMailClassPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.invitation;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of {@code Invitation.InvitationMailClass}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    InfoMessageMacro.class,
    TestNoScriptMacro.class,
    // Start - Required in addition of RenderingScriptServiceComponentList
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    // End - Required in additional of RenderingScriptServiceComponentList
})
class InvitationMailClassPageTest extends PageTest
{
    private static final DocumentReference INVITATION_MAIL_CLASS_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationMailClass"");

    @Test
    void escapeInfoMessageInternalDocumentParameter() throws Exception
    {
        XWikiDocument invitationGuestActionsDocument = loadPage(INVITATION_MAIL_CLASS_DOCUMENT_REFERENCE);

        // Set up the current doc in the context so that $doc is bound in scripts
        this.context.setDoc(
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""]] {{noscript/}}"", ""Page""), this.context));

        Document document = Jsoup.parse(invitationGuestActionsDocument.getRenderedContent(this.context));
        Element infomessage = document.selectFirst("".infomessage"");
        assertEquals(""xe.invitation.internalDocument []] {{noscript/}}.WebHome]"", infomessage.text());
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR,  }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR);  VAR.VAR.VAR( VAR.VAR.VAR(VAR VAR(""VAR"", ""]] {{VAR/}}"", ""VAR""), VAR.VAR)); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR)); VAR VAR = VAR.VAR("".VAR""); VAR(""VAR.VAR.VAR []] {{VAR/}}.VAR]"", VAR.VAR()); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/test/java/org/xwiki/invitation/InvitationMemberActionsPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.invitation;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of {@code Invitation.InvitationMemberActions}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    InfoMessageMacro.class,
    TestNoScriptMacro.class,
    // Start - Required in addition of RenderingScriptServiceComponentList
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    // End - Required in additional of RenderingScriptServiceComponentList
})
class InvitationMemberActionsPageTest extends PageTest
{
    private static final DocumentReference INVITATION_COMMON_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationCommon"");

    private static final DocumentReference INVITATION_MEMBER_ACTIONS_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationMemberActions"");

    @BeforeEach
    void setUp() throws Exception
    {
        loadPage(INVITATION_COMMON_DOCUMENT_REFERENCE);
    }

    @Test
    void escapeInfoMessageInternalDocumentParameter() throws Exception
    {
        XWikiDocument invitationGuestActionsDocument = loadPage(INVITATION_MEMBER_ACTIONS_DOCUMENT_REFERENCE);

        // Set a non-guest user as otherwise the rendering stops early.
        this.context.setUserReference(new DocumentReference(""xwiki"", ""XWiki"", ""U1""));

        // Set up the current doc in the context so that $doc is bound in scripts
        this.context.setDoc(
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""]] {{noscript/}}"", ""Page""), this.context));

        Document document = Jsoup.parse(invitationGuestActionsDocument.getRenderedContent(this.context));
        Element infomessage = document.selectFirst("".infomessage"");
        assertEquals(""xe.invitation.internalDocument []] {{noscript/}}.WebHome]"", infomessage.text());
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR,  }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR);  VAR.VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""));  VAR.VAR.VAR( VAR.VAR.VAR(VAR VAR(""VAR"", ""]] {{VAR/}}"", ""VAR""), VAR.VAR)); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR)); VAR VAR = VAR.VAR("".VAR""); VAR(""VAR.VAR.VAR []] {{VAR/}}.VAR]"", VAR.VAR()); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-invitation/xwiki-platform-invitation-ui/src/test/java/org/xwiki/invitation/InvitationMembersCommonPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.invitation;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.InfoMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of {@code Invitation.InvitationMembersCommon}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    InfoMessageMacro.class,
    TestNoScriptMacro.class,
    // Start - Required in addition of RenderingScriptServiceComponentList
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    // End - Required in additional of RenderingScriptServiceComponentList
})
class InvitationMembersCommonPageTest extends PageTest
{
    private static final DocumentReference INVITATION_MEMBER_COMMON_DOCUMENT_REFERENCE =
        new DocumentReference(""xwiki"", ""Invitation"", ""InvitationMembersCommon"");

    @Test
    void escapeInfoMessageInternalDocumentParameter() throws Exception
    {
        XWikiDocument invitationGuestActionsDocument = loadPage(INVITATION_MEMBER_COMMON_DOCUMENT_REFERENCE);

        // Set a non-guest user as otherwise the rendering stops early.
        this.context.setUserReference(new DocumentReference(""xwiki"", ""XWiki"", ""U1""));

        // Set up the current doc in the context so that $doc is bound in scripts
        this.context.setDoc(
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""]] {{noscript/}}"", ""InvitationMembersCommon""),
                this.context));

        Document document = Jsoup.parse(invitationGuestActionsDocument.getRenderedContent(this.context));
        assertEquals(""xe.invitation.internalDocument []] {{noscript/}}.WebHome]"",
            document.selectFirst("".infomessage"").text());
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR,  }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR);  VAR.VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""));  VAR.VAR.VAR( VAR.VAR.VAR(VAR VAR(""VAR"", ""]] {{VAR/}}"", ""VAR""), VAR.VAR)); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR)); VAR(""VAR.VAR.VAR []] {{VAR/}}.VAR]"", VAR.VAR("".VAR"").VAR()); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/org/xwiki/internal/extension/XARExtensionIndex.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.internal.extension;

import org.xwiki.component.annotation.Role;
import org.xwiki.model.reference.DocumentReference;

/**
 * Provides operation to access to information relative to XARs provided by extensions.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@Role
public interface XARExtensionIndex
{
    /**
     * @param documentReference a document reference
     * @return {@code true} if a given document reference is provided by an extension
     */
    boolean isExtensionDocument(DocumentReference documentReference);
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR VAR VAR VAR { /** * @VAR VAR VAR VAR VAR * @VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(VAR VAR); } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/org/xwiki/internal/migration/AbstractDocumentsMigration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.internal.migration;

import java.util.List;
import java.util.Optional;

import javax.inject.Inject;

import org.slf4j.Logger;
import org.xwiki.index.TaskManager;
import org.xwiki.model.reference.DocumentReferenceResolver;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.store.migration.DataMigrationException;
import com.xpn.xwiki.store.migration.hibernate.AbstractHibernateDataMigration;

import static java.util.stream.Collectors.toList;

/**
 * Allow to easily queue a document analysis task on a set documents to migrate. Sub-classes need to implement two
 * methods:
 * <ul>
 *     <li>{@link #selectDocuments()}: return the list of document ids to queue for migration</li>
 *     <li>{@link #getTaskType()}: the type of the task to queue documents to</li>
 * </ul>
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
public abstract class AbstractDocumentsMigration extends AbstractHibernateDataMigration
{
    @Inject
    protected Logger logger;

    @Inject
    protected DocumentReferenceResolver<String> documentReferenceResolver;

    @Inject
    private TaskManager taskManager;

    @Override
    protected void hibernateMigrate() throws DataMigrationException
    {
        List<XWikiDocument> documents = selectDocuments()
            .stream()
            .map(this::convert)
            .filter(Optional::isPresent)
            .map(Optional::get)
            .collect(toList());
        logBeforeQueuingTasks(documents);
        for (XWikiDocument document : documents) {
            logBeforeQueuingTask(document);
            this.taskManager.addTask(this.getXWikiContext().getWikiId(), document.getId(), getTaskType());
        }
    }

    private Optional<XWikiDocument> convert(String documentReference)
    {
        XWikiContext context = getXWikiContext();
        try {
            return Optional.of(
                context.getWiki().getDocument(this.documentReferenceResolver.resolve(documentReference), context));
        } catch (XWikiException e) {
            this.logger.error(""Failed to resolve [{}]"", documentReference, e);
            return Optional.empty();
        }
    }

    /**
     * @return the id of the task type to queue documents to
     */
    protected abstract String getTaskType();

    /**
     * @return the list of document ids to migrate
     */
    protected abstract List<String> selectDocuments() throws DataMigrationException;

    /**
     * Prints an info log with the number of queued documents and the type of the task.
     *
     * @param documents the full list of documents that will be queued
     */
    protected void logBeforeQueuingTasks(List<XWikiDocument> documents)
    {
        this.logger.info(""[{}] documents queued to task [{}]"", documents.size(), getTaskType());
    }

    /**
     * Prints an info logs with an individual document and well as its queued task.
     *
     * @param document a individual document that will be queued
     */
    protected void logBeforeQueuingTask(XWikiDocument document)
    {
        this.logger.info(""document [{}] queued to task [{}]"", document, getTaskType());
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR-VAR VAR VAR VAR VAR * VAR: * <VAR> * <VAR>{@VAR  * <VAR>{@VAR  * </VAR> * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ VAR VAR VAR VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR() VAR VAR { VAR<VAR> VAR = VAR() .VAR() .VAR(VAR::VAR) .VAR(VAR::VAR) .VAR(VAR::VAR) .VAR(VAR()); VAR(VAR); VAR (VAR VAR : VAR) { VAR(VAR); VAR.VAR.VAR(VAR.VAR().VAR(), VAR.VAR(), VAR()); } } VAR VAR<VAR> VAR(VAR VAR) { VAR VAR = VAR(); VAR { VAR VAR.VAR( VAR.VAR().VAR(VAR.VAR.VAR(VAR), VAR)); } VAR (VAR VAR) { VAR.VAR.VAR(""VAR VAR VAR [{}]"", VAR, VAR); VAR VAR.VAR(); } } /** * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR VAR(); /** * @VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR<VAR> VAR() VAR VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR(VAR<VAR> VAR) { VAR.VAR.VAR(""[{}] VAR VAR VAR VAR [{}]"", VAR.VAR(), VAR()); } /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR(VAR VAR) { VAR.VAR.VAR(""VAR [{}] VAR VAR VAR [{}]"", VAR, VAR()); } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/org/xwiki/internal/migration/InvitationInternalDocumentParameterEscapingFixer.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.internal.migration;

import java.util.Objects;
import java.util.Optional;
import java.util.regex.Pattern;

import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.rendering.syntax.Syntax;

import static java.util.regex.Matcher.quoteReplacement;

/**
 * Fix a content by looking for localization of {@code xe.invitation.internalDocument} and escaping its parameter. The
 * translation fixed by this method is initially introduced by the invitation application but the fix is localed in
 * oldcore so that the fix is applied on pages even if the invitation application has been uninstalled.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@Component(roles = InvitationInternalDocumentParameterEscapingFixer.class)
@Singleton
public class InvitationInternalDocumentParameterEscapingFixer
{
    private static final Pattern PATTERN = Pattern.compile(""(\\{\\{info}}""
        + ""\\$services\\.localization\\.render\\('xe\\.invitation\\.internalDocument', \\[)(\""[^\""]+\"")(]\\)\\""
        + ""{\\{/info}})"");

    /**
     * @param content the context to fix
     * @param syntax the syntax of the context to fix (xwiki/2.0 or xwiki/2.1)
     * @return the context with the fix applied, or {@link Optional#empty()} if nothing needs to be fixed
     */
    public Optional<String> fix(String content, Syntax syntax)
    {
        String escapedContent = PATTERN.matcher(content).replaceAll(matchResult -> {
            if (matchResult.group(2).contains(""services.rendering.escape"")) {
                return matchResult.group();
            } else {
                // Concatenate the various groups of the regex while wrapping the localization argument with a
                // call to the escaping script service.
                String format = String.format(""%s$services.rendering.escape(%s, '%s')%s"", matchResult.group(1),
                    matchResult.group(2), syntax.toIdString(), matchResult.group(3));
                return quoteReplacement(format);
            }
        });

        if (Objects.equals(escapedContent, content)) {
            return Optional.empty();
        } else {
            return Optional.of(escapedContent);
        }
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR {@VAR VAR.VAR.VAR} VAR VAR VAR VAR. VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR.VAR(""(\\{\\{VAR}}"" + ""\\$VAR\\.VAR\\.VAR\\('VAR\\.VAR\\.VAR', \\[)(\""[^\""]+\"")(]\\)\\"" + ""{\\{/VAR}})""); /** * @VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR VAR VAR (VAR/2.0 VAR VAR/2.1) * @VAR VAR VAR VAR VAR VAR VAR, VAR {@VAR VAR */ VAR VAR<VAR> VAR(VAR VAR, VAR VAR) { VAR VAR = VAR.VAR(VAR).VAR(VAR -> { VAR (VAR.VAR(2).VAR(""VAR.VAR.VAR"")) { VAR VAR.VAR(); } VAR {   VAR VAR = VAR.VAR(""%VAR$VAR.VAR.VAR(%VAR, '%VAR')%VAR"", VAR.VAR(1), VAR.VAR(2), VAR.VAR(), VAR.VAR(3)); VAR VAR(VAR); } }); VAR (VAR.VAR(VAR, VAR)) { VAR VAR.VAR(); } VAR { VAR VAR.VAR(VAR); } } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/org/xwiki/internal/migration/InvitationInternalDocumentParameterEscapingTaskConsumer.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.internal.migration;

import java.util.List;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Provider;
import javax.inject.Singleton;

import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.index.IndexException;
import org.xwiki.index.TaskConsumer;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.syntax.Syntax;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;

/**
 * Apply {@link InvitationInternalDocumentParameterEscapingFixer} on the documents queued by
 * {@link R150000000XWIKI20285DataMigration} if applicable, and log the skipped ones. This translation key is initially
 * introduced by the invitation application but the fix is localed in oldcore so that the fix is applied on pages even
 * if the invitation application has been uninstalled.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@Component
@Singleton
@Named(InvitationInternalDocumentParameterEscapingTaskConsumer.HINT)
public class InvitationInternalDocumentParameterEscapingTaskConsumer implements TaskConsumer
{
    /**
     * This task consumer hint.
     */
    public static final String HINT = ""internal-document-parameter-escaping"";

    @Inject
    private Logger logger;

    @Inject
    private Provider<XWikiContext> contextProvider;

    @Inject
    private InvitationInternalDocumentParameterEscapingFixer invitationInternalDocumentParameterEscapingFixer;

    @Override
    public void consume(DocumentReference documentReference, String version) throws IndexException
    {
        try {
            XWikiContext context = this.contextProvider.get();
            task(context.getWiki().getDocument(documentReference, context));
        } catch (XWikiException e) {
            throw new IndexException(String.format(""Failed to resolve document [%s]"", documentReference), e);
        }
    }

    private void task(XWikiDocument document)
    {
        Syntax syntax = document.getSyntax();
        if (List.of(Syntax.XWIKI_2_1, Syntax.XWIKI_2_0).contains(syntax)) {
            try {
                this.invitationInternalDocumentParameterEscapingFixer.fix(document.getContent(), document.getSyntax())
                    .ifPresent(content -> {
                        document.setContent(content);
                        try {
                            XWikiContext context = this.contextProvider.get();
                            context.getWiki().saveDocument(document, ""Automatic bad escaping fix."", true, context);
                            this.logger.info(""[{}] successfully fixed."", document);
                        } catch (XWikiException e) {
                            this.logger.error(""Failed to save document [{}]"", document, e);
                        }
                    });
            } catch (Exception e) {
                this.logger.error(""Unexpected error while fixing [{}]"", document, e);
            }
        } else {
            this.logger.warn(
                ""[{}] skipped because escaping for syntax [{}] is not supported. It is advised to review this file."",
                document, syntax);
        }
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR {@VAR VAR} VAR VAR VAR VAR VAR * {@VAR VAR} VAR VAR, VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR @VAR(VAR.VAR) VAR VAR VAR VAR VAR { /** * VAR VAR VAR VAR. */ VAR VAR VAR VAR VAR = ""VAR-VAR-VAR-VAR""; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR { VAR VAR = VAR.VAR.VAR(); VAR(VAR.VAR().VAR(VAR, VAR)); } VAR (VAR VAR) { VAR VAR VAR(VAR.VAR(""VAR VAR VAR VAR [%VAR]"", VAR), VAR); } } VAR VAR VAR(VAR VAR) { VAR VAR = VAR.VAR(); VAR (VAR.VAR(VAR.VAR, VAR.VAR).VAR(VAR)) { VAR { VAR.VAR.VAR(VAR.VAR(), VAR.VAR()) .VAR(VAR -> { VAR.VAR(VAR); VAR { VAR VAR = VAR.VAR.VAR(); VAR.VAR().VAR(VAR, ""VAR VAR VAR VAR."", VAR, VAR); VAR.VAR.VAR(""[{}] VAR VAR."", VAR); } VAR (VAR VAR) { VAR.VAR.VAR(""VAR VAR VAR VAR [{}]"", VAR, VAR); } }); } VAR (VAR VAR) { VAR.VAR.VAR(""VAR VAR VAR VAR [{}]"", VAR, VAR); } } VAR { VAR.VAR.VAR( ""[{}] VAR VAR VAR VAR VAR [{}] VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR."", VAR, VAR); } } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/org/xwiki/internal/migration/R150000000XWIKI20285DataMigration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.internal.migration;

import java.util.List;
import java.util.stream.Collectors;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.internal.extension.XARExtensionIndex;
import org.xwiki.query.QueryException;

import com.xpn.xwiki.XWiki;
import com.xpn.xwiki.store.migration.DataMigrationException;
import com.xpn.xwiki.store.migration.XWikiDBVersion;

import static org.xwiki.query.Query.XWQL;

/**
 * Search for documents with a known invalid content produced by code generation (i.e., that cannot be fixed by editing
 * a xar file), and apply an automatic escaping fix.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.4.8
 * @since 14.10.4
 */
@Component
@Named(""R150000000XWIKI20285"")
@Singleton
public class R150000000XWIKI20285DataMigration extends AbstractDocumentsMigration
{
    @Inject
    private XARExtensionIndex installedXARs;

    @Override
    public String getDescription()
    {
        return ""Patch the InvitationConfig documents with improper escaping."";
    }

    @Override
    public XWikiDBVersion getVersion()
    {
        return new XWikiDBVersion(150000000);
    }

    @Override
    protected String getTaskType()
    {
        return InvitationInternalDocumentParameterEscapingTaskConsumer.HINT;
    }

    @Override
    protected List<String> selectDocuments() throws DataMigrationException
    {
        XWiki wiki = getXWikiContext().getWiki();
        try {
            // We select potentially impacted documents using like wildcards. This selection might lead to false
            // positive that wild be filtered out by the more accurate regex in
            // InvitationInternalDocumentParameterEscapingFixer.
            return wiki.getStore().getQueryManager()
                .createQuery(""where doc.content ""
                    + ""like '%{{info}}%services.localization.render%xe.invitation.internalDocument%{{/info}}%'"", XWQL)
                .<String>execute()
                .stream()
                // Exclude document that are provided by extensions, because they are fixed using the usual xar upgrade
                // mechanism.
                .filter(documentReference -> !this.installedXARs.isExtensionDocument(
                    this.documentReferenceResolver.resolve(documentReference)))
                .collect(Collectors.toList());
        } catch (QueryException e) {
            throw new DataMigrationException(
                String.format(""Failed retrieve the list of all the documents for wiki [%s]."", wiki.getName()), e);
        }
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR (VAR.VAR., VAR VAR VAR VAR VAR VAR * VAR VAR VAR), VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.4.8 * @VAR 14.10.4 */ @VAR @VAR(""VAR"") @VAR VAR VAR VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR VAR() { VAR ""VAR VAR VAR VAR VAR VAR VAR.""; } @VAR VAR VAR VAR() { VAR VAR VAR(150000000); } @VAR VAR VAR VAR() { VAR VAR.VAR; } @VAR VAR VAR<VAR> VAR() VAR VAR { VAR VAR = VAR().VAR(); VAR {    VAR VAR.VAR().VAR() .VAR(""VAR VAR.VAR "" + ""VAR '%{{VAR}}%VAR.VAR.VAR%VAR.VAR.VAR%{{/VAR}}%'"", VAR) .<VAR>VAR() .VAR()   .VAR(VAR -> !VAR.VAR.VAR( VAR.VAR.VAR(VAR))) .VAR(VAR.VAR()); } VAR (VAR VAR) { VAR VAR VAR( VAR.VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR [%VAR]."", VAR.VAR()), VAR); } } } ",5,8
xwiki-platform_b65220a4d86b8888791c3b643074ebca5c089a3a,xwiki-platform-core/xwiki-platform-oldcore/src/test/java/org/xwiki/internal/migration/InvitationInternalDocumentParameterEscapingFixerTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.internal.migration;

import java.util.Optional;
import java.util.stream.Stream;

import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.MethodSource;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of {@link InvitationInternalDocumentParameterEscapingFixer}.
 *
 * @version $Id$
 */
@ComponentTest
class InvitationInternalDocumentParameterEscapingFixerTest
{
    @InjectMockComponents
    private InvitationInternalDocumentParameterEscapingFixer fixer;

    public static Stream<Arguments> fixSource()
    {
        return Stream.of(
            Arguments.of(
                ""nothing to change 1\n""
                    + ""{{info}}$services.localization.render('xe.invitation.internalDocument', [$noChange]){{/info}}""
                    + ""nothing to change 2\n""
                    + ""{{info}}$services.localization.render('xe.invitation.internalDocument', [\""$change\""]){{/info}}""
                    + ""nothing to change 3"",
                Optional.of(
                    ""nothing to change 1\n""
                        + ""{{info}}$services.localization.render('xe.invitation.internalDocument', [$noChange]){{/info}}nothing to change 2\n""
                        + ""{{info}}$services.localization.render('xe.invitation.internalDocument', [$services.rendering.escape(\""$change\"", 'xwiki/2.1')]){{/info}}nothing to change 3""
                )
            ),
            Arguments.of(
                ""nothing to change 1\n""
                    + ""{{info}}$services.localization.render('xe.invitation.internalDocument', [$noChange]){{/info}}""
                    + ""nothing to change 2\n""
                    + ""nothing to change 3"",
                Optional.empty()
            )
        );
    }

    @ParameterizedTest
    @MethodSource(""fixSource"")
    void fix(String value, Optional<String> expected)
    {
        assertEquals(expected, this.fixer.fix(value, Syntax.XWIKI_2_1));
    }
}",,b65220a4d86b8888791c3b643074ebca5c089a3a,CVE-2023-35150,b65220a4d86b8888791c3b643074ebca5c089a3a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR VAR VAR { @VAR VAR VAR VAR; VAR VAR VAR<VAR> VAR() { VAR VAR.VAR( VAR.VAR( ""VAR VAR VAR 1\VAR"" + ""{{VAR}}$VAR.VAR.VAR('VAR.VAR.VAR', [$VAR]){{/VAR}}"" + ""VAR VAR VAR 2\VAR"" + ""{{VAR}}$VAR.VAR.VAR('VAR.VAR.VAR', [\""$VAR\""]){{/VAR}}"" + ""VAR VAR VAR 3"", VAR.VAR( ""VAR VAR VAR 1\VAR"" + ""{{VAR}}$VAR.VAR.VAR('VAR.VAR.VAR', [$VAR]){{/VAR}}VAR VAR VAR 2\VAR"" + ""{{VAR}}$VAR.VAR.VAR('VAR.VAR.VAR', [$VAR.VAR.VAR(\""$VAR\"", 'VAR/2.1')]){{/VAR}}VAR VAR VAR 3"" ) ), VAR.VAR( ""VAR VAR VAR 1\VAR"" + ""{{VAR}}$VAR.VAR.VAR('VAR.VAR.VAR', [$VAR]){{/VAR}}"" + ""VAR VAR VAR 2\VAR"" + ""VAR VAR VAR 3"", VAR.VAR() ) ); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR<VAR> VAR) { VAR(VAR, VAR.VAR.VAR(VAR, VAR.VAR)); } } ",5,8
xwiki-platform_ba4c76265b0b8a5e2218be400d18f08393fe1428,xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-theme/xwiki-platform-flamingo-theme-ui/src/test/java/org/xwiki/flamingo/TestNoScriptMacro.java,,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.flamingo;

import java.util.List;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.rendering.block.Block;
import org.xwiki.rendering.macro.AbstractMacro;
import org.xwiki.rendering.transformation.MacroTransformationContext;

import static java.util.Collections.emptyList;

/**
 * This script prints an error log when it is interpreted, making the test fail.
 *
 * @version $Id$
 * @since 13.10.10
 * @since 14.4.6
 * @since 14.9RC1
 */
@Component
@Named(""noscript"")
@Singleton
public class TestNoScriptMacro extends AbstractMacro<Object>
{
    @Inject
    private Logger logger;

    /**
     * Default constructor.
     */
    public TestNoScriptMacro()
    {
        super(""NoScript"", ""No Script!"");
    }

    @Override
    public boolean supportsInlineMode()
    {
        return true;
    }

    @Override
    public List<Block> execute(Object parameters, String content, MacroTransformationContext context)
    {
        this.logger.error(""SHOULD NOT BE CALLED"");
        return emptyList();
    }
}",ba4c76265b0b8a5e2218be400d18f08393fe1428,CVE-2023-29211,ba4c76265b0b8a5e2218be400d18f08393fe1428,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED," /* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 13.10.10 * @VAR 14.4.6 * @VAR 14.9RC1 */ @VAR @VAR(""VAR"") @VAR VAR VAR VAR VAR VAR<VAR> { @VAR VAR VAR VAR; /** * VAR VAR. */ VAR VAR() { VAR(""VAR"", ""VAR VAR!""); } @VAR VAR VAR VAR() { VAR VAR; } @VAR VAR VAR<VAR> VAR(VAR VAR, VAR VAR, VAR VAR) { VAR.VAR.VAR(""VAR VAR VAR VAR""); VAR VAR(); } }",5,8
xwiki-platform_ba4c76265b0b8a5e2218be400d18f08393fe1428,xwiki-platform-core/xwiki-platform-wiki/xwiki-platform-wiki-ui/xwiki-platform-wiki-ui-mainwiki/src/test/java/org/xwiki/wiki/DeleteWikiPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.wiki;

import org.jsoup.nodes.Document;
import org.junit.jupiter.api.Test;
import org.xwiki.localization.macro.internal.TranslationMacro;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Test of the {@code WikiManager.DeleteWiki} page.
 *
 * @version $Id$
 * @since 13.10.11
 * @since 14.4.7
 * @since 14.10RC1
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    ErrorMessageMacro.class,
    TranslationMacro.class,
    TestNoScriptMacro.class,
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class
})
class DeleteWikiPageTest extends PageTest
{
    @Test
    void unknownWikiId() throws Exception
    {
        this.request.put(""wikiId"", ""\"" /}}{{noscript/}}"");
        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""WikiManager"", ""DeleteWiki""));
        assertEquals(""platform.wiki.error.wikidoesnotexist [\"" /}}{{noscript/}}]"",
            document.select("".box.errormessage"").text());
    }
}",,ba4c76265b0b8a5e2218be400d18f08393fe1428,CVE-2023-29211,ba4c76265b0b8a5e2218be400d18f08393fe1428,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR} VAR. * * @VAR $VAR$ * @VAR 13.10.11 * @VAR 14.4.7 * @VAR 14.10RC1 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""\"" /}}{{VAR/}}""); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(""VAR.VAR.VAR.VAR [\"" /}}{{VAR/}}]"", VAR.VAR("".VAR.VAR"").VAR()); } } ",5,8
xwiki-platform_bd82be936c21b65dee367d558e3050b9b6995713,xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/test/java/org/xwiki/administration/ConfigurableClassPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.administration;

import java.util.List;
import java.util.Map;

import org.jsoup.nodes.Document;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.xwiki.localization.macro.internal.TranslationMacro;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.query.internal.ScriptQuery;
import org.xwiki.query.script.QueryManagerScriptService;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultRenderingConfigurationComponentList;
import org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;
import org.xwiki.script.service.ScriptService;
import org.xwiki.template.script.TemplateScriptService;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyInt;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.Mockito.when;

/**
 * Page test of {@code XWiki.ConfigurableClass}.
 *
 * @version $Id$
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@DefaultRenderingConfigurationComponentList
@ComponentList({
    TestNoScriptMacro.class,
    TranslationMacro.class,
    ErrorMessageMacro.class,
    TemplateScriptService.class
})
class ConfigurableClassPageTest extends PageTest
{
    private static final String WIKI_NAME = ""xwiki"";

    private static final String SPACE_NAME = ""XWiki"";

    private static final DocumentReference CONFIGURABLE_CLASS =
        new DocumentReference(WIKI_NAME, SPACE_NAME, ""ConfigurableClass"");

    private static final DocumentReference CONFIGURABLE_CLASS_MACROS =
        new DocumentReference(WIKI_NAME, SPACE_NAME, ""ConfigurableClassMacros"");

    private static final DocumentReference MY_SECTION =
        new DocumentReference(WIKI_NAME, SPACE_NAME, ""]]{{noscript /}}"");

    private static final String MY_SECTION_SERIALIZED = ""XWiki.]]{{noscript /}}"";

    @Mock
    private QueryManagerScriptService queryService;

    @Mock
    private ScriptQuery query;

    @BeforeEach
    void setUp() throws Exception
    {
        // Load the macros page so it can be included.
        loadPage(CONFIGURABLE_CLASS_MACROS);

        // Mock the query.
        this.oldcore.getMocker().registerComponent(ScriptService.class, ""query"", this.queryService);
        when(this.queryService.hql(anyString())).thenReturn(this.query);
        when(this.query.addFilter(anyString())).thenReturn(this.query);
        when(this.query.setLimit(anyInt())).thenReturn(this.query);
        when(this.query.setOffset(anyInt())).thenReturn(this.query);
        when(this.query.bindValues(any(Map.class))).thenReturn(this.query);
        when(this.query.bindValues(any(List.class))).thenReturn(this.query);
    }

    @Test
    void escapeHeadingForError() throws Exception
    {
        this.request.put(""section"", ""other"");
        when(this.query.execute()).thenReturn(List.of(MY_SECTION_SERIALIZED)).thenReturn(List.of());

        XWikiDocument mySectionDoc = new XWikiDocument(MY_SECTION);
        this.xwiki.saveDocument(mySectionDoc, this.context);

        Document htmlPage = renderHTMLPage(CONFIGURABLE_CLASS);
        assertEquals(String.format(""admin.customize %s:"", MY_SECTION_SERIALIZED),
            htmlPage.selectFirst(""h1"").text());
    }
}",,bd82be936c21b65dee367d558e3050b9b6995713,CVE-2023-50723,bd82be936c21b65dee367d558e3050b9b6995713,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ */ @VAR @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR VAR VAR = VAR VAR(VAR, VAR, ""VAR""); VAR VAR VAR VAR VAR = VAR VAR(VAR, VAR, ""VAR""); VAR VAR VAR VAR VAR = VAR VAR(VAR, VAR, ""]]{{VAR /}}""); VAR VAR VAR VAR VAR = ""VAR.]]{{VAR /}}""; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR() VAR VAR {  VAR(VAR);  VAR.VAR.VAR().VAR(VAR.VAR, ""VAR"", VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR(VAR.VAR))).VAR(VAR.VAR); VAR(VAR.VAR.VAR(VAR(VAR.VAR))).VAR(VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""VAR""); VAR(VAR.VAR.VAR()).VAR(VAR.VAR(VAR)).VAR(VAR.VAR()); VAR VAR = VAR VAR(VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR VAR = VAR(VAR); VAR(VAR.VAR(""VAR.VAR %VAR:"", VAR), VAR.VAR(""VAR"").VAR()); } } ",5,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/XMLDiffDataURIConverterConfiguration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.diff.xml;

import org.xwiki.component.annotation.Role;
import org.xwiki.stability.Unstable;

/**
 * Configuration for the data URI converter in the XML diff module.
 *
 * @since 14.10.15
 * @since 15.5.1
 * @since 15.6
 * @version $Id$
 */
@Unstable
@Role
public interface XMLDiffDataURIConverterConfiguration
{
    /**
     * @return the timeout to use when fetching data from the web to embed as data URI
     */
    int getHTTPTimeout();

    /**
     * @return the maximum size of the data to embed as data URI
     */
    long getMaximumContentSize();

    /**
     * @return true if the data URI converter is enabled
     */
    boolean isEnabled();
}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR 14.10.15 * @VAR 15.5.1 * @VAR 15.6 * @VAR $VAR$ */ @VAR @VAR VAR VAR VAR { /** * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(); /** * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(); /** * @VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(); } ",12,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/DefaultXMLDiffDataURIConverterConfiguration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.diff.xml.internal;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.configuration.ConfigurationSource;
import org.xwiki.diff.xml.XMLDiffDataURIConverterConfiguration;

/**
 * Configuration for the XML diff.
 *
 * @version $Id$
 * @since 14.10.15
 * @since 15.5.1
 * @since 15.6
 */
@Component
@Singleton
public class DefaultXMLDiffDataURIConverterConfiguration implements XMLDiffDataURIConverterConfiguration
{
    private static final String PREFIX = ""diff.xml.dataURI"";

    @Inject
    @Named(""xwikiproperties"")
    private ConfigurationSource configurationSource;

    @Override
    public int getHTTPTimeout()
    {
        return this.configurationSource.getProperty(getFullKeyName(""httpTimeout""), Integer.class, 10);
    }

    @Override
    public long getMaximumContentSize()
    {
        return this.configurationSource.getProperty(getFullKeyName(""maximumContentSize""), Long.class, 1024L * 1024L);
    }

    @Override
    public boolean isEnabled()
    {
        return this.configurationSource.getProperty(getFullKeyName(""enabled""), Boolean.class, true);
    }

    private String getFullKeyName(String shortKeyName)
    {
        return String.format(""%s.%s"", PREFIX, shortKeyName);
    }

}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10.15 * @VAR 15.5.1 * @VAR 15.6 */ @VAR @VAR VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR.VAR""; @VAR @VAR(""VAR"") VAR VAR VAR; @VAR VAR VAR VAR() { VAR VAR.VAR.VAR(VAR(""VAR""), VAR.VAR, 10); } @VAR VAR VAR VAR() { VAR VAR.VAR.VAR(VAR(""VAR""), VAR.VAR, 1024L * 1024L); } @VAR VAR VAR VAR() { VAR VAR.VAR.VAR(VAR(""VAR""), VAR.VAR, VAR); } VAR VAR VAR(VAR VAR) { VAR VAR.VAR(""%VAR.%VAR"", VAR, VAR); } } ",12,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/HttpClientBuilderFactory.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.diff.xml.internal;

import javax.inject.Inject;
import javax.inject.Singleton;

import org.apache.hc.client5.http.config.ConnectionConfig;
import org.apache.hc.client5.http.config.RequestConfig;
import org.apache.hc.client5.http.impl.classic.HttpClientBuilder;
import org.apache.hc.client5.http.impl.io.BasicHttpClientConnectionManager;
import org.apache.hc.core5.util.Timeout;
import org.xwiki.component.annotation.Component;
import org.xwiki.diff.xml.XMLDiffDataURIConverterConfiguration;

/**
 * Simple factory for HttpClientBuilder to help testing and set basic properties including user agent and timeouts.
 *
 * @since 14.10.15
 * @since 15.5.1
 * @since 15.6
 * @version $Id$
 */
@Component(roles = HttpClientBuilderFactory.class)
@Singleton
public class HttpClientBuilderFactory
{
    @Inject
    private XMLDiffDataURIConverterConfiguration configuration;

    /**
     * @return a new HTTPClientBuilder
     */
    public HttpClientBuilder create()
    {
        HttpClientBuilder result = HttpClientBuilder.create();
        result.useSystemProperties();
        result.setUserAgent(""XWikiHTMLDiff"");

        // Set the connection timeout.
        Timeout timeout = Timeout.ofSeconds(this.configuration.getHTTPTimeout());
        ConnectionConfig connectionConfig = ConnectionConfig.custom()
            .setConnectTimeout(timeout)
            .setSocketTimeout(timeout)
            .build();

        BasicHttpClientConnectionManager cm = new BasicHttpClientConnectionManager();
        cm.setConnectionConfig(connectionConfig);
        result.setConnectionManager(cm);

        // Set the response timeout.
        result.setDefaultRequestConfig(RequestConfig.custom().setResponseTimeout(timeout).build());

        return result;
    }
}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR 14.10.15 * @VAR 15.5.1 * @VAR 15.6 * @VAR $VAR$ */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { @VAR VAR VAR VAR; /** * @VAR VAR VAR VAR */ VAR VAR VAR() { VAR VAR = VAR.VAR(); VAR.VAR(); VAR.VAR(""VAR"");  VAR VAR = VAR.VAR(VAR.VAR.VAR()); VAR VAR = VAR.VAR() .VAR(VAR) .VAR(VAR) .VAR(); VAR VAR = VAR VAR(); VAR.VAR(VAR); VAR.VAR(VAR);  VAR.VAR(VAR.VAR().VAR(VAR).VAR()); VAR VAR; } } ",12,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/main/java/org/xwiki/diff/xml/internal/ImageDownloader.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.diff.xml.internal;

import java.io.IOException;
import java.net.URI;
import java.util.Optional;

import javax.inject.Inject;
import javax.inject.Provider;
import javax.inject.Singleton;
import javax.servlet.http.HttpServletRequest;

import org.apache.commons.io.IOUtils;
import org.apache.commons.io.input.BoundedInputStream;
import org.apache.commons.lang3.StringUtils;
import org.apache.hc.client5.http.classic.methods.HttpGet;
import org.apache.hc.client5.http.impl.classic.CloseableHttpClient;
import org.apache.hc.client5.http.impl.classic.HttpClientBuilder;
import org.apache.hc.core5.http.ClassicHttpResponse;
import org.apache.hc.core5.http.HttpEntity;
import org.apache.hc.core5.http.HttpStatus;
import org.xwiki.component.annotation.Component;
import org.xwiki.diff.xml.XMLDiffDataURIConverterConfiguration;
import org.xwiki.security.authentication.AuthenticationConfiguration;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.web.XWikiRequest;

/**
 * Component for downloading images from a URL with the given cookies.
 *
 * @since 14.10.15
 * @since 15.5.1
 * @since 15.6
 * @version $Id$
 */
@Component(roles = ImageDownloader.class)
@Singleton
public class ImageDownloader
{
    private static final String COOKIE_DOMAIN_PREFIX = ""."";

    private static final String HEADER_COOKIE = ""Cookie"";

    @Inject
    private HttpClientBuilderFactory httpClientBuilderFactory;

    @Inject
    private Provider<XWikiContext> xcontextProvider;

    @Inject
    private XMLDiffDataURIConverterConfiguration configuration;

    @Inject
    private AuthenticationConfiguration authenticationConfiguration;

    /**
     * The result of a download request.
     */
    public static class DownloadResult
    {
        private final byte[] data;

        private final String contentType;

        /**
         * @param data the downloaded data
         * @param contentType the MIME type of the downloaded data
         */
        public DownloadResult(byte[] data, String contentType)
        {
            this.data = data;
            this.contentType = contentType;
        }

        /**
         * @return the downloaded data
         */
        public byte[] getData()
        {
            return this.data;
        }

        /**
         * @return the MIME type of the downloaded data
         */
        public String getContentType()
        {
            return this.contentType;
        }
    }

    /**
     * Download the image from the given URL with the cookies from the current request.
     *
     * @param uri the URL of the image
     * @return the image as a byte array
     * @throws IOException if there was an error downloading the image
     */
    public DownloadResult download(URI uri) throws IOException
    {
        HttpClientBuilder httpClientBuilder = this.httpClientBuilderFactory.create();

        HttpGet getMethod = initializeGetMethod(uri);

        try (CloseableHttpClient httpClient = httpClientBuilder.build()) {
            return httpClient.execute(getMethod, response -> handleResponse(uri, response));
        }
    }

    private DownloadResult handleResponse(URI uri, ClassicHttpResponse response) throws IOException
    {
        if (response.getCode() == HttpStatus.SC_OK) {
            HttpEntity entity = response.getEntity();
            // Remove the content type parameters, such as the charset, so they don't influence the diff.
            String contentType = entity.getContentType();
            contentType = StringUtils.substringBefore(contentType, "";"");

            if (!StringUtils.startsWith(contentType, ""image/"")) {
                throw new IOException(String.format(""The content of [%s] is not an image."", uri));
            }

            long maximumSize = this.configuration.getMaximumContentSize();
            if (maximumSize > 0 && entity.getContentLength() > maximumSize) {
                throw new IOException(String.format(""The content length of [%s] is too big."", uri));
            }

            byte[] content;
            if (maximumSize > 0) {
                // The content length is not always available (then it is negative), so we need to use a bounded
                // input stream to make sure we don't read more than the maximum size.
                try (BoundedInputStream boundedInputStream = new BoundedInputStream(entity.getContent(),
                    maximumSize))
                {
                    content = IOUtils.toByteArray(boundedInputStream);
                }

                if (content.length == maximumSize) {
                    throw new IOException(String.format(""The content of [%s] is too big."", uri));
                }
            } else {
                content = IOUtils.toByteArray(entity.getContent());
            }

            return new DownloadResult(content, contentType);
        } else {
            throw new IOException(response.getCode() + "" "" + response.getReasonPhrase());
        }
    }

    private HttpGet initializeGetMethod(URI uri)
    {
        HttpGet getMethod = new HttpGet(uri);

        XWikiRequest request = this.xcontextProvider.get().getRequest();
        if (request != null && matchesCookieDomain(uri.getHost(), request)) {
            // Copy the cookie header from the current request.
            getMethod.setHeader(HEADER_COOKIE, request.getHeader(HEADER_COOKIE));
        }

        return getMethod;
    }

    /**
     * @return if the host matches the cookie domain of the current request
     */
    private boolean matchesCookieDomain(String host, HttpServletRequest request)
    {
        String serverName = request.getServerName();
        // Add a leading dot to avoid matching domains that are longer versions of the cookie domain and to ensure
        // that the cookie domain itself is matched as the cookie domain also contains the leading dot. Always add
        // the dot as two dots will still match.
        String prefixedServerName = COOKIE_DOMAIN_PREFIX + serverName;

        Optional<String> cookieDomain =
            this.authenticationConfiguration.getCookieDomains().stream()
                .filter(prefixedServerName::endsWith)
                .findFirst();

        // If there is a cookie domain, check if the host also matches it.
        return cookieDomain.map((COOKIE_DOMAIN_PREFIX + host)::endsWith)
            // If no cookie domain is configured, check for an exact match with the server name as no domain is sent in
            // this case and thus the cookie isn't valid for subdomains.
            .orElseGet(() -> host.equals(serverName));
    }

}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR 14.10.15 * @VAR 15.5.1 * @VAR 15.6 * @VAR $VAR$ */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { VAR VAR VAR VAR VAR = "".""; VAR VAR VAR VAR VAR = ""VAR""; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; /** * VAR VAR VAR VAR VAR VAR. */ VAR VAR VAR VAR { VAR VAR VAR[] VAR; VAR VAR VAR VAR; /** * @VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(VAR[] VAR, VAR VAR) { VAR.VAR = VAR; VAR.VAR = VAR; } /** * @VAR VAR VAR VAR */ VAR VAR[] VAR() { VAR VAR.VAR; } /** * @VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR() { VAR VAR.VAR; } } /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR(VAR VAR) VAR VAR { VAR VAR = VAR.VAR.VAR(); VAR VAR = VAR(VAR); VAR (VAR VAR = VAR.VAR()) { VAR VAR.VAR(VAR, VAR -> VAR(VAR, VAR)); } } VAR VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR (VAR.VAR() == VAR.VAR) { VAR VAR = VAR.VAR();  VAR VAR = VAR.VAR(); VAR = VAR.VAR(VAR, "";""); VAR (!VAR.VAR(VAR, ""VAR/"")) { VAR VAR VAR(VAR.VAR(""VAR VAR VAR [%VAR] VAR VAR VAR VAR."", VAR)); } VAR VAR = VAR.VAR.VAR(); VAR (VAR > 0 && VAR.VAR() > VAR) { VAR VAR VAR(VAR.VAR(""VAR VAR VAR VAR [%VAR] VAR VAR VAR."", VAR)); } VAR[] VAR; VAR (VAR > 0) {   VAR (VAR VAR = VAR VAR(VAR.VAR(), VAR)) { VAR = VAR.VAR(VAR); } VAR (VAR.VAR == VAR) { VAR VAR VAR(VAR.VAR(""VAR VAR VAR [%VAR] VAR VAR VAR."", VAR)); } } VAR { VAR = VAR.VAR(VAR.VAR()); } VAR VAR VAR(VAR, VAR); } VAR { VAR VAR VAR(VAR.VAR() + "" "" + VAR.VAR()); } } VAR VAR VAR(VAR VAR) { VAR VAR = VAR VAR(VAR); VAR VAR = VAR.VAR.VAR().VAR(); VAR (VAR != VAR && VAR(VAR.VAR(), VAR)) {  VAR.VAR(VAR, VAR.VAR(VAR)); } VAR VAR; } /** * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR VAR(VAR VAR, VAR VAR) { VAR VAR = VAR.VAR();    VAR VAR = VAR + VAR; VAR<VAR> VAR = VAR.VAR.VAR().VAR() .VAR(VAR::VAR) .VAR();  VAR VAR.VAR((VAR + VAR)::VAR)   .VAR(() -> VAR.VAR(VAR)); } } ",12,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-diff/xwiki-platform-diff-xml/src/test/java/org/xwiki/diff/xml/internal/DefaultDataURIConverterTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.diff.xml.internal;

import java.io.IOException;
import java.net.MalformedURLException;
import java.net.URI;
import java.net.URISyntaxException;
import java.net.URL;
import java.util.List;
import java.util.Map;

import javax.inject.Provider;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.cache.Cache;
import org.xwiki.cache.CacheException;
import org.xwiki.cache.CacheManager;
import org.xwiki.cache.config.CacheConfiguration;
import org.xwiki.diff.DiffException;
import org.xwiki.diff.xml.XMLDiffDataURIConverterConfiguration;
import org.xwiki.test.annotation.BeforeComponent;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.url.URLSecurityManager;
import org.xwiki.user.CurrentUserReference;
import org.xwiki.user.UserReferenceSerializer;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.web.XWikiServletRequestStub;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Unit tests for {@link DefaultDataURIConverter}.
 *
 * @version $Id$
 */
@ComponentTest
class DefaultDataURIConverterTest
{
    private static final String CURRENT_USER = ""XWiki.CurrentUser"";

    private static final String CACHE_PREFIX = CURRENT_USER.length() + "":"" + CURRENT_USER + "":"";

    private static final String URL_PREFIX = ""http://localhost:8080"";

    @MockComponent
    private ImageDownloader imageDownloader;

    @MockComponent
    private CacheManager cacheManager;

    @MockComponent
    private Provider<XWikiContext> xwikiContextProvider;

    @MockComponent
    private URLSecurityManager urlSecurityManager;

    private Cache<String> cache;

    private Cache<DiffException> failureCache;

    @MockComponent
    private UserReferenceSerializer<String> userReferenceSerializer;

    @MockComponent
    private XMLDiffDataURIConverterConfiguration configuration;

    @InjectMockComponents
    private DefaultDataURIConverter converter;

    @BeforeComponent
    public void configureCacheManager() throws CacheException
    {
        this.cache = mock();
        this.failureCache = mock();

        when(this.configuration.isEnabled()).thenReturn(true);

        when(this.cacheManager.createNewCache(any())).then(invocationOnMock -> {
            CacheConfiguration cacheConfiguration = invocationOnMock.getArgument(0);
            if (""diff.html.dataURI"".equals(cacheConfiguration.getConfigurationId())) {
                return this.cache;
            } else if (""diff.html.dataURIFailureCache"".equals(cacheConfiguration.getConfigurationId())) {
                return this.failureCache;
            }

            return null;
        });
    }

    @BeforeEach
    public void setUp()
    {
        when(this.userReferenceSerializer.serialize(CurrentUserReference.INSTANCE)).thenReturn(CURRENT_USER);

        XWikiContext xwikiContext = mock();
        when(this.xwikiContextProvider.get()).thenReturn(xwikiContext);
        XWikiServletRequestStub request = new XWikiServletRequestStub.Builder()
            .setHeaders(Map.of(""forwarded"", List.of(""host=localhost:8080;proto=http"")))
            .build();
        request.setRequestURI(""/xwiki"");
        when(xwikiContext.getRequest()).thenReturn(request);
    }

    @Test
    void returnsURLWhenDisabled() throws DiffException
    {
        when(this.configuration.isEnabled()).thenReturn(false);
        String url = ""http://www.example.com"";
        assertEquals(url, this.converter.convert(url));
    }

    @Test
    void dataURIIsKept() throws DiffException
    {
        String dataURI = ""data:image/png;base64,abc"";
        assertEquals(dataURI, this.converter.convert(dataURI));
    }

    @Test
    void throwsExceptionWhenURLIsMalFormed() throws IOException
    {
        String url = ""http://w w w.example.com"";
        when(this.urlSecurityManager.isDomainTrusted(new URL(url))).thenReturn(true);
        DiffException exception = assertThrows(DiffException.class, () -> this.converter.convert(url));
        assertEquals(getFailureMessage(url), exception.getMessage());
        assertEquals(""Illegal character in authority at index 7: http://w w w.example.com"",
            exception.getCause().getMessage());

        verify(this.imageDownloader, never()).download(any());
        verify(this.cache, never()).set(any(), any());
        verify(this.failureCache).set(CACHE_PREFIX + url,
            exception);
    }

    @Test
    void usesCacheWhenAvailable() throws DiffException
    {
        String dataURI = ""data:image/png;base64,def"";
        String url = ""/image.png"";
        when(this.cache.get(CACHE_PREFIX + URL_PREFIX + url)).thenReturn(dataURI);

        assertEquals(dataURI, this.converter.convert(url));
    }

    @Test
    void throwsCachedFailure()
    {
        String url = ""/image.png"";
        DiffException exception = new DiffException(""Failed to convert url to absolute URL."");
        when(this.failureCache.get(CACHE_PREFIX + URL_PREFIX + url)).thenReturn(exception);

        DiffException thrown = assertThrows(DiffException.class, () -> this.converter.convert(url));
        assertEquals(exception, thrown);
    }

    @Test
    void throwsWhenURLIsNotTrusted() throws MalformedURLException
    {
        String url = ""http://example.com/image.png"";
        when(this.urlSecurityManager.isDomainTrusted(new URL(url))).thenReturn(false);

        DiffException thrown = assertThrows(DiffException.class, () -> this.converter.convert(url));
        assertEquals(getFailureMessage(url), thrown.getMessage());
        assertEquals(String.format(""The URL [%s] is not trusted."", url), thrown.getCause().getMessage());

        // Make sure that the failure is cached.
        verify(this.failureCache).set(CACHE_PREFIX + url, thrown);
    }

    @Test
    void throwsExceptionWhenImageDownloaderFails() throws URISyntaxException, IOException
    {
        String url = ""/image.png"";
        URI uri = new URI(URL_PREFIX + url);
        when(this.urlSecurityManager.isDomainTrusted(uri.toURL())).thenReturn(true);
        IOException exception = new IOException(""Failed to download image."");
        when(this.imageDownloader.download(uri)).thenThrow(exception);

        DiffException thrown = assertThrows(DiffException.class, () -> this.converter.convert(url));
        assertEquals(getFailureMessage(url), thrown.getMessage());
        assertEquals(exception, thrown.getCause());

        // Make sure the failure is cached.
        verify(this.failureCache).set(CACHE_PREFIX + URL_PREFIX + url, thrown);
        // Make sure nothing is stored in the data cache.
        verify(this.cache, never()).set(any(), any());
    }

    @Test
    void returnsDataURIForReturnedDataAndMimeType() throws IOException, DiffException
    {
        String url = ""/image.png"";
        URI uri = URI.create(URL_PREFIX + url);
        when(this.urlSecurityManager.isDomainTrusted(uri.toURL())).thenReturn(true);
        String dataURI = ""data:image/jpeg;base64,ZGVm"";
        when(this.imageDownloader.download(uri))
            .thenReturn(new ImageDownloader.DownloadResult(new byte[] { 'd', 'e', 'f' }, ""image/jpeg""));

        assertEquals(dataURI, this.converter.convert(url));

        // Make sure the data is cached.
        verify(this.cache).set(CACHE_PREFIX + URL_PREFIX + url, dataURI);
        // Make sure nothing is stored in the failure cache.
        verify(this.failureCache, never()).set(any(), any());
    }

    private static String getFailureMessage(String url)
    {
        return String.format(""Failed to convert [%s] to data URI."", url);
    }
}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR""; VAR VAR VAR VAR VAR = VAR.VAR() + "":"" + VAR + "":""; VAR VAR VAR VAR VAR = ""VAR: @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; VAR VAR<VAR> VAR; VAR VAR<VAR> VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR() VAR VAR { VAR.VAR = VAR(); VAR.VAR = VAR(); VAR(VAR.VAR.VAR()).VAR(VAR); VAR(VAR.VAR.VAR(VAR())).VAR(VAR -> { VAR VAR = VAR.VAR(0); VAR (""VAR.VAR.VAR"".VAR(VAR.VAR())) { VAR VAR.VAR; } VAR VAR (""VAR.VAR.VAR"".VAR(VAR.VAR())) { VAR VAR.VAR; } VAR VAR; }); } @VAR VAR VAR VAR() { VAR(VAR.VAR.VAR(VAR.VAR)).VAR(VAR); VAR VAR = VAR(); VAR(VAR.VAR.VAR()).VAR(VAR); VAR VAR = VAR VAR.VAR() .VAR(VAR.VAR(""VAR"", VAR.VAR(""VAR=VAR:8080;VAR=VAR""))) .VAR(); VAR.VAR(""/VAR""); VAR(VAR.VAR()).VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR(VAR.VAR.VAR()).VAR(VAR); VAR VAR = ""VAR: VAR(VAR, VAR.VAR.VAR(VAR)); } @VAR VAR VAR() VAR VAR { VAR VAR = ""VAR:VAR/VAR;VAR,VAR""; VAR(VAR, VAR.VAR.VAR(VAR)); } @VAR VAR VAR() VAR VAR { VAR VAR = ""VAR: VAR(VAR.VAR.VAR(VAR VAR(VAR))).VAR(VAR); VAR VAR = VAR(VAR.VAR, () -> VAR.VAR.VAR(VAR)); VAR(VAR(VAR), VAR.VAR()); VAR(""VAR VAR VAR VAR VAR VAR 7: VAR: VAR.VAR().VAR()); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR, VAR()).VAR(VAR(), VAR()); VAR(VAR.VAR).VAR(VAR + VAR, VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = ""VAR:VAR/VAR;VAR,VAR""; VAR VAR = ""/VAR.VAR""; VAR(VAR.VAR.VAR(VAR + VAR + VAR)).VAR(VAR); VAR(VAR, VAR.VAR.VAR(VAR)); } @VAR VAR VAR() { VAR VAR = ""/VAR.VAR""; VAR VAR = VAR VAR(""VAR VAR VAR VAR VAR VAR VAR.""); VAR(VAR.VAR.VAR(VAR + VAR + VAR)).VAR(VAR); VAR VAR = VAR(VAR.VAR, () -> VAR.VAR.VAR(VAR)); VAR(VAR, VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = ""VAR: VAR(VAR.VAR.VAR(VAR VAR(VAR))).VAR(VAR); VAR VAR = VAR(VAR.VAR, () -> VAR.VAR.VAR(VAR)); VAR(VAR(VAR), VAR.VAR()); VAR(VAR.VAR(""VAR VAR [%VAR] VAR VAR VAR."", VAR), VAR.VAR().VAR());  VAR(VAR.VAR).VAR(VAR + VAR, VAR); } @VAR VAR VAR() VAR VAR, VAR { VAR VAR = ""/VAR.VAR""; VAR VAR = VAR VAR(VAR + VAR); VAR(VAR.VAR.VAR(VAR.VAR())).VAR(VAR); VAR VAR = VAR VAR(""VAR VAR VAR VAR.""); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR VAR = VAR(VAR.VAR, () -> VAR.VAR.VAR(VAR)); VAR(VAR(VAR), VAR.VAR()); VAR(VAR, VAR.VAR());  VAR(VAR.VAR).VAR(VAR + VAR + VAR, VAR);  VAR(VAR.VAR, VAR()).VAR(VAR(), VAR()); } @VAR VAR VAR() VAR VAR, VAR { VAR VAR = ""/VAR.VAR""; VAR VAR = VAR.VAR(VAR + VAR); VAR(VAR.VAR.VAR(VAR.VAR())).VAR(VAR); VAR VAR = ""VAR:VAR/VAR;VAR,VAR""; VAR(VAR.VAR.VAR(VAR)) .VAR(VAR VAR.VAR(VAR VAR[] { 'VAR', 'VAR', 'VAR' }, ""VAR/VAR"")); VAR(VAR, VAR.VAR.VAR(VAR));  VAR(VAR.VAR).VAR(VAR + VAR + VAR, VAR);  VAR(VAR.VAR, VAR()).VAR(VAR(), VAR()); } VAR VAR VAR VAR(VAR VAR) { VAR VAR.VAR(""VAR VAR VAR [%VAR] VAR VAR VAR."", VAR); } } ",5,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-skin/xwiki-platform-flamingo-skin-test/xwiki-platform-flamingo-skin-test-docker/src/test/it/org/xwiki/flamingo/test/docker/CompareIT.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.flamingo.test.docker;

import java.net.URI;
import java.net.URISyntaxException;
import java.util.Base64;
import java.util.List;

import org.apache.commons.io.IOUtils;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;
import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.xwiki.model.reference.AttachmentReference;
import org.xwiki.test.docker.junit5.TestReference;
import org.xwiki.test.docker.junit5.UITest;
import org.xwiki.test.ui.TestUtils;
import org.xwiki.test.ui.po.ComparePage;
import org.xwiki.test.ui.po.ViewPage;
import org.xwiki.test.ui.po.diff.RenderedChanges;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;

/**
 * Tests related to the compare versions feature.
 *
 * @version $Id$
 */
@UITest(properties = {
    // Trust picsum.photos to allow the rendered diff to download images from it
    ""xwikiPropertiesAdditionalProperties=url.trustedDomains=picsum.photos""
})
class CompareIT
{
    private static final String ATTACHMENT_NAME_1 = ""image.gif"";

    private static final String ATTACHMENT_NAME_2 = ""image2.gif"";

    private static final String ATTACHMENT_NAME_3 = ""image.png"";

    private static final String IMAGE_SYNTAX = ""[[image:%s]]"";

    private String getLocalAttachmentURL(TestUtils setup, TestReference testReference, String attachmentName)
        throws URISyntaxException
    {
        AttachmentReference attachmentReference = new AttachmentReference(attachmentName, testReference);
        URI attachmentURL = new URI(setup.getURL(attachmentReference, ""download"", null));
        // Replace host and port with localhost and 8080 to make the URL usable from the container.
        return (new URI(""http"", null, ""localhost"", 8080, attachmentURL.getPath(),
            attachmentURL.getQuery(), attachmentURL.getFragment())).toString();
    }

    @Test
    @Order(1)
    void compareRenderedImageChanges(TestUtils setup, TestReference testReference) throws Exception
    {
        setup.loginAsSuperAdmin();
        setup.attachFile(testReference, ATTACHMENT_NAME_1,
            getClass().getResourceAsStream(""/AttachmentIT/image.gif""), false);
        // Upload the image a second time under a different name to check that the content and not the URL is used
        // for comparison when changing the URL to the second image.
        setup.attachFile(testReference, ATTACHMENT_NAME_2,
            getClass().getResourceAsStream(""/AttachmentIT/image.gif""), false);
        String url1 = getLocalAttachmentURL(setup, testReference, ATTACHMENT_NAME_1);
        ViewPage viewPage = setup.createPage(testReference, String.format(IMAGE_SYNTAX, url1));
        String firstRevision = viewPage.getMetaDataValue(""version"");
        // Create a second revision with the new image.
        String url2 = getLocalAttachmentURL(setup, testReference, ATTACHMENT_NAME_2);
        viewPage = setup.createPage(testReference, String.format(IMAGE_SYNTAX, url2));
        String secondRevision = viewPage.getMetaDataValue(""version"");

        // Open the history pane.
        ComparePage compare = viewPage.openHistoryDocExtraPane().compare(firstRevision, secondRevision);
        RenderedChanges renderedChanges = compare.getChangesPane().getRenderedChanges();
        assertTrue(renderedChanges.hasNoChanges());

        // Upload a new image with different content to verify that the changes are detected.
        setup.attachFile(testReference, ATTACHMENT_NAME_3,
            getClass().getResourceAsStream(""/AttachmentIT/SmallSizeAttachment.png""), false);

        // Create a third revision with the new image.
        String url3 = getLocalAttachmentURL(setup, testReference, ATTACHMENT_NAME_3);
        viewPage = setup.createPage(testReference, String.format(IMAGE_SYNTAX, url3));
        String thirdRevision = viewPage.getMetaDataValue(""version"");

        // Open the history pane.
        compare = viewPage.openHistoryDocExtraPane().compare(secondRevision, thirdRevision);
        renderedChanges = compare.getChangesPane().getRenderedChanges();
        assertFalse(renderedChanges.hasNoChanges());
        List<WebElement> changes = renderedChanges.getChangedBlocks();
        assertEquals(2, changes.size());

        // Check that the first change is the deletion and the second change the insertion of the new image.
        WebElement firstChange = changes.get(0);
        WebElement secondChange = changes.get(1);
        assertEquals(""deleted"", firstChange.getAttribute(""data-xwiki-html-diff-block""));
        assertEquals(""inserted"", secondChange.getAttribute(""data-xwiki-html-diff-block""));
        WebElement deletedImage = firstChange.findElement(By.tagName(""img""));
        WebElement insertedImage = secondChange.findElement(By.tagName(""img""));

        // Check that the src attribute of the deleted image ends with the image2 (don't check the start as it
        // depends on the container setup and the nested/non-nested test execution).
        assertEquals(url2, deletedImage.getAttribute(""src""));

        // Compute the expected base64-encoded content of the inserted image. The HTML diff embeds both images but
        // replaces the deleted image by the original URL again after the diff computation.
        String expectedInsertedImageContent = Base64.getEncoder().encodeToString(
            IOUtils.toByteArray(getClass().getResourceAsStream(""/AttachmentIT/SmallSizeAttachment.png"")));
        assertEquals(""data:image/png;base64,"" + expectedInsertedImageContent, insertedImage.getAttribute(""src""));
    }
}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ */ @VAR(VAR = {  ""VAR=VAR.VAR=VAR.VAR"" }) VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR""; VAR VAR VAR VAR VAR = ""VAR.VAR""; VAR VAR VAR VAR VAR = ""VAR.VAR""; VAR VAR VAR VAR VAR = ""[[VAR:%VAR]]""; VAR VAR VAR(VAR VAR, VAR VAR, VAR VAR) VAR VAR { VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR VAR(VAR.VAR(VAR, ""VAR"", VAR));  VAR (VAR VAR(""VAR"", VAR, ""VAR"", 8080, VAR.VAR(), VAR.VAR(), VAR.VAR())).VAR(); } @VAR @VAR(1) VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR.VAR(); VAR.VAR(VAR, VAR, VAR().VAR(""/VAR/VAR.VAR""), VAR);   VAR.VAR(VAR, VAR, VAR().VAR(""/VAR/VAR.VAR""), VAR); VAR VAR = VAR(VAR, VAR, VAR); VAR VAR = VAR.VAR(VAR, VAR.VAR(VAR, VAR)); VAR VAR = VAR.VAR(""VAR"");  VAR VAR = VAR(VAR, VAR, VAR); VAR = VAR.VAR(VAR, VAR.VAR(VAR, VAR)); VAR VAR = VAR.VAR(""VAR"");  VAR VAR = VAR.VAR().VAR(VAR, VAR); VAR VAR = VAR.VAR().VAR(); VAR(VAR.VAR());  VAR.VAR(VAR, VAR, VAR().VAR(""/VAR/VAR.VAR""), VAR);  VAR VAR = VAR(VAR, VAR, VAR); VAR = VAR.VAR(VAR, VAR.VAR(VAR, VAR)); VAR VAR = VAR.VAR(""VAR"");  VAR = VAR.VAR().VAR(VAR, VAR); VAR = VAR.VAR().VAR(); VAR(VAR.VAR()); VAR<VAR> VAR = VAR.VAR(); VAR(2, VAR.VAR());  VAR VAR = VAR.VAR(0); VAR VAR = VAR.VAR(1); VAR(""VAR"", VAR.VAR(""VAR-VAR-VAR-VAR-VAR"")); VAR(""VAR"", VAR.VAR(""VAR-VAR-VAR-VAR-VAR"")); VAR VAR = VAR.VAR(VAR.VAR(""VAR"")); VAR VAR = VAR.VAR(VAR.VAR(""VAR""));   VAR(VAR, VAR.VAR(""VAR""));   VAR VAR = VAR.VAR().VAR( VAR.VAR(VAR().VAR(""/VAR/VAR.VAR""))); VAR(""VAR:VAR/VAR;VAR,"" + VAR, VAR.VAR(""VAR"")); } } ",5,8
xwiki-platform_bff0203e739b6e3eb90af5736f04278c73c2a8bb,xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-default/src/test/java/org/xwiki/security/authentication/internal/DefaultAuthenticationConfigurationTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.security.authentication.internal;

import java.util.List;

import javax.inject.Named;

import org.junit.jupiter.api.Test;
import org.xwiki.configuration.ConfigurationSource;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.when;

/**
 * Unit test of {@link DefaultAuthenticationConfiguration}.
 */
@ComponentTest
class DefaultAuthenticationConfigurationTest
{
    @MockComponent
    @Named(""xwikicfg"")
    private ConfigurationSource xwikiCfgConfiguration;

    @InjectMockComponents
    private DefaultAuthenticationConfiguration configuration;

    @Test
    void getCookieDomains()
    {
        // Test with empty configuration.
        String configurationKey = ""xwiki.authentication.cookiedomains"";
        when(this.xwikiCfgConfiguration.getProperty(configurationKey, List.class, List.of()))
            .thenReturn(List.of());

        assertEquals(List.of(), this.configuration.getCookieDomains());

        // Test with domains without prefix.
        when(this.xwikiCfgConfiguration.getProperty(configurationKey, List.class, List.of()))
            .thenReturn(List.of(""xwiki.org"", ""xwiki.com""));

        String xwikiComWithPrefix = "".xwiki.com"";
        assertEquals(List.of("".xwiki.org"", xwikiComWithPrefix), this.configuration.getCookieDomains());

        // Test with domains where some have a prefix already.
        when(this.xwikiCfgConfiguration.getProperty(configurationKey, List.class, List.of()))
            .thenReturn(List.of(""example.com"", xwikiComWithPrefix));

        assertEquals(List.of("".example.com"", xwikiComWithPrefix), this.configuration.getCookieDomains());
    }
}",,bff0203e739b6e3eb90af5736f04278c73c2a8bb,CVE-2023-48240,bff0203e739b6e3eb90af5736f04278c73c2a8bb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. */ @VAR VAR VAR { @VAR @VAR(""VAR"") VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR() {  VAR VAR = ""VAR.VAR.VAR""; VAR(VAR.VAR.VAR(VAR, VAR.VAR, VAR.VAR())) .VAR(VAR.VAR()); VAR(VAR.VAR(), VAR.VAR.VAR());  VAR(VAR.VAR.VAR(VAR, VAR.VAR, VAR.VAR())) .VAR(VAR.VAR(""VAR.VAR"", ""VAR.VAR"")); VAR VAR = "".VAR.VAR""; VAR(VAR.VAR("".VAR.VAR"", VAR), VAR.VAR.VAR());  VAR(VAR.VAR.VAR(VAR, VAR.VAR, VAR.VAR())) .VAR(VAR.VAR(""VAR.VAR"", VAR)); VAR(VAR.VAR("".VAR.VAR"", VAR), VAR.VAR.VAR()); } } ",5,8
xwiki-platform_d06ff8a58480abc7f63eb1d4b8b366024d990643,xwiki-platform-core/xwiki-platform-localization/xwiki-platform-localization-sources/xwiki-platform-localization-source-wiki/src/main/java/org/xwiki/localization/wiki/internal/DefaultWikiTranslationConfiguration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.localization.wiki.internal;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.xwiki.component.annotation.Component;
import org.xwiki.configuration.ConfigurationSource;

/**
 * Default implementation of the {@link WikiTranslationConfiguration}.
 *
 * @since 14.10.2
 * @since 15.0RC1
 * @version $Id$
 */
@Singleton
@Component
public class DefaultWikiTranslationConfiguration implements WikiTranslationConfiguration
{
    private static final String PREFIX = ""localization.wiki."";

    @Inject
    @Named(""xwikiproperties"")
    private ConfigurationSource configuration;

    @Override
    public boolean isRestrictUserTranslations()
    {
        return this.configuration.getProperty(PREFIX + ""restrictUserTranslations"", true);
    }
}",,d06ff8a58480abc7f63eb1d4b8b366024d990643,CVE-2023-29510,d06ff8a58480abc7f63eb1d4b8b366024d990643,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR {@VAR VAR}. * * @VAR 14.10.2 * @VAR 15.0RC1 * @VAR $VAR$ */ @VAR @VAR VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR.""; @VAR @VAR(""VAR"") VAR VAR VAR; @VAR VAR VAR VAR() { VAR VAR.VAR.VAR(VAR + ""VAR"", VAR); } } ",5,8
xwiki-platform_d06ff8a58480abc7f63eb1d4b8b366024d990643,xwiki-platform-core/xwiki-platform-localization/xwiki-platform-localization-sources/xwiki-platform-localization-source-wiki/src/main/java/org/xwiki/localization/wiki/internal/WikiTranslationConfiguration.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.localization.wiki.internal;

import org.xwiki.component.annotation.Role;

/**
 * Configuration of the wiki translations.
 *
 * @since 14.10.2
 * @since 15.0RC1
 * @version $Id$
 */
@Role
public interface WikiTranslationConfiguration
{
    /**
     * @return if translations with user scope shall be restricted to users with script right
     */
    boolean isRestrictUserTranslations();
}",,d06ff8a58480abc7f63eb1d4b8b366024d990643,CVE-2023-29510,d06ff8a58480abc7f63eb1d4b8b366024d990643,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR. * * @VAR 14.10.2 * @VAR 15.0RC1 * @VAR $VAR$ */ @VAR VAR VAR VAR { /** * @VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR */ VAR VAR(); } ",5,8
xwiki-platform_d28d7739089e1ae8961257d9da7135d1a01cb7d4,xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/main/java/org/xwiki/security/internal/DocumentInitializerRightsManager.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.security.internal;

import java.util.List;
import java.util.stream.Collectors;

import javax.inject.Inject;
import javax.inject.Provider;
import javax.inject.Singleton;

import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.security.authorization.Right;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.objects.BaseObject;

import static org.xwiki.security.authorization.Right.DELETE;
import static org.xwiki.security.authorization.Right.EDIT;
import static org.xwiki.security.authorization.Right.VIEW;
import static org.xwiki.security.internal.XWikiConstants.ALLOW_FIELD_NAME;
import static org.xwiki.security.internal.XWikiConstants.GROUPS_FIELD_NAME;
import static org.xwiki.security.internal.XWikiConstants.LEVELS_FIELD_NAME;
import static org.xwiki.security.internal.XWikiConstants.LOCAL_CLASS_REFERENCE;

/**
 * Service provided to {@link com.xpn.xwiki.doc.MandatoryDocumentInitializer}s to initialize documents with the correct
 * rights.
 *
 * @version $Id$
 * @since 14.4.8
 * @since 14.10.5
 * @since 15.1RC1
 */
@Component(roles = DocumentInitializerRightsManager.class)
@Singleton
public class DocumentInitializerRightsManager
{
    private static final String XWIKI_ADMIN_GROUP_DOCUMENT_REFERENCE = ""XWiki.XWikiAdminGroup"";

    @Inject
    private Provider<XWikiContext> xcontextProvider;

    @Inject
    private Logger logger;

    /**
     * Restrict the rights of the provided document so that it can only be viewed, edited and deleted by the
     * {@code XWiki.XWikiAdminGroup} group. Note that this restriction is only applied if no rights are already applied
     * on the current document.
     * <br>
     *
     * @param document the document to updated rights on
     * @return {@code true} if the document has been modified, {@code false} otherwise (including if the document hasn't
     *     been modified because of an error during the modification)
     */
    public boolean restrictToAdmin(XWikiDocument document)
    {
        boolean updated = false;
        // If some rights have already been set on the document, we consider that it has already been protected
        // manually.
        if (document.getXObjects(LOCAL_CLASS_REFERENCE).isEmpty()) {
            updated = initializeRights(document, XWIKI_ADMIN_GROUP_DOCUMENT_REFERENCE, List.of(VIEW, EDIT, DELETE));
        }

        return updated;
    }

    private boolean initializeRights(XWikiDocument document, String xwikiAdminGroupDocumentReference,
        List<Right> rights)
    {
        boolean updated = false;

        try {
            XWikiContext xwikiContext = this.xcontextProvider.get();
            BaseObject object = document.newXObject(LOCAL_CLASS_REFERENCE, xwikiContext);
            XWikiContext xWikiContext = this.xcontextProvider.get();
            object.set(GROUPS_FIELD_NAME, xwikiAdminGroupDocumentReference, xWikiContext);
            object.set(LEVELS_FIELD_NAME, rights.stream().map(Right::getName).collect(Collectors.toList()),
                xWikiContext);
            object.set(ALLOW_FIELD_NAME, 1, xWikiContext);
            updated = true;
        } catch (XWikiException e) {
            this.logger.error(String.format(""Error adding a [%s] object to the document [%s]"", LOCAL_CLASS_REFERENCE,
                document.getDocumentReference()));
        }

        return updated;
    }
}",,d28d7739089e1ae8961257d9da7135d1a01cb7d4,CVE-2023-34465,d28d7739089e1ae8961257d9da7135d1a01cb7d4,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR.VAR.VAR.VAR}VAR VAR VAR VAR VAR VAR VAR * VAR. * * @VAR $VAR$ * @VAR 14.4.8 * @VAR 14.10.5 * @VAR 15.1RC1 */ @VAR(VAR = VAR.VAR) @VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR.VAR""; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR * {@VAR VAR.VAR} VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * <VAR> * * @VAR VAR VAR VAR VAR VAR VAR VAR * @VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR, {@VAR VAR} VAR (VAR VAR VAR VAR VAR'VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR) */ VAR VAR VAR(VAR VAR) { VAR VAR = VAR;   VAR (VAR.VAR(VAR).VAR()) { VAR = VAR(VAR, VAR, VAR.VAR(VAR, VAR, VAR)); } VAR VAR; } VAR VAR VAR(VAR VAR, VAR VAR, VAR<VAR> VAR) { VAR VAR = VAR; VAR { VAR VAR = VAR.VAR.VAR(); VAR VAR = VAR.VAR(VAR, VAR); VAR VAR = VAR.VAR.VAR(); VAR.VAR(VAR, VAR, VAR); VAR.VAR(VAR, VAR.VAR().VAR(VAR::VAR).VAR(VAR.VAR()), VAR); VAR.VAR(VAR, 1, VAR); VAR = VAR; } VAR (VAR VAR) { VAR.VAR.VAR(VAR.VAR(""VAR VAR VAR [%VAR] VAR VAR VAR VAR [%VAR]"", VAR, VAR.VAR())); } VAR VAR; } } ",5,8
xwiki-platform_d28d7739089e1ae8961257d9da7135d1a01cb7d4,xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authorization/xwiki-platform-security-authorization-bridge/src/test/java/org/xwiki/security/internal/DocumentInitializerRightsManagerTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.security.internal;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.RegisterExtension;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.reference.EntityReference;
import org.xwiki.test.LogLevel;
import org.xwiki.test.annotation.AllComponents;
import org.xwiki.test.junit5.LogCaptureExtension;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.mockito.MockitoComponentManager;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.MandatoryDocumentInitializer;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.internal.mandatory.XWikiRightsDocumentInitializer;
import com.xpn.xwiki.objects.BaseObject;
import com.xpn.xwiki.test.MockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.InjectMockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;

import ch.qos.logback.classic.Level;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.doThrow;
import static org.mockito.Mockito.spy;
import static org.xwiki.security.internal.XWikiConstants.ALLOW_FIELD_NAME;
import static org.xwiki.security.internal.XWikiConstants.GROUPS_FIELD_NAME;
import static org.xwiki.security.internal.XWikiConstants.LEVELS_FIELD_NAME;
import static org.xwiki.security.internal.XWikiConstants.LOCAL_CLASS_REFERENCE;

/**
 * Test of {@link DocumentInitializerRightsManager}.
 *
 * @version $Id$
 */
@OldcoreTest
@AllComponents
class DocumentInitializerRightsManagerTest
{
    @InjectMockitoOldcore
    private MockitoOldcore oldcore;

    @InjectMockComponents
    private DocumentInitializerRightsManager rightsManager;

    @RegisterExtension
    LogCaptureExtension logCapture = new LogCaptureExtension(LogLevel.WARN);

    private XWikiDocument document;

    private XWikiContext xWikiContext;

    @BeforeEach
    void setUp(MockitoComponentManager componentManager) throws Exception
    {
        this.xWikiContext = this.oldcore.getXWikiContext();
        String wikiId = this.xWikiContext.getWikiId();
        this.document = this.oldcore.getSpyXWiki()
            .getDocument(new DocumentReference(wikiId, ""Space"", ""Page""), this.xWikiContext);
        XWikiDocument xWikiRigths = this.oldcore.getSpyXWiki()
            .getDocument(new DocumentReference(wikiId, ""XWiki"", ""XWikiRights""), this.xWikiContext);
        componentManager.<MandatoryDocumentInitializer>getInstance(MandatoryDocumentInitializer.class,
            XWikiRightsDocumentInitializer.CLASS_REFERENCE_STRING).updateDocument(xWikiRigths);
        this.oldcore.getSpyXWiki().saveDocument(xWikiRigths, this.xWikiContext);
    }

    @Test
    void restrictToAdminSkipWhenAlreadyHasRights() throws Exception
    {
        this.document.newXObject(LOCAL_CLASS_REFERENCE, this.xWikiContext);
        assertFalse(this.rightsManager.restrictToAdmin(this.document));
    }

    @Test
    void restrictToAdmin()
    {
        assertTrue(this.rightsManager.restrictToAdmin(this.document));
        assertEquals(1, this.document.getXObjects(LOCAL_CLASS_REFERENCE).size());
        BaseObject xObject = this.document.getXObject(LOCAL_CLASS_REFERENCE);
        assertEquals(""XWiki.XWikiAdminGroup"", xObject.getStringValue(GROUPS_FIELD_NAME));
        assertEquals(""view, edit, delete"", xObject.getStringValue(LEVELS_FIELD_NAME));
        assertEquals(""1"", xObject.getStringValue(ALLOW_FIELD_NAME));
    }

    @Test
    void restrictToAdminWithException() throws XWikiException
    {
        this.document = spy(this.document);
        doThrow(XWikiException.class).when(this.document)
            .newXObject(any(EntityReference.class), any(XWikiContext.class));
        assertFalse(this.rightsManager.restrictToAdmin(this.document));
        assertEquals(0, this.document.getXObjects(LOCAL_CLASS_REFERENCE).size());
        assertEquals(""Error adding a [XWiki.XWikiRights] object to the document [xwiki:Space.Page]"",
            this.logCapture.getMessage(0));
        assertEquals(Level.ERROR, this.logCapture.getLogEvent(0).getLevel());
    }
}",,d28d7739089e1ae8961257d9da7135d1a01cb7d4,CVE-2023-34465,d28d7739089e1ae8961257d9da7135d1a01cb7d4,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR @VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR = VAR VAR(VAR.VAR); VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR(VAR VAR) VAR VAR { VAR.VAR = VAR.VAR.VAR(); VAR VAR = VAR.VAR.VAR(); VAR.VAR = VAR.VAR.VAR() .VAR(VAR VAR(VAR, ""VAR"", ""VAR""), VAR.VAR); VAR VAR = VAR.VAR.VAR() .VAR(VAR VAR(VAR, ""VAR"", ""VAR""), VAR.VAR); VAR.<VAR>VAR(VAR.VAR, VAR.VAR).VAR(VAR); VAR.VAR.VAR().VAR(VAR, VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(VAR, VAR.VAR); VAR(VAR.VAR.VAR(VAR.VAR)); } @VAR VAR VAR() { VAR(VAR.VAR.VAR(VAR.VAR)); VAR(1, VAR.VAR.VAR(VAR).VAR()); VAR VAR = VAR.VAR.VAR(VAR); VAR(""VAR.VAR"", VAR.VAR(VAR)); VAR(""VAR, VAR, VAR"", VAR.VAR(VAR)); VAR(""1"", VAR.VAR(VAR)); } @VAR VAR VAR() VAR VAR { VAR.VAR = VAR(VAR.VAR); VAR(VAR.VAR).VAR(VAR.VAR) .VAR(VAR(VAR.VAR), VAR(VAR.VAR)); VAR(VAR.VAR.VAR(VAR.VAR)); VAR(0, VAR.VAR.VAR(VAR).VAR()); VAR(""VAR VAR VAR [VAR.VAR] VAR VAR VAR VAR [VAR:VAR.VAR]"", VAR.VAR.VAR(0)); VAR(VAR.VAR, VAR.VAR.VAR(0).VAR()); } } ",5,8
xwiki-platform_db3d1c62fc5fb59fefcda3b86065d2d362f55164,xwiki-platform-core/xwiki-platform-oldcore/src/main/java/com/xpn/xwiki/internal/doc/BaseObjects.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.internal.doc;

import java.util.AbstractList;
import java.util.Collection;
import java.util.Map;
import java.util.concurrent.ConcurrentSkipListMap;

import com.xpn.xwiki.objects.BaseObject;

/**
 * Implement a list of {@link BaseObject} as seen by a document (meaning that the list index matched the object number)
 * using a {@link Map} storage to avoid wasting memory with null entries.
 *
 * @version $Id$
 * @since 14.0RC1
 */
// TODO: expose APIs to navigate non null objects directly instead of going through each entry and skipping explicitly
// null ones
public class BaseObjects extends AbstractList<BaseObject>
{
    // Sort keys so that it's possible to navigate non null entries without going through them all
    private Map<Integer, BaseObject> map = new ConcurrentSkipListMap<>();

    private int size;

    /**
     * Constructs an empty list.
     */
    public BaseObjects()
    {

    }

    /**
     * Constructs a list containing the elements of the specified collection, in the order they are returned by the
     * collection's iterator.
     *
     * @param collection the collection to copy
     */
    public BaseObjects(Collection<BaseObject> collection)
    {
        collection.forEach(this::add);
    }

    @Override
    public BaseObject get(int index)
    {
        rangeCheck(index);

        return this.map.get(index);
    }

    @Override
    public int size()
    {
        return this.size;
    }

    private BaseObject put(int index, BaseObject element)
    {
        BaseObject old;
        if (element == null) {
            // We don't want to keep null values in memory
            old = this.map.remove(index);
        } else {
            // Make sure the object number is right
            element.setNumber(index);

            old = this.map.put(index, element);
        }

        // Increment size if needed
        if (this.size <= index) {
            this.size = index + 1;
        }

        return old;
    }

    @Override
    public void add(int index, BaseObject element)
    {
        // Check if the index is valid
        rangeCheckForAdd(index);

        // Move right values
        if (index < this.size) {
            for (int i = this.size - 1; i >= index; --i) {
                put(i + 1, get(i));
            }
        }

        // Insert new value
        put(index, element);
    }

    @Override
    public BaseObject set(int index, BaseObject element)
    {
        // Check if the index is valid
        rangeCheck(index);

        // Set the value and remember the old one
        return put(index, element);
    }

    @Override
    public BaseObject remove(int index)
    {
        rangeCheck(index);

        return this.map.remove(index);
    }

    private void rangeCheck(int index)
    {
        if (index < 0 || index >= this.size) {
            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
        }
    }

    private void rangeCheckForAdd(int index)
    {
        if (index < 0 || index > this.size || index == Integer.MAX_VALUE) {
            throw new IndexOutOfBoundsException(outOfBoundsMsg(index));
        }
    }

    private String outOfBoundsMsg(int index)
    {
        return ""Index: "" + index + "", Size: "" + size;
    }
}",,db3d1c62fc5fb59fefcda3b86065d2d362f55164,CVE-2023-26470,db3d1c62fc5fb59fefcda3b86065d2d362f55164,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR (VAR VAR VAR VAR VAR VAR VAR VAR VAR) * VAR VAR {@VAR VAR} VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.0RC1 */   VAR VAR VAR VAR VAR<VAR> {  VAR VAR<VAR, VAR> VAR = VAR VAR<>(); VAR VAR VAR; /** * VAR VAR VAR VAR. */ VAR VAR() { } /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR * VAR'VAR VAR. * * @VAR VAR VAR VAR VAR VAR */ VAR VAR(VAR<VAR> VAR) { VAR.VAR(VAR::VAR); } @VAR VAR VAR VAR(VAR VAR) { VAR(VAR); VAR VAR.VAR.VAR(VAR); } @VAR VAR VAR VAR() { VAR VAR.VAR; } VAR VAR VAR(VAR VAR, VAR VAR) { VAR VAR; VAR (VAR == VAR) {  VAR = VAR.VAR.VAR(VAR); } VAR {  VAR.VAR(VAR); VAR = VAR.VAR.VAR(VAR, VAR); }  VAR (VAR.VAR <= VAR) { VAR.VAR = VAR + 1; } VAR VAR; } @VAR VAR VAR VAR(VAR VAR, VAR VAR) {  VAR(VAR);  VAR (VAR < VAR.VAR) { VAR (VAR VAR = VAR.VAR - 1; VAR >= VAR; --VAR) { VAR(VAR + 1, VAR(VAR)); } }  VAR(VAR, VAR); } @VAR VAR VAR VAR(VAR VAR, VAR VAR) {  VAR(VAR);  VAR VAR(VAR, VAR); } @VAR VAR VAR VAR(VAR VAR) { VAR(VAR); VAR VAR.VAR.VAR(VAR); } VAR VAR VAR(VAR VAR) { VAR (VAR < 0 || VAR >= VAR.VAR) { VAR VAR VAR(VAR(VAR)); } } VAR VAR VAR(VAR VAR) { VAR (VAR < 0 || VAR > VAR.VAR || VAR == VAR.VAR) { VAR VAR VAR(VAR(VAR)); } } VAR VAR VAR(VAR VAR) { VAR ""VAR: "" + VAR + "", VAR: "" + VAR; } } ",5,8
xwiki-platform_db3d1c62fc5fb59fefcda3b86065d2d362f55164,xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/internal/doc/BaseObjectsTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.internal.doc;

import java.util.Arrays;

import org.junit.jupiter.api.Test;

import com.xpn.xwiki.objects.BaseObject;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNull;
import static org.junit.jupiter.api.Assertions.assertSame;
import static org.junit.jupiter.api.Assertions.assertThrows;

/**
 * Validate {@link BaseObjects}.
 *
 * @version $Id$
 */
public class BaseObjectsTest
{
    private static class TestBaseObject extends BaseObject
    {
        @Override
        public String toString()
        {
            return String.valueOf(getNumber());
        }
    }

    private static final BaseObject XOBJ1 = new TestBaseObject();

    private static final BaseObject XOBJ2 = new TestBaseObject();

    private static final BaseObject XOBJ3 = new TestBaseObject();

    private static final BaseObject XOBJ4 = new TestBaseObject();

    @Test
    void add()
    {
        BaseObjects objects = new BaseObjects();

        assertEquals(0, objects.size());

        objects.add(XOBJ1);

        assertEquals(1, objects.size());

        objects.add(null);

        assertEquals(2, objects.size());

        objects.add(XOBJ2);

        assertEquals(3, objects.size());
        assertSame(XOBJ1, objects.get(0));
        assertEquals(0, objects.get(0).getNumber());
        assertNull(objects.get(1));
        assertSame(XOBJ2, objects.get(2));
        assertEquals(2, objects.get(2).getNumber());

        objects.add(1, XOBJ3);

        assertEquals(4, objects.size());
        assertSame(XOBJ1, objects.get(0));
        assertEquals(0, objects.get(0).getNumber());
        assertSame(XOBJ3, objects.get(1));
        assertEquals(1, objects.get(1).getNumber());
        assertNull(objects.get(2));
        assertSame(XOBJ2, objects.get(3));
        assertEquals(3, objects.get(3).getNumber());

        assertThrows(IndexOutOfBoundsException.class, () -> objects.add(Integer.MAX_VALUE, XOBJ4));
    }

    @Test
    void set()
    {
        BaseObjects objects = new BaseObjects();

        assertEquals(0, objects.size());

        assertThrows(IndexOutOfBoundsException.class, () -> objects.set(0, XOBJ1));

        objects.add(XOBJ1);
        objects.add(XOBJ2);
        objects.add(XOBJ3);

        objects.set(1, XOBJ4);

        assertSame(XOBJ1, objects.get(0));
        assertSame(XOBJ4, objects.get(1));
        assertSame(XOBJ3, objects.get(2));
    }

    @Test
    void remove()
    {
        BaseObjects objects = new BaseObjects(Arrays.asList(XOBJ1, XOBJ2, XOBJ3));

        assertEquals(3, objects.size());

        objects.remove(0);
        objects.remove(2);

        assertNull(objects.get(0));
        assertSame(XOBJ2, objects.get(1));
        assertNull(objects.get(2));

        assertEquals(3, objects.size());
    }
}",,db3d1c62fc5fb59fefcda3b86065d2d362f55164,CVE-2023-26470,db3d1c62fc5fb59fefcda3b86065d2d362f55164,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR {@VAR VAR}. * * @VAR $VAR$ */ VAR VAR VAR { VAR VAR VAR VAR VAR VAR { @VAR VAR VAR VAR() { VAR VAR.VAR(VAR()); } } VAR VAR VAR VAR VAR = VAR VAR(); VAR VAR VAR VAR VAR = VAR VAR(); VAR VAR VAR VAR VAR = VAR VAR(); VAR VAR VAR VAR VAR = VAR VAR(); @VAR VAR VAR() { VAR VAR = VAR VAR(); VAR(0, VAR.VAR()); VAR.VAR(VAR); VAR(1, VAR.VAR()); VAR.VAR(VAR); VAR(2, VAR.VAR()); VAR.VAR(VAR); VAR(3, VAR.VAR()); VAR(VAR, VAR.VAR(0)); VAR(0, VAR.VAR(0).VAR()); VAR(VAR.VAR(1)); VAR(VAR, VAR.VAR(2)); VAR(2, VAR.VAR(2).VAR()); VAR.VAR(1, VAR); VAR(4, VAR.VAR()); VAR(VAR, VAR.VAR(0)); VAR(0, VAR.VAR(0).VAR()); VAR(VAR, VAR.VAR(1)); VAR(1, VAR.VAR(1).VAR()); VAR(VAR.VAR(2)); VAR(VAR, VAR.VAR(3)); VAR(3, VAR.VAR(3).VAR()); VAR(VAR.VAR, () -> VAR.VAR(VAR.VAR, VAR)); } @VAR VAR VAR() { VAR VAR = VAR VAR(); VAR(0, VAR.VAR()); VAR(VAR.VAR, () -> VAR.VAR(0, VAR)); VAR.VAR(VAR); VAR.VAR(VAR); VAR.VAR(VAR); VAR.VAR(1, VAR); VAR(VAR, VAR.VAR(0)); VAR(VAR, VAR.VAR(1)); VAR(VAR, VAR.VAR(2)); } @VAR VAR VAR() { VAR VAR = VAR VAR(VAR.VAR(VAR, VAR, VAR)); VAR(3, VAR.VAR()); VAR.VAR(0); VAR.VAR(2); VAR(VAR.VAR(0)); VAR(VAR, VAR.VAR(1)); VAR(VAR.VAR(2)); VAR(3, VAR.VAR()); } } ",5,8
xwiki-platform_df596f15368342236f8899ca122af8f3df0fe2e8,xwiki-platform-core/xwiki-platform-wiki/xwiki-platform-wiki-script/src/test/java/org/xwiki/wiki/script/WikiManagerScriptServiceComponentList.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.wiki.script;

import java.lang.annotation.Documented;
import java.lang.annotation.Inherited;
import java.lang.annotation.Retention;
import java.lang.annotation.Target;

import org.xwiki.test.annotation.ComponentList;
import org.xwiki.url.internal.standard.DefaultStandardURLConfiguration;
import org.xwiki.wiki.internal.configuration.DefaultWikiConfiguration;
import org.xwiki.wiki.internal.descriptor.builder.DefaultWikiDescriptorBuilder;
import org.xwiki.wiki.internal.descriptor.document.DefaultWikiDescriptorDocumentHelper;
import org.xwiki.wiki.internal.manager.DefaultWikiCreator;
import org.xwiki.wiki.internal.manager.DefaultWikiDeleter;
import org.xwiki.wiki.internal.manager.DefaultWikiManager;
import org.xwiki.wiki.internal.provisioning.DefaultWikiCopier;

import static java.lang.annotation.ElementType.ANNOTATION_TYPE;
import static java.lang.annotation.ElementType.METHOD;
import static java.lang.annotation.ElementType.TYPE;
import static java.lang.annotation.RetentionPolicy.RUNTIME;

/**
 * Pack of default Components that are needed for the wiki manager script service.
 *
 * @version $Id$
 * @since 14.10RC1
 */
@Documented
@Retention(RUNTIME)
@Target({ TYPE, METHOD, ANNOTATION_TYPE })
@ComponentList({
    WikiManagerScriptService.class,
    DefaultWikiManager.class,
    DefaultWikiCreator.class,
    DefaultWikiDescriptorBuilder.class,
    DefaultWikiDescriptorDocumentHelper.class,
    DefaultWikiConfiguration.class,
    DefaultWikiCopier.class,
    DefaultWikiDeleter.class,
    DefaultStandardURLConfiguration.class
})
@Inherited
public @interface WikiManagerScriptServiceComponentList
{
}",,df596f15368342236f8899ca122af8f3df0fe2e8,CVE-2023-30537,df596f15368342236f8899ca122af8f3df0fe2e8,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.10RC1 */ @VAR @VAR(VAR) @VAR({ VAR, VAR, VAR }) @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) @VAR VAR @VAR VAR { } ",5,8
xwiki-platform_e4bbdc23fea0be4ef1921d1a58648028ce753344,xwiki-platform-core/xwiki-platform-wexwiki-platform-web-templates/src/test/java/org/xwiki/weImportInlinePageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.web;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.util.List;
import java.util.Locale;
import java.util.stream.Collectors;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.reference.LocalDocumentReference;
import org.xwiki.model.script.ModelScriptService;
import org.xwiki.script.service.ScriptService;
import org.xwiki.skinx.internal.async.SkinExtensionAsync;
import org.xwiki.template.TemplateManager;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.xar.XarEntry;
import org.xwiki.xar.XarPackage;
import org.xwiki.xar.script.XarScriptService;

import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.plugin.XWikiPluginManager;
import com.xpn.xwiki.plugin.skinx.CssSkinFileExtensionPlugin;
import com.xpn.xwiki.plugin.skinx.JsSkinFileExtensionPlugin;

import static java.util.Collections.singletonList;
import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.containsInAnyOrder;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.Mockito.when;

/**
 * Test of template {@code importinline.vm}.
 *
 * @version $Id$
 * @since 15.0-rc-1
 * @since 14.10.1
 * @since 14.4.8
 * @since 13.10.11
 */
@ComponentList({
    SkinExtensionAsync.class,
    ModelScriptService.class
})
class ImportInlinePageTest extends PageTest
{
    private TemplateManager templateManager;

    @Mock
    private XarScriptService xarScriptService;

    @BeforeEach
    void setUp() throws Exception
    {
        this.templateManager = this.oldcore.getMocker().getInstance(TemplateManager.class);
        // Enable the ssfx/jsfx plugins.
        XWikiPluginManager pluginManager = this.oldcore.getSpyXWiki().getPluginManager();
        pluginManager.addPlugin(""ssfx"", CssSkinFileExtensionPlugin.class.getName(), this.context);
        pluginManager.addPlugin(""jsfx"", JsSkinFileExtensionPlugin.class.getName(), this.context);
        // Initialize XWiki.XWikiPreferences
        XWikiDocument xWikiPreferencesDocument =
            this.xwiki.getDocument(new DocumentReference(""xwiki"", ""XWiki"", ""XWikiPreferences""), this.context);
        this.xwiki.saveDocument(xWikiPreferencesDocument, this.context);
        // Initialize the current document
        XWikiDocument currentDocument = this.xwiki.getDocument(new DocumentReference(""xwiki"", ""Doc"", ""Space""
            + ""\""'/><script>console.log('docTitle'</script>{{html}}{{noscript/}}""), this.context);
        currentDocument.setAttachment(""attachment.xar"", new ByteArrayInputStream(""xar content"".getBytes()),
            this.context);
        currentDocument.setAttachment(""\""'/><script>console.log('secondAttachment')</script>{{/html}}{{noscript/}}"",
            new ByteArrayInputStream(""file content"".getBytes()), this.context);
        this.xwiki.saveDocument(currentDocument, this.context);
        this.context.setDoc(currentDocument);
        this.componentManager.registerComponent(ScriptService.class, ""xar"", this.xarScriptService);
    }

    @Test
    void escape() throws Exception
    {
        String packageAuthor = ""\""'><script>console.log('package author');</script>{{/html}}{{noscript/}}"";
        String packageName = ""\""'><script>console.log('package name');</script>{{/html}}{{noscript/}}"";
        String packageLicense = ""\""'><script>console.log('package licence');</script>{{/html}}{{noscript/}}"";
        String spaceName = ""\""'><script>console.log('space name');</script>{{/html}}{{noscript/}}"";
        String pageName = ""\""'><script>console.log('page name');</script>{{/html}}{{noscript/}}"";
        LocalDocumentReference reference = new LocalDocumentReference(spaceName, pageName, Locale.FRANCE);
        XarEntry xarEntry = new XarEntry(reference);

        XarPackage xarPackage = new XarPackage(singletonList(xarEntry));
        xarPackage.setPackageAuthor(packageAuthor);
        xarPackage.setPackageName(packageName);
        xarPackage.setPackageDescription(""packageDescription"");
        xarPackage.setPackageLicense(packageLicense);
        xarPackage.setPackageExtensionId(""packageExtensionId"");

        when(this.xarScriptService.getXarPackage(any(InputStream.class), anyBoolean())).thenReturn(xarPackage);
        this.request.put(""file"", ""attachment.xar"");
        Document document = Jsoup.parse(this.templateManager.render(""importinline.vm""));

        assertEquals(""/xwiki/bin/upload/Doc/Space%22%27%2F%3E%3Cscript%3Econsole.log%28%27docTitle""
                + ""%27%3C%2Fscript%3E%7B%7Bhtml%7D%7D%7B%7Bnoscript%2F%7D%7D"",
            document.selectFirst(""form"").attr(""action""));
        Element packageinfos = document.selectFirst("".packageinfos"");
        assertEquals(packageAuthor, packageinfos.selectFirst("".author"").text());
        assertEquals(packageName, packageinfos.selectFirst("".name"").text());
        assertEquals(packageLicense, packageinfos.selectFirst("".licence"").text());
        Element packageDiv = document.getElementById(""package"");
        assertEquals(spaceName, packageDiv.selectFirst("".spacename"").text());
        Element xitemLi = packageDiv.selectFirst("".xitem"");
        assertEquals(""\""'><script>console\\.log('space name');</script>{{/html}}{{noscript/}}.\""'>""
                + ""<script>console\\.log('page name');</script>{{/html}}{{noscript/}}:fr_FR"",
            xitemLi.selectFirst(""input[type='hidden']"").attr(""name""));
        assertEquals(""\""'><script>console.log('space name');</script>{{/html}}{{noscript/}} \""'>""
            + ""<script>console.log('page name');</script>{{/html}}{{noscript/}} - fr_FR"", xitemLi.text());
        List<String> attachmentLinksText =
            document.select(""#packagelistcontainer .xitemcontainer.package .name>a"")
                .stream()
                .map(Element::text)
                .collect(Collectors.toList());
        assertThat(attachmentLinksText,
            containsInAnyOrder(""><script>console.log('secondAttachment')</script>{{/html}}{{noscript/}}"",
                ""attachment.xar""));
    }
}",,e4bbdc23fea0be4ef1921d1a58648028ce753344,CVE-2023-29512,e4bbdc23fea0be4ef1921d1a58648028ce753344,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0-VAR-1 * @VAR 14.10.1 * @VAR 14.4.8 * @VAR 13.10.11 */ @VAR({ VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR.VAR = VAR.VAR.VAR().VAR(VAR.VAR);  VAR VAR = VAR.VAR.VAR().VAR(); VAR.VAR(""VAR"", VAR.VAR.VAR(), VAR.VAR); VAR.VAR(""VAR"", VAR.VAR.VAR(), VAR.VAR);  VAR VAR = VAR.VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR);  VAR VAR = VAR.VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"" + ""\""'/><VAR>VAR.VAR('VAR'</VAR>{{VAR}}{{VAR/}}""), VAR.VAR); VAR.VAR(""VAR.VAR"", VAR VAR(""VAR VAR"".VAR()), VAR.VAR); VAR.VAR(""\""'/><VAR>VAR.VAR('VAR')</VAR>{{/VAR}}{{VAR/}}"", VAR VAR(""VAR VAR"".VAR()), VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR.VAR(VAR); VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = ""\""'><VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = ""\""'><VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = ""\""'><VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = ""\""'><VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = ""\""'><VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = VAR VAR(VAR, VAR, VAR.VAR); VAR VAR = VAR VAR(VAR); VAR VAR = VAR VAR(VAR(VAR)); VAR.VAR(VAR); VAR.VAR(VAR); VAR.VAR(""VAR""); VAR.VAR(VAR); VAR.VAR(""VAR""); VAR(VAR.VAR.VAR(VAR(VAR.VAR), VAR())).VAR(VAR); VAR.VAR.VAR(""VAR"", ""VAR.VAR""); VAR VAR = VAR.VAR(VAR.VAR.VAR(""VAR.VAR"")); VAR(""/VAR/VAR/VAR/VAR/VAR%22%27%2F%3E%3Cscript%3Econsole.VAR%28%27docTitle"" + ""%27%3C%2Fscript%3E%7B%7Bhtml%7D%7D%7B%7Bnoscript%2F%7D%7D"", VAR.VAR(""VAR"").VAR(""VAR"")); VAR VAR = VAR.VAR("".VAR""); VAR(VAR, VAR.VAR("".VAR"").VAR()); VAR(VAR, VAR.VAR("".VAR"").VAR()); VAR(VAR, VAR.VAR("".VAR"").VAR()); VAR VAR = VAR.VAR(""VAR""); VAR(VAR, VAR.VAR("".VAR"").VAR()); VAR VAR = VAR.VAR("".VAR""); VAR(""\""'><VAR>VAR\\.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}.\""'>"" + ""<VAR>VAR\\.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}}:VAR"", VAR.VAR(""VAR[VAR='VAR']"").VAR(""VAR"")); VAR(""\""'><VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}} \""'>"" + ""<VAR>VAR.VAR('VAR VAR');</VAR>{{/VAR}}{{VAR/}} - VAR"", VAR.VAR()); VAR<VAR> VAR = VAR.VAR("" .VAR() .VAR(VAR::VAR) .VAR(VAR.VAR()); VAR(VAR, VAR(""><VAR>VAR.VAR('VAR')</VAR>{{/VAR}}{{VAR/}}"", ""VAR.VAR"")); } } ",12,8
xwiki-platform_e4f7f68e93cb08c25632c126356d218abf192d1e,xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/weXWikiServletResponseTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.web;

import java.io.IOException;
import java.net.URL;

import javax.servlet.http.HttpServletResponse;

import org.apache.ecs.wml.U;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.component.manager.ComponentManager;
import org.xwiki.test.annotation.BeforeComponent;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.test.mockito.MockitoComponentManager;
import org.xwiki.url.URLSecurityManager;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Tests for {@link XWikiServletResponse}.
 *
 * @version $Id$
 */
@ComponentTest
class XWikiServletResponseTest
{
    @MockComponent
    private URLSecurityManager urlSecurityManager;

    private XWikiServletResponse servletResponse;
    private HttpServletResponse httpServletResponse;

    @BeforeComponent
    void beforeComponent(MockitoComponentManager mockitoComponentManager) throws Exception
    {
        mockitoComponentManager.registerComponent(ComponentManager.class, ""context"", mockitoComponentManager);
        Utils.setComponentManager(mockitoComponentManager);
    }

    @BeforeEach
    void setup()
    {
        this.httpServletResponse = mock(HttpServletResponse.class);
        this.servletResponse = new XWikiServletResponse(this.httpServletResponse);
    }

    @Test
    void sendRedirect() throws IOException
    {
        this.servletResponse.sendRedirect("""");
        verify(this.httpServletResponse, never()).sendRedirect(any());

        this.servletResponse.sendRedirect(""/xwiki/\n/something/"");
        verify(this.httpServletResponse, never()).sendRedirect(any());

        this.servletResponse.sendRedirect(""//xwiki.org/xwiki/something/"");
        verify(this.httpServletResponse, never()).sendRedirect(any());

        String redirect = ""http://xwiki.org/xwiki/something/"";
        URL redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        redirect = ""http:/xwiki.com/xwiki/something/"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        redirect = ""https://floo"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        redirect = ""ftp://xwiki.org/xwiki/something/"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        this.servletResponse.sendRedirect(""/xwiki/something/"");
        verify(this.httpServletResponse).sendRedirect(""/xwiki/something/"");

        redirect = ""http://xwiki.org/foo/"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(true);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse).sendRedirect(redirect);
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);
    }
}",,e4f7f68e93cb08c25632c126356d218abf192d1e,CVE-2023-29204,e4f7f68e93cb08c25632c126356d218abf192d1e,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.*; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR VAR VAR { @VAR VAR VAR VAR; VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR(VAR VAR) VAR VAR { VAR.VAR(VAR.VAR, ""VAR"", VAR); VAR.VAR(VAR); } @VAR VAR VAR() { VAR.VAR = VAR(VAR.VAR); VAR.VAR = VAR VAR(VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""""); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR.VAR.VAR(""/VAR/\VAR/VAR/""); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR.VAR.VAR("" VAR(VAR.VAR, VAR()).VAR(VAR()); VAR VAR = ""VAR: VAR VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR = ""VAR:/VAR.VAR/VAR/VAR/""; VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR = ""VAR: VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR = ""VAR: VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR.VAR.VAR(""/VAR/VAR/""); VAR(VAR.VAR).VAR(""/VAR/VAR/""); VAR = ""VAR: VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR).VAR(VAR); VAR(VAR.VAR).VAR(VAR); } } ",5,8
xwiki-platform_e4f7f68e93cb08c25632c126356d218abf192d1e,xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/weXWikiServletResponseTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.web;

import java.io.IOException;
import java.net.URL;

import javax.servlet.http.HttpServletResponse;

import org.apache.ecs.wml.U;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.component.manager.ComponentManager;
import org.xwiki.test.annotation.BeforeComponent;
import org.xwiki.test.junit5.mockito.ComponentTest;
import org.xwiki.test.junit5.mockito.InjectMockComponents;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.test.mockito.MockitoComponentManager;
import org.xwiki.url.URLSecurityManager;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Tests for {@link XWikiServletResponse}.
 *
 * @version $Id$
 */
@ComponentTest
class XWikiServletResponseTest
{
    @MockComponent
    private URLSecurityManager urlSecurityManager;

    private XWikiServletResponse servletResponse;
    private HttpServletResponse httpServletResponse;

    @BeforeComponent
    void beforeComponent(MockitoComponentManager mockitoComponentManager) throws Exception
    {
        mockitoComponentManager.registerComponent(ComponentManager.class, ""context"", mockitoComponentManager);
        Utils.setComponentManager(mockitoComponentManager);
    }

    @BeforeEach
    void setup()
    {
        this.httpServletResponse = mock(HttpServletResponse.class);
        this.servletResponse = new XWikiServletResponse(this.httpServletResponse);
    }

    @Test
    void sendRedirect() throws IOException
    {
        this.servletResponse.sendRedirect("""");
        verify(this.httpServletResponse, never()).sendRedirect(any());

        this.servletResponse.sendRedirect(""/xwiki/\n/something/"");
        verify(this.httpServletResponse, never()).sendRedirect(any());

        this.servletResponse.sendRedirect(""//xwiki.org/xwiki/something/"");
        verify(this.httpServletResponse, never()).sendRedirect(any());

        String redirect = ""http://xwiki.org/xwiki/something/"";
        URL redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        redirect = ""http:/xwiki.com/xwiki/something/"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        redirect = ""https://floo"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        redirect = ""ftp://xwiki.org/xwiki/something/"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(false);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse, never()).sendRedirect(any());
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);

        this.servletResponse.sendRedirect(""/xwiki/something/"");
        verify(this.httpServletResponse).sendRedirect(""/xwiki/something/"");

        redirect = ""http://xwiki.org/foo/"";
        redirectUrl = new URL(redirect);
        when(this.urlSecurityManager.isDomainTrusted(redirectUrl)).thenReturn(true);
        this.servletResponse.sendRedirect(redirect);
        verify(this.httpServletResponse).sendRedirect(redirect);
        verify(this.urlSecurityManager).isDomainTrusted(redirectUrl);
    }
}",,e4f7f68e93cb08c25632c126356d218abf192d1e,CVE-2023-32068,e4f7f68e93cb08c25632c126356d218abf192d1e,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.*; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR VAR VAR { @VAR VAR VAR VAR; VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR(VAR VAR) VAR VAR { VAR.VAR(VAR.VAR, ""VAR"", VAR); VAR.VAR(VAR); } @VAR VAR VAR() { VAR.VAR = VAR(VAR.VAR); VAR.VAR = VAR VAR(VAR.VAR); } @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""""); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR.VAR.VAR(""/VAR/\VAR/VAR/""); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR.VAR.VAR("" VAR(VAR.VAR, VAR()).VAR(VAR()); VAR VAR = ""VAR: VAR VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR = ""VAR:/VAR.VAR/VAR/VAR/""; VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR = ""VAR: VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR = ""VAR: VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(VAR.VAR).VAR(VAR); VAR.VAR.VAR(""/VAR/VAR/""); VAR(VAR.VAR).VAR(""/VAR/VAR/""); VAR = ""VAR: VAR = VAR VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR.VAR.VAR(VAR); VAR(VAR.VAR).VAR(VAR); VAR(VAR.VAR).VAR(VAR); } } ",5,8
xwiki-platform_e73b890623efa604adc484ad82f37e31596fe1a6,xwiki-platform-core/xwiki-platform-appwithinminutes/xwiki-platform-appwithinminutes-test/xwiki-platform-appwithinminutes-test-docker/src/test/it/org/xwiki/appwithinminutes/test/ui/WithoutScriptRightIT.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.appwithinminutes.test.ui;

import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Order;
import org.junit.jupiter.api.Test;
import org.xwiki.appwithinminutes.test.po.AppWithinMinutesHomePage;
import org.xwiki.appwithinminutes.test.po.ApplicationClassEditPage;
import org.xwiki.appwithinminutes.test.po.ApplicationCreatePage;
import org.xwiki.appwithinminutes.test.po.ApplicationHomeEditPage;
import org.xwiki.appwithinminutes.test.po.ApplicationHomePage;
import org.xwiki.appwithinminutes.test.po.ApplicationsLiveTableElement;
import org.xwiki.appwithinminutes.test.po.EntryEditPage;
import org.xwiki.appwithinminutes.test.po.EntryNamePane;
import org.xwiki.test.docker.junit5.TestReference;
import org.xwiki.test.docker.junit5.UITest;
import org.xwiki.test.ui.TestUtils;

import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertTrue;

/**
 * Tests AWM without script right.
 *
 * @version $Id$
 * @since 13.10.11
 * @since 14.4.8
 * @since 14.10.1
 * @since 15.0RC1
 */
@UITest
class WithoutScriptRightIT
{
    private static final String USER_NAME = ""NoScript"";

    private static final String PASSWORD = ""password"";

    private static final String NO_SCRIPT_ERROR = ""You don't have the script right which is necessary to create or ""
        + ""edit an application. The application might not work correctly when you continue."";

    @BeforeAll
    static void beforeAll(TestUtils testUtils)
    {
        testUtils.loginAsSuperAdmin();
        testUtils.createUserAndLogin(USER_NAME, PASSWORD, """");
    }

    @Order(1)
    @Test
    void createApplicationWithoutScriptRight(TestReference testReference)
    {
        ApplicationCreatePage appCreatePage = AppWithinMinutesHomePage.gotoPage().clickCreateApplication();
        String appName = testReference.getLastSpaceReference().getName();
        appCreatePage.setApplicationName(appName);
        appCreatePage.waitForApplicationNamePreview();
        assertTrue(appCreatePage.getContent().contains(NO_SCRIPT_ERROR));

        ApplicationClassEditPage classEditPage = appCreatePage.clickNextStep();
        classEditPage.addField(""Short Text"");
        ApplicationHomeEditPage applicationHomeEditPage = classEditPage.clickNextStep().clickNextStep();
        assertTrue(applicationHomeEditPage.getContent().contains(NO_SCRIPT_ERROR));

        ApplicationHomePage applicationHomePage = applicationHomeEditPage.clickFinish();
        // TODO: change to assert rendering errors when https://jira.xwiki.org/browse/XWIKI-20423 has been fixed.
        assertTrue(applicationHomePage.hasEntriesLiveTable());

        EntryNamePane entryNamePane = applicationHomePage.clickAddNewEntry();
        entryNamePane.setName(""Test entry"");
        EntryEditPage editPage = entryNamePane.clickAdd();
        // The edit form doesn't work without script right.
        assertTrue(editPage.hasRenderingError());

        // Without script right, no delete is available.
        ApplicationsLiveTableElement liveTable = AppWithinMinutesHomePage.gotoPage().getAppsLiveTable();
        assertTrue(liveTable.isApplicationListed(appName));
        assertFalse(liveTable.canDeleteApplication(appName));
    }
}",,e73b890623efa604adc484ad82f37e31596fe1a6,CVE-2023-29515,e73b890623efa604adc484ad82f37e31596fe1a6,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 13.10.11 * @VAR 14.4.8 * @VAR 14.10.1 * @VAR 15.0RC1 */ @VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR VAR VAR = ""VAR""; VAR VAR VAR VAR VAR = ""VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR "" + ""VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR.""; @VAR VAR VAR VAR(VAR VAR) { VAR.VAR(); VAR.VAR(VAR, VAR, """"); } @VAR(1) @VAR VAR VAR(VAR VAR) { VAR VAR = VAR.VAR().VAR(); VAR VAR = VAR.VAR().VAR(); VAR.VAR(VAR); VAR.VAR(); VAR(VAR.VAR().VAR(VAR)); VAR VAR = VAR.VAR(); VAR.VAR(""VAR VAR""); VAR VAR = VAR.VAR().VAR(); VAR(VAR.VAR().VAR(VAR)); VAR VAR = VAR.VAR();  VAR(VAR.VAR()); VAR VAR = VAR.VAR(); VAR.VAR(""VAR VAR""); VAR VAR = VAR.VAR();  VAR(VAR.VAR());  VAR VAR = VAR.VAR().VAR(); VAR(VAR.VAR(VAR)); VAR(VAR.VAR(VAR)); } } ",5,8
xwiki-platform_ea2e615f50a918802fd60b09ec87aa04bc6ea8e2,xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-theme/xwiki-platform-flamingo-theme-ui/src/test/java/org/xwiki/flamingo/TestNoScriptMacro.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.flamingo;

import java.util.List;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.rendering.block.Block;
import org.xwiki.rendering.macro.AbstractMacro;
import org.xwiki.rendering.transformation.MacroTransformationContext;

import static java.util.Collections.emptyList;

/**
 * This script prints an error log when it is interpreted, making the test fail.
 *
 * @version $Id$
 * @since 13.10.10
 * @since 14.4.6
 * @since 14.9RC1
 */
@Component
@Named(""noscript"")
@Singleton
public class TestNoScriptMacro extends AbstractMacro<Object>
{
    @Inject
    private Logger logger;

    /**
     * Default constructor.
     */
    public TestNoScriptMacro()
    {
        super(""NoScript"", ""No Script!"");
    }

    @Override
    public boolean supportsInlineMode()
    {
        return true;
    }

    @Override
    public List<Block> execute(Object parameters, String content, MacroTransformationContext context)
    {
        this.logger.error(""SHOULD NOT BE CALLED"");
        return emptyList();
    }
}",,ea2e615f50a918802fd60b09ec87aa04bc6ea8e2,CVE-2023-26477,ea2e615f50a918802fd60b09ec87aa04bc6ea8e2,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 13.10.10 * @VAR 14.4.6 * @VAR 14.9RC1 */ @VAR @VAR(""VAR"") @VAR VAR VAR VAR VAR VAR<VAR> { @VAR VAR VAR VAR; /** * VAR VAR. */ VAR VAR() { VAR(""VAR"", ""VAR VAR!""); } @VAR VAR VAR VAR() { VAR VAR; } @VAR VAR VAR<VAR> VAR(VAR VAR, VAR VAR, VAR VAR) { VAR.VAR.VAR(""VAR VAR VAR VAR""); VAR VAR(); } } ",5,8
xwiki-platform_ea2e615f50a918802fd60b09ec87aa04bc6ea8e2,xwiki-platform-core/xwiki-platform-flamingo/xwiki-platform-flamingo-theme/xwiki-platform-flamingo-theme-ui/src/test/java/org/xwiki/flamingo/WebHomeSheetPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.flamingo;

import java.util.Locale;

import org.jsoup.nodes.Document;
import org.junit.jupiter.api.Test;
import org.xwiki.localization.Translation;
import org.xwiki.localization.TranslationBundle;
import org.xwiki.localization.TranslationBundleContext;
import org.xwiki.localization.macro.internal.TranslationMacro;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.block.WordBlock;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.message.ErrorMessageMacro;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.eq;
import static org.mockito.Mockito.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

/**
 * Test of the {@code FlamingoThemesCode.WebHomeSheet} page.
 *
 * @version $Id$
 * @since 13.10.10
 * @since 14.4.6
 * @since 14.9RC1
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    ErrorMessageMacro.class,
    TranslationMacro.class,
    TestNoScriptMacro.class,
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class
})
class WebHomeSheetPageTest extends PageTest
{
    @Test
    void createAction() throws Exception
    {
        this.request.put(""newThemeName"", ""some content\""/}}{{noscript/}}"");
        this.request.put(""form_token"", ""1"");
        this.request.put(""action"", ""create"");

        TranslationBundleContext translationBundleContext = this.componentManager
            .getInstance(TranslationBundleContext.class);
        TranslationBundle translationBundle = mock(TranslationBundle.class);
        Translation translation = mock(Translation.class);
        when(translation.getLocale()).thenReturn(Locale.ENGLISH);
        when(translation.render(any(), any())).thenAnswer(invocationOnMock -> new WordBlock(
            ""platform.flamingo.themes.home.create.csrf "" + invocationOnMock.getArgument(1)));
        when(translationBundle.getTranslation(eq(""platform.flamingo.themes.home.create.csrf""), any()))
            .thenReturn(translation);
        translationBundleContext.addBundle(translationBundle);

        Document document = this.renderHTMLPage(new DocumentReference(""xwiki"", ""FlamingoThemesCode"", ""WebHomeSheet""));

        assertEquals(""platform.flamingo.themes.home.create.csrf some content\""/}}{{noscript/}}"",
            document.select("".box.errormessage"").text());
    }
}",,ea2e615f50a918802fd60b09ec87aa04bc6ea8e2,CVE-2023-26477,ea2e615f50a918802fd60b09ec87aa04bc6ea8e2,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR} VAR. * * @VAR $VAR$ * @VAR 13.10.10 * @VAR 14.4.6 * @VAR 14.9RC1 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""VAR VAR\""/}}{{VAR/}}""); VAR.VAR.VAR(""VAR"", ""1""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR.VAR .VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR()).VAR(VAR.VAR); VAR(VAR.VAR(VAR(), VAR())).VAR(VAR -> VAR VAR( ""VAR.VAR.VAR.VAR.VAR.VAR "" + VAR.VAR(1))); VAR(VAR.VAR(VAR(""VAR.VAR.VAR.VAR.VAR.VAR""), VAR())) .VAR(VAR); VAR.VAR(VAR); VAR VAR = VAR.VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(""VAR.VAR.VAR.VAR.VAR.VAR VAR VAR\""/}}{{VAR/}}"", VAR.VAR("".VAR.VAR"").VAR()); } } ",5,8
xwiki-platform_eb15147adf94bddb92626f862c1710d45bcd64a7,xwiki-platform-core/xwiki-platform-attachment/xwiki-platform-attachment-ui/src/test/java/org/xwiki/attachment/AttachmentSelectorPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.attachment;

import java.io.IOException;
import java.nio.charset.Charset;
import java.util.stream.Stream;

import org.apache.commons.io.IOUtils;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.MethodSource;
import org.junit.jupiter.params.provider.ValueSource;
import org.xwiki.bridge.event.DocumentCreatedEvent;
import org.xwiki.component.manager.ComponentManager;
import org.xwiki.component.wiki.internal.bridge.DefaultContentParser;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.script.ModelScriptService;
import org.xwiki.observation.EventListener;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.rendering.internal.macro.wikibridge.DefaultWikiMacroManager;
import org.xwiki.rendering.internal.macro.wikibridge.WikiMacroEventListener;
import org.xwiki.rendering.internal.syntax.SyntaxConverter;
import org.xwiki.rendering.script.RenderingScriptService;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.rendering.wikimacro.internal.DefaultWikiMacroFactory;
import org.xwiki.rendering.wikimacro.internal.DefaultWikiMacroRenderer;
import org.xwiki.security.authorization.AuthorizationManager;
import org.xwiki.security.authorization.Right;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.xml.internal.html.filter.ControlCharactersFilter;

import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.objects.BaseObject;
import com.xpn.xwiki.objects.classes.BaseClass;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.params.provider.Arguments.arguments;
import static org.mockito.Mockito.when;

/**
 * Test of {@code XWiki.AttachmentSelector}.
 *
 * @version $Id$
 * @since 14.5RC1
 * @since 14.4.2
 * @since 13.10.7
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@ComponentList({
    // Start RenderingScriptService
    RenderingScriptService.class,
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class,
    SyntaxConverter.class,
    // End RenderingScriptService
    ControlCharactersFilter.class,
    ModelScriptService.class,
    TestNoScriptMacro.class,
    // Start WikiMacroEventListener
    WikiMacroEventListener.class,
    DefaultWikiMacroFactory.class,
    DefaultWikiMacroManager.class,
    DefaultContentParser.class,
    org.xwiki.rendering.internal.parser.DefaultContentParser.class,
    DefaultWikiMacroRenderer.class
    // End WikiMacroEventListener
})
class AttachmentSelectorPageTest extends PageTest
{
    @ParameterizedTest
    @ValueSource(strings = {
        ""{{noscript}}println(\""Hello from noscript!\""){{/noscript}}.png"",
        ""]] {{noscript}}println(\""Hello from noscript!\""){{/noscript}}.png""
    })
    void renderDisplayImageFalse(String fileName) throws Exception
    {
        commonFixup(fileName);

        this.request.put(""docname"", ""xwiki:Space.Test"");
        this.request.put(""classname"", ""xwiki:Space.Test"");
        this.request.put(""property"", ""avatar"");
        this.request.put(""object"", ""0"");
        this.request.put(""filter"", ""png"");
        this.request.put(""displayImage"", ""false"");
        this.request.put(""xpage"", ""plain"");

        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""XWiki"", ""AttachmentSelector""));

        assertNotNull(document);
        Element galleryAttachmentTitle = document.select("".gallery_attachmenttitle"").get(1);
        assertEquals(fileName, galleryAttachmentTitle.attr(""title""));
        assertEquals(fileName, galleryAttachmentTitle.text());
        assertEquals(fileName, document.select("".gallery_attachmentframe .filename"").text());
        assertEquals(String.format(""attach:xwiki:Space.Test@%s"", fileName),
            document.select("".gallery_attachmentframe a"").attr(""href""));
    }

    @ParameterizedTest
    @ValueSource(strings = {
        ""{{noscript}}println(\""Hello from noscript!\""){{/noscript}}.png"",
        ""]] {{noscript}}println(\""Hello from noscript!\""){{/noscript}}.png""
    })
    void renderDisplayImageTrue(String fileName) throws Exception
    {
        commonFixup(fileName);

        this.request.put(""docname"", ""xwiki:Space.Test"");
        this.request.put(""classname"", ""xwiki:Space.Test"");
        this.request.put(""property"", ""avatar"");
        this.request.put(""object"", ""0"");
        this.request.put(""filter"", ""png"");
        this.request.put(""displayImage"", ""true"");
        this.request.put(""xpage"", ""plain"");

        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""XWiki"", ""AttachmentSelector""));
        assertNotNull(document);
        Element galleryAttachmentTitle = document.select("".gallery_attachmenttitle"").get(1);
        assertEquals(fileName, galleryAttachmentTitle.attr(""title""));
        assertEquals(fileName, galleryAttachmentTitle.text());
        assertEquals(String.format(""attach:xwiki:Space.Test@%s"", fileName),
            document.select("".gallery_attachmentframe a"").attr(""href""));

        Elements img = document.select("".gallery_attachmentframe img"");
        assertEquals(String.format(""xwiki:Space.Test@%s"", fileName), img.attr(""src""));
        assertEquals(String.format(""xwiki:Space.Test@%s"", fileName), img.attr(""alt""));
    }

    @ParameterizedTest
    @MethodSource(""attachmentSelectorMacroSource"")
    void attachmentSelectorMacroWidth(String widthValue, String expectedWidth) throws Exception
    {
        attachmentSelectorMacroFixup();

        XWikiDocument xwikiDocument = commonFixup(""test.png"");

        xwikiDocument.setContent(String.format(""{{attachmentSelector ""
            + ""classname=\""Space.Test\"" ""
            + ""property=\""avatar\"" ""
            + ""savemode=\""direct\"" ""
            + ""width=\""%s\"" ""
            + ""displayImage=\""true\""/}}"", widthValue));

        Document document = renderHTMLPage(xwikiDocument);
        assertEquals(expectedWidth, document.select("".displayed img"").attr(""width""));
    }

    @ParameterizedTest
    @MethodSource(""attachmentSelectorMacroSource"")
    void attachmentSelectorMacroHeight(String widthValue, String expectedWidth) throws Exception
    {
        attachmentSelectorMacroFixup();

        XWikiDocument xwikiDocument = commonFixup(""test.png"");

        xwikiDocument.setContent(String.format(""{{attachmentSelector ""
            + ""classname=\""Space.Test\"" ""
            + ""property=\""avatar\"" ""
            + ""savemode=\""direct\"" ""
            + ""height=\""%s\"" ""
            + ""displayImage=\""true\""/}}"", widthValue));
        Document document = renderHTMLPage(xwikiDocument);
        assertEquals(expectedWidth, document.select("".displayed img"").attr(""height""));
    }

    @ParameterizedTest
    @MethodSource(""attachmentSelectorMacroSource"")
    void attachmentSelectorMacroAlternateText(String widthValue, String expectedWidth) throws Exception
    {
        attachmentSelectorMacroFixup();

        XWikiDocument xwikiDocument = commonFixup(""test.png"");

        xwikiDocument.setContent(String.format(""{{attachmentSelector ""
            + ""classname=\""Space.Test\"" ""
            + ""property=\""avatar\"" ""
            + ""savemode=\""direct\"" ""
            + ""alternateText=\""%s\"" ""
            + ""displayImage=\""true\""/}}"", widthValue));
        xwikiDocument.setSyntax(Syntax.XWIKI_2_1);
        Document document = renderHTMLPage(xwikiDocument);
        assertEquals(expectedWidth, document.select("".displayed img"").attr(""alt""));
    }

    @ParameterizedTest
    @MethodSource(""attachmentSelectorMacroSource"")
    void attachmentSelectorMacroWidthWithLink(String widthValue, String expectedWidth) throws Exception
    {
        attachmentSelectorMacroFixup();

        XWikiDocument xwikiDocument = commonFixup(""test.png"");

        xwikiDocument.setContent(String.format(""{{attachmentSelector ""
            + ""classname=\""Space.Test\"" ""
            + ""property=\""avatar\"" ""
            + ""savemode=\""direct\"" ""
            + ""width=\""%s\"" ""
            + ""link=\""true\"" ""
            + ""displayImage=\""true\""/}}"", widthValue));

        Document document = renderHTMLPage(xwikiDocument);
        assertEquals(expectedWidth, document.select("".displayed img"").attr(""width""));
    }

    @ParameterizedTest
    @MethodSource(""attachmentSelectorMacroSource"")
    void attachmentSelectorMacroHeightWithLink(String widthValue, String expectedWidth) throws Exception
    {
        attachmentSelectorMacroFixup();

        XWikiDocument xwikiDocument = commonFixup(""test.png"");

        xwikiDocument.setContent(String.format(""{{attachmentSelector ""
            + ""classname=\""Space.Test\"" ""
            + ""property=\""avatar\"" ""
            + ""savemode=\""direct\"" ""
            + ""height=\""%s\"" ""
            + ""link=\""true\"" ""
            + ""displayImage=\""true\""/}}"", widthValue));
        Document document = renderHTMLPage(xwikiDocument);
        assertEquals(expectedWidth, document.select("".displayed img"").attr(""height""));
    }

    @ParameterizedTest
    @MethodSource(""attachmentSelectorMacroSource"")
    void attachmentSelectorMacroAlternateTextWithLink(String widthValue, String expectedWidth) throws Exception
    {
        attachmentSelectorMacroFixup();

        XWikiDocument xwikiDocument = commonFixup(""test.png"");

        xwikiDocument.setContent(String.format(""{{attachmentSelector ""
            + ""classname=\""Space.Test\"" ""
            + ""property=\""avatar\"" ""
            + ""savemode=\""direct\"" ""
            + ""alternateText=\""%s\"" ""
            + ""link=\""true\"" ""
            + ""displayImage=\""true\""/}}"", widthValue));
        xwikiDocument.setSyntax(Syntax.XWIKI_2_1);
        Document document = renderHTMLPage(xwikiDocument);
        assertEquals(expectedWidth, document.select("".displayed img"").attr(""alt""));
    }

    private void attachmentSelectorMacroFixup() throws Exception
    {
        DocumentReference attachmentSelectorDocumentReference =
            new DocumentReference(""xwiki"", ""XWiki"", ""AttachmentSelector"");
        XWikiDocument xWikiDocument = loadPage(attachmentSelectorDocumentReference);

        // TODO: The code below is more generic than this test and should be moved to be reusable.
        // Make the wiki component manager point to the default component manager.
        this.componentManager.registerComponent(ComponentManager.class, ""wiki"",
            this.componentManager.getInstance(ComponentManager.class));
        when(this.componentManager.<AuthorizationManager>getInstance(AuthorizationManager.class)
            .hasAccess(Right.ADMIN, new DocumentReference(""xwiki"", ""XWiki"", ""Admin""),
                xWikiDocument.getDocumentReference().getWikiReference())).thenReturn(true);
        // Simulate the event not thrown by page test for now.
        this.componentManager.<EventListener>getInstance(EventListener.class, ""wikimacrolistener"")
            .onEvent(new DocumentCreatedEvent(), xWikiDocument, null);
    }

    private XWikiDocument commonFixup(String fileName) throws XWikiException, IOException
    {
        // Initialize a document containing an XClass definition and an XObject of this XClass.
        // The interesting property is the avatar string field, which references the name of an attachment contained in
        // the document itself too.
        DocumentReference documentReference = new DocumentReference(""xwiki"", ""Space"", ""Test"");
        XWikiDocument xwikiDocument = this.xwiki.getDocument(documentReference, this.context);
        BaseClass xClass = xwikiDocument.getXClass();
        xClass.addTextField(""avatar"", ""Avatar"", 10);
        BaseObject baseObject = xwikiDocument.newXObject(xwikiDocument.getDocumentReference(), this.context);
        baseObject.setStringValue(""avatar"", fileName);
        // Simulates the file rename action.
        xwikiDocument.setAttachment(""tmp.png"", IOUtils.toInputStream("""", Charset.defaultCharset()), this.context);
        xwikiDocument.getAttachment(""tmp.png"").setFilename(fileName);
        xwikiDocument.setSyntax(Syntax.XWIKI_2_1);

        this.xwiki.saveDocument(xwikiDocument, this.context);

        this.context.setDoc(xwikiDocument);

        return xwikiDocument;
    }

    public static Stream<Arguments> attachmentSelectorMacroSource()
    {
        return Stream.of(
            arguments(""{{noscript /~}~}"", ""{{noscript /}}""),
            arguments(""]] {{noscript /~}~}"", ""]] {{noscript /}}""),
            arguments(""]] {{noscript /~}~} [["", ""]] {{noscript /}} [["")
        );
    }
}",,eb15147adf94bddb92626f862c1710d45bcd64a7,CVE-2022-41928,eb15147adf94bddb92626f862c1710d45bcd64a7,https://github.com/xwiki/xwiki-platform,NVD_GIT_REPOBASED,78,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 14.5RC1 * @VAR 14.4.2 * @VAR 13.10.7 */ @VAR @VAR @VAR({  VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR, VAR.VAR,  VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR.VAR.VAR.VAR.VAR.VAR, VAR.VAR  }) VAR VAR VAR VAR { @VAR @VAR(VAR = { ""{{VAR}}VAR(\""VAR VAR VAR!\""){{/VAR}}.VAR"", ""]] {{VAR}}VAR(\""VAR VAR VAR!\""){{/VAR}}.VAR"" }) VAR VAR(VAR VAR) VAR VAR { VAR(VAR); VAR.VAR.VAR(""VAR"", ""VAR:VAR.VAR""); VAR.VAR.VAR(""VAR"", ""VAR:VAR.VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""0""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(VAR); VAR VAR = VAR.VAR("".VAR"").VAR(1); VAR(VAR, VAR.VAR(""VAR"")); VAR(VAR, VAR.VAR()); VAR(VAR, VAR.VAR("".VAR .VAR"").VAR()); VAR(VAR.VAR(""VAR:VAR:VAR.VAR@%VAR"", VAR), VAR.VAR("".VAR VAR"").VAR(""VAR"")); } @VAR @VAR(VAR = { ""{{VAR}}VAR(\""VAR VAR VAR!\""){{/VAR}}.VAR"", ""]] {{VAR}}VAR(\""VAR VAR VAR!\""){{/VAR}}.VAR"" }) VAR VAR(VAR VAR) VAR VAR { VAR(VAR); VAR.VAR.VAR(""VAR"", ""VAR:VAR.VAR""); VAR.VAR.VAR(""VAR"", ""VAR:VAR.VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""0""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR(VAR); VAR VAR = VAR.VAR("".VAR"").VAR(1); VAR(VAR, VAR.VAR(""VAR"")); VAR(VAR, VAR.VAR()); VAR(VAR.VAR(""VAR:VAR:VAR.VAR@%VAR"", VAR), VAR.VAR("".VAR VAR"").VAR(""VAR"")); VAR VAR = VAR.VAR("".VAR VAR""); VAR(VAR.VAR(""VAR:VAR.VAR@%VAR"", VAR), VAR.VAR(""VAR"")); VAR(VAR.VAR(""VAR:VAR.VAR@%VAR"", VAR), VAR.VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR(); VAR VAR = VAR(""VAR.VAR""); VAR.VAR(VAR.VAR(""{{VAR "" + ""VAR=\""VAR.VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""%VAR\"" "" + ""VAR=\""VAR\""/}}"", VAR)); VAR VAR = VAR(VAR); VAR(VAR, VAR.VAR("".VAR VAR"").VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR(); VAR VAR = VAR(""VAR.VAR""); VAR.VAR(VAR.VAR(""{{VAR "" + ""VAR=\""VAR.VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""%VAR\"" "" + ""VAR=\""VAR\""/}}"", VAR)); VAR VAR = VAR(VAR); VAR(VAR, VAR.VAR("".VAR VAR"").VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR(); VAR VAR = VAR(""VAR.VAR""); VAR.VAR(VAR.VAR(""{{VAR "" + ""VAR=\""VAR.VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""%VAR\"" "" + ""VAR=\""VAR\""/}}"", VAR)); VAR.VAR(VAR.VAR); VAR VAR = VAR(VAR); VAR(VAR, VAR.VAR("".VAR VAR"").VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR(); VAR VAR = VAR(""VAR.VAR""); VAR.VAR(VAR.VAR(""{{VAR "" + ""VAR=\""VAR.VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""%VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\""/}}"", VAR)); VAR VAR = VAR(VAR); VAR(VAR, VAR.VAR("".VAR VAR"").VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR(); VAR VAR = VAR(""VAR.VAR""); VAR.VAR(VAR.VAR(""{{VAR "" + ""VAR=\""VAR.VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""%VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\""/}}"", VAR)); VAR VAR = VAR(VAR); VAR(VAR, VAR.VAR("".VAR VAR"").VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR(); VAR VAR = VAR(""VAR.VAR""); VAR.VAR(VAR.VAR(""{{VAR "" + ""VAR=\""VAR.VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""%VAR\"" "" + ""VAR=\""VAR\"" "" + ""VAR=\""VAR\""/}}"", VAR)); VAR.VAR(VAR.VAR); VAR VAR = VAR(VAR); VAR(VAR, VAR.VAR("".VAR VAR"").VAR(""VAR"")); } VAR VAR VAR() VAR VAR { VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR = VAR(VAR);   VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR.VAR(VAR.VAR)); VAR(VAR.VAR.<VAR>VAR(VAR.VAR) .VAR(VAR.VAR, VAR VAR(""VAR"", ""VAR"", ""VAR""), VAR.VAR().VAR())).VAR(VAR);  VAR.VAR.<VAR>VAR(VAR.VAR, ""VAR"") .VAR(VAR VAR(), VAR, VAR); } VAR VAR VAR(VAR VAR) VAR VAR, VAR {    VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR = VAR.VAR.VAR(VAR, VAR.VAR); VAR VAR = VAR.VAR(); VAR.VAR(""VAR"", ""VAR"", 10); VAR VAR = VAR.VAR(VAR.VAR(), VAR.VAR); VAR.VAR(""VAR"", VAR);  VAR.VAR(""VAR.VAR"", VAR.VAR("""", VAR.VAR()), VAR.VAR); VAR.VAR(""VAR.VAR"").VAR(VAR); VAR.VAR(VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR.VAR(VAR); VAR VAR; } VAR VAR VAR<VAR> VAR() { VAR VAR.VAR( VAR(""{{VAR /~}~}"", ""{{VAR /}}""), VAR(""]] {{VAR /~}~}"", ""]] {{VAR /}}""), VAR(""]] {{VAR /~}~} [["", ""]] {{VAR /}} [["") ); } } ",5,8
xwiki-platform_eb15147adf94bddb92626f862c1710d45bcd64a7,xwiki-platform-core/xwiki-platform-attachment/xwiki-platform-attachment-ui/src/test/java/org/xwiki/attachment/TestNoScriptMacro.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.attachment;

import java.util.List;

import javax.inject.Inject;
import javax.inject.Named;
import javax.inject.Singleton;

import org.slf4j.Logger;
import org.xwiki.component.annotation.Component;
import org.xwiki.rendering.block.Block;
import org.xwiki.rendering.macro.AbstractMacro;
import org.xwiki.rendering.transformation.MacroTransformationContext;

import static java.util.Collections.emptyList;

/**
 * This script prints an error log when it is interpreted, making the test fail.
 *
 * @version $Id$
 * @since 14.5RC1
 * @since 14.4.2
 * @since 13.10.7
 */
@Component
@Named(""noscript"")
@Singleton
public class TestNoScriptMacro extends AbstractMacro<Object>
{
    @Inject
    private Logger logger;

    /**
     * Default constructor.
     */
    public TestNoScriptMacro()
    {
        super(""NoScript"", ""No Script!"");
    }

    @Override
    public boolean supportsInlineMode()
    {
        return true;
    }

    @Override
    public List<Block> execute(Object parameters, String content, MacroTransformationContext context)
    {
        this.logger.error(""SHOULD NOT BE CALLED"");
        return emptyList();
    }
}",,eb15147adf94bddb92626f862c1710d45bcd64a7,CVE-2022-41928,eb15147adf94bddb92626f862c1710d45bcd64a7,https://github.com/xwiki/xwiki-platform,NVD_GIT_REPOBASED,78,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR. * * @VAR $VAR$ * @VAR 14.5RC1 * @VAR 14.4.2 * @VAR 13.10.7 */ @VAR @VAR(""VAR"") @VAR VAR VAR VAR VAR VAR<VAR> { @VAR VAR VAR VAR; /** * VAR VAR. */ VAR VAR() { VAR(""VAR"", ""VAR VAR!""); } @VAR VAR VAR VAR() { VAR VAR; } @VAR VAR VAR<VAR> VAR(VAR VAR, VAR VAR, VAR VAR) { VAR.VAR.VAR(""VAR VAR VAR VAR""); VAR VAR(); } } ",5,8
xwiki-platform_edc52579eeaab1b4514785c134044671a1ecd839,xwiki-platform-core/xwiki-platform-oldcore/src/test/java/com/xpn/xwiki/objects/classes/TextAreaClassTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.objects.classes;

import javax.inject.Provider;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.RegisterExtension;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;
import org.xwiki.model.document.DocumentAuthors;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.security.authorization.Right;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.junit5.LogCaptureExtension;
import org.xwiki.test.junit5.mockito.MockComponent;
import org.xwiki.user.GuestUserReference;
import org.xwiki.user.SuperAdminUserReference;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.internal.render.OldRendering;
import com.xpn.xwiki.internal.security.authorization.DefaultAuthorExecutor;
import com.xpn.xwiki.internal.velocity.VelocityEvaluator;
import com.xpn.xwiki.objects.BaseObject;
import com.xpn.xwiki.test.MockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.InjectMockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.ArgumentMatchers.anyBoolean;
import static org.mockito.ArgumentMatchers.anyString;
import static org.mockito.ArgumentMatchers.same;
import static org.mockito.Mockito.doAnswer;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.spy;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Unit tests for the {@link TextAreaClass} class.
 *
 * @version $Id$
 */
@OldcoreTest
@ComponentList({ DefaultAuthorExecutor.class })
class TextAreaClassTest
{
    private static final String PROPERTY_NAME = ""test"";

    @InjectMockitoOldcore
    private MockitoOldcore oldcore;

    @MockComponent
    private Provider<OldRendering> oldRenderingProvider;

    @MockComponent
    private VelocityEvaluator velocityEvaluator;

    @RegisterExtension
    private final LogCaptureExtension logCaptureExtension = new LogCaptureExtension();

    @Test
    void viewWikiText()
    {
        // Use a spy, so we don't need to mess around with clone-support in a mock.
        XWikiDocument spyDocument = getSpyDocument();

        TextAreaClass textAreaClass = new TextAreaClass();
        textAreaClass.setContentType(TextAreaClass.ContentType.WIKI_TEXT);
        BaseObject object = new BaseObject();
        object.setOwnerDocument(spyDocument);
        object.setLargeStringValue(PROPERTY_NAME, ""**Test bold**"");
        StringBuffer buffer = new StringBuffer();
        String renderingResult = ""<p><strong>Test bold</strong></p>"";
        doAnswer(invocationOnMock -> {
            XWikiDocument sDoc = invocationOnMock.getArgument(3);
            // Verify that the content author is set to the metadata author.
            assertEquals(GuestUserReference.INSTANCE, sDoc.getAuthors().getContentAuthor());
            return renderingResult;
        }).when(spyDocument).getRenderedContent(anyString(), any(Syntax.class), anyBoolean(), any(XWikiDocument.class),
            anyBoolean(), any(XWikiContext.class));
        textAreaClass.displayView(buffer, PROPERTY_NAME, """", object, true, this.oldcore.getXWikiContext());

        verify(spyDocument).getRenderedContent(anyString(), any(Syntax.class), anyBoolean(),
            any(XWikiDocument.class), anyBoolean(), any(XWikiContext.class));

        assertEquals(renderingResult, buffer.toString());
    }

    @ParameterizedTest
    @ValueSource(booleans = { true, false })
    void viewVelocityCode(boolean allowExecution)
    {
        XWikiDocument spyDocument = getSpyDocument();
        // Velocity code is only supported in XWiki 1.0.
        spyDocument.setSyntax(Syntax.XWIKI_1_0);

        TextAreaClass textAreaClass = new TextAreaClass();
        textAreaClass.setContentType(TextAreaClass.ContentType.VELOCITY_CODE);

        BaseObject object = new BaseObject();
        object.setOwnerDocument(spyDocument);
        String velocityCode = ""#set($x = 1) $1 & 1"";
        object.setLargeStringValue(PROPERTY_NAME, velocityCode);
        StringBuffer buffer = new StringBuffer();

        when(this.oldcore.getMockContextualAuthorizationManager().hasAccess(Right.SCRIPT)).then(invocationOnMock -> {
            // Verify that the content author is set to the metadata author.
            XWikiDocument sDoc = (XWikiDocument) this.oldcore.getXWikiContext().get(XWikiDocument.CKEY_SDOC);
            assertEquals(GuestUserReference.INSTANCE, sDoc.getAuthors().getContentAuthor());
            return allowExecution;
        });

        String renderingResult = ""1 &#38; 1"";
        OldRendering oldRendering = mock();
        String renderingInput = velocityCode.replace(""&"", ""&#38;"");
        when(oldRendering.parseContent(renderingInput, this.oldcore.getXWikiContext()))
            .thenReturn(renderingResult);
        when(this.oldRenderingProvider.get()).thenReturn(oldRendering);

        textAreaClass.displayView(buffer, PROPERTY_NAME, """", object, true, this.oldcore.getXWikiContext());

        if (allowExecution) {
            assertEquals(renderingResult, buffer.toString());
        } else {
            assertEquals(renderingInput, buffer.toString());
            verify(oldRendering, never()).parseContent(anyString(), any());
        }

        verify(this.oldcore.getMockContextualAuthorizationManager()).hasAccess(Right.SCRIPT);
    }

    @ParameterizedTest
    @ValueSource(booleans = { true, false })
    void viewVelocityWiki(boolean allowExecution)
    {
        XWikiDocument spyDocument = getSpyDocument();

        TextAreaClass textAreaClass = new TextAreaClass();
        textAreaClass.setContentType(TextAreaClass.ContentType.VELOCITYWIKI);

        BaseObject object = new BaseObject();
        object.setOwnerDocument(spyDocument);
        String velocityCode = ""#set($x = \""bold\"") **$1**"";
        object.setLargeStringValue(PROPERTY_NAME, velocityCode);
        StringBuffer buffer = new StringBuffer();

        when(this.oldcore.getMockContextualAuthorizationManager().hasAccess(Right.SCRIPT)).then(invocationOnMock -> {
            // Verify that the content author is set to the metadata author.
            XWikiDocument sDoc = (XWikiDocument) this.oldcore.getXWikiContext().get(XWikiDocument.CKEY_SDOC);
            assertEquals(GuestUserReference.INSTANCE, sDoc.getAuthors().getContentAuthor());
            return allowExecution;
        });

        String velocityResult = ""**bold**"";
        when(this.velocityEvaluator.evaluateVelocityNoException(velocityCode, spyDocument.getDocumentReference()))
            .thenReturn(velocityResult);

        String renderingResult = ""<p><strong>bold</strong></p>"";

        // Mock the rendering of the result of the Velocity code. Check that the content author is set to the
        // metadata author.
        doAnswer(invocationOnMock -> {
            // Verify that the input is as expected.
            if (allowExecution) {
                assertEquals(velocityResult, invocationOnMock.getArgument(0));
            } else {
                assertEquals(velocityCode, invocationOnMock.getArgument(0));
            }

            XWikiDocument sDoc = invocationOnMock.getArgument(3);
            assertEquals(GuestUserReference.INSTANCE, sDoc.getAuthors().getContentAuthor());

            return renderingResult;
        }).when(spyDocument).getRenderedContent(anyString(), same(Syntax.XWIKI_2_1), anyBoolean(),
            any(XWikiDocument.class), anyBoolean(), any(XWikiContext.class));

        textAreaClass.displayView(buffer, PROPERTY_NAME, """", object, true, this.oldcore.getXWikiContext());

        assertEquals(renderingResult, buffer.toString());

        // Verify that script right was actually checked.
        verify(this.oldcore.getMockContextualAuthorizationManager()).hasAccess(Right.SCRIPT);
    }

    @Test
    void viewVelocityWikiWithoutOwnerDocument()
    {
        TextAreaClass textAreaClass = new TextAreaClass();
        textAreaClass.setContentType(TextAreaClass.ContentType.VELOCITYWIKI);

        BaseObject object = new BaseObject();
        String velocityCode = ""1 & 2"";
        object.setLargeStringValue(PROPERTY_NAME, velocityCode);
        StringBuffer buffer = new StringBuffer();

        textAreaClass.displayView(buffer, PROPERTY_NAME, """", object, true, this.oldcore.getXWikiContext());

        assertEquals(""1 &#38; 2"", buffer.toString());

        verify(this.oldcore.getMockContextualAuthorizationManager(), never()).hasAccess(Right.SCRIPT);

        assertEquals(1, this.logCaptureExtension.size());
        assertEquals(""Error while getting the syntax corresponding to object [null].""
                + "" Defaulting to using XWiki 1.0 syntax. Internal error [NullPointerException: ]"",
            this.logCaptureExtension.getMessage(0));
    }

    private XWikiDocument getSpyDocument()
    {
        // Use a spy, so we don't need to mess around with clone-support in a mock.
        XWikiDocument spyDocument = spy(new XWikiDocument(new DocumentReference(""wiki"", ""space"", ""page"")));
        spyDocument.setSyntax(Syntax.XWIKI_2_1);
        this.oldcore.getXWikiContext().setDoc(spyDocument);
        // Add some authors to the document to verify that TextAreaClass is correctly setting the content author to
        // the metadata author.
        DocumentAuthors authors = spyDocument.getAuthors();
        authors.setEffectiveMetadataAuthor(GuestUserReference.INSTANCE);
        authors.setContentAuthor(SuperAdminUserReference.INSTANCE);
        return spyDocument;
    }
}",,edc52579eeaab1b4514785c134044671a1ecd839,CVE-2023-41046,edc52579eeaab1b4514785c134044671a1ecd839,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR {@VAR VAR} VAR. * * @VAR $VAR$ */ @VAR @VAR({ VAR.VAR }) VAR VAR { VAR VAR VAR VAR VAR = ""VAR""; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR VAR = VAR VAR(); @VAR VAR VAR() {  VAR VAR = VAR(); VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(); VAR.VAR(VAR); VAR.VAR(VAR, ""**VAR VAR**""); VAR VAR = VAR VAR(); VAR VAR = ""<VAR><VAR>VAR VAR</VAR></VAR>""; VAR(VAR -> { VAR VAR = VAR.VAR(3);  VAR(VAR.VAR, VAR.VAR().VAR()); VAR VAR; }).VAR(VAR).VAR(VAR(), VAR(VAR.VAR), VAR(), VAR(VAR.VAR), VAR(), VAR(VAR.VAR)); VAR.VAR(VAR, VAR, """", VAR, VAR, VAR.VAR.VAR()); VAR(VAR).VAR(VAR(), VAR(VAR.VAR), VAR(), VAR(VAR.VAR), VAR(), VAR(VAR.VAR)); VAR(VAR, VAR.VAR()); } @VAR @VAR(VAR = { VAR, VAR }) VAR VAR(VAR VAR) { VAR VAR = VAR();  VAR.VAR(VAR.VAR); VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(); VAR.VAR(VAR); VAR VAR = "" VAR.VAR(VAR, VAR); VAR VAR = VAR VAR(); VAR(VAR.VAR.VAR().VAR(VAR.VAR)).VAR(VAR -> {  VAR VAR = (VAR) VAR.VAR.VAR().VAR(VAR.VAR); VAR(VAR.VAR, VAR.VAR().VAR()); VAR VAR; }); VAR VAR = ""1 & VAR VAR = VAR(); VAR VAR = VAR.VAR(""&"", ""& VAR(VAR.VAR(VAR, VAR.VAR.VAR())) .VAR(VAR); VAR(VAR.VAR.VAR()).VAR(VAR); VAR.VAR(VAR, VAR, """", VAR, VAR, VAR.VAR.VAR()); VAR (VAR) { VAR(VAR, VAR.VAR()); } VAR { VAR(VAR, VAR.VAR()); VAR(VAR, VAR()).VAR(VAR(), VAR()); } VAR(VAR.VAR.VAR()).VAR(VAR.VAR); } @VAR @VAR(VAR = { VAR, VAR }) VAR VAR(VAR VAR) { VAR VAR = VAR(); VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(); VAR.VAR(VAR); VAR VAR = "" VAR.VAR(VAR, VAR); VAR VAR = VAR VAR(); VAR(VAR.VAR.VAR().VAR(VAR.VAR)).VAR(VAR -> {  VAR VAR = (VAR) VAR.VAR.VAR().VAR(VAR.VAR); VAR(VAR.VAR, VAR.VAR().VAR()); VAR VAR; }); VAR VAR = ""**VAR**""; VAR(VAR.VAR.VAR(VAR, VAR.VAR())) .VAR(VAR); VAR VAR = ""<VAR><VAR>VAR</VAR></VAR>"";   VAR(VAR -> {  VAR (VAR) { VAR(VAR, VAR.VAR(0)); } VAR { VAR(VAR, VAR.VAR(0)); } VAR VAR = VAR.VAR(3); VAR(VAR.VAR, VAR.VAR().VAR()); VAR VAR; }).VAR(VAR).VAR(VAR(), VAR(VAR.VAR), VAR(), VAR(VAR.VAR), VAR(), VAR(VAR.VAR)); VAR.VAR(VAR, VAR, """", VAR, VAR, VAR.VAR.VAR()); VAR(VAR, VAR.VAR());  VAR(VAR.VAR.VAR()).VAR(VAR.VAR); } @VAR VAR VAR() { VAR VAR = VAR VAR(); VAR.VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(); VAR VAR = ""1 & 2""; VAR.VAR(VAR, VAR); VAR VAR = VAR VAR(); VAR.VAR(VAR, VAR, """", VAR, VAR, VAR.VAR.VAR()); VAR(""1 & VAR(VAR.VAR.VAR(), VAR()).VAR(VAR.VAR); VAR(1, VAR.VAR.VAR()); VAR(""VAR VAR VAR VAR VAR VAR VAR VAR [VAR]."" + "" VAR VAR VAR VAR 1.0 VAR. VAR VAR [VAR: ]"", VAR.VAR.VAR(0)); } VAR VAR VAR() {  VAR VAR = VAR(VAR VAR(VAR VAR(""VAR"", ""VAR"", ""VAR""))); VAR.VAR(VAR.VAR); VAR.VAR.VAR().VAR(VAR);   VAR VAR = VAR.VAR(); VAR.VAR(VAR.VAR); VAR.VAR(VAR.VAR); VAR VAR; } } ",5,8
xwiki-platform_f0440dfcbba705e03f7565cd88893dde57ca3fa8,xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/main/resources/XWiki/ForgotUsernameMailContent.xml,"<?xml version=""1.1"" encoding=""UTF-8""?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version=""1.4"" reference=""XWiki.ForgotUsernameMailContent"" locale="""">
  <web>XWiki</web>
  <name>ForgotUsernameMailContent</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <creator>xwiki:XWiki.Admin</creator>
  <parent>WebHome</parent>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <version>1.1</version>
  <title>Forgot Username email</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.0</syntaxId>
  <hidden>true</hidden>
  <content/>
  <object>
    <name>XWiki.ForgotUsernameMailContent</name>
    <number>0</number>
    <className>XWiki.Mail</className>
    <guid>5940d653-0e58-439f-ad1a-9e1afbecf9dc</guid>
    <class>
      <name>XWiki.Mail</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <html>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>html</name>
        <number>4</number>
        <prettyName>HTML</prettyName>
        <rows>15</rows>
        <size>80</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </html>
      <language>
        <disabled>0</disabled>
        <name>language</name>
        <number>2</number>
        <prettyName>Language</prettyName>
        <size>5</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </language>
      <subject>
        <disabled>0</disabled>
        <name>subject</name>
        <number>1</number>
        <prettyName>Subject</prettyName>
        <size>40</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </subject>
      <text>
        <contenttype>PureText</contenttype>
        <disabled>0</disabled>
        <editor>PureText</editor>
        <name>text</name>
        <number>3</number>
        <prettyName>Text</prettyName>
        <rows>15</rows>
        <size>80</size>
        <unmodifiable>0</unmodifiable>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </text>
    </class>
    <property>
      <html>&lt;h2&gt;Hello,&lt;/h2&gt;
#set ($wikiurl = $xwiki.getURL($services.model.resolveDocument('', 'default', $doc.documentReference.extractReference('WIKI'))))
#set ($xwikiLoginURL = $xwiki.getURL('XWiki.XWikiLogin', 'login'))
#set ($wikiname = $request.serverName)
#set ($severalUsernames = ($usernames.size() &gt; 0))
&lt;p&gt;A forgot username request has been performed on &lt;a href=""$wikiurl""&gt;$wikiname&lt;/a&gt;.
If you did not make the request, please ignore this message.&lt;/p&gt;
&lt;p&gt;We found the following username#if($severalUsernames)s#end related to this email address:
:&lt;br/&gt;
#if ($severalUsernames)
&lt;ul&gt;
#foreach ($username in $usernames)
  &lt;li&gt;$username&lt;/li&gt;
#end
&lt;/ul&gt;
#else
&lt;strong&gt;$usernames.get(0)&lt;/strong&gt;
#end

&lt;p&gt;
You can login from this page: &lt;a href=""$xwikiLoginURL""&gt;XWiki Login&lt;/a&gt;.
&lt;/p&gt;
</html>
    </property>
    <property>
      <language>en</language>
    </property>
    <property>
      <subject>Forgot username on ${request.getServerName()}</subject>
    </property>
    <property>
      <text>Hello,

A forgot username request has been made on ${request.getServerName()}.
We found the following username(s) related to this email address:

#foreach ($username in $usernames)
  $usernames
#end

You can login with this username from this URL: $xwiki.getURL('XWiki.XWikiLogin', 'login').</text>
    </property>
  </object>
</xwikidoc>",,f0440dfcbba705e03f7565cd88893dde57ca3fa8,CVE-2021-32732,f0440dfcbba705e03f7565cd88893dde57ca3fa8,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"<?VAR VAR=""1.1"" VAR=""VAR-8""?> <!-- * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: --> <VAR VAR=""1.4"" VAR=""VAR.VAR"" VAR=""""> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR/> <VAR/> <VAR>0</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>VAR</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>VAR:VAR.VAR</VAR> <VAR>1.1</VAR> <VAR>VAR VAR VAR</VAR> <VAR/> <VAR>VAR</VAR> <VAR>VAR/2.0</VAR> <VAR>VAR</VAR> <VAR/> <VAR> <VAR>VAR.VAR</VAR> <VAR>0</VAR> <VAR>VAR.VAR</VAR> <VAR>5940d653-0e58-439f-VAR-9e1afbecf9dc</VAR> <VAR> <VAR>VAR.VAR</VAR> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR/> <VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR>4</VAR> <VAR>VAR</VAR> <VAR>15</VAR> <VAR>80</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> <VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>2</VAR> <VAR>VAR</VAR> <VAR>5</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> <VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>1</VAR> <VAR>VAR</VAR> <VAR>40</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> <VAR> <VAR>VAR</VAR> <VAR>0</VAR> <VAR>VAR</VAR> <VAR>VAR</VAR> <VAR>3</VAR> <VAR>VAR</VAR> <VAR>15</VAR> <VAR>80</VAR> <VAR>0</VAR> <VAR>VAR.VAR.VAR.VAR.VAR.VAR</VAR> </VAR> </VAR> <VAR> <VAR>&VAR;VAR&VAR;VAR,&VAR;/VAR&VAR;     &VAR;VAR&VAR;VAR VAR VAR VAR VAR VAR VAR VAR &VAR;VAR VAR=""$VAR""&VAR;$VAR&VAR;/VAR&VAR;. VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR.&VAR;/VAR&VAR; &VAR;VAR&VAR;VAR VAR VAR VAR VAR :&VAR;VAR/&VAR;  &VAR;VAR&VAR;  &VAR;VAR&VAR;$VAR&VAR;/VAR&VAR;  &VAR;/VAR&VAR;  &VAR;VAR&VAR;$VAR.VAR(0)&VAR;/VAR&VAR;  &VAR;VAR&VAR; VAR VAR VAR VAR VAR VAR: &VAR;VAR VAR=""$VAR""&VAR;VAR VAR&VAR;/VAR&VAR;. &VAR;/VAR&VAR; </VAR> </VAR> <VAR> <VAR>VAR</VAR> </VAR> <VAR> <VAR>VAR VAR VAR ${VAR.VAR()}</VAR> </VAR> <VAR> <VAR>VAR, VAR VAR VAR VAR VAR VAR VAR VAR ${VAR.VAR()}. VAR VAR VAR VAR VAR(VAR) VAR VAR VAR VAR VAR:  $VAR  VAR VAR VAR VAR VAR VAR VAR VAR VAR: $VAR.VAR('VAR.VAR', 'VAR').</VAR> </VAR> </VAR> </VAR> ",12,8
xwiki-platform_f1e310826a19acdcdecdecdcfe171d21f24d6ede,xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/test/java/org/xwiki/administration/AdminFieldsDisplaySheetPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.administration;

import java.util.Map;

import javax.script.ScriptContext;

import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.RenderingScriptServiceComponentList;
import org.xwiki.rendering.internal.configuration.DefaultExtendedRenderingConfiguration;
import org.xwiki.rendering.internal.configuration.RenderingConfigClassDocumentConfigurationSource;
import org.xwiki.script.ScriptContextManager;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import static java.util.Collections.emptyList;
import static java.util.Collections.singletonMap;
import static javax.script.ScriptContext.ENGINE_SCOPE;
import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Page test of {@code XWiki.AdminFieldsDisplaySheet}.
 *
 * @version $Id$
 * @since 15.0RC1
 * @since 14.10.1
 * @since 14.4.8
 * @since 13.10.11
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@RenderingScriptServiceComponentList
@ComponentList({
    TestNoScriptMacro.class,
    DefaultExtendedRenderingConfiguration.class,
    RenderingConfigClassDocumentConfigurationSource.class
})
class AdminFieldsDisplaySheetPageTest extends PageTest
{
    private ScriptContext scriptContext;

    @BeforeEach
    void setUp() throws Exception
    {
        this.scriptContext =
            this.oldcore.getMocker().<ScriptContextManager>getInstance(ScriptContextManager.class).getScriptContext();
    }

    @Test
    void escaping() throws Exception
    {
        String paramsInput = ""\""/><script>console.log('params');</script>{{/html}}{{noscript/}}"";
        String sectionInput = ""\""/><strong>console.log('section');</script>{{/html}}{{noscript/}}"";
        String paramClassInput = ""\""/><script>console.log('paramClass');</script>{{/html}}{{noscript/}}"";
        Map<Object, Object> params = singletonMap(paramsInput, emptyList());
        DocumentReference otherDocumentReference = new DocumentReference(""xwiki"", ""Space"", ""Page"");
        com.xpn.xwiki.api.Document otherDocument =
            new com.xpn.xwiki.api.Document(this.xwiki.getDocument(otherDocumentReference, this.context), this.context);

        this.scriptContext.setAttribute(""section"", sectionInput, ENGINE_SCOPE);
        this.scriptContext.setAttribute(""paramDoc"", otherDocument, ENGINE_SCOPE);
        this.scriptContext.setAttribute(""params"", params, ENGINE_SCOPE);
        this.scriptContext.setAttribute(""paramClass"", paramClassInput, ENGINE_SCOPE);

        Document document = renderHTMLPage(new DocumentReference(""xwiki"", ""XWiki"", ""AdminFieldsDisplaySheet""));

        Element form = document.selectFirst(""form"");
        assertEquals(String.format(""%s_%s"", sectionInput, paramClassInput), form.attr(""id""));
        assertEquals(""/xwiki/bin/saveandcontinue/Space/Page"", form.attr(""action""));
        Element fieldset = form.selectFirst(""fieldset"");
        assertEquals(paramsInput, fieldset.attr(""class""));
        assertEquals(paramClassInput, document.selectFirst("".hidden input[name='classname']"").val());
    }
}",,f1e310826a19acdcdecdecdcfe171d21f24d6ede,CVE-2023-29511,f1e310826a19acdcdecdecdcfe171d21f24d6ede,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 15.0RC1 * @VAR 14.10.1 * @VAR 14.4.8 * @VAR 13.10.11 */ @VAR @VAR @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR.VAR = VAR.VAR.VAR().<VAR>VAR(VAR.VAR).VAR(); } @VAR VAR VAR() VAR VAR { VAR VAR = ""\""/><VAR>VAR.VAR('VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = ""\""/><VAR>VAR.VAR('VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR VAR = ""\""/><VAR>VAR.VAR('VAR');</VAR>{{/VAR}}{{VAR/}}""; VAR<VAR, VAR> VAR = VAR(VAR, VAR()); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR.VAR.VAR.VAR.VAR VAR = VAR VAR.VAR.VAR.VAR.VAR(VAR.VAR.VAR(VAR, VAR.VAR), VAR.VAR); VAR.VAR.VAR(""VAR"", VAR, VAR); VAR.VAR.VAR(""VAR"", VAR, VAR); VAR.VAR.VAR(""VAR"", VAR, VAR); VAR.VAR.VAR(""VAR"", VAR, VAR); VAR VAR = VAR(VAR VAR(""VAR"", ""VAR"", ""VAR"")); VAR VAR = VAR.VAR(""VAR""); VAR(VAR.VAR(""%VAR%VAR"", VAR, VAR), VAR.VAR(""VAR"")); VAR(""/VAR/VAR/VAR/VAR/VAR"", VAR.VAR(""VAR"")); VAR VAR = VAR.VAR(""VAR""); VAR(VAR, VAR.VAR(""VAR"")); VAR(VAR, VAR.VAR("".VAR VAR[VAR='VAR']"").VAR()); } } ",5,8
xwiki-platform_fbc4bfbae4f6ce8109addb281de86a03acdb9277,xwiki-platform-core/xwiki-platform-attachment/xwiki-platform-attachment-api/src/test/java/org/xwiki/attachment/MoveStep1PageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.attachment;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mock;
import org.xwiki.csrf.script.CSRFTokenScriptService;
import org.xwiki.model.reference.AttachmentReference;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.script.service.ScriptService;
import org.xwiki.security.script.SecurityScriptServiceComponentList;
import org.xwiki.template.TemplateManager;
import org.xwiki.test.page.PageTest;
import org.xwiki.velocity.VelocityManager;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.Mockito.when;

/**
 * Test of {@code moveStep1.vm} template.
 *
 * @version $Id$
 * @since 14.4RC1
 */
@SecurityScriptServiceComponentList
class MoveStep1PageTest extends PageTest
{
    private static final String MOVE_STEP1_TEMPLATE = ""attachment/moveStep1.vm"";

    private static final String ATTACHMENT_NAME = "">a<b>tt</b>achmen\""'t1.txt"";

    private static final DocumentReference DOC_REF = new DocumentReference(""xwiki"", ""Space"", ""Page"");

    private TemplateManager templateManager;

    @Mock
    private CSRFTokenScriptService csrfScriptService;

    private VelocityManager velocityManager;

    @BeforeEach
    void setUp() throws Exception
    {
        this.templateManager = this.oldcore.getMocker().getInstance(TemplateManager.class);
        this.velocityManager = this.oldcore.getMocker().getInstance(VelocityManager.class);
        this.componentManager.registerComponent(ScriptService.class, ""csrf"", this.csrfScriptService);
        when(this.csrfScriptService.getToken()).thenReturn(""csrf_token"");
    }

    @Test
    void escapedValues() throws Exception
    {
        XWikiDocument document = this.xwiki.getDocument(DOC_REF, this.context);
        this.context.setDoc(document);

        this.velocityManager.getVelocityContext().put(""attachment"", new AttachmentReference(ATTACHMENT_NAME,
            document.getDocumentReference()));

        Document render = Jsoup.parse(this.templateManager.render(MOVE_STEP1_TEMPLATE));
        assertNotNull(render);
        assertEquals(""cancel"", render.select("".buttons .secondary.button"").text());
        assertEquals(""attachment.move.submit"", render.select("".buttons input"").attr(""value""));
        assertEquals(""attachment.move.autoRedirect.label"", render.select(""dt.autoRedirect label"").text());
        assertEquals(""attachment.move.autoRedirect.hint"", render.select(""dd.autoRedirect .xHint"").text());
        assertEquals(""attachment.move.newName.label"", render.select(""dt.targetAttachmentName label"").text());
        assertEquals(""attachment.move.newName.hint"", render.select(""dt.targetAttachmentName .xHint"").text());
        assertEquals(ATTACHMENT_NAME, render.select(""[name='sourceAttachmentName']"").attr(""value""));
        assertEquals(ATTACHMENT_NAME, render.select(""#targetAttachmentNameTitle"").attr(""value""));
    }
}",,fbc4bfbae4f6ce8109addb281de86a03acdb9277,CVE-2022-36097,fbc4bfbae4f6ce8109addb281de86a03acdb9277,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR.VAR} VAR. * * @VAR $VAR$ * @VAR 14.4RC1 */ @VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR/VAR.VAR""; VAR VAR VAR VAR VAR = "">VAR<VAR>VAR</VAR>VAR\""'VAR.VAR""; VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR VAR; @VAR VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR.VAR = VAR.VAR.VAR().VAR(VAR.VAR); VAR.VAR = VAR.VAR.VAR().VAR(VAR.VAR); VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR.VAR); VAR(VAR.VAR.VAR()).VAR(""VAR""); } @VAR VAR VAR() VAR VAR { VAR VAR = VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR.VAR(VAR); VAR.VAR.VAR().VAR(""VAR"", VAR VAR(VAR, VAR.VAR())); VAR VAR = VAR.VAR(VAR.VAR.VAR(VAR)); VAR(VAR); VAR(""VAR"", VAR.VAR("".VAR .VAR.VAR"").VAR()); VAR(""VAR.VAR.VAR"", VAR.VAR("".VAR VAR"").VAR(""VAR"")); VAR(""VAR.VAR.VAR.VAR"", VAR.VAR(""VAR.VAR VAR"").VAR()); VAR(""VAR.VAR.VAR.VAR"", VAR.VAR(""VAR.VAR .VAR"").VAR()); VAR(""VAR.VAR.VAR.VAR"", VAR.VAR(""VAR.VAR VAR"").VAR()); VAR(""VAR.VAR.VAR.VAR"", VAR.VAR(""VAR.VAR .VAR"").VAR()); VAR(VAR, VAR.VAR(""[VAR='VAR']"").VAR(""VAR"")); VAR(VAR, VAR.VAR("" } } ",5,8
xwiki-platform_fbc4bfbae4f6ce8109addb281de86a03acdb9277,xwiki-platform-core/xwiki-platform-attachment/xwiki-platform-attachment-api/src/test/java/org/xwiki/attachment/RefactoringMacrosPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.attachment;

import java.util.stream.Stream;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.Arguments;
import org.junit.jupiter.params.provider.CsvSource;
import org.junit.jupiter.params.provider.MethodSource;
import org.xwiki.attachment.script.AttachmentScriptService;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.rendering.syntax.Syntax;
import org.xwiki.script.service.ScriptService;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.XWikiSyntax21ComponentList;
import org.xwiki.xml.internal.html.filter.ControlCharactersFilter;

import com.xpn.xwiki.doc.XWikiDocument;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.when;

/**
 * Test of the macros provided by {@code refactoring_macros.vm}.
 *
 * @version $Id$
 * @since 14.4RC1
 */
@ComponentList({ ControlCharactersFilter.class })
@HTML50ComponentList
@XWikiSyntax21ComponentList
class RefactoringMacrosPageTest extends PageTest
{
    public static final DocumentReference DOCUMENT_REFERENCE = new DocumentReference(""xwiki"", ""Space"", ""Page"");

    @ParameterizedTest
    @CsvSource({
        ""false,false,true"",
        ""false,true,false"",
        ""true,false,false"",
        ""true,true, false""
    })
    void displayAttachmentLinksCheckboxIsHidden(boolean isAdvancedUser, boolean isSuperAdmin, boolean expectHidden)
        throws Exception
    {
        XWikiDocument document = this.xwiki.getDocument(DOCUMENT_REFERENCE, this.context);
        document.setContent(String.format(""{{velocity}}\n""
                + ""#template('attachment/refactoring_macros.vm')\n""
                + ""#set($isAdvancedUser = %s)\n""
                + ""#set($isSuperAdmin = %s)\n""
                + ""{{html}}#displayAttachmentLinksCheckbox(){{/html}}\n""
                + ""{{/velocity}}"",
            isAdvancedUser, isSuperAdmin));
        document.setSyntax(Syntax.XWIKI_2_1);
        this.xwiki.saveDocument(document, this.context);
        Document content = Jsoup.parse(document.getRenderedContent(this.context));
        assertEquals(expectHidden, content.select(""dt"").hasClass(""hidden""));
        assertEquals(expectHidden, content.select(""dd"").hasClass(""hidden""));
    }

    @ParameterizedTest
    @MethodSource(""displayAttachmentLinksCheckboxSource"")
    void displayAttachmentLinksCheckbox(String updateReferences, String expectedChecked)
        throws Exception
    {
        AttachmentScriptService attachmentScriptService = mock(AttachmentScriptService.class);
        this.componentManager.registerComponent(ScriptService.class, ""attachment"", attachmentScriptService);
        when(attachmentScriptService.backlinksCount(any())).thenReturn(10L);

        XWikiDocument document = this.xwiki.getDocument(DOCUMENT_REFERENCE, this.context);
        document.setContent(""{{velocity}}\n""
            + ""#template('attachment/refactoring_macros.vm')\n""
            + ""{{html}}#displayAttachmentLinksCheckbox(){{/html}}\n""
            + ""{{/velocity}}"");
        document.setSyntax(Syntax.XWIKI_2_1);
        this.xwiki.saveDocument(document, this.context);

        this.request.put(""updateReferences"", updateReferences);

        Document parse = Jsoup.parse(document.getRenderedContent(this.context));
        // The checkbox is checked by default, unless updateReferences is defined to value different than 'true'.
        assertEquals(expectedChecked, parse.select(""[name='updateReferences']"").attr(""checked""));
        assertEquals(""attachment.move.links.hint [10]"", parse.select("".xHint"").text());
    }

    /**
     * @return the arguments for {@link #displayAttachmentLinksCheckbox(String, String)}
     */
    private static Stream<Arguments> displayAttachmentLinksCheckboxSource()
    {
        return Stream.of(
            Arguments.of(null, ""checked""),
            Arguments.of("""", """"),
            Arguments.of(""false"", """"),
            Arguments.of(""true"", ""checked"")
        );
    }
}",,fbc4bfbae4f6ce8109addb281de86a03acdb9277,CVE-2022-36097,fbc4bfbae4f6ce8109addb281de86a03acdb9277,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ * @VAR 14.4RC1 */ @VAR({ VAR.VAR }) @VAR @VAR VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR @VAR({ ""VAR,VAR,VAR"", ""VAR,VAR,VAR"", ""VAR,VAR,VAR"", ""VAR,VAR, VAR"" }) VAR VAR(VAR VAR, VAR VAR, VAR VAR) VAR VAR { VAR VAR = VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR(VAR.VAR(""{{VAR}}\VAR"" + "" + "" + "" + ""{{VAR}} + ""{{/VAR}}"", VAR, VAR)); VAR.VAR(VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR)); VAR(VAR, VAR.VAR(""VAR"").VAR(""VAR"")); VAR(VAR, VAR.VAR(""VAR"").VAR(""VAR"")); } @VAR @VAR(""VAR"") VAR VAR(VAR VAR, VAR VAR) VAR VAR { VAR VAR = VAR(VAR.VAR); VAR.VAR.VAR(VAR.VAR, ""VAR"", VAR); VAR(VAR.VAR(VAR())).VAR(10L); VAR VAR = VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR(""{{VAR}}\VAR"" + "" + ""{{VAR}} + ""{{/VAR}}""); VAR.VAR(VAR.VAR); VAR.VAR.VAR(VAR, VAR.VAR); VAR.VAR.VAR(""VAR"", VAR); VAR VAR = VAR.VAR(VAR.VAR(VAR.VAR));  VAR(VAR, VAR.VAR(""[VAR='VAR']"").VAR(""VAR"")); VAR(""VAR.VAR.VAR.VAR [10]"", VAR.VAR("".VAR"").VAR()); } /** * @VAR VAR VAR VAR {@VAR  */ VAR VAR VAR<VAR> VAR() { VAR VAR.VAR( VAR.VAR(VAR, ""VAR""), VAR.VAR("""", """"), VAR.VAR(""VAR"", """"), VAR.VAR(""VAR"", ""VAR"") ); } } ",5,8
xwiki-platform_fcdcfed3fe2e8a3cad66ae0610795a2d58ab9662,xwiki-platform-core/xwiki-platform-scheduler/xwiki-platform-scheduler-api/src/test/java/com/xpn/xwiki/plugin/scheduler/GroovyJobTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.plugin.scheduler;

import java.util.function.Consumer;

import javax.inject.Inject;

import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;
import org.mockito.Mock;
import org.quartz.JobDataMap;
import org.quartz.JobDetail;
import org.quartz.JobExecutionContext;
import org.quartz.JobExecutionException;
import org.quartz.JobKey;
import org.xwiki.context.Execution;
import org.xwiki.context.internal.DefaultExecution;
import org.xwiki.context.internal.DefaultExecutionContextManager;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.security.authorization.AccessDeniedException;
import org.xwiki.security.authorization.Right;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.user.GuestUserReference;
import org.xwiki.user.UserReference;

import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.internal.ReadOnlyXWikiContextProvider;
import com.xpn.xwiki.objects.BaseObject;
import com.xpn.xwiki.plugin.scheduler.internal.SchedulerJobClassDocumentInitializer;
import com.xpn.xwiki.test.MockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;
import com.xpn.xwiki.test.reference.ReferenceComponentList;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotEquals;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.doAnswer;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.when;

/**
 * Unit test for {@link GroovyJob}.
 *
 * @version $Id$
 */
@OldcoreTest
@ComponentList({
    SchedulerJobClassDocumentInitializer.class,
    DefaultExecutionContextManager.class,
    DefaultExecution.class,
    ReadOnlyXWikiContextProvider.class
})
@ReferenceComponentList
class GroovyJobTest
{
    private static final String WIKI_NAME = ""xwiki"";

    @Mock
    private Consumer<UserReference> feedbackFunction;

    @Inject
    private Execution execution;

    @ParameterizedTest
    @ValueSource(booleans = { true, false })
    void programmingRightCheck(boolean allowExecution, MockitoOldcore mockitoOldcore) throws XWikiException,
        JobExecutionException, AccessDeniedException
    {
        GroovyJob job = new GroovyJob();

        // Mock the job context.
        JobExecutionContext context = mock(JobExecutionContext.class);
        JobDetail jobDetail = mock(JobDetail.class);
        when(context.getJobDetail()).thenReturn(jobDetail);
        when(jobDetail.getKey()).thenReturn(new JobKey(""Test Job""));
        JobDataMap jobDataMap = new JobDataMap();
        when(jobDetail.getJobDataMap()).thenReturn(jobDataMap);

        // Create a new context to ensure that the context from the job is used.
        XWikiContext testContext = new XWikiContext();
        jobDataMap.put(""context"", testContext);
        testContext.setWiki(mockitoOldcore.getSpyXWiki());
        testContext.setUserReference(new DocumentReference(WIKI_NAME, ""XWiki"", ""ContextUser""));

        // Create a mock function that we set on the context and that will then be executed by the job.
        testContext.put(""feedbackFunction"", this.feedbackFunction);

        // Create the job document.
        XWikiDocument jobDocument = new XWikiDocument(new DocumentReference(WIKI_NAME, ""Scheduler"", ""Job""));
        // Set different authors to verify that the correct author is used.
        UserReference contentAuthor = mock(UserReference.class);
        UserReference jobAuthor = mock(UserReference.class);
        jobDocument.getAuthors().setContentAuthor(contentAuthor);
        jobDocument.getAuthors().setOriginalMetadataAuthor(GuestUserReference.INSTANCE);
        jobDocument.getAuthors().setEffectiveMetadataAuthor(jobAuthor);
        BaseObject xObject = jobDocument.newXObject(SchedulerJobClassDocumentInitializer.XWIKI_JOB_CLASSREFERENCE,
            mockitoOldcore.getXWikiContext());
        xObject.setLargeStringValue(""script"",
            ""xcontext.get('feedbackFunction')""
                + "".accept(xcontext.get(com.xpn.xwiki.doc.XWikiDocument.CKEY_SDOC).getAuthors().getContentAuthor())"");
        mockitoOldcore.getSpyXWiki().saveDocument(jobDocument, mockitoOldcore.getXWikiContext());
        jobDataMap.put(""xjob"", xObject);

        doAnswer(invocationOnMock -> {
            XWikiContext xWikiContext =
                (XWikiContext) this.execution.getContext().getProperty(XWikiContext.EXECUTIONCONTEXT_KEY);
            assertEquals(jobDocument, xWikiContext.getDoc());
            XWikiDocument sDocument = (XWikiDocument) xWikiContext.get(XWikiDocument.CKEY_SDOC);
            assertEquals(jobAuthor, sDocument.getAuthors().getContentAuthor());
            assertNotEquals(contentAuthor, sDocument.getAuthors().getContentAuthor());

            if (!allowExecution) {
                throw new AccessDeniedException(Right.PROGRAM, new DocumentReference(WIKI_NAME, ""XWiki"", ""JobAuthor""),
                    sDocument.getDocumentReference());
            }
            return null;
        }).when(mockitoOldcore.getMockContextualAuthorizationManager()).checkAccess(Right.PROGRAM);

        if (allowExecution) {
            job.execute(context);
            verify(this.feedbackFunction).accept(jobAuthor);
        } else {
            JobExecutionException jobExecutionException =
                assertThrows(JobExecutionException.class, () -> job.execute(context));
            verify(this.feedbackFunction, never()).accept(any());
            assertEquals(""Executing the job [DEFAULT.Test Job] failed due to insufficient rights."",
                jobExecutionException.getMessage());
            assertEquals(""Access denied when checking [programming] access to [xwiki:Scheduler.Job] ""
                + ""for user [xwiki:XWiki.JobAuthor]"", jobExecutionException.getCause().getMessage());
        }

        verify(mockitoOldcore.getMockContextualAuthorizationManager()).checkAccess(Right.PROGRAM);
    }
}",,fcdcfed3fe2e8a3cad66ae0610795a2d58ab9662,CVE-2023-40573,fcdcfed3fe2e8a3cad66ae0610795a2d58ab9662,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR}. * * @VAR $VAR$ */ @VAR @VAR({ VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR }) @VAR VAR VAR { VAR VAR VAR VAR VAR = ""VAR""; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR @VAR(VAR = { VAR, VAR }) VAR VAR(VAR VAR, VAR VAR) VAR VAR, VAR, VAR { VAR VAR = VAR VAR();  VAR VAR = VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR()).VAR(VAR); VAR(VAR.VAR()).VAR(VAR VAR(""VAR VAR"")); VAR VAR = VAR VAR(); VAR(VAR.VAR()).VAR(VAR);  VAR VAR = VAR VAR(); VAR.VAR(""VAR"", VAR); VAR.VAR(VAR.VAR()); VAR.VAR(VAR VAR(VAR, ""VAR"", ""VAR""));  VAR.VAR(""VAR"", VAR.VAR);  VAR VAR = VAR VAR(VAR VAR(VAR, ""VAR"", ""VAR""));  VAR VAR = VAR(VAR.VAR); VAR VAR = VAR(VAR.VAR); VAR.VAR().VAR(VAR); VAR.VAR().VAR(VAR.VAR); VAR.VAR().VAR(VAR); VAR VAR = VAR.VAR(VAR.VAR, VAR.VAR()); VAR.VAR(""VAR"", ""VAR.VAR('VAR')"" + "".VAR(VAR.VAR(VAR.VAR.VAR.VAR.VAR.VAR).VAR().VAR())""); VAR.VAR().VAR(VAR, VAR.VAR()); VAR.VAR(""VAR"", VAR); VAR(VAR -> { VAR VAR = (VAR) VAR.VAR.VAR().VAR(VAR.VAR); VAR(VAR, VAR.VAR()); VAR VAR = (VAR) VAR.VAR(VAR.VAR); VAR(VAR, VAR.VAR().VAR()); VAR(VAR, VAR.VAR().VAR()); VAR (!VAR) { VAR VAR VAR(VAR.VAR, VAR VAR(VAR, ""VAR"", ""VAR""), VAR.VAR()); } VAR VAR; }).VAR(VAR.VAR()).VAR(VAR.VAR); VAR (VAR) { VAR.VAR(VAR); VAR(VAR.VAR).VAR(VAR); } VAR { VAR VAR = VAR(VAR.VAR, () -> VAR.VAR(VAR)); VAR(VAR.VAR, VAR()).VAR(VAR()); VAR(""VAR VAR VAR [VAR.VAR VAR] VAR VAR VAR VAR VAR."", VAR.VAR()); VAR(""VAR VAR VAR VAR [VAR] VAR VAR [VAR:VAR.VAR] "" + ""VAR VAR [VAR:VAR.VAR]"", VAR.VAR().VAR()); } VAR(VAR.VAR()).VAR(VAR.VAR); } } ",5,8
xwiki-platform_fe65bc35d5672dd2505b7ac4ec42aec57d500fbb,xwiki-platform-core/xwiki-platform-skin/xwiki-platform-skin-skinx/src/test/java/com/xpn/xwiki/plugin/skinx/JsSkinExtensionPluginTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package com.xpn.xwiki.plugin.skinx;

import java.util.Collections;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Map;
import java.util.Set;
import java.util.Vector;

import javax.inject.Named;
import javax.inject.Provider;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.RegisterExtension;
import org.xwiki.model.EntityType;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.model.reference.DocumentReferenceResolver;
import org.xwiki.model.reference.EntityReferenceResolver;
import org.xwiki.model.reference.EntityReferenceSerializer;
import org.xwiki.model.reference.WikiReference;
import org.xwiki.observation.ObservationManager;
import org.xwiki.security.authorization.AuthorizationManager;
import org.xwiki.security.authorization.Right;
import org.xwiki.skinx.internal.async.SkinExtensionAsync;
import org.xwiki.test.LogLevel;
import org.xwiki.test.junit5.LogCaptureExtension;
import org.xwiki.test.junit5.mockito.MockComponent;

import com.xpn.xwiki.XWiki;
import com.xpn.xwiki.XWikiContext;
import com.xpn.xwiki.XWikiException;
import com.xpn.xwiki.doc.XWikiDocument;
import com.xpn.xwiki.objects.BaseObject;
import com.xpn.xwiki.objects.classes.BaseClass;
import com.xpn.xwiki.test.MockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.InjectMockitoOldcore;
import com.xpn.xwiki.test.junit5.mockito.OldcoreTest;
import com.xpn.xwiki.web.XWikiRequest;
import com.xpn.xwiki.web.XWikiURLFactory;

import static org.junit.jupiter.api.Assertions.*;
import static org.mockito.Mockito.mock;
import static org.mockito.Mockito.never;
import static org.mockito.Mockito.times;
import static org.mockito.Mockito.verify;
import static org.mockito.Mockito.verifyNoInteractions;
import static org.mockito.Mockito.when;

/**
 * Tests for {@link JsSkinExtensionPlugin}.
 *
 * @version $Id$
 * @since 14.9RC1
 */
@OldcoreTest
class JsSkinExtensionPluginTest
{
    @InjectMockitoOldcore
    private MockitoOldcore mockitoOldcore;

    @MockComponent
    private Provider<DocumentReference> documentReferenceProvider;

    @MockComponent
    private ObservationManager observationManager;

    @MockComponent
    private EntityReferenceSerializer<String> entityReferenceSerializer;

    @MockComponent
    @Named(""currentmixed"")
    private DocumentReferenceResolver<String> currentMixedDocumentReferenceResolver;

    @MockComponent
    private DocumentReferenceResolver<String> documentReferenceResolver;

    @MockComponent
    @Named(""current"")
    private EntityReferenceResolver<String> currentEntityReferenceResolver;

    @MockComponent
    private AuthorizationManager authorizationManager;

    @MockComponent
    private SkinExtensionAsync skinExtensionAsync;

    @RegisterExtension
    LogCaptureExtension logCapture = new LogCaptureExtension(LogLevel.WARN);

    private XWikiContext context;
    private BaseClass pluginClass;
    private JsSkinExtensionPlugin skinExtensionPlugin;
    private XWikiURLFactory urlFactory;

    @BeforeEach
    void setup() throws XWikiException
    {
        XWikiDocument classDoc = mock(XWikiDocument.class);
        this.pluginClass = mock(BaseClass.class);

        this.context = mockitoOldcore.getXWikiContext();
        this.urlFactory = mock(XWikiURLFactory.class);
        context.setURLFactory(urlFactory);
        XWikiRequest xWikiRequest = mock(XWikiRequest.class);
        context.setRequest(xWikiRequest);
        XWiki wiki = mockitoOldcore.getSpyXWiki();
        when(this.currentMixedDocumentReferenceResolver.resolve(JsSkinExtensionPlugin.JSX_CLASS_NAME)).thenReturn(
            new DocumentReference(JsSkinExtensionPlugin.JSX_CLASS_REFERENCE, new WikiReference(""xwiki"")));
        when(wiki.getDocument(JsSkinExtensionPlugin.JSX_CLASS_NAME, context)).thenReturn(classDoc);
        when(classDoc.getXClass()).thenReturn(this.pluginClass);
        this.skinExtensionPlugin = new JsSkinExtensionPlugin(""plugin1"", ""unused"", context);
        skinExtensionPlugin.init(context);
    }

    @Test
    void use() throws XWikiException
    {
        String resource = ""MySpace.MyJSXPage"";
        Map<String, Object> parameters = Collections.singletonMap(""fooParam"", ""barValue"");

        DocumentReference documentReference = new DocumentReference(""xwiki"", ""MySpace"", ""MyJSXPage"");
        when(this.currentEntityReferenceResolver.resolve(resource, EntityType.DOCUMENT)).thenReturn(documentReference);
        when(this.entityReferenceSerializer.serialize(documentReference)).thenReturn(resource);

        when(this.documentReferenceResolver.resolve(resource)).thenReturn(documentReference);
        XWikiDocument document = mock(XWikiDocument.class);
        when(this.mockitoOldcore.getSpyXWiki().getDocument(documentReference, context)).thenReturn(document);

        DocumentReference userReference = new DocumentReference(""xwiki"", ""XWiki"", ""Foo"");
        when(document.getAuthorReference()).thenReturn(userReference);
        when(this.authorizationManager.hasAccess(Right.SCRIPT, userReference, documentReference)).thenReturn(true);

        this.skinExtensionPlugin.use(resource, parameters, context);
        String className = JsSkinExtensionPlugin.class.getCanonicalName();
        Set<String> resources = (Set<String>) context.get(className);

        assertEquals(Collections.singleton(resource), resources);

        Map<String, Map<String, Object>> parametersMap =
            (Map<String, Map<String, Object>>) context.get(className + ""_parameters"");
        Map<String, Map<String, Object>> expectedParameters = new HashMap<>();
        expectedParameters.put(resource, parameters);

        assertEquals(expectedParameters, parametersMap);
        verify(this.authorizationManager).hasAccess(Right.SCRIPT, userReference, documentReference);
        verify(this.skinExtensionAsync).use(""jsx"", resource, parameters);

        String resource2 = ""MySpace.MyOtherJSXPage"";
        Map<String, Object> parameters2 = null;
        DocumentReference documentReference2 = new DocumentReference(""xwiki"", ""MySpace"", ""MyOtherJSXPage"");

        when(this.currentEntityReferenceResolver.resolve(resource2, EntityType.DOCUMENT))
            .thenReturn(documentReference2);
        when(this.entityReferenceSerializer.serialize(documentReference2)).thenReturn(resource2);

        when(this.documentReferenceResolver.resolve(resource2)).thenReturn(documentReference2);
        XWikiDocument document2 = mock(XWikiDocument.class);
        when(this.mockitoOldcore.getSpyXWiki().getDocument(documentReference2, context)).thenReturn(document2);

        DocumentReference userReference2 = new DocumentReference(""xwiki"", ""XWiki"", ""Bar"");
        when(document2.getAuthorReference()).thenReturn(userReference2);
        when(this.authorizationManager.hasAccess(Right.SCRIPT, userReference2, documentReference2)).thenReturn(false);

        this.skinExtensionPlugin.use(resource2, parameters2, context);
        resources = (Set<String>) context.get(className);
        assertEquals(Collections.singleton(resource), resources);
        parametersMap =
            (Map<String, Map<String, Object>>) context.get(className + ""_parameters"");
        assertEquals(expectedParameters, parametersMap);
        verify(this.authorizationManager).hasAccess(Right.SCRIPT, userReference2, documentReference2);
        verify(this.skinExtensionAsync, never()).use(""jsx"", resource2, parameters2);

        assertEquals(1, this.logCapture.size());
        assertEquals(""Extensions present in [MySpace.MyOtherJSXPage] ignored because of lack of script right ""
            + ""from the author."", this.logCapture.getMessage(0));

        when(this.authorizationManager.hasAccess(Right.SCRIPT, userReference2, documentReference2)).thenReturn(true);
        this.skinExtensionPlugin.use(resource2, parameters2, context);

        Set<String> expectedSet = new HashSet<>();
        expectedSet.add(resource);
        expectedSet.add(resource2);

        resources = (Set<String>) context.get(className);
        assertEquals(expectedSet, resources);

        parametersMap =
            (Map<String, Map<String, Object>>) context.get(className + ""_parameters"");
        assertEquals(expectedParameters, parametersMap);
        verify(this.authorizationManager, times(2)).hasAccess(Right.SCRIPT, userReference2, documentReference2);
        verify(this.skinExtensionAsync).use(""jsx"", resource2, null);

        parameters2 = Collections.singletonMap(""buzValue"", 42);
        this.skinExtensionPlugin.use(resource2, parameters2, context);

        resources = (Set<String>) context.get(className);
        assertEquals(expectedSet, resources);
        parametersMap =
            (Map<String, Map<String, Object>>) context.get(className + ""_parameters"");
        expectedParameters.put(resource2, parameters2);
        assertEquals(expectedParameters, parametersMap);
        verify(this.skinExtensionAsync).use(""jsx"", resource2, parameters2);

        this.skinExtensionPlugin.use(resource, null, context);
        expectedParameters.remove(resource);
        resources = (Set<String>) context.get(className);
        assertEquals(expectedSet, resources);
        parametersMap =
            (Map<String, Map<String, Object>>) context.get(className + ""_parameters"");
        expectedParameters.put(resource2, parameters2);
        assertEquals(expectedParameters, parametersMap);
        verify(this.skinExtensionAsync).use(""jsx"", resource, null);
    }

    @Test
    void hasPageExtensions()
    {
        this.context.setDoc(null);
        assertFalse(this.skinExtensionPlugin.hasPageExtensions(context));

        XWikiDocument currentDoc = mock(XWikiDocument.class, ""currentDoc"");
        this.context.setDoc(currentDoc);

        String className = JsSkinExtensionPlugin.JSX_CLASS_NAME;
        when(currentDoc.getObjects(className)).thenReturn(null);
        assertFalse(this.skinExtensionPlugin.hasPageExtensions(context));
        verify(currentDoc).getObjects(className);

        BaseObject baseObject = mock(BaseObject.class, ""specificObj"");
        when(baseObject.getStringValue(""use"")).thenReturn(""wiki"");
        Vector<BaseObject> objectList = new Vector<>();
        objectList.add(mock(BaseObject.class));
        objectList.add(null);
        objectList.add(mock(BaseObject.class));
        objectList.add(baseObject);
        objectList.add(null);
        objectList.add(mock(BaseObject.class));

        when(currentDoc.getObjects(className)).thenReturn(objectList);
        assertFalse(this.skinExtensionPlugin.hasPageExtensions(context));
        verifyNoInteractions(this.authorizationManager);

        when(baseObject.getStringValue(""use"")).thenReturn(""currentPage"");
        DocumentReference documentReference = new DocumentReference(""xwiki"", ""MySpace"", ""SomePage"");
        DocumentReference userReference = new DocumentReference(""xwiki"", ""XWiki"", ""Foo"");
        when(currentDoc.getDocumentReference()).thenReturn(documentReference);
        when(currentDoc.getAuthorReference()).thenReturn(userReference);

        when(this.authorizationManager.hasAccess(Right.SCRIPT, userReference, documentReference)).thenReturn(false);
        assertFalse(this.skinExtensionPlugin.hasPageExtensions(context));
        verify(this.authorizationManager).hasAccess(Right.SCRIPT, userReference, documentReference);

        assertEquals(1, this.logCapture.size());
        assertEquals(""Extensions present in [xwiki:MySpace.SomePage] ignored because of lack of script right ""
            + ""from the author."", this.logCapture.getMessage(0));

        when(this.authorizationManager.hasAccess(Right.SCRIPT, userReference, documentReference)).thenReturn(true);
        assertTrue(this.skinExtensionPlugin.hasPageExtensions(context));
    }
}",,fe65bc35d5672dd2505b7ac4ec42aec57d500fbb,CVE-2023-29206,fe65bc35d5672dd2505b7ac4ec42aec57d500fbb,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.*; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR; /** * VAR VAR {@VAR VAR}. * * @VAR $VAR$ * @VAR 14.9RC1 */ @VAR VAR VAR { @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR<VAR> VAR; @VAR @VAR(""VAR"") VAR VAR<VAR> VAR; @VAR VAR VAR<VAR> VAR; @VAR @VAR(""VAR"") VAR VAR<VAR> VAR; @VAR VAR VAR VAR; @VAR VAR VAR VAR; @VAR VAR VAR = VAR VAR(VAR.VAR); VAR VAR VAR; VAR VAR VAR; VAR VAR VAR; VAR VAR VAR; @VAR VAR VAR() VAR VAR { VAR VAR = VAR(VAR.VAR); VAR.VAR = VAR(VAR.VAR); VAR.VAR = VAR.VAR(); VAR.VAR = VAR(VAR.VAR); VAR.VAR(VAR); VAR VAR = VAR(VAR.VAR); VAR.VAR(VAR); VAR VAR = VAR.VAR(); VAR(VAR.VAR.VAR(VAR.VAR)).VAR( VAR VAR(VAR.VAR, VAR VAR(""VAR""))); VAR(VAR.VAR(VAR.VAR, VAR)).VAR(VAR); VAR(VAR.VAR()).VAR(VAR.VAR); VAR.VAR = VAR VAR(""VAR"", ""VAR"", VAR); VAR.VAR(VAR); } @VAR VAR VAR() VAR VAR { VAR VAR = ""VAR.VAR""; VAR<VAR, VAR> VAR = VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR(VAR.VAR.VAR(VAR, VAR.VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR.VAR().VAR(VAR, VAR)).VAR(VAR); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR(VAR.VAR()).VAR(VAR); VAR(VAR.VAR.VAR(VAR.VAR, VAR, VAR)).VAR(VAR); VAR.VAR.VAR(VAR, VAR, VAR); VAR VAR = VAR.VAR.VAR(); VAR<VAR> VAR = (VAR<VAR>) VAR.VAR(VAR); VAR(VAR.VAR(VAR), VAR); VAR<VAR, VAR<VAR, VAR>> VAR = (VAR<VAR, VAR<VAR, VAR>>) VAR.VAR(VAR + ""VAR""); VAR<VAR, VAR<VAR, VAR>> VAR = VAR VAR<>(); VAR.VAR(VAR, VAR); VAR(VAR, VAR); VAR(VAR.VAR).VAR(VAR.VAR, VAR, VAR); VAR(VAR.VAR).VAR(""VAR"", VAR, VAR); VAR VAR = ""VAR.VAR""; VAR<VAR, VAR> VAR = VAR; VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR(VAR.VAR.VAR(VAR, VAR.VAR)) .VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)).VAR(VAR); VAR VAR = VAR(VAR.VAR); VAR(VAR.VAR.VAR().VAR(VAR, VAR)).VAR(VAR); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR(VAR.VAR()).VAR(VAR); VAR(VAR.VAR.VAR(VAR.VAR, VAR, VAR)).VAR(VAR); VAR.VAR.VAR(VAR, VAR, VAR); VAR = (VAR<VAR>) VAR.VAR(VAR); VAR(VAR.VAR(VAR), VAR); VAR = (VAR<VAR, VAR<VAR, VAR>>) VAR.VAR(VAR + ""VAR""); VAR(VAR, VAR); VAR(VAR.VAR).VAR(VAR.VAR, VAR, VAR); VAR(VAR.VAR, VAR()).VAR(""VAR"", VAR, VAR); VAR(1, VAR.VAR.VAR()); VAR(""VAR VAR VAR [VAR.VAR] VAR VAR VAR VAR VAR VAR VAR "" + ""VAR VAR VAR."", VAR.VAR.VAR(0)); VAR(VAR.VAR.VAR(VAR.VAR, VAR, VAR)).VAR(VAR); VAR.VAR.VAR(VAR, VAR, VAR); VAR<VAR> VAR = VAR VAR<>(); VAR.VAR(VAR); VAR.VAR(VAR); VAR = (VAR<VAR>) VAR.VAR(VAR); VAR(VAR, VAR); VAR = (VAR<VAR, VAR<VAR, VAR>>) VAR.VAR(VAR + ""VAR""); VAR(VAR, VAR); VAR(VAR.VAR, VAR(2)).VAR(VAR.VAR, VAR, VAR); VAR(VAR.VAR).VAR(""VAR"", VAR, VAR); VAR = VAR.VAR(""VAR"", 42); VAR.VAR.VAR(VAR, VAR, VAR); VAR = (VAR<VAR>) VAR.VAR(VAR); VAR(VAR, VAR); VAR = (VAR<VAR, VAR<VAR, VAR>>) VAR.VAR(VAR + ""VAR""); VAR.VAR(VAR, VAR); VAR(VAR, VAR); VAR(VAR.VAR).VAR(""VAR"", VAR, VAR); VAR.VAR.VAR(VAR, VAR, VAR); VAR.VAR(VAR); VAR = (VAR<VAR>) VAR.VAR(VAR); VAR(VAR, VAR); VAR = (VAR<VAR, VAR<VAR, VAR>>) VAR.VAR(VAR + ""VAR""); VAR.VAR(VAR, VAR); VAR(VAR, VAR); VAR(VAR.VAR).VAR(""VAR"", VAR, VAR); } @VAR VAR VAR() { VAR.VAR.VAR(VAR); VAR(VAR.VAR.VAR(VAR)); VAR VAR = VAR(VAR.VAR, ""VAR""); VAR.VAR.VAR(VAR); VAR VAR = VAR.VAR; VAR(VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)); VAR(VAR).VAR(VAR); VAR VAR = VAR(VAR.VAR, ""VAR""); VAR(VAR.VAR(""VAR"")).VAR(""VAR""); VAR<VAR> VAR = VAR VAR<>(); VAR.VAR(VAR(VAR.VAR)); VAR.VAR(VAR); VAR.VAR(VAR(VAR.VAR)); VAR.VAR(VAR); VAR.VAR(VAR); VAR.VAR(VAR(VAR.VAR)); VAR(VAR.VAR(VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)); VAR(VAR.VAR); VAR(VAR.VAR(""VAR"")).VAR(""VAR""); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); VAR(VAR.VAR()).VAR(VAR); VAR(VAR.VAR()).VAR(VAR); VAR(VAR.VAR.VAR(VAR.VAR, VAR, VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)); VAR(VAR.VAR).VAR(VAR.VAR, VAR, VAR); VAR(1, VAR.VAR.VAR()); VAR(""VAR VAR VAR [VAR:VAR.VAR] VAR VAR VAR VAR VAR VAR VAR "" + ""VAR VAR VAR."", VAR.VAR.VAR(0)); VAR(VAR.VAR.VAR(VAR.VAR, VAR, VAR)).VAR(VAR); VAR(VAR.VAR.VAR(VAR)); } } ",5,8
xwiki-platform_fec8e0e53f9fa2c3f1e568cc15b0e972727c803a,xwiki-platform-core/xwiki-platform-administration/xwiki-platform-administration-ui/src/test/java/org/xwiki/administration/AdminSheetPageTest.java,"/*
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
 */
package org.xwiki.administration;

import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.junit.jupiter.api.Test;
import org.xwiki.model.reference.DocumentReference;
import org.xwiki.test.annotation.ComponentList;
import org.xwiki.test.page.HTML50ComponentList;
import org.xwiki.test.page.PageTest;
import org.xwiki.test.page.TestNoScriptMacro;
import org.xwiki.test.page.XWikiSyntax21ComponentList;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;

/**
 * Page test of {@code XWiki.AdminSheet}.
 *
 * @version $Id$
 */
@HTML50ComponentList
@XWikiSyntax21ComponentList
@ComponentList({
    TestNoScriptMacro.class
})
class AdminSheetPageTest extends PageTest
{
    private static final DocumentReference ADMIN_SHEET = new DocumentReference(""xwiki"", ""XWiki"", ""AdminSheet"");

    @Test
    void sectionEscaping() throws Exception
    {
        this.request.put(""section"", ""{{noscript /}}"");
        this.request.put(""viewer"", ""content"");

        Document result = renderHTMLPage(ADMIN_SHEET);
        Element documentTitle = result.getElementById(""document-title"");
        assertNotNull(documentTitle);
        assertEquals(""administration.sectionTitle [{{noscript /}}]"", documentTitle.text());
    }
}",,fec8e0e53f9fa2c3f1e568cc15b0e972727c803a,CVE-2023-46731,fec8e0e53f9fa2c3f1e568cc15b0e972727c803a,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"/* * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. * * VAR VAR VAR VAR; VAR VAR VAR VAR VAR/VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR; VAR VAR 2.1 VAR * VAR VAR, VAR (VAR VAR VAR) VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, * VAR VAR VAR VAR; VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR * VAR VAR VAR VAR VAR VAR VAR. * * VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR VAR; VAR VAR, VAR VAR VAR VAR * VAR VAR, VAR., 51 VAR VAR, VAR VAR, VAR, VAR * 02110-1301 VAR, VAR VAR VAR VAR VAR: VAR: */ VAR VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; VAR VAR VAR.VAR.VAR.VAR.VAR.VAR; /** * VAR VAR VAR {@VAR VAR.VAR}. * * @VAR $VAR$ */ @VAR @VAR @VAR({ VAR.VAR }) VAR VAR VAR VAR { VAR VAR VAR VAR VAR = VAR VAR(""VAR"", ""VAR"", ""VAR""); @VAR VAR VAR() VAR VAR { VAR.VAR.VAR(""VAR"", ""{{VAR /}}""); VAR.VAR.VAR(""VAR"", ""VAR""); VAR VAR = VAR(VAR); VAR VAR = VAR.VAR(""VAR-VAR""); VAR(VAR); VAR(""VAR.VAR [{{VAR /}}]"", VAR.VAR()); } } ",5,8
