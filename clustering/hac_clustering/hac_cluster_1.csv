commit,file,added_code,deleted_code,hash_clean,cve_id,hash,repo_url,rel_type,score,extraction_status,text_norm,cluster_kmeans,cluster_hac
airflow_3570bbfbea69e2965f91b9964ce28bc268c68129,tests/api_connexion/endpoints/test_dag_warning_endpoint.py,"        permissions=[
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG_WARNING),
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG),
        ],  # type: ignore
    create_user(
        app,  # type:ignore
        username=""test_with_dag2_read"",
        role_name=""TestWithDag2Read"",
        permissions=[
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG_WARNING),
            (permissions.ACTION_CAN_READ, f""{permissions.RESOURCE_DAG_PREFIX}dag2""),
        ],  # type: ignore
    )
    delete_user(app, username=""test_with_dag2_read"")  # type: ignore

    def test_should_raise_403_forbidden_when_user_has_no_dag_read_permission(self):
        response = self.client.get(
            ""/api/v1/dagWarnings"",
            environ_overrides={""REMOTE_USER"": ""test_with_dag2_read""},
            query_string={""dag_id"": ""dag1""},
        )
        assert response.status_code == 403","        permissions=[(permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG_WARNING)],  # type: ignore",3570bbfbea69e2965f91b9964ce28bc268c68129,CVE-2023-42780,3570bbfbea69e2965f91b9964ce28bc268c68129,https://github.com/apache/airflow,NVD_GIT_REPOBASED,114,COMPLETED,"VAR=[ (VAR.VAR, VAR.VAR), (VAR.VAR, VAR.VAR), ],  VAR( VAR,  VAR=""VAR"", VAR=""VAR"", VAR=[ (VAR.VAR, VAR.VAR), (VAR.VAR, VAR""{VAR.VAR}VAR""), ],  ) VAR(VAR, VAR=""VAR"")  VAR VAR(VAR): VAR = VAR.VAR.VAR( ""/VAR/VAR/VAR"", VAR={""VAR"": ""VAR""}, VAR={""VAR"": ""VAR""}, ) VAR VAR.VAR == 403 VAR=[(VAR.VAR, VAR.VAR)], ",0,1
airflow_3df1af4c45705d67598753a96debf5619bbfee04,tests/api_connexion/endpoints/test_task_instance_endpoint.py,"from airflow.api_connexion.exceptions import EXCEPTIONS_LINK_MAP
    create_user(
        app,  # type: ignore
        username=""test_read_only_one_dag"",
        role_name=""TestReadOnlyOneDag"",
        permissions=[
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG_RUN),
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_TASK_INSTANCE),
        ],
    )
    # For some reason, ""DAG:example_python_operator"" is not synced when in the above list of perms,
    # so do it manually here:
    app.appbuilder.sm.bulk_sync_roles(
        [
            {
                ""role"": ""TestReadOnlyOneDag"",
                ""perms"": [(permissions.ACTION_CAN_READ, ""DAG:example_python_operator"")],
            }
        ]
    )
    delete_user(app, username=""test_read_only_one_dag"")  # type: ignore
    def test_returns_403_forbidden_when_user_has_access_to_only_some_dags(self, session):
        self.create_task_instances(session=session)
        self.create_task_instances(session=session, dag_id=""example_skip_dag"")
        payload = {""dag_ids"": [""example_python_operator"", ""example_skip_dag""]}

        response = self.client.post(
            ""/api/v1/dags/~/dagRuns/~/taskInstances/list"",
            environ_overrides={""REMOTE_USER"": ""test_read_only_one_dag""},
            json=payload,
        )
        assert response.status_code == 403
        assert response.json == {
            ""detail"": ""User not allowed to access these DAGs: ['example_skip_dag']"",
            ""status"": 403,
            ""title"": ""Forbidden"",
            ""type"": EXCEPTIONS_LINK_MAP[403],
        }
",,3df1af4c45705d67598753a96debf5619bbfee04,CVE-2023-42663,3df1af4c45705d67598753a96debf5619bbfee04,https://github.com/apache/airflow,NVD_GIT_REPOBASED,116,COMPLETED,"VAR VAR.VAR.VAR VAR VAR VAR( VAR,  VAR=""VAR"", VAR=""VAR"", VAR=[ (VAR.VAR, VAR.VAR), (VAR.VAR, VAR.VAR), ], )   VAR.VAR.VAR.VAR( [ { ""VAR"": ""VAR"", ""VAR"": [(VAR.VAR, ""VAR:VAR"")], } ] ) VAR(VAR, VAR=""VAR"")  VAR VAR(VAR, VAR): VAR.VAR(VAR=VAR) VAR.VAR(VAR=VAR, VAR=""VAR"") VAR = {""VAR"": [""VAR"", ""VAR""]} VAR = VAR.VAR.VAR( ""/VAR/VAR/VAR/~/VAR/~/VAR/VAR"", VAR={""VAR"": ""VAR""}, VAR=VAR, ) VAR VAR.VAR == 403 VAR VAR.VAR == { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR: ['VAR']"", ""VAR"": 403, ""VAR"": ""VAR"", ""VAR"": VAR[403], } ",0,1
airflow_4f1b500c47813c54349b7d3e48df0a444fb4826c,airflow/www/auth.py,"import logging
log = logging.getLogger(__name__)

            dag_id_kwargs = kwargs.get(""dag_id"")
            dag_id_args = request.args.get(""dag_id"")
            dag_id_form = request.form.get(""dag_id"")
            dag_id_json = request.json.get(""dag_id"") if request.is_json else None
            all_dag_ids = [dag_id_kwargs, dag_id_args, dag_id_form, dag_id_json]
            unique_dag_ids = set(dag_id for dag_id in all_dag_ids if dag_id is not None)

            if len(unique_dag_ids) > 1:
                log.warning(
                    f""There are different dag_ids passed in the request: {unique_dag_ids}. Returning 403.""
                )
                log.warning(
                    f""kwargs: {dag_id_kwargs}, args: {dag_id_args}, ""
                    f""form: {dag_id_form}, json: {dag_id_json}""
                )
                return (
                    render_template(
                        ""airflow/no_roles_permissions.html"",
                        hostname=get_hostname()
                        if conf.getboolean(""webserver"", ""EXPOSE_HOSTNAME"")
                        else ""redact"",
                        logout_url=get_auth_manager().get_url_logout(),
                    ),
                    403,
                )
            dag_id = unique_dag_ids.pop() if unique_dag_ids else None
","            dag_id = (
                kwargs.get(""dag_id"")
                or request.args.get(""dag_id"")
                or request.form.get(""dag_id"")
                or (request.is_json and request.json.get(""dag_id""))
                or None
            )",4f1b500c47813c54349b7d3e48df0a444fb4826c,CVE-2023-48291,4f1b500c47813c54349b7d3e48df0a444fb4826c,https://github.com/apache/airflow,GHSD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR = VAR.VAR(VAR) VAR = VAR.VAR(""VAR"") VAR = VAR.VAR.VAR(""VAR"") VAR = VAR.VAR.VAR(""VAR"") VAR = VAR.VAR.VAR(""VAR"") VAR VAR.VAR VAR VAR VAR = [VAR, VAR, VAR, VAR] VAR = VAR(VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR) VAR VAR(VAR) > 1: VAR.VAR( VAR""VAR VAR VAR VAR VAR VAR VAR VAR: {VAR}. VAR 403."" ) VAR.VAR( VAR""VAR: {VAR}, VAR: {VAR}, "" VAR""VAR: {VAR}, VAR: {VAR}"" ) VAR ( VAR( ""VAR/VAR.VAR"", VAR=VAR() VAR VAR.VAR(""VAR"", ""VAR"") VAR ""VAR"", VAR=VAR().VAR(), ), 403, ) VAR = VAR.VAR() VAR VAR VAR VAR VAR = ( VAR.VAR(""VAR"") VAR VAR.VAR.VAR(""VAR"") VAR VAR.VAR.VAR(""VAR"") VAR (VAR.VAR VAR VAR.VAR.VAR(""VAR"")) VAR VAR )",0,1
airflow_4f1b500c47813c54349b7d3e48df0a444fb4826c,airflow/www/auth.py,"import logging
log = logging.getLogger(__name__)

            dag_id_kwargs = kwargs.get(""dag_id"")
            dag_id_args = request.args.get(""dag_id"")
            dag_id_form = request.form.get(""dag_id"")
            dag_id_json = request.json.get(""dag_id"") if request.is_json else None
            all_dag_ids = [dag_id_kwargs, dag_id_args, dag_id_form, dag_id_json]
            unique_dag_ids = set(dag_id for dag_id in all_dag_ids if dag_id is not None)

            if len(unique_dag_ids) > 1:
                log.warning(
                    f""There are different dag_ids passed in the request: {unique_dag_ids}. Returning 403.""
                )
                log.warning(
                    f""kwargs: {dag_id_kwargs}, args: {dag_id_args}, ""
                    f""form: {dag_id_form}, json: {dag_id_json}""
                )
                return (
                    render_template(
                        ""airflow/no_roles_permissions.html"",
                        hostname=get_hostname()
                        if conf.getboolean(""webserver"", ""EXPOSE_HOSTNAME"")
                        else ""redact"",
                        logout_url=get_auth_manager().get_url_logout(),
                    ),
                    403,
                )
            dag_id = unique_dag_ids.pop() if unique_dag_ids else None
","            dag_id = (
                kwargs.get(""dag_id"")
                or request.args.get(""dag_id"")
                or request.form.get(""dag_id"")
                or (request.is_json and request.json.get(""dag_id""))
                or None
            )",4f1b500c47813c54349b7d3e48df0a444fb4826c,CVE-2023-42792,4f1b500c47813c54349b7d3e48df0a444fb4826c,https://github.com/apache/airflow,NVD_GIT_REPOBASED,110,COMPLETED,"VAR VAR VAR = VAR.VAR(VAR) VAR = VAR.VAR(""VAR"") VAR = VAR.VAR.VAR(""VAR"") VAR = VAR.VAR.VAR(""VAR"") VAR = VAR.VAR.VAR(""VAR"") VAR VAR.VAR VAR VAR VAR = [VAR, VAR, VAR, VAR] VAR = VAR(VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR) VAR VAR(VAR) > 1: VAR.VAR( VAR""VAR VAR VAR VAR VAR VAR VAR VAR: {VAR}. VAR 403."" ) VAR.VAR( VAR""VAR: {VAR}, VAR: {VAR}, "" VAR""VAR: {VAR}, VAR: {VAR}"" ) VAR ( VAR( ""VAR/VAR.VAR"", VAR=VAR() VAR VAR.VAR(""VAR"", ""VAR"") VAR ""VAR"", VAR=VAR().VAR(), ), 403, ) VAR = VAR.VAR() VAR VAR VAR VAR VAR = ( VAR.VAR(""VAR"") VAR VAR.VAR.VAR(""VAR"") VAR VAR.VAR.VAR(""VAR"") VAR (VAR.VAR VAR VAR.VAR.VAR(""VAR"")) VAR VAR )",0,1
airflow_4f1b500c47813c54349b7d3e48df0a444fb4826c,tests/www/test_auth.py,"# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# ""License""); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# ""AS IS"" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

from __future__ import annotations

from unittest.mock import patch

import pytest

from airflow.security import permissions
from airflow.settings import json
from tests.test_utils.api_connexion_utils import create_user_scope
from tests.www.test_security import SomeBaseView, SomeModelView


@pytest.fixture(scope=""module"")
def app_builder(app):
    app_builder = app.appbuilder
    app_builder.add_view(SomeBaseView, ""SomeBaseView"", category=""BaseViews"")
    app_builder.add_view(SomeModelView, ""SomeModelView"", category=""ModelViews"")
    return app.appbuilder


@pytest.mark.parametrize(
    ""dag_id_args, dag_id_kwargs, dag_id_form, dag_id_json, fail"",
    [
        (""a"", None, None, None, False),
        (None, ""b"", None, None, False),
        (None, None, ""c"", None, False),
        (None, None, None, ""d"", False),
        (""a"", ""a"", None, None, False),
        (""a"", ""a"", ""a"", None, False),
        (""a"", ""a"", ""a"", ""a"", False),
        (None, ""a"", ""a"", ""a"", False),
        (None, None, ""a"", ""a"", False),
        (""a"", None, None, ""a"", False),
        (""a"", None, ""a"", None, False),
        (""a"", None, ""c"", None, True),
        (None, ""b"", ""c"", None, True),
        (None, None, ""c"", ""d"", True),
        (""a"", ""b"", ""c"", ""d"", True),
    ],
)
def test_dag_id_consistency(
    app,
    dag_id_args: str | None,
    dag_id_kwargs: str | None,
    dag_id_form: str | None,
    dag_id_json: str | None,
    fail: bool,
):
    with app.test_request_context() as mock_context:
        from airflow.www.auth import has_access

        mock_context.request.args = {""dag_id"": dag_id_args} if dag_id_args else {}
        kwargs = {""dag_id"": dag_id_kwargs} if dag_id_kwargs else {}
        mock_context.request.form = {""dag_id"": dag_id_form} if dag_id_form else {}
        if dag_id_json:
            mock_context.request._cached_data = json.dumps({""dag_id"": dag_id_json})
            mock_context.request._parsed_content_type = [""application/json""]

        with create_user_scope(
            app,
            username=""test-user"",
            role_name=""limited-role"",
            permissions=[(permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG)],
        ) as user:
            with patch(""airflow.www.security_manager.g"") as mock_g:
                mock_g.user = user

                @has_access(permissions=[(permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG)])
                def test_func(**kwargs):
                    return True

                result = test_func(**kwargs)
                if fail:
                    assert result[1] == 403
                else:
                    assert result is True",,4f1b500c47813c54349b7d3e48df0a444fb4826c,CVE-2023-48291,4f1b500c47813c54349b7d3e48df0a444fb4826c,https://github.com/apache/airflow,GHSD_DIRECT_COMMIT,1337,COMPLETED,"                VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR @VAR.VAR(VAR=""VAR"") VAR VAR(VAR): VAR = VAR.VAR VAR.VAR(VAR, ""VAR"", VAR=""VAR"") VAR.VAR(VAR, ""VAR"", VAR=""VAR"") VAR VAR.VAR @VAR.VAR.VAR( ""VAR, VAR, VAR, VAR, VAR"", [ (""VAR"", VAR, VAR, VAR, VAR), (VAR, ""VAR"", VAR, VAR, VAR), (VAR, VAR, ""VAR"", VAR, VAR), (VAR, VAR, VAR, ""VAR"", VAR), (""VAR"", ""VAR"", VAR, VAR, VAR), (""VAR"", ""VAR"", ""VAR"", VAR, VAR), (""VAR"", ""VAR"", ""VAR"", ""VAR"", VAR), (VAR, ""VAR"", ""VAR"", ""VAR"", VAR), (VAR, VAR, ""VAR"", ""VAR"", VAR), (""VAR"", VAR, VAR, ""VAR"", VAR), (""VAR"", VAR, ""VAR"", VAR, VAR), (""VAR"", VAR, ""VAR"", VAR, VAR), (VAR, ""VAR"", ""VAR"", VAR, VAR), (VAR, VAR, ""VAR"", ""VAR"", VAR), (""VAR"", ""VAR"", ""VAR"", ""VAR"", VAR), ], ) VAR VAR( VAR, VAR: VAR | VAR, VAR: VAR | VAR, VAR: VAR | VAR, VAR: VAR | VAR, VAR: VAR, ): VAR VAR.VAR() VAR VAR: VAR VAR.VAR.VAR VAR VAR VAR.VAR.VAR = {""VAR"": VAR} VAR VAR VAR {} VAR = {""VAR"": VAR} VAR VAR VAR {} VAR.VAR.VAR = {""VAR"": VAR} VAR VAR VAR {} VAR VAR: VAR.VAR.VAR = VAR.VAR({""VAR"": VAR}) VAR.VAR.VAR = [""VAR/VAR""] VAR VAR( VAR, VAR=""VAR-VAR"", VAR=""VAR-VAR"", VAR=[(VAR.VAR, VAR.VAR)], ) VAR VAR: VAR VAR(""VAR.VAR.VAR.VAR"") VAR VAR: VAR.VAR = VAR @VAR(VAR=[(VAR.VAR, VAR.VAR)]) VAR VAR(**VAR): VAR VAR VAR = VAR(**VAR) VAR VAR: VAR VAR[1] == 403 VAR: VAR VAR VAR VAR ",0,1
airflow_4f1b500c47813c54349b7d3e48df0a444fb4826c,tests/www/test_auth.py,"# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# ""License""); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# ""AS IS"" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

from __future__ import annotations

from unittest.mock import patch

import pytest

from airflow.security import permissions
from airflow.settings import json
from tests.test_utils.api_connexion_utils import create_user_scope
from tests.www.test_security import SomeBaseView, SomeModelView


@pytest.fixture(scope=""module"")
def app_builder(app):
    app_builder = app.appbuilder
    app_builder.add_view(SomeBaseView, ""SomeBaseView"", category=""BaseViews"")
    app_builder.add_view(SomeModelView, ""SomeModelView"", category=""ModelViews"")
    return app.appbuilder


@pytest.mark.parametrize(
    ""dag_id_args, dag_id_kwargs, dag_id_form, dag_id_json, fail"",
    [
        (""a"", None, None, None, False),
        (None, ""b"", None, None, False),
        (None, None, ""c"", None, False),
        (None, None, None, ""d"", False),
        (""a"", ""a"", None, None, False),
        (""a"", ""a"", ""a"", None, False),
        (""a"", ""a"", ""a"", ""a"", False),
        (None, ""a"", ""a"", ""a"", False),
        (None, None, ""a"", ""a"", False),
        (""a"", None, None, ""a"", False),
        (""a"", None, ""a"", None, False),
        (""a"", None, ""c"", None, True),
        (None, ""b"", ""c"", None, True),
        (None, None, ""c"", ""d"", True),
        (""a"", ""b"", ""c"", ""d"", True),
    ],
)
def test_dag_id_consistency(
    app,
    dag_id_args: str | None,
    dag_id_kwargs: str | None,
    dag_id_form: str | None,
    dag_id_json: str | None,
    fail: bool,
):
    with app.test_request_context() as mock_context:
        from airflow.www.auth import has_access

        mock_context.request.args = {""dag_id"": dag_id_args} if dag_id_args else {}
        kwargs = {""dag_id"": dag_id_kwargs} if dag_id_kwargs else {}
        mock_context.request.form = {""dag_id"": dag_id_form} if dag_id_form else {}
        if dag_id_json:
            mock_context.request._cached_data = json.dumps({""dag_id"": dag_id_json})
            mock_context.request._parsed_content_type = [""application/json""]

        with create_user_scope(
            app,
            username=""test-user"",
            role_name=""limited-role"",
            permissions=[(permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG)],
        ) as user:
            with patch(""airflow.www.security_manager.g"") as mock_g:
                mock_g.user = user

                @has_access(permissions=[(permissions.ACTION_CAN_READ, permissions.RESOURCE_DAG)])
                def test_func(**kwargs):
                    return True

                result = test_func(**kwargs)
                if fail:
                    assert result[1] == 403
                else:
                    assert result is True",,4f1b500c47813c54349b7d3e48df0a444fb4826c,CVE-2023-42792,4f1b500c47813c54349b7d3e48df0a444fb4826c,https://github.com/apache/airflow,NVD_GIT_REPOBASED,110,COMPLETED,"                VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR @VAR.VAR(VAR=""VAR"") VAR VAR(VAR): VAR = VAR.VAR VAR.VAR(VAR, ""VAR"", VAR=""VAR"") VAR.VAR(VAR, ""VAR"", VAR=""VAR"") VAR VAR.VAR @VAR.VAR.VAR( ""VAR, VAR, VAR, VAR, VAR"", [ (""VAR"", VAR, VAR, VAR, VAR), (VAR, ""VAR"", VAR, VAR, VAR), (VAR, VAR, ""VAR"", VAR, VAR), (VAR, VAR, VAR, ""VAR"", VAR), (""VAR"", ""VAR"", VAR, VAR, VAR), (""VAR"", ""VAR"", ""VAR"", VAR, VAR), (""VAR"", ""VAR"", ""VAR"", ""VAR"", VAR), (VAR, ""VAR"", ""VAR"", ""VAR"", VAR), (VAR, VAR, ""VAR"", ""VAR"", VAR), (""VAR"", VAR, VAR, ""VAR"", VAR), (""VAR"", VAR, ""VAR"", VAR, VAR), (""VAR"", VAR, ""VAR"", VAR, VAR), (VAR, ""VAR"", ""VAR"", VAR, VAR), (VAR, VAR, ""VAR"", ""VAR"", VAR), (""VAR"", ""VAR"", ""VAR"", ""VAR"", VAR), ], ) VAR VAR( VAR, VAR: VAR | VAR, VAR: VAR | VAR, VAR: VAR | VAR, VAR: VAR | VAR, VAR: VAR, ): VAR VAR.VAR() VAR VAR: VAR VAR.VAR.VAR VAR VAR VAR.VAR.VAR = {""VAR"": VAR} VAR VAR VAR {} VAR = {""VAR"": VAR} VAR VAR VAR {} VAR.VAR.VAR = {""VAR"": VAR} VAR VAR VAR {} VAR VAR: VAR.VAR.VAR = VAR.VAR({""VAR"": VAR}) VAR.VAR.VAR = [""VAR/VAR""] VAR VAR( VAR, VAR=""VAR-VAR"", VAR=""VAR-VAR"", VAR=[(VAR.VAR, VAR.VAR)], ) VAR VAR: VAR VAR(""VAR.VAR.VAR.VAR"") VAR VAR: VAR.VAR = VAR @VAR(VAR=[(VAR.VAR, VAR.VAR)]) VAR VAR(**VAR): VAR VAR VAR = VAR(**VAR) VAR VAR: VAR VAR[1] == 403 VAR: VAR VAR VAR VAR ",0,1
airflow_ac65b82eeeeaa670e09a83c7da65cbac7e89f8db,tests/www/views/test_views_tasks.py,"def test_graph_view_without_dag_permission(app, one_dag_perm_user_client):
    url = ""/dags/example_bash_operator/graph""
    resp = one_dag_perm_user_client.get(url, follow_redirects=True)
    assert resp.status_code == 200
    assert resp.request.url == ""http://localhost/dags/example_bash_operator/graph""
    check_content_in_response(""example_bash_operator"", resp)

    url = ""/dags/example_xcom/graph""
    resp = one_dag_perm_user_client.get(url, follow_redirects=True)
    assert resp.status_code == 200
    assert resp.request.url == ""http://localhost/home""
    check_content_in_response(""Access is Denied"", resp)


@pytest.fixture()
def one_dag_perm_user_client(app):
    username = ""test_user_one_dag_perm""
    dag_id = ""example_bash_operator""
    sm = app.appbuilder.sm
    perm = f""{permissions.RESOURCE_DAG_PREFIX}{dag_id}""

    sm.create_permission(permissions.ACTION_CAN_READ, perm)

    create_user(
        app,
        username=username,
        role_name=""User with permission to access only one dag"",
        permissions=[
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_TASK_INSTANCE),
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_TASK_LOG),
            (permissions.ACTION_CAN_READ, permissions.RESOURCE_WEBSITE),
            (permissions.ACTION_CAN_READ, perm),
        ],
    )

    sm.find_user(username=username)

    yield client_with_login(
        app,
        username=username,
        password=username,
    )

    delete_user(app, username=username)  # type: ignore
    delete_roles(app)

",,ac65b82eeeeaa670e09a83c7da65cbac7e89f8db,CVE-2023-35908,ac65b82eeeeaa670e09a83c7da65cbac7e89f8db,https://github.com/apache/airflow,GHSD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR(VAR, VAR): VAR = ""/VAR/VAR/VAR"" VAR = VAR.VAR(VAR, VAR=VAR) VAR VAR.VAR == 200 VAR VAR.VAR.VAR == ""VAR: VAR(""VAR"", VAR) VAR = ""/VAR/VAR/VAR"" VAR = VAR.VAR(VAR, VAR=VAR) VAR VAR.VAR == 200 VAR VAR.VAR.VAR == ""VAR: VAR(""VAR VAR VAR"", VAR) @VAR.VAR() VAR VAR(VAR): VAR = ""VAR"" VAR = ""VAR"" VAR = VAR.VAR.VAR VAR = VAR""{VAR.VAR}{VAR}"" VAR.VAR(VAR.VAR, VAR) VAR( VAR, VAR=VAR, VAR=""VAR VAR VAR VAR VAR VAR VAR VAR"", VAR=[ (VAR.VAR, VAR.VAR), (VAR.VAR, VAR.VAR), (VAR.VAR, VAR.VAR), (VAR.VAR, VAR), ], ) VAR.VAR(VAR=VAR) VAR VAR( VAR, VAR=VAR, VAR=VAR, ) VAR(VAR, VAR=VAR)  VAR(VAR) ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,docker/docker-healthcheck.sh,"#!/bin/bash

# Send a request to the specified URL
response=$(curl --write-out '%{http_code}' --silent --output /dev/null http://localhost:3001/api/ping)

# If the HTTP response code is 200 (OK), the server is up
if [ $response -eq 200 ]; then
    echo ""Server is up""
    exit 0
else
    echo ""Server is down""
    exit 1
fi",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"  VAR=$(VAR --VAR-VAR '%{VAR}' --VAR --VAR /VAR/VAR VAR:  VAR [ $VAR -VAR 200 ]; VAR VAR ""VAR VAR VAR"" VAR 0 VAR VAR ""VAR VAR VAR"" VAR 1 VAR ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,frontend/src/utils/chat/markdown.js,"import { encode as HTMLEncode } from ""he"";
import markdownIt from ""markdown-it"";
const markdown = markdownIt({
  html: true,
  typographer: true,
  highlight: function (str) {
    return `<div class=""whitespace-pre-line w-fit rounded-lg bg-black-900 px-4 pt-10 pb-4 relative font-mono font-normal text-sm text-slate-200""><div class=""w-full flex items-center absolute top-0 left-0 text-slate-200 bg-stone-800 px-4 py-2 text-xs font-sans justify-between rounded-t-md""><button onclick='window.copySnippet();' class=""flex ml-auto gap-2""><svg stroke=""currentColor"" fill=""none"" stroke-width=""2"" viewBox=""0 0 24 24"" stroke-linecap=""round"" stroke-linejoin=""round"" class=""h-4 w-4"" height=""1em"" width=""1em"" xmlns=""http://www.w3.org/2000/svg""><path d=""M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2""></path><rect x=""8"" y=""2"" width=""8"" height=""4"" rx=""1"" ry=""1""></rect></svg>Copy code</button></div><pre class='markdown'>${HTMLEncode(
      str
    )}<pre></div>`;
  },
});

window.copySnippet = function () {
  if (!event?.target) return false;

  const target = event?.target;
  const markdown =
    target.parentElement?.parentElement?.querySelector("".markdown"")?.innerText;
  if (!markdown) return false;

  window.navigator.clipboard.writeText(markdown);
  target.classList.add(""text-green-500"");
  const originalText = target.innerHTML;
  target.innerText = ""Copied!"";
  target.setAttribute(""disabled"", true);

  setTimeout(() => {
    target.classList.remove(""text-green-500"");
    target.innerHTML = originalText;
    target.removeAttribute(""disabled"");
  }, 5000);
};

export default function renderMarkdown(text = """") {
  return markdown.render(text);
}",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR VAR VAR } VAR ""VAR""; VAR VAR VAR ""VAR-VAR""; VAR VAR = VAR({ VAR: VAR, VAR: VAR, VAR: VAR (VAR) { VAR `<VAR VAR=""VAR-VAR-VAR VAR-VAR VAR-VAR VAR-VAR-900 VAR-4 VAR-10 VAR-4 VAR VAR-VAR VAR-VAR VAR-VAR VAR-VAR-200""><VAR VAR=""VAR-VAR VAR VAR-VAR VAR VAR-0 VAR-0 VAR-VAR-200 VAR-VAR-800 VAR-4 VAR-2 VAR-VAR VAR-VAR VAR-VAR VAR-VAR-VAR""><VAR VAR='VAR.VAR();' VAR=""VAR VAR-VAR VAR-2""><VAR VAR=""VAR"" VAR=""VAR"" VAR-VAR=""2"" VAR=""0 0 24 24"" VAR-VAR=""VAR"" VAR-VAR=""VAR"" VAR=""VAR-4 VAR-4"" VAR=""1em"" VAR=""1em"" VAR=""VAR: VAR )}<VAR></VAR>`; }, }); VAR.VAR = VAR () { VAR (!VAR?.VAR) VAR VAR; VAR VAR = VAR?.VAR; VAR VAR = VAR.VAR?.VAR?.VAR("".VAR"")?.VAR; VAR (!VAR) VAR VAR; VAR.VAR.VAR.VAR(VAR); VAR.VAR.VAR(""VAR-VAR-500""); VAR VAR = VAR.VAR; VAR.VAR = ""VAR!""; VAR.VAR(""VAR"", VAR); VAR(() => { VAR.VAR.VAR(""VAR-VAR-500""); VAR.VAR = VAR; VAR.VAR(""VAR""); }, 5000); }; VAR VAR VAR VAR(VAR = """") { VAR VAR.VAR(VAR); } ",16,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,frontend/src/utils/session.js,"import { API_BASE } from ""./constants"";
import { baseHeaders } from ""./request"";

// Checks current localstorage and validates the session based on that.
export default async function validateSessionTokenForUser() {
  const isValidSession = await fetch(`${API_BASE}/system/check-token`, {
    method: ""GET"",
    cache: ""default"",
    headers: baseHeaders(),
  })
    .then((res) => res.status === 200)
    .catch(() => false);

  return isValidSession;
}",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } VAR ""./VAR""; VAR { VAR } VAR ""./VAR"";  VAR VAR VAR VAR VAR() { VAR VAR = VAR VAR(`${VAR}/VAR/VAR-VAR`, { VAR: ""VAR"", VAR: ""VAR"", VAR: VAR(), }) .VAR((VAR) => VAR.VAR === 200) .VAR(() => VAR); VAR VAR; } ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/admin.js,"const { ApiKey } = require(""../models/apiKeys"");
const { Document } = require(""../models/documents"");
const { Invite } = require(""../models/invite"");
const { SystemSettings } = require(""../models/systemSettings"");
const { User } = require(""../models/user"");
const { DocumentVectors } = require(""../models/vectors"");
const { Workspace } = require(""../models/workspace"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { userFromSession, reqBody } = require(""../utils/http"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");

function adminEndpoints(app) {
  if (!app) return;

  app.get(""/admin/users"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }
      const users = (await User.where()).map((user) => {
        const { password, ...rest } = user;
        return rest;
      });
      response.status(200).json({ users });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/admin/users/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const newUserParams = reqBody(request);
        const { user: newUser, error } = await User.create(newUserParams);
        response.status(200).json({ user: newUser, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(""/admin/user/:id"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const { id } = request.params;
      const updates = reqBody(request);
      const { success, error } = await User.update(id, updates);
      response.status(200).json({ success, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/admin/user/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { id } = request.params;
        await User.delete(`id = ${id}`);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/admin/invites"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const invites = await Invite.whereWithUsers();
      response.status(200).json({ invites });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/admin/invite/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { invite, error } = await Invite.create(user.id);
        response.status(200).json({ invite, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/invite/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const { success, error } = await Invite.deactivate(id);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/admin/workspaces"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const workspaces = await Workspace.whereWithUsers();
        response.status(200).json({ workspaces });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspaces/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { name } = reqBody(request);
        const { workspace, message: error } = await Workspace.new(
          name,
          user.id
        );
        response.status(200).json({ workspace, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspaces/:workspaceId/update-users"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { workspaceId } = request.params;
        const { userIds } = reqBody(request);
        const { success, error } = await Workspace.updateUsers(
          workspaceId,
          userIds
        );
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/workspaces/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const VectorDb = getVectorDbClass();
        const workspace = Workspace.get(`id = ${id}`);
        if (!workspace) {
          response.sendStatus(404).end();
          return;
        }

        await Workspace.delete(`id = ${id}`);
        await DocumentVectors.deleteForWorkspace(id);
        await Document.delete(`workspaceId = ${Number(id)}`);
        await WorkspaceChats.delete(`workspaceId = ${Number(id)}`);
        try {
          await VectorDb[""delete-namespace""]({ namespace: workspace.slug });
        } catch (e) {
          console.error(e.message);
        }

        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspace-chats"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { offset = 0 } = reqBody(request);
        const chats = await WorkspaceChats.whereWithData(`id >= ${offset}`, 20);
        const hasPages = (await WorkspaceChats.count()) > 20;
        response.status(200).json({ chats: chats.reverse(), hasPages });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/workspace-chats/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        await WorkspaceChats.delete(`id = ${id}`);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/admin/system-preferences"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const settings = {
          users_can_delete_workspaces:
            (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
              ?.value === ""true"",
          limit_user_messages:
            (await SystemSettings.get(`label = 'limit_user_messages'`))
              ?.value === ""true"",
          message_limit:
            Number(
              (await SystemSettings.get(`label = 'message_limit'`))?.value
            ) || 10,
        };
        response.status(200).json({ settings });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/system-preferences"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const updates = reqBody(request);
        await SystemSettings.updateSettings(updates);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/admin/api-keys"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const apiKeys = await ApiKey.whereWithUser(""id IS NOT NULL"");
      return response.status(200).json({
        apiKeys,
        error: null,
      });
    } catch (error) {
      console.error(error);
      response.status(500).json({
        apiKey: null,
        error: ""Could not find an API Keys."",
      });
    }
  });

  app.post(
    ""/admin/generate-api-key"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { apiKey, error } = await ApiKey.create(user.id);
        return response.status(200).json({
          apiKey,
          error,
        });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/delete-api-key/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { id } = request.params;
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        await ApiKey.delete(`id = ${id}`);
        return response.status(200).end();
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { adminEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = (VAR VAR.VAR()).VAR((VAR) => { VAR { VAR, ...VAR } = VAR; VAR VAR; }); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR { VAR: VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR.VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR(VAR); VAR { VAR, VAR: VAR } = VAR VAR.VAR( VAR, VAR.VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR( VAR, VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(); VAR VAR = VAR.VAR(`VAR = ${VAR}`); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR VAR.VAR(`VAR = ${VAR}`); VAR VAR.VAR(VAR); VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR { VAR VAR[""VAR-VAR""]({ VAR: VAR.VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR); } VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR = 0 } = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR >= ${VAR}`, 20); VAR VAR = (VAR VAR.VAR()) > 20; VAR.VAR(200).VAR({ VAR: VAR.VAR(), VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = { VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ) || 10, }; VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(""VAR VAR VAR VAR""); VAR VAR.VAR(200).VAR({ VAR, VAR: VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."", }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(200).VAR({ VAR, VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR.VAR(`VAR = ${VAR}`); VAR VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/api/admin/index.js,"const { Invite } = require(""../../../models/invite"");
const { SystemSettings } = require(""../../../models/systemSettings"");
const { User } = require(""../../../models/user"");
const { Workspace } = require(""../../../models/workspace"");
const { WorkspaceChats } = require(""../../../models/workspaceChats"");
const { multiUserMode, reqBody } = require(""../../../utils/http"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiAdminEndpoints(app) {
  if (!app) return;

  app.get(""/v1/admin/is-multi-user-mode"", [validApiKey], (_, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""isMultiUser"": true
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    const isMultiUser = multiUserMode(response);
    response.status(200).json({ isMultiUser });
  });

  app.get(""/v1/admin/users"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""users"": [
                {
                  username: ""sample-sam"",
                  role: 'default',
                }
             ]
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const users = (await User.where()).map((user) => {
        const { password, ...rest } = user;
        return rest;
      });
      response.status(200).json({ users });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/users/new"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Create a new user with username and password. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Key pair object that will define the new user to add to the system.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              username: ""sample-sam"",
              password: 'hunter2',
              role: 'default | admin'
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              user: {
                id: 1,
                username: 'sample-sam',
                role: 'default',
              },
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const newUserParams = reqBody(request);
      const { user: newUser, error } = await User.create(newUserParams);
      response.status(200).json({ user: newUser, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/users/:id"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.path = '/v1/admin/users/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the user in the database.',
      required: true,
      type: 'string'
    }
    #swagger.description = 'Update existing user settings. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Key pair object that will update the found user. All fields are optional and will not update unless specified.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              username: ""sample-sam"",
              password: 'hunter2',
              role: 'default | admin',
              suspended: 0,
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const { id } = request.params;
      const updates = reqBody(request);
      const { success, error } = await User.update(id, updates);
      response.status(200).json({ success, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/v1/admin/users/:id"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Delete existing user by id. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.path = '/v1/admin/users/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the user in the database.',
      required: true,
      type: 'string'
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        await User.delete(`id = ${id}`);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/admin/invites"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'List all existing invitations to instance regardless of status. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""invites"": [
                {
                  id: 1,
                  status: ""pending"",
                  code: 'abc-123',
                  claimedBy: null
                }
             ]
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const invites = await Invite.whereWithUsers();
      response.status(200).json({ invites });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/invite/new"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Create a new invite code for someone to use to register with instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              invite: {
                id: 1,
                status: ""pending"",
                code: 'abc-123',
              },
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const { invite, error } = await Invite.create();
      response.status(200).json({ invite, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/v1/admin/invite/:id"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Deactivates (soft-delete) invite by id. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.path = '/v1/admin/invite/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the invite in the database.',
      required: true,
      type: 'string'
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const { success, error } = await Invite.deactivate(id);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/v1/admin/workspaces/:workspaceId/update-users"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.path = '/v1/admin/workspaces/{workspaceId}/update-users'
    #swagger.parameters['workspaceId'] = {
      in: 'path',
      description: 'id of the workspace in the database.',
      required: true,
      type: 'string'
    }
    #swagger.description = 'Overwrite workspace permissions to only be accessible by the given user ids and admins. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Entire array of user ids who can access the workspace. All fields are optional and will not update unless specified.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              userIds: [1,2,4,12],
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { workspaceId } = request.params;
        const { userIds } = reqBody(request);
        const { success, error } = await Workspace.updateUsers(
          workspaceId,
          userIds
        );
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/v1/admin/workspace-chats"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'All chats in the system ordered by most recent. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Page offset to show of workspace chats. All fields are optional and will not update unless specified.',
        required: false,
        type: 'integer',
        content: {
          ""application/json"": {
            example: {
              offset: 2,
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { offset = 0 } = reqBody(request);
        const chats = await WorkspaceChats.whereWithData(`id >= ${offset}`, 20);
        const hasPages = (await WorkspaceChats.count()) > 20;
        response.status(200).json({ chats: chats.reverse(), hasPages });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/admin/preferences"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Show all multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              settings: {
                users_can_delete_workspaces: true,
                limit_user_messages: false,
                message_limit: 10,
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const settings = {
        users_can_delete_workspaces:
          (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
            ?.value === ""true"",
        limit_user_messages:
          (await SystemSettings.get(`label = 'limit_user_messages'`))?.value ===
          ""true"",
        message_limit:
          Number(
            (await SystemSettings.get(`label = 'message_limit'`))?.value
          ) || 10,
      };
      response.status(200).json({ settings });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/v1/admin/preferences"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Update multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
      description: 'Object with setting key and new value to set. All keys are optional and will not update unless specified.',
      required: true,
      type: 'object',
      content: {
        ""application/json"": {
          example: {
            users_can_delete_workspaces: false,
            limit_user_messages: true,
            message_limit: 5,
          }
        }
      }
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const updates = reqBody(request);
        await SystemSettings.updateSettings(updates);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiAdminEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR, VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR/VAR-VAR-VAR-VAR"", [VAR], (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": VAR } } } } }  VAR: { ""$VAR"": "" } } */ VAR VAR = VAR(VAR); VAR.VAR(200).VAR({ VAR }); }); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": [ { VAR: ""VAR-VAR"", VAR: 'VAR', } ] } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = (VAR VAR.VAR()).VAR((VAR) => { VAR { VAR, ...VAR } = VAR; VAR VAR; }); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR-VAR"", VAR: 'VAR', VAR: 'VAR | VAR' } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 1, VAR: 'VAR-VAR', VAR: 'VAR', }, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR { VAR: VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }   VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR-VAR"", VAR: 'VAR', VAR: 'VAR | VAR', VAR: 0, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*     VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": [ { VAR: 1, VAR: ""VAR"", VAR: 'VAR-123', VAR: VAR } ] } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 1, VAR: ""VAR"", VAR: 'VAR-123', }, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*     VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }   VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: [1,2,4,12], } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR( VAR, VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: 2, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR = 0 } = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR >= ${VAR}`, 20); VAR VAR = (VAR VAR.VAR()) > 20; VAR.VAR(200).VAR({ VAR: VAR.VAR(), VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: VAR, VAR: VAR, VAR: 10, } } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = { VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR === ""VAR"", VAR: VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ) || 10, }; VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: VAR, VAR: VAR, VAR: 5, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/api/auth/index.js,"const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiAuthEndpoints(app) {
  if (!app) return;

  app.get(""/v1/auth"", [validApiKey], (_, response) => {
    /*
    #swagger.tags = ['Authentication']
    #swagger.description = 'Verify the attached Authentication header contains a valid API token.'
    #swagger.responses[200] = {
      description: 'Valid auth token was found.',
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              authenticated: true,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    response.status(200).json({ authenticated: true });
  });
}

module.exports = { apiAuthEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR.', VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } } */ VAR.VAR(200).VAR({ VAR: VAR }); }); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/api/document/index.js,"const { Telemetry } = require(""../../../models/telemetry"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");
const { setupMulter } = require(""../../../utils/files/multer"");
const {
  checkPythonAppAlive,
  acceptedFileTypes,
  processDocument,
} = require(""../../../utils/files/documentProcessor"");
const { viewLocalFiles } = require(""../../../utils/files"");
const { handleUploads } = setupMulter();

function apiDocumentEndpoints(app) {
  if (!app) return;

  app.post(
    ""/v1/document/upload"",
    [validApiKey],
    handleUploads.single(""file""),
    async (request, response) => {
      /*
    #swagger.tags = ['Documents']
    #swagger.description = 'Upload a new file to AnythingLLM to be parsed and prepared for embedding.'

    #swagger.requestBody = {
      description: 'File to be uploaded.',
      required: true,
      type: 'file',
      content: {
        ""multipart/form-data"": {
          schema: {
            type: 'object',
            properties: {
              file: {
                type: 'string',
                format: 'binary',
              }
            }
          }
        }
      }
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
      try {
        const { originalname } = request.file;
        const processingOnline = await checkPythonAppAlive();

        if (!processingOnline) {
          response
            .status(500)
            .json({
              success: false,
              error: `Python processing API is not online. Document ${originalname} will not be processed automatically.`,
            })
            .end();
        }

        const { success, reason } = await processDocument(originalname);
        if (!success) {
          response.status(500).json({ success: false, error: reason }).end();
        }

        console.log(
          `Document ${originalname} uploaded processed and successfully. It is now available in documents.`
        );
        await Telemetry.sendTelemetry(""document_uploaded"");
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/documents"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['Documents']
    #swagger.description = 'List of all locally-stored documents in instance'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""localFiles"": {
              ""name"": ""documents"",
              ""type"": ""folder"",
              items: [
                {
                  ""name"": ""my-stored-document.json"",
                  ""type"": ""file"",
                  ""id"": ""bb07c334-4dab-4419-9462-9d00065a49a1"",
                  ""url"": ""file://my-stored-document.txt"",
                  ""title"": ""my-stored-document.txt"",
                  ""cached"": false
                },
              ]
             }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const localFiles = await viewLocalFiles();
      response.status(200).json({ localFiles });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/v1/document/accepted-file-types"",
    [validApiKey],
    async (_, response) => {
      /*
    #swagger.tags = ['Documents']
    #swagger.description = 'Check available filetypes and MIMEs that can be uploaded.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              ""types"": {
                ""application/mbox"": [
                  "".mbox""
                ],
                ""application/pdf"": [
                  "".pdf""
                ],
                ""application/vnd.oasis.opendocument.text"": [
                  "".odt""
                ],
                ""application/vnd.openxmlformats-officedocument.wordprocessingml.document"": [
                  "".docx""
                ],
                ""text/plain"": [
                  "".txt"",
                  "".md""
                ]
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
      try {
        const types = await acceptedFileTypes();
        if (!types) {
          response.sendStatus(404).end();
          return;
        }

        response.status(200).json({ types });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiDocumentEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR, VAR, VAR, } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR.VAR(""VAR""), VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR-VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 'VAR', VAR: 'VAR', } } } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(); VAR (!VAR) { VAR .VAR(500) .VAR({ VAR: VAR, VAR: `VAR VAR VAR VAR VAR VAR. VAR ${VAR} VAR VAR VAR VAR VAR.`, }) .VAR(); } VAR { VAR, VAR } = VAR VAR(VAR); VAR (!VAR) { VAR.VAR(500).VAR({ VAR: VAR, VAR: VAR }).VAR(); } VAR.VAR( `VAR ${VAR} VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR.` ); VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", VAR: [ { ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR-4dab-4419-9462-9d00065a49a1"", ""VAR"": ""VAR: ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": VAR }, ] } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR.VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR.VAR-VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"", "".VAR"" ] } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR(); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/api/system/index.js,"const { SystemSettings } = require(""../../../models/systemSettings"");
const { getVectorDbClass } = require(""../../../utils/helpers"");
const { dumpENV, updateENV } = require(""../../../utils/helpers/updateENV"");
const { reqBody } = require(""../../../utils/http"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiSystemEndpoints(app) {
  if (!app) return;

  app.get(""/v1/system/env-dump"", async (_, response) => {
    /*
   #swagger.tags = ['System Settings']
   #swagger.description = 'Dump all settings to file storage'
   #swagger.responses[403] = {
     schema: {
       ""$ref"": ""#/definitions/InvalidAPIKey""
     }
   }
   */
    try {
      if (process.env.NODE_ENV !== ""production"")
        return response.sendStatus(200).end();
      await dumpENV();
      response.sendStatus(200).end();
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/v1/system"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['System Settings']
    #swagger.description = 'Get all current system settings that are defined.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""settings"": {
                ""VectorDB"": ""pinecone"",
                ""PineConeEnvironment"": ""us-west4-gcp-free"",
                ""PineConeKey"": true,
                ""PineConeIndex"": ""my-pinecone-index"",
                ""LLMProvider"": ""azure"",
                ""[KEY_NAME]"": ""KEY_VALUE"",
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const settings = await SystemSettings.currentSettings();
      response.status(200).json({ settings });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/v1/system/vector-count"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['System Settings']
    #swagger.description = 'Number of all vectors in connected vector database'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""vectorCount"": 5450
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const VectorDb = getVectorDbClass();
      const vectorCount = await VectorDb.totalIndicies();
      response.status(200).json({ vectorCount });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/v1/system/update-env"",
    [validApiKey],
    async (request, response) => {
      /*
      #swagger.tags = ['System Settings']
      #swagger.description = 'Update a system setting or preference.'
      #swagger.requestBody = {
        description: 'Key pair object that matches a valid setting and value. Get keys from GET /v1/system or refer to codebase.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              VectorDB: ""lancedb"",
              AnotherKey: ""updatedValue""
            }
          }
        }
      }
      #swagger.responses[200] = {
        content: {
          ""application/json"": {
            schema: {
              type: 'object',
              example: {
                newValues: {""[ENV_KEY]"": 'Value'},
                error: 'error goes here, otherwise null'
              }
            }
          }
        }
      }
      #swagger.responses[403] = {
        schema: {
          ""$ref"": ""#/definitions/InvalidAPIKey""
        }
      }
      */
      try {
        const body = reqBody(request);
        const { newValues, error } = updateENV(body);
        if (process.env.NODE_ENV === ""production"") await dumpENV();
        response.status(200).json({ newValues, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiSystemEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR, VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR/VAR-VAR"", VAR (VAR, VAR) => { /*    VAR: { ""$VAR"": "" } } */ VAR { VAR (VAR.VAR.VAR !== ""VAR"") VAR VAR.VAR(200).VAR(); VAR VAR(); VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR-VAR-VAR-VAR"", ""VAR"": VAR, ""VAR"": ""VAR-VAR-VAR"", ""VAR"": ""VAR"", ""[VAR]"": ""VAR"", } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": 5450 } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR(); VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR /VAR/VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR"", VAR: ""VAR"" } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: {""[VAR]"": 'VAR'}, VAR: 'VAR VAR VAR, VAR VAR' } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR(VAR); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/chat.js,"const { v4: uuidv4 } = require(""uuid"");
const { reqBody, userFromSession, multiUserMode } = require(""../utils/http"");
const { Workspace } = require(""../models/workspace"");
const { chatWithWorkspace } = require(""../utils/chats"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { SystemSettings } = require(""../models/systemSettings"");
const { Telemetry } = require(""../models/telemetry"");

function chatEndpoints(app) {
  if (!app) return;

  app.post(
    ""/workspace/:slug/chat"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug } = request.params;
        const { message, mode = ""query"" } = reqBody(request);
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = '${slug}'`)
          : await Workspace.get(`slug = '${slug}'`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        if (multiUserMode(response) && user.role !== ""admin"") {
          const limitMessages =
            (await SystemSettings.get(`label = 'limit_user_messages'`))
              ?.value === ""true"";

          if (limitMessages) {
            const systemLimit = Number(
              (await SystemSettings.get(`label = 'message_limit'`))?.value
            );
            if (!!systemLimit) {
              const currentChatCount = await WorkspaceChats.count(
                `user_id = ${user.id} AND createdAt > datetime(CURRENT_TIMESTAMP, '-1 days')`
              );
              if (currentChatCount >= systemLimit) {
                response.status(500).json({
                  id: uuidv4(),
                  type: ""abort"",
                  textResponse: null,
                  sources: [],
                  close: true,
                  error: `You have met your maximum 24 hour chat quota of ${systemLimit} chats set by the instance administrators. Try again later.`,
                });
                return;
              }
            }
          }
        }

        const result = await chatWithWorkspace(workspace, message, mode, user);
        await Telemetry.sendTelemetry(""sent_chat"", {
          multiUserMode: multiUserMode(response),
          LLMSelection: process.env.LLM_PROVIDER || ""openai"",
          VectorDbSelection: process.env.VECTOR_DB || ""pinecone"",
        });
        response.status(200).json({ ...result });
      } catch (e) {
        response.status(500).json({
          id: uuidv4(),
          type: ""abort"",
          textResponse: null,
          sources: [],
          close: true,
          error: e.message,
        });
      }
    }
  );
}

module.exports = { chatEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR: VAR } = VAR(""VAR""); VAR { VAR, VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR } = VAR.VAR; VAR { VAR, VAR = ""VAR"" } = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = '${VAR}'`) : VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR (VAR(VAR) && VAR.VAR !== ""VAR"") { VAR VAR = (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR""; VAR (VAR) { VAR VAR = VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ); VAR (!!VAR) { VAR VAR = VAR VAR.VAR( `VAR = ${VAR.VAR} VAR VAR > VAR(VAR, '-1 VAR')` ); VAR (VAR >= VAR) { VAR.VAR(500).VAR({ VAR: VAR(), VAR: ""VAR"", VAR: VAR, VAR: [], VAR: VAR, VAR: `VAR VAR VAR VAR VAR 24 VAR VAR VAR VAR ${VAR} VAR VAR VAR VAR VAR VAR. VAR VAR VAR.`, }); VAR; } } } } VAR VAR = VAR VAR(VAR, VAR, VAR, VAR); VAR VAR.VAR(""VAR"", { VAR: VAR(VAR), VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR.VAR.VAR || ""VAR"", }); VAR.VAR(200).VAR({ ...VAR }); } VAR (VAR) { VAR.VAR(500).VAR({ VAR: VAR(), VAR: ""VAR"", VAR: VAR, VAR: [], VAR: VAR, VAR: VAR.VAR, }); } } ); } VAR.VAR = { VAR }; ",16,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/invite.js,"const { Invite } = require(""../models/invite"");
const { User } = require(""../models/user"");
const { reqBody } = require(""../utils/http"");

function inviteEndpoints(app) {
  if (!app) return;

  app.get(""/invite/:code"", async (request, response) => {
    try {
      const { code } = request.params;
      const invite = await Invite.get(`code = '${code}'`);
      if (!invite) {
        response.status(200).json({ invite: null, error: ""Invite not found."" });
        return;
      }

      if (invite.status !== ""pending"") {
        response
          .status(200)
          .json({ invite: null, error: ""Invite is no longer valid."" });
        return;
      }

      response
        .status(200)
        .json({ invite: { code, status: invite.status }, error: null });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/invite/:code"", async (request, response) => {
    try {
      const { code } = request.params;
      const userParams = reqBody(request);
      const invite = await Invite.get(`code = '${code}'`);
      if (!invite || invite.status !== ""pending"") {
        response
          .status(200)
          .json({ success: false, error: ""Invite not found or is invalid."" });
        return;
      }

      const { user, error } = await User.create(userParams);
      if (!user) {
        console.error(""Accepting invite:"", error);
        response
          .status(200)
          .json({ success: false, error: ""Could not create user."" });
        return;
      }

      await Invite.markClaimed(invite.id, user);
      response.status(200).json({ success: true, error: null });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });
}

module.exports = { inviteEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR VAR VAR."" }); VAR; } VAR (VAR.VAR !== ""VAR"") { VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR."" }); VAR; } VAR .VAR(200) .VAR({ VAR: { VAR, VAR: VAR.VAR }, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR || VAR.VAR !== ""VAR"") { VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."" }); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR (!VAR) { VAR.VAR(""VAR VAR:"", VAR); VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."" }); VAR; } VAR VAR.VAR(VAR.VAR, VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/system.js,"process.env.NODE_ENV === ""development""
  ? require(""dotenv"").config({ path: `.env.${process.env.NODE_ENV}` })
  : require(""dotenv"").config();
const { validateTablePragmas } = require(""../utils/database"");
const { viewLocalFiles } = require(""../utils/files"");
const { exportData, unpackAndOverwriteImport } = require(""../utils/files/data"");
const {
  checkPythonAppAlive,
  acceptedFileTypes,
} = require(""../utils/files/documentProcessor"");
const { purgeDocument } = require(""../utils/files/purgeDocument"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { updateENV, dumpENV } = require(""../utils/helpers/updateENV"");
const {
  reqBody,
  makeJWT,
  userFromSession,
  multiUserMode,
} = require(""../utils/http"");
const { setupDataImports, setupLogoUploads } = require(""../utils/files/multer"");
const { v4 } = require(""uuid"");
const { SystemSettings } = require(""../models/systemSettings"");
const { User } = require(""../models/user"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { handleImports } = setupDataImports();
const { handleLogoUploads } = setupLogoUploads();
const fs = require(""fs"");
const path = require(""path"");
const {
  getDefaultFilename,
  determineLogoFilepath,
  fetchLogo,
  validFilename,
  renameLogoFile,
  removeCustomLogo,
  DARK_LOGO_FILENAME,
} = require(""../utils/files/logo"");
const { Telemetry } = require(""../models/telemetry"");
const { WelcomeMessages } = require(""../models/welcomeMessages"");
const { ApiKey } = require(""../models/apiKeys"");

function systemEndpoints(app) {
  if (!app) return;

  app.get(""/ping"", (_, response) => {
    response.status(200).json({ online: true });
  });

  app.get(""/migrate"", async (_, response) => {
    await validateTablePragmas(true);
    response.sendStatus(200);
  });

  app.get(""/env-dump"", async (_, response) => {
    if (process.env.NODE_ENV !== ""production"")
      return response.sendStatus(200).end();
    await dumpENV();
    response.sendStatus(200).end();
  });

  app.get(""/setup-complete"", async (_, response) => {
    try {
      const results = await SystemSettings.currentSettings();
      response.status(200).json({ results });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/check-token"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (multiUserMode(response)) {
          const user = await userFromSession(request, response);
          if (!user || user.suspended) {
            response.sendStatus(403).end();
            return;
          }

          response.sendStatus(200).end();
          return;
        }

        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(""/request-token"", async (request, response) => {
    try {
      if (await SystemSettings.isMultiUserMode()) {
        const { username, password } = reqBody(request);
        const existingUser = await User.get(`username = '${username}'`);

        if (!existingUser) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[001] Invalid login credentials."",
          });
          return;
        }

        const bcrypt = require(""bcrypt"");
        if (!bcrypt.compareSync(password, existingUser.password)) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[002] Invalid login credentials."",
          });
          return;
        }

        if (existingUser.suspended) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[004] Account suspended by admin."",
          });
          return;
        }

        response.status(200).json({
          valid: true,
          user: existingUser,
          token: makeJWT(
            { id: existingUser.id, username: existingUser.username },
            ""30d""
          ),
          message: null,
        });
        return;
      } else {
        const { password } = reqBody(request);
        if (password !== process.env.AUTH_TOKEN) {
          response.status(401).json({
            valid: false,
            token: null,
            message: ""[003] Invalid password provided"",
          });
          return;
        }

        response.status(200).json({
          valid: true,
          token: makeJWT({ p: password }, ""30d""),
          message: null,
        });
      }
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/system/system-vectors"", [validatedRequest], async (_, response) => {
    try {
      const VectorDb = getVectorDbClass();
      const vectorCount = await VectorDb.totalIndicies();
      response.status(200).json({ vectorCount });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/system/remove-document"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { name, meta } = reqBody(request);
        await purgeDocument(name, meta);
        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/system/local-files"", [validatedRequest], async (_, response) => {
    try {
      const localFiles = await viewLocalFiles();
      response.status(200).json({ localFiles });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/document-processing-status"",
    [validatedRequest],
    async (_, response) => {
      try {
        const online = await checkPythonAppAlive();
        response.sendStatus(online ? 200 : 503);
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/system/accepted-document-types"",
    [validatedRequest],
    async (_, response) => {
      try {
        const types = await acceptedFileTypes();
        if (!types) {
          response.sendStatus(404).end();
          return;
        }

        response.status(200).json({ types });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/update-env"",
    [validatedRequest],
    async (request, response) => {
      try {
        const body = reqBody(request);
        const { newValues, error } = updateENV(body);
        if (process.env.NODE_ENV === ""production"") await dumpENV();
        response.status(200).json({ newValues, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/update-password"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { usePassword, newPassword } = reqBody(request);
        const { error } = updateENV({
          AuthToken: usePassword ? newPassword : """",
          JWTSecret: usePassword ? v4() : """",
        });
        response.status(200).json({ success: !error, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/enable-multi-user"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { username, password } = reqBody(request);
        const multiUserModeEnabled = await SystemSettings.isMultiUserMode();
        if (multiUserModeEnabled) {
          response.status(200).json({
            success: false,
            error: ""Multi-user mode is already enabled."",
          });
          return;
        }

        const { user, error } = await User.create({
          username,
          password,
          role: ""admin"",
        });
        await SystemSettings.updateSettings({
          multi_user_mode: true,
          users_can_delete_workspaces: false,
          limit_user_messages: false,
          message_limit: 25,
        });
        process.env.AUTH_TOKEN = null;
        process.env.JWT_SECRET = process.env.JWT_SECRET ?? v4(); // Make sure JWT_SECRET is set for JWT issuance.
        await Telemetry.sendTelemetry(""enabled_multi_user_mode"");
        response.status(200).json({ success: !!user, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/system/data-export"", [validatedRequest], async (_, response) => {
    try {
      const { filename, error } = await exportData();
      response.status(200).json({ filename, error });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/data-exports/:filename"",
    [validatedRequest],
    (request, response) => {
      const exportLocation = __dirname + ""/../storage/exports/"";
      const sanitized = path
        .normalize(request.params.filename)
        .replace(/^(\.\.(\/|\\|$))+/, """");
      const finalDestination = path.join(exportLocation, sanitized);

      if (!fs.existsSync(finalDestination)) {
        response.status(404).json({
          error: 404,
          msg: `File ${request.params.filename} does not exist in exports.`,
        });
        return;
      }

      response.download(finalDestination, request.params.filename, (err) => {
        if (err) {
          response.send({
            error: err,
            msg: ""Problem downloading the file"",
          });
        }
      });
    }
  );

  app.post(
    ""/system/data-import"",
    handleImports.single(""file""),
    async function (request, response) {
      const { originalname } = request.file;
      const { success, error } = await unpackAndOverwriteImport(originalname);
      response.status(200).json({ success, error });
    }
  );

  app.get(""/system/logo/:mode?"", async function (request, response) {
    try {
      const defaultFilename = getDefaultFilename(request.params.mode);
      const logoPath = await determineLogoFilepath(defaultFilename);
      const { buffer, size, mime } = fetchLogo(logoPath);
      response.writeHead(200, {
        ""Content-Type"": mime || ""image/png"",
        ""Content-Disposition"": `attachment; filename=${path.basename(
          logoPath
        )}`,
        ""Content-Length"": size,
      });
      response.end(Buffer.from(buffer, ""base64""));
      return;
    } catch (error) {
      console.error(""Error processing the logo request:"", error);
      response.status(500).json({ message: ""Internal server error"" });
    }
  });

  app.post(
    ""/system/upload-logo"",
    [validatedRequest],
    handleLogoUploads.single(""logo""),
    async (request, response) => {
      if (!request.file || !request.file.originalname) {
        return response.status(400).json({ message: ""No logo file provided."" });
      }

      if (!validFilename(request.file.originalname)) {
        return response.status(400).json({
          message: ""Invalid file name. Please choose a different file."",
        });
      }

      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const newFilename = await renameLogoFile(request.file.originalname);
        const existingLogoFilename = await SystemSettings.currentLogoFilename();
        await removeCustomLogo(existingLogoFilename);

        const { success, error } = await SystemSettings.updateSettings({
          logo_filename: newFilename,
        });

        return response.status(success ? 200 : 500).json({
          message: success
            ? ""Logo uploaded successfully.""
            : error || ""Failed to update with new logo."",
        });
      } catch (error) {
        console.error(""Error processing the logo upload:"", error);
        response.status(500).json({ message: ""Error uploading the logo."" });
      }
    }
  );

  app.get(
    ""/system/remove-logo"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const currentLogoFilename = await SystemSettings.currentLogoFilename();
        await removeCustomLogo(currentLogoFilename);
        const { success, error } = await SystemSettings.updateSettings({
          logo_filename: DARK_LOGO_FILENAME,
        });

        return response.status(success ? 200 : 500).json({
          message: success
            ? ""Logo removed successfully.""
            : error || ""Failed to update with new logo."",
        });
      } catch (error) {
        console.error(""Error processing the logo removal:"", error);
        response.status(500).json({ message: ""Error removing the logo."" });
      }
    }
  );

  app.get(
    ""/system/can-delete-workspaces"",
    [validatedRequest],
    async function (request, response) {
      try {
        if (!response.locals.multiUserMode) {
          return response.status(200).json({ canDelete: true });
        }

        if (response.locals.user?.role === ""admin"") {
          return response.status(200).json({ canDelete: true });
        }

        const canDelete = await SystemSettings.canDeleteWorkspaces();
        response.status(200).json({ canDelete });
      } catch (error) {
        console.error(""Error fetching can delete workspaces:"", error);
        response.status(500).json({
          success: false,
          message: ""Internal server error"",
          canDelete: false,
        });
      }
    }
  );

  app.get(""/system/welcome-messages"", async function (request, response) {
    try {
      const welcomeMessages = await WelcomeMessages.getMessages();
      response.status(200).json({ success: true, welcomeMessages });
    } catch (error) {
      console.error(""Error fetching welcome messages:"", error);
      response
        .status(500)
        .json({ success: false, message: ""Internal server error"" });
    }
  });

  app.post(
    ""/system/set-welcome-messages"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const { messages = [] } = reqBody(request);
        if (!Array.isArray(messages)) {
          return response.status(400).json({
            success: false,
            message: ""Invalid message format. Expected an array of messages."",
          });
        }

        await WelcomeMessages.saveAll(messages);
        return response.status(200).json({
          success: true,
          message: ""Welcome messages saved successfully."",
        });
      } catch (error) {
        console.error(""Error processing the welcome messages:"", error);
        response.status(500).json({
          success: true,
          message: ""Error saving the welcome messages."",
        });
      }
    }
  );

  app.get(""/system/api-key"", [validatedRequest], async (_, response) => {
    try {
      if (response.locals.multiUserMode) {
        return response.sendStatus(401).end();
      }

      const apiKey = await ApiKey.get(""id IS NOT NULL"");
      return response.status(200).json({
        apiKey,
        error: null,
      });
    } catch (error) {
      console.error(error);
      response.status(500).json({
        apiKey: null,
        error: ""Could not find an API Key."",
      });
    }
  });

  app.post(
    ""/system/generate-api-key"",
    [validatedRequest],
    async (_, response) => {
      try {
        if (response.locals.multiUserMode) {
          return response.sendStatus(401).end();
        }

        await ApiKey.delete();
        const { apiKey, error } = await ApiKey.create();
        return response.status(200).json({
          apiKey,
          error,
        });
      } catch (error) {
        console.error(error);
        response.status(500).json({
          apiKey: null,
          error: ""Error generating api key."",
        });
      }
    }
  );

  app.delete(""/system/api-key"", [validatedRequest], async (_, response) => {
    try {
      if (response.locals.multiUserMode) {
        return response.sendStatus(401).end();
      }

      await ApiKey.delete();
      return response.status(200).end();
    } catch (error) {
      console.error(error);
      response.status(500).end();
    }
  });
}

module.exports = { systemEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR.VAR === ""VAR"" ? VAR(""VAR"").VAR({ VAR: `.VAR.${VAR.VAR.VAR}` }) : VAR(""VAR"").VAR(); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, VAR, VAR, } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(); VAR { VAR } = VAR(); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR""); VAR { VAR, VAR, VAR, VAR, VAR, VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR"", (VAR, VAR) => { VAR.VAR(200).VAR({ VAR: VAR }); }); VAR.VAR(""/VAR"", VAR (VAR, VAR) => { VAR VAR(VAR); VAR.VAR(200); }); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR (VAR.VAR.VAR !== ""VAR"") VAR VAR.VAR(200).VAR(); VAR VAR(); VAR.VAR(200).VAR(); }); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR(VAR)) { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR.VAR) { VAR.VAR(403).VAR(); VAR; } VAR.VAR(200).VAR(); VAR; } VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR { VAR (VAR VAR.VAR()) { VAR { VAR, VAR } = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[001] VAR VAR VAR."", }); VAR; } VAR VAR = VAR(""VAR""); VAR (!VAR.VAR(VAR, VAR.VAR)) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[002] VAR VAR VAR."", }); VAR; } VAR (VAR.VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[004] VAR VAR VAR VAR."", }); VAR; } VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR( { VAR: VAR.VAR, VAR: VAR.VAR }, ""30d"" ), VAR: VAR, }); VAR; } VAR { VAR { VAR } = VAR(VAR); VAR (VAR !== VAR.VAR.VAR) { VAR.VAR(401).VAR({ VAR: VAR, VAR: VAR, VAR: ""[003] VAR VAR VAR"", }); VAR; } VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR({ VAR: VAR }, ""30d""), VAR: VAR, }); } } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR(); VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR VAR(VAR, VAR); VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR.VAR(VAR ? 200 : 503); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR(VAR); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR { VAR } = VAR({ VAR: VAR ? VAR : """", VAR: VAR ? VAR() : """", }); VAR.VAR(200).VAR({ VAR: !VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR VAR = VAR VAR.VAR(); VAR (VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR-VAR VAR VAR VAR VAR."", }); VAR; } VAR { VAR, VAR } = VAR VAR.VAR({ VAR, VAR, VAR: ""VAR"", }); VAR VAR.VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: 25, }); VAR.VAR.VAR = VAR; VAR.VAR.VAR = VAR.VAR.VAR ?? VAR();  VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: !!VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR/:VAR"", [VAR], (VAR, VAR) => { VAR VAR = VAR + ""/../VAR/VAR/""; VAR VAR = VAR .VAR(VAR.VAR.VAR) .VAR(/^(\.\.(\/|\\|$))+/, """"); VAR VAR = VAR.VAR(VAR, VAR); VAR (!VAR.VAR(VAR)) { VAR.VAR(404).VAR({ VAR: 404, VAR: `VAR ${VAR.VAR.VAR} VAR VAR VAR VAR VAR.`, }); VAR; } VAR.VAR(VAR, VAR.VAR.VAR, (VAR) => { VAR (VAR) { VAR.VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR"", }); } }); } ); VAR.VAR( ""/VAR/VAR-VAR"", VAR.VAR(""VAR""), VAR VAR (VAR, VAR) { VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } ); VAR.VAR(""/VAR/VAR/:VAR?"", VAR VAR (VAR, VAR) { VAR { VAR VAR = VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(VAR); VAR { VAR, VAR, VAR } = VAR(VAR); VAR.VAR(200, { ""VAR-VAR"": VAR || ""VAR/VAR"", ""VAR-VAR"": `VAR; VAR=${VAR.VAR( VAR )}`, ""VAR-VAR"": VAR, }); VAR.VAR(VAR.VAR(VAR, ""VAR"")); VAR; } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR"" }); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR.VAR(""VAR""), VAR (VAR, VAR) => { VAR (!VAR.VAR || !VAR.VAR.VAR) { VAR VAR.VAR(400).VAR({ VAR: ""VAR VAR VAR VAR."" }); } VAR (!VAR(VAR.VAR.VAR)) { VAR VAR.VAR(400).VAR({ VAR: ""VAR VAR VAR. VAR VAR VAR VAR VAR."", }); } VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR(VAR.VAR.VAR); VAR VAR = VAR VAR.VAR(); VAR VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR({ VAR: VAR, }); VAR VAR.VAR(VAR ? 200 : 500).VAR({ VAR: VAR ? ""VAR VAR VAR."" : VAR || ""VAR VAR VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR VAR."" }); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR.VAR(); VAR VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR({ VAR: VAR, }); VAR VAR.VAR(VAR ? 200 : 500).VAR({ VAR: VAR ? ""VAR VAR VAR."" : VAR || ""VAR VAR VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR VAR."" }); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR VAR (VAR, VAR) { VAR { VAR (!VAR.VAR.VAR) { VAR VAR.VAR(200).VAR({ VAR: VAR }); } VAR (VAR.VAR.VAR?.VAR === ""VAR"") { VAR VAR.VAR(200).VAR({ VAR: VAR }); } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR"", VAR: VAR, }); } } ); VAR.VAR(""/VAR/VAR-VAR"", VAR VAR (VAR, VAR) { VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR:"", VAR); VAR .VAR(500) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR"" }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR { VAR = [] } = VAR(VAR); VAR (!VAR.VAR(VAR)) { VAR VAR.VAR(400).VAR({ VAR: VAR, VAR: ""VAR VAR VAR. VAR VAR VAR VAR VAR."", }); } VAR VAR.VAR(VAR); VAR VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR."", }); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR.VAR(""VAR VAR VAR VAR""); VAR VAR.VAR(200).VAR({ VAR, VAR: VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."", }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR.VAR(); VAR { VAR, VAR } = VAR VAR.VAR(); VAR VAR.VAR(200).VAR({ VAR, VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."", }); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR.VAR(); VAR VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/utils.js,"const { SystemSettings } = require(""../models/systemSettings"");

function getGitVersion() {
  try {
    return require(""child_process"")
      .execSync(""git rev-parse HEAD"")
      .toString()
      .trim();
  } catch (e) {
    console.error(""getGitVersion"", e.message);
    return ""--"";
  }
}

function byteToGigaByte(n) {
  return n / Math.pow(10, 9);
}

async function getDiskStorage() {
  try {
    const checkDiskSpace = require(""check-disk-space"").default;
    const { free, size } = await checkDiskSpace(""/"");
    return {
      current: Math.floor(byteToGigaByte(free)),
      capacity: Math.floor(byteToGigaByte(size)),
    };
  } catch {
    return {
      current: null,
      capacity: null,
    };
  }
}

function utilEndpoints(app) {
  if (!app) return;

  app.get(""/utils/metrics"", async (_, response) => {
    try {
      const metrics = {
        online: true,
        version: getGitVersion(),
        mode: (await SystemSettings.isMultiUserMode())
          ? ""multi-user""
          : ""single-user"",
        vectorDB: process.env.VECTOR_DB || ""lancedb"",
        storage: await getDiskStorage(),
      };
      response.status(200).json(metrics);
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });
}

module.exports = { utilEndpoints, getGitVersion };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR() { VAR { VAR VAR(""VAR"") .VAR(""VAR VAR-VAR VAR"") .VAR() .VAR(); } VAR (VAR) { VAR.VAR(""VAR"", VAR.VAR); VAR ""--""; } } VAR VAR(VAR) { VAR VAR / VAR.VAR(10, 9); } VAR VAR VAR() { VAR { VAR VAR = VAR(""VAR-VAR-VAR"").VAR; VAR { VAR, VAR } = VAR VAR(""/""); VAR { VAR: VAR.VAR(VAR(VAR)), VAR: VAR.VAR(VAR(VAR)), }; } VAR { VAR { VAR: VAR, VAR: VAR, }; } } VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = { VAR: VAR, VAR: VAR(), VAR: (VAR VAR.VAR()) ? ""VAR-VAR"" : ""VAR-VAR"", VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR VAR(), }; VAR.VAR(200).VAR(VAR); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR, VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/endpoints/workspaces.js,"const { reqBody, multiUserMode, userFromSession } = require(""../utils/http"");
const { Workspace } = require(""../models/workspace"");
const { Document } = require(""../models/documents"");
const { DocumentVectors } = require(""../models/vectors"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { convertToChatHistory } = require(""../utils/chats"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { setupMulter } = require(""../utils/files/multer"");
const {
  checkPythonAppAlive,
  processDocument,
} = require(""../utils/files/documentProcessor"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { SystemSettings } = require(""../models/systemSettings"");
const { Telemetry } = require(""../models/telemetry"");
const { handleUploads } = setupMulter();

function workspaceEndpoints(app) {
  if (!app) return;

  app.post(""/workspace/new"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      const { name = null } = reqBody(request);
      const { workspace, message } = await Workspace.new(name, user?.id);
      await Telemetry.sendTelemetry(""workspace_created"", {
        multiUserMode: multiUserMode(response),
        LLMSelection: process.env.LLM_PROVIDER || ""openai"",
        VectorDbSelection: process.env.VECTOR_DB || ""pinecone"",
      });
      response.status(200).json({ workspace, message });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/workspace/:slug/update"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug = null } = request.params;
        const data = reqBody(request);
        const currWorkspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = '${slug}'`)
          : await Workspace.get(`slug = '${slug}'`);

        if (!currWorkspace) {
          response.sendStatus(400).end();
          return;
        }

        const { workspace, message } = await Workspace.update(
          currWorkspace.id,
          data
        );
        response.status(200).json({ workspace, message });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/workspace/:slug/upload"",
    handleUploads.single(""file""),
    async function (request, response) {
      const { originalname } = request.file;
      const processingOnline = await checkPythonAppAlive();

      if (!processingOnline) {
        response
          .status(500)
          .json({
            success: false,
            error: `Python processing API is not online. Document ${originalname} will not be processed automatically.`,
          })
          .end();
        return;
      }

      const { success, reason } = await processDocument(originalname);
      if (!success) {
        response.status(500).json({ success: false, error: reason }).end();
        return;
      }

      console.log(
        `Document ${originalname} uploaded processed and successfully. It is now available in documents.`
      );
      await Telemetry.sendTelemetry(""document_uploaded"");
      response.status(200).json({ success: true, error: null });
    }
  );

  app.post(
    ""/workspace/:slug/update-embeddings"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug = null } = request.params;
        const { adds = [], deletes = [] } = reqBody(request);
        const currWorkspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = '${slug}'`)
          : await Workspace.get(`slug = '${slug}'`);

        if (!currWorkspace) {
          response.sendStatus(400).end();
          return;
        }

        await Document.removeDocuments(currWorkspace, deletes);
        await Document.addDocuments(currWorkspace, adds);
        const updatedWorkspace = await Workspace.get(`slug = '${slug}'`);
        response.status(200).json({ workspace: updatedWorkspace });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/workspace/:slug"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { slug = """" } = request.params;
        const user = await userFromSession(request, response);
        const VectorDb = getVectorDbClass();
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = '${slug}'`)
          : await Workspace.get(`slug = '${slug}'`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        if (multiUserMode(response) && user.role !== ""admin"") {
          const canDelete =
            (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
              ?.value === ""true"";
          if (!canDelete) {
            response.sendStatus(500).end();
            return;
          }
        }

        await Workspace.delete(`slug = '${slug.toLowerCase()}'`);
        await DocumentVectors.deleteForWorkspace(workspace.id);
        await Document.delete(`workspaceId = ${Number(workspace.id)}`);
        await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);
        try {
          await VectorDb[""delete-namespace""]({ namespace: slug });
        } catch (e) {
          console.error(e.message);
        }
        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/workspaces"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      const workspaces = multiUserMode(response)
        ? await Workspace.whereWithUser(user)
        : await Workspace.where();

      response.status(200).json({ workspaces });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/workspace/:slug"", [validatedRequest], async (request, response) => {
    try {
      const { slug } = request.params;
      const user = await userFromSession(request, response);
      const workspace = multiUserMode(response)
        ? await Workspace.getWithUser(user, `slug = '${slug}'`)
        : await Workspace.get(`slug = '${slug}'`);

      response.status(200).json({ workspace });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/workspace/:slug/chats"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { slug } = request.params;
        const user = await userFromSession(request, response);
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = '${slug}'`)
          : await Workspace.get(`slug = '${slug}'`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        const history = multiUserMode(response)
          ? await WorkspaceChats.forWorkspaceByUser(workspace.id, user.id)
          : await WorkspaceChats.forWorkspace(workspace.id);

        response.status(200).json({ history: convertToChatHistory(history) });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { workspaceEndpoints };",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR, VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR?.VAR); VAR VAR.VAR(""VAR"", { VAR: VAR(VAR), VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR.VAR.VAR || ""VAR"", }); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = '${VAR}'`) : VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR( VAR.VAR, VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/:VAR/VAR"", VAR.VAR(""VAR""), VAR VAR (VAR, VAR) { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(); VAR (!VAR) { VAR .VAR(500) .VAR({ VAR: VAR, VAR: `VAR VAR VAR VAR VAR VAR. VAR ${VAR} VAR VAR VAR VAR VAR.`, }) .VAR(); VAR; } VAR { VAR, VAR } = VAR VAR(VAR); VAR (!VAR) { VAR.VAR(500).VAR({ VAR: VAR, VAR: VAR }).VAR(); VAR; } VAR.VAR( `VAR ${VAR} VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR.` ); VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } ); VAR.VAR( ""/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR.VAR; VAR { VAR = [], VAR = [] } = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = '${VAR}'`) : VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR VAR.VAR(VAR, VAR); VAR VAR.VAR(VAR, VAR); VAR VAR = VAR VAR.VAR(`VAR = '${VAR}'`); VAR.VAR(200).VAR({ VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR = """" } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = '${VAR}'`) : VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR (VAR(VAR) && VAR.VAR !== ""VAR"") { VAR VAR = (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR""; VAR (!VAR) { VAR.VAR(500).VAR(); VAR; } } VAR VAR.VAR(`VAR = '${VAR.VAR()}'`); VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR { VAR VAR[""VAR-VAR""]({ VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR); } VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR) : VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = '${VAR}'`) : VAR VAR.VAR(`VAR = '${VAR}'`); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = '${VAR}'`) : VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR.VAR, VAR.VAR) : VAR VAR.VAR(VAR.VAR); VAR.VAR(200).VAR({ VAR: VAR(VAR) }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/index.js,"process.env.NODE_ENV === ""development""
  ? require(""dotenv"").config({ path: `.env.${process.env.NODE_ENV}` })
  : require(""dotenv"").config();

const express = require(""express"");
const bodyParser = require(""body-parser"");
const serveIndex = require(""serve-index"");
const cors = require(""cors"");
const path = require(""path"");
const { reqBody } = require(""./utils/http"");
const { systemEndpoints } = require(""./endpoints/system"");
const { workspaceEndpoints } = require(""./endpoints/workspaces"");
const { chatEndpoints } = require(""./endpoints/chat"");
const { getVectorDbClass } = require(""./utils/helpers"");
const { validateTablePragmas, setupTelemetry } = require(""./utils/database"");
const { adminEndpoints } = require(""./endpoints/admin"");
const { inviteEndpoints } = require(""./endpoints/invite"");
const { utilEndpoints } = require(""./endpoints/utils"");
const { Telemetry } = require(""./models/telemetry"");
const { developerEndpoints } = require(""./endpoints/api"");
const app = express();
const apiRouter = express.Router();
const FILE_LIMIT = ""3GB"";

app.use(cors({ origin: true }));
app.use(bodyParser.text({ limit: FILE_LIMIT }));
app.use(bodyParser.json({ limit: FILE_LIMIT }));
app.use(
  bodyParser.urlencoded({
    limit: FILE_LIMIT,
    extended: true,
  })
);

app.use(""/api"", apiRouter);
systemEndpoints(apiRouter);
workspaceEndpoints(apiRouter);
chatEndpoints(apiRouter);
adminEndpoints(apiRouter);
inviteEndpoints(apiRouter);
utilEndpoints(apiRouter);
developerEndpoints(app, apiRouter);

apiRouter.post(""/v/:command"", async (request, response) => {
  try {
    const VectorDb = getVectorDbClass();
    const { command } = request.params;
    if (!Object.getOwnPropertyNames(VectorDb).includes(command)) {
      response.status(500).json({
        message: ""invalid interface command"",
        commands: Object.getOwnPropertyNames(VectorDb),
      });
      return;
    }

    try {
      const body = reqBody(request);
      const resBody = await VectorDb[command](body);
      response.status(200).json({ ...resBody });
    } catch (e) {
      // console.error(e)
      console.error(JSON.stringify(e));
      response.status(500).json({ error: e.message });
    }
    return;
  } catch (e) {
    console.log(e.message, e);
    response.sendStatus(500).end();
  }
});

if (process.env.NODE_ENV !== ""development"") {
  app.use(
    express.static(path.resolve(__dirname, ""public""), { extensions: [""js""] })
  );

  app.use(""/"", function (_, response) {
    response.sendFile(path.join(__dirname, ""public"", ""index.html""));
  });
}

app.use(
  ""/system/data-exports"",
  serveIndex(__dirname + ""/storage/exports"", { icons: true })
);

app.all(""*"", function (_, response) {
  response.sendStatus(404);
});

app
  .listen(process.env.SERVER_PORT || 3001, async () => {
    await validateTablePragmas();
    await setupTelemetry();
    console.log(
      `Example app listening on port ${process.env.SERVER_PORT || 3001}`
    );
  })
  .on(""error"", function (err) {
    process.once(""SIGUSR2"", function () {
      Telemetry.flush();
      process.kill(process.pid, ""SIGUSR2"");
    });
    process.on(""SIGINT"", function () {
      Telemetry.flush();
      process.kill(process.pid, ""SIGINT"");
    });
  });",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR.VAR === ""VAR"" ? VAR(""VAR"").VAR({ VAR: `.VAR.${VAR.VAR.VAR}` }) : VAR(""VAR"").VAR(); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR-VAR""); VAR VAR = VAR(""VAR-VAR""); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR, VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR VAR = VAR(); VAR VAR = VAR.VAR(); VAR VAR = ""3GB""; VAR.VAR(VAR({ VAR: VAR })); VAR.VAR(VAR.VAR({ VAR: VAR })); VAR.VAR(VAR.VAR({ VAR: VAR })); VAR.VAR( VAR.VAR({ VAR: VAR, VAR: VAR, }) ); VAR.VAR(""/VAR"", VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR, VAR); VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = VAR(); VAR { VAR } = VAR.VAR; VAR (!VAR.VAR(VAR).VAR(VAR)) { VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR"", VAR: VAR.VAR(VAR), }); VAR; } VAR { VAR VAR = VAR(VAR); VAR VAR = VAR VAR[VAR](VAR); VAR.VAR(200).VAR({ ...VAR }); } VAR (VAR) {  VAR.VAR(VAR.VAR(VAR)); VAR.VAR(500).VAR({ VAR: VAR.VAR }); } VAR; } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR (VAR.VAR.VAR !== ""VAR"") { VAR.VAR( VAR.VAR(VAR.VAR(VAR, ""VAR""), { VAR: [""VAR""] }) ); VAR.VAR(""/"", VAR (VAR, VAR) { VAR.VAR(VAR.VAR(VAR, ""VAR"", ""VAR.VAR"")); }); } VAR.VAR( ""/VAR/VAR-VAR"", VAR(VAR + ""/VAR/VAR"", { VAR: VAR }) ); VAR.VAR(""*"", VAR (VAR, VAR) { VAR.VAR(404); }); VAR .VAR(VAR.VAR.VAR || 3001, VAR () => { VAR VAR(); VAR VAR(); VAR.VAR( `VAR VAR VAR VAR VAR ${VAR.VAR.VAR || 3001}` ); }) .VAR(""VAR"", VAR (VAR) { VAR.VAR(""VAR"", VAR () { VAR.VAR(); VAR.VAR(VAR.VAR, ""VAR""); }); VAR.VAR(""VAR"", VAR () { VAR.VAR(); VAR.VAR(VAR.VAR, ""VAR""); }); }); ",0,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/swagger/openapi.json,"{
  ""openapi"": ""3.0.0"",
  ""info"": {
    ""version"": ""1.0.0"",
    ""title"": ""AnythingLLM Developer API"",
    ""description"": ""API endpoints that enable programmatic reading, writing, and updating of your AnythingLLM instance. UI supplied by Swagger.io.""
  },
  ""servers"": [
    {
      ""url"": ""http:///api/""
    }
  ],
  ""paths"": {
    ""/v1/auth"": {
      ""get"": {
        ""tags"": [
          ""Authentication""
        ],
        ""description"": ""Verify the attached Authentication header contains a valid API token."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""Valid auth token was found."",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""authenticated"": true
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          }
        }
      }
    },
    ""/v1/admin/is-multi-user-mode"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""isMultiUser"": true
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          }
        }
      }
    },
    ""/v1/admin/users"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""users"": [
                      {
                        ""username"": ""sample-sam"",
                        ""role"": ""default""
                      }
                    ]
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/users/new"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Create a new user with username and password. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""user"": {
                      ""id"": 1,
                      ""username"": ""sample-sam"",
                      ""role"": ""default""
                    },
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that will define the new user to add to the system."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""username"": ""sample-sam"",
                ""password"": ""hunter2"",
                ""role"": ""default | admin""
              }
            }
          }
        }
      }
    },
    ""/v1/admin/users/{id}"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Update existing user settings. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the user in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that will update the found user. All fields are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""username"": ""sample-sam"",
                ""password"": ""hunter2"",
                ""role"": ""default | admin"",
                ""suspended"": 0
              }
            }
          }
        }
      },
      ""delete"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Delete existing user by id. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the user in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invites"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""List all existing invitations to instance regardless of status. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""invites"": [
                      {
                        ""id"": 1,
                        ""status"": ""pending"",
                        ""code"": ""abc-123"",
                        ""claimedBy"": null
                      }
                    ]
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invite/new"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Create a new invite code for someone to use to register with instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""invite"": {
                      ""id"": 1,
                      ""status"": ""pending"",
                      ""code"": ""abc-123""
                    },
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invite/{id}"": {
      ""delete"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Deactivates (soft-delete) invite by id. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the invite in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/workspaces/{workspaceId}/update-users"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Overwrite workspace permissions to only be accessible by the given user ids and admins. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""workspaceId"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the workspace in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Entire array of user ids who can access the workspace. All fields are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""userIds"": [
                  1,
                  2,
                  4,
                  12
                ]
              }
            }
          }
        }
      }
    },
    ""/v1/admin/workspace-chats"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""All chats in the system ordered by most recent. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Page offset to show of workspace chats. All fields are optional and will not update unless specified."",
          ""required"": false,
          ""type"": ""integer"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""offset"": 2
              }
            }
          }
        }
      }
    },
    ""/v1/admin/preferences"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Show all multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""settings"": {
                      ""users_can_delete_workspaces"": true,
                      ""limit_user_messages"": false,
                      ""message_limit"": 10
                    }
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      },
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Update multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Object with setting key and new value to set. All keys are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""users_can_delete_workspaces"": false,
                ""limit_user_messages"": true,
                ""message_limit"": 5
              }
            }
          }
        }
      }
    },
    ""/v1/document/upload"": {
      ""post"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""Upload a new file to AnythingLLM to be parsed and prepared for embedding."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""File to be uploaded."",
          ""required"": true,
          ""type"": ""file"",
          ""content"": {
            ""multipart/form-data"": {
              ""schema"": {
                ""type"": ""object"",
                ""properties"": {
                  ""file"": {
                    ""type"": ""string"",
                    ""format"": ""binary""
                  }
                }
              }
            }
          }
        }
      }
    },
    ""/v1/documents"": {
      ""get"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""List of all locally-stored documents in instance"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""localFiles"": {
                      ""name"": ""documents"",
                      ""type"": ""folder"",
                      ""items"": [
                        {
                          ""name"": ""my-stored-document.json"",
                          ""type"": ""file"",
                          ""id"": ""bb07c334-4dab-4419-9462-9d00065a49a1"",
                          ""url"": ""file://my-stored-document.txt"",
                          ""title"": ""my-stored-document.txt"",
                          ""cached"": false
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/document/accepted-file-types"": {
      ""get"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""Check available filetypes and MIMEs that can be uploaded."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""types"": {
                      ""application/mbox"": [
                        "".mbox""
                      ],
                      ""application/pdf"": [
                        "".pdf""
                      ],
                      ""application/vnd.oasis.opendocument.text"": [
                        "".odt""
                      ],
                      ""application/vnd.openxmlformats-officedocument.wordprocessingml.document"": [
                        "".docx""
                      ],
                      ""text/plain"": [
                        "".txt"",
                        "".md""
                      ]
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""404"": {
            ""description"": ""Not Found""
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/new"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Create a new workspace"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""Sample workspace"",
                      ""slug"": ""sample-workspace"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null
                    },
                    ""message"": ""Workspace created""
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object containing new display name of workspace."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""name"": ""My New Workspace""
              }
            }
          }
        }
      }
    },
    ""/v1/workspaces"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""List all current workspaces"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspaces"": [
                      {
                        ""id"": 79,
                        ""name"": ""Sample workspace"",
                        ""slug"": ""sample-workspace"",
                        ""createdAt"": ""2023-08-17 00:45:03"",
                        ""openAiTemp"": null,
                        ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                        ""openAiHistory"": 20,
                        ""openAiPrompt"": null
                      }
                    ]
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Get a workspace by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      },
      ""delete"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Deletes a workspace by its slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to delete""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK""
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}/update"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Update workspace settings by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    },
                    ""message"": null
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object containing new settings to update a workspace. All keys are optional and will not update unless provided"",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""name"": ""Updated Workspace Name"",
                ""openAiTemp"": 0.2,
                ""openAiHistory"": 20,
                ""openAiPrompt"": ""Respond to all inquires and questions in binary - do not respond in any other format.""
              }
            }
          }
        }
      }
    },
    ""/v1/workspace/{slug}/chats"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Get a workspaces chats regardless of user by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""history"": [
                      {
                        ""role"": ""user"",
                        ""content"": ""What is AnythingLLM?"",
                        ""sentAt"": 1692851630
                      },
                      {
                        ""role"": ""assistant"",
                        ""content"": ""AnythingLLM is a platform that allows you to convert notes, PDFs, and other source materials into a chatbot. It ensures privacy, cites its answers, and allows multiple people to interact with the same documents simultaneously. It is particularly useful for businesses to enhance the visibility and readability of various written communications such as SOPs, contracts, and sales calls. You can try it out with a free trial to see if it meets your business needs."",
                        ""sources"": [
                          {
                            ""source"": ""object about source document and snippets used""
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}/update-embeddings"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Add or remove documents from a workspace by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    },
                    ""message"": null
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object of additions and removals of documents to add to update a workspace. The value should be the folder + filename with the exclusions of the top-level documents path."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""adds"": [],
                ""deletes"": [
                  ""custom-documents/anythingllm-hash.json""
                ]
              }
            }
          }
        }
      }
    },
    ""/v1/system/env-dump"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Dump all settings to file storage"",
        ""responses"": {
          ""200"": {
            ""description"": ""OK""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Get all current system settings that are defined."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""settings"": {
                      ""VectorDB"": ""pinecone"",
                      ""PineConeEnvironment"": ""us-west4-gcp-free"",
                      ""PineConeKey"": true,
                      ""PineConeIndex"": ""my-pinecone-index"",
                      ""LLMProvider"": ""azure"",
                      ""[KEY_NAME]"": ""KEY_VALUE""
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system/vector-count"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Number of all vectors in connected vector database"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""vectorCount"": 5450
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system/update-env"": {
      ""post"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Update a system setting or preference."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""newValues"": {
                      ""[ENV_KEY]"": ""Value""
                    },
                    ""error"": ""error goes here, otherwise null""
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that matches a valid setting and value. Get keys from GET /v1/system or refer to codebase."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""VectorDB"": ""lancedb"",
                ""AnotherKey"": ""updatedValue""
              }
            }
          }
        }
      }
    }
  },
  ""components"": {
    ""schemas"": {
      ""InvalidAPIKey"": {
        ""type"": ""object"",
        ""properties"": {
          ""message"": {
            ""type"": ""string"",
            ""example"": ""Invalid API Key""
          }
        },
        ""xml"": {
          ""name"": ""InvalidAPIKey""
        }
      }
    },
    ""securitySchemes"": {
      ""BearerAuth"": {
        ""type"": ""http"",
        ""scheme"": ""bearer"",
        ""bearerFormat"": ""JWT""
      }
    }
  },
  ""security"": [
    {
      ""BearerAuth"": []
    }
  ]
}",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"{ ""VAR"": ""3.0.0"", ""VAR"": { ""VAR"": ""1.0.0"", ""VAR"": ""VAR VAR VAR"", ""VAR"": ""VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR.VAR."" }, ""VAR"": [ { ""VAR"": ""VAR: } ], ""VAR"": { ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR VAR VAR VAR VAR."", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } } } } }, ""/VAR/VAR/VAR-VAR-VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"" } ] } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 1, ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"" }, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR | VAR"" } } } } } }, ""/VAR/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR | VAR"", ""VAR"": 0 } } } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": 1, ""VAR"": ""VAR"", ""VAR"": ""VAR-123"", ""VAR"": VAR } ] } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 1, ""VAR"": ""VAR"", ""VAR"": ""VAR-123"" }, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR (VAR-VAR) VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/{VAR}/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": [ 1, 2, 4, 12 ] } } } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": 2 } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR-VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": VAR, ""VAR"": VAR, ""VAR"": 10 } } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR-VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": VAR, ""VAR"": VAR, ""VAR"": 5 } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR-VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } } } } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR-VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": [ { ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR-4dab-4419-9462-9d00065a49a1"", ""VAR"": ""VAR: ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": VAR } ] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR.VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR.VAR-VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"", "".VAR"" ] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""404"": { ""VAR"": ""VAR VAR"" }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR }, ""VAR"": ""VAR VAR"" } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR VAR VAR"" } } } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR } ] } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"" }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] }, ""VAR"": VAR } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR VAR VAR"", ""VAR"": 0.2, ""VAR"": 20, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR - VAR VAR VAR VAR VAR VAR VAR."" } } } } } }, ""/VAR/VAR/{VAR}/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR?"", ""VAR"": 1692851630 }, { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR, VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR"" } ] } ] } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] }, ""VAR"": VAR } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR + VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": [], ""VAR"": [ ""VAR-VAR/VAR-VAR.VAR"" ] } } } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR"", ""VAR"": { ""200"": { ""VAR"": ""VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR-VAR-VAR-VAR"", ""VAR"": VAR, ""VAR"": ""VAR-VAR-VAR"", ""VAR"": ""VAR"", ""[VAR]"": ""VAR"" } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": 5450 } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""[VAR]"": ""VAR"" }, ""VAR"": ""VAR VAR VAR, VAR VAR"" } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR /VAR/VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } } } } } }, ""VAR"": { ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR"" } } }, ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } }, ""VAR"": [ { ""VAR"": [] } ] } ",8,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/utils/middleware/validApiKey.js,"const { ApiKey } = require(""../../models/apiKeys"");
const { SystemSettings } = require(""../../models/systemSettings"");

async function validApiKey(request, response, next) {
  const multiUserMode = await SystemSettings.isMultiUserMode();
  response.locals.multiUserMode = multiUserMode;

  const auth = request.header(""Authorization"");
  const bearerKey = auth ? auth.split("" "")[1] : null;
  if (!bearerKey) {
    response.status(403).json({
      error: ""No valid api key found."",
    });
    return;
  }

  const apiKey = await ApiKey.get(`secret = '${bearerKey}'`);
  if (!apiKey) {
    response.status(403).json({
      error: ""No valid api key found."",
    });
    return;
  }

  next();
}

module.exports = {
  validApiKey,
};",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR VAR.VAR(); VAR.VAR.VAR = VAR; VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR VAR.VAR(`VAR = '${VAR}'`); VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR."", }); VAR; } VAR(); } VAR.VAR = { VAR, }; ",0,1
anything-llm_3c88aec034934bcbad30c5ef1cab62cbbdb98e64,server/utils/middleware/validatedRequest.js,"const { SystemSettings } = require(""../../models/systemSettings"");
const { User } = require(""../../models/user"");
const { decodeJWT } = require(""../http"");

async function validatedRequest(request, response, next) {
  const multiUserMode = await SystemSettings.isMultiUserMode();
  response.locals.multiUserMode = multiUserMode;
  if (multiUserMode)
    return await validateMultiUserRequest(request, response, next);

  // When in development passthrough auth token for ease of development.
  // Or if the user simply did not set an Auth token or JWT Secret
  if (
    process.env.NODE_ENV === ""development"" ||
    !process.env.AUTH_TOKEN ||
    !process.env.JWT_SECRET
  ) {
    next();
    return;
  }

  if (!process.env.AUTH_TOKEN) {
    response.status(403).json({
      error: ""You need to set an AUTH_TOKEN environment variable."",
    });
    return;
  }

  const auth = request.header(""Authorization"");
  const token = auth ? auth.split("" "")[1] : null;

  if (!token) {
    response.status(403).json({
      error: ""No auth token found."",
    });
    return;
  }

  const { p } = decodeJWT(token);
  if (p !== process.env.AUTH_TOKEN) {
    response.status(403).json({
      error: ""Invalid auth token found."",
    });
    return;
  }

  next();
}

async function validateMultiUserRequest(request, response, next) {
  const auth = request.header(""Authorization"");
  const token = auth ? auth.split("" "")[1] : null;

  if (!token) {
    response.status(403).json({
      error: ""No auth token found."",
    });
    return;
  }

  const valid = decodeJWT(token);
  if (!valid || !valid.id) {
    response.status(403).json({
      error: ""Invalid auth token."",
    });
    return;
  }

  const user = await User.get(`id = ${valid.id}`);
  if (!user) {
    response.status(403).json({
      error: ""Invalid auth for user."",
    });
    return;
  }

  response.locals.user = user;
  next();
}

module.exports = {
  validatedRequest,
};",,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,CVE-2023-4897,3c88aec034934bcbad30c5ef1cab62cbbdb98e64,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../VAR""); VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR VAR.VAR(); VAR.VAR.VAR = VAR; VAR (VAR) VAR VAR VAR(VAR, VAR, VAR);   VAR ( VAR.VAR.VAR === ""VAR"" || !VAR.VAR.VAR || !VAR.VAR.VAR ) { VAR(); VAR; } VAR (!VAR.VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR { VAR } = VAR(VAR); VAR (VAR !== VAR.VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR(); } VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR(VAR); VAR (!VAR || !VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR."", }); VAR; } VAR VAR = VAR VAR.VAR(`VAR = ${VAR.VAR}`); VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR.VAR.VAR = VAR; VAR(); } VAR.VAR = { VAR, }; ",0,1
anything-llm_d5b1f84a4c7991987eac3454d4f1b4067841d783,server/endpoints/system.js,"
        // Only admins can update the ENV settings.
        if (multiUserMode(response)) {
          const user = await userFromSession(request, response);
          if (!user || user?.role !== ""admin"") {
            response.sendStatus(401).end();
            return;
          }
        }

        // Cannot update password in multi - user mode.
        if (multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { error } = updateENV(
          {
            AuthToken: usePassword ? newPassword : """",
            JWTSecret: usePassword ? v4() : """",
          },
          true
        );
        if (process.env.NODE_ENV === ""production"") await dumpENV();

        updateENV(
          {
            AuthToken: null,
            JWTSecret: process.env.JWT_SECRET ?? v4(),
          },
          true
        );
        if (process.env.NODE_ENV === ""production"") await dumpENV();","        const { error } = updateENV({
          AuthToken: usePassword ? newPassword : """",
          JWTSecret: usePassword ? v4() : """",
        });
        process.env.AUTH_TOKEN = null;
        process.env.JWT_SECRET = process.env.JWT_SECRET ?? v4(); // Make sure JWT_SECRET is set for JWT issuance.",d5b1f84a4c7991987eac3454d4f1b4067841d783,CVE-2023-5833,d5b1f84a4c7991987eac3454d4f1b4067841d783,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED," VAR (VAR(VAR)) { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } }  VAR (VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR( { VAR: VAR ? VAR : """", VAR: VAR ? VAR() : """", }, VAR ); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR( { VAR: VAR, VAR: VAR.VAR.VAR ?? VAR(), }, VAR ); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR { VAR } = VAR({ VAR: VAR ? VAR : """", VAR: VAR ? VAR() : """", }); VAR.VAR.VAR = VAR; VAR.VAR.VAR = VAR.VAR.VAR ?? VAR(); ",0,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,docker/docker-healthcheck.sh,"#!/bin/bash

# Send a request to the specified URL
response=$(curl --write-out '%{http_code}' --silent --output /dev/null http://localhost:3001/api/ping)

# If the HTTP response code is 200 (OK), the server is up
if [ $response -eq 200 ]; then
    echo ""Server is up""
    exit 0
else
    echo ""Server is down""
    exit 1
fi",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"  VAR=$(VAR --VAR-VAR '%{VAR}' --VAR --VAR /VAR/VAR VAR:  VAR [ $VAR -VAR 200 ]; VAR VAR ""VAR VAR VAR"" VAR 0 VAR VAR ""VAR VAR VAR"" VAR 1 VAR ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,docker/docker-healthcheck.sh,"#!/bin/bash

# Send a request to the specified URL
response=$(curl --write-out '%{http_code}' --silent --output /dev/null http://localhost:3001/api/ping)

# If the HTTP response code is 200 (OK), the server is up
if [ $response -eq 200 ]; then
    echo ""Server is up""
    exit 0
else
    echo ""Server is down""
    exit 1
fi",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"  VAR=$(VAR --VAR-VAR '%{VAR}' --VAR --VAR /VAR/VAR VAR:  VAR [ $VAR -VAR 200 ]; VAR VAR ""VAR VAR VAR"" VAR 0 VAR VAR ""VAR VAR VAR"" VAR 1 VAR ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,frontend/src/utils/chat/markdown.js,"import { encode as HTMLEncode } from ""he"";
import markdownIt from ""markdown-it"";
const markdown = markdownIt({
  html: true,
  typographer: true,
  highlight: function (str) {
    return `<div class=""whitespace-pre-line w-fit rounded-lg bg-black-900 px-4 pt-10 pb-4 relative font-mono font-normal text-sm text-slate-200""><div class=""w-full flex items-center absolute top-0 left-0 text-slate-200 bg-stone-800 px-4 py-2 text-xs font-sans justify-between rounded-t-md""><button onclick='window.copySnippet();' class=""flex ml-auto gap-2""><svg stroke=""currentColor"" fill=""none"" stroke-width=""2"" viewBox=""0 0 24 24"" stroke-linecap=""round"" stroke-linejoin=""round"" class=""h-4 w-4"" height=""1em"" width=""1em"" xmlns=""http://www.w3.org/2000/svg""><path d=""M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2""></path><rect x=""8"" y=""2"" width=""8"" height=""4"" rx=""1"" ry=""1""></rect></svg>Copy code</button></div><pre class='markdown'>${HTMLEncode(
      str
    )}<pre></div>`;
  },
});

window.copySnippet = function () {
  if (!event?.target) return false;

  const target = event?.target;
  const markdown =
    target.parentElement?.parentElement?.querySelector("".markdown"")?.innerText;
  if (!markdown) return false;

  window.navigator.clipboard.writeText(markdown);
  target.classList.add(""text-green-500"");
  const originalText = target.innerHTML;
  target.innerText = ""Copied!"";
  target.setAttribute(""disabled"", true);

  setTimeout(() => {
    target.classList.remove(""text-green-500"");
    target.innerHTML = originalText;
    target.removeAttribute(""disabled"");
  }, 5000);
};

export default function renderMarkdown(text = """") {
  return markdown.render(text);
}",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR VAR VAR } VAR ""VAR""; VAR VAR VAR ""VAR-VAR""; VAR VAR = VAR({ VAR: VAR, VAR: VAR, VAR: VAR (VAR) { VAR `<VAR VAR=""VAR-VAR-VAR VAR-VAR VAR-VAR VAR-VAR-900 VAR-4 VAR-10 VAR-4 VAR VAR-VAR VAR-VAR VAR-VAR VAR-VAR-200""><VAR VAR=""VAR-VAR VAR VAR-VAR VAR VAR-0 VAR-0 VAR-VAR-200 VAR-VAR-800 VAR-4 VAR-2 VAR-VAR VAR-VAR VAR-VAR VAR-VAR-VAR""><VAR VAR='VAR.VAR();' VAR=""VAR VAR-VAR VAR-2""><VAR VAR=""VAR"" VAR=""VAR"" VAR-VAR=""2"" VAR=""0 0 24 24"" VAR-VAR=""VAR"" VAR-VAR=""VAR"" VAR=""VAR-4 VAR-4"" VAR=""1em"" VAR=""1em"" VAR=""VAR: VAR )}<VAR></VAR>`; }, }); VAR.VAR = VAR () { VAR (!VAR?.VAR) VAR VAR; VAR VAR = VAR?.VAR; VAR VAR = VAR.VAR?.VAR?.VAR("".VAR"")?.VAR; VAR (!VAR) VAR VAR; VAR.VAR.VAR.VAR(VAR); VAR.VAR.VAR(""VAR-VAR-500""); VAR VAR = VAR.VAR; VAR.VAR = ""VAR!""; VAR.VAR(""VAR"", VAR); VAR(() => { VAR.VAR.VAR(""VAR-VAR-500""); VAR.VAR = VAR; VAR.VAR(""VAR""); }, 5000); }; VAR VAR VAR VAR(VAR = """") { VAR VAR.VAR(VAR); } ",16,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,frontend/src/utils/chat/markdown.js,"import { encode as HTMLEncode } from ""he"";
import markdownIt from ""markdown-it"";
const markdown = markdownIt({
  html: true,
  typographer: true,
  highlight: function (str) {
    return `<div class=""whitespace-pre-line w-fit rounded-lg bg-black-900 px-4 pt-10 pb-4 relative font-mono font-normal text-sm text-slate-200""><div class=""w-full flex items-center absolute top-0 left-0 text-slate-200 bg-stone-800 px-4 py-2 text-xs font-sans justify-between rounded-t-md""><button onclick='window.copySnippet();' class=""flex ml-auto gap-2""><svg stroke=""currentColor"" fill=""none"" stroke-width=""2"" viewBox=""0 0 24 24"" stroke-linecap=""round"" stroke-linejoin=""round"" class=""h-4 w-4"" height=""1em"" width=""1em"" xmlns=""http://www.w3.org/2000/svg""><path d=""M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2""></path><rect x=""8"" y=""2"" width=""8"" height=""4"" rx=""1"" ry=""1""></rect></svg>Copy code</button></div><pre class='markdown'>${HTMLEncode(
      str
    )}<pre></div>`;
  },
});

window.copySnippet = function () {
  if (!event?.target) return false;

  const target = event?.target;
  const markdown =
    target.parentElement?.parentElement?.querySelector("".markdown"")?.innerText;
  if (!markdown) return false;

  window.navigator.clipboard.writeText(markdown);
  target.classList.add(""text-green-500"");
  const originalText = target.innerHTML;
  target.innerText = ""Copied!"";
  target.setAttribute(""disabled"", true);

  setTimeout(() => {
    target.classList.remove(""text-green-500"");
    target.innerHTML = originalText;
    target.removeAttribute(""disabled"");
  }, 5000);
};

export default function renderMarkdown(text = """") {
  return markdown.render(text);
}",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR VAR VAR } VAR ""VAR""; VAR VAR VAR ""VAR-VAR""; VAR VAR = VAR({ VAR: VAR, VAR: VAR, VAR: VAR (VAR) { VAR `<VAR VAR=""VAR-VAR-VAR VAR-VAR VAR-VAR VAR-VAR-900 VAR-4 VAR-10 VAR-4 VAR VAR-VAR VAR-VAR VAR-VAR VAR-VAR-200""><VAR VAR=""VAR-VAR VAR VAR-VAR VAR VAR-0 VAR-0 VAR-VAR-200 VAR-VAR-800 VAR-4 VAR-2 VAR-VAR VAR-VAR VAR-VAR VAR-VAR-VAR""><VAR VAR='VAR.VAR();' VAR=""VAR VAR-VAR VAR-2""><VAR VAR=""VAR"" VAR=""VAR"" VAR-VAR=""2"" VAR=""0 0 24 24"" VAR-VAR=""VAR"" VAR-VAR=""VAR"" VAR=""VAR-4 VAR-4"" VAR=""1em"" VAR=""1em"" VAR=""VAR: VAR )}<VAR></VAR>`; }, }); VAR.VAR = VAR () { VAR (!VAR?.VAR) VAR VAR; VAR VAR = VAR?.VAR; VAR VAR = VAR.VAR?.VAR?.VAR("".VAR"")?.VAR; VAR (!VAR) VAR VAR; VAR.VAR.VAR.VAR(VAR); VAR.VAR.VAR(""VAR-VAR-500""); VAR VAR = VAR.VAR; VAR.VAR = ""VAR!""; VAR.VAR(""VAR"", VAR); VAR(() => { VAR.VAR.VAR(""VAR-VAR-500""); VAR.VAR = VAR; VAR.VAR(""VAR""); }, 5000); }; VAR VAR VAR VAR(VAR = """") { VAR VAR.VAR(VAR); } ",16,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,frontend/src/utils/session.js,"import { API_BASE } from ""./constants"";
import { baseHeaders } from ""./request"";

// Checks current localstorage and validates the session based on that.
export default async function validateSessionTokenForUser() {
  const isValidSession = await fetch(`${API_BASE}/system/check-token`, {
    method: ""GET"",
    cache: ""default"",
    headers: baseHeaders(),
  })
    .then((res) => res.status === 200)
    .catch(() => false);

  return isValidSession;
}",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } VAR ""./VAR""; VAR { VAR } VAR ""./VAR"";  VAR VAR VAR VAR VAR() { VAR VAR = VAR VAR(`${VAR}/VAR/VAR-VAR`, { VAR: ""VAR"", VAR: ""VAR"", VAR: VAR(), }) .VAR((VAR) => VAR.VAR === 200) .VAR(() => VAR); VAR VAR; } ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,frontend/src/utils/session.js,"import { API_BASE } from ""./constants"";
import { baseHeaders } from ""./request"";

// Checks current localstorage and validates the session based on that.
export default async function validateSessionTokenForUser() {
  const isValidSession = await fetch(`${API_BASE}/system/check-token`, {
    method: ""GET"",
    cache: ""default"",
    headers: baseHeaders(),
  })
    .then((res) => res.status === 200)
    .catch(() => false);

  return isValidSession;
}",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } VAR ""./VAR""; VAR { VAR } VAR ""./VAR"";  VAR VAR VAR VAR VAR() { VAR VAR = VAR VAR(`${VAR}/VAR/VAR-VAR`, { VAR: ""VAR"", VAR: ""VAR"", VAR: VAR(), }) .VAR((VAR) => VAR.VAR === 200) .VAR(() => VAR); VAR VAR; } ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/admin.js,"const { escape } = require(""sqlstring-sqlite"");
const { ApiKey } = require(""../models/apiKeys"");
const { Document } = require(""../models/documents"");
const { Invite } = require(""../models/invite"");
const { SystemSettings } = require(""../models/systemSettings"");
const { User } = require(""../models/user"");
const { DocumentVectors } = require(""../models/vectors"");
const { Workspace } = require(""../models/workspace"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { userFromSession, reqBody } = require(""../utils/http"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");

function adminEndpoints(app) {
  if (!app) return;

  app.get(""/admin/users"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }
      const users = (await User.where()).map((user) => {
        const { password, ...rest } = user;
        return rest;
      });
      response.status(200).json({ users });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/admin/users/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const newUserParams = reqBody(request);
        const { user: newUser, error } = await User.create(newUserParams);
        response.status(200).json({ user: newUser, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(""/admin/user/:id"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const { id } = request.params;
      const updates = reqBody(request);
      const { success, error } = await User.update(id, updates);
      response.status(200).json({ success, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/admin/user/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { id } = request.params;
        await User.delete(`id = ${id}`);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/admin/invites"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const invites = await Invite.whereWithUsers();
      response.status(200).json({ invites });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/admin/invite/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { invite, error } = await Invite.create(user.id);
        response.status(200).json({ invite, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/invite/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const { success, error } = await Invite.deactivate(id);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/admin/workspaces"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const workspaces = await Workspace.whereWithUsers();
        response.status(200).json({ workspaces });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspaces/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { name } = reqBody(request);
        const { workspace, message: error } = await Workspace.new(
          name,
          user.id
        );
        response.status(200).json({ workspace, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspaces/:workspaceId/update-users"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { workspaceId } = request.params;
        const { userIds } = reqBody(request);
        const { success, error } = await Workspace.updateUsers(
          escape(Number(workspaceId)),
          userIds
        );
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/workspaces/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const VectorDb = getVectorDbClass();
        const workspace = Workspace.get(`id = ${escape(id)}`);
        if (!workspace) {
          response.sendStatus(404).end();
          return;
        }

        await Workspace.delete(`id = ${workspace.id}`);
        await DocumentVectors.deleteForWorkspace(workspace.id);
        await Document.delete(`workspaceId = ${Number(workspace.id)}`);
        await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);
        try {
          await VectorDb[""delete-namespace""]({ namespace: workspace.slug });
        } catch (e) {
          console.error(e.message);
        }

        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspace-chats"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { offset = 0 } = reqBody(request);
        const chats = await WorkspaceChats.whereWithData(
          `id >= ${escape(offset)}`,
          20
        );
        const hasPages = (await WorkspaceChats.count()) > 20;
        response.status(200).json({ chats: chats.reverse(), hasPages });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/workspace-chats/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        await WorkspaceChats.delete(`id = ${id}`);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/admin/system-preferences"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const settings = {
          users_can_delete_workspaces:
            (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
              ?.value === ""true"",
          limit_user_messages:
            (await SystemSettings.get(`label = 'limit_user_messages'`))
              ?.value === ""true"",
          message_limit:
            Number(
              (await SystemSettings.get(`label = 'message_limit'`))?.value
            ) || 10,
        };
        response.status(200).json({ settings });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/system-preferences"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const updates = reqBody(request);
        await SystemSettings.updateSettings(updates);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/admin/api-keys"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const apiKeys = await ApiKey.whereWithUser(""id IS NOT NULL"");
      return response.status(200).json({
        apiKeys,
        error: null,
      });
    } catch (error) {
      console.error(error);
      response.status(500).json({
        apiKey: null,
        error: ""Could not find an API Keys."",
      });
    }
  });

  app.post(
    ""/admin/generate-api-key"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { apiKey, error } = await ApiKey.create(user.id);
        return response.status(200).json({
          apiKey,
          error,
        });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/delete-api-key/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { id } = request.params;
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        await ApiKey.delete(`id = ${id}`);
        return response.status(200).end();
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { adminEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = (VAR VAR.VAR()).VAR((VAR) => { VAR { VAR, ...VAR } = VAR; VAR VAR; }); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR { VAR: VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR.VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR(VAR); VAR { VAR, VAR: VAR } = VAR VAR.VAR( VAR, VAR.VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR( VAR(VAR(VAR)), VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(); VAR VAR = VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR VAR.VAR(`VAR = ${VAR.VAR}`); VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR { VAR VAR[""VAR-VAR""]({ VAR: VAR.VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR); } VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR = 0 } = VAR(VAR); VAR VAR = VAR VAR.VAR( `VAR >= ${VAR(VAR)}`, 20 ); VAR VAR = (VAR VAR.VAR()) > 20; VAR.VAR(200).VAR({ VAR: VAR.VAR(), VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = { VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ) || 10, }; VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(""VAR VAR VAR VAR""); VAR VAR.VAR(200).VAR({ VAR, VAR: VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."", }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(200).VAR({ VAR, VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR.VAR(`VAR = ${VAR}`); VAR VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/admin.js,"const { escape } = require(""sqlstring-sqlite"");
const { ApiKey } = require(""../models/apiKeys"");
const { Document } = require(""../models/documents"");
const { Invite } = require(""../models/invite"");
const { SystemSettings } = require(""../models/systemSettings"");
const { User } = require(""../models/user"");
const { DocumentVectors } = require(""../models/vectors"");
const { Workspace } = require(""../models/workspace"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { userFromSession, reqBody } = require(""../utils/http"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");

function adminEndpoints(app) {
  if (!app) return;

  app.get(""/admin/users"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }
      const users = (await User.where()).map((user) => {
        const { password, ...rest } = user;
        return rest;
      });
      response.status(200).json({ users });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/admin/users/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const newUserParams = reqBody(request);
        const { user: newUser, error } = await User.create(newUserParams);
        response.status(200).json({ user: newUser, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(""/admin/user/:id"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const { id } = request.params;
      const updates = reqBody(request);
      const { success, error } = await User.update(id, updates);
      response.status(200).json({ success, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/admin/user/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { id } = request.params;
        await User.delete(`id = ${id}`);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/admin/invites"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const invites = await Invite.whereWithUsers();
      response.status(200).json({ invites });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/admin/invite/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { invite, error } = await Invite.create(user.id);
        response.status(200).json({ invite, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/invite/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const { success, error } = await Invite.deactivate(id);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/admin/workspaces"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const workspaces = await Workspace.whereWithUsers();
        response.status(200).json({ workspaces });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspaces/new"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { name } = reqBody(request);
        const { workspace, message: error } = await Workspace.new(
          name,
          user.id
        );
        response.status(200).json({ workspace, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspaces/:workspaceId/update-users"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { workspaceId } = request.params;
        const { userIds } = reqBody(request);
        const { success, error } = await Workspace.updateUsers(
          escape(Number(workspaceId)),
          userIds
        );
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/workspaces/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const VectorDb = getVectorDbClass();
        const workspace = Workspace.get(`id = ${escape(id)}`);
        if (!workspace) {
          response.sendStatus(404).end();
          return;
        }

        await Workspace.delete(`id = ${workspace.id}`);
        await DocumentVectors.deleteForWorkspace(workspace.id);
        await Document.delete(`workspaceId = ${Number(workspace.id)}`);
        await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);
        try {
          await VectorDb[""delete-namespace""]({ namespace: workspace.slug });
        } catch (e) {
          console.error(e.message);
        }

        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/workspace-chats"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }
        const { offset = 0 } = reqBody(request);
        const chats = await WorkspaceChats.whereWithData(
          `id >= ${escape(offset)}`,
          20
        );
        const hasPages = (await WorkspaceChats.count()) > 20;
        response.status(200).json({ chats: chats.reverse(), hasPages });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/workspace-chats/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        await WorkspaceChats.delete(`id = ${id}`);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/admin/system-preferences"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const settings = {
          users_can_delete_workspaces:
            (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
              ?.value === ""true"",
          limit_user_messages:
            (await SystemSettings.get(`label = 'limit_user_messages'`))
              ?.value === ""true"",
          message_limit:
            Number(
              (await SystemSettings.get(`label = 'message_limit'`))?.value
            ) || 10,
        };
        response.status(200).json({ settings });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/admin/system-preferences"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const updates = reqBody(request);
        await SystemSettings.updateSettings(updates);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/admin/api-keys"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      if (!user || user?.role !== ""admin"") {
        response.sendStatus(401).end();
        return;
      }

      const apiKeys = await ApiKey.whereWithUser(""id IS NOT NULL"");
      return response.status(200).json({
        apiKeys,
        error: null,
      });
    } catch (error) {
      console.error(error);
      response.status(500).json({
        apiKey: null,
        error: ""Could not find an API Keys."",
      });
    }
  });

  app.post(
    ""/admin/generate-api-key"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        const { apiKey, error } = await ApiKey.create(user.id);
        return response.status(200).json({
          apiKey,
          error,
        });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/admin/delete-api-key/:id"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { id } = request.params;
        const user = await userFromSession(request, response);
        if (!user || user?.role !== ""admin"") {
          response.sendStatus(401).end();
          return;
        }

        await ApiKey.delete(`id = ${id}`);
        return response.status(200).end();
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { adminEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = (VAR VAR.VAR()).VAR((VAR) => { VAR { VAR, ...VAR } = VAR; VAR VAR; }); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR { VAR: VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR.VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR(VAR); VAR { VAR, VAR: VAR } = VAR VAR.VAR( VAR, VAR.VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR( VAR(VAR(VAR)), VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(); VAR VAR = VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR VAR.VAR(`VAR = ${VAR.VAR}`); VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR { VAR VAR[""VAR-VAR""]({ VAR: VAR.VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR); } VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR = 0 } = VAR(VAR); VAR VAR = VAR VAR.VAR( `VAR >= ${VAR(VAR)}`, 20 ); VAR VAR = (VAR VAR.VAR()) > 20; VAR.VAR(200).VAR({ VAR: VAR.VAR(), VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = { VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ) || 10, }; VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(""VAR VAR VAR VAR""); VAR VAR.VAR(200).VAR({ VAR, VAR: VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."", }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(200).VAR({ VAR, VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR?.VAR !== ""VAR"") { VAR.VAR(401).VAR(); VAR; } VAR VAR.VAR(`VAR = ${VAR}`); VAR VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/admin/index.js,"const { escape } = require(""sqlstring-sqlite"");
const { Invite } = require(""../../../models/invite"");
const { SystemSettings } = require(""../../../models/systemSettings"");
const { User } = require(""../../../models/user"");
const { Workspace } = require(""../../../models/workspace"");
const { WorkspaceChats } = require(""../../../models/workspaceChats"");
const { multiUserMode, reqBody } = require(""../../../utils/http"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiAdminEndpoints(app) {
  if (!app) return;

  app.get(""/v1/admin/is-multi-user-mode"", [validApiKey], (_, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""isMultiUser"": true
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    const isMultiUser = multiUserMode(response);
    response.status(200).json({ isMultiUser });
  });

  app.get(""/v1/admin/users"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""users"": [
                {
                  username: ""sample-sam"",
                  role: 'default',
                }
             ]
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const users = (await User.where()).map((user) => {
        const { password, ...rest } = user;
        return rest;
      });
      response.status(200).json({ users });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/users/new"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Create a new user with username and password. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Key pair object that will define the new user to add to the system.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              username: ""sample-sam"",
              password: 'hunter2',
              role: 'default | admin'
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              user: {
                id: 1,
                username: 'sample-sam',
                role: 'default',
              },
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const newUserParams = reqBody(request);
      const { user: newUser, error } = await User.create(newUserParams);
      response.status(200).json({ user: newUser, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/users/:id"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.path = '/v1/admin/users/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the user in the database.',
      required: true,
      type: 'string'
    }
    #swagger.description = 'Update existing user settings. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Key pair object that will update the found user. All fields are optional and will not update unless specified.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              username: ""sample-sam"",
              password: 'hunter2',
              role: 'default | admin',
              suspended: 0,
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const { id } = request.params;
      const updates = reqBody(request);
      const { success, error } = await User.update(id, updates);
      response.status(200).json({ success, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/v1/admin/users/:id"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Delete existing user by id. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.path = '/v1/admin/users/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the user in the database.',
      required: true,
      type: 'string'
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        await User.delete(`id = ${id}`);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/admin/invites"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'List all existing invitations to instance regardless of status. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""invites"": [
                {
                  id: 1,
                  status: ""pending"",
                  code: 'abc-123',
                  claimedBy: null
                }
             ]
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const invites = await Invite.whereWithUsers();
      response.status(200).json({ invites });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/invite/new"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Create a new invite code for someone to use to register with instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              invite: {
                id: 1,
                status: ""pending"",
                code: 'abc-123',
              },
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const { invite, error } = await Invite.create();
      response.status(200).json({ invite, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/v1/admin/invite/:id"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Deactivates (soft-delete) invite by id. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.path = '/v1/admin/invite/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the invite in the database.',
      required: true,
      type: 'string'
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const { success, error } = await Invite.deactivate(id);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/v1/admin/workspaces/:workspaceId/update-users"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.path = '/v1/admin/workspaces/{workspaceId}/update-users'
    #swagger.parameters['workspaceId'] = {
      in: 'path',
      description: 'id of the workspace in the database.',
      required: true,
      type: 'string'
    }
    #swagger.description = 'Overwrite workspace permissions to only be accessible by the given user ids and admins. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Entire array of user ids who can access the workspace. All fields are optional and will not update unless specified.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              userIds: [1,2,4,12],
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { workspaceId } = request.params;
        const { userIds } = reqBody(request);
        const { success, error } = await Workspace.updateUsers(
          escape(Number(workspaceId)),
          userIds
        );
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/v1/admin/workspace-chats"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'All chats in the system ordered by most recent. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Page offset to show of workspace chats. All fields are optional and will not update unless specified.',
        required: false,
        type: 'integer',
        content: {
          ""application/json"": {
            example: {
              offset: 2,
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { offset = 0 } = reqBody(request);
        const chats = await WorkspaceChats.whereWithData(
          `id >= ${escape(offset)}`,
          20
        );
        const hasPages = (await WorkspaceChats.count()) > 20;
        response.status(200).json({ chats: chats.reverse(), hasPages });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/admin/preferences"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Show all multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              settings: {
                users_can_delete_workspaces: true,
                limit_user_messages: false,
                message_limit: 10,
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const settings = {
        users_can_delete_workspaces:
          (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
            ?.value === ""true"",
        limit_user_messages:
          (await SystemSettings.get(`label = 'limit_user_messages'`))?.value ===
          ""true"",
        message_limit:
          Number(
            (await SystemSettings.get(`label = 'message_limit'`))?.value
          ) || 10,
      };
      response.status(200).json({ settings });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/v1/admin/preferences"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Update multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
      description: 'Object with setting key and new value to set. All keys are optional and will not update unless specified.',
      required: true,
      type: 'object',
      content: {
        ""application/json"": {
          example: {
            users_can_delete_workspaces: false,
            limit_user_messages: true,
            message_limit: 5,
          }
        }
      }
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const updates = reqBody(request);
        await SystemSettings.updateSettings(updates);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiAdminEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR, VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR/VAR-VAR-VAR-VAR"", [VAR], (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": VAR } } } } }  VAR: { ""$VAR"": "" } } */ VAR VAR = VAR(VAR); VAR.VAR(200).VAR({ VAR }); }); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": [ { VAR: ""VAR-VAR"", VAR: 'VAR', } ] } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = (VAR VAR.VAR()).VAR((VAR) => { VAR { VAR, ...VAR } = VAR; VAR VAR; }); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR-VAR"", VAR: 'VAR', VAR: 'VAR | VAR' } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 1, VAR: 'VAR-VAR', VAR: 'VAR', }, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR { VAR: VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }   VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR-VAR"", VAR: 'VAR', VAR: 'VAR | VAR', VAR: 0, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*     VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": [ { VAR: 1, VAR: ""VAR"", VAR: 'VAR-123', VAR: VAR } ] } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 1, VAR: ""VAR"", VAR: 'VAR-123', }, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*     VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }   VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: [1,2,4,12], } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR( VAR(VAR(VAR)), VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: 2, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR = 0 } = VAR(VAR); VAR VAR = VAR VAR.VAR( `VAR >= ${VAR(VAR)}`, 20 ); VAR VAR = (VAR VAR.VAR()) > 20; VAR.VAR(200).VAR({ VAR: VAR.VAR(), VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: VAR, VAR: VAR, VAR: 10, } } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = { VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR === ""VAR"", VAR: VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ) || 10, }; VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: VAR, VAR: VAR, VAR: 5, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/admin/index.js,"const { escape } = require(""sqlstring-sqlite"");
const { Invite } = require(""../../../models/invite"");
const { SystemSettings } = require(""../../../models/systemSettings"");
const { User } = require(""../../../models/user"");
const { Workspace } = require(""../../../models/workspace"");
const { WorkspaceChats } = require(""../../../models/workspaceChats"");
const { multiUserMode, reqBody } = require(""../../../utils/http"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiAdminEndpoints(app) {
  if (!app) return;

  app.get(""/v1/admin/is-multi-user-mode"", [validApiKey], (_, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""isMultiUser"": true
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    const isMultiUser = multiUserMode(response);
    response.status(200).json({ isMultiUser });
  });

  app.get(""/v1/admin/users"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""users"": [
                {
                  username: ""sample-sam"",
                  role: 'default',
                }
             ]
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const users = (await User.where()).map((user) => {
        const { password, ...rest } = user;
        return rest;
      });
      response.status(200).json({ users });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/users/new"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Create a new user with username and password. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Key pair object that will define the new user to add to the system.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              username: ""sample-sam"",
              password: 'hunter2',
              role: 'default | admin'
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              user: {
                id: 1,
                username: 'sample-sam',
                role: 'default',
              },
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const newUserParams = reqBody(request);
      const { user: newUser, error } = await User.create(newUserParams);
      response.status(200).json({ user: newUser, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/users/:id"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.path = '/v1/admin/users/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the user in the database.',
      required: true,
      type: 'string'
    }
    #swagger.description = 'Update existing user settings. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Key pair object that will update the found user. All fields are optional and will not update unless specified.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              username: ""sample-sam"",
              password: 'hunter2',
              role: 'default | admin',
              suspended: 0,
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const { id } = request.params;
      const updates = reqBody(request);
      const { success, error } = await User.update(id, updates);
      response.status(200).json({ success, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/v1/admin/users/:id"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Delete existing user by id. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.path = '/v1/admin/users/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the user in the database.',
      required: true,
      type: 'string'
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        await User.delete(`id = ${id}`);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/admin/invites"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'List all existing invitations to instance regardless of status. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""invites"": [
                {
                  id: 1,
                  status: ""pending"",
                  code: 'abc-123',
                  claimedBy: null
                }
             ]
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const invites = await Invite.whereWithUsers();
      response.status(200).json({ invites });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/v1/admin/invite/new"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Create a new invite code for someone to use to register with instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              invite: {
                id: 1,
                status: ""pending"",
                code: 'abc-123',
              },
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const { invite, error } = await Invite.create();
      response.status(200).json({ invite, error });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/v1/admin/invite/:id"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Deactivates (soft-delete) invite by id. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.path = '/v1/admin/invite/{id}'
    #swagger.parameters['id'] = {
      in: 'path',
      description: 'id of the invite in the database.',
      required: true,
      type: 'string'
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { id } = request.params;
        const { success, error } = await Invite.deactivate(id);
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/v1/admin/workspaces/:workspaceId/update-users"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.path = '/v1/admin/workspaces/{workspaceId}/update-users'
    #swagger.parameters['workspaceId'] = {
      in: 'path',
      description: 'id of the workspace in the database.',
      required: true,
      type: 'string'
    }
    #swagger.description = 'Overwrite workspace permissions to only be accessible by the given user ids and admins. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Entire array of user ids who can access the workspace. All fields are optional and will not update unless specified.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              userIds: [1,2,4,12],
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { workspaceId } = request.params;
        const { userIds } = reqBody(request);
        const { success, error } = await Workspace.updateUsers(
          escape(Number(workspaceId)),
          userIds
        );
        response.status(200).json({ success, error });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/v1/admin/workspace-chats"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'All chats in the system ordered by most recent. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
        description: 'Page offset to show of workspace chats. All fields are optional and will not update unless specified.',
        required: false,
        type: 'integer',
        content: {
          ""application/json"": {
            example: {
              offset: 2,
            }
          }
        }
      }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const { offset = 0 } = reqBody(request);
        const chats = await WorkspaceChats.whereWithData(
          `id >= ${escape(offset)}`,
          20
        );
        const hasPages = (await WorkspaceChats.count()) > 20;
        response.status(200).json({ chats: chats.reverse(), hasPages });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/admin/preferences"", [validApiKey], async (request, response) => {
    /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Show all multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              settings: {
                users_can_delete_workspaces: true,
                limit_user_messages: false,
                message_limit: 10,
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
    try {
      if (!multiUserMode(response)) {
        response.sendStatus(401).end();
        return;
      }

      const settings = {
        users_can_delete_workspaces:
          (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
            ?.value === ""true"",
        limit_user_messages:
          (await SystemSettings.get(`label = 'limit_user_messages'`))?.value ===
          ""true"",
        message_limit:
          Number(
            (await SystemSettings.get(`label = 'message_limit'`))?.value
          ) || 10,
      };
      response.status(200).json({ settings });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/v1/admin/preferences"",
    [validApiKey],
    async (request, response) => {
      /*
    #swagger.tags = ['Admin']
    #swagger.description = 'Update multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI.'
    #swagger.requestBody = {
      description: 'Object with setting key and new value to set. All keys are optional and will not update unless specified.',
      required: true,
      type: 'object',
      content: {
        ""application/json"": {
          example: {
            users_can_delete_workspaces: false,
            limit_user_messages: true,
            message_limit: 5,
          }
        }
      }
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
     #swagger.responses[401] = {
      description: ""Instance is not in Multi-User mode. Method denied"",
    }
    */
      try {
        if (!multiUserMode(response)) {
          response.sendStatus(401).end();
          return;
        }

        const updates = reqBody(request);
        await SystemSettings.updateSettings(updates);
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.error(e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiAdminEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR, VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR/VAR-VAR-VAR-VAR"", [VAR], (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": VAR } } } } }  VAR: { ""$VAR"": "" } } */ VAR VAR = VAR(VAR); VAR.VAR(200).VAR({ VAR }); }); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": [ { VAR: ""VAR-VAR"", VAR: 'VAR', } ] } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = (VAR VAR.VAR()).VAR((VAR) => { VAR { VAR, ...VAR } = VAR; VAR VAR; }); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR-VAR"", VAR: 'VAR', VAR: 'VAR | VAR' } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 1, VAR: 'VAR-VAR', VAR: 'VAR', }, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR { VAR: VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }   VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR-VAR"", VAR: 'VAR', VAR: 'VAR | VAR', VAR: 0, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*     VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR VAR.VAR(`VAR = ${VAR}`); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": [ { VAR: 1, VAR: ""VAR"", VAR: 'VAR-123', VAR: VAR } ] } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 1, VAR: ""VAR"", VAR: 'VAR-123', }, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { /*     VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR', VAR: 'VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR' }   VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: [1,2,4,12], } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR } = VAR.VAR; VAR { VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR( VAR(VAR(VAR)), VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: 2, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR { VAR = 0 } = VAR(VAR); VAR VAR = VAR VAR.VAR( `VAR >= ${VAR(VAR)}`, 20 ); VAR VAR = (VAR VAR.VAR()) > 20; VAR.VAR(200).VAR({ VAR: VAR.VAR(), VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: VAR, VAR: VAR, VAR: 10, } } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = { VAR: (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR"", VAR: (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR === ""VAR"", VAR: VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ) || 10, }; VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: VAR, VAR: VAR, VAR: 5, } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } }  VAR: ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"", } */ VAR { VAR (!VAR(VAR)) { VAR.VAR(401).VAR(); VAR; } VAR VAR = VAR(VAR); VAR VAR.VAR(VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/auth/index.js,"const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiAuthEndpoints(app) {
  if (!app) return;

  app.get(""/v1/auth"", [validApiKey], (_, response) => {
    /*
    #swagger.tags = ['Authentication']
    #swagger.description = 'Verify the attached Authentication header contains a valid API token.'
    #swagger.responses[200] = {
      description: 'Valid auth token was found.',
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              authenticated: true,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    response.status(200).json({ authenticated: true });
  });
}

module.exports = { apiAuthEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR.', VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } } */ VAR.VAR(200).VAR({ VAR: VAR }); }); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/auth/index.js,"const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiAuthEndpoints(app) {
  if (!app) return;

  app.get(""/v1/auth"", [validApiKey], (_, response) => {
    /*
    #swagger.tags = ['Authentication']
    #swagger.description = 'Verify the attached Authentication header contains a valid API token.'
    #swagger.responses[200] = {
      description: 'Valid auth token was found.',
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              authenticated: true,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    response.status(200).json({ authenticated: true });
  });
}

module.exports = { apiAuthEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR.', VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } } */ VAR.VAR(200).VAR({ VAR: VAR }); }); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/document/index.js,"const { Telemetry } = require(""../../../models/telemetry"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");
const { setupMulter } = require(""../../../utils/files/multer"");
const {
  checkPythonAppAlive,
  acceptedFileTypes,
  processDocument,
} = require(""../../../utils/files/documentProcessor"");
const { viewLocalFiles } = require(""../../../utils/files"");
const { handleUploads } = setupMulter();

function apiDocumentEndpoints(app) {
  if (!app) return;

  app.post(
    ""/v1/document/upload"",
    [validApiKey],
    handleUploads.single(""file""),
    async (request, response) => {
      /*
    #swagger.tags = ['Documents']
    #swagger.description = 'Upload a new file to AnythingLLM to be parsed and prepared for embedding.'

    #swagger.requestBody = {
      description: 'File to be uploaded.',
      required: true,
      type: 'file',
      content: {
        ""multipart/form-data"": {
          schema: {
            type: 'object',
            properties: {
              file: {
                type: 'string',
                format: 'binary',
              }
            }
          }
        }
      }
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
      try {
        const { originalname } = request.file;
        const processingOnline = await checkPythonAppAlive();

        if (!processingOnline) {
          response
            .status(500)
            .json({
              success: false,
              error: `Python processing API is not online. Document ${originalname} will not be processed automatically.`,
            })
            .end();
        }

        const { success, reason } = await processDocument(originalname);
        if (!success) {
          response.status(500).json({ success: false, error: reason }).end();
        }

        console.log(
          `Document ${originalname} uploaded processed and successfully. It is now available in documents.`
        );
        await Telemetry.sendTelemetry(""document_uploaded"");
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/documents"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['Documents']
    #swagger.description = 'List of all locally-stored documents in instance'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""localFiles"": {
              ""name"": ""documents"",
              ""type"": ""folder"",
              items: [
                {
                  ""name"": ""my-stored-document.json"",
                  ""type"": ""file"",
                  ""id"": ""bb07c334-4dab-4419-9462-9d00065a49a1"",
                  ""url"": ""file://my-stored-document.txt"",
                  ""title"": ""my-stored-document.txt"",
                  ""cached"": false
                },
              ]
             }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const localFiles = await viewLocalFiles();
      response.status(200).json({ localFiles });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/v1/document/accepted-file-types"",
    [validApiKey],
    async (_, response) => {
      /*
    #swagger.tags = ['Documents']
    #swagger.description = 'Check available filetypes and MIMEs that can be uploaded.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              ""types"": {
                ""application/mbox"": [
                  "".mbox""
                ],
                ""application/pdf"": [
                  "".pdf""
                ],
                ""application/vnd.oasis.opendocument.text"": [
                  "".odt""
                ],
                ""application/vnd.openxmlformats-officedocument.wordprocessingml.document"": [
                  "".docx""
                ],
                ""text/plain"": [
                  "".txt"",
                  "".md""
                ]
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
      try {
        const types = await acceptedFileTypes();
        if (!types) {
          response.sendStatus(404).end();
          return;
        }

        response.status(200).json({ types });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiDocumentEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR, VAR, VAR, } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR.VAR(""VAR""), VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR-VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 'VAR', VAR: 'VAR', } } } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(); VAR (!VAR) { VAR .VAR(500) .VAR({ VAR: VAR, VAR: `VAR VAR VAR VAR VAR VAR. VAR ${VAR} VAR VAR VAR VAR VAR.`, }) .VAR(); } VAR { VAR, VAR } = VAR VAR(VAR); VAR (!VAR) { VAR.VAR(500).VAR({ VAR: VAR, VAR: VAR }).VAR(); } VAR.VAR( `VAR ${VAR} VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR.` ); VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", VAR: [ { ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR-4dab-4419-9462-9d00065a49a1"", ""VAR"": ""VAR: ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": VAR }, ] } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR.VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR.VAR-VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"", "".VAR"" ] } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR(); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/document/index.js,"const { Telemetry } = require(""../../../models/telemetry"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");
const { setupMulter } = require(""../../../utils/files/multer"");
const {
  checkPythonAppAlive,
  acceptedFileTypes,
  processDocument,
} = require(""../../../utils/files/documentProcessor"");
const { viewLocalFiles } = require(""../../../utils/files"");
const { handleUploads } = setupMulter();

function apiDocumentEndpoints(app) {
  if (!app) return;

  app.post(
    ""/v1/document/upload"",
    [validApiKey],
    handleUploads.single(""file""),
    async (request, response) => {
      /*
    #swagger.tags = ['Documents']
    #swagger.description = 'Upload a new file to AnythingLLM to be parsed and prepared for embedding.'

    #swagger.requestBody = {
      description: 'File to be uploaded.',
      required: true,
      type: 'file',
      content: {
        ""multipart/form-data"": {
          schema: {
            type: 'object',
            properties: {
              file: {
                type: 'string',
                format: 'binary',
              }
            }
          }
        }
      }
    }
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              success: true,
              error: null,
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
      try {
        const { originalname } = request.file;
        const processingOnline = await checkPythonAppAlive();

        if (!processingOnline) {
          response
            .status(500)
            .json({
              success: false,
              error: `Python processing API is not online. Document ${originalname} will not be processed automatically.`,
            })
            .end();
        }

        const { success, reason } = await processDocument(originalname);
        if (!success) {
          response.status(500).json({ success: false, error: reason }).end();
        }

        console.log(
          `Document ${originalname} uploaded processed and successfully. It is now available in documents.`
        );
        await Telemetry.sendTelemetry(""document_uploaded"");
        response.status(200).json({ success: true, error: null });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/v1/documents"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['Documents']
    #swagger.description = 'List of all locally-stored documents in instance'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""localFiles"": {
              ""name"": ""documents"",
              ""type"": ""folder"",
              items: [
                {
                  ""name"": ""my-stored-document.json"",
                  ""type"": ""file"",
                  ""id"": ""bb07c334-4dab-4419-9462-9d00065a49a1"",
                  ""url"": ""file://my-stored-document.txt"",
                  ""title"": ""my-stored-document.txt"",
                  ""cached"": false
                },
              ]
             }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const localFiles = await viewLocalFiles();
      response.status(200).json({ localFiles });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/v1/document/accepted-file-types"",
    [validApiKey],
    async (_, response) => {
      /*
    #swagger.tags = ['Documents']
    #swagger.description = 'Check available filetypes and MIMEs that can be uploaded.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
              ""types"": {
                ""application/mbox"": [
                  "".mbox""
                ],
                ""application/pdf"": [
                  "".pdf""
                ],
                ""application/vnd.oasis.opendocument.text"": [
                  "".odt""
                ],
                ""application/vnd.openxmlformats-officedocument.wordprocessingml.document"": [
                  "".docx""
                ],
                ""text/plain"": [
                  "".txt"",
                  "".md""
                ]
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
      try {
        const types = await acceptedFileTypes();
        if (!types) {
          response.sendStatus(404).end();
          return;
        }

        response.status(200).json({ types });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiDocumentEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR, VAR, VAR, } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR( ""/VAR/VAR/VAR"", [VAR], VAR.VAR(""VAR""), VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR-VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: { VAR: 'VAR', VAR: 'VAR', } } } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: VAR, VAR: VAR, } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(); VAR (!VAR) { VAR .VAR(500) .VAR({ VAR: VAR, VAR: `VAR VAR VAR VAR VAR VAR. VAR ${VAR} VAR VAR VAR VAR VAR.`, }) .VAR(); } VAR { VAR, VAR } = VAR VAR(VAR); VAR (!VAR) { VAR.VAR(500).VAR({ VAR: VAR, VAR: VAR }).VAR(); } VAR.VAR( `VAR ${VAR} VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR.` ); VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", VAR: [ { ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR-4dab-4419-9462-9d00065a49a1"", ""VAR"": ""VAR: ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": VAR }, ] } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR.VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR.VAR-VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"", "".VAR"" ] } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR(); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/system/index.js,"const { SystemSettings } = require(""../../../models/systemSettings"");
const { getVectorDbClass } = require(""../../../utils/helpers"");
const { dumpENV, updateENV } = require(""../../../utils/helpers/updateENV"");
const { reqBody } = require(""../../../utils/http"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiSystemEndpoints(app) {
  if (!app) return;

  app.get(""/v1/system/env-dump"", async (_, response) => {
    /*
   #swagger.tags = ['System Settings']
   #swagger.description = 'Dump all settings to file storage'
   #swagger.responses[403] = {
     schema: {
       ""$ref"": ""#/definitions/InvalidAPIKey""
     }
   }
   */
    try {
      if (process.env.NODE_ENV !== ""production"")
        return response.sendStatus(200).end();
      await dumpENV();
      response.sendStatus(200).end();
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/v1/system"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['System Settings']
    #swagger.description = 'Get all current system settings that are defined.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""settings"": {
                ""VectorDB"": ""pinecone"",
                ""PineConeEnvironment"": ""us-west4-gcp-free"",
                ""PineConeKey"": true,
                ""PineConeIndex"": ""my-pinecone-index"",
                ""LLMProvider"": ""azure"",
                ""[KEY_NAME]"": ""KEY_VALUE"",
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const settings = await SystemSettings.currentSettings();
      response.status(200).json({ settings });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/v1/system/vector-count"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['System Settings']
    #swagger.description = 'Number of all vectors in connected vector database'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""vectorCount"": 5450
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const VectorDb = getVectorDbClass();
      const vectorCount = await VectorDb.totalIndicies();
      response.status(200).json({ vectorCount });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/v1/system/update-env"",
    [validApiKey],
    async (request, response) => {
      /*
      #swagger.tags = ['System Settings']
      #swagger.description = 'Update a system setting or preference.'
      #swagger.requestBody = {
        description: 'Key pair object that matches a valid setting and value. Get keys from GET /v1/system or refer to codebase.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              VectorDB: ""lancedb"",
              AnotherKey: ""updatedValue""
            }
          }
        }
      }
      #swagger.responses[200] = {
        content: {
          ""application/json"": {
            schema: {
              type: 'object',
              example: {
                newValues: {""[ENV_KEY]"": 'Value'},
                error: 'error goes here, otherwise null'
              }
            }
          }
        }
      }
      #swagger.responses[403] = {
        schema: {
          ""$ref"": ""#/definitions/InvalidAPIKey""
        }
      }
      */
      try {
        const body = reqBody(request);
        const { newValues, error } = updateENV(body);
        if (process.env.NODE_ENV === ""production"") await dumpENV();
        response.status(200).json({ newValues, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiSystemEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR, VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR/VAR-VAR"", VAR (VAR, VAR) => { /*    VAR: { ""$VAR"": "" } } */ VAR { VAR (VAR.VAR.VAR !== ""VAR"") VAR VAR.VAR(200).VAR(); VAR VAR(); VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR-VAR-VAR-VAR"", ""VAR"": VAR, ""VAR"": ""VAR-VAR-VAR"", ""VAR"": ""VAR"", ""[VAR]"": ""VAR"", } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": 5450 } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR(); VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR /VAR/VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR"", VAR: ""VAR"" } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: {""[VAR]"": 'VAR'}, VAR: 'VAR VAR VAR, VAR VAR' } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR(VAR); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/api/system/index.js,"const { SystemSettings } = require(""../../../models/systemSettings"");
const { getVectorDbClass } = require(""../../../utils/helpers"");
const { dumpENV, updateENV } = require(""../../../utils/helpers/updateENV"");
const { reqBody } = require(""../../../utils/http"");
const { validApiKey } = require(""../../../utils/middleware/validApiKey"");

function apiSystemEndpoints(app) {
  if (!app) return;

  app.get(""/v1/system/env-dump"", async (_, response) => {
    /*
   #swagger.tags = ['System Settings']
   #swagger.description = 'Dump all settings to file storage'
   #swagger.responses[403] = {
     schema: {
       ""$ref"": ""#/definitions/InvalidAPIKey""
     }
   }
   */
    try {
      if (process.env.NODE_ENV !== ""production"")
        return response.sendStatus(200).end();
      await dumpENV();
      response.sendStatus(200).end();
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/v1/system"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['System Settings']
    #swagger.description = 'Get all current system settings that are defined.'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""settings"": {
                ""VectorDB"": ""pinecone"",
                ""PineConeEnvironment"": ""us-west4-gcp-free"",
                ""PineConeKey"": true,
                ""PineConeIndex"": ""my-pinecone-index"",
                ""LLMProvider"": ""azure"",
                ""[KEY_NAME]"": ""KEY_VALUE"",
              }
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const settings = await SystemSettings.currentSettings();
      response.status(200).json({ settings });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/v1/system/vector-count"", [validApiKey], async (_, response) => {
    /*
    #swagger.tags = ['System Settings']
    #swagger.description = 'Number of all vectors in connected vector database'
    #swagger.responses[200] = {
      content: {
        ""application/json"": {
          schema: {
            type: 'object',
            example: {
             ""vectorCount"": 5450
            }
          }
        }
      }
    }
    #swagger.responses[403] = {
      schema: {
        ""$ref"": ""#/definitions/InvalidAPIKey""
      }
    }
    */
    try {
      const VectorDb = getVectorDbClass();
      const vectorCount = await VectorDb.totalIndicies();
      response.status(200).json({ vectorCount });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/v1/system/update-env"",
    [validApiKey],
    async (request, response) => {
      /*
      #swagger.tags = ['System Settings']
      #swagger.description = 'Update a system setting or preference.'
      #swagger.requestBody = {
        description: 'Key pair object that matches a valid setting and value. Get keys from GET /v1/system or refer to codebase.',
        required: true,
        type: 'object',
        content: {
          ""application/json"": {
            example: {
              VectorDB: ""lancedb"",
              AnotherKey: ""updatedValue""
            }
          }
        }
      }
      #swagger.responses[200] = {
        content: {
          ""application/json"": {
            schema: {
              type: 'object',
              example: {
                newValues: {""[ENV_KEY]"": 'Value'},
                error: 'error goes here, otherwise null'
              }
            }
          }
        }
      }
      #swagger.responses[403] = {
        schema: {
          ""$ref"": ""#/definitions/InvalidAPIKey""
        }
      }
      */
      try {
        const body = reqBody(request);
        const { newValues, error } = updateENV(body);
        if (process.env.NODE_ENV === ""production"") await dumpENV();
        response.status(200).json({ newValues, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { apiSystemEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR, VAR } = VAR(""../../../VAR/VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR""); VAR { VAR } = VAR(""../../../VAR/VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR/VAR-VAR"", VAR (VAR, VAR) => { /*    VAR: { ""$VAR"": "" } } */ VAR { VAR (VAR.VAR.VAR !== ""VAR"") VAR VAR.VAR(200).VAR(); VAR VAR(); VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR-VAR-VAR-VAR"", ""VAR"": VAR, ""VAR"": ""VAR-VAR-VAR"", ""VAR"": ""VAR"", ""[VAR]"": ""VAR"", } } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { ""VAR"": 5450 } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR(); VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { /*    VAR: 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR /VAR/VAR VAR VAR VAR VAR.', VAR: VAR, VAR: 'VAR', VAR: { ""VAR/VAR"": { VAR: { VAR: ""VAR"", VAR: ""VAR"" } } } }  VAR: { ""VAR/VAR"": { VAR: { VAR: 'VAR', VAR: { VAR: {""[VAR]"": 'VAR'}, VAR: 'VAR VAR VAR, VAR VAR' } } } } }  VAR: { ""$VAR"": "" } } */ VAR { VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR(VAR); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/chat.js,"const { v4: uuidv4 } = require(""uuid"");
const { reqBody, userFromSession, multiUserMode } = require(""../utils/http"");
const { Workspace } = require(""../models/workspace"");
const { chatWithWorkspace } = require(""../utils/chats"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { SystemSettings } = require(""../models/systemSettings"");
const { Telemetry } = require(""../models/telemetry"");
const { escape } = require(""sqlstring-sqlite"");

function chatEndpoints(app) {
  if (!app) return;

  app.post(
    ""/workspace/:slug/chat"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug } = request.params;
        const { message, mode = ""query"" } = reqBody(request);
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        if (multiUserMode(response) && user.role !== ""admin"") {
          const limitMessages =
            (await SystemSettings.get(`label = 'limit_user_messages'`))
              ?.value === ""true"";

          if (limitMessages) {
            const systemLimit = Number(
              (await SystemSettings.get(`label = 'message_limit'`))?.value
            );
            if (!!systemLimit) {
              const currentChatCount = await WorkspaceChats.count(
                `user_id = ${user.id} AND createdAt > datetime(CURRENT_TIMESTAMP, '-1 days')`
              );
              if (currentChatCount >= systemLimit) {
                response.status(500).json({
                  id: uuidv4(),
                  type: ""abort"",
                  textResponse: null,
                  sources: [],
                  close: true,
                  error: `You have met your maximum 24 hour chat quota of ${systemLimit} chats set by the instance administrators. Try again later.`,
                });
                return;
              }
            }
          }
        }

        const result = await chatWithWorkspace(workspace, message, mode, user);
        await Telemetry.sendTelemetry(""sent_chat"", {
          multiUserMode: multiUserMode(response),
          LLMSelection: process.env.LLM_PROVIDER || ""openai"",
          VectorDbSelection: process.env.VECTOR_DB || ""pinecone"",
        });
        response.status(200).json({ ...result });
      } catch (e) {
        response.status(500).json({
          id: uuidv4(),
          type: ""abort"",
          textResponse: null,
          sources: [],
          close: true,
          error: e.message,
        });
      }
    }
  );
}

module.exports = { chatEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR: VAR } = VAR(""VAR""); VAR { VAR, VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""VAR-VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR } = VAR.VAR; VAR { VAR, VAR = ""VAR"" } = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR (VAR(VAR) && VAR.VAR !== ""VAR"") { VAR VAR = (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR""; VAR (VAR) { VAR VAR = VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ); VAR (!!VAR) { VAR VAR = VAR VAR.VAR( `VAR = ${VAR.VAR} VAR VAR > VAR(VAR, '-1 VAR')` ); VAR (VAR >= VAR) { VAR.VAR(500).VAR({ VAR: VAR(), VAR: ""VAR"", VAR: VAR, VAR: [], VAR: VAR, VAR: `VAR VAR VAR VAR VAR 24 VAR VAR VAR VAR ${VAR} VAR VAR VAR VAR VAR VAR. VAR VAR VAR.`, }); VAR; } } } } VAR VAR = VAR VAR(VAR, VAR, VAR, VAR); VAR VAR.VAR(""VAR"", { VAR: VAR(VAR), VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR.VAR.VAR || ""VAR"", }); VAR.VAR(200).VAR({ ...VAR }); } VAR (VAR) { VAR.VAR(500).VAR({ VAR: VAR(), VAR: ""VAR"", VAR: VAR, VAR: [], VAR: VAR, VAR: VAR.VAR, }); } } ); } VAR.VAR = { VAR }; ",16,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/chat.js,"const { v4: uuidv4 } = require(""uuid"");
const { reqBody, userFromSession, multiUserMode } = require(""../utils/http"");
const { Workspace } = require(""../models/workspace"");
const { chatWithWorkspace } = require(""../utils/chats"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { SystemSettings } = require(""../models/systemSettings"");
const { Telemetry } = require(""../models/telemetry"");
const { escape } = require(""sqlstring-sqlite"");

function chatEndpoints(app) {
  if (!app) return;

  app.post(
    ""/workspace/:slug/chat"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug } = request.params;
        const { message, mode = ""query"" } = reqBody(request);
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        if (multiUserMode(response) && user.role !== ""admin"") {
          const limitMessages =
            (await SystemSettings.get(`label = 'limit_user_messages'`))
              ?.value === ""true"";

          if (limitMessages) {
            const systemLimit = Number(
              (await SystemSettings.get(`label = 'message_limit'`))?.value
            );
            if (!!systemLimit) {
              const currentChatCount = await WorkspaceChats.count(
                `user_id = ${user.id} AND createdAt > datetime(CURRENT_TIMESTAMP, '-1 days')`
              );
              if (currentChatCount >= systemLimit) {
                response.status(500).json({
                  id: uuidv4(),
                  type: ""abort"",
                  textResponse: null,
                  sources: [],
                  close: true,
                  error: `You have met your maximum 24 hour chat quota of ${systemLimit} chats set by the instance administrators. Try again later.`,
                });
                return;
              }
            }
          }
        }

        const result = await chatWithWorkspace(workspace, message, mode, user);
        await Telemetry.sendTelemetry(""sent_chat"", {
          multiUserMode: multiUserMode(response),
          LLMSelection: process.env.LLM_PROVIDER || ""openai"",
          VectorDbSelection: process.env.VECTOR_DB || ""pinecone"",
        });
        response.status(200).json({ ...result });
      } catch (e) {
        response.status(500).json({
          id: uuidv4(),
          type: ""abort"",
          textResponse: null,
          sources: [],
          close: true,
          error: e.message,
        });
      }
    }
  );
}

module.exports = { chatEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR: VAR } = VAR(""VAR""); VAR { VAR, VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""VAR-VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR } = VAR.VAR; VAR { VAR, VAR = ""VAR"" } = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR (VAR(VAR) && VAR.VAR !== ""VAR"") { VAR VAR = (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR""; VAR (VAR) { VAR VAR = VAR( (VAR VAR.VAR(`VAR = 'VAR'`))?.VAR ); VAR (!!VAR) { VAR VAR = VAR VAR.VAR( `VAR = ${VAR.VAR} VAR VAR > VAR(VAR, '-1 VAR')` ); VAR (VAR >= VAR) { VAR.VAR(500).VAR({ VAR: VAR(), VAR: ""VAR"", VAR: VAR, VAR: [], VAR: VAR, VAR: `VAR VAR VAR VAR VAR 24 VAR VAR VAR VAR ${VAR} VAR VAR VAR VAR VAR VAR. VAR VAR VAR.`, }); VAR; } } } } VAR VAR = VAR VAR(VAR, VAR, VAR, VAR); VAR VAR.VAR(""VAR"", { VAR: VAR(VAR), VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR.VAR.VAR || ""VAR"", }); VAR.VAR(200).VAR({ ...VAR }); } VAR (VAR) { VAR.VAR(500).VAR({ VAR: VAR(), VAR: ""VAR"", VAR: VAR, VAR: [], VAR: VAR, VAR: VAR.VAR, }); } } ); } VAR.VAR = { VAR }; ",16,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/invite.js,"const { escape } = require(""sqlstring-sqlite"");
const { Invite } = require(""../models/invite"");
const { User } = require(""../models/user"");
const { reqBody } = require(""../utils/http"");

function inviteEndpoints(app) {
  if (!app) return;

  app.get(""/invite/:code"", async (request, response) => {
    try {
      const { code } = request.params;
      const invite = await Invite.get(`code = ${escape(code)}`);
      if (!invite) {
        response.status(200).json({ invite: null, error: ""Invite not found."" });
        return;
      }

      if (invite.status !== ""pending"") {
        response
          .status(200)
          .json({ invite: null, error: ""Invite is no longer valid."" });
        return;
      }

      response
        .status(200)
        .json({ invite: { code, status: invite.status }, error: null });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/invite/:code"", async (request, response) => {
    try {
      const { code } = request.params;
      const userParams = reqBody(request);
      const invite = await Invite.get(`code = ${escape(code)}`);
      if (!invite || invite.status !== ""pending"") {
        response
          .status(200)
          .json({ success: false, error: ""Invite not found or is invalid."" });
        return;
      }

      const { user, error } = await User.create(userParams);
      if (!user) {
        console.error(""Accepting invite:"", error);
        response
          .status(200)
          .json({ success: false, error: ""Could not create user."" });
        return;
      }

      await Invite.markClaimed(invite.id, user);
      response.status(200).json({ success: true, error: null });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });
}

module.exports = { inviteEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR VAR VAR."" }); VAR; } VAR (VAR.VAR !== ""VAR"") { VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR."" }); VAR; } VAR .VAR(200) .VAR({ VAR: { VAR, VAR: VAR.VAR }, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR || VAR.VAR !== ""VAR"") { VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."" }); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR (!VAR) { VAR.VAR(""VAR VAR:"", VAR); VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."" }); VAR; } VAR VAR.VAR(VAR.VAR, VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/invite.js,"const { escape } = require(""sqlstring-sqlite"");
const { Invite } = require(""../models/invite"");
const { User } = require(""../models/user"");
const { reqBody } = require(""../utils/http"");

function inviteEndpoints(app) {
  if (!app) return;

  app.get(""/invite/:code"", async (request, response) => {
    try {
      const { code } = request.params;
      const invite = await Invite.get(`code = ${escape(code)}`);
      if (!invite) {
        response.status(200).json({ invite: null, error: ""Invite not found."" });
        return;
      }

      if (invite.status !== ""pending"") {
        response
          .status(200)
          .json({ invite: null, error: ""Invite is no longer valid."" });
        return;
      }

      response
        .status(200)
        .json({ invite: { code, status: invite.status }, error: null });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });

  app.post(""/invite/:code"", async (request, response) => {
    try {
      const { code } = request.params;
      const userParams = reqBody(request);
      const invite = await Invite.get(`code = ${escape(code)}`);
      if (!invite || invite.status !== ""pending"") {
        response
          .status(200)
          .json({ success: false, error: ""Invite not found or is invalid."" });
        return;
      }

      const { user, error } = await User.create(userParams);
      if (!user) {
        console.error(""Accepting invite:"", error);
        response
          .status(200)
          .json({ success: false, error: ""Could not create user."" });
        return;
      }

      await Invite.markClaimed(invite.id, user);
      response.status(200).json({ success: true, error: null });
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });
}

module.exports = { inviteEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR VAR VAR."" }); VAR; } VAR (VAR.VAR !== ""VAR"") { VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR."" }); VAR; } VAR .VAR(200) .VAR({ VAR: { VAR, VAR: VAR.VAR }, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR || VAR.VAR !== ""VAR"") { VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."" }); VAR; } VAR { VAR, VAR } = VAR VAR.VAR(VAR); VAR (!VAR) { VAR.VAR(""VAR VAR:"", VAR); VAR .VAR(200) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."" }); VAR; } VAR VAR.VAR(VAR.VAR, VAR); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/system.js,"process.env.NODE_ENV === ""development""
  ? require(""dotenv"").config({ path: `.env.${process.env.NODE_ENV}` })
  : require(""dotenv"").config();
const { validateTablePragmas } = require(""../utils/database"");
const { viewLocalFiles } = require(""../utils/files"");
const { exportData, unpackAndOverwriteImport } = require(""../utils/files/data"");
const {
  checkPythonAppAlive,
  acceptedFileTypes,
} = require(""../utils/files/documentProcessor"");
const { purgeDocument } = require(""../utils/files/purgeDocument"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { updateENV, dumpENV } = require(""../utils/helpers/updateENV"");
const {
  reqBody,
  makeJWT,
  userFromSession,
  multiUserMode,
} = require(""../utils/http"");
const { setupDataImports, setupLogoUploads } = require(""../utils/files/multer"");
const { v4 } = require(""uuid"");
const { SystemSettings } = require(""../models/systemSettings"");
const { User } = require(""../models/user"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { handleImports } = setupDataImports();
const { handleLogoUploads } = setupLogoUploads();
const fs = require(""fs"");
const path = require(""path"");
const {
  getDefaultFilename,
  determineLogoFilepath,
  fetchLogo,
  validFilename,
  renameLogoFile,
  removeCustomLogo,
  DARK_LOGO_FILENAME,
} = require(""../utils/files/logo"");
const { Telemetry } = require(""../models/telemetry"");
const { WelcomeMessages } = require(""../models/welcomeMessages"");
const { ApiKey } = require(""../models/apiKeys"");
const { escape } = require(""sqlstring-sqlite"");

function systemEndpoints(app) {
  if (!app) return;

  app.get(""/ping"", (_, response) => {
    response.status(200).json({ online: true });
  });

  app.get(""/migrate"", async (_, response) => {
    await validateTablePragmas(true);
    response.sendStatus(200);
  });

  app.get(""/env-dump"", async (_, response) => {
    if (process.env.NODE_ENV !== ""production"")
      return response.sendStatus(200).end();
    await dumpENV();
    response.sendStatus(200).end();
  });

  app.get(""/setup-complete"", async (_, response) => {
    try {
      const results = await SystemSettings.currentSettings();
      response.status(200).json({ results });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/check-token"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (multiUserMode(response)) {
          const user = await userFromSession(request, response);
          if (!user || user.suspended) {
            response.sendStatus(403).end();
            return;
          }

          response.sendStatus(200).end();
          return;
        }

        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(""/request-token"", async (request, response) => {
    try {
      if (await SystemSettings.isMultiUserMode()) {
        const { username, password } = reqBody(request);
        const existingUser = await User.get(`username = ${escape(username)}`);

        if (!existingUser) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[001] Invalid login credentials."",
          });
          return;
        }

        const bcrypt = require(""bcrypt"");
        if (!bcrypt.compareSync(password, existingUser.password)) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[002] Invalid login credentials."",
          });
          return;
        }

        if (existingUser.suspended) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[004] Account suspended by admin."",
          });
          return;
        }

        response.status(200).json({
          valid: true,
          user: existingUser,
          token: makeJWT(
            { id: existingUser.id, username: existingUser.username },
            ""30d""
          ),
          message: null,
        });
        return;
      } else {
        const { password } = reqBody(request);
        if (password !== process.env.AUTH_TOKEN) {
          response.status(401).json({
            valid: false,
            token: null,
            message: ""[003] Invalid password provided"",
          });
          return;
        }

        response.status(200).json({
          valid: true,
          token: makeJWT({ p: password }, ""30d""),
          message: null,
        });
      }
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/system/system-vectors"", [validatedRequest], async (_, response) => {
    try {
      const VectorDb = getVectorDbClass();
      const vectorCount = await VectorDb.totalIndicies();
      response.status(200).json({ vectorCount });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/system/remove-document"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { name, meta } = reqBody(request);
        await purgeDocument(name, meta);
        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/system/local-files"", [validatedRequest], async (_, response) => {
    try {
      const localFiles = await viewLocalFiles();
      response.status(200).json({ localFiles });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/document-processing-status"",
    [validatedRequest],
    async (_, response) => {
      try {
        const online = await checkPythonAppAlive();
        response.sendStatus(online ? 200 : 503);
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/system/accepted-document-types"",
    [validatedRequest],
    async (_, response) => {
      try {
        const types = await acceptedFileTypes();
        if (!types) {
          response.sendStatus(404).end();
          return;
        }

        response.status(200).json({ types });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/update-env"",
    [validatedRequest],
    async (request, response) => {
      try {
        const body = reqBody(request);
        const { newValues, error } = updateENV(body);
        if (process.env.NODE_ENV === ""production"") await dumpENV();
        response.status(200).json({ newValues, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/update-password"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { usePassword, newPassword } = reqBody(request);
        const { error } = updateENV({
          AuthToken: usePassword ? newPassword : """",
          JWTSecret: usePassword ? v4() : """",
        });
        response.status(200).json({ success: !error, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/enable-multi-user"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { username, password } = reqBody(request);
        const multiUserModeEnabled = await SystemSettings.isMultiUserMode();
        if (multiUserModeEnabled) {
          response.status(200).json({
            success: false,
            error: ""Multi-user mode is already enabled."",
          });
          return;
        }

        const { user, error } = await User.create({
          username,
          password,
          role: ""admin"",
        });
        await SystemSettings.updateSettings({
          multi_user_mode: true,
          users_can_delete_workspaces: false,
          limit_user_messages: false,
          message_limit: 25,
        });
        process.env.AUTH_TOKEN = null;
        process.env.JWT_SECRET = process.env.JWT_SECRET ?? v4(); // Make sure JWT_SECRET is set for JWT issuance.
        await Telemetry.sendTelemetry(""enabled_multi_user_mode"");
        response.status(200).json({ success: !!user, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/system/data-export"", [validatedRequest], async (_, response) => {
    try {
      const { filename, error } = await exportData();
      response.status(200).json({ filename, error });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/data-exports/:filename"",
    [validatedRequest],
    (request, response) => {
      const exportLocation = __dirname + ""/../storage/exports/"";
      const sanitized = path
        .normalize(request.params.filename)
        .replace(/^(\.\.(\/|\\|$))+/, """");
      const finalDestination = path.join(exportLocation, sanitized);

      if (!fs.existsSync(finalDestination)) {
        response.status(404).json({
          error: 404,
          msg: `File ${request.params.filename} does not exist in exports.`,
        });
        return;
      }

      response.download(finalDestination, request.params.filename, (err) => {
        if (err) {
          response.send({
            error: err,
            msg: ""Problem downloading the file"",
          });
        }
      });
    }
  );

  app.post(
    ""/system/data-import"",
    handleImports.single(""file""),
    async function (request, response) {
      const { originalname } = request.file;
      const { success, error } = await unpackAndOverwriteImport(originalname);
      response.status(200).json({ success, error });
    }
  );

  app.get(""/system/logo/:mode?"", async function (request, response) {
    try {
      const defaultFilename = getDefaultFilename(request.params.mode);
      const logoPath = await determineLogoFilepath(defaultFilename);
      const { buffer, size, mime } = fetchLogo(logoPath);
      response.writeHead(200, {
        ""Content-Type"": mime || ""image/png"",
        ""Content-Disposition"": `attachment; filename=${path.basename(
          logoPath
        )}`,
        ""Content-Length"": size,
      });
      response.end(Buffer.from(buffer, ""base64""));
      return;
    } catch (error) {
      console.error(""Error processing the logo request:"", error);
      response.status(500).json({ message: ""Internal server error"" });
    }
  });

  app.post(
    ""/system/upload-logo"",
    [validatedRequest],
    handleLogoUploads.single(""logo""),
    async (request, response) => {
      if (!request.file || !request.file.originalname) {
        return response.status(400).json({ message: ""No logo file provided."" });
      }

      if (!validFilename(request.file.originalname)) {
        return response.status(400).json({
          message: ""Invalid file name. Please choose a different file."",
        });
      }

      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const newFilename = await renameLogoFile(request.file.originalname);
        const existingLogoFilename = await SystemSettings.currentLogoFilename();
        await removeCustomLogo(existingLogoFilename);

        const { success, error } = await SystemSettings.updateSettings({
          logo_filename: newFilename,
        });

        return response.status(success ? 200 : 500).json({
          message: success
            ? ""Logo uploaded successfully.""
            : error || ""Failed to update with new logo."",
        });
      } catch (error) {
        console.error(""Error processing the logo upload:"", error);
        response.status(500).json({ message: ""Error uploading the logo."" });
      }
    }
  );

  app.get(
    ""/system/remove-logo"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const currentLogoFilename = await SystemSettings.currentLogoFilename();
        await removeCustomLogo(currentLogoFilename);
        const { success, error } = await SystemSettings.updateSettings({
          logo_filename: DARK_LOGO_FILENAME,
        });

        return response.status(success ? 200 : 500).json({
          message: success
            ? ""Logo removed successfully.""
            : error || ""Failed to update with new logo."",
        });
      } catch (error) {
        console.error(""Error processing the logo removal:"", error);
        response.status(500).json({ message: ""Error removing the logo."" });
      }
    }
  );

  app.get(
    ""/system/can-delete-workspaces"",
    [validatedRequest],
    async function (request, response) {
      try {
        if (!response.locals.multiUserMode) {
          return response.status(200).json({ canDelete: true });
        }

        if (response.locals.user?.role === ""admin"") {
          return response.status(200).json({ canDelete: true });
        }

        const canDelete = await SystemSettings.canDeleteWorkspaces();
        response.status(200).json({ canDelete });
      } catch (error) {
        console.error(""Error fetching can delete workspaces:"", error);
        response.status(500).json({
          success: false,
          message: ""Internal server error"",
          canDelete: false,
        });
      }
    }
  );

  app.get(""/system/welcome-messages"", async function (request, response) {
    try {
      const welcomeMessages = await WelcomeMessages.getMessages();
      response.status(200).json({ success: true, welcomeMessages });
    } catch (error) {
      console.error(""Error fetching welcome messages:"", error);
      response
        .status(500)
        .json({ success: false, message: ""Internal server error"" });
    }
  });

  app.post(
    ""/system/set-welcome-messages"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const { messages = [] } = reqBody(request);
        if (!Array.isArray(messages)) {
          return response.status(400).json({
            success: false,
            message: ""Invalid message format. Expected an array of messages."",
          });
        }

        await WelcomeMessages.saveAll(messages);
        return response.status(200).json({
          success: true,
          message: ""Welcome messages saved successfully."",
        });
      } catch (error) {
        console.error(""Error processing the welcome messages:"", error);
        response.status(500).json({
          success: true,
          message: ""Error saving the welcome messages."",
        });
      }
    }
  );

  app.get(""/system/api-key"", [validatedRequest], async (_, response) => {
    try {
      if (response.locals.multiUserMode) {
        return response.sendStatus(401).end();
      }

      const apiKey = await ApiKey.get(""id IS NOT NULL"");
      return response.status(200).json({
        apiKey,
        error: null,
      });
    } catch (error) {
      console.error(error);
      response.status(500).json({
        apiKey: null,
        error: ""Could not find an API Key."",
      });
    }
  });

  app.post(
    ""/system/generate-api-key"",
    [validatedRequest],
    async (_, response) => {
      try {
        if (response.locals.multiUserMode) {
          return response.sendStatus(401).end();
        }

        await ApiKey.delete();
        const { apiKey, error } = await ApiKey.create();
        return response.status(200).json({
          apiKey,
          error,
        });
      } catch (error) {
        console.error(error);
        response.status(500).json({
          apiKey: null,
          error: ""Error generating api key."",
        });
      }
    }
  );

  app.delete(""/system/api-key"", [validatedRequest], async (_, response) => {
    try {
      if (response.locals.multiUserMode) {
        return response.sendStatus(401).end();
      }

      await ApiKey.delete();
      return response.status(200).end();
    } catch (error) {
      console.error(error);
      response.status(500).end();
    }
  });
}

module.exports = { systemEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR.VAR === ""VAR"" ? VAR(""VAR"").VAR({ VAR: `.VAR.${VAR.VAR.VAR}` }) : VAR(""VAR"").VAR(); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, VAR, VAR, } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(); VAR { VAR } = VAR(); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR""); VAR { VAR, VAR, VAR, VAR, VAR, VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""VAR-VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR"", (VAR, VAR) => { VAR.VAR(200).VAR({ VAR: VAR }); }); VAR.VAR(""/VAR"", VAR (VAR, VAR) => { VAR VAR(VAR); VAR.VAR(200); }); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR (VAR.VAR.VAR !== ""VAR"") VAR VAR.VAR(200).VAR(); VAR VAR(); VAR.VAR(200).VAR(); }); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR(VAR)) { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR.VAR) { VAR.VAR(403).VAR(); VAR; } VAR.VAR(200).VAR(); VAR; } VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR { VAR (VAR VAR.VAR()) { VAR { VAR, VAR } = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[001] VAR VAR VAR."", }); VAR; } VAR VAR = VAR(""VAR""); VAR (!VAR.VAR(VAR, VAR.VAR)) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[002] VAR VAR VAR."", }); VAR; } VAR (VAR.VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[004] VAR VAR VAR VAR."", }); VAR; } VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR( { VAR: VAR.VAR, VAR: VAR.VAR }, ""30d"" ), VAR: VAR, }); VAR; } VAR { VAR { VAR } = VAR(VAR); VAR (VAR !== VAR.VAR.VAR) { VAR.VAR(401).VAR({ VAR: VAR, VAR: VAR, VAR: ""[003] VAR VAR VAR"", }); VAR; } VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR({ VAR: VAR }, ""30d""), VAR: VAR, }); } } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR(); VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR VAR(VAR, VAR); VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR.VAR(VAR ? 200 : 503); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR(VAR); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR { VAR } = VAR({ VAR: VAR ? VAR : """", VAR: VAR ? VAR() : """", }); VAR.VAR(200).VAR({ VAR: !VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR VAR = VAR VAR.VAR(); VAR (VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR-VAR VAR VAR VAR VAR."", }); VAR; } VAR { VAR, VAR } = VAR VAR.VAR({ VAR, VAR, VAR: ""VAR"", }); VAR VAR.VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: 25, }); VAR.VAR.VAR = VAR; VAR.VAR.VAR = VAR.VAR.VAR ?? VAR();  VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: !!VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR/:VAR"", [VAR], (VAR, VAR) => { VAR VAR = VAR + ""/../VAR/VAR/""; VAR VAR = VAR .VAR(VAR.VAR.VAR) .VAR(/^(\.\.(\/|\\|$))+/, """"); VAR VAR = VAR.VAR(VAR, VAR); VAR (!VAR.VAR(VAR)) { VAR.VAR(404).VAR({ VAR: 404, VAR: `VAR ${VAR.VAR.VAR} VAR VAR VAR VAR VAR.`, }); VAR; } VAR.VAR(VAR, VAR.VAR.VAR, (VAR) => { VAR (VAR) { VAR.VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR"", }); } }); } ); VAR.VAR( ""/VAR/VAR-VAR"", VAR.VAR(""VAR""), VAR VAR (VAR, VAR) { VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } ); VAR.VAR(""/VAR/VAR/:VAR?"", VAR VAR (VAR, VAR) { VAR { VAR VAR = VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(VAR); VAR { VAR, VAR, VAR } = VAR(VAR); VAR.VAR(200, { ""VAR-VAR"": VAR || ""VAR/VAR"", ""VAR-VAR"": `VAR; VAR=${VAR.VAR( VAR )}`, ""VAR-VAR"": VAR, }); VAR.VAR(VAR.VAR(VAR, ""VAR"")); VAR; } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR"" }); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR.VAR(""VAR""), VAR (VAR, VAR) => { VAR (!VAR.VAR || !VAR.VAR.VAR) { VAR VAR.VAR(400).VAR({ VAR: ""VAR VAR VAR VAR."" }); } VAR (!VAR(VAR.VAR.VAR)) { VAR VAR.VAR(400).VAR({ VAR: ""VAR VAR VAR. VAR VAR VAR VAR VAR."", }); } VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR(VAR.VAR.VAR); VAR VAR = VAR VAR.VAR(); VAR VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR({ VAR: VAR, }); VAR VAR.VAR(VAR ? 200 : 500).VAR({ VAR: VAR ? ""VAR VAR VAR."" : VAR || ""VAR VAR VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR VAR."" }); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR.VAR(); VAR VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR({ VAR: VAR, }); VAR VAR.VAR(VAR ? 200 : 500).VAR({ VAR: VAR ? ""VAR VAR VAR."" : VAR || ""VAR VAR VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR VAR."" }); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR VAR (VAR, VAR) { VAR { VAR (!VAR.VAR.VAR) { VAR VAR.VAR(200).VAR({ VAR: VAR }); } VAR (VAR.VAR.VAR?.VAR === ""VAR"") { VAR VAR.VAR(200).VAR({ VAR: VAR }); } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR"", VAR: VAR, }); } } ); VAR.VAR(""/VAR/VAR-VAR"", VAR VAR (VAR, VAR) { VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR:"", VAR); VAR .VAR(500) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR"" }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR { VAR = [] } = VAR(VAR); VAR (!VAR.VAR(VAR)) { VAR VAR.VAR(400).VAR({ VAR: VAR, VAR: ""VAR VAR VAR. VAR VAR VAR VAR VAR."", }); } VAR VAR.VAR(VAR); VAR VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR."", }); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR.VAR(""VAR VAR VAR VAR""); VAR VAR.VAR(200).VAR({ VAR, VAR: VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."", }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR.VAR(); VAR { VAR, VAR } = VAR VAR.VAR(); VAR VAR.VAR(200).VAR({ VAR, VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."", }); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR.VAR(); VAR VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/system.js,"process.env.NODE_ENV === ""development""
  ? require(""dotenv"").config({ path: `.env.${process.env.NODE_ENV}` })
  : require(""dotenv"").config();
const { validateTablePragmas } = require(""../utils/database"");
const { viewLocalFiles } = require(""../utils/files"");
const { exportData, unpackAndOverwriteImport } = require(""../utils/files/data"");
const {
  checkPythonAppAlive,
  acceptedFileTypes,
} = require(""../utils/files/documentProcessor"");
const { purgeDocument } = require(""../utils/files/purgeDocument"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { updateENV, dumpENV } = require(""../utils/helpers/updateENV"");
const {
  reqBody,
  makeJWT,
  userFromSession,
  multiUserMode,
} = require(""../utils/http"");
const { setupDataImports, setupLogoUploads } = require(""../utils/files/multer"");
const { v4 } = require(""uuid"");
const { SystemSettings } = require(""../models/systemSettings"");
const { User } = require(""../models/user"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { handleImports } = setupDataImports();
const { handleLogoUploads } = setupLogoUploads();
const fs = require(""fs"");
const path = require(""path"");
const {
  getDefaultFilename,
  determineLogoFilepath,
  fetchLogo,
  validFilename,
  renameLogoFile,
  removeCustomLogo,
  DARK_LOGO_FILENAME,
} = require(""../utils/files/logo"");
const { Telemetry } = require(""../models/telemetry"");
const { WelcomeMessages } = require(""../models/welcomeMessages"");
const { ApiKey } = require(""../models/apiKeys"");
const { escape } = require(""sqlstring-sqlite"");

function systemEndpoints(app) {
  if (!app) return;

  app.get(""/ping"", (_, response) => {
    response.status(200).json({ online: true });
  });

  app.get(""/migrate"", async (_, response) => {
    await validateTablePragmas(true);
    response.sendStatus(200);
  });

  app.get(""/env-dump"", async (_, response) => {
    if (process.env.NODE_ENV !== ""production"")
      return response.sendStatus(200).end();
    await dumpENV();
    response.sendStatus(200).end();
  });

  app.get(""/setup-complete"", async (_, response) => {
    try {
      const results = await SystemSettings.currentSettings();
      response.status(200).json({ results });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/check-token"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (multiUserMode(response)) {
          const user = await userFromSession(request, response);
          if (!user || user.suspended) {
            response.sendStatus(403).end();
            return;
          }

          response.sendStatus(200).end();
          return;
        }

        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(""/request-token"", async (request, response) => {
    try {
      if (await SystemSettings.isMultiUserMode()) {
        const { username, password } = reqBody(request);
        const existingUser = await User.get(`username = ${escape(username)}`);

        if (!existingUser) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[001] Invalid login credentials."",
          });
          return;
        }

        const bcrypt = require(""bcrypt"");
        if (!bcrypt.compareSync(password, existingUser.password)) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[002] Invalid login credentials."",
          });
          return;
        }

        if (existingUser.suspended) {
          response.status(200).json({
            user: null,
            valid: false,
            token: null,
            message: ""[004] Account suspended by admin."",
          });
          return;
        }

        response.status(200).json({
          valid: true,
          user: existingUser,
          token: makeJWT(
            { id: existingUser.id, username: existingUser.username },
            ""30d""
          ),
          message: null,
        });
        return;
      } else {
        const { password } = reqBody(request);
        if (password !== process.env.AUTH_TOKEN) {
          response.status(401).json({
            valid: false,
            token: null,
            message: ""[003] Invalid password provided"",
          });
          return;
        }

        response.status(200).json({
          valid: true,
          token: makeJWT({ p: password }, ""30d""),
          message: null,
        });
      }
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/system/system-vectors"", [validatedRequest], async (_, response) => {
    try {
      const VectorDb = getVectorDbClass();
      const vectorCount = await VectorDb.totalIndicies();
      response.status(200).json({ vectorCount });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.delete(
    ""/system/remove-document"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { name, meta } = reqBody(request);
        await purgeDocument(name, meta);
        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/system/local-files"", [validatedRequest], async (_, response) => {
    try {
      const localFiles = await viewLocalFiles();
      response.status(200).json({ localFiles });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/document-processing-status"",
    [validatedRequest],
    async (_, response) => {
      try {
        const online = await checkPythonAppAlive();
        response.sendStatus(online ? 200 : 503);
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(
    ""/system/accepted-document-types"",
    [validatedRequest],
    async (_, response) => {
      try {
        const types = await acceptedFileTypes();
        if (!types) {
          response.sendStatus(404).end();
          return;
        }

        response.status(200).json({ types });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/update-env"",
    [validatedRequest],
    async (request, response) => {
      try {
        const body = reqBody(request);
        const { newValues, error } = updateENV(body);
        if (process.env.NODE_ENV === ""production"") await dumpENV();
        response.status(200).json({ newValues, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/update-password"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { usePassword, newPassword } = reqBody(request);
        const { error } = updateENV({
          AuthToken: usePassword ? newPassword : """",
          JWTSecret: usePassword ? v4() : """",
        });
        response.status(200).json({ success: !error, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/system/enable-multi-user"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { username, password } = reqBody(request);
        const multiUserModeEnabled = await SystemSettings.isMultiUserMode();
        if (multiUserModeEnabled) {
          response.status(200).json({
            success: false,
            error: ""Multi-user mode is already enabled."",
          });
          return;
        }

        const { user, error } = await User.create({
          username,
          password,
          role: ""admin"",
        });
        await SystemSettings.updateSettings({
          multi_user_mode: true,
          users_can_delete_workspaces: false,
          limit_user_messages: false,
          message_limit: 25,
        });
        process.env.AUTH_TOKEN = null;
        process.env.JWT_SECRET = process.env.JWT_SECRET ?? v4(); // Make sure JWT_SECRET is set for JWT issuance.
        await Telemetry.sendTelemetry(""enabled_multi_user_mode"");
        response.status(200).json({ success: !!user, error });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/system/data-export"", [validatedRequest], async (_, response) => {
    try {
      const { filename, error } = await exportData();
      response.status(200).json({ filename, error });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/system/data-exports/:filename"",
    [validatedRequest],
    (request, response) => {
      const exportLocation = __dirname + ""/../storage/exports/"";
      const sanitized = path
        .normalize(request.params.filename)
        .replace(/^(\.\.(\/|\\|$))+/, """");
      const finalDestination = path.join(exportLocation, sanitized);

      if (!fs.existsSync(finalDestination)) {
        response.status(404).json({
          error: 404,
          msg: `File ${request.params.filename} does not exist in exports.`,
        });
        return;
      }

      response.download(finalDestination, request.params.filename, (err) => {
        if (err) {
          response.send({
            error: err,
            msg: ""Problem downloading the file"",
          });
        }
      });
    }
  );

  app.post(
    ""/system/data-import"",
    handleImports.single(""file""),
    async function (request, response) {
      const { originalname } = request.file;
      const { success, error } = await unpackAndOverwriteImport(originalname);
      response.status(200).json({ success, error });
    }
  );

  app.get(""/system/logo/:mode?"", async function (request, response) {
    try {
      const defaultFilename = getDefaultFilename(request.params.mode);
      const logoPath = await determineLogoFilepath(defaultFilename);
      const { buffer, size, mime } = fetchLogo(logoPath);
      response.writeHead(200, {
        ""Content-Type"": mime || ""image/png"",
        ""Content-Disposition"": `attachment; filename=${path.basename(
          logoPath
        )}`,
        ""Content-Length"": size,
      });
      response.end(Buffer.from(buffer, ""base64""));
      return;
    } catch (error) {
      console.error(""Error processing the logo request:"", error);
      response.status(500).json({ message: ""Internal server error"" });
    }
  });

  app.post(
    ""/system/upload-logo"",
    [validatedRequest],
    handleLogoUploads.single(""logo""),
    async (request, response) => {
      if (!request.file || !request.file.originalname) {
        return response.status(400).json({ message: ""No logo file provided."" });
      }

      if (!validFilename(request.file.originalname)) {
        return response.status(400).json({
          message: ""Invalid file name. Please choose a different file."",
        });
      }

      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const newFilename = await renameLogoFile(request.file.originalname);
        const existingLogoFilename = await SystemSettings.currentLogoFilename();
        await removeCustomLogo(existingLogoFilename);

        const { success, error } = await SystemSettings.updateSettings({
          logo_filename: newFilename,
        });

        return response.status(success ? 200 : 500).json({
          message: success
            ? ""Logo uploaded successfully.""
            : error || ""Failed to update with new logo."",
        });
      } catch (error) {
        console.error(""Error processing the logo upload:"", error);
        response.status(500).json({ message: ""Error uploading the logo."" });
      }
    }
  );

  app.get(
    ""/system/remove-logo"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const currentLogoFilename = await SystemSettings.currentLogoFilename();
        await removeCustomLogo(currentLogoFilename);
        const { success, error } = await SystemSettings.updateSettings({
          logo_filename: DARK_LOGO_FILENAME,
        });

        return response.status(success ? 200 : 500).json({
          message: success
            ? ""Logo removed successfully.""
            : error || ""Failed to update with new logo."",
        });
      } catch (error) {
        console.error(""Error processing the logo removal:"", error);
        response.status(500).json({ message: ""Error removing the logo."" });
      }
    }
  );

  app.get(
    ""/system/can-delete-workspaces"",
    [validatedRequest],
    async function (request, response) {
      try {
        if (!response.locals.multiUserMode) {
          return response.status(200).json({ canDelete: true });
        }

        if (response.locals.user?.role === ""admin"") {
          return response.status(200).json({ canDelete: true });
        }

        const canDelete = await SystemSettings.canDeleteWorkspaces();
        response.status(200).json({ canDelete });
      } catch (error) {
        console.error(""Error fetching can delete workspaces:"", error);
        response.status(500).json({
          success: false,
          message: ""Internal server error"",
          canDelete: false,
        });
      }
    }
  );

  app.get(""/system/welcome-messages"", async function (request, response) {
    try {
      const welcomeMessages = await WelcomeMessages.getMessages();
      response.status(200).json({ success: true, welcomeMessages });
    } catch (error) {
      console.error(""Error fetching welcome messages:"", error);
      response
        .status(500)
        .json({ success: false, message: ""Internal server error"" });
    }
  });

  app.post(
    ""/system/set-welcome-messages"",
    [validatedRequest],
    async (request, response) => {
      try {
        if (
          response.locals.multiUserMode &&
          response.locals.user?.role !== ""admin""
        ) {
          return response.sendStatus(401).end();
        }

        const { messages = [] } = reqBody(request);
        if (!Array.isArray(messages)) {
          return response.status(400).json({
            success: false,
            message: ""Invalid message format. Expected an array of messages."",
          });
        }

        await WelcomeMessages.saveAll(messages);
        return response.status(200).json({
          success: true,
          message: ""Welcome messages saved successfully."",
        });
      } catch (error) {
        console.error(""Error processing the welcome messages:"", error);
        response.status(500).json({
          success: true,
          message: ""Error saving the welcome messages."",
        });
      }
    }
  );

  app.get(""/system/api-key"", [validatedRequest], async (_, response) => {
    try {
      if (response.locals.multiUserMode) {
        return response.sendStatus(401).end();
      }

      const apiKey = await ApiKey.get(""id IS NOT NULL"");
      return response.status(200).json({
        apiKey,
        error: null,
      });
    } catch (error) {
      console.error(error);
      response.status(500).json({
        apiKey: null,
        error: ""Could not find an API Key."",
      });
    }
  });

  app.post(
    ""/system/generate-api-key"",
    [validatedRequest],
    async (_, response) => {
      try {
        if (response.locals.multiUserMode) {
          return response.sendStatus(401).end();
        }

        await ApiKey.delete();
        const { apiKey, error } = await ApiKey.create();
        return response.status(200).json({
          apiKey,
          error,
        });
      } catch (error) {
        console.error(error);
        response.status(500).json({
          apiKey: null,
          error: ""Error generating api key."",
        });
      }
    }
  );

  app.delete(""/system/api-key"", [validatedRequest], async (_, response) => {
    try {
      if (response.locals.multiUserMode) {
        return response.sendStatus(401).end();
      }

      await ApiKey.delete();
      return response.status(200).end();
    } catch (error) {
      console.error(error);
      response.status(500).end();
    }
  });
}

module.exports = { systemEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR.VAR === ""VAR"" ? VAR(""VAR"").VAR({ VAR: `.VAR.${VAR.VAR.VAR}` }) : VAR(""VAR"").VAR(); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, VAR, VAR, } = VAR(""../VAR/VAR""); VAR { VAR, VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(); VAR { VAR } = VAR(); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR""); VAR { VAR, VAR, VAR, VAR, VAR, VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""VAR-VAR""); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR"", (VAR, VAR) => { VAR.VAR(200).VAR({ VAR: VAR }); }); VAR.VAR(""/VAR"", VAR (VAR, VAR) => { VAR VAR(VAR); VAR.VAR(200); }); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR (VAR.VAR.VAR !== ""VAR"") VAR VAR.VAR(200).VAR(); VAR VAR(); VAR.VAR(200).VAR(); }); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR(VAR)) { VAR VAR = VAR VAR(VAR, VAR); VAR (!VAR || VAR.VAR) { VAR.VAR(403).VAR(); VAR; } VAR.VAR(200).VAR(); VAR; } VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR-VAR"", VAR (VAR, VAR) => { VAR { VAR (VAR VAR.VAR()) { VAR { VAR, VAR } = VAR(VAR); VAR VAR = VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[001] VAR VAR VAR."", }); VAR; } VAR VAR = VAR(""VAR""); VAR (!VAR.VAR(VAR, VAR.VAR)) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[002] VAR VAR VAR."", }); VAR; } VAR (VAR.VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: ""[004] VAR VAR VAR VAR."", }); VAR; } VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR, VAR: VAR( { VAR: VAR.VAR, VAR: VAR.VAR }, ""30d"" ), VAR: VAR, }); VAR; } VAR { VAR { VAR } = VAR(VAR); VAR (VAR !== VAR.VAR.VAR) { VAR.VAR(401).VAR({ VAR: VAR, VAR: VAR, VAR: ""[003] VAR VAR VAR"", }); VAR; } VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR({ VAR: VAR }, ""30d""), VAR: VAR, }); } } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR(); VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR VAR(VAR, VAR); VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR.VAR(VAR ? 200 : 503); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(); VAR (!VAR) { VAR.VAR(404).VAR(); VAR; } VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR(VAR); VAR { VAR, VAR } = VAR(VAR); VAR (VAR.VAR.VAR === ""VAR"") VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR { VAR } = VAR({ VAR: VAR ? VAR : """", VAR: VAR ? VAR() : """", }); VAR.VAR(200).VAR({ VAR: !VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR(VAR); VAR VAR = VAR VAR.VAR(); VAR (VAR) { VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR-VAR VAR VAR VAR VAR."", }); VAR; } VAR { VAR, VAR } = VAR VAR.VAR({ VAR, VAR, VAR: ""VAR"", }); VAR VAR.VAR({ VAR: VAR, VAR: VAR, VAR: VAR, VAR: 25, }); VAR.VAR.VAR = VAR; VAR.VAR.VAR = VAR.VAR.VAR ?? VAR();  VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: !!VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR, VAR } = VAR VAR(); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/VAR-VAR/:VAR"", [VAR], (VAR, VAR) => { VAR VAR = VAR + ""/../VAR/VAR/""; VAR VAR = VAR .VAR(VAR.VAR.VAR) .VAR(/^(\.\.(\/|\\|$))+/, """"); VAR VAR = VAR.VAR(VAR, VAR); VAR (!VAR.VAR(VAR)) { VAR.VAR(404).VAR({ VAR: 404, VAR: `VAR ${VAR.VAR.VAR} VAR VAR VAR VAR VAR.`, }); VAR; } VAR.VAR(VAR, VAR.VAR.VAR, (VAR) => { VAR (VAR) { VAR.VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR"", }); } }); } ); VAR.VAR( ""/VAR/VAR-VAR"", VAR.VAR(""VAR""), VAR VAR (VAR, VAR) { VAR { VAR } = VAR.VAR; VAR { VAR, VAR } = VAR VAR(VAR); VAR.VAR(200).VAR({ VAR, VAR }); } ); VAR.VAR(""/VAR/VAR/:VAR?"", VAR VAR (VAR, VAR) { VAR { VAR VAR = VAR(VAR.VAR.VAR); VAR VAR = VAR VAR(VAR); VAR { VAR, VAR, VAR } = VAR(VAR); VAR.VAR(200, { ""VAR-VAR"": VAR || ""VAR/VAR"", ""VAR-VAR"": `VAR; VAR=${VAR.VAR( VAR )}`, ""VAR-VAR"": VAR, }); VAR.VAR(VAR.VAR(VAR, ""VAR"")); VAR; } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR"" }); } }); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR.VAR(""VAR""), VAR (VAR, VAR) => { VAR (!VAR.VAR || !VAR.VAR.VAR) { VAR VAR.VAR(400).VAR({ VAR: ""VAR VAR VAR VAR."" }); } VAR (!VAR(VAR.VAR.VAR)) { VAR VAR.VAR(400).VAR({ VAR: ""VAR VAR VAR. VAR VAR VAR VAR VAR."", }); } VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR(VAR.VAR.VAR); VAR VAR = VAR VAR.VAR(); VAR VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR({ VAR: VAR, }); VAR VAR.VAR(VAR ? 200 : 500).VAR({ VAR: VAR ? ""VAR VAR VAR."" : VAR || ""VAR VAR VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR VAR."" }); } } ); VAR.VAR( ""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR.VAR(); VAR VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR({ VAR: VAR, }); VAR VAR.VAR(VAR ? 200 : 500).VAR({ VAR: VAR ? ""VAR VAR VAR."" : VAR || ""VAR VAR VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR VAR."" }); } } ); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR VAR (VAR, VAR) { VAR { VAR (!VAR.VAR.VAR) { VAR VAR.VAR(200).VAR({ VAR: VAR }); } VAR (VAR.VAR.VAR?.VAR === ""VAR"") { VAR VAR.VAR(200).VAR({ VAR: VAR }); } VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR"", VAR: VAR, }); } } ); VAR.VAR(""/VAR/VAR-VAR"", VAR VAR (VAR, VAR) { VAR { VAR VAR = VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR: VAR, VAR }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR:"", VAR); VAR .VAR(500) .VAR({ VAR: VAR, VAR: ""VAR VAR VAR"" }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR ( VAR.VAR.VAR && VAR.VAR.VAR?.VAR !== ""VAR"" ) { VAR VAR.VAR(401).VAR(); } VAR { VAR = [] } = VAR(VAR); VAR (!VAR.VAR(VAR)) { VAR VAR.VAR(400).VAR({ VAR: VAR, VAR: ""VAR VAR VAR. VAR VAR VAR VAR VAR."", }); } VAR VAR.VAR(VAR); VAR VAR.VAR(200).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."", }); } VAR (VAR) { VAR.VAR(""VAR VAR VAR VAR VAR:"", VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR."", }); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR = VAR VAR.VAR(""VAR VAR VAR VAR""); VAR VAR.VAR(200).VAR({ VAR, VAR: VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR VAR VAR."", }); } }); VAR.VAR( ""/VAR/VAR-VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR.VAR(); VAR { VAR, VAR } = VAR VAR.VAR(); VAR VAR.VAR(200).VAR({ VAR, VAR, }); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR({ VAR: VAR, VAR: ""VAR VAR VAR VAR."", }); } } ); VAR.VAR(""/VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR (VAR.VAR.VAR) { VAR VAR.VAR(401).VAR(); } VAR VAR.VAR(); VAR VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/utils.js,"const { SystemSettings } = require(""../models/systemSettings"");

function getGitVersion() {
  try {
    return require(""child_process"")
      .execSync(""git rev-parse HEAD"")
      .toString()
      .trim();
  } catch (e) {
    console.error(""getGitVersion"", e.message);
    return ""--"";
  }
}

function byteToGigaByte(n) {
  return n / Math.pow(10, 9);
}

async function getDiskStorage() {
  try {
    const checkDiskSpace = require(""check-disk-space"").default;
    const { free, size } = await checkDiskSpace(""/"");
    return {
      current: Math.floor(byteToGigaByte(free)),
      capacity: Math.floor(byteToGigaByte(size)),
    };
  } catch {
    return {
      current: null,
      capacity: null,
    };
  }
}

function utilEndpoints(app) {
  if (!app) return;

  app.get(""/utils/metrics"", async (_, response) => {
    try {
      const metrics = {
        online: true,
        version: getGitVersion(),
        mode: (await SystemSettings.isMultiUserMode())
          ? ""multi-user""
          : ""single-user"",
        vectorDB: process.env.VECTOR_DB || ""lancedb"",
        storage: await getDiskStorage(),
      };
      response.status(200).json(metrics);
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });
}

module.exports = { utilEndpoints, getGitVersion };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR() { VAR { VAR VAR(""VAR"") .VAR(""VAR VAR-VAR VAR"") .VAR() .VAR(); } VAR (VAR) { VAR.VAR(""VAR"", VAR.VAR); VAR ""--""; } } VAR VAR(VAR) { VAR VAR / VAR.VAR(10, 9); } VAR VAR VAR() { VAR { VAR VAR = VAR(""VAR-VAR-VAR"").VAR; VAR { VAR, VAR } = VAR VAR(""/""); VAR { VAR: VAR.VAR(VAR(VAR)), VAR: VAR.VAR(VAR(VAR)), }; } VAR { VAR { VAR: VAR, VAR: VAR, }; } } VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = { VAR: VAR, VAR: VAR(), VAR: (VAR VAR.VAR()) ? ""VAR-VAR"" : ""VAR-VAR"", VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR VAR(), }; VAR.VAR(200).VAR(VAR); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR, VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/utils.js,"const { SystemSettings } = require(""../models/systemSettings"");

function getGitVersion() {
  try {
    return require(""child_process"")
      .execSync(""git rev-parse HEAD"")
      .toString()
      .trim();
  } catch (e) {
    console.error(""getGitVersion"", e.message);
    return ""--"";
  }
}

function byteToGigaByte(n) {
  return n / Math.pow(10, 9);
}

async function getDiskStorage() {
  try {
    const checkDiskSpace = require(""check-disk-space"").default;
    const { free, size } = await checkDiskSpace(""/"");
    return {
      current: Math.floor(byteToGigaByte(free)),
      capacity: Math.floor(byteToGigaByte(size)),
    };
  } catch {
    return {
      current: null,
      capacity: null,
    };
  }
}

function utilEndpoints(app) {
  if (!app) return;

  app.get(""/utils/metrics"", async (_, response) => {
    try {
      const metrics = {
        online: true,
        version: getGitVersion(),
        mode: (await SystemSettings.isMultiUserMode())
          ? ""multi-user""
          : ""single-user"",
        vectorDB: process.env.VECTOR_DB || ""lancedb"",
        storage: await getDiskStorage(),
      };
      response.status(200).json(metrics);
    } catch (e) {
      console.error(e);
      response.sendStatus(500).end();
    }
  });
}

module.exports = { utilEndpoints, getGitVersion };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../VAR/VAR""); VAR VAR() { VAR { VAR VAR(""VAR"") .VAR(""VAR VAR-VAR VAR"") .VAR() .VAR(); } VAR (VAR) { VAR.VAR(""VAR"", VAR.VAR); VAR ""--""; } } VAR VAR(VAR) { VAR VAR / VAR.VAR(10, 9); } VAR VAR VAR() { VAR { VAR VAR = VAR(""VAR-VAR-VAR"").VAR; VAR { VAR, VAR } = VAR VAR(""/""); VAR { VAR: VAR.VAR(VAR(VAR)), VAR: VAR.VAR(VAR(VAR)), }; } VAR { VAR { VAR: VAR, VAR: VAR, }; } } VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = { VAR: VAR, VAR: VAR(), VAR: (VAR VAR.VAR()) ? ""VAR-VAR"" : ""VAR-VAR"", VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR VAR(), }; VAR.VAR(200).VAR(VAR); } VAR (VAR) { VAR.VAR(VAR); VAR.VAR(500).VAR(); } }); } VAR.VAR = { VAR, VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/workspaces.js,"const { reqBody, multiUserMode, userFromSession } = require(""../utils/http"");
const { Workspace } = require(""../models/workspace"");
const { Document } = require(""../models/documents"");
const { DocumentVectors } = require(""../models/vectors"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { convertToChatHistory } = require(""../utils/chats"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { setupMulter } = require(""../utils/files/multer"");
const {
  checkPythonAppAlive,
  processDocument,
} = require(""../utils/files/documentProcessor"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { SystemSettings } = require(""../models/systemSettings"");
const { Telemetry } = require(""../models/telemetry"");
const { escape } = require(""sqlstring-sqlite"");
const { handleUploads } = setupMulter();

function workspaceEndpoints(app) {
  if (!app) return;

  app.post(""/workspace/new"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      const { name = null } = reqBody(request);
      const { workspace, message } = await Workspace.new(name, user?.id);
      await Telemetry.sendTelemetry(""workspace_created"", {
        multiUserMode: multiUserMode(response),
        LLMSelection: process.env.LLM_PROVIDER || ""openai"",
        VectorDbSelection: process.env.VECTOR_DB || ""pinecone"",
      });
      response.status(200).json({ workspace, message });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/workspace/:slug/update"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug = null } = request.params;
        const data = reqBody(request);
        const currWorkspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!currWorkspace) {
          response.sendStatus(400).end();
          return;
        }

        const { workspace, message } = await Workspace.update(
          currWorkspace.id,
          data
        );
        response.status(200).json({ workspace, message });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/workspace/:slug/upload"",
    handleUploads.single(""file""),
    async function (request, response) {
      const { originalname } = request.file;
      const processingOnline = await checkPythonAppAlive();

      if (!processingOnline) {
        response
          .status(500)
          .json({
            success: false,
            error: `Python processing API is not online. Document ${originalname} will not be processed automatically.`,
          })
          .end();
        return;
      }

      const { success, reason } = await processDocument(originalname);
      if (!success) {
        response.status(500).json({ success: false, error: reason }).end();
        return;
      }

      console.log(
        `Document ${originalname} uploaded processed and successfully. It is now available in documents.`
      );
      await Telemetry.sendTelemetry(""document_uploaded"");
      response.status(200).json({ success: true, error: null });
    }
  );

  app.post(
    ""/workspace/:slug/update-embeddings"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug = null } = request.params;
        const { adds = [], deletes = [] } = reqBody(request);
        const currWorkspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!currWorkspace) {
          response.sendStatus(400).end();
          return;
        }

        await Document.removeDocuments(currWorkspace, deletes);
        await Document.addDocuments(currWorkspace, adds);
        const updatedWorkspace = await Workspace.get(
          `id = ${currWorkspace.id}`
        );
        response.status(200).json({ workspace: updatedWorkspace });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/workspace/:slug"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { slug = """" } = request.params;
        const user = await userFromSession(request, response);
        const VectorDb = getVectorDbClass();
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        if (multiUserMode(response) && user.role !== ""admin"") {
          const canDelete =
            (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
              ?.value === ""true"";
          if (!canDelete) {
            response.sendStatus(500).end();
            return;
          }
        }

        await Workspace.delete(`id = ${Number(workspace.id)}`);
        await DocumentVectors.deleteForWorkspace(workspace.id);
        await Document.delete(`workspaceId = ${Number(workspace.id)}`);
        await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);
        try {
          await VectorDb[""delete-namespace""]({ namespace: slug });
        } catch (e) {
          console.error(e.message);
        }
        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/workspaces"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      const workspaces = multiUserMode(response)
        ? await Workspace.whereWithUser(user)
        : await Workspace.where();

      response.status(200).json({ workspaces });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/workspace/:slug"", [validatedRequest], async (request, response) => {
    try {
      const { slug } = request.params;
      const user = await userFromSession(request, response);
      const workspace = multiUserMode(response)
        ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
        : await Workspace.get(`slug = ${escape(slug)}`);

      response.status(200).json({ workspace });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/workspace/:slug/chats"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { slug } = request.params;
        const user = await userFromSession(request, response);
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        const history = multiUserMode(response)
          ? await WorkspaceChats.forWorkspaceByUser(workspace.id, user.id)
          : await WorkspaceChats.forWorkspace(workspace.id);

        response.status(200).json({ history: convertToChatHistory(history) });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { workspaceEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR, VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR?.VAR); VAR VAR.VAR(""VAR"", { VAR: VAR(VAR), VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR.VAR.VAR || ""VAR"", }); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR( VAR.VAR, VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/:VAR/VAR"", VAR.VAR(""VAR""), VAR VAR (VAR, VAR) { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(); VAR (!VAR) { VAR .VAR(500) .VAR({ VAR: VAR, VAR: `VAR VAR VAR VAR VAR VAR. VAR ${VAR} VAR VAR VAR VAR VAR.`, }) .VAR(); VAR; } VAR { VAR, VAR } = VAR VAR(VAR); VAR (!VAR) { VAR.VAR(500).VAR({ VAR: VAR, VAR: VAR }).VAR(); VAR; } VAR.VAR( `VAR ${VAR} VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR.` ); VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } ); VAR.VAR( ""/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR.VAR; VAR { VAR = [], VAR = [] } = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR VAR.VAR(VAR, VAR); VAR VAR.VAR(VAR, VAR); VAR VAR = VAR VAR.VAR( `VAR = ${VAR.VAR}` ); VAR.VAR(200).VAR({ VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR = """" } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR (VAR(VAR) && VAR.VAR !== ""VAR"") { VAR VAR = (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR""; VAR (!VAR) { VAR.VAR(500).VAR(); VAR; } } VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR { VAR VAR[""VAR-VAR""]({ VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR); } VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR) : VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR.VAR, VAR.VAR) : VAR VAR.VAR(VAR.VAR); VAR.VAR(200).VAR({ VAR: VAR(VAR) }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/endpoints/workspaces.js,"const { reqBody, multiUserMode, userFromSession } = require(""../utils/http"");
const { Workspace } = require(""../models/workspace"");
const { Document } = require(""../models/documents"");
const { DocumentVectors } = require(""../models/vectors"");
const { WorkspaceChats } = require(""../models/workspaceChats"");
const { convertToChatHistory } = require(""../utils/chats"");
const { getVectorDbClass } = require(""../utils/helpers"");
const { setupMulter } = require(""../utils/files/multer"");
const {
  checkPythonAppAlive,
  processDocument,
} = require(""../utils/files/documentProcessor"");
const { validatedRequest } = require(""../utils/middleware/validatedRequest"");
const { SystemSettings } = require(""../models/systemSettings"");
const { Telemetry } = require(""../models/telemetry"");
const { escape } = require(""sqlstring-sqlite"");
const { handleUploads } = setupMulter();

function workspaceEndpoints(app) {
  if (!app) return;

  app.post(""/workspace/new"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      const { name = null } = reqBody(request);
      const { workspace, message } = await Workspace.new(name, user?.id);
      await Telemetry.sendTelemetry(""workspace_created"", {
        multiUserMode: multiUserMode(response),
        LLMSelection: process.env.LLM_PROVIDER || ""openai"",
        VectorDbSelection: process.env.VECTOR_DB || ""pinecone"",
      });
      response.status(200).json({ workspace, message });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.post(
    ""/workspace/:slug/update"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug = null } = request.params;
        const data = reqBody(request);
        const currWorkspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!currWorkspace) {
          response.sendStatus(400).end();
          return;
        }

        const { workspace, message } = await Workspace.update(
          currWorkspace.id,
          data
        );
        response.status(200).json({ workspace, message });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.post(
    ""/workspace/:slug/upload"",
    handleUploads.single(""file""),
    async function (request, response) {
      const { originalname } = request.file;
      const processingOnline = await checkPythonAppAlive();

      if (!processingOnline) {
        response
          .status(500)
          .json({
            success: false,
            error: `Python processing API is not online. Document ${originalname} will not be processed automatically.`,
          })
          .end();
        return;
      }

      const { success, reason } = await processDocument(originalname);
      if (!success) {
        response.status(500).json({ success: false, error: reason }).end();
        return;
      }

      console.log(
        `Document ${originalname} uploaded processed and successfully. It is now available in documents.`
      );
      await Telemetry.sendTelemetry(""document_uploaded"");
      response.status(200).json({ success: true, error: null });
    }
  );

  app.post(
    ""/workspace/:slug/update-embeddings"",
    [validatedRequest],
    async (request, response) => {
      try {
        const user = await userFromSession(request, response);
        const { slug = null } = request.params;
        const { adds = [], deletes = [] } = reqBody(request);
        const currWorkspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!currWorkspace) {
          response.sendStatus(400).end();
          return;
        }

        await Document.removeDocuments(currWorkspace, deletes);
        await Document.addDocuments(currWorkspace, adds);
        const updatedWorkspace = await Workspace.get(
          `id = ${currWorkspace.id}`
        );
        response.status(200).json({ workspace: updatedWorkspace });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.delete(
    ""/workspace/:slug"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { slug = """" } = request.params;
        const user = await userFromSession(request, response);
        const VectorDb = getVectorDbClass();
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        if (multiUserMode(response) && user.role !== ""admin"") {
          const canDelete =
            (await SystemSettings.get(`label = 'users_can_delete_workspaces'`))
              ?.value === ""true"";
          if (!canDelete) {
            response.sendStatus(500).end();
            return;
          }
        }

        await Workspace.delete(`id = ${Number(workspace.id)}`);
        await DocumentVectors.deleteForWorkspace(workspace.id);
        await Document.delete(`workspaceId = ${Number(workspace.id)}`);
        await WorkspaceChats.delete(`workspaceId = ${Number(workspace.id)}`);
        try {
          await VectorDb[""delete-namespace""]({ namespace: slug });
        } catch (e) {
          console.error(e.message);
        }
        response.sendStatus(200).end();
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );

  app.get(""/workspaces"", [validatedRequest], async (request, response) => {
    try {
      const user = await userFromSession(request, response);
      const workspaces = multiUserMode(response)
        ? await Workspace.whereWithUser(user)
        : await Workspace.where();

      response.status(200).json({ workspaces });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(""/workspace/:slug"", [validatedRequest], async (request, response) => {
    try {
      const { slug } = request.params;
      const user = await userFromSession(request, response);
      const workspace = multiUserMode(response)
        ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
        : await Workspace.get(`slug = ${escape(slug)}`);

      response.status(200).json({ workspace });
    } catch (e) {
      console.log(e.message, e);
      response.sendStatus(500).end();
    }
  });

  app.get(
    ""/workspace/:slug/chats"",
    [validatedRequest],
    async (request, response) => {
      try {
        const { slug } = request.params;
        const user = await userFromSession(request, response);
        const workspace = multiUserMode(response)
          ? await Workspace.getWithUser(user, `slug = ${escape(slug)}`)
          : await Workspace.get(`slug = ${escape(slug)}`);

        if (!workspace) {
          response.sendStatus(400).end();
          return;
        }

        const history = multiUserMode(response)
          ? await WorkspaceChats.forWorkspaceByUser(workspace.id, user.id)
          : await WorkspaceChats.forWorkspace(workspace.id);

        response.status(200).json({ history: convertToChatHistory(history) });
      } catch (e) {
        console.log(e.message, e);
        response.sendStatus(500).end();
      }
    }
  );
}

module.exports = { workspaceEndpoints };",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR, VAR, VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR, VAR, } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""../VAR/VAR""); VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(); VAR VAR(VAR) { VAR (!VAR) VAR; VAR.VAR(""/VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR(VAR); VAR { VAR, VAR } = VAR VAR.VAR(VAR, VAR?.VAR); VAR VAR.VAR(""VAR"", { VAR: VAR(VAR), VAR: VAR.VAR.VAR || ""VAR"", VAR: VAR.VAR.VAR || ""VAR"", }); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR.VAR; VAR VAR = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR { VAR, VAR } = VAR VAR.VAR( VAR.VAR, VAR ); VAR.VAR(200).VAR({ VAR, VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/:VAR/VAR"", VAR.VAR(""VAR""), VAR VAR (VAR, VAR) { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(); VAR (!VAR) { VAR .VAR(500) .VAR({ VAR: VAR, VAR: `VAR VAR VAR VAR VAR VAR. VAR ${VAR} VAR VAR VAR VAR VAR.`, }) .VAR(); VAR; } VAR { VAR, VAR } = VAR VAR(VAR); VAR (!VAR) { VAR.VAR(500).VAR({ VAR: VAR, VAR: VAR }).VAR(); VAR; } VAR.VAR( `VAR ${VAR} VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR.` ); VAR VAR.VAR(""VAR""); VAR.VAR(200).VAR({ VAR: VAR, VAR: VAR }); } ); VAR.VAR( ""/VAR/:VAR/VAR-VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR { VAR = VAR } = VAR.VAR; VAR { VAR = [], VAR = [] } = VAR(VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR VAR.VAR(VAR, VAR); VAR VAR.VAR(VAR, VAR); VAR VAR = VAR VAR.VAR( `VAR = ${VAR.VAR}` ); VAR.VAR(200).VAR({ VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR( ""/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR = """" } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR (VAR(VAR) && VAR.VAR !== ""VAR"") { VAR VAR = (VAR VAR.VAR(`VAR = 'VAR'`)) ?.VAR === ""VAR""; VAR (!VAR) { VAR.VAR(500).VAR(); VAR; } } VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(VAR.VAR); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR VAR.VAR(`VAR = ${VAR(VAR.VAR)}`); VAR { VAR VAR[""VAR-VAR""]({ VAR: VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR); } VAR.VAR(200).VAR(); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); VAR.VAR(""/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR) : VAR VAR.VAR(); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR(""/VAR/:VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR.VAR(200).VAR({ VAR }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR.VAR( ""/VAR/:VAR/VAR"", [VAR], VAR (VAR, VAR) => { VAR { VAR { VAR } = VAR.VAR; VAR VAR = VAR VAR(VAR, VAR); VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR, `VAR = ${VAR(VAR)}`) : VAR VAR.VAR(`VAR = ${VAR(VAR)}`); VAR (!VAR) { VAR.VAR(400).VAR(); VAR; } VAR VAR = VAR(VAR) ? VAR VAR.VAR(VAR.VAR, VAR.VAR) : VAR VAR.VAR(VAR.VAR); VAR.VAR(200).VAR({ VAR: VAR(VAR) }); } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } } ); } VAR.VAR = { VAR }; ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/index.js,"process.env.NODE_ENV === ""development""
  ? require(""dotenv"").config({ path: `.env.${process.env.NODE_ENV}` })
  : require(""dotenv"").config();

const express = require(""express"");
const bodyParser = require(""body-parser"");
const serveIndex = require(""serve-index"");
const cors = require(""cors"");
const path = require(""path"");
const { reqBody } = require(""./utils/http"");
const { systemEndpoints } = require(""./endpoints/system"");
const { workspaceEndpoints } = require(""./endpoints/workspaces"");
const { chatEndpoints } = require(""./endpoints/chat"");
const { getVectorDbClass } = require(""./utils/helpers"");
const { validateTablePragmas, setupTelemetry } = require(""./utils/database"");
const { adminEndpoints } = require(""./endpoints/admin"");
const { inviteEndpoints } = require(""./endpoints/invite"");
const { utilEndpoints } = require(""./endpoints/utils"");
const { Telemetry } = require(""./models/telemetry"");
const { developerEndpoints } = require(""./endpoints/api"");
const app = express();
const apiRouter = express.Router();
const FILE_LIMIT = ""3GB"";

app.use(cors({ origin: true }));
app.use(bodyParser.text({ limit: FILE_LIMIT }));
app.use(bodyParser.json({ limit: FILE_LIMIT }));
app.use(
  bodyParser.urlencoded({
    limit: FILE_LIMIT,
    extended: true,
  })
);

app.use(""/api"", apiRouter);
systemEndpoints(apiRouter);
workspaceEndpoints(apiRouter);
chatEndpoints(apiRouter);
adminEndpoints(apiRouter);
inviteEndpoints(apiRouter);
utilEndpoints(apiRouter);
developerEndpoints(app, apiRouter);

apiRouter.post(""/v/:command"", async (request, response) => {
  try {
    const VectorDb = getVectorDbClass();
    const { command } = request.params;
    if (!Object.getOwnPropertyNames(VectorDb).includes(command)) {
      response.status(500).json({
        message: ""invalid interface command"",
        commands: Object.getOwnPropertyNames(VectorDb),
      });
      return;
    }

    try {
      const body = reqBody(request);
      const resBody = await VectorDb[command](body);
      response.status(200).json({ ...resBody });
    } catch (e) {
      // console.error(e)
      console.error(JSON.stringify(e));
      response.status(500).json({ error: e.message });
    }
    return;
  } catch (e) {
    console.log(e.message, e);
    response.sendStatus(500).end();
  }
});

if (process.env.NODE_ENV !== ""development"") {
  app.use(
    express.static(path.resolve(__dirname, ""public""), { extensions: [""js""] })
  );

  app.use(""/"", function (_, response) {
    response.sendFile(path.join(__dirname, ""public"", ""index.html""));
  });
}

app.use(
  ""/system/data-exports"",
  serveIndex(__dirname + ""/storage/exports"", { icons: true })
);

app.all(""*"", function (_, response) {
  response.sendStatus(404);
});

app
  .listen(process.env.SERVER_PORT || 3001, async () => {
    await validateTablePragmas();
    await setupTelemetry();
    console.log(
      `Example app listening on port ${process.env.SERVER_PORT || 3001}`
    );
  })
  .on(""error"", function (err) {
    process.once(""SIGUSR2"", function () {
      Telemetry.flush();
      process.kill(process.pid, ""SIGUSR2"");
    });
    process.on(""SIGINT"", function () {
      Telemetry.flush();
      process.kill(process.pid, ""SIGINT"");
    });
  });",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR.VAR === ""VAR"" ? VAR(""VAR"").VAR({ VAR: `.VAR.${VAR.VAR.VAR}` }) : VAR(""VAR"").VAR(); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR-VAR""); VAR VAR = VAR(""VAR-VAR""); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR, VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR VAR = VAR(); VAR VAR = VAR.VAR(); VAR VAR = ""3GB""; VAR.VAR(VAR({ VAR: VAR })); VAR.VAR(VAR.VAR({ VAR: VAR })); VAR.VAR(VAR.VAR({ VAR: VAR })); VAR.VAR( VAR.VAR({ VAR: VAR, VAR: VAR, }) ); VAR.VAR(""/VAR"", VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR, VAR); VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = VAR(); VAR { VAR } = VAR.VAR; VAR (!VAR.VAR(VAR).VAR(VAR)) { VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR"", VAR: VAR.VAR(VAR), }); VAR; } VAR { VAR VAR = VAR(VAR); VAR VAR = VAR VAR[VAR](VAR); VAR.VAR(200).VAR({ ...VAR }); } VAR (VAR) {  VAR.VAR(VAR.VAR(VAR)); VAR.VAR(500).VAR({ VAR: VAR.VAR }); } VAR; } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR (VAR.VAR.VAR !== ""VAR"") { VAR.VAR( VAR.VAR(VAR.VAR(VAR, ""VAR""), { VAR: [""VAR""] }) ); VAR.VAR(""/"", VAR (VAR, VAR) { VAR.VAR(VAR.VAR(VAR, ""VAR"", ""VAR.VAR"")); }); } VAR.VAR( ""/VAR/VAR-VAR"", VAR(VAR + ""/VAR/VAR"", { VAR: VAR }) ); VAR.VAR(""*"", VAR (VAR, VAR) { VAR.VAR(404); }); VAR .VAR(VAR.VAR.VAR || 3001, VAR () => { VAR VAR(); VAR VAR(); VAR.VAR( `VAR VAR VAR VAR VAR ${VAR.VAR.VAR || 3001}` ); }) .VAR(""VAR"", VAR (VAR) { VAR.VAR(""VAR"", VAR () { VAR.VAR(); VAR.VAR(VAR.VAR, ""VAR""); }); VAR.VAR(""VAR"", VAR () { VAR.VAR(); VAR.VAR(VAR.VAR, ""VAR""); }); }); ",0,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/index.js,"process.env.NODE_ENV === ""development""
  ? require(""dotenv"").config({ path: `.env.${process.env.NODE_ENV}` })
  : require(""dotenv"").config();

const express = require(""express"");
const bodyParser = require(""body-parser"");
const serveIndex = require(""serve-index"");
const cors = require(""cors"");
const path = require(""path"");
const { reqBody } = require(""./utils/http"");
const { systemEndpoints } = require(""./endpoints/system"");
const { workspaceEndpoints } = require(""./endpoints/workspaces"");
const { chatEndpoints } = require(""./endpoints/chat"");
const { getVectorDbClass } = require(""./utils/helpers"");
const { validateTablePragmas, setupTelemetry } = require(""./utils/database"");
const { adminEndpoints } = require(""./endpoints/admin"");
const { inviteEndpoints } = require(""./endpoints/invite"");
const { utilEndpoints } = require(""./endpoints/utils"");
const { Telemetry } = require(""./models/telemetry"");
const { developerEndpoints } = require(""./endpoints/api"");
const app = express();
const apiRouter = express.Router();
const FILE_LIMIT = ""3GB"";

app.use(cors({ origin: true }));
app.use(bodyParser.text({ limit: FILE_LIMIT }));
app.use(bodyParser.json({ limit: FILE_LIMIT }));
app.use(
  bodyParser.urlencoded({
    limit: FILE_LIMIT,
    extended: true,
  })
);

app.use(""/api"", apiRouter);
systemEndpoints(apiRouter);
workspaceEndpoints(apiRouter);
chatEndpoints(apiRouter);
adminEndpoints(apiRouter);
inviteEndpoints(apiRouter);
utilEndpoints(apiRouter);
developerEndpoints(app, apiRouter);

apiRouter.post(""/v/:command"", async (request, response) => {
  try {
    const VectorDb = getVectorDbClass();
    const { command } = request.params;
    if (!Object.getOwnPropertyNames(VectorDb).includes(command)) {
      response.status(500).json({
        message: ""invalid interface command"",
        commands: Object.getOwnPropertyNames(VectorDb),
      });
      return;
    }

    try {
      const body = reqBody(request);
      const resBody = await VectorDb[command](body);
      response.status(200).json({ ...resBody });
    } catch (e) {
      // console.error(e)
      console.error(JSON.stringify(e));
      response.status(500).json({ error: e.message });
    }
    return;
  } catch (e) {
    console.log(e.message, e);
    response.sendStatus(500).end();
  }
});

if (process.env.NODE_ENV !== ""development"") {
  app.use(
    express.static(path.resolve(__dirname, ""public""), { extensions: [""js""] })
  );

  app.use(""/"", function (_, response) {
    response.sendFile(path.join(__dirname, ""public"", ""index.html""));
  });
}

app.use(
  ""/system/data-exports"",
  serveIndex(__dirname + ""/storage/exports"", { icons: true })
);

app.all(""*"", function (_, response) {
  response.sendStatus(404);
});

app
  .listen(process.env.SERVER_PORT || 3001, async () => {
    await validateTablePragmas();
    await setupTelemetry();
    console.log(
      `Example app listening on port ${process.env.SERVER_PORT || 3001}`
    );
  })
  .on(""error"", function (err) {
    process.once(""SIGUSR2"", function () {
      Telemetry.flush();
      process.kill(process.pid, ""SIGUSR2"");
    });
    process.on(""SIGINT"", function () {
      Telemetry.flush();
      process.kill(process.pid, ""SIGINT"");
    });
  });",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR.VAR === ""VAR"" ? VAR(""VAR"").VAR({ VAR: `.VAR.${VAR.VAR.VAR}` }) : VAR(""VAR"").VAR(); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR-VAR""); VAR VAR = VAR(""VAR-VAR""); VAR VAR = VAR(""VAR""); VAR VAR = VAR(""VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR, VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR { VAR } = VAR(""./VAR/VAR""); VAR VAR = VAR(); VAR VAR = VAR.VAR(); VAR VAR = ""3GB""; VAR.VAR(VAR({ VAR: VAR })); VAR.VAR(VAR.VAR({ VAR: VAR })); VAR.VAR(VAR.VAR({ VAR: VAR })); VAR.VAR( VAR.VAR({ VAR: VAR, VAR: VAR, }) ); VAR.VAR(""/VAR"", VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR); VAR(VAR, VAR); VAR.VAR(""/VAR/:VAR"", VAR (VAR, VAR) => { VAR { VAR VAR = VAR(); VAR { VAR } = VAR.VAR; VAR (!VAR.VAR(VAR).VAR(VAR)) { VAR.VAR(500).VAR({ VAR: ""VAR VAR VAR"", VAR: VAR.VAR(VAR), }); VAR; } VAR { VAR VAR = VAR(VAR); VAR VAR = VAR VAR[VAR](VAR); VAR.VAR(200).VAR({ ...VAR }); } VAR (VAR) {  VAR.VAR(VAR.VAR(VAR)); VAR.VAR(500).VAR({ VAR: VAR.VAR }); } VAR; } VAR (VAR) { VAR.VAR(VAR.VAR, VAR); VAR.VAR(500).VAR(); } }); VAR (VAR.VAR.VAR !== ""VAR"") { VAR.VAR( VAR.VAR(VAR.VAR(VAR, ""VAR""), { VAR: [""VAR""] }) ); VAR.VAR(""/"", VAR (VAR, VAR) { VAR.VAR(VAR.VAR(VAR, ""VAR"", ""VAR.VAR"")); }); } VAR.VAR( ""/VAR/VAR-VAR"", VAR(VAR + ""/VAR/VAR"", { VAR: VAR }) ); VAR.VAR(""*"", VAR (VAR, VAR) { VAR.VAR(404); }); VAR .VAR(VAR.VAR.VAR || 3001, VAR () => { VAR VAR(); VAR VAR(); VAR.VAR( `VAR VAR VAR VAR VAR ${VAR.VAR.VAR || 3001}` ); }) .VAR(""VAR"", VAR (VAR) { VAR.VAR(""VAR"", VAR () { VAR.VAR(); VAR.VAR(VAR.VAR, ""VAR""); }); VAR.VAR(""VAR"", VAR () { VAR.VAR(); VAR.VAR(VAR.VAR, ""VAR""); }); }); ",0,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/swagger/openapi.json,"{
  ""openapi"": ""3.0.0"",
  ""info"": {
    ""version"": ""1.0.0"",
    ""title"": ""AnythingLLM Developer API"",
    ""description"": ""API endpoints that enable programmatic reading, writing, and updating of your AnythingLLM instance. UI supplied by Swagger.io.""
  },
  ""servers"": [
    {
      ""url"": ""http:///api/""
    }
  ],
  ""paths"": {
    ""/v1/auth"": {
      ""get"": {
        ""tags"": [
          ""Authentication""
        ],
        ""description"": ""Verify the attached Authentication header contains a valid API token."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""Valid auth token was found."",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""authenticated"": true
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          }
        }
      }
    },
    ""/v1/admin/is-multi-user-mode"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""isMultiUser"": true
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          }
        }
      }
    },
    ""/v1/admin/users"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""users"": [
                      {
                        ""username"": ""sample-sam"",
                        ""role"": ""default""
                      }
                    ]
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/users/new"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Create a new user with username and password. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""user"": {
                      ""id"": 1,
                      ""username"": ""sample-sam"",
                      ""role"": ""default""
                    },
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that will define the new user to add to the system."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""username"": ""sample-sam"",
                ""password"": ""hunter2"",
                ""role"": ""default | admin""
              }
            }
          }
        }
      }
    },
    ""/v1/admin/users/{id}"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Update existing user settings. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the user in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that will update the found user. All fields are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""username"": ""sample-sam"",
                ""password"": ""hunter2"",
                ""role"": ""default | admin"",
                ""suspended"": 0
              }
            }
          }
        }
      },
      ""delete"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Delete existing user by id. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the user in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invites"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""List all existing invitations to instance regardless of status. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""invites"": [
                      {
                        ""id"": 1,
                        ""status"": ""pending"",
                        ""code"": ""abc-123"",
                        ""claimedBy"": null
                      }
                    ]
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invite/new"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Create a new invite code for someone to use to register with instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""invite"": {
                      ""id"": 1,
                      ""status"": ""pending"",
                      ""code"": ""abc-123""
                    },
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invite/{id}"": {
      ""delete"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Deactivates (soft-delete) invite by id. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the invite in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/workspaces/{workspaceId}/update-users"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Overwrite workspace permissions to only be accessible by the given user ids and admins. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""workspaceId"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the workspace in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Entire array of user ids who can access the workspace. All fields are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""userIds"": [
                  1,
                  2,
                  4,
                  12
                ]
              }
            }
          }
        }
      }
    },
    ""/v1/admin/workspace-chats"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""All chats in the system ordered by most recent. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Page offset to show of workspace chats. All fields are optional and will not update unless specified."",
          ""required"": false,
          ""type"": ""integer"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""offset"": 2
              }
            }
          }
        }
      }
    },
    ""/v1/admin/preferences"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Show all multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""settings"": {
                      ""users_can_delete_workspaces"": true,
                      ""limit_user_messages"": false,
                      ""message_limit"": 10
                    }
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      },
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Update multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Object with setting key and new value to set. All keys are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""users_can_delete_workspaces"": false,
                ""limit_user_messages"": true,
                ""message_limit"": 5
              }
            }
          }
        }
      }
    },
    ""/v1/document/upload"": {
      ""post"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""Upload a new file to AnythingLLM to be parsed and prepared for embedding."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""File to be uploaded."",
          ""required"": true,
          ""type"": ""file"",
          ""content"": {
            ""multipart/form-data"": {
              ""schema"": {
                ""type"": ""object"",
                ""properties"": {
                  ""file"": {
                    ""type"": ""string"",
                    ""format"": ""binary""
                  }
                }
              }
            }
          }
        }
      }
    },
    ""/v1/documents"": {
      ""get"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""List of all locally-stored documents in instance"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""localFiles"": {
                      ""name"": ""documents"",
                      ""type"": ""folder"",
                      ""items"": [
                        {
                          ""name"": ""my-stored-document.json"",
                          ""type"": ""file"",
                          ""id"": ""bb07c334-4dab-4419-9462-9d00065a49a1"",
                          ""url"": ""file://my-stored-document.txt"",
                          ""title"": ""my-stored-document.txt"",
                          ""cached"": false
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/document/accepted-file-types"": {
      ""get"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""Check available filetypes and MIMEs that can be uploaded."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""types"": {
                      ""application/mbox"": [
                        "".mbox""
                      ],
                      ""application/pdf"": [
                        "".pdf""
                      ],
                      ""application/vnd.oasis.opendocument.text"": [
                        "".odt""
                      ],
                      ""application/vnd.openxmlformats-officedocument.wordprocessingml.document"": [
                        "".docx""
                      ],
                      ""text/plain"": [
                        "".txt"",
                        "".md""
                      ]
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""404"": {
            ""description"": ""Not Found""
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/new"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Create a new workspace"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""Sample workspace"",
                      ""slug"": ""sample-workspace"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null
                    },
                    ""message"": ""Workspace created""
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object containing new display name of workspace."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""name"": ""My New Workspace""
              }
            }
          }
        }
      }
    },
    ""/v1/workspaces"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""List all current workspaces"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspaces"": [
                      {
                        ""id"": 79,
                        ""name"": ""Sample workspace"",
                        ""slug"": ""sample-workspace"",
                        ""createdAt"": ""2023-08-17 00:45:03"",
                        ""openAiTemp"": null,
                        ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                        ""openAiHistory"": 20,
                        ""openAiPrompt"": null
                      }
                    ]
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Get a workspace by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      },
      ""delete"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Deletes a workspace by its slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to delete""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK""
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}/update"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Update workspace settings by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    },
                    ""message"": null
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object containing new settings to update a workspace. All keys are optional and will not update unless provided"",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""name"": ""Updated Workspace Name"",
                ""openAiTemp"": 0.2,
                ""openAiHistory"": 20,
                ""openAiPrompt"": ""Respond to all inquires and questions in binary - do not respond in any other format.""
              }
            }
          }
        }
      }
    },
    ""/v1/workspace/{slug}/chats"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Get a workspaces chats regardless of user by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""history"": [
                      {
                        ""role"": ""user"",
                        ""content"": ""What is AnythingLLM?"",
                        ""sentAt"": 1692851630
                      },
                      {
                        ""role"": ""assistant"",
                        ""content"": ""AnythingLLM is a platform that allows you to convert notes, PDFs, and other source materials into a chatbot. It ensures privacy, cites its answers, and allows multiple people to interact with the same documents simultaneously. It is particularly useful for businesses to enhance the visibility and readability of various written communications such as SOPs, contracts, and sales calls. You can try it out with a free trial to see if it meets your business needs."",
                        ""sources"": [
                          {
                            ""source"": ""object about source document and snippets used""
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}/update-embeddings"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Add or remove documents from a workspace by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    },
                    ""message"": null
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object of additions and removals of documents to add to update a workspace. The value should be the folder + filename with the exclusions of the top-level documents path."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""adds"": [],
                ""deletes"": [
                  ""custom-documents/anythingllm-hash.json""
                ]
              }
            }
          }
        }
      }
    },
    ""/v1/system/env-dump"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Dump all settings to file storage"",
        ""responses"": {
          ""200"": {
            ""description"": ""OK""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Get all current system settings that are defined."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""settings"": {
                      ""VectorDB"": ""pinecone"",
                      ""PineConeEnvironment"": ""us-west4-gcp-free"",
                      ""PineConeKey"": true,
                      ""PineConeIndex"": ""my-pinecone-index"",
                      ""LLMProvider"": ""azure"",
                      ""[KEY_NAME]"": ""KEY_VALUE""
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system/vector-count"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Number of all vectors in connected vector database"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""vectorCount"": 5450
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system/update-env"": {
      ""post"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Update a system setting or preference."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""newValues"": {
                      ""[ENV_KEY]"": ""Value""
                    },
                    ""error"": ""error goes here, otherwise null""
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that matches a valid setting and value. Get keys from GET /v1/system or refer to codebase."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""VectorDB"": ""lancedb"",
                ""AnotherKey"": ""updatedValue""
              }
            }
          }
        }
      }
    }
  },
  ""components"": {
    ""schemas"": {
      ""InvalidAPIKey"": {
        ""type"": ""object"",
        ""properties"": {
          ""message"": {
            ""type"": ""string"",
            ""example"": ""Invalid API Key""
          }
        },
        ""xml"": {
          ""name"": ""InvalidAPIKey""
        }
      }
    },
    ""securitySchemes"": {
      ""BearerAuth"": {
        ""type"": ""http"",
        ""scheme"": ""bearer"",
        ""bearerFormat"": ""JWT""
      }
    }
  },
  ""security"": [
    {
      ""BearerAuth"": []
    }
  ]
}",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"{ ""VAR"": ""3.0.0"", ""VAR"": { ""VAR"": ""1.0.0"", ""VAR"": ""VAR VAR VAR"", ""VAR"": ""VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR.VAR."" }, ""VAR"": [ { ""VAR"": ""VAR: } ], ""VAR"": { ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR VAR VAR VAR VAR."", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } } } } }, ""/VAR/VAR/VAR-VAR-VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"" } ] } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 1, ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"" }, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR | VAR"" } } } } } }, ""/VAR/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR | VAR"", ""VAR"": 0 } } } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": 1, ""VAR"": ""VAR"", ""VAR"": ""VAR-123"", ""VAR"": VAR } ] } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 1, ""VAR"": ""VAR"", ""VAR"": ""VAR-123"" }, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR (VAR-VAR) VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/{VAR}/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": [ 1, 2, 4, 12 ] } } } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": 2 } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR-VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": VAR, ""VAR"": VAR, ""VAR"": 10 } } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR-VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": VAR, ""VAR"": VAR, ""VAR"": 5 } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR-VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } } } } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR-VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": [ { ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR-4dab-4419-9462-9d00065a49a1"", ""VAR"": ""VAR: ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": VAR } ] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR.VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR.VAR-VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"", "".VAR"" ] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""404"": { ""VAR"": ""VAR VAR"" }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR }, ""VAR"": ""VAR VAR"" } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR VAR VAR"" } } } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR } ] } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"" }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] }, ""VAR"": VAR } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR VAR VAR"", ""VAR"": 0.2, ""VAR"": 20, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR - VAR VAR VAR VAR VAR VAR VAR."" } } } } } }, ""/VAR/VAR/{VAR}/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR?"", ""VAR"": 1692851630 }, { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR, VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR"" } ] } ] } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] }, ""VAR"": VAR } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR + VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": [], ""VAR"": [ ""VAR-VAR/VAR-VAR.VAR"" ] } } } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR"", ""VAR"": { ""200"": { ""VAR"": ""VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR-VAR-VAR-VAR"", ""VAR"": VAR, ""VAR"": ""VAR-VAR-VAR"", ""VAR"": ""VAR"", ""[VAR]"": ""VAR"" } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": 5450 } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""[VAR]"": ""VAR"" }, ""VAR"": ""VAR VAR VAR, VAR VAR"" } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR /VAR/VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } } } } } }, ""VAR"": { ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR"" } } }, ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } }, ""VAR"": [ { ""VAR"": [] } ] } ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/swagger/openapi.json,"{
  ""openapi"": ""3.0.0"",
  ""info"": {
    ""version"": ""1.0.0"",
    ""title"": ""AnythingLLM Developer API"",
    ""description"": ""API endpoints that enable programmatic reading, writing, and updating of your AnythingLLM instance. UI supplied by Swagger.io.""
  },
  ""servers"": [
    {
      ""url"": ""http:///api/""
    }
  ],
  ""paths"": {
    ""/v1/auth"": {
      ""get"": {
        ""tags"": [
          ""Authentication""
        ],
        ""description"": ""Verify the attached Authentication header contains a valid API token."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""Valid auth token was found."",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""authenticated"": true
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          }
        }
      }
    },
    ""/v1/admin/is-multi-user-mode"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""isMultiUser"": true
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          }
        }
      }
    },
    ""/v1/admin/users"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Check to see if the instance is in multi-user-mode first. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""users"": [
                      {
                        ""username"": ""sample-sam"",
                        ""role"": ""default""
                      }
                    ]
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/users/new"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Create a new user with username and password. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""user"": {
                      ""id"": 1,
                      ""username"": ""sample-sam"",
                      ""role"": ""default""
                    },
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that will define the new user to add to the system."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""username"": ""sample-sam"",
                ""password"": ""hunter2"",
                ""role"": ""default | admin""
              }
            }
          }
        }
      }
    },
    ""/v1/admin/users/{id}"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Update existing user settings. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the user in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that will update the found user. All fields are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""username"": ""sample-sam"",
                ""password"": ""hunter2"",
                ""role"": ""default | admin"",
                ""suspended"": 0
              }
            }
          }
        }
      },
      ""delete"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Delete existing user by id. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the user in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invites"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""List all existing invitations to instance regardless of status. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""invites"": [
                      {
                        ""id"": 1,
                        ""status"": ""pending"",
                        ""code"": ""abc-123"",
                        ""claimedBy"": null
                      }
                    ]
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invite/new"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Create a new invite code for someone to use to register with instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""invite"": {
                      ""id"": 1,
                      ""status"": ""pending"",
                      ""code"": ""abc-123""
                    },
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/invite/{id}"": {
      ""delete"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Deactivates (soft-delete) invite by id. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""id"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the invite in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/admin/workspaces/{workspaceId}/update-users"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Overwrite workspace permissions to only be accessible by the given user ids and admins. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""workspaceId"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""id of the workspace in the database.""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Entire array of user ids who can access the workspace. All fields are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""userIds"": [
                  1,
                  2,
                  4,
                  12
                ]
              }
            }
          }
        }
      }
    },
    ""/v1/admin/workspace-chats"": {
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""All chats in the system ordered by most recent. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Page offset to show of workspace chats. All fields are optional and will not update unless specified."",
          ""required"": false,
          ""type"": ""integer"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""offset"": 2
              }
            }
          }
        }
      }
    },
    ""/v1/admin/preferences"": {
      ""get"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Show all multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""settings"": {
                      ""users_can_delete_workspaces"": true,
                      ""limit_user_messages"": false,
                      ""message_limit"": 10
                    }
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      },
      ""post"": {
        ""tags"": [
          ""Admin""
        ],
        ""description"": ""Update multi-user preferences for instance. Methods are disabled until multi user mode is enabled via the UI."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""401"": {
            ""description"": ""Instance is not in Multi-User mode. Method denied""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Object with setting key and new value to set. All keys are optional and will not update unless specified."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""users_can_delete_workspaces"": false,
                ""limit_user_messages"": true,
                ""message_limit"": 5
              }
            }
          }
        }
      }
    },
    ""/v1/document/upload"": {
      ""post"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""Upload a new file to AnythingLLM to be parsed and prepared for embedding."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""success"": true,
                    ""error"": null
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""File to be uploaded."",
          ""required"": true,
          ""type"": ""file"",
          ""content"": {
            ""multipart/form-data"": {
              ""schema"": {
                ""type"": ""object"",
                ""properties"": {
                  ""file"": {
                    ""type"": ""string"",
                    ""format"": ""binary""
                  }
                }
              }
            }
          }
        }
      }
    },
    ""/v1/documents"": {
      ""get"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""List of all locally-stored documents in instance"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""localFiles"": {
                      ""name"": ""documents"",
                      ""type"": ""folder"",
                      ""items"": [
                        {
                          ""name"": ""my-stored-document.json"",
                          ""type"": ""file"",
                          ""id"": ""bb07c334-4dab-4419-9462-9d00065a49a1"",
                          ""url"": ""file://my-stored-document.txt"",
                          ""title"": ""my-stored-document.txt"",
                          ""cached"": false
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/document/accepted-file-types"": {
      ""get"": {
        ""tags"": [
          ""Documents""
        ],
        ""description"": ""Check available filetypes and MIMEs that can be uploaded."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""types"": {
                      ""application/mbox"": [
                        "".mbox""
                      ],
                      ""application/pdf"": [
                        "".pdf""
                      ],
                      ""application/vnd.oasis.opendocument.text"": [
                        "".odt""
                      ],
                      ""application/vnd.openxmlformats-officedocument.wordprocessingml.document"": [
                        "".docx""
                      ],
                      ""text/plain"": [
                        "".txt"",
                        "".md""
                      ]
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""404"": {
            ""description"": ""Not Found""
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/new"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Create a new workspace"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""Sample workspace"",
                      ""slug"": ""sample-workspace"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null
                    },
                    ""message"": ""Workspace created""
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object containing new display name of workspace."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""name"": ""My New Workspace""
              }
            }
          }
        }
      }
    },
    ""/v1/workspaces"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""List all current workspaces"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspaces"": [
                      {
                        ""id"": 79,
                        ""name"": ""Sample workspace"",
                        ""slug"": ""sample-workspace"",
                        ""createdAt"": ""2023-08-17 00:45:03"",
                        ""openAiTemp"": null,
                        ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                        ""openAiHistory"": 20,
                        ""openAiPrompt"": null
                      }
                    ]
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Get a workspace by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      },
      ""delete"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Deletes a workspace by its slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to delete""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK""
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}/update"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Update workspace settings by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    },
                    ""message"": null
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object containing new settings to update a workspace. All keys are optional and will not update unless provided"",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""name"": ""Updated Workspace Name"",
                ""openAiTemp"": 0.2,
                ""openAiHistory"": 20,
                ""openAiPrompt"": ""Respond to all inquires and questions in binary - do not respond in any other format.""
              }
            }
          }
        }
      }
    },
    ""/v1/workspace/{slug}/chats"": {
      ""get"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Get a workspaces chats regardless of user by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""history"": [
                      {
                        ""role"": ""user"",
                        ""content"": ""What is AnythingLLM?"",
                        ""sentAt"": 1692851630
                      },
                      {
                        ""role"": ""assistant"",
                        ""content"": ""AnythingLLM is a platform that allows you to convert notes, PDFs, and other source materials into a chatbot. It ensures privacy, cites its answers, and allows multiple people to interact with the same documents simultaneously. It is particularly useful for businesses to enhance the visibility and readability of various written communications such as SOPs, contracts, and sales calls. You can try it out with a free trial to see if it meets your business needs."",
                        ""sources"": [
                          {
                            ""source"": ""object about source document and snippets used""
                          }
                        ]
                      }
                    ]
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/workspace/{slug}/update-embeddings"": {
      ""post"": {
        ""tags"": [
          ""Workspaces""
        ],
        ""description"": ""Add or remove documents from a workspace by its unique slug."",
        ""parameters"": [
          {
            ""name"": ""slug"",
            ""in"": ""path"",
            ""required"": true,
            ""schema"": {
              ""type"": ""string""
            },
            ""description"": ""Unique slug of workspace to find""
          },
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""workspace"": {
                      ""id"": 79,
                      ""name"": ""My workspace"",
                      ""slug"": ""my-workspace-123"",
                      ""createdAt"": ""2023-08-17 00:45:03"",
                      ""openAiTemp"": null,
                      ""lastUpdatedAt"": ""2023-08-17 00:45:03"",
                      ""openAiHistory"": 20,
                      ""openAiPrompt"": null,
                      ""documents"": []
                    },
                    ""message"": null
                  }
                }
              }
            }
          },
          ""400"": {
            ""description"": ""Bad Request""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""JSON object of additions and removals of documents to add to update a workspace. The value should be the folder + filename with the exclusions of the top-level documents path."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""adds"": [],
                ""deletes"": [
                  ""custom-documents/anythingllm-hash.json""
                ]
              }
            }
          }
        }
      }
    },
    ""/v1/system/env-dump"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Dump all settings to file storage"",
        ""responses"": {
          ""200"": {
            ""description"": ""OK""
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Get all current system settings that are defined."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""settings"": {
                      ""VectorDB"": ""pinecone"",
                      ""PineConeEnvironment"": ""us-west4-gcp-free"",
                      ""PineConeKey"": true,
                      ""PineConeIndex"": ""my-pinecone-index"",
                      ""LLMProvider"": ""azure"",
                      ""[KEY_NAME]"": ""KEY_VALUE""
                    }
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system/vector-count"": {
      ""get"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Number of all vectors in connected vector database"",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""vectorCount"": 5450
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        }
      }
    },
    ""/v1/system/update-env"": {
      ""post"": {
        ""tags"": [
          ""System Settings""
        ],
        ""description"": ""Update a system setting or preference."",
        ""parameters"": [
          {
            ""name"": ""Authorization"",
            ""in"": ""header"",
            ""schema"": {
              ""type"": ""string""
            }
          }
        ],
        ""responses"": {
          ""200"": {
            ""description"": ""OK"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""type"": ""object"",
                  ""example"": {
                    ""newValues"": {
                      ""[ENV_KEY]"": ""Value""
                    },
                    ""error"": ""error goes here, otherwise null""
                  }
                }
              }
            }
          },
          ""403"": {
            ""description"": ""Forbidden"",
            ""content"": {
              ""application/json"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              },
              ""application/xml"": {
                ""schema"": {
                  ""$ref"": ""#/components/schemas/InvalidAPIKey""
                }
              }
            }
          },
          ""500"": {
            ""description"": ""Internal Server Error""
          }
        },
        ""requestBody"": {
          ""description"": ""Key pair object that matches a valid setting and value. Get keys from GET /v1/system or refer to codebase."",
          ""required"": true,
          ""type"": ""object"",
          ""content"": {
            ""application/json"": {
              ""example"": {
                ""VectorDB"": ""lancedb"",
                ""AnotherKey"": ""updatedValue""
              }
            }
          }
        }
      }
    }
  },
  ""components"": {
    ""schemas"": {
      ""InvalidAPIKey"": {
        ""type"": ""object"",
        ""properties"": {
          ""message"": {
            ""type"": ""string"",
            ""example"": ""Invalid API Key""
          }
        },
        ""xml"": {
          ""name"": ""InvalidAPIKey""
        }
      }
    },
    ""securitySchemes"": {
      ""BearerAuth"": {
        ""type"": ""http"",
        ""scheme"": ""bearer"",
        ""bearerFormat"": ""JWT""
      }
    }
  },
  ""security"": [
    {
      ""BearerAuth"": []
    }
  ]
}",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"{ ""VAR"": ""3.0.0"", ""VAR"": { ""VAR"": ""1.0.0"", ""VAR"": ""VAR VAR VAR"", ""VAR"": ""VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR.VAR."" }, ""VAR"": [ { ""VAR"": ""VAR: } ], ""VAR"": { ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR VAR VAR VAR VAR."", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } } } } }, ""/VAR/VAR/VAR-VAR-VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR-VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"" } ] } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 1, ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"" }, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR | VAR"" } } } } } }, ""/VAR/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR-VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR | VAR"", ""VAR"": 0 } } } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": 1, ""VAR"": ""VAR"", ""VAR"": ""VAR-123"", ""VAR"": VAR } ] } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 1, ""VAR"": ""VAR"", ""VAR"": ""VAR-123"" }, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR (VAR-VAR) VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR/{VAR}/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": [ 1, 2, 4, 12 ] } } } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": 2 } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR-VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": VAR, ""VAR"": VAR, ""VAR"": 10 } } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR-VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""401"": { ""VAR"": ""VAR VAR VAR VAR VAR-VAR VAR. VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": VAR, ""VAR"": VAR, ""VAR"": 5 } } } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": VAR, ""VAR"": VAR } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR-VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } } } } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR-VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": [ { ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR-4dab-4419-9462-9d00065a49a1"", ""VAR"": ""VAR: ""VAR"": ""VAR-VAR-VAR.VAR"", ""VAR"": VAR } ] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"" ], ""VAR/VAR.VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR.VAR-VAR.VAR.VAR"": [ "".VAR"" ], ""VAR/VAR"": [ "".VAR"", "".VAR"" ] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""404"": { ""VAR"": ""VAR VAR"" }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR }, ""VAR"": ""VAR VAR"" } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR VAR VAR"" } } } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR } ] } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } }, ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"" }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] }, ""VAR"": VAR } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR VAR VAR"", ""VAR"": 0.2, ""VAR"": 20, ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR - VAR VAR VAR VAR VAR VAR VAR."" } } } } } }, ""/VAR/VAR/{VAR}/VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR?"", ""VAR"": 1692851630 }, { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR, VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR, VAR, VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR"" } ] } ] } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/{VAR}/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": VAR, ""VAR"": { ""VAR"": ""VAR"" }, ""VAR"": ""VAR VAR VAR VAR VAR VAR"" }, { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": 79, ""VAR"": ""VAR VAR"", ""VAR"": ""VAR-VAR-123"", ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": VAR, ""VAR"": ""2023-08-17 00:45:03"", ""VAR"": 20, ""VAR"": VAR, ""VAR"": [] }, ""VAR"": VAR } } } } }, ""400"": { ""VAR"": ""VAR VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR + VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": [], ""VAR"": [ ""VAR-VAR/VAR-VAR.VAR"" ] } } } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR"", ""VAR"": { ""200"": { ""VAR"": ""VAR"" }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR-VAR-VAR-VAR"", ""VAR"": VAR, ""VAR"": ""VAR-VAR-VAR"", ""VAR"": ""VAR"", ""[VAR]"": ""VAR"" } } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR"", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": 5450 } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } } } }, ""/VAR/VAR/VAR-VAR"": { ""VAR"": { ""VAR"": [ ""VAR VAR"" ], ""VAR"": ""VAR VAR VAR VAR VAR VAR."", ""VAR"": [ { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": { ""VAR"": ""VAR"" } } ], ""VAR"": { ""200"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""[VAR]"": ""VAR"" }, ""VAR"": ""VAR VAR VAR, VAR VAR"" } } } } }, ""403"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } }, ""VAR/VAR"": { ""VAR"": { ""$VAR"": "" } } } }, ""500"": { ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR /VAR/VAR VAR VAR VAR VAR."", ""VAR"": VAR, ""VAR"": ""VAR"", ""VAR"": { ""VAR/VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } } } } } }, ""VAR"": { ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR VAR VAR"" } }, ""VAR"": { ""VAR"": ""VAR"" } } }, ""VAR"": { ""VAR"": { ""VAR"": ""VAR"", ""VAR"": ""VAR"", ""VAR"": ""VAR"" } } }, ""VAR"": [ { ""VAR"": [] } ] } ",8,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/utils/middleware/validApiKey.js,"const { escape } = require(""sqlstring-sqlite"");
const { ApiKey } = require(""../../models/apiKeys"");
const { SystemSettings } = require(""../../models/systemSettings"");

async function validApiKey(request, response, next) {
  const multiUserMode = await SystemSettings.isMultiUserMode();
  response.locals.multiUserMode = multiUserMode;

  const auth = request.header(""Authorization"");
  const bearerKey = auth ? auth.split("" "")[1] : null;
  if (!bearerKey) {
    response.status(403).json({
      error: ""No valid api key found."",
    });
    return;
  }

  if (!(await ApiKey.get(`secret = ${escape(bearerKey)}`))) {
    response.status(403).json({
      error: ""No valid api key found."",
    });
    return;
  }

  next();
}

module.exports = {
  validApiKey,
};",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR VAR.VAR(); VAR.VAR.VAR = VAR; VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR."", }); VAR; } VAR (!(VAR VAR.VAR(`VAR = ${VAR(VAR)}`))) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR."", }); VAR; } VAR(); } VAR.VAR = { VAR, }; ",0,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/utils/middleware/validApiKey.js,"const { escape } = require(""sqlstring-sqlite"");
const { ApiKey } = require(""../../models/apiKeys"");
const { SystemSettings } = require(""../../models/systemSettings"");

async function validApiKey(request, response, next) {
  const multiUserMode = await SystemSettings.isMultiUserMode();
  response.locals.multiUserMode = multiUserMode;

  const auth = request.header(""Authorization"");
  const bearerKey = auth ? auth.split("" "")[1] : null;
  if (!bearerKey) {
    response.status(403).json({
      error: ""No valid api key found."",
    });
    return;
  }

  if (!(await ApiKey.get(`secret = ${escape(bearerKey)}`))) {
    response.status(403).json({
      error: ""No valid api key found."",
    });
    return;
  }

  next();
}

module.exports = {
  validApiKey,
};",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""VAR-VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR VAR.VAR(); VAR.VAR.VAR = VAR; VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR."", }); VAR; } VAR (!(VAR VAR.VAR(`VAR = ${VAR(VAR)}`))) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR."", }); VAR; } VAR(); } VAR.VAR = { VAR, }; ",0,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/utils/middleware/validatedRequest.js,"const { SystemSettings } = require(""../../models/systemSettings"");
const { User } = require(""../../models/user"");
const { decodeJWT } = require(""../http"");

async function validatedRequest(request, response, next) {
  const multiUserMode = await SystemSettings.isMultiUserMode();
  response.locals.multiUserMode = multiUserMode;
  if (multiUserMode)
    return await validateMultiUserRequest(request, response, next);

  // When in development passthrough auth token for ease of development.
  // Or if the user simply did not set an Auth token or JWT Secret
  if (
    process.env.NODE_ENV === ""development"" ||
    !process.env.AUTH_TOKEN ||
    !process.env.JWT_SECRET
  ) {
    next();
    return;
  }

  if (!process.env.AUTH_TOKEN) {
    response.status(403).json({
      error: ""You need to set an AUTH_TOKEN environment variable."",
    });
    return;
  }

  const auth = request.header(""Authorization"");
  const token = auth ? auth.split("" "")[1] : null;

  if (!token) {
    response.status(403).json({
      error: ""No auth token found."",
    });
    return;
  }

  const { p } = decodeJWT(token);
  if (p !== process.env.AUTH_TOKEN) {
    response.status(403).json({
      error: ""Invalid auth token found."",
    });
    return;
  }

  next();
}

async function validateMultiUserRequest(request, response, next) {
  const auth = request.header(""Authorization"");
  const token = auth ? auth.split("" "")[1] : null;

  if (!token) {
    response.status(403).json({
      error: ""No auth token found."",
    });
    return;
  }

  const valid = decodeJWT(token);
  if (!valid || !valid.id) {
    response.status(403).json({
      error: ""Invalid auth token."",
    });
    return;
  }

  const user = await User.get(`id = ${valid.id}`);
  if (!user) {
    response.status(403).json({
      error: ""Invalid auth for user."",
    });
    return;
  }

  response.locals.user = user;
  next();
}

module.exports = {
  validatedRequest,
};",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4899,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../VAR""); VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR VAR.VAR(); VAR.VAR.VAR = VAR; VAR (VAR) VAR VAR VAR(VAR, VAR, VAR);   VAR ( VAR.VAR.VAR === ""VAR"" || !VAR.VAR.VAR || !VAR.VAR.VAR ) { VAR(); VAR; } VAR (!VAR.VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR { VAR } = VAR(VAR); VAR (VAR !== VAR.VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR(); } VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR(VAR); VAR (!VAR || !VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR."", }); VAR; } VAR VAR = VAR VAR.VAR(`VAR = ${VAR.VAR}`); VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR.VAR.VAR = VAR; VAR(); } VAR.VAR = { VAR, }; ",0,1
anything-llm_dc3dfbf31495fe316b21ee184b9317b38101d30e,server/utils/middleware/validatedRequest.js,"const { SystemSettings } = require(""../../models/systemSettings"");
const { User } = require(""../../models/user"");
const { decodeJWT } = require(""../http"");

async function validatedRequest(request, response, next) {
  const multiUserMode = await SystemSettings.isMultiUserMode();
  response.locals.multiUserMode = multiUserMode;
  if (multiUserMode)
    return await validateMultiUserRequest(request, response, next);

  // When in development passthrough auth token for ease of development.
  // Or if the user simply did not set an Auth token or JWT Secret
  if (
    process.env.NODE_ENV === ""development"" ||
    !process.env.AUTH_TOKEN ||
    !process.env.JWT_SECRET
  ) {
    next();
    return;
  }

  if (!process.env.AUTH_TOKEN) {
    response.status(403).json({
      error: ""You need to set an AUTH_TOKEN environment variable."",
    });
    return;
  }

  const auth = request.header(""Authorization"");
  const token = auth ? auth.split("" "")[1] : null;

  if (!token) {
    response.status(403).json({
      error: ""No auth token found."",
    });
    return;
  }

  const { p } = decodeJWT(token);
  if (p !== process.env.AUTH_TOKEN) {
    response.status(403).json({
      error: ""Invalid auth token found."",
    });
    return;
  }

  next();
}

async function validateMultiUserRequest(request, response, next) {
  const auth = request.header(""Authorization"");
  const token = auth ? auth.split("" "")[1] : null;

  if (!token) {
    response.status(403).json({
      error: ""No auth token found."",
    });
    return;
  }

  const valid = decodeJWT(token);
  if (!valid || !valid.id) {
    response.status(403).json({
      error: ""Invalid auth token."",
    });
    return;
  }

  const user = await User.get(`id = ${valid.id}`);
  if (!user) {
    response.status(403).json({
      error: ""Invalid auth for user."",
    });
    return;
  }

  response.locals.user = user;
  next();
}

module.exports = {
  validatedRequest,
};",,dc3dfbf31495fe316b21ee184b9317b38101d30e,CVE-2023-4898,dc3dfbf31495fe316b21ee184b9317b38101d30e,https://github.com/mintplex-labs/anything-llm,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../../VAR/VAR""); VAR { VAR } = VAR(""../VAR""); VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR VAR.VAR(); VAR.VAR.VAR = VAR; VAR (VAR) VAR VAR VAR(VAR, VAR, VAR);   VAR ( VAR.VAR.VAR === ""VAR"" || !VAR.VAR.VAR || !VAR.VAR.VAR ) { VAR(); VAR; } VAR (!VAR.VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR { VAR } = VAR(VAR); VAR (VAR !== VAR.VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR(); } VAR VAR VAR(VAR, VAR, VAR) { VAR VAR = VAR.VAR(""VAR""); VAR VAR = VAR ? VAR.VAR("" "")[1] : VAR; VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR VAR = VAR(VAR); VAR (!VAR || !VAR.VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR."", }); VAR; } VAR VAR = VAR VAR.VAR(`VAR = ${VAR.VAR}`); VAR (!VAR) { VAR.VAR(403).VAR({ VAR: ""VAR VAR VAR VAR."", }); VAR; } VAR.VAR.VAR = VAR; VAR(); } VAR.VAR = { VAR, }; ",0,1
cpython_37fe316479e0b6906a74b0c0a5e495c55037fdfd,Litest/test_urllib2.py,"    def check_basic_auth(self, headers, realm):
        with self.subTest(realm=realm, headers=headers):
            opener = OpenerDirector()
            password_manager = MockPasswordManager()
            auth_handler = urllib.request.HTTPBasicAuthHandler(password_manager)
            body = '\r\n'.join(headers) + '\r\n\r\n'
            http_handler = MockHTTPHandler(401, body)
            opener.add_handler(auth_handler)
            opener.add_handler(http_handler)
                                  realm, http_handler, password_manager,
                                  ""http://acme.example.com/protected"",
                                  ""http://acme.example.com/protected"")

    def test_basic_auth(self):
        realm = ""realm2@example.com""
        realm2 = ""realm2@example.com""
        basic = 'Basic realm=""{}""'.format(realm)
        basic2 = 'Basic realm=""{}""'.format(realm2)
        other_no_realm = 'Otherscheme xxx'
        digest = ('Digest realm=""{}"", '
                  'qop=""auth, auth-int"", '
                  'nonce=""dcd98b7102dd2f0e8b11d0f600bfb0c093"", '
                  'opaque=""5ccc069c403ebaf9f0171e9517f40e41""').format(realm2)
        for realm_str in (
            # test ""quote"" and 'quote'
            'Basic realm=""{}""'.format(realm),
            ""Basic realm='{}'"".format(realm),

            # charset is ignored
            'Basic realm=""{}"", charset=""UTF-8""'.format(realm),

            # Multiple challenges per header
            '{}, {}'.format(basic, basic2),
            '{}, {}'.format(basic, other_no_realm),
            '{}, {}'.format(other_no_realm, basic),
            '{}, {}'.format(basic, digest),
            '{}, {}'.format(digest, basic),
        ):
            headers = ['WWW-Authenticate: {}'.format(realm_str)]
            self.check_basic_auth(headers, realm)

        # no quote: expect a warning
        with support.check_warnings((""Basic Auth Realm was unquoted"",
                                     UserWarning)):
            headers = ['WWW-Authenticate: Basic realm={}'.format(realm)]
            self.check_basic_auth(headers, realm)

        # Multiple headers: one challenge per header.
        # Use the first Basic realm.
        for challenges in (
            [basic,  basic2],
            [basic,  digest],
            [digest, basic],
        ):
            headers = ['WWW-Authenticate: {}'.format(challenge)
                       for challenge in challenges]
            self.check_basic_auth(headers, realm)","    def test_basic_auth(self, quote_char='""'):
        opener = OpenerDirector()
        password_manager = MockPasswordManager()
        auth_handler = urllib.request.HTTPBasicAuthHandler(password_manager)
        realm = ""ACME Widget Store""
        http_handler = MockHTTPHandler(
            401, 'WWW-Authenticate: Basic realm=%s%s%s\r\n\r\n' %
            (quote_char, realm, quote_char))
        opener.add_handler(auth_handler)
        opener.add_handler(http_handler)
        self._test_basic_auth(opener, auth_handler, ""Authorization"",
                              realm, http_handler, password_manager,
                              ""http://acme.example.com/protected"",
                              ""http://acme.example.com/protected"",
                              )

    def test_basic_auth_with_single_quoted_realm(self):
        self.test_basic_auth(quote_char=""'"")

    def test_basic_auth_with_unquoted_realm(self):
        opener = OpenerDirector()
        password_manager = MockPasswordManager()
        auth_handler = urllib.request.HTTPBasicAuthHandler(password_manager)
        realm = ""ACME Widget Store""
        http_handler = MockHTTPHandler(
            401, 'WWW-Authenticate: Basic realm=%s\r\n\r\n' % realm)
        opener.add_handler(auth_handler)
        opener.add_handler(http_handler)
        with self.assertWarns(UserWarning):
                                realm, http_handler, password_manager,
                                ""http://acme.example.com/protected"",
                                ""http://acme.example.com/protected"",
                                )",37fe316479e0b6906a74b0c0a5e495c55037fdfd,CVE-2020-8492,37fe316479e0b6906a74b0c0a5e495c55037fdfd,https://github.com/python/cpython,NVD_GIT_REPOBASED,196,COMPLETED,"VAR VAR(VAR, VAR, VAR): VAR VAR.VAR(VAR=VAR, VAR=VAR): VAR = VAR() VAR = VAR() VAR = VAR.VAR.VAR(VAR) VAR = '\VAR\VAR'.VAR(VAR) + '\VAR\VAR\VAR\VAR' VAR = VAR(401, VAR) VAR.VAR(VAR) VAR.VAR(VAR) VAR, VAR, VAR, ""VAR: ""VAR: VAR VAR(VAR): VAR = ""VAR@VAR.VAR"" VAR = ""VAR@VAR.VAR"" VAR = 'VAR VAR=""{}""'.VAR(VAR) VAR = 'VAR VAR=""{}""'.VAR(VAR) VAR = 'VAR VAR' VAR = ('VAR VAR=""{}"", ' 'VAR=""VAR, VAR-VAR"", ' 'VAR=""VAR"", ' 'VAR=""5ccc069c403ebaf9f0171e9517f40e41""').VAR(VAR) VAR VAR VAR (  'VAR VAR=""{}""'.VAR(VAR), ""VAR VAR='{}'"".VAR(VAR),  'VAR VAR=""{}"", VAR=""VAR-8""'.VAR(VAR),  '{}, {}'.VAR(VAR, VAR), '{}, {}'.VAR(VAR, VAR), '{}, {}'.VAR(VAR, VAR), '{}, {}'.VAR(VAR, VAR), '{}, {}'.VAR(VAR, VAR), ): VAR = ['VAR-VAR: {}'.VAR(VAR)] VAR.VAR(VAR, VAR)  VAR VAR.VAR((""VAR VAR VAR VAR VAR"", VAR)): VAR = ['VAR-VAR: VAR VAR={}'.VAR(VAR)] VAR.VAR(VAR, VAR)   VAR VAR VAR ( [VAR, VAR], [VAR, VAR], [VAR, VAR], ): VAR = ['VAR-VAR: {}'.VAR(VAR) VAR VAR VAR VAR] VAR.VAR(VAR, VAR) VAR VAR(VAR, VAR='""'): VAR = VAR() VAR = VAR() VAR = VAR.VAR.VAR(VAR) VAR = ""VAR VAR VAR"" VAR = VAR( 401, 'VAR-VAR: VAR VAR=%VAR%VAR%VAR\VAR\VAR\VAR\VAR' % (VAR, VAR, VAR)) VAR.VAR(VAR) VAR.VAR(VAR) VAR.VAR(VAR, VAR, ""VAR"", VAR, VAR, VAR, ""VAR: ""VAR: ) VAR VAR(VAR): VAR.VAR(VAR=""'"") VAR VAR(VAR): VAR = VAR() VAR = VAR() VAR = VAR.VAR.VAR(VAR) VAR = ""VAR VAR VAR"" VAR = VAR( 401, 'VAR-VAR: VAR VAR=%VAR\VAR\VAR\VAR\VAR' % VAR) VAR.VAR(VAR) VAR.VAR(VAR) VAR VAR.VAR(VAR): VAR, VAR, VAR, ""VAR: ""VAR: )",0,1
cpython_4bfcffe16e9742c154f54ae96b5b36903500abaa,Litest/test_site.py,"    def _create_underpth_exe(self, lines, exe_pth=True):
        import _winapi
        dll_src_file = _winapi.GetModuleFileName(sys.dllhandle)
        dll_file = os.path.join(temp_dir, os.path.split(dll_src_file)[1])
        shutil.copy(dll_src_file, dll_file)
        if exe_pth:
            _pth_file = os.path.splitext(exe_file)[0] + '._pth'
        else:
            _pth_file = os.path.splitext(dll_file)[0] + '._pth'
    def test_underpth_dll_file(self):
        libpath = os.path.dirname(os.path.dirname(encodings.__file__))
        exe_prefix = os.path.dirname(sys.executable)
        exe_file = self._create_underpth_exe([
            'fake-path-name',
            *[libpath for _ in range(200)],
            '',
            '# comment',
            'import site'
        ], exe_pth=False)
        sys_prefix = os.path.dirname(exe_file)
        env = os.environ.copy()
        env['PYTHONPATH'] = 'from-env'
        env['PATH'] = '{};{}'.format(exe_prefix, os.getenv('PATH'))
        rc = subprocess.call([exe_file, '-c',
            'import sys; sys.exit(not sys.flags.no_site and '
            '%r in sys.path and %r in sys.path and %r not in sys.path and '
            'all(""\\r"" not in p and ""\\n"" not in p for p in sys.path))' % (
                os.path.join(sys_prefix, 'fake-path-name'),
                libpath,
                os.path.join(sys_prefix, 'from-env'),
            )], env=env)
        self.assertTrue(rc, ""sys.path is incorrect"")

","    def _create_underpth_exe(self, lines):
        _pth_file = os.path.splitext(exe_file)[0] + '._pth'",4bfcffe16e9742c154f54ae96b5b36903500abaa,CVE-2020-15801,4bfcffe16e9742c154f54ae96b5b36903500abaa,https://github.com/python/cpython,NVD_GIT_REPOBASED,120,COMPLETED,"VAR VAR(VAR, VAR, VAR=VAR): VAR VAR VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR.VAR(VAR, VAR.VAR.VAR(VAR)[1]) VAR.VAR(VAR, VAR) VAR VAR: VAR = VAR.VAR.VAR(VAR)[0] + '.VAR' VAR: VAR = VAR.VAR.VAR(VAR)[0] + '.VAR' VAR VAR(VAR): VAR = VAR.VAR.VAR(VAR.VAR.VAR(VAR.VAR)) VAR = VAR.VAR.VAR(VAR.VAR) VAR = VAR.VAR([ 'VAR-VAR-VAR', *[VAR VAR VAR VAR VAR(200)], '', ' 'VAR VAR' ], VAR=VAR) VAR = VAR.VAR.VAR(VAR) VAR = VAR.VAR.VAR() VAR['VAR'] = 'VAR-VAR' VAR['VAR'] = '{};{}'.VAR(VAR, VAR.VAR('VAR')) VAR = VAR.VAR([VAR, '-VAR', 'VAR VAR; VAR.VAR(VAR VAR.VAR.VAR VAR ' '%VAR VAR VAR.VAR VAR %VAR VAR VAR.VAR VAR %VAR VAR VAR VAR.VAR VAR ' 'VAR(""\\VAR"" VAR VAR VAR VAR ""\\VAR"" VAR VAR VAR VAR VAR VAR VAR.VAR))' % ( VAR.VAR.VAR(VAR, 'VAR-VAR-VAR'), VAR, VAR.VAR.VAR(VAR, 'VAR-VAR'), )], VAR=VAR) VAR.VAR(VAR, ""VAR.VAR VAR VAR"") VAR VAR(VAR, VAR): VAR = VAR.VAR.VAR(VAR)[0] + '.VAR'",8,1
directus_ff53d3e69a602d05342e15d9bb616884833ddbff,api/src/operations/request/index.test.ts,"vi.mock('../../request', () => ({
	getAxios: () =>
		axiosDefault.mockResolvedValue({
			status: 200,
			statusText: 'OK',
			headers: {},
			data: {},
		}),","vi.mock('axios', () => ({
	default: axiosDefault.mockResolvedValue({
		status: 200,
		statusText: 'OK',
		headers: {},
		data: {},
	}),",ff53d3e69a602d05342e15d9bb616884833ddbff,CVE-2023-26492,ff53d3e69a602d05342e15d9bb616884833ddbff,https://github.com/directus/directus,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR.VAR('../../VAR', () => ({ VAR: () => VAR.VAR({ VAR: 200, VAR: 'VAR', VAR: {}, VAR: {}, }), VAR.VAR('VAR', () => ({ VAR: VAR.VAR({ VAR: 200, VAR: 'VAR', VAR: {}, VAR: {}, }),",8,1
discourse_26e267478d785e2f32ee7da4613e2cf4a65ff182,lischeduler/defer.rb,"      @queue =
        WorkQueue::ThreadSafeWrapper.new(
          WorkQueue::FairQueue.new(500) { WorkQueue::BoundedQueue.new(10) },
        )

      @queue.size
    def later(desc = nil, db = RailsMultisite::ConnectionManagement.current_db, force: true, &blk)
        @queue.push({ key: db, task: [db, blk, desc] }, force: force)
      do_work(non_block = true) while !@queue.empty?
      db, job, desc = @queue.shift(block: !non_block)[:task]
","      @queue = Queue.new
      @queue.length
    def later(desc = nil, db = RailsMultisite::ConnectionManagement.current_db, &blk)
        @queue << [db, blk, desc]
      do_work(_non_block = true) while !@queue.empty?
      db, job, desc = @queue.deq(non_block)",26e267478d785e2f32ee7da4613e2cf4a65ff182,CVE-2023-38498,26e267478d785e2f32ee7da4613e2cf4a65ff182,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"@VAR = VAR::VAR.VAR( VAR::VAR.VAR(500) { VAR::VAR.VAR(10) }, ) @VAR.VAR VAR VAR(VAR = VAR, VAR = VAR::VAR.VAR, VAR: VAR, &VAR) @VAR.VAR({ VAR: VAR, VAR: [VAR, VAR, VAR] }, VAR: VAR) VAR(VAR = VAR) VAR !@VAR.VAR? VAR, VAR, VAR = @VAR.VAR(VAR: !VAR)[:VAR] @VAR = VAR.VAR @VAR.VAR VAR VAR(VAR = VAR, VAR = VAR::VAR.VAR, &VAR) @VAR << [VAR, VAR, VAR] VAR(VAR = VAR) VAR !@VAR.VAR? VAR, VAR, VAR = @VAR.VAR(VAR)",4,1
discourse_3c5fb871c0f54af47679ae71ad449666b01d8216,plugins/chat/spec/requests/core_ext/users_controller_spec.rb,"
  describe ""#user_menu_bookmarks"" do
    fab!(:chatters) { Fabricate(:group) }
    let(:current_user) { Fabricate(:user, group_ids: [chatters.id]) }
    let(:bookmark_message) { Fabricate(:chat_message) }
    let(:bookmark_user) { current_user }

    before do
      register_test_bookmarkable(Chat::MessageBookmarkable)
      SiteSetting.chat_allowed_groups = [chatters]
      sign_in(current_user)
    end

    it ""does not return any unread notifications for chat bookmarks that the user no longer has access to"" do
      bookmark_with_reminder =
        Fabricate(:bookmark, user: current_user, bookmarkable: bookmark_message)
      BookmarkReminderNotificationHandler.new(bookmark_with_reminder).send_notification

      bookmark_with_reminder.bookmarkable.update!(
        chat_channel: Fabricate(:private_category_channel),
      )

      get ""/u/#{current_user.username}/user-menu-bookmarks""
      expect(response.status).to eq(200)

      notifications = response.parsed_body[""notifications""]
      expect(notifications.size).to eq(0)
    end
  end",,3c5fb871c0f54af47679ae71ad449666b01d8216,CVE-2023-45816,3c5fb871c0f54af47679ae71ad449666b01d8216,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR "" VAR!(:VAR) { VAR(:VAR) } VAR(:VAR) { VAR(:VAR, VAR: [VAR.VAR]) } VAR(:VAR) { VAR(:VAR) } VAR(:VAR) { VAR } VAR VAR VAR(VAR::VAR) VAR.VAR = [VAR] VAR(VAR) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR = VAR(:VAR, VAR: VAR, VAR: VAR) VAR.VAR(VAR).VAR VAR.VAR.VAR!( VAR: VAR(:VAR), ) VAR ""/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR = VAR.VAR[""VAR""] VAR(VAR.VAR).VAR VAR(0) VAR VAR ",8,1
discourse_3c5fb871c0f54af47679ae71ad449666b01d8216,spec/requests/users_controller_spec.rb,"        expect(notifications.size).to eq(0)

      it ""does not return any unread notifications for bookmarks that the user no longer has access to"" do
        bookmark_with_reminder2 = Fabricate(:bookmark, user: user, bookmarkable: Fabricate(:post))
        TopicUser.change(user.id, bookmark_with_reminder2.bookmarkable.topic, total_msecs_viewed: 1)
        BookmarkReminderNotificationHandler.new(bookmark_with_reminder2).send_notification

        bookmark_with_reminder2.bookmarkable.topic.update!(
          archetype: Archetype.private_message,
          category: nil,
        )

        get ""/u/#{user.username}/user-menu-bookmarks""
        expect(response.status).to eq(200)

        notifications = response.parsed_body[""notifications""]
        expect(notifications.size).to eq(1)
        expect(notifications.first[""data""][""bookmark_id""]).to eq(bookmark_with_reminder.id)
      end","        expect(notifications.size).to eq(1)
        expect(notifications.first[""data""][""bookmark_id""]).to be_nil",3c5fb871c0f54af47679ae71ad449666b01d8216,CVE-2023-45816,3c5fb871c0f54af47679ae71ad449666b01d8216,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR(VAR.VAR).VAR VAR(0) VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR = VAR(:VAR, VAR: VAR, VAR: VAR(:VAR)) VAR.VAR(VAR.VAR, VAR.VAR.VAR, VAR: 1) VAR.VAR(VAR).VAR VAR.VAR.VAR.VAR!( VAR: VAR.VAR, VAR: VAR, ) VAR ""/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR = VAR.VAR[""VAR""] VAR(VAR.VAR).VAR VAR(1) VAR(VAR.VAR[""VAR""][""VAR""]).VAR VAR(VAR.VAR) VAR VAR(VAR.VAR).VAR VAR(1) VAR(VAR.VAR[""VAR""][""VAR""]).VAR VAR",8,1
discourse_5e2e178fcfb490c37b9f8bb9f737185441b1d6de,spec/requests/users_controller_spec.rb,"    it ""should not be able to view a private user profile"" do
      user1.user_profile.update!(bio_raw: ""Hello world!"")
      user1.user_option.update!(hide_profile_and_presence: true)

      get ""/u/#{user1.username}""

      expect(response.status).to eq(200)
      expect(response.body).not_to include(""Hello world!"")
    end
",,5e2e178fcfb490c37b9f8bb9f737185441b1d6de,CVE-2022-21678,5e2e178fcfb490c37b9f8bb9f737185441b1d6de,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR.VAR.VAR!(VAR: ""VAR VAR!"") VAR.VAR.VAR!(VAR: VAR) VAR ""/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR).VAR VAR(""VAR VAR!"") VAR ",8,1
discourse_a34075d205a8857e29574ffd82aaece0c467565e,spec/components/final_destination_spec.rb,"  let(:body_response) do
    {
      status: 200,
      body: ""<body>test</body>""
    }
  end

    it 'raises error when response is too big' do
      stub_const(described_class, ""MAX_REQUEST_SIZE_BYTES"", 1) do
        stub_request(:get, ""https://codinghorror.com/blog"").to_return(body_response)
        final = FinalDestination.new('https://codinghorror.com/blog', opts.merge(follow_canonical: true))
        expect { final.resolve }.to raise_error(Excon::Errors::ExpectationFailed, ""response size too big: https://codinghorror.com/blog"")
      end
    end

    it 'raises error when response is too slow' do
      stub_request(:get, ""https://codinghorror.com/blog"").to_return(lambda { |request| freeze_time(11.seconds.from_now) ; body_response })
      final = FinalDestination.new('https://codinghorror.com/blog', opts.merge(follow_canonical: true))
      expect { final.resolve }.to raise_error(Excon::Errors::ExpectationFailed, ""connect timeout reached: https://codinghorror.com/blog"")
    end
",,a34075d205a8857e29574ffd82aaece0c467565e,CVE-2022-23641,a34075d205a8857e29574ffd82aaece0c467565e,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR(:VAR) VAR { VAR: 200, VAR: ""<VAR>VAR</VAR>"" } VAR VAR 'VAR VAR VAR VAR VAR VAR VAR' VAR VAR(VAR, ""VAR"", 1) VAR VAR(:VAR, ""VAR: VAR = VAR.VAR('VAR: VAR { VAR.VAR }.VAR VAR(VAR::VAR::VAR, ""VAR VAR VAR VAR: VAR: VAR VAR VAR 'VAR VAR VAR VAR VAR VAR VAR' VAR VAR(:VAR, ""VAR: VAR = VAR.VAR('VAR: VAR { VAR.VAR }.VAR VAR(VAR::VAR::VAR, ""VAR VAR VAR: VAR: VAR ",8,1
discourse_a414520742da8dc9dc976d4fb7b72dbd445813bb,spec/requests/invites_controller_spec.rb,"      context ""for an email invite"" do
        fab!(:invite) { Fabricate(:invite, email: 'test@example.com') }
        fab!(:user) { Fabricate(:user, email: 'test@example.com') }
        fab!(:group) { Fabricate(:group) }
        it 'redeems the invitation and creates the invite accepted notification' do
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(200)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
          invite.reload
          expect(invite.invited_users.first.user).to eq(user)
          expect(invite.redeemed?).to be_truthy
          expect(
            Notification.exists?(
              user: invite.invited_by, notification_type: Notification.types[:invitee_accepted]
            )
          ).to eq(true)
        end
        it 'redirects to the first topic the user was invited to and creates the topic notification' do
          topic = Fabricate(:topic)
          TopicInvite.create!(invite: invite, topic: topic)
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(200)
          expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
          expect(Notification.where(notification_type: Notification.types[:invited_to_topic], topic: topic).count).to eq(1)
        end
        it ""adds the user to the private topic"" do
          topic = Fabricate(:private_message_topic)
          TopicInvite.create!(invite: invite, topic: topic)
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(200)
          expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
          expect(TopicAllowedUser.exists?(user: user, topic: topic)).to eq(true)
        end
        it ""adds the user to the groups specified on the invite and allows them to access the secure topic"" do
          group.add_owner(invite.invited_by)
          secured_category = Fabricate(:category)
          secured_category.permissions = { group.name => :full }
          secured_category.save!

          topic = Fabricate(:topic, category: secured_category)
          TopicInvite.create!(invite: invite, topic: topic)
          InvitedGroup.create!(invite: invite, group: group)
          expect(response.status).to eq(200)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
          expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
          invite.reload
          expect(invite.redeemed?).to be_truthy
          expect(user.reload.groups).to include(group)
          expect(Notification.where(notification_type: Notification.types[:invited_to_topic], topic: topic).count).to eq(1)
        end
        it ""does not try to log in the user automatically"" do
          expect do
            put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          end.not_to change { UserAuthToken.count }
          expect(response.status).to eq(200)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
        end

        it ""errors if the user's email doesn't match the invite email"" do
          user.update!(email: ""blah@test.com"")
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(412)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.not_matching_email""))
        end

        it ""errors if the user's email domain doesn't match the invite domain"" do
          user.update!(email: ""blah@test.com"")
          invite.update!(email: nil, domain: ""example.com"")
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(412)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.domain_not_allowed""))
        end
      context ""for an invite link"" do
        fab!(:invite) { Fabricate(:invite, email: nil) }
        fab!(:user) { Fabricate(:user, email: 'test@example.com') }
        fab!(:group) { Fabricate(:group) }

        it 'redeems the invitation and creates the invite accepted notification' do
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(200)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
          invite.reload
          expect(invite.invited_users.first.user).to eq(user)
          expect(invite.redeemed?).to be_truthy
          expect(
            Notification.exists?(
              user: invite.invited_by, notification_type: Notification.types[:invitee_accepted]
            )
          ).to eq(true)
        end

        it 'redirects to the first topic the user was invited to and creates the topic notification' do
          topic = Fabricate(:topic)
          TopicInvite.create!(invite: invite, topic: topic)
          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(200)
          expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
          expect(Notification.where(notification_type: Notification.types[:invited_to_topic], topic: topic).count).to eq(1)
        end

        it ""adds the user to the groups specified on the invite and allows them to access the secure topic"" do
          group.add_owner(invite.invited_by)
          secured_category = Fabricate(:category)
          secured_category.permissions = { group.name => :full }
          secured_category.save!

          topic = Fabricate(:topic, category: secured_category)
          TopicInvite.create!(invite: invite, topic: topic)
          InvitedGroup.create!(invite: invite, group: group)

          put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          expect(response.status).to eq(200)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
          expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
          invite.reload
          expect(invite.redeemed?).to be_truthy
          expect(user.reload.groups).to include(group)
          expect(Notification.where(notification_type: Notification.types[:invited_to_topic], topic: topic).count).to eq(1)
        end

        it ""does not try to log in the user automatically"" do
          expect do
            put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
          end.not_to change { UserAuthToken.count }
          expect(response.status).to eq(200)
          expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
        end","      fab!(:invite) { Fabricate(:invite, email: 'test@example.com') }
      fab!(:user) { Fabricate(:user, email: 'test@example.com') }
      fab!(:group) { Fabricate(:group) }

      it 'redeems the invitation and creates the invite accepted notification' do
        put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
        expect(response.status).to eq(200)
        expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
        invite.reload
        expect(invite.invited_users.first.user).to eq(user)
        expect(invite.redeemed?).to be_truthy
        expect(
          Notification.exists?(
            user: invite.invited_by, notification_type: Notification.types[:invitee_accepted]
          )
        ).to eq(true)
      end
      it 'redirects to the first topic the user was invited to and creates the topic notification' do
        topic = Fabricate(:topic)
        TopicInvite.create!(invite: invite, topic: topic)
        put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
        expect(response.status).to eq(200)
        expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
        expect(Notification.where(notification_type: Notification.types[:invited_to_topic], topic: topic).count).to eq(1)
      end
      it ""adds the user to the groups specified on the invite and allows them to access the secure topic"" do
        group.add_owner(invite.invited_by)
        secured_category = Fabricate(:category)
        secured_category.permissions = { group.name => :full }
        secured_category.save!
        topic = Fabricate(:topic, category: secured_category)
        TopicInvite.create!(invite: invite, topic: topic)
        InvitedGroup.create!(invite: invite, group: group)
        put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
        expect(response.status).to eq(200)
        expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
        expect(response.parsed_body['redirect_to']).to eq(topic.relative_url)
        invite.reload
        expect(invite.redeemed?).to be_truthy
        expect(user.reload.groups).to include(group)
        expect(Notification.where(notification_type: Notification.types[:invited_to_topic], topic: topic).count).to eq(1)
      end
      it ""does not try to log in the user automatically"" do
        expect do
        end.not_to change { UserAuthToken.count }
        expect(response.status).to eq(200)
        expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.existing_user_success""))
      end
      it ""errors if the user's email doesn't match the invite email"" do
        user.update!(email: ""blah@test.com"")
        put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
        expect(response.status).to eq(412)
        expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.not_matching_email""))
      it ""errors if the user's email domain doesn't match the invite domain"" do
        user.update!(email: ""blah@test.com"")
        invite.update!(email: nil, domain: ""example.com"")
        put ""/invites/show/#{invite.invite_key}.json"", params: { id: invite.invite_key }
        expect(response.status).to eq(412)
        expect(response.parsed_body[""message""]).to eq(I18n.t(""invite.domain_not_allowed""))",a414520742da8dc9dc976d4fb7b72dbd445813bb,CVE-2022-39385,a414520742da8dc9dc976d4fb7b72dbd445813bb,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR ""VAR VAR VAR VAR"" VAR VAR!(:VAR) { VAR(:VAR, VAR: 'VAR@VAR.VAR') } VAR!(:VAR) { VAR(:VAR, VAR: 'VAR@VAR.VAR') } VAR!(:VAR) { VAR(:VAR) } VAR 'VAR VAR VAR VAR VAR VAR VAR VAR VAR' VAR VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR.VAR VAR(VAR.VAR.VAR.VAR).VAR VAR(VAR) VAR(VAR.VAR?).VAR VAR VAR( VAR.VAR?( VAR: VAR.VAR, VAR: VAR.VAR[:VAR] ) ).VAR VAR(VAR) VAR VAR 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR' VAR VAR = VAR(:VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR(VAR.VAR(VAR: VAR.VAR[:VAR], VAR: VAR).VAR).VAR VAR(1) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR"" VAR VAR = VAR(:VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR(VAR.VAR?(VAR: VAR, VAR: VAR)).VAR VAR(VAR) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR.VAR(VAR.VAR) VAR = VAR(:VAR) VAR.VAR = { VAR.VAR => :VAR } VAR.VAR! VAR = VAR(:VAR, VAR: VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR.VAR VAR(VAR.VAR?).VAR VAR VAR(VAR.VAR.VAR).VAR VAR(VAR) VAR(VAR.VAR(VAR: VAR.VAR[:VAR], VAR: VAR).VAR).VAR VAR(1) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR VAR VAR ""/VAR/VAR/ VAR.VAR VAR { VAR.VAR } VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR VAR ""VAR VAR VAR VAR'VAR VAR VAR'VAR VAR VAR VAR VAR"" VAR VAR.VAR!(VAR: ""VAR@VAR.VAR"") VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(412) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR VAR ""VAR VAR VAR VAR'VAR VAR VAR VAR'VAR VAR VAR VAR VAR"" VAR VAR.VAR!(VAR: ""VAR@VAR.VAR"") VAR.VAR!(VAR: VAR, VAR: ""VAR.VAR"") VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(412) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR VAR ""VAR VAR VAR VAR"" VAR VAR!(:VAR) { VAR(:VAR, VAR: VAR) } VAR!(:VAR) { VAR(:VAR, VAR: 'VAR@VAR.VAR') } VAR!(:VAR) { VAR(:VAR) } VAR 'VAR VAR VAR VAR VAR VAR VAR VAR VAR' VAR VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR.VAR VAR(VAR.VAR.VAR.VAR).VAR VAR(VAR) VAR(VAR.VAR?).VAR VAR VAR( VAR.VAR?( VAR: VAR.VAR, VAR: VAR.VAR[:VAR] ) ).VAR VAR(VAR) VAR VAR 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR' VAR VAR = VAR(:VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR(VAR.VAR(VAR: VAR.VAR[:VAR], VAR: VAR).VAR).VAR VAR(1) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR.VAR(VAR.VAR) VAR = VAR(:VAR) VAR.VAR = { VAR.VAR => :VAR } VAR.VAR! VAR = VAR(:VAR, VAR: VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR.VAR VAR(VAR.VAR?).VAR VAR VAR(VAR.VAR.VAR).VAR VAR(VAR) VAR(VAR.VAR(VAR: VAR.VAR[:VAR], VAR: VAR).VAR).VAR VAR(1) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR VAR VAR ""/VAR/VAR/ VAR.VAR VAR { VAR.VAR } VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR VAR!(:VAR) { VAR(:VAR, VAR: 'VAR@VAR.VAR') } VAR!(:VAR) { VAR(:VAR, VAR: 'VAR@VAR.VAR') } VAR!(:VAR) { VAR(:VAR) } VAR 'VAR VAR VAR VAR VAR VAR VAR VAR VAR' VAR VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR.VAR VAR(VAR.VAR.VAR.VAR).VAR VAR(VAR) VAR(VAR.VAR?).VAR VAR VAR( VAR.VAR?( VAR: VAR.VAR, VAR: VAR.VAR[:VAR] ) ).VAR VAR(VAR) VAR VAR 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR' VAR VAR = VAR(:VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR(VAR.VAR(VAR: VAR.VAR[:VAR], VAR: VAR).VAR).VAR VAR(1) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR.VAR(VAR.VAR) VAR = VAR(:VAR) VAR.VAR = { VAR.VAR => :VAR } VAR.VAR! VAR = VAR(:VAR, VAR: VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR.VAR!(VAR: VAR, VAR: VAR) VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR(VAR.VAR['VAR']).VAR VAR(VAR.VAR) VAR.VAR VAR(VAR.VAR?).VAR VAR VAR(VAR.VAR.VAR).VAR VAR(VAR) VAR(VAR.VAR(VAR: VAR.VAR[:VAR], VAR: VAR).VAR).VAR VAR(1) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR VAR VAR.VAR VAR { VAR.VAR } VAR(VAR.VAR).VAR VAR(200) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR VAR ""VAR VAR VAR VAR'VAR VAR VAR'VAR VAR VAR VAR VAR"" VAR VAR.VAR!(VAR: ""VAR@VAR.VAR"") VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(412) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR"")) VAR ""VAR VAR VAR VAR'VAR VAR VAR VAR'VAR VAR VAR VAR VAR"" VAR VAR.VAR!(VAR: ""VAR@VAR.VAR"") VAR.VAR!(VAR: VAR, VAR: ""VAR.VAR"") VAR ""/VAR/VAR/ VAR(VAR.VAR).VAR VAR(412) VAR(VAR.VAR[""VAR""]).VAR VAR(VAR.VAR(""VAR.VAR""))",8,1
discourse_bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,app/controllers/admin/staff_action_logs_controller.rb,"  INDEX_LIMIT = 200

    page_size = fetch_limit_from_params(default: INDEX_LIMIT, max: INDEX_LIMIT)","    page_size = (params[:limit] || 200).to_i.clamp(1, 200)",bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,CVE-2023-38684,bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR = 200 VAR = VAR(VAR: VAR, VAR: VAR) VAR = (VAR[:VAR] || 200).VAR.VAR(1, 200)",8,1
discourse_bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,app/controllers/post_action_users_controller.rb,"  INDEX_LIMIT = 200

    page_size = fetch_limit_from_params(default: INDEX_LIMIT, max: INDEX_LIMIT)",    page_size = (params[:limit] || 200).to_i,bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,CVE-2023-38684,bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR = 200 VAR = VAR(VAR: VAR, VAR: VAR) VAR = (VAR[:VAR] || 200).VAR",8,1
discourse_bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,spec/requests/directory_items_controller_spec.rb,"    include_examples ""invalid limit params"", ""/directory_items.json"", described_class::PAGE_SIZE","    it ""does not exceed PAGE_SIZE if limit parameter is more than PAGE_SIZE"" do
      large_limit = DirectoryItemsController::PAGE_SIZE + 10
      get ""/directory_items.json"", params: { period: ""all"", limit: large_limit }
      expect(response.status).to eq(200)
      json = response.parsed_body

      expect(json[""directory_items""].length).to eq(DirectoryItemsController::PAGE_SIZE)
    end

    it ""handles invalid limit parameters gracefully"" do
      get ""/directory_items.json"", params: { period: ""all"", limit: ""invalid_limit"" }
      expect(response.status).to eq(200)
      json = response.parsed_body

      expect(json[""directory_items""]).not_to be_empty
    end",bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,CVE-2023-38684,bfc3132bb22bd5b7e86f428746b89c4d3d7f5a70,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR ""VAR VAR VAR"", ""/VAR.VAR"", VAR::VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR = VAR::VAR + 10 VAR ""/VAR.VAR"", VAR: { VAR: ""VAR"", VAR: VAR } VAR(VAR.VAR).VAR VAR(200) VAR = VAR.VAR VAR(VAR[""VAR""].VAR).VAR VAR(VAR::VAR) VAR VAR ""VAR VAR VAR VAR VAR"" VAR VAR ""/VAR.VAR"", VAR: { VAR: ""VAR"", VAR: ""VAR"" } VAR(VAR.VAR).VAR VAR(200) VAR = VAR.VAR VAR(VAR[""VAR""]).VAR VAR VAR",8,1
discourse_c6ee28ec756436cc9ce154dd2c8e4c441f92f693,spec/requests/notifications_controller_spec.rb,"
        context ""with notifications for inaccessible topics"" do
          fab!(:sender) { Fabricate.build(:topic_allowed_user, user: Fabricate(:coding_horror)) }
          fab!(:allowed_user) { Fabricate.build(:topic_allowed_user, user: user) }
          fab!(:another_allowed_user) { Fabricate.build(:topic_allowed_user, user: Fabricate(:user)) }
          fab!(:allowed_pm) { Fabricate(:private_message_topic, topic_allowed_users: [sender, allowed_user, another_allowed_user]) }
          fab!(:forbidden_pm) { Fabricate(:private_message_topic, topic_allowed_users: [sender, another_allowed_user]) }
          fab!(:allowed_pm_notification) { Fabricate(:private_message_notification, user: user, topic: allowed_pm) }
          fab!(:forbidden_pm_notification) { Fabricate(:private_message_notification, user: user, topic: forbidden_pm) }

          def expect_correct_notifications(response)
            notification_ids = response.parsed_body[""notifications""].map { |n| n[""id""] }
            expect(notification_ids).to include(allowed_pm_notification.id)
            expect(notification_ids).to_not include(forbidden_pm_notification.id)
          end

          context ""with 'recent' filter"" do
            it ""doesn't include notifications from topics the user isn't allowed to see"" do
              SiteSetting.enable_experimental_sidebar_hamburger = true
              get ""/notifications.json"", params: { recent: true }
              expect(response.status).to eq(200)
              expect_correct_notifications(response)

              SiteSetting.enable_experimental_sidebar_hamburger = false
              get ""/notifications.json"", params: { recent: true }
              expect(response.status).to eq(200)
              expect_correct_notifications(response)
            end
          end

          context ""without 'recent' filter"" do
            it ""doesn't include notifications from topics the user isn't allowed to see"" do
              SiteSetting.enable_experimental_sidebar_hamburger = true
              get ""/notifications.json""
              expect(response.status).to eq(200)
              expect_correct_notifications(response)

              SiteSetting.enable_experimental_sidebar_hamburger = false
              get ""/notifications.json""
              expect(response.status).to eq(200)
              expect_correct_notifications(response)
            end
          end
        end",,c6ee28ec756436cc9ce154dd2c8e4c441f92f693,CVE-2022-41944,c6ee28ec756436cc9ce154dd2c8e4c441f92f693,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR ""VAR VAR VAR VAR VAR"" VAR VAR!(:VAR) { VAR.VAR(:VAR, VAR: VAR(:VAR)) } VAR!(:VAR) { VAR.VAR(:VAR, VAR: VAR) } VAR!(:VAR) { VAR.VAR(:VAR, VAR: VAR(:VAR)) } VAR!(:VAR) { VAR(:VAR, VAR: [VAR, VAR, VAR]) } VAR!(:VAR) { VAR(:VAR, VAR: [VAR, VAR]) } VAR!(:VAR) { VAR(:VAR, VAR: VAR, VAR: VAR) } VAR!(:VAR) { VAR(:VAR, VAR: VAR, VAR: VAR) } VAR VAR(VAR) VAR = VAR.VAR[""VAR""].VAR { |VAR| VAR[""VAR""] } VAR(VAR).VAR VAR(VAR.VAR) VAR(VAR).VAR VAR(VAR.VAR) VAR VAR ""VAR 'VAR' VAR"" VAR VAR ""VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR"" VAR VAR.VAR = VAR VAR ""/VAR.VAR"", VAR: { VAR: VAR } VAR(VAR.VAR).VAR VAR(200) VAR(VAR) VAR.VAR = VAR VAR ""/VAR.VAR"", VAR: { VAR: VAR } VAR(VAR.VAR).VAR VAR(200) VAR(VAR) VAR VAR VAR ""VAR 'VAR' VAR"" VAR VAR ""VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR"" VAR VAR.VAR = VAR VAR ""/VAR.VAR"" VAR(VAR.VAR).VAR VAR(200) VAR(VAR) VAR.VAR = VAR VAR ""/VAR.VAR"" VAR(VAR.VAR).VAR VAR(200) VAR(VAR) VAR VAR VAR ",8,1
discourse_cf862e736565c6fa905c12b5dbe63d0bd056efb8,spec/requests/admin/email_controller_spec.rb,"  describe '#send_digest' do
    context ""when logged in as an admin"" do
      before { sign_in(admin) }

      it ""sends the digest"" do
        post ""/admin/email/send-digest.json"", params: {
          last_seen_at: 1.week.ago, username: admin.username, email: email('previous_replies')
        }
        expect(response.status).to eq(200)
      end
    end
  end
",,cf862e736565c6fa905c12b5dbe63d0bd056efb8,CVE-2022-23546,cf862e736565c6fa905c12b5dbe63d0bd056efb8,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR ' VAR ""VAR VAR VAR VAR VAR VAR"" VAR VAR { VAR(VAR) } VAR ""VAR VAR VAR"" VAR VAR ""/VAR/VAR/VAR-VAR.VAR"", VAR: { VAR: 1.VAR.VAR, VAR: VAR.VAR, VAR: VAR('VAR') } VAR(VAR.VAR).VAR VAR(200) VAR VAR VAR ",8,1
discourse_f31f0b70f82c43d93220ce6fc0d4f57440452f37,spec/requests/tags_controller_spec.rb,"
      Fabricate(
        :tag,
        name: ""topic-test"",
        public_topic_count: 1,
        staff_topic_count: 1,
        pm_topic_count: 5,
      )
    end

    fab!(:pm_only_tag) do
      Fabricate(:tag, public_topic_count: 0, staff_topic_count: 0, pm_topic_count: 1)

        serialized_tag = tags.find { |t| t[""id""] == test_tag.name }

        expect(serialized_tag[""count""]).to eq(0)
        expect(serialized_tag[""pm_count""]).to eq(nil)
        expect(serialized_tag[""pm_only""]).to eq(false)

        serialized_tag = tags.find { |t| t[""id""] == topic_tag.name }

        expect(serialized_tag[""count""]).to eq(1)
        expect(serialized_tag[""pm_count""]).to eq(nil)
        expect(serialized_tag[""pm_only""]).to eq(false)
      end

      it ""does not include pm_count attribute when user cannot tag PM topics even if display_personal_messages_tag_counts site setting has been enabled"" do
        SiteSetting.display_personal_messages_tag_counts = true

        sign_in(admin)

        get ""/tags.json""

        expect(response.status).to eq(200)

        tags = response.parsed_body[""tags""]

        expect(tags[0][""pm_count""]).to eq(nil)
        expect(tags[1][""pm_count""]).to eq(nil)
      end

      it ""includes pm_count attribute when user can tag PM topics and display_personal_messages_tag_counts site setting has been enabled"" do
        SiteSetting.display_personal_messages_tag_counts = true
        SiteSetting.pm_tags_allowed_for_groups = Group::AUTO_GROUPS[:admins]

        sign_in(admin)

        get ""/tags.json""

        expect(response.status).to eq(200)

        tags = response.parsed_body[""tags""]

        serialized_tag = tags.find { |t| t[""id""] == test_tag.name }

        expect(serialized_tag[""pm_count""]).to eq(0)
        expect(serialized_tag[""pm_only""]).to eq(false)

        serialized_tag = tags.find { |t| t[""id""] == topic_tag.name }

        expect(serialized_tag[""pm_count""]).to eq(5)
        expect(serialized_tag[""pm_only""]).to eq(false)

        serialized_tag = tags.find { |t| t[""id""] == pm_only_tag.name }

        expect(serialized_tag[""pm_count""]).to eq(1)
        expect(serialized_tag[""pm_only""]).to eq(true)
        expect(tags[0][""pm_count""]).to eq(nil)
          SiteSetting.display_personal_messages_tag_counts = true
          expect(serialized_tag[""pm_count""]).to eq(5)
        expect(tags[0][""pm_count""]).to eq(nil)
        expect(categories[0][""tags""][0][""pm_count""]).to eq(nil)","      Fabricate(:tag, name: ""topic-test"", public_topic_count: 1, staff_topic_count: 1)
        expect(tags[0][""count""]).to eq(0)
        expect(tags[0][""pm_count""]).to eq(0)
        expect(tags[1][""count""]).to eq(1)
        expect(tags[1][""pm_count""]).to eq(0)
        expect(tags[0][""pm_count""]).to eq(0)
          expect(tags.length).to eq(2)
          expect(serialized_tag[""pm_count""]).to eq(0)
        expect(tags[0][""pm_count""]).to eq(0)
        expect(categories[0][""tags""][0][""pm_count""]).to eq(0)",f31f0b70f82c43d93220ce6fc0d4f57440452f37,CVE-2023-23935,f31f0b70f82c43d93220ce6fc0d4f57440452f37,https://github.com/discourse/discourse,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR( :VAR, VAR: ""VAR-VAR"", VAR: 1, VAR: 1, VAR: 5, ) VAR VAR!(:VAR) VAR VAR(:VAR, VAR: 0, VAR: 0, VAR: 1) VAR = VAR.VAR { |VAR| VAR[""VAR""] == VAR.VAR } VAR(VAR[""VAR""]).VAR VAR(0) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR = VAR.VAR { |VAR| VAR[""VAR""] == VAR.VAR } VAR(VAR[""VAR""]).VAR VAR(1) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR.VAR = VAR VAR(VAR) VAR ""/VAR.VAR"" VAR(VAR.VAR).VAR VAR(200) VAR = VAR.VAR[""VAR""] VAR(VAR[0][""VAR""]).VAR VAR(VAR) VAR(VAR[1][""VAR""]).VAR VAR(VAR) VAR VAR ""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"" VAR VAR.VAR = VAR VAR.VAR = VAR::VAR[:VAR] VAR(VAR) VAR ""/VAR.VAR"" VAR(VAR.VAR).VAR VAR(200) VAR = VAR.VAR[""VAR""] VAR = VAR.VAR { |VAR| VAR[""VAR""] == VAR.VAR } VAR(VAR[""VAR""]).VAR VAR(0) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR = VAR.VAR { |VAR| VAR[""VAR""] == VAR.VAR } VAR(VAR[""VAR""]).VAR VAR(5) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR = VAR.VAR { |VAR| VAR[""VAR""] == VAR.VAR } VAR(VAR[""VAR""]).VAR VAR(1) VAR(VAR[""VAR""]).VAR VAR(VAR) VAR(VAR[0][""VAR""]).VAR VAR(VAR) VAR.VAR = VAR VAR(VAR[""VAR""]).VAR VAR(5) VAR(VAR[0][""VAR""]).VAR VAR(VAR) VAR(VAR[0][""VAR""][0][""VAR""]).VAR VAR(VAR) VAR(:VAR, VAR: ""VAR-VAR"", VAR: 1, VAR: 1) VAR(VAR[0][""VAR""]).VAR VAR(0) VAR(VAR[0][""VAR""]).VAR VAR(0) VAR(VAR[1][""VAR""]).VAR VAR(1) VAR(VAR[1][""VAR""]).VAR VAR(0) VAR(VAR[0][""VAR""]).VAR VAR(0) VAR(VAR.VAR).VAR VAR(2) VAR(VAR[""VAR""]).VAR VAR(0) VAR(VAR[0][""VAR""]).VAR VAR(0) VAR(VAR[0][""VAR""][0][""VAR""]).VAR VAR(0)",8,1
django_0e7861aec73702f7933ce2a93056f7983939f0d6,tests/regressiontests/admin_views/tests.py,"    def testHistoryView(self):
        """"""History view should restrict access.""""""

        # add user shoud not be able to view the list of article or change any of them
        self.client.get('/test_admin/admin/')
        self.client.post('/test_admin/admin/', self.adduser_login)
        response = self.client.get('/test_admin/admin/admin_views/article/1/history/')
        self.assertEqual(response.status_code, 403)
        self.client.get('/test_admin/admin/logout/')

        # change user can view all items and edit them
        self.client.get('/test_admin/admin/')
        self.client.post('/test_admin/admin/', self.changeuser_login)
        response = self.client.get('/test_admin/admin/admin_views/article/1/history/')
        self.assertEqual(response.status_code, 200)

        # Test redirection when using row-level change permissions. Refs #11513.
        RowLevelChangePermissionModel.objects.create(id=1, name=""odd id"")
        RowLevelChangePermissionModel.objects.create(id=2, name=""even id"")
        for login_dict in [self.super_login, self.changeuser_login, self.adduser_login, self.deleteuser_login]:
            self.client.post('/test_admin/admin/', login_dict)
            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/history/')
            self.assertEqual(response.status_code, 403)

            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/history/')
            self.assertEqual(response.status_code, 200)

            self.client.get('/test_admin/admin/logout/')

        for login_dict in [self.joepublic_login, self.no_username_login]:
            self.client.post('/test_admin/admin/', login_dict)
            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/1/history/')
            self.assertEqual(response.status_code, 200)
            self.assertContains(response, 'login-form')
            response = self.client.get('/test_admin/admin/admin_views/rowlevelchangepermissionmodel/2/history/')
            self.assertEqual(response.status_code, 200)
            self.assertContains(response, 'login-form')

            self.client.get('/test_admin/admin/logout/')
",,0e7861aec73702f7933ce2a93056f7983939f0d6,CVE-2013-0305,0e7861aec73702f7933ce2a93056f7983939f0d6,https://github.com/django/django,GHSD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR(VAR): """"""VAR VAR VAR VAR VAR.""""""  VAR.VAR.VAR('/VAR/VAR/') VAR.VAR.VAR('/VAR/VAR/', VAR.VAR) VAR = VAR.VAR.VAR('/VAR/VAR/VAR/VAR/1/VAR/') VAR.VAR(VAR.VAR, 403) VAR.VAR.VAR('/VAR/VAR/VAR/')  VAR.VAR.VAR('/VAR/VAR/') VAR.VAR.VAR('/VAR/VAR/', VAR.VAR) VAR = VAR.VAR.VAR('/VAR/VAR/VAR/VAR/1/VAR/') VAR.VAR(VAR.VAR, 200)  VAR.VAR.VAR(VAR=1, VAR=""VAR VAR"") VAR.VAR.VAR(VAR=2, VAR=""VAR VAR"") VAR VAR VAR [VAR.VAR, VAR.VAR, VAR.VAR, VAR.VAR]: VAR.VAR.VAR('/VAR/VAR/', VAR) VAR = VAR.VAR.VAR('/VAR/VAR/VAR/VAR/1/VAR/') VAR.VAR(VAR.VAR, 403) VAR = VAR.VAR.VAR('/VAR/VAR/VAR/VAR/2/VAR/') VAR.VAR(VAR.VAR, 200) VAR.VAR.VAR('/VAR/VAR/VAR/') VAR VAR VAR [VAR.VAR, VAR.VAR]: VAR.VAR.VAR('/VAR/VAR/', VAR) VAR = VAR.VAR.VAR('/VAR/VAR/VAR/VAR/1/VAR/') VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR, 'VAR-VAR') VAR = VAR.VAR.VAR('/VAR/VAR/VAR/VAR/2/VAR/') VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR, 'VAR-VAR') VAR.VAR.VAR('/VAR/VAR/VAR/') ",8,1
django_46e2b9e059e617afe6fe56da9f132568a7e6b198,docs/releases/1.10.8.txt,"
CVE-2017-12794: Possible XSS in traceback section of technical 500 debug page
=============================================================================

In older versions, HTML autoescaping was disabled in a portion of the template
for the technical 500 debug page. Given the right circumstances, this allowed
a cross-site scripting attack. This vulnerability shouldn't affect most
production sites since you shouldn't run with ``DEBUG = True`` (which makes
this page accessible) in your production settings.",,46e2b9e059e617afe6fe56da9f132568a7e6b198,CVE-2017-12794,46e2b9e059e617afe6fe56da9f132568a7e6b198,https://github.com/django/django,GHSD_REGISTRY,84,COMPLETED,"VAR-2017-12794: VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR ============================================================================= VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR. VAR VAR VAR VAR, VAR VAR VAR VAR-VAR VAR VAR. VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR ``VAR = VAR`` (VAR VAR VAR VAR VAR) VAR VAR VAR VAR. ",0,1
django_46e2b9e059e617afe6fe56da9f132568a7e6b198,docs/releases/1.11.5.txt,"CVE-2017-12794: Possible XSS in traceback section of technical 500 debug page
=============================================================================

In older versions, HTML autoescaping was disabled in a portion of the template
for the technical 500 debug page. Given the right circumstances, this allowed
a cross-site scripting attack. This vulnerability shouldn't affect most
production sites since you shouldn't run with ``DEBUG = True`` (which makes
this page accessible) in your production settings.
",,46e2b9e059e617afe6fe56da9f132568a7e6b198,CVE-2017-12794,46e2b9e059e617afe6fe56da9f132568a7e6b198,https://github.com/django/django,GHSD_REGISTRY,84,COMPLETED,"VAR-2017-12794: VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR ============================================================================= VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR. VAR VAR VAR VAR, VAR VAR VAR VAR-VAR VAR VAR. VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR ``VAR = VAR`` (VAR VAR VAR VAR VAR) VAR VAR VAR VAR. ",0,1
django_58e08e80e362db79eb0fd775dc81faad90dca47a,docs/releases/1.10.8.txt,"
CVE-2017-12794: Possible XSS in traceback section of technical 500 debug page
=============================================================================

In older versions, HTML autoescaping was disabled in a portion of the template
for the technical 500 debug page. Given the right circumstances, this allowed
a cross-site scripting attack. This vulnerability shouldn't affect most
production sites since you shouldn't run with ``DEBUG = True`` (which makes
this page accessible) in your production settings.",,58e08e80e362db79eb0fd775dc81faad90dca47a,CVE-2017-12794,58e08e80e362db79eb0fd775dc81faad90dca47a,https://github.com/django/django,GHSD_REGISTRY,84,COMPLETED,"VAR-2017-12794: VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR ============================================================================= VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR. VAR VAR VAR VAR, VAR VAR VAR VAR-VAR VAR VAR. VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR ``VAR = VAR`` (VAR VAR VAR VAR VAR) VAR VAR VAR VAR. ",0,1
django_cca0d98118cccf9ae0c6dcf2d6c57fc50469fbf0,tests/file_uploads/tests.py,"CANDIDATE_TRAVERSAL_FILE_NAMES = [
    '/tmp/hax0rd.txt',          # Absolute path, *nix-style.
    'C:\\Windows\\hax0rd.txt',  # Absolute path, win-style.
    'C:/Windows/hax0rd.txt',    # Absolute path, broken-style.
    '\\tmp\\hax0rd.txt',        # Absolute path, broken in a different way.
    '/tmp\\hax0rd.txt',         # Absolute path, broken by mixing.
    'subdir/hax0rd.txt',        # Descendant path, *nix-style.
    'subdir\\hax0rd.txt',       # Descendant path, win-style.
    'sub/dir\\hax0rd.txt',      # Descendant path, mixed.
    '../../hax0rd.txt',         # Relative path, *nix-style.
    '..\\..\\hax0rd.txt',       # Relative path, win-style.
    '../..\\hax0rd.txt',        # Relative path, mixed.
    '..&#x2F;hax0rd.txt',       # HTML entities.
    '..&sol;hax0rd.txt',        # HTML entities.
]

        for i, name in enumerate(CANDIDATE_TRAVERSAL_FILE_NAMES):
        for i, name in enumerate(CANDIDATE_TRAVERSAL_FILE_NAMES):
    def test_filename_traversal_upload(self):
        os.makedirs(UPLOAD_TO, exist_ok=True)
        self.addCleanup(shutil.rmtree, MEDIA_ROOT)
        tests = [
            '..&#x2F;test.txt',
            '..&sol;test.txt',
        ]
        for file_name in tests:
            with self.subTest(file_name=file_name):
                payload = client.FakePayload()
                payload.write(
                    '\r\n'.join([
                        '--' + client.BOUNDARY,
                        'Content-Disposition: form-data; name=""my_file""; '
                        'filename=""%s"";' % file_name,
                        'Content-Type: text/plain',
                        '',
                        'file contents.\r\n',
                        '\r\n--' + client.BOUNDARY + '--\r\n',
                    ]),
                )
                r = {
                    'CONTENT_LENGTH': len(payload),
                    'CONTENT_TYPE': client.MULTIPART_CONTENT,
                    'PATH_INFO': '/upload_traversal/',
                    'REQUEST_METHOD': 'POST',
                    'wsgi.input': payload,
                }
                response = self.client.request(**r)
                result = response.json()
                self.assertEqual(response.status_code, 200)
                self.assertEqual(result['file_name'], 'test.txt')
                self.assertIs(
                    os.path.exists(os.path.join(MEDIA_ROOT, 'test.txt')),
                    False,
                )
                self.assertIs(
                    os.path.exists(os.path.join(UPLOAD_TO, 'test.txt')),
                    True,
                )

    def test_sanitize_file_name(self):
        parser = MultiPartParser({
            'CONTENT_TYPE': 'multipart/form-data; boundary=_foo',
            'CONTENT_LENGTH': '1'
        }, StringIO('x'), [], 'utf-8')
        for file_name in CANDIDATE_TRAVERSAL_FILE_NAMES:
            with self.subTest(file_name=file_name):
                self.assertEqual(parser.sanitize_file_name(file_name), 'hax0rd.txt')
","        scary_file_names = [
            ""/tmp/hax0rd.txt"",          # Absolute path, *nix-style.
            ""C:\\Windows\\hax0rd.txt"",  # Absolute path, win-style.
            ""C:/Windows/hax0rd.txt"",    # Absolute path, broken-style.
            ""\\tmp\\hax0rd.txt"",        # Absolute path, broken in a different way.
            ""/tmp\\hax0rd.txt"",         # Absolute path, broken by mixing.
            ""subdir/hax0rd.txt"",        # Descendant path, *nix-style.
            ""subdir\\hax0rd.txt"",       # Descendant path, win-style.
            ""sub/dir\\hax0rd.txt"",      # Descendant path, mixed.
            ""../../hax0rd.txt"",         # Relative path, *nix-style.
            ""..\\..\\hax0rd.txt"",       # Relative path, win-style.
            ""../..\\hax0rd.txt""         # Relative path, mixed.
        ]

        for i, name in enumerate(scary_file_names):
        for i, name in enumerate(scary_file_names):",cca0d98118cccf9ae0c6dcf2d6c57fc50469fbf0,CVE-2021-28658,cca0d98118cccf9ae0c6dcf2d6c57fc50469fbf0,https://github.com/django/django,GHSD_REGISTRY,88,COMPLETED,"VAR = [ '/VAR/VAR.VAR',  'VAR:\\VAR\\VAR.VAR',  'VAR:/VAR/VAR.VAR',  '\\VAR\\VAR.VAR',  '/VAR\\VAR.VAR',  'VAR/VAR.VAR',  'VAR\\VAR.VAR',  'VAR/VAR\\VAR.VAR',  '../../VAR.VAR',  '..\\..\\VAR.VAR',  '../..\\VAR.VAR',  '..& '..&VAR;VAR.VAR',  ] VAR VAR, VAR VAR VAR(VAR): VAR VAR, VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR(VAR, VAR=VAR) VAR.VAR(VAR.VAR, VAR) VAR = [ '..& '..&VAR;VAR.VAR', ] VAR VAR VAR VAR: VAR VAR.VAR(VAR=VAR): VAR = VAR.VAR() VAR.VAR( '\VAR\VAR'.VAR([ '--' + VAR.VAR, 'VAR-VAR: VAR-VAR; VAR=""VAR""; ' 'VAR=""%VAR"";' % VAR, 'VAR-VAR: VAR/VAR', '', 'VAR VAR.\VAR\VAR', '\VAR\VAR--' + VAR.VAR + '--\VAR\VAR', ]), ) VAR = { 'VAR': VAR(VAR), 'VAR': VAR.VAR, 'VAR': '/VAR/', 'VAR': 'VAR', 'VAR.VAR': VAR, } VAR = VAR.VAR.VAR(**VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR['VAR'], 'VAR.VAR') VAR.VAR( VAR.VAR.VAR(VAR.VAR.VAR(VAR, 'VAR.VAR')), VAR, ) VAR.VAR( VAR.VAR.VAR(VAR.VAR.VAR(VAR, 'VAR.VAR')), VAR, ) VAR VAR(VAR): VAR = VAR({ 'VAR': 'VAR/VAR-VAR; VAR=VAR', 'VAR': '1' }, VAR('VAR'), [], 'VAR-8') VAR VAR VAR VAR: VAR VAR.VAR(VAR=VAR): VAR.VAR(VAR.VAR(VAR), 'VAR.VAR') VAR = [ ""/VAR/VAR.VAR"",  ""VAR:\\VAR\\VAR.VAR"",  ""VAR:/VAR/VAR.VAR"",  ""\\VAR\\VAR.VAR"",  ""/VAR\\VAR.VAR"",  ""VAR/VAR.VAR"",  ""VAR\\VAR.VAR"",  ""VAR/VAR\\VAR.VAR"",  ""../../VAR.VAR"",  ""..\\..\\VAR.VAR"",  ""../..\\VAR.VAR""  ] VAR VAR, VAR VAR VAR(VAR): VAR VAR, VAR VAR VAR(VAR):",8,1
django_d4d800ca1addc4141e03c5440a849bb64d1582cd,tests/file_uploads/tests.py,"CANDIDATE_TRAVERSAL_FILE_NAMES = [
    '/tmp/hax0rd.txt',          # Absolute path, *nix-style.
    'C:\\Windows\\hax0rd.txt',  # Absolute path, win-style.
    'C:/Windows/hax0rd.txt',    # Absolute path, broken-style.
    '\\tmp\\hax0rd.txt',        # Absolute path, broken in a different way.
    '/tmp\\hax0rd.txt',         # Absolute path, broken by mixing.
    'subdir/hax0rd.txt',        # Descendant path, *nix-style.
    'subdir\\hax0rd.txt',       # Descendant path, win-style.
    'sub/dir\\hax0rd.txt',      # Descendant path, mixed.
    '../../hax0rd.txt',         # Relative path, *nix-style.
    '..\\..\\hax0rd.txt',       # Relative path, win-style.
    '../..\\hax0rd.txt',        # Relative path, mixed.
    '..&#x2F;hax0rd.txt',       # HTML entities.
    '..&sol;hax0rd.txt',        # HTML entities.
]

        for i, name in enumerate(CANDIDATE_TRAVERSAL_FILE_NAMES):
        for i, name in enumerate(CANDIDATE_TRAVERSAL_FILE_NAMES):
    def test_filename_traversal_upload(self):
        os.makedirs(UPLOAD_TO, exist_ok=True)
        self.addCleanup(shutil.rmtree, MEDIA_ROOT)
        tests = [
            '..&#x2F;test.txt',
            '..&sol;test.txt',
        ]
        for file_name in tests:
            with self.subTest(file_name=file_name):
                payload = client.FakePayload()
                payload.write(
                    '\r\n'.join([
                        '--' + client.BOUNDARY,
                        'Content-Disposition: form-data; name=""my_file""; '
                        'filename=""%s"";' % file_name,
                        'Content-Type: text/plain',
                        '',
                        'file contents.\r\n',
                        '\r\n--' + client.BOUNDARY + '--\r\n',
                    ]),
                )
                r = {
                    'CONTENT_LENGTH': len(payload),
                    'CONTENT_TYPE': client.MULTIPART_CONTENT,
                    'PATH_INFO': '/upload_traversal/',
                    'REQUEST_METHOD': 'POST',
                    'wsgi.input': payload,
                }
                response = self.client.request(**r)
                result = response.json()
                self.assertEqual(response.status_code, 200)
                self.assertEqual(result['file_name'], 'test.txt')
                self.assertIs(
                    os.path.exists(os.path.join(MEDIA_ROOT, 'test.txt')),
                    False,
                )
                self.assertIs(
                    os.path.exists(os.path.join(UPLOAD_TO, 'test.txt')),
                    True,
                )

    def test_sanitize_file_name(self):
        parser = MultiPartParser({
            'CONTENT_TYPE': 'multipart/form-data; boundary=_foo',
            'CONTENT_LENGTH': '1'
        }, StringIO('x'), [], 'utf-8')
        for file_name in CANDIDATE_TRAVERSAL_FILE_NAMES:
            with self.subTest(file_name=file_name):
                self.assertEqual(parser.sanitize_file_name(file_name), 'hax0rd.txt')
","        scary_file_names = [
            ""/tmp/hax0rd.txt"",          # Absolute path, *nix-style.
            ""C:\\Windows\\hax0rd.txt"",  # Absolute path, win-style.
            ""C:/Windows/hax0rd.txt"",    # Absolute path, broken-style.
            ""\\tmp\\hax0rd.txt"",        # Absolute path, broken in a different way.
            ""/tmp\\hax0rd.txt"",         # Absolute path, broken by mixing.
            ""subdir/hax0rd.txt"",        # Descendant path, *nix-style.
            ""subdir\\hax0rd.txt"",       # Descendant path, win-style.
            ""sub/dir\\hax0rd.txt"",      # Descendant path, mixed.
            ""../../hax0rd.txt"",         # Relative path, *nix-style.
            ""..\\..\\hax0rd.txt"",       # Relative path, win-style.
            ""../..\\hax0rd.txt""         # Relative path, mixed.
        ]

        for i, name in enumerate(scary_file_names):
        for i, name in enumerate(scary_file_names):",d4d800ca1addc4141e03c5440a849bb64d1582cd,CVE-2021-28658,d4d800ca1addc4141e03c5440a849bb64d1582cd,https://github.com/django/django,GHSD_REGISTRY,152,COMPLETED,"VAR = [ '/VAR/VAR.VAR',  'VAR:\\VAR\\VAR.VAR',  'VAR:/VAR/VAR.VAR',  '\\VAR\\VAR.VAR',  '/VAR\\VAR.VAR',  'VAR/VAR.VAR',  'VAR\\VAR.VAR',  'VAR/VAR\\VAR.VAR',  '../../VAR.VAR',  '..\\..\\VAR.VAR',  '../..\\VAR.VAR',  '..& '..&VAR;VAR.VAR',  ] VAR VAR, VAR VAR VAR(VAR): VAR VAR, VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR(VAR, VAR=VAR) VAR.VAR(VAR.VAR, VAR) VAR = [ '..& '..&VAR;VAR.VAR', ] VAR VAR VAR VAR: VAR VAR.VAR(VAR=VAR): VAR = VAR.VAR() VAR.VAR( '\VAR\VAR'.VAR([ '--' + VAR.VAR, 'VAR-VAR: VAR-VAR; VAR=""VAR""; ' 'VAR=""%VAR"";' % VAR, 'VAR-VAR: VAR/VAR', '', 'VAR VAR.\VAR\VAR', '\VAR\VAR--' + VAR.VAR + '--\VAR\VAR', ]), ) VAR = { 'VAR': VAR(VAR), 'VAR': VAR.VAR, 'VAR': '/VAR/', 'VAR': 'VAR', 'VAR.VAR': VAR, } VAR = VAR.VAR.VAR(**VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR['VAR'], 'VAR.VAR') VAR.VAR( VAR.VAR.VAR(VAR.VAR.VAR(VAR, 'VAR.VAR')), VAR, ) VAR.VAR( VAR.VAR.VAR(VAR.VAR.VAR(VAR, 'VAR.VAR')), VAR, ) VAR VAR(VAR): VAR = VAR({ 'VAR': 'VAR/VAR-VAR; VAR=VAR', 'VAR': '1' }, VAR('VAR'), [], 'VAR-8') VAR VAR VAR VAR: VAR VAR.VAR(VAR=VAR): VAR.VAR(VAR.VAR(VAR), 'VAR.VAR') VAR = [ ""/VAR/VAR.VAR"",  ""VAR:\\VAR\\VAR.VAR"",  ""VAR:/VAR/VAR.VAR"",  ""\\VAR\\VAR.VAR"",  ""/VAR\\VAR.VAR"",  ""VAR/VAR.VAR"",  ""VAR\\VAR.VAR"",  ""VAR/VAR\\VAR.VAR"",  ""../../VAR.VAR"",  ""..\\..\\VAR.VAR"",  ""../..\\VAR.VAR""  ] VAR VAR, VAR VAR VAR(VAR): VAR VAR, VAR VAR VAR(VAR):",8,1
django_e35a0c56086924f331e9422daa266e907a4784cc,docs/releases/1.10.8.txt,"
CVE-2017-12794: Possible XSS in traceback section of technical 500 debug page
=============================================================================

In older versions, HTML autoescaping was disabled in a portion of the template
for the technical 500 debug page. Given the right circumstances, this allowed
a cross-site scripting attack. This vulnerability shouldn't affect most
production sites since you shouldn't run with ``DEBUG = True`` (which makes
this page accessible) in your production settings.",,e35a0c56086924f331e9422daa266e907a4784cc,CVE-2017-12794,e35a0c56086924f331e9422daa266e907a4784cc,https://github.com/django/django,GHSD_REGISTRY,84,COMPLETED,"VAR-2017-12794: VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR ============================================================================= VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR. VAR VAR VAR VAR, VAR VAR VAR VAR-VAR VAR VAR. VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR ``VAR = VAR`` (VAR VAR VAR VAR VAR) VAR VAR VAR VAR. ",0,1
django_e35a0c56086924f331e9422daa266e907a4784cc,docs/releases/1.11.5.txt,"CVE-2017-12794: Possible XSS in traceback section of technical 500 debug page
=============================================================================

In older versions, HTML autoescaping was disabled in a portion of the template
for the technical 500 debug page. Given the right circumstances, this allowed
a cross-site scripting attack. This vulnerability shouldn't affect most
production sites since you shouldn't run with ``DEBUG = True`` (which makes
this page accessible) in your production settings.
",,e35a0c56086924f331e9422daa266e907a4784cc,CVE-2017-12794,e35a0c56086924f331e9422daa266e907a4784cc,https://github.com/django/django,GHSD_REGISTRY,84,COMPLETED,"VAR-2017-12794: VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR ============================================================================= VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR 500 VAR VAR. VAR VAR VAR VAR, VAR VAR VAR VAR-VAR VAR VAR. VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR ``VAR = VAR`` (VAR VAR VAR VAR VAR) VAR VAR VAR VAR. ",0,1
django_e7fba62248f604c76da4f23dcf1db4a57b0808ea,tests/file_uploads/tests.py,"CANDIDATE_TRAVERSAL_FILE_NAMES = [
    '/tmp/hax0rd.txt',          # Absolute path, *nix-style.
    'C:\\Windows\\hax0rd.txt',  # Absolute path, win-style.
    'C:/Windows/hax0rd.txt',    # Absolute path, broken-style.
    '\\tmp\\hax0rd.txt',        # Absolute path, broken in a different way.
    '/tmp\\hax0rd.txt',         # Absolute path, broken by mixing.
    'subdir/hax0rd.txt',        # Descendant path, *nix-style.
    'subdir\\hax0rd.txt',       # Descendant path, win-style.
    'sub/dir\\hax0rd.txt',      # Descendant path, mixed.
    '../../hax0rd.txt',         # Relative path, *nix-style.
    '..\\..\\hax0rd.txt',       # Relative path, win-style.
    '../..\\hax0rd.txt',        # Relative path, mixed.
    '..&#x2F;hax0rd.txt',       # HTML entities.
    '..&sol;hax0rd.txt',        # HTML entities.
]

        for i, name in enumerate(CANDIDATE_TRAVERSAL_FILE_NAMES):
        for i, name in enumerate(CANDIDATE_TRAVERSAL_FILE_NAMES):
    def test_filename_traversal_upload(self):
        os.makedirs(UPLOAD_TO, exist_ok=True)
        self.addCleanup(shutil.rmtree, MEDIA_ROOT)
        tests = [
            '..&#x2F;test.txt',
            '..&sol;test.txt',
        ]
        for file_name in tests:
            with self.subTest(file_name=file_name):
                payload = client.FakePayload()
                payload.write(
                    '\r\n'.join([
                        '--' + client.BOUNDARY,
                        'Content-Disposition: form-data; name=""my_file""; '
                        'filename=""%s"";' % file_name,
                        'Content-Type: text/plain',
                        '',
                        'file contents.\r\n',
                        '\r\n--' + client.BOUNDARY + '--\r\n',
                    ]),
                )
                r = {
                    'CONTENT_LENGTH': len(payload),
                    'CONTENT_TYPE': client.MULTIPART_CONTENT,
                    'PATH_INFO': '/upload_traversal/',
                    'REQUEST_METHOD': 'POST',
                    'wsgi.input': payload,
                }
                response = self.client.request(**r)
                result = response.json()
                self.assertEqual(response.status_code, 200)
                self.assertEqual(result['file_name'], 'test.txt')
                self.assertIs(
                    os.path.exists(os.path.join(MEDIA_ROOT, 'test.txt')),
                    False,
                )
                self.assertIs(
                    os.path.exists(os.path.join(UPLOAD_TO, 'test.txt')),
                    True,
                )

    def test_sanitize_file_name(self):
        parser = MultiPartParser({
            'CONTENT_TYPE': 'multipart/form-data; boundary=_foo',
            'CONTENT_LENGTH': '1'
        }, StringIO('x'), [], 'utf-8')
        for file_name in CANDIDATE_TRAVERSAL_FILE_NAMES:
            with self.subTest(file_name=file_name):
                self.assertEqual(parser.sanitize_file_name(file_name), 'hax0rd.txt')
","        scary_file_names = [
            ""/tmp/hax0rd.txt"",          # Absolute path, *nix-style.
            ""C:\\Windows\\hax0rd.txt"",  # Absolute path, win-style.
            ""C:/Windows/hax0rd.txt"",    # Absolute path, broken-style.
            ""\\tmp\\hax0rd.txt"",        # Absolute path, broken in a different way.
            ""/tmp\\hax0rd.txt"",         # Absolute path, broken by mixing.
            ""subdir/hax0rd.txt"",        # Descendant path, *nix-style.
            ""subdir\\hax0rd.txt"",       # Descendant path, win-style.
            ""sub/dir\\hax0rd.txt"",      # Descendant path, mixed.
            ""../../hax0rd.txt"",         # Relative path, *nix-style.
            ""..\\..\\hax0rd.txt"",       # Relative path, win-style.
            ""../..\\hax0rd.txt""         # Relative path, mixed.
        ]

        for i, name in enumerate(scary_file_names):
        for i, name in enumerate(scary_file_names):",e7fba62248f604c76da4f23dcf1db4a57b0808ea,CVE-2021-28658,e7fba62248f604c76da4f23dcf1db4a57b0808ea,https://github.com/django/django,GHSD_REGISTRY,88,COMPLETED,"VAR = [ '/VAR/VAR.VAR',  'VAR:\\VAR\\VAR.VAR',  'VAR:/VAR/VAR.VAR',  '\\VAR\\VAR.VAR',  '/VAR\\VAR.VAR',  'VAR/VAR.VAR',  'VAR\\VAR.VAR',  'VAR/VAR\\VAR.VAR',  '../../VAR.VAR',  '..\\..\\VAR.VAR',  '../..\\VAR.VAR',  '..& '..&VAR;VAR.VAR',  ] VAR VAR, VAR VAR VAR(VAR): VAR VAR, VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR(VAR, VAR=VAR) VAR.VAR(VAR.VAR, VAR) VAR = [ '..& '..&VAR;VAR.VAR', ] VAR VAR VAR VAR: VAR VAR.VAR(VAR=VAR): VAR = VAR.VAR() VAR.VAR( '\VAR\VAR'.VAR([ '--' + VAR.VAR, 'VAR-VAR: VAR-VAR; VAR=""VAR""; ' 'VAR=""%VAR"";' % VAR, 'VAR-VAR: VAR/VAR', '', 'VAR VAR.\VAR\VAR', '\VAR\VAR--' + VAR.VAR + '--\VAR\VAR', ]), ) VAR = { 'VAR': VAR(VAR), 'VAR': VAR.VAR, 'VAR': '/VAR/', 'VAR': 'VAR', 'VAR.VAR': VAR, } VAR = VAR.VAR.VAR(**VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR['VAR'], 'VAR.VAR') VAR.VAR( VAR.VAR.VAR(VAR.VAR.VAR(VAR, 'VAR.VAR')), VAR, ) VAR.VAR( VAR.VAR.VAR(VAR.VAR.VAR(VAR, 'VAR.VAR')), VAR, ) VAR VAR(VAR): VAR = VAR({ 'VAR': 'VAR/VAR-VAR; VAR=VAR', 'VAR': '1' }, VAR('VAR'), [], 'VAR-8') VAR VAR VAR VAR: VAR VAR.VAR(VAR=VAR): VAR.VAR(VAR.VAR(VAR), 'VAR.VAR') VAR = [ ""/VAR/VAR.VAR"",  ""VAR:\\VAR\\VAR.VAR"",  ""VAR:/VAR/VAR.VAR"",  ""\\VAR\\VAR.VAR"",  ""/VAR\\VAR.VAR"",  ""VAR/VAR.VAR"",  ""VAR\\VAR.VAR"",  ""VAR/VAR\\VAR.VAR"",  ""../../VAR.VAR"",  ""..\\..\\VAR.VAR"",  ""../..\\VAR.VAR""  ] VAR VAR, VAR VAR VAR(VAR): VAR VAR, VAR VAR VAR(VAR):",8,1
dolibarr_489cff46a37b04784d8e884af7fc2ad623bee17d,htdocs/user/class/api_users.class.php,"		$obj_ret = array();

		if (empty(DolibarrApiAccess::$user->rights->user->user->lire)) {
			throw new RestException(401, 'Not allowed');
		}

		if (empty(DolibarrApiAccess::$user->rights->user->user->lire)) {
			throw new RestException(401, 'Not allowed');
		}
		if (empty(DolibarrApiAccess::$user->rights->user->user->lire)) {
			throw new RestException(401, 'Not allowed');
		}
	 * Get more properties of a user
	 * @param	int			$includepermissions	Set this to 1 to have the array of permissions loaded (not done by default for performance purpose)
	 * @return  array|mixed 					Data without useless information
		if (empty(DolibarrApiAccess::$user->rights->user->user->lire)) {
			throw new RestException(401, 'Not allowed');
		}

	 *
	 * @throws RestException 401 Not allowed
		// Check user authorization
		if (empty(DolibarrApiAccess::$user->rights->user->creer)) {
			throw new RestException(401, ""User creation not allowed"");
		}


			if (in_array($field, array('pass_crypted', 'pass_indatabase', 'pass_indatabase_crypted', 'pass_temp', 'api_key'))) {
				// This properties can't be set/modified with API
				throw new RestException(401, 'The property '.$field."" can't be set/modified using the APIs"");
				continue;
			}
			/*if ($field == 'pass') {
				if (empty(DolibarrApiAccess::$user->rights->user->user->password)) {
					throw new RestException(401, 'You are not allowed to modify/set password of other users');
					continue;
				}
			}
			*/

			$this->useraccount->$field = $value;
	 * Update user account
		// Check user authorization
		if (empty(DolibarrApiAccess::$user->rights->user->creer)) {
			throw new RestException(401, ""User update not allowed"");
		}
			if (in_array($field, array('pass_crypted', 'pass_indatabase', 'pass_indatabase_crypted', 'pass_temp', 'api_key'))) {
				// This properties can't be set/modified with API
				throw new RestException(401, 'The property '.$field."" can't be set/modified using the APIs"");
				continue;
			}
			if ($field == 'pass') {
				if ($this->useraccount->id != DolibarrApiAccess::$user->id && empty(DolibarrApiAccess::$user->rights->user->user->password)) {
					throw new RestException(401, 'You are not allowed to modify password of other users');
					continue;
				}
				if ($this->useraccount->id == DolibarrApiAccess::$user->id && empty(DolibarrApiAccess::$user->rights->user->self->password)) {
					throw new RestException(401, 'You are not allowed to modify your own password');
					continue;
				}
			}
			if (DolibarrApiAccess::$user->admin) {	// If user for API is admin
				if ($field == 'admin' && $value != $this->useraccount->admin && empty($value)) {
					throw new RestException(401, 'Reseting the admin status of a user is not possible using the API');
				}
			} else {
				if ($field == 'admin' && $value != $this->useraccount->admin) {
					throw new RestException(401, 'Only an admin user can modify the admin status of another user');
				}
			}
			if ($field == 'entity' && $value != $this->useraccount->entity) {
				throw new RestException(401, 'Changing entity of a user using the APIs is not possible');
			}
		$obj_ret = array();

	 * @throws RestException 401 Not allowed
	 * @throws RestException 404 User not found
	 * @throws RestException 500 Error
	 *
		if (empty(DolibarrApiAccess::$user->rights->user->user->creer)) {
			throw new RestException(401);
		}

	 *
	 * @throws RestException 404 User not found
	 * @throws RestException 503 Error
		if ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty(DolibarrApiAccess::$user->rights->user->user->lire)) ||
			!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty(DolibarrApiAccess::$user->rights->user->group_advance->read)) {
			throw new RestException(401, ""You are not allowed to read groups"");
	 *
	 * @throws RestException 401 Not allowed
	 * @throws RestException 404 User not found
		if ((empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty(DolibarrApiAccess::$user->rights->user->user->lire)) ||
			!empty($conf->global->MAIN_USE_ADVANCED_PERMS) && empty(DolibarrApiAccess::$user->rights->user->group_advance->read)) {
	 * Delete account/user
	 *
	 * @throws RestException 401 Not allowed
	 * @throws RestException 404 User not found
		if (empty(DolibarrApiAccess::$user->rights->user->user->supprimer)) {
			throw new RestException(401, 'Not allowed');
		}","	 *
		$obj_ret = array();

		//if (!DolibarrApiAccess::$user->rights->user->user->lire) {
			//throw new RestException(401);
		//}
		//if (!DolibarrApiAccess::$user->rights->user->user->lire) {
			//throw new RestException(401);
		//}
		//if (!DolibarrApiAccess::$user->rights->user->user->lire) {
			//throw new RestException(401);
		//}
	 * Get properties of user connected
	 * @param	int		$includepermissions	Set this to 1 to have the array of permissions loaded (not done by default for performance purpose)
	 * @return  array|mixed Data without useless information
		// check user authorization
		//if(! DolibarrApiAccess::$user->rights->user->creer) {
		//   throw new RestException(401, ""User creation not allowed"");
		//}
			  $this->useraccount->$field = $value;
	 * Update account
		//if (!DolibarrApiAccess::$user->rights->user->user->creer) {
			//throw new RestException(401);
		//}
		$obj_ret = array();


		//if (!DolibarrApiAccess::$user->rights->user->user->supprimer) {
			//throw new RestException(401);
		//}
		if (!DolibarrApiAccess::$user->rights->user->group_advance->read) {
			throw new RestException(401, ""You are not allowed to read list of groups"");
		if (!DolibarrApiAccess::$user->rights->user->group_advance->read) {
	 * Delete account
		//if (!DolibarrApiAccess::$user->rights->user->user->supprimer) {
			//throw new RestException(401);
		//}",489cff46a37b04784d8e884af7fc2ad623bee17d,CVE-2022-43138,489cff46a37b04784d8e884af7fc2ad623bee17d,https://github.com/Dolibarr/dolibarr,GHSD_DIRECT_COMMIT,1337,COMPLETED,"$VAR = VAR(); VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR'); } VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR'); } VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR'); } * VAR VAR VAR VAR VAR VAR * @VAR VAR $VAR VAR VAR VAR 1 VAR VAR VAR VAR VAR VAR VAR (VAR VAR VAR VAR VAR VAR VAR) * @VAR VAR|VAR VAR VAR VAR VAR VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR'); } * * @VAR VAR 401 VAR VAR  VAR (VAR(VAR::$VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, ""VAR VAR VAR VAR""); } VAR (VAR($VAR, VAR('VAR', 'VAR', 'VAR', 'VAR', 'VAR'))) {  VAR VAR VAR(401, 'VAR VAR '.$VAR."" VAR'VAR VAR VAR/VAR VAR VAR VAR""); VAR; } /*VAR ($VAR == 'VAR') { VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR VAR VAR VAR VAR/VAR VAR VAR VAR VAR'); VAR; } } */ $VAR->VAR->$VAR = $VAR; * VAR VAR VAR  VAR (VAR(VAR::$VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, ""VAR VAR VAR VAR""); } VAR (VAR($VAR, VAR('VAR', 'VAR', 'VAR', 'VAR', 'VAR'))) {  VAR VAR VAR(401, 'VAR VAR '.$VAR."" VAR'VAR VAR VAR/VAR VAR VAR VAR""); VAR; } VAR ($VAR == 'VAR') { VAR ($VAR->VAR->VAR != VAR::$VAR->VAR && VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'); VAR; } VAR ($VAR->VAR->VAR == VAR::$VAR->VAR && VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR VAR VAR VAR VAR VAR VAR VAR'); VAR; } } VAR (VAR::$VAR->VAR) {  VAR ($VAR == 'VAR' && $VAR != $VAR->VAR->VAR && VAR($VAR)) { VAR VAR VAR(401, 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'); } } VAR { VAR ($VAR == 'VAR' && $VAR != $VAR->VAR->VAR) { VAR VAR VAR(401, 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'); } } VAR ($VAR == 'VAR' && $VAR != $VAR->VAR->VAR) { VAR VAR VAR(401, 'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR'); } $VAR = VAR(); * @VAR VAR 401 VAR VAR * @VAR VAR 404 VAR VAR VAR * @VAR VAR 500 VAR * VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401); } * * @VAR VAR 404 VAR VAR VAR * @VAR VAR 503 VAR VAR ((VAR($VAR->VAR->VAR) && VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) || !VAR($VAR->VAR->VAR) && VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, ""VAR VAR VAR VAR VAR VAR VAR""); * * @VAR VAR 401 VAR VAR * @VAR VAR 404 VAR VAR VAR VAR ((VAR($VAR->VAR->VAR) && VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) || !VAR($VAR->VAR->VAR) && VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { * VAR VAR/VAR * * @VAR VAR 401 VAR VAR * @VAR VAR 404 VAR VAR VAR VAR (VAR(VAR::$VAR->VAR->VAR->VAR->VAR)) { VAR VAR VAR(401, 'VAR VAR'); } * $VAR = VAR();          * VAR VAR VAR VAR VAR * @VAR VAR $VAR VAR VAR VAR 1 VAR VAR VAR VAR VAR VAR VAR (VAR VAR VAR VAR VAR VAR VAR) * @VAR VAR|VAR VAR VAR VAR VAR     $VAR->VAR->$VAR = $VAR; * VAR VAR    $VAR = VAR();    VAR (!VAR::$VAR->VAR->VAR->VAR->VAR) { VAR VAR VAR(401, ""VAR VAR VAR VAR VAR VAR VAR VAR VAR""); VAR (!VAR::$VAR->VAR->VAR->VAR->VAR) { * VAR VAR   ",0,1
envoy_2c60632d41555ec8b3d9ef5246242be637a2db0f,test/extensions/filters/http/rbac/rbac_filter_integration_test.cc,"const std::string RBAC_CONFIG_HEADER_MATCH_CONDITION = R""EOF(
name: rbac
typed_config:
  ""@type"": type.googleapis.com/envoy.extensions.filters.http.rbac.v3.RBAC
  rules:
    policies:
      foo:
        permissions:
          - any: true
        principals:
          - any: true
        condition:
          call_expr:
            function: _==_
            args:
            - select_expr:
                operand:
                  select_expr:
                    operand:
                      ident_expr:
                        name: request
                    field: headers
                field: xxx
            - const_expr:
               string_value: {}
)EOF"";

// Basic CEL match on a header value.
TEST_P(RBACIntegrationTest, HeaderMatchCondition) {
  config_helper_.addFilter(fmt::format(RBAC_CONFIG_HEADER_MATCH_CONDITION, ""yyy""));
  initialize();

  codec_client_ = makeHttpConnection(lookupPort(""http""));

  auto response = codec_client_->makeRequestWithBody(
      Http::TestRequestHeaderMapImpl{
          {"":method"", ""POST""},
          {"":path"", ""/path""},
          {"":scheme"", ""http""},
          {"":authority"", ""host""},
          {""xxx"", ""yyy""},
      },
      1024);
  waitForNextUpstreamRequest();
  upstream_request_->encodeHeaders(Http::TestResponseHeaderMapImpl{{"":status"", ""200""}}, true);

  response->waitForEndStream();
  ASSERT_TRUE(response->complete());
  EXPECT_EQ(""200"", response->headers().getStatusValue());
}

// CEL match on a header value in which the header is a duplicate. Verifies we handle string
// copying correctly inside the CEL expression.
TEST_P(RBACIntegrationTest, HeaderMatchConditionDuplicateHeaderNoMatch) {
  config_helper_.addFilter(fmt::format(RBAC_CONFIG_HEADER_MATCH_CONDITION, ""yyy""));
  initialize();

  codec_client_ = makeHttpConnection(lookupPort(""http""));

  auto response = codec_client_->makeRequestWithBody(
      Http::TestRequestHeaderMapImpl{
          {"":method"", ""POST""},
          {"":path"", ""/path""},
          {"":scheme"", ""http""},
          {"":authority"", ""host""},
          {""xxx"", ""yyy""},
          {""xxx"", ""zzz""},
      },
      1024);
  response->waitForEndStream();
  ASSERT_TRUE(response->complete());
  EXPECT_EQ(""403"", response->headers().getStatusValue());
}

// CEL match on a header value in which the header is a duplicate. Verifies we handle string
// copying correctly inside the CEL expression.
TEST_P(RBACIntegrationTest, HeaderMatchConditionDuplicateHeaderMatch) {
  config_helper_.addFilter(fmt::format(RBAC_CONFIG_HEADER_MATCH_CONDITION, ""yyy,zzz""));
  initialize();

  codec_client_ = makeHttpConnection(lookupPort(""http""));

  auto response = codec_client_->makeRequestWithBody(
      Http::TestRequestHeaderMapImpl{
          {"":method"", ""POST""},
          {"":path"", ""/path""},
          {"":scheme"", ""http""},
          {"":authority"", ""host""},
          {""xxx"", ""yyy""},
          {""xxx"", ""zzz""},
      },
      1024);
  waitForNextUpstreamRequest();
  upstream_request_->encodeHeaders(Http::TestResponseHeaderMapImpl{{"":status"", ""200""}}, true);

  response->waitForEndStream();
  ASSERT_TRUE(response->complete());
  EXPECT_EQ(""200"", response->headers().getStatusValue());
}
",,2c60632d41555ec8b3d9ef5246242be637a2db0f,CVE-2020-25017,2c60632d41555ec8b3d9ef5246242be637a2db0f,https://github.com/envoyproxy/envoy,NVD_GIT_REPOBASED,102,COMPLETED,"VAR VAR::VAR VAR = VAR""VAR( VAR: VAR VAR: ""@VAR"": VAR.VAR.VAR/VAR.VAR.VAR.VAR.VAR.VAR.VAR VAR: VAR: VAR: VAR: - VAR: VAR VAR: - VAR: VAR VAR: VAR: VAR: VAR==VAR VAR: - VAR: VAR: VAR: VAR: VAR: VAR: VAR VAR: VAR VAR: VAR - VAR: VAR: {} )VAR"";  VAR(VAR, VAR) { VAR.VAR(VAR::VAR(VAR, ""VAR"")); VAR(); VAR = VAR(VAR(""VAR"")); VAR VAR = VAR->VAR( VAR::VAR{ {"":VAR"", ""VAR""}, {"":VAR"", ""/VAR""}, {"":VAR"", ""VAR""}, {"":VAR"", ""VAR""}, {""VAR"", ""VAR""}, }, 1024); VAR(); VAR->VAR(VAR::VAR{{"":VAR"", ""200""}}, VAR); VAR->VAR(); VAR(VAR->VAR()); VAR(""200"", VAR->VAR().VAR()); }   VAR(VAR, VAR) { VAR.VAR(VAR::VAR(VAR, ""VAR"")); VAR(); VAR = VAR(VAR(""VAR"")); VAR VAR = VAR->VAR( VAR::VAR{ {"":VAR"", ""VAR""}, {"":VAR"", ""/VAR""}, {"":VAR"", ""VAR""}, {"":VAR"", ""VAR""}, {""VAR"", ""VAR""}, {""VAR"", ""VAR""}, }, 1024); VAR->VAR(); VAR(VAR->VAR()); VAR(""403"", VAR->VAR().VAR()); }   VAR(VAR, VAR) { VAR.VAR(VAR::VAR(VAR, ""VAR,VAR"")); VAR(); VAR = VAR(VAR(""VAR"")); VAR VAR = VAR->VAR( VAR::VAR{ {"":VAR"", ""VAR""}, {"":VAR"", ""/VAR""}, {"":VAR"", ""VAR""}, {"":VAR"", ""VAR""}, {""VAR"", ""VAR""}, {""VAR"", ""VAR""}, }, 1024); VAR(); VAR->VAR(VAR::VAR{{"":VAR"", ""200""}}, VAR); VAR->VAR(); VAR(VAR->VAR()); VAR(""200"", VAR->VAR().VAR()); } ",8,1
envoy_65c05cad96db7f7874e1e5a2b70829dcfad10e88,test/common/http/conn_manager_impl_test.cc,"      ssl_connection_ = std::make_unique<Ssl::MockConnectionInfo>();
  std::unique_ptr<Ssl::MockConnectionInfo> ssl_connection_;
TEST_F(HttpConnectionManagerImplTest, TestAccessLogSsl) {
  setup(true, """");

  std::shared_ptr<MockStreamDecoderFilter> filter(new NiceMock<MockStreamDecoderFilter>());
  std::shared_ptr<AccessLog::MockInstance> handler(new NiceMock<AccessLog::MockInstance>());

  EXPECT_CALL(filter_factory_, createFilterChain(_))
      .WillOnce(Invoke([&](FilterChainFactoryCallbacks& callbacks) -> void {
        callbacks.addStreamDecoderFilter(filter);
        callbacks.addAccessLogHandler(handler);
      }));

  EXPECT_CALL(*handler, log(_, _, _, _))
      .WillOnce(Invoke([](const HeaderMap*, const HeaderMap*, const HeaderMap*,
                          const StreamInfo::StreamInfo& stream_info) {
        EXPECT_TRUE(stream_info.responseCode());
        EXPECT_EQ(stream_info.responseCode().value(), uint32_t(200));
        EXPECT_NE(nullptr, stream_info.downstreamLocalAddress());
        EXPECT_NE(nullptr, stream_info.downstreamRemoteAddress());
        EXPECT_NE(nullptr, stream_info.downstreamDirectRemoteAddress());
        EXPECT_NE(nullptr, stream_info.downstreamSslConnection());
        EXPECT_NE(nullptr, stream_info.routeEntry());
      }));

  StreamDecoder* decoder = nullptr;
  NiceMock<MockStreamEncoder> encoder;
  EXPECT_CALL(*codec_, dispatch(_)).WillRepeatedly(Invoke([&](Buffer::Instance& data) -> void {
    decoder = &conn_manager_->newStream(encoder);

    HeaderMapPtr headers{
        new TestHeaderMapImpl{{"":method"", ""GET""},
                              {"":authority"", ""host""},
                              {"":path"", ""/""},
                              {""x-request-id"", ""125a4afb-6f55-a4ba-ad80-413f09f48a28""}}};
    decoder->decodeHeaders(std::move(headers), true);

    HeaderMapPtr response_headers{new TestHeaderMapImpl{{"":status"", ""200""}}};
    filter->callbacks_->encodeHeaders(std::move(response_headers), false);

    HeaderMapPtr response_trailers{new TestHeaderMapImpl{{""x-trailer"", ""1""}}};
    filter->callbacks_->encodeTrailers(std::move(response_trailers));

    data.drain(4);
  }));

  Buffer::OwnedImpl fake_input(""1234"");
  conn_manager_->onData(fake_input, false);
}
","      ssl_connection_ = std::make_unique<Ssl::MockConnection>();
  std::unique_ptr<Ssl::MockConnection> ssl_connection_;",65c05cad96db7f7874e1e5a2b70829dcfad10e88,CVE-2019-9900,65c05cad96db7f7874e1e5a2b70829dcfad10e88,https://github.com/envoyproxy/envoy,NVD_GIT_REPOBASED,74,COMPLETED,"VAR = VAR::VAR<VAR::VAR>(); VAR::VAR<VAR::VAR> VAR; VAR(VAR, VAR) { VAR(VAR, """"); VAR::VAR<VAR> VAR(VAR VAR<VAR>()); VAR::VAR<VAR::VAR> VAR(VAR VAR<VAR::VAR>()); VAR(VAR, VAR(VAR)) .VAR(VAR([&](VAR& VAR) -> VAR { VAR.VAR(VAR); VAR.VAR(VAR); })); VAR(*VAR, VAR(VAR, VAR, VAR, VAR)) .VAR(VAR([](VAR VAR*, VAR VAR*, VAR VAR*, VAR VAR::VAR& VAR) { VAR(VAR.VAR()); VAR(VAR.VAR().VAR(), VAR(200)); VAR(VAR, VAR.VAR()); VAR(VAR, VAR.VAR()); VAR(VAR, VAR.VAR()); VAR(VAR, VAR.VAR()); VAR(VAR, VAR.VAR()); })); VAR* VAR = VAR; VAR<VAR> VAR; VAR(*VAR, VAR(VAR)).VAR(VAR([&](VAR::VAR& VAR) -> VAR { VAR = &VAR->VAR(VAR); VAR VAR{ VAR VAR{{"":VAR"", ""VAR""}, {"":VAR"", ""VAR""}, {"":VAR"", ""/""}, {""VAR-VAR-VAR"", ""125a4afb-6f55-VAR-VAR-413f09f48a28""}}}; VAR->VAR(VAR::VAR(VAR), VAR); VAR VAR{VAR VAR{{"":VAR"", ""200""}}}; VAR->VAR->VAR(VAR::VAR(VAR), VAR); VAR VAR{VAR VAR{{""VAR-VAR"", ""1""}}}; VAR->VAR->VAR(VAR::VAR(VAR)); VAR.VAR(4); })); VAR::VAR VAR(""1234""); VAR->VAR(VAR, VAR); } VAR = VAR::VAR<VAR::VAR>(); VAR::VAR<VAR::VAR> VAR;",8,1
glpi_527280358ec78988ac57e9809d2eb21fcd74caf7,tests/functionnal/Glpi/CalDAV/Server.php,"      $login = 'tech';
      $pass  = 'tech';
         'name'    => 'Test group',
         'is_task' => 1,
      $this->login($login, $pass);

   /**
    * Test ACL on main objects.
    */
   public function testAcl() {

      $user  = getItemByTypeName('User', 'tech');

      $group = new \Group();
      $group_id = (int)$group->add([
         'name'    => 'Test group',
         'is_task' => 1,
      ]);
      $this->integer($group_id)->isGreaterThan(0);
      $group->getFromDB($group_id);

      $group_user = new \Group_User();
      $this->integer(
         (int)$group_user->add([
            'groups_id' => $group_id,
            'users_id'  => $user->fields['id'],
         ])
      )->isGreaterThan(0);

      $objects = [
         'principals/users/' . $user->fields['name'],
         'calendars/users/' . $user->fields['name'] . '/calendar/',
         'principals/groups/' . $group_id,
         'calendars/groups/' . $group_id . '/calendar/',
      ];

      $users_access = [
         'normal' => 'HTTP/1.1 403 Forbidden',
         'tech'   => 'HTTP/1.1 200 OK',
      ];

      foreach ($users_access as $username => $expected_status) {
         $this->login($username, $username);

         foreach ($objects as $path) {
            $server = $this->getServerInstance('PROPFIND', $path);

            $this->validateThatAuthenticationIsRequired($server);

            $server->httpRequest->addHeader('Authorization', 'Basic ' . base64_encode($username . ':' . $username));

            $response = new \Sabre\HTTP\Response();
            $server->invokeMethod($server->httpRequest, $response, false);
            $this->validateResponseIsOk($response, 207, 'application/xml'); // 207 'Multi-Status'

            $xpath = $this->getXpathFromResponse($response);
            $result_path = '/d:multistatus/d:response[1]';
            $this->string($xpath->evaluate('string(' . $result_path . '/d:propstat/d:status)'))->isEqualTo($expected_status);
         }
      }
   }

    * @param string|null          $content_type","      $login = TU_USER;
      $pass  = TU_PASS;
      $this->login($login, $pass);

         'name' => 'Test group'",527280358ec78988ac57e9809d2eb21fcd74caf7,CVE-2020-26212,527280358ec78988ac57e9809d2eb21fcd74caf7,https://github.com/glpi-project/glpi,NVD_DIRECT_COMMIT,1337,COMPLETED,"$VAR = 'VAR'; $VAR = 'VAR'; 'VAR' => 'VAR VAR', 'VAR' => 1, $VAR->VAR($VAR, $VAR); /** * VAR VAR VAR VAR VAR. */ VAR VAR VAR() { $VAR = VAR('VAR', 'VAR'); $VAR = VAR \VAR(); $VAR = (VAR)$VAR->VAR([ 'VAR' => 'VAR VAR', 'VAR' => 1, ]); $VAR->VAR($VAR)->VAR(0); $VAR->VAR($VAR); $VAR = VAR \VAR(); $VAR->VAR( (VAR)$VAR->VAR([ 'VAR' => $VAR, 'VAR' => $VAR->VAR['VAR'], ]) )->VAR(0); $VAR = [ 'VAR/VAR/' . $VAR->VAR['VAR'], 'VAR/VAR/' . $VAR->VAR['VAR'] . '/VAR/', 'VAR/VAR/' . $VAR, 'VAR/VAR/' . $VAR . '/VAR/', ]; $VAR = [ 'VAR' => 'VAR/1.1 403 VAR', 'VAR' => 'VAR/1.1 200 VAR', ]; VAR ($VAR VAR $VAR => $VAR) { $VAR->VAR($VAR, $VAR); VAR ($VAR VAR $VAR) { $VAR = $VAR->VAR('VAR', $VAR); $VAR->VAR($VAR); $VAR->VAR->VAR('VAR', 'VAR ' . VAR($VAR . ':' . $VAR)); $VAR = VAR \VAR\VAR\VAR(); $VAR->VAR($VAR->VAR, $VAR, VAR); $VAR->VAR($VAR, 207, 'VAR/VAR');  $VAR = $VAR->VAR($VAR); $VAR = '/VAR:VAR/VAR:VAR[1]'; $VAR->VAR($VAR->VAR('VAR(' . $VAR . '/VAR:VAR/VAR:VAR)'))->VAR($VAR); } } } * @VAR VAR|VAR $VAR $VAR = VAR; $VAR = VAR; $VAR->VAR($VAR, $VAR); 'VAR' => 'VAR VAR'",8,1
go_829c5df58694b3345cb5ea41206783c8ccf5c3ca,src/net/http/fs_test.go,"	c, err := net.Dial(""tcp"", ts.Listener.Addr().String())
	defer c.Close()
	_, err = fmt.Fprintf(c, ""GET /..\x00 HTTP/1.0\r\n\r\n"")
	if err != nil {
		t.Fatal(err)
	}
	var got bytes.Buffer
	bufr := bufio.NewReader(io.TeeReader(c, &got))
	res, err := ReadResponse(bufr, nil)
		t.Fatal(""ReadResponse: "", err)
		t.Errorf(""got status 200; want an error. Body is:\n%s"", got.Bytes())","	res, err := Get(ts.URL + ""/..\x00"")
	b, err := ioutil.ReadAll(res.Body)
		t.Fatal(""reading Body:"", err)
		t.Errorf(""got status 200; want an error. Body is:\n%s"", string(b))",829c5df58694b3345cb5ea41206783c8ccf5c3ca,CVE-2019-9741,829c5df58694b3345cb5ea41206783c8ccf5c3ca,https://github.com/golang/go,NVD_GIT_REPOBASED,86,COMPLETED,"VAR, VAR := VAR.VAR(""VAR"", VAR.VAR.VAR().VAR()) VAR VAR.VAR() VAR, VAR = VAR.VAR(VAR, ""VAR /..\VAR VAR/1.0\VAR\VAR\VAR\VAR"") VAR VAR != VAR { VAR.VAR(VAR) } VAR VAR VAR.VAR VAR := VAR.VAR(VAR.VAR(VAR, &VAR)) VAR, VAR := VAR(VAR, VAR) VAR.VAR(""VAR: "", VAR) VAR.VAR(""VAR VAR 200; VAR VAR VAR. VAR VAR:\VAR%VAR"", VAR.VAR()) VAR, VAR := VAR(VAR.VAR + ""/..\VAR"") VAR, VAR := VAR.VAR(VAR.VAR) VAR.VAR(""VAR VAR:"", VAR) VAR.VAR(""VAR VAR 200; VAR VAR VAR. VAR VAR:\VAR%VAR"", VAR(VAR))",8,1
linux_18a0d89e54ca0f6f33582f99ae39867b2c975559,drivers/video/aty/radeon_pm.c,"static void radeonfb_whack_power_state(struct radeonfb_info *rinfo, pci_power_t state)
{
	u16 pwr_cmd;

	for (;;) {
		pci_read_config_word(rinfo->pdev,
				     rinfo->pm_reg+PCI_PM_CTRL,
				     &pwr_cmd);
		if (pwr_cmd & 2)
			break;
		pwr_cmd = (pwr_cmd & ~PCI_PM_CTRL_STATE_MASK) | 2;
		pci_write_config_word(rinfo->pdev,
				      rinfo->pm_reg+PCI_PM_CTRL,
				      pwr_cmd);
		msleep(500);
	}
	rinfo->pdev->current_state = state;
}

		/* The chip seems to need us to whack the PM register
		 * repeatedly until it sticks. We do that -prior- to
		 * calling pci_set_power_state()
		 */
		radeonfb_whack_power_state(rinfo, PCI_D2);",,18a0d89e54ca0f6f33582f99ae39867b2c975559,CVE-2009-0787,18a0d89e54ca0f6f33582f99ae39867b2c975559,https://github.com/torvalds/linux,CPE_DIRECT_COMMIT,68,COMPLETED,"VAR VAR VAR(VAR VAR *VAR, VAR VAR) { VAR VAR; VAR (;;) { VAR(VAR->VAR, VAR->VAR+VAR, &VAR); VAR (VAR & 2) VAR; VAR = (VAR & ~VAR) | 2; VAR(VAR->VAR, VAR->VAR+VAR, VAR); VAR(500); } VAR->VAR->VAR = VAR; } /* VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR * VAR VAR VAR VAR. VAR VAR VAR -VAR- VAR * VAR VAR() */ VAR(VAR, VAR); ",16,1
linux_7926aff5c57b577ab0f43364ff0c59d968f6a414,drivers/net/usrtl8150.c,"	void *buf;
	int ret;

	buf = kmalloc(size, GFP_NOIO);
	if (!buf)
		return -ENOMEM;

	ret = usb_control_msg(dev->udev, usb_rcvctrlpipe(dev->udev, 0),
			      RTL8150_REQ_GET_REGS, RTL8150_REQT_READ,
			      indx, 0, buf, size, 500);
	if (ret > 0 && ret <= size)
		memcpy(data, buf, ret);
	kfree(buf);
	return ret;
static int set_registers(rtl8150_t * dev, u16 indx, u16 size, const void *data)
	void *buf;
	int ret;

	buf = kmemdup(data, size, GFP_NOIO);
	if (!buf)
		return -ENOMEM;

	ret = usb_control_msg(dev->udev, usb_sndctrlpipe(dev->udev, 0),
			      RTL8150_REQ_SET_REGS, RTL8150_REQT_WRITE,
			      indx, 0, buf, size, 500);
	kfree(buf);
	return ret;","	return usb_control_msg(dev->udev, usb_rcvctrlpipe(dev->udev, 0),
			       RTL8150_REQ_GET_REGS, RTL8150_REQT_READ,
			       indx, 0, data, size, 500);
static int set_registers(rtl8150_t * dev, u16 indx, u16 size, void *data)
	return usb_control_msg(dev->udev, usb_sndctrlpipe(dev->udev, 0),
			       RTL8150_REQ_SET_REGS, RTL8150_REQT_WRITE,
			       indx, 0, data, size, 500);",7926aff5c57b577ab0f43364ff0c59d968f6a414,CVE-2017-8069,7926aff5c57b577ab0f43364ff0c59d968f6a414,https://github.com/torvalds/linux,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR *VAR; VAR VAR; VAR = VAR(VAR, VAR); VAR (!VAR) VAR -VAR; VAR = VAR(VAR->VAR, VAR(VAR->VAR, 0), VAR, VAR, VAR, 0, VAR, VAR, 500); VAR (VAR > 0 && VAR <= VAR) VAR(VAR, VAR, VAR); VAR(VAR); VAR VAR; VAR VAR VAR(VAR * VAR, VAR VAR, VAR VAR, VAR VAR *VAR) VAR *VAR; VAR VAR; VAR = VAR(VAR, VAR, VAR); VAR (!VAR) VAR -VAR; VAR = VAR(VAR->VAR, VAR(VAR->VAR, 0), VAR, VAR, VAR, 0, VAR, VAR, 500); VAR(VAR); VAR VAR; VAR VAR(VAR->VAR, VAR(VAR->VAR, 0), VAR, VAR, VAR, 0, VAR, VAR, 500); VAR VAR VAR(VAR * VAR, VAR VAR, VAR VAR, VAR *VAR) VAR VAR(VAR->VAR, VAR(VAR->VAR, 0), VAR, VAR, VAR, 0, VAR, VAR, 500);",16,1
nautobot_362850f5a94689a4c75e3188bf6de826c3b012b2,nautobot/extras/tests/test_views.py,"from django.utils.html import format_html
from nautobot.dcim.models import (
    ConsolePort,
    Device,
    DeviceRole,
    DeviceType,
    Interface,
    LocationType,
    Manufacturer,
    Site,
)
    ComputedField,
class ComputedFieldRenderingTestCase(TestCase):
    """"""Tests for the inclusion of ComputedFields, distinct from tests of the ComputedField views themselves.""""""

    user_permissions = [""dcim.view_locationtype""]

    def setUp(self):
        super().setUp()
        self.computedfield = ComputedField(
            content_type=ContentType.objects.get_for_model(LocationType),
            slug=""test"",
            label=""Computed Field"",
            template=""FOO {{ obj.name }} BAR"",
            fallback_value=""Fallback Value"",
            weight=100,
        )
        self.computedfield.validated_save()
        self.location_type = LocationType.objects.get(name=""Campus"")

    def test_view_object_with_computed_field(self):
        """"""Ensure that the computed field template is rendered.""""""
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertIn(f""FOO {self.location_type.name} BAR"", content, content)

    def test_view_object_with_computed_field_fallback_value(self):
        """"""Ensure that the fallback_value is rendered if the template fails to render.""""""
        # Make the template invalid to demonstrate the fallback value
        self.computedfield.template = ""FOO {{ obj.""
        self.computedfield.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertIn(""Fallback Value"", content, content)

    def test_view_object_with_computed_field_unsafe_template(self):
        """"""Ensure that computed field templates can't be used as an XSS vector.""""""
        self.computedfield.template = '<script>alert(""Hello world!""</script>'
        self.computedfield.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

    def test_view_object_with_computed_field_unsafe_fallback_value(self):
        """"""Ensure that computed field fallback values can't be used as an XSS vector.""""""
        self.computedfield.template = ""FOO {{ obj.""
        self.computedfield.fallback_value = '<script>alert(""Hello world!""</script>'
        self.computedfield.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)


class CustomLinkRenderingTestCase(TestCase):
    """"""Tests for the inclusion of CustomLinks, distinct from tests of the CustomLink views themselves.""""""

    def test_view_object_with_unsafe_custom_link_text(self):
        """"""Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.""""""
        customlink = CustomLink(
            content_type=ContentType.objects.get_for_model(Site),
            name=""Test"",
            text='<script>alert(""Hello world!"")</script>',
            target_url=""http://example.com/?location=None"",
            new_window=False,
        )
        customlink.validated_save()
        site = Site(name=""Test Site"", slug=""test-site"")
        site.save()

        response = self.client.get(site.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)
        self.assertIn(format_html('<a href=""{}""', customlink.target_url), content, content)

    def test_view_object_with_unsafe_custom_link_url(self):
        """"""Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.""""""
        customlink = CustomLink(
            content_type=ContentType.objects.get_for_model(Site),
            name=""Test"",
            text=""Hello"",
            target_url='""><script>alert(""Hello world!"")</script><a href=""',
            new_window=False,
        )
        customlink.validated_save()
        site = Site(name=""Test Site"", slug=""test-site"")
        site.save()

        response = self.client.get(site.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)
        self.assertIn(format_html('<a href=""{}""', customlink.target_url), content, content)

    def test_view_object_with_unsafe_custom_link_name(self):
        """"""Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.""""""
        customlink = CustomLink(
            content_type=ContentType.objects.get_for_model(Site),
            name='<script>alert(""Hello World"")</script>',
            text=""Hello"",
            target_url=""http://example.com/?site={{ obj.name "",  # intentionally bad jinja2 to trigger error case
            new_window=False,
        )
        customlink.validated_save()
        site = Site(name=""Test Site"", slug=""test-site"")
        site.save()

        response = self.client.get(site.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

class JobButtonRenderingTestCase(TestCase):
    """"""Tests for the rendering of JobButtons, distinct from tests of the JobButton views themselves.""""""

    user_permissions = [""dcim.view_locationtype""]

    def setUp(self):
        super().setUp()
        self.job_button = JobButton(
            name=""JobButton"",
            text=""JobButton {{ obj.name }}"",
            job=Job.objects.get(job_class_name=""TestJobButtonReceiverSimple""),
            confirmation=False,
        )
        self.job_button.validated_save()
        self.job_button.content_types.add(ContentType.objects.get_for_model(LocationType))
        self.location_type = LocationType.objects.get(name=""Campus"")

    def test_view_object_with_job_button(self):
        """"""Ensure that the job button is rendered.""""""
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertIn(f""JobButton {self.location_type.name}"", content, content)

    def test_view_object_with_unsafe_text(self):
        """"""Ensure that JobButton text can't be used as a vector for XSS.""""""
        self.job_button.text = '<script>alert(""Hello world!"")</script>'
        self.job_button.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

        # Make sure grouped rendering is safe too
        self.job_button.group = '<script>alert(""Goodbye"")</script>'
        self.job_button.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

    def test_view_object_with_unsafe_name(self):
        """"""Ensure that JobButton names can't be used as a vector for XSS.""""""
        self.job_button.text = ""JobButton {{ obj""
        self.job_button.name = '<script>alert(""Yo"")</script>'
        self.job_button.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

","from nautobot.dcim.models import ConsolePort, Device, DeviceRole, DeviceType, Interface, Manufacturer, Site
    ComputedField,
class CustomLinkTest(TestCase):",362850f5a94689a4c75e3188bf6de826c3b012b2,CVE-2023-48705,362850f5a94689a4c75e3188bf6de826c3b012b2,https://github.com/nautobot/nautobot,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR ( VAR, VAR, VAR, VAR, VAR, VAR, VAR, VAR, ) VAR, VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = [""VAR.VAR""] VAR VAR(VAR): VAR().VAR() VAR.VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR=""VAR"", VAR=""VAR VAR"", VAR=""VAR {{ VAR.VAR }} VAR"", VAR=""VAR VAR"", VAR=100, ) VAR.VAR.VAR() VAR.VAR = VAR.VAR.VAR(VAR=""VAR"") VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(VAR""VAR {VAR.VAR.VAR} VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.""""""  VAR.VAR.VAR = ""VAR {{ VAR."" VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""VAR VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = '<VAR>VAR(""VAR VAR!""</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = ""VAR {{ VAR."" VAR.VAR.VAR = '<VAR>VAR(""VAR VAR!""</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR=""VAR"", VAR='<VAR>VAR(""VAR VAR!"")</VAR>', VAR=""VAR: VAR=VAR, ) VAR.VAR() VAR = VAR(VAR=""VAR VAR"", VAR=""VAR-VAR"") VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR.VAR(VAR('<VAR VAR=""{}""', VAR.VAR), VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR=""VAR"", VAR=""VAR"", VAR='""><VAR>VAR(""VAR VAR!"")</VAR><VAR VAR=""', VAR=VAR, ) VAR.VAR() VAR = VAR(VAR=""VAR VAR"", VAR=""VAR-VAR"") VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR.VAR(VAR('<VAR VAR=""{}""', VAR.VAR), VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR='<VAR>VAR(""VAR VAR"")</VAR>', VAR=""VAR"", VAR=""VAR: VAR=VAR, ) VAR.VAR() VAR = VAR(VAR=""VAR VAR"", VAR=""VAR-VAR"") VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = [""VAR.VAR""] VAR VAR(VAR): VAR().VAR() VAR.VAR = VAR( VAR=""VAR"", VAR=""VAR {{ VAR.VAR }}"", VAR=VAR.VAR.VAR(VAR=""VAR""), VAR=VAR, ) VAR.VAR.VAR() VAR.VAR.VAR.VAR(VAR.VAR.VAR(VAR)) VAR.VAR = VAR.VAR.VAR(VAR=""VAR"") VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(VAR""VAR {VAR.VAR.VAR}"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = '<VAR>VAR(""VAR VAR!"")</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR)  VAR.VAR.VAR = '<VAR>VAR(""VAR"")</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = ""VAR {{ VAR"" VAR.VAR.VAR = '<VAR>VAR(""VAR"")</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR.VAR.VAR VAR VAR, VAR, VAR, VAR, VAR, VAR, VAR VAR, VAR VAR(VAR):",8,1
nautobot_54abe23331b6c3d0d82bf1b028c679b1d200920d,nautobot/extras/tests/test_views.py,"from django.utils.html import format_html
    ComputedField,
class ComputedFieldRenderingTestCase(TestCase):
    """"""Tests for the inclusion of ComputedFields, distinct from tests of the ComputedField views themselves.""""""

    user_permissions = [""dcim.view_locationtype""]

    def setUp(self):
        super().setUp()
        self.computedfield = ComputedField(
            content_type=ContentType.objects.get_for_model(LocationType),
            key=""test"",
            label=""Computed Field"",
            template=""FOO {{ obj.name }} BAR"",
            fallback_value=""Fallback Value"",
            weight=100,
        )
        self.computedfield.validated_save()
        self.location_type = LocationType.objects.get(name=""Campus"")

    def test_view_object_with_computed_field(self):
        """"""Ensure that the computed field template is rendered.""""""
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertIn(f""FOO {self.location_type.name} BAR"", content, content)

    def test_view_object_with_computed_field_fallback_value(self):
        """"""Ensure that the fallback_value is rendered if the template fails to render.""""""
        # Make the template invalid to demonstrate the fallback value
        self.computedfield.template = ""FOO {{ obj.""
        self.computedfield.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertIn(""Fallback Value"", content, content)

    def test_view_object_with_computed_field_unsafe_template(self):
        """"""Ensure that computed field templates can't be used as an XSS vector.""""""
        self.computedfield.template = '<script>alert(""Hello world!""</script>'
        self.computedfield.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

    def test_view_object_with_computed_field_unsafe_fallback_value(self):
        """"""Ensure that computed field fallback values can't be used as an XSS vector.""""""
        self.computedfield.template = ""FOO {{ obj.""
        self.computedfield.fallback_value = '<script>alert(""Hello world!""</script>'
        self.computedfield.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)


class CustomLinkRenderingTestCase(TestCase):
    """"""Tests for the inclusion of CustomLinks, distinct from tests of the CustomLink views themselves.""""""

    def test_view_object_with_unsafe_custom_link_text(self):
        """"""Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.""""""
        customlink = CustomLink(
            content_type=ContentType.objects.get_for_model(Location),
            name=""Test"",
            text='<script>alert(""Hello world!"")</script>',
            target_url=""http://example.com/?location=None"",
            new_window=False,
        )
        customlink.validated_save()
        location_type = LocationType.objects.get(name=""Campus"")
        status = Status.objects.get_for_model(Location).first()
        location = Location(name=""Test Location"", location_type=location_type, status=status)
        location.save()

        response = self.client.get(location.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)
        self.assertIn(format_html('<a href=""{}""', customlink.target_url), content, content)

    def test_view_object_with_unsafe_custom_link_url(self):
        """"""Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.""""""
        customlink = CustomLink(
            content_type=ContentType.objects.get_for_model(Location),
            name=""Test"",
            text=""Hello"",
            target_url='""><script>alert(""Hello world!"")</script><a href=""',
            new_window=False,
        )
        customlink.validated_save()
        location_type = LocationType.objects.get(name=""Campus"")
        status = Status.objects.get_for_model(Location).first()
        location = Location(name=""Test Location"", location_type=location_type, status=status)
        location.save()

        response = self.client.get(location.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)
        self.assertIn(format_html('<a href=""{}""', customlink.target_url), content, content)

    def test_view_object_with_unsafe_custom_link_name(self):
        """"""Ensure that custom links can't be used as a vector for injecting scripts or breaking HTML.""""""
        customlink = CustomLink(
            content_type=ContentType.objects.get_for_model(Location),
            name='<script>alert(""Hello World"")</script>',
            text=""Hello"",
            target_url=""http://example.com/?location={{ obj.name "",  # intentionally bad jinja2 to trigger error case
            new_window=False,
        )
        customlink.validated_save()
        location_type = LocationType.objects.get(name=""Campus"")
        status = Status.objects.get_for_model(Location).first()
        location = Location(name=""Test Location"", location_type=location_type, status=status)
        location.save()

        response = self.client.get(location.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

class JobButtonRenderingTestCase(TestCase):
    """"""Tests for the rendering of JobButtons, distinct from tests of the JobButton views themselves.""""""

    user_permissions = [""dcim.view_locationtype""]

    def setUp(self):
        super().setUp()
        self.job_button = JobButton(
            name=""JobButton"",
            text=""JobButton {{ obj.name }}"",
            job=Job.objects.get(job_class_name=""TestJobButtonReceiverSimple""),
            confirmation=False,
        )
        self.job_button.validated_save()
        self.job_button.content_types.add(ContentType.objects.get_for_model(LocationType))
        self.location_type = LocationType.objects.get(name=""Campus"")

    def test_view_object_with_job_button(self):
        """"""Ensure that the job button is rendered.""""""
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertIn(f""JobButton {self.location_type.name}"", content, content)

    def test_view_object_with_unsafe_text(self):
        """"""Ensure that JobButton text can't be used as a vector for XSS.""""""
        self.job_button.text = '<script>alert(""Hello world!"")</script>'
        self.job_button.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

        # Make sure grouped rendering is safe too
        self.job_button.group = '<script>alert(""Goodbye"")</script>'
        self.job_button.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

    def test_view_object_with_unsafe_name(self):
        """"""Ensure that JobButton names can't be used as a vector for XSS.""""""
        self.job_button.text = ""JobButton {{ obj""
        self.job_button.name = '<script>alert(""Yo"")</script>'
        self.job_button.validated_save()
        response = self.client.get(self.location_type.get_absolute_url(), follow=True)
        self.assertEqual(response.status_code, 200)
        content = extract_page_body(response.content.decode(response.charset))
        self.assertNotIn(""<script>alert"", content, content)
        self.assertIn(""&lt;script&gt;alert"", content, content)

","    ComputedField,
class CustomLinkTest(TestCase):",54abe23331b6c3d0d82bf1b028c679b1d200920d,CVE-2023-48705,54abe23331b6c3d0d82bf1b028c679b1d200920d,https://github.com/nautobot/nautobot,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR.VAR.VAR VAR VAR VAR, VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = [""VAR.VAR""] VAR VAR(VAR): VAR().VAR() VAR.VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR=""VAR"", VAR=""VAR VAR"", VAR=""VAR {{ VAR.VAR }} VAR"", VAR=""VAR VAR"", VAR=100, ) VAR.VAR.VAR() VAR.VAR = VAR.VAR.VAR(VAR=""VAR"") VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(VAR""VAR {VAR.VAR.VAR} VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.""""""  VAR.VAR.VAR = ""VAR {{ VAR."" VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""VAR VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = '<VAR>VAR(""VAR VAR!""</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = ""VAR {{ VAR."" VAR.VAR.VAR = '<VAR>VAR(""VAR VAR!""</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR=""VAR"", VAR='<VAR>VAR(""VAR VAR!"")</VAR>', VAR=""VAR: VAR=VAR, ) VAR.VAR() VAR = VAR.VAR.VAR(VAR=""VAR"") VAR = VAR.VAR.VAR(VAR).VAR() VAR = VAR(VAR=""VAR VAR"", VAR=VAR, VAR=VAR) VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR.VAR(VAR('<VAR VAR=""{}""', VAR.VAR), VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR=""VAR"", VAR=""VAR"", VAR='""><VAR>VAR(""VAR VAR!"")</VAR><VAR VAR=""', VAR=VAR, ) VAR.VAR() VAR = VAR.VAR.VAR(VAR=""VAR"") VAR = VAR.VAR.VAR(VAR).VAR() VAR = VAR(VAR=""VAR VAR"", VAR=VAR, VAR=VAR) VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR.VAR(VAR('<VAR VAR=""{}""', VAR.VAR), VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR( VAR=VAR.VAR.VAR(VAR), VAR='<VAR>VAR(""VAR VAR"")</VAR>', VAR=""VAR"", VAR=""VAR: VAR=VAR, ) VAR.VAR() VAR = VAR.VAR.VAR(VAR=""VAR"") VAR = VAR.VAR.VAR(VAR).VAR() VAR = VAR(VAR=""VAR VAR"", VAR=VAR, VAR=VAR) VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR = [""VAR.VAR""] VAR VAR(VAR): VAR().VAR() VAR.VAR = VAR( VAR=""VAR"", VAR=""VAR {{ VAR.VAR }}"", VAR=VAR.VAR.VAR(VAR=""VAR""), VAR=VAR, ) VAR.VAR.VAR() VAR.VAR.VAR.VAR(VAR.VAR.VAR(VAR)) VAR.VAR = VAR.VAR.VAR(VAR=""VAR"") VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR."""""" VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(VAR""VAR {VAR.VAR.VAR}"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = '<VAR>VAR(""VAR VAR!"")</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR)  VAR.VAR.VAR = '<VAR>VAR(""VAR"")</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR VAR VAR."""""" VAR.VAR.VAR = ""VAR {{ VAR"" VAR.VAR.VAR = '<VAR>VAR(""VAR"")</VAR>' VAR.VAR.VAR() VAR = VAR.VAR.VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR(VAR.VAR.VAR(VAR.VAR)) VAR.VAR(""<VAR>VAR"", VAR, VAR) VAR.VAR(""&VAR;VAR&VAR;VAR"", VAR, VAR) VAR, VAR VAR(VAR):",8,1
nautobot_64312a4297b5ca49b6cdedf477e41e8e4fd61cce,nautobot/core/tests/test_views.py,"            ""If further assistance is required, please join the <code>#nautobot</code> channel on ""
            '<a href=""https://slack.networktocode.com/"" rel=""noopener noreferrer"">Network to Code\'s '
            ""Slack community</a> and post your question."",
            ""If further assistance is required, please join the <code>#nautobot</code> channel on ""
            '<a href=""https://slack.networktocode.com/"" rel=""noopener noreferrer"">Network to Code\'s '
            ""Slack community</a> and post your question."",
        """"""Nautobot's custom 500 page should be used and should include a custom support message if defined.""""""","            ""If further assistance is required, please join the <code>#nautobot</code> channel ""
            'on <a href=""https://slack.networktocode.com/"">Network to Code\'s Slack community</a> '
            ""and post your question."",
            ""If further assistance is required, please join the <code>#nautobot</code> channel ""
            'on <a href=""https://slack.networktocode.com/"">Network to Code\'s Slack community</a> '
            ""and post your question."",
        """"""Nautobot's custom 500 page should be used and should include a default support message.""""""",64312a4297b5ca49b6cdedf477e41e8e4fd61cce,CVE-2024-23345,64312a4297b5ca49b6cdedf477e41e8e4fd61cce,https://github.com/nautobot/nautobot,NVD_DIRECT_COMMIT,1337,COMPLETED,"""VAR VAR VAR VAR VAR, VAR VAR VAR <VAR> '<VAR VAR=""VAR: ""VAR VAR</VAR> VAR VAR VAR VAR."", ""VAR VAR VAR VAR VAR, VAR VAR VAR <VAR> '<VAR VAR=""VAR: ""VAR VAR</VAR> VAR VAR VAR VAR."", """"""VAR'VAR VAR 500 VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."""""" ""VAR VAR VAR VAR VAR, VAR VAR VAR <VAR> 'VAR <VAR VAR=""VAR: ""VAR VAR VAR VAR."", ""VAR VAR VAR VAR VAR, VAR VAR VAR <VAR> 'VAR <VAR VAR=""VAR: ""VAR VAR VAR VAR."", """"""VAR'VAR VAR 500 VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.""""""",16,1
nautobot_64312a4297b5ca49b6cdedf477e41e8e4fd61cce,nautobot/docs/configuration/optional-settings.md,"A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message, as well as [a limited subset of HTML](../additional-features/template-filters.md#render_markdown).","A message to include on error pages (status code 403, 404, 500, etc.) when an error occurs. You can configure this to direct users to the appropriate contact(s) within your organization that provide support for Nautobot. Markdown formatting is supported within this message (raw HTML is not).",64312a4297b5ca49b6cdedf477e41e8e4fd61cce,CVE-2024-23345,64312a4297b5ca49b6cdedf477e41e8e4fd61cce,https://github.com/nautobot/nautobot,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR (VAR VAR 403, 404, 500, VAR.) VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR(VAR) VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR [VAR VAR VAR VAR VAR](../VAR-VAR/VAR-VAR.VAR VAR VAR VAR VAR VAR VAR VAR (VAR VAR 403, 404, 500, VAR.) VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR(VAR) VAR VAR VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR VAR VAR VAR (VAR VAR VAR VAR).",0,1
parse-server_308668c89474223e2448be92d6823b52c1c313ec,spec/ParseQuery.spec.js,"  it_only_db('mongo')('gracefully handles invalid explain values', async () => {
    // Note that anything that is not truthy (like 0) does not cause an exception, as they get swallowed up by ClassesRouter::optionsFromBody
    const values = [1, 'yolo', { a: 1 }, [1, 2, 3]];
    for (const value of values) {
      try {
        await request({
          method: 'GET',
          url: `http://localhost:8378/1/classes/_User?explain=${value}`,
          json: true,
          headers: masterKeyHeaders,
        });
        fail('request did not throw');
      } catch (e) {
        // Expect that Parse Server did not crash
        expect(e.code).not.toEqual('ECONNRESET');
        // Expect that Parse Server validates the explain value and does not crash;
        // see https://jira.mongodb.org/browse/NODE-3463
        equal(e.data.code, Parse.Error.INVALID_QUERY);
        equal(e.data.error, 'Invalid value for explain');
      }
      // get queries (of the form '/classes/:className/:objectId' cannot have the explain key, see ClassesRouter.js)
      // so it is enough that we test find queries
    }
  });

  it_only_db('mongo')('supports valid explain values', async () => {
    const values = [
      false,
      true,
      'queryPlanner',
      'executionStats',
      'allPlansExecution',
      // 'queryPlannerExtended' is excluded as it only applies to MongoDB Data Lake which is currently not available in our CI environment
    ];
    for (const value of values) {
      const response = await request({
        method: 'GET',
        url: `http://localhost:8378/1/classes/_User?explain=${value}`,
        json: true,
        headers: masterKeyHeaders,
      });
      expect(response.status).toBe(200);
      if (value) {
        expect(response.data.results.ok).toBe(1);
      }
    }
  });
",,308668c89474223e2448be92d6823b52c1c313ec,CVE-2021-39187,308668c89474223e2448be92d6823b52c1c313ec,https://github.com/parse-community/parse-server,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR('VAR')('VAR VAR VAR VAR VAR', VAR () => {  VAR VAR = [1, 'VAR', { VAR: 1 }, [1, 2, 3]]; VAR (VAR VAR VAR VAR) { VAR { VAR VAR({ VAR: 'VAR', VAR: `VAR: VAR: VAR, VAR: VAR, }); VAR('VAR VAR VAR VAR'); } VAR (VAR) {  VAR(VAR.VAR).VAR.VAR('VAR');   VAR(VAR.VAR.VAR, VAR.VAR.VAR); VAR(VAR.VAR.VAR, 'VAR VAR VAR VAR'); }   } }); VAR('VAR')('VAR VAR VAR VAR', VAR () => { VAR VAR = [ VAR, VAR, 'VAR', 'VAR', 'VAR',  ]; VAR (VAR VAR VAR VAR) { VAR VAR = VAR VAR({ VAR: 'VAR', VAR: `VAR: VAR: VAR, VAR: VAR, }); VAR(VAR.VAR).VAR(200); VAR (VAR) { VAR(VAR.VAR.VAR.VAR).VAR(1); } } }); ",8,1
parse-server_5be375dec2fa35425c1003ae81c55995ac72af92,spec/ParseFile.spec.js,"  describe('getting files', () => {
    it('does not crash on file request with invalid app ID', async () => {
      const res1 = await request({
        url: 'http://localhost:8378/1/files/invalid-id/invalid-file.txt',
      }).catch(e => e);
      expect(res1.status).toBe(403);
      expect(res1.data).toEqual({ code: 119, error: 'Invalid application ID.' });
      // Ensure server did not crash
      const res2 = await request({ url: 'http://localhost:8378/1/health' });
      expect(res2.status).toEqual(200);
      expect(res2.data).toEqual({ status: 'ok' });
    });

    it('does not crash on file request with invalid path', async () => {
      const res1 = await request({
        url: 'http://localhost:8378/1/files/invalid-id//invalid-path/%20/invalid-file.txt',
      }).catch(e => e);
      expect(res1.status).toBe(403);
      expect(res1.data).toEqual({ error: 'unauthorized' });
      // Ensure server did not crash
      const res2 = await request({ url: 'http://localhost:8378/1/health' });
      expect(res2.status).toEqual(200);
      expect(res2.data).toEqual({ status: 'ok' });
    });

    it('does not crash on file metadata request with invalid app ID', async () => {
      const res1 = await request({
        url: `http://localhost:8378/1/files/invalid-id/metadata/invalid-file.txt`,
      });
      expect(res1.status).toBe(200);
      expect(res1.data).toEqual({});
      // Ensure server did not crash
      const res2 = await request({ url: 'http://localhost:8378/1/health' });
      expect(res2.status).toEqual(200);
      expect(res2.data).toEqual({ status: 'ok' });
    });
  });
",,5be375dec2fa35425c1003ae81c55995ac72af92,CVE-2022-31089,5be375dec2fa35425c1003ae81c55995ac72af92,https://github.com/parse-community/parse-server,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR('VAR VAR', () => { VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR', VAR () => { VAR VAR = VAR VAR({ VAR: 'VAR: }).VAR(VAR => VAR); VAR(VAR.VAR).VAR(403); VAR(VAR.VAR).VAR({ VAR: 119, VAR: 'VAR VAR VAR.' });  VAR VAR = VAR VAR({ VAR: 'VAR: VAR(VAR.VAR).VAR(200); VAR(VAR.VAR).VAR({ VAR: 'VAR' }); }); VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR', VAR () => { VAR VAR = VAR VAR({ VAR: 'VAR: }).VAR(VAR => VAR); VAR(VAR.VAR).VAR(403); VAR(VAR.VAR).VAR({ VAR: 'VAR' });  VAR VAR = VAR VAR({ VAR: 'VAR: VAR(VAR.VAR).VAR(200); VAR(VAR.VAR).VAR({ VAR: 'VAR' }); }); VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR', VAR () => { VAR VAR = VAR VAR({ VAR: `VAR: }); VAR(VAR.VAR).VAR(200); VAR(VAR.VAR).VAR({});  VAR VAR = VAR VAR({ VAR: 'VAR: VAR(VAR.VAR).VAR(200); VAR(VAR.VAR).VAR({ VAR: 'VAR' }); }); }); ",8,1
parse-server_5be375dec2fa35425c1003ae81c55995ac72af92,src/Routers/FilesRouter.js,"    if (!config) {
      res.status(403);
      const err = new Parse.Error(Parse.Error.OPERATION_FORBIDDEN, 'Invalid application ID.');
      res.json({ code: err.code, error: err.message });
      return;
    }
      const config = Config.get(req.params.appId);
      const { filesController } = config;
      const { filename } = req.params;","    const config = Config.get(req.params.appId);
    const { filesController } = config;
    const { filename } = req.params;",5be375dec2fa35425c1003ae81c55995ac72af92,CVE-2022-31089,5be375dec2fa35425c1003ae81c55995ac72af92,https://github.com/parse-community/parse-server,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR (!VAR) { VAR.VAR(403); VAR VAR = VAR VAR.VAR(VAR.VAR.VAR, 'VAR VAR VAR.'); VAR.VAR({ VAR: VAR.VAR, VAR: VAR.VAR }); VAR; } VAR VAR = VAR.VAR(VAR.VAR.VAR); VAR { VAR } = VAR; VAR { VAR } = VAR.VAR; VAR VAR = VAR.VAR(VAR.VAR.VAR); VAR { VAR } = VAR; VAR { VAR } = VAR.VAR;",0,1
parse-server_e016d813e083ce6828f9abce245d15b681a224d8,spec/Middlewares.spec.js,"  it('can set trust proxy', async () => {
    const server = await reconfigureServer({ trustProxy: 1 });
    expect(server.app.parent.settings['trust proxy']).toBe(1);","  it('should not succeed if the connection.remoteAddress does not belong to masterKeyIps list', () => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1', 'ip2'],
    });
    fakeReq.connection = { remoteAddress: 'ip3' };
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    middlewares.handleParseHeaders(fakeReq, fakeRes);
    expect(fakeRes.status).toHaveBeenCalledWith(403);
  });

  it('should succeed if the connection.remoteAddress does belong to masterKeyIps list', done => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1', 'ip2'],
    });
    fakeReq.connection = { remoteAddress: 'ip1' };
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    middlewares.handleParseHeaders(fakeReq, fakeRes, () => {
      expect(fakeRes.status).not.toHaveBeenCalled();
      done();
    });
  });

  it('should not succeed if the socket.remoteAddress does not belong to masterKeyIps list', () => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1', 'ip2'],
    });
    fakeReq.socket = { remoteAddress: 'ip3' };
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    middlewares.handleParseHeaders(fakeReq, fakeRes);
    expect(fakeRes.status).toHaveBeenCalledWith(403);
  });

  it('should succeed if the socket.remoteAddress does belong to masterKeyIps list', done => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1', 'ip2'],
    });
    fakeReq.socket = { remoteAddress: 'ip1' };
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    middlewares.handleParseHeaders(fakeReq, fakeRes, () => {
      expect(fakeRes.status).not.toHaveBeenCalled();
      done();
    });
  });

  it('should not succeed if the connection.socket.remoteAddress does not belong to masterKeyIps list', () => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1', 'ip2'],
    });
    fakeReq.connection = { socket: { remoteAddress: 'ip3' } };
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    middlewares.handleParseHeaders(fakeReq, fakeRes);
    expect(fakeRes.status).toHaveBeenCalledWith(403);
  });

  it('should succeed if the connection.socket.remoteAddress does belong to masterKeyIps list', done => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1', 'ip2'],
    });
    fakeReq.connection = { socket: { remoteAddress: 'ip1' } };
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    middlewares.handleParseHeaders(fakeReq, fakeRes, () => {
      expect(fakeRes.status).not.toHaveBeenCalled();
      done();
    });
  });

  it('should succeed if xff header does belong to masterKeyIps', done => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1'],
    });
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    fakeReq.headers['x-forwarded-for'] = 'ip1, ip2, ip3';
    middlewares.handleParseHeaders(fakeReq, fakeRes, () => {
      expect(fakeRes.status).not.toHaveBeenCalled();
      done();
    });
  });

  it('should succeed if xff header with one ip does belong to masterKeyIps', done => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1'],
    });
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    fakeReq.headers['x-forwarded-for'] = 'ip1';
    middlewares.handleParseHeaders(fakeReq, fakeRes, () => {
      expect(fakeRes.status).not.toHaveBeenCalled();
      done();
    });
  });

  it('should not succeed if xff header does not belong to masterKeyIps', () => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip4'],
    });
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    fakeReq.headers['x-forwarded-for'] = 'ip1, ip2, ip3';
    middlewares.handleParseHeaders(fakeReq, fakeRes);
    expect(fakeRes.status).toHaveBeenCalledWith(403);
  });

  it('should not succeed if xff header is empty and masterKeyIps is set', () => {
    AppCache.put(fakeReq.body._ApplicationId, {
      masterKey: 'masterKey',
      masterKeyIps: ['ip1'],
    });
    fakeReq.headers['x-parse-master-key'] = 'masterKey';
    fakeReq.headers['x-forwarded-for'] = '';
    middlewares.handleParseHeaders(fakeReq, fakeRes);
    expect(fakeRes.status).toHaveBeenCalledWith(403);",e016d813e083ce6828f9abce245d15b681a224d8,CVE-2023-22474,e016d813e083ce6828f9abce245d15b681a224d8,https://github.com/parse-community/parse-server,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR('VAR VAR VAR VAR', VAR () => { VAR VAR = VAR VAR({ VAR: 1 }); VAR(VAR.VAR.VAR.VAR['VAR VAR']).VAR(1); VAR('VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR VAR', () => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR', 'VAR'], }); VAR.VAR = { VAR: 'VAR' }; VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR); VAR(VAR.VAR).VAR(403); }); VAR('VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR', VAR => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR', 'VAR'], }); VAR.VAR = { VAR: 'VAR' }; VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR, () => { VAR(VAR.VAR).VAR.VAR(); VAR(); }); }); VAR('VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR VAR', () => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR', 'VAR'], }); VAR.VAR = { VAR: 'VAR' }; VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR); VAR(VAR.VAR).VAR(403); }); VAR('VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR', VAR => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR', 'VAR'], }); VAR.VAR = { VAR: 'VAR' }; VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR, () => { VAR(VAR.VAR).VAR.VAR(); VAR(); }); }); VAR('VAR VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR VAR VAR', () => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR', 'VAR'], }); VAR.VAR = { VAR: { VAR: 'VAR' } }; VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR); VAR(VAR.VAR).VAR(403); }); VAR('VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR VAR', VAR => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR', 'VAR'], }); VAR.VAR = { VAR: { VAR: 'VAR' } }; VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR, () => { VAR(VAR.VAR).VAR.VAR(); VAR(); }); }); VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR', VAR => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR'], }); VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR['VAR-VAR-VAR'] = 'VAR, VAR, VAR'; VAR.VAR(VAR, VAR, () => { VAR(VAR.VAR).VAR.VAR(); VAR(); }); }); VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR', VAR => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR'], }); VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR['VAR-VAR-VAR'] = 'VAR'; VAR.VAR(VAR, VAR, () => { VAR(VAR.VAR).VAR.VAR(); VAR(); }); }); VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR', () => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR'], }); VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR['VAR-VAR-VAR'] = 'VAR, VAR, VAR'; VAR.VAR(VAR, VAR); VAR(VAR.VAR).VAR(403); }); VAR('VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR', () => { VAR.VAR(VAR.VAR.VAR, { VAR: 'VAR', VAR: ['VAR'], }); VAR.VAR['VAR-VAR-VAR-VAR'] = 'VAR'; VAR.VAR['VAR-VAR-VAR'] = ''; VAR.VAR(VAR, VAR); VAR(VAR.VAR).VAR(403);",0,1
rack_b426cc224908ec6ed6eb8729325392b048215d88,test/spec_common_logger.rb,"  app_without_lint = lambda { |env|
    [200,
     { ""content-type"" => ""text/html"", ""content-length"" => length.to_s },
     [obj]]}
  it ""escapes non printable characters except newline"" do
    logdev = StringIO.new
    log = Logger.new(logdev)
    Rack::MockRequest.new(Rack::CommonLogger.new(app_without_lint, log)).request(""GET\b"", ""/hello"")

    logdev.string.must_match(/GET\\x8 \/hello HTTP\/1\.1/)
  end
",,b426cc224908ec6ed6eb8729325392b048215d88,CVE-2022-30123,b426cc224908ec6ed6eb8729325392b048215d88,https://github.com/rack/rack,GHSD_DIRECT_COMMIT,1337,COMPLETED,"VAR = VAR { |VAR| [200, { ""VAR-VAR"" => ""VAR/VAR"", ""VAR-VAR"" => VAR.VAR }, [VAR]]} VAR ""VAR VAR VAR VAR VAR VAR"" VAR VAR = VAR.VAR VAR = VAR.VAR(VAR) VAR::VAR.VAR(VAR::VAR.VAR(VAR, VAR)).VAR(""VAR\VAR"", ""/VAR"") VAR.VAR.VAR(/VAR\\VAR \/VAR VAR\/1\.1/) VAR ",8,1
sentry_fad12c1150d1135edf9666ea72ca11bc110c1083,tests/sentry/api/endpoints/test_api_tokens.py,"    def test_deny_token_access(self):
        token = ApiToken.objects.create(user=self.user, scope_list=[])

        url = reverse(""sentry-api-0-api-tokens"")
        response = self.client.get(url, format=""json"", HTTP_AUTHORIZATION=f""Bearer {token.token}"")
        assert response.status_code == 403, response.content
",,fad12c1150d1135edf9666ea72ca11bc110c1083,CVE-2023-39349,fad12c1150d1135edf9666ea72ca11bc110c1083,https://github.com/getsentry/sentry,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR(VAR): VAR = VAR.VAR.VAR(VAR=VAR.VAR, VAR=[]) VAR = VAR(""VAR-VAR-0-VAR-VAR"") VAR = VAR.VAR.VAR(VAR, VAR=""VAR"", VAR=VAR""VAR {VAR.VAR}"") VAR VAR.VAR == 403, VAR.VAR ",0,1
trafficserver_ee46128fc7099956145be2147e4ddad7fbc7299b,tests/gold_tests/bigobj/bigobj.test.py,"ts = Test.MakeATSProcess(""ts1"", enable_tls=True)
    'proxy.config.ssl.server.cert.path': ts.Variables.SSLDir,
    'proxy.config.ssl.server.private_key.path': ts.Variables.SSLDir,
tr = Test.AddTestRun(""PUSH an object to the cache"")
tr.Processes.Default.StartBefore(ts)
    f'./push_request {obj_kilobytes} | nc localhost {ts.Variables.port}'
tr = Test.AddTestRun(""GET bigobj: cleartext, HTTP/1.1, IPv4"")
    'curl --verbose --ipv4 --http1.1 --header ""Host: localhost""'
    f' http://localhost:{ts.Variables.port}/bigobj 2>> log.txt |'
    f' ./check_ramp {obj_kilobytes}'
tr = Test.AddTestRun(""GET bigobj: TLS, HTTP/1.1, IPv4"")
    'curl --verbose --ipv4 --http1.1 --insecure --header ""Host: localhost""'
    f' https://localhost:{ts.Variables.ssl_port}/bigobj 2>> log.txt |'
    f' ./check_ramp {obj_kilobytes}'
tr = Test.AddTestRun(""GET bigobj: TLS, HTTP/2, IPv4"")
    'curl --verbose --ipv4 --http2 --insecure --header ""Host: localhost""'
    f' https://localhost:{ts.Variables.ssl_port}/bigobj 2>> log.txt |'
    f' ./check_ramp {obj_kilobytes}'
tr = Test.AddTestRun(""GET bigobj: TLS, HTTP/2, IPv6"")
    'curl --verbose --ipv6 --http2 --insecure --header ""Host: localhost""'
    f' https://localhost:{ts.Variables.ssl_portv6}/bigobj 2>> log.txt |'
    f' ./check_ramp {obj_kilobytes}'

# Verify that PUSH requests are rejected when push_method_enabled is 0 (the
# default configuration).
ts = Test.MakeATSProcess(""ts2"", enable_tls=True)
ts.addDefaultSSLFiles()

ts.Disk.records_config.update({
    'proxy.config.diags.debug.enabled': 1,
    'proxy.config.diags.debug.tags': 'http|dns|cache',
    'proxy.config.http.cache.required_headers': 0,  # No required headers for caching
    'proxy.config.proxy_name': 'Poxy_Proxy',  # This will be the server name.
    'proxy.config.ssl.server.cert.path': ts.Variables.SSLDir,
    'proxy.config.ssl.server.private_key.path': ts.Variables.SSLDir,
    'proxy.config.url_remap.remap_required': 0
})

ts.Disk.ssl_multicert_config.AddLine(
    'dest_ip=* ssl_cert_name=server.pem ssl_key_name=server.key'
)

ts.Disk.remap_config.AddLine(
    'map https://localhost http://localhost'
)

tr = Test.AddTestRun(""PUSH request is rejected when push_method_enabled is 0"")
tr.Processes.Default.StartBefore(ts)
tr.Processes.Default.Command = (
    f'./push_request {obj_kilobytes} | nc localhost {ts.Variables.port}'
)
tr.Processes.Default.ReturnCode = 1
tr.Processes.Default.Streams.stdout = Testers.ContainsExpression(
    ""403 Access Denied"",
    ""The PUSH request should have received a 403 response.""
)","ts = Test.MakeATSProcess(""ts"", enable_tls=True)
    'proxy.config.ssl.server.cert.path': '{0}'.format(ts.Variables.SSLDir),
    'proxy.config.ssl.server.private_key.path': '{0}'.format(ts.Variables.SSLDir),
tr = Test.AddTestRun()
tr.Processes.Default.StartBefore(Test.Processes.ts)
    './push_request {} | nc localhost {}'.format(obj_kilobytes, ts.Variables.port)
# GET bigobj -- cleartext, HTTP 1.1, IPv4
#
tr = Test.AddTestRun()
    'curl --verbose --ipv4 --http1.1 --header ""Host: localhost""' +
    ' http://localhost:{}/bigobj 2>> log.txt | ./check_ramp {}'
    .format(ts.Variables.port, obj_kilobytes)
# GET bigobj -- TLS, HTTP 1.1, IPv4
#
tr = Test.AddTestRun()
    'curl --verbose --ipv4 --http1.1 --insecure --header ""Host: localhost""' +
    ' https://localhost:{}/bigobj 2>> log.txt | ./check_ramp {}'
    .format(ts.Variables.ssl_port, obj_kilobytes)
# GET bigobj -- TLS, HTTP 2, IPv4
#
tr = Test.AddTestRun()
    'curl --verbose --ipv4 --http2 --insecure --header ""Host: localhost""' +
    ' https://localhost:{}/bigobj 2>> log.txt | ./check_ramp {}'
    .format(ts.Variables.ssl_port, obj_kilobytes)
# GET bigobj -- TLS, HTTP 2, IPv6
#
tr = Test.AddTestRun()
    'curl --verbose --ipv6 --http2 --insecure --header ""Host: localhost""' +
    ' https://localhost:{}/bigobj 2>> log.txt | ./check_ramp {}'
    .format(ts.Variables.ssl_portv6, obj_kilobytes)",ee46128fc7099956145be2147e4ddad7fbc7299b,CVE-2023-30631,ee46128fc7099956145be2147e4ddad7fbc7299b,https://github.com/apache/trafficserver,CPE_GIT_REPOBASED,94,COMPLETED,"VAR = VAR.VAR(""VAR"", VAR=VAR) 'VAR.VAR.VAR.VAR.VAR.VAR': VAR.VAR.VAR, 'VAR.VAR.VAR.VAR.VAR.VAR': VAR.VAR.VAR, VAR = VAR.VAR(""VAR VAR VAR VAR VAR VAR"") VAR.VAR.VAR.VAR(VAR) VAR'./VAR {VAR} | VAR VAR {VAR.VAR.VAR}' VAR = VAR.VAR(""VAR VAR: VAR, VAR/1.1, VAR"") 'VAR --VAR --VAR --VAR.1 --VAR ""VAR: VAR""' VAR' VAR: VAR' ./VAR {VAR}' VAR = VAR.VAR(""VAR VAR: VAR, VAR/1.1, VAR"") 'VAR --VAR --VAR --VAR.1 --VAR --VAR ""VAR: VAR""' VAR' VAR: VAR' ./VAR {VAR}' VAR = VAR.VAR(""VAR VAR: VAR, VAR/2, VAR"") 'VAR --VAR --VAR --VAR --VAR --VAR ""VAR: VAR""' VAR' VAR: VAR' ./VAR {VAR}' VAR = VAR.VAR(""VAR VAR: VAR, VAR/2, VAR"") 'VAR --VAR --VAR --VAR --VAR --VAR ""VAR: VAR""' VAR' VAR: VAR' ./VAR {VAR}'   VAR = VAR.VAR(""VAR"", VAR=VAR) VAR.VAR() VAR.VAR.VAR.VAR({ 'VAR.VAR.VAR.VAR.VAR': 1, 'VAR.VAR.VAR.VAR.VAR': 'VAR|VAR|VAR', 'VAR.VAR.VAR.VAR.VAR': 0,  'VAR.VAR.VAR': 'VAR',  'VAR.VAR.VAR.VAR.VAR.VAR': VAR.VAR.VAR, 'VAR.VAR.VAR.VAR.VAR.VAR': VAR.VAR.VAR, 'VAR.VAR.VAR.VAR': 0 }) VAR.VAR.VAR.VAR( 'VAR=* VAR=VAR.VAR VAR=VAR.VAR' ) VAR.VAR.VAR.VAR( 'VAR VAR: ) VAR = VAR.VAR(""VAR VAR VAR VAR VAR VAR VAR 0"") VAR.VAR.VAR.VAR(VAR) VAR.VAR.VAR.VAR = ( VAR'./VAR {VAR} | VAR VAR {VAR.VAR.VAR}' ) VAR.VAR.VAR.VAR = 1 VAR.VAR.VAR.VAR.VAR = VAR.VAR( ""403 VAR VAR"", ""VAR VAR VAR VAR VAR VAR VAR 403 VAR."" ) VAR = VAR.VAR(""VAR"", VAR=VAR) 'VAR.VAR.VAR.VAR.VAR.VAR': '{0}'.VAR(VAR.VAR.VAR), 'VAR.VAR.VAR.VAR.VAR.VAR': '{0}'.VAR(VAR.VAR.VAR), VAR = VAR.VAR() VAR.VAR.VAR.VAR(VAR.VAR.VAR) './VAR {} | VAR VAR {}'.VAR(VAR, VAR.VAR.VAR)   VAR = VAR.VAR() 'VAR --VAR --VAR --VAR.1 --VAR ""VAR: VAR""' + ' VAR: .VAR(VAR.VAR.VAR, VAR)   VAR = VAR.VAR() 'VAR --VAR --VAR --VAR.1 --VAR --VAR ""VAR: VAR""' + ' VAR: .VAR(VAR.VAR.VAR, VAR)   VAR = VAR.VAR() 'VAR --VAR --VAR --VAR --VAR --VAR ""VAR: VAR""' + ' VAR: .VAR(VAR.VAR.VAR, VAR)   VAR = VAR.VAR() 'VAR --VAR --VAR --VAR --VAR --VAR ""VAR: VAR""' + ' VAR: .VAR(VAR.VAR.VAR, VAR)",0,1
urllib3_0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,dummyserver/proxy.py,"#!/usr/bin/env python
#
# Simple asynchronous HTTP proxy with tunnelling (CONNECT).
#
# GET/POST proxying based on
# http://groups.google.com/group/python-tornado/msg/7bea08e7a049cf26
#
# Copyright (C) 2012 Senko Rasic <senko.rasic@dobarkod.hr>
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the ""Software""), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.

import sys
import socket

import tornado.httpserver
import tornado.ioloop
import tornado.iostream
import tornado.web
import tornado.httpclient

__all__ = ['ProxyHandler', 'run_proxy']


class ProxyHandler(tornado.web.RequestHandler):
    SUPPORTED_METHODS = ['GET', 'POST', 'CONNECT']

    @tornado.web.asynchronous
    def get(self):

        def handle_response(response):
            if response.error and not isinstance(response.error,
                                                 tornado.httpclient.HTTPError):
                self.set_status(500)
                self.write('Internal server error:\n' + str(response.error))
                self.finish()
            else:
                self.set_status(response.code)
                for header in ('Date', 'Cache-Control', 'Server',
                               'Content-Type', 'Location'):
                    v = response.headers.get(header)
                    if v:
                        self.set_header(header, v)
                if response.body:
                    self.write(response.body)
                self.finish()

        req = tornado.httpclient.HTTPRequest(
            url=self.request.uri,
            method=self.request.method, body=self.request.body,
            headers=self.request.headers, follow_redirects=False,
            allow_nonstandard_methods=True)

        client = tornado.httpclient.AsyncHTTPClient()
        try:
            client.fetch(req, handle_response)
        except tornado.httpclient.HTTPError as e:
            if hasattr(e, 'response') and e.response:
                self.handle_response(e.response)
            else:
                self.set_status(500)
                self.write('Internal server error:\n' + str(e))
                self.finish()

    @tornado.web.asynchronous
    def post(self):
        return self.get()

    @tornado.web.asynchronous
    def connect(self):
        host, port = self.request.uri.split(':')
        client = self.request.connection.stream

        def read_from_client(data):
            upstream.write(data)

        def read_from_upstream(data):
            client.write(data)

        def client_close(data=None):
            if upstream.closed():
                return
            if data:
                upstream.write(data)
            upstream.close()

        def upstream_close(data=None):
            if client.closed():
                return
            if data:
                client.write(data)
            client.close()

        def start_tunnel():
            client.read_until_close(client_close, read_from_client)
            upstream.read_until_close(upstream_close, read_from_upstream)
            client.write(b'HTTP/1.0 200 Connection established\r\n\r\n')

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
        upstream = tornado.iostream.IOStream(s)
        upstream.connect((host, int(port)), start_tunnel)


def run_proxy(port, start_ioloop=True):
    """"""
    Run proxy on the specified port. If start_ioloop is True (default),
    the tornado IOLoop will be started immediately.
    """"""
    app = tornado.web.Application([
        (r'.*', ProxyHandler),
    ])
    app.listen(port)
    ioloop = tornado.ioloop.IOLoop.instance()
    if start_ioloop:
        ioloop.start()


if __name__ == '__main__':
    port = 8888
    if len(sys.argv) > 1:
        port = int(sys.argv[1])

    print(""Starting HTTP proxy on port %d"" % port)
    run_proxy(port)",,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,CVE-2019-11236,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,98,COMPLETED,"                          VAR VAR VAR VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR = ['VAR', 'VAR'] VAR VAR(VAR.VAR.VAR): VAR = ['VAR', 'VAR', 'VAR'] @VAR.VAR.VAR VAR VAR(VAR): VAR VAR(VAR): VAR VAR.VAR VAR VAR VAR(VAR.VAR, VAR.VAR.VAR): VAR.VAR(500) VAR.VAR('VAR VAR VAR:\VAR' + VAR(VAR.VAR)) VAR.VAR() VAR: VAR.VAR(VAR.VAR) VAR VAR VAR ('VAR', 'VAR-VAR', 'VAR', 'VAR-VAR', 'VAR'): VAR = VAR.VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR.VAR() VAR = VAR.VAR.VAR( VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR, VAR=VAR) VAR = VAR.VAR.VAR() VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR.VAR VAR VAR: VAR VAR(VAR, 'VAR') VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR: VAR.VAR(500) VAR.VAR('VAR VAR VAR:\VAR' + VAR(VAR)) VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR, VAR = VAR.VAR.VAR.VAR(':') VAR = VAR.VAR.VAR.VAR VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR=VAR): VAR VAR.VAR(): VAR VAR VAR: VAR.VAR(VAR) VAR.VAR() VAR VAR(VAR=VAR): VAR VAR.VAR(): VAR VAR VAR: VAR.VAR(VAR) VAR.VAR() VAR VAR(): VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR'VAR/1.0 200 VAR VAR\VAR\VAR\VAR\VAR') VAR = VAR.VAR(VAR.VAR, VAR.VAR, 0) VAR = VAR.VAR.VAR(VAR) VAR.VAR((VAR, VAR(VAR)), VAR) VAR VAR(VAR, VAR=VAR): """""" VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR (VAR), VAR VAR VAR VAR VAR VAR VAR. """""" VAR = VAR.VAR.VAR([ (VAR'.*', VAR), ]) VAR.VAR(VAR) VAR = VAR.VAR.VAR.VAR() VAR VAR: VAR.VAR() VAR VAR == 'VAR': VAR = 8888 VAR VAR(VAR.VAR) > 1: VAR = VAR(VAR.VAR[1]) VAR(""VAR VAR VAR VAR VAR %VAR"" % VAR) VAR(VAR) ",16,1
urllib3_0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,test/appengine/test_urlfetch.py,"""""""These tests ensure that when running in App Engine standard with the
App Engine sandbox enabled that urllib3 appropriately uses the App
Engine-patched version of httplib to make requests.""""""

import httplib
import StringIO
import unittest

from mock import patch
import pytest

from ..test_no_ssl import TestWithoutSSL


class MockResponse(object):
    def __init__(self, content, status_code, content_was_truncated, final_url,
                 headers):

        self.content = content
        self.status_code = status_code
        self.content_was_truncated = content_was_truncated
        self.final_url = final_url
        self.header_msg = httplib.HTTPMessage(StringIO.StringIO(''.join(
            [""%s: %s\n"" % (k, v) for k, v in headers.iteritems()] + [""\n""])))
        self.headers = headers


@pytest.mark.usefixtures('sandbox')
class TestHTTP(TestWithoutSSL):
    def test_urlfetch_called_with_http(self):
        """"""Check that URLFetch is used to fetch non-https resources.""""""
        resp = MockResponse(
            'OK',
            200,
            False,
            'http://www.google.com',
            {'content-type': 'text/plain'})
        fetch_patch = patch(
            'google.appengine.api.urlfetch.fetch', return_value=resp
        )
        with fetch_patch as fetch_mock:
            import urllib3
            pool = urllib3.HTTPConnectionPool('www.google.com', '80')
            r = pool.request('GET', '/')
            self.assertEqual(r.status, 200, r.data)
            self.assertEqual(fetch_mock.call_count, 1)


@pytest.mark.usefixtures('sandbox')
class TestHTTPS(unittest.TestCase):
    @pytest.mark.xfail(
        reason='This is not yet supported by urlfetch, presence of the ssl '
               'module will bypass urlfetch.')
    def test_urlfetch_called_with_https(self):
        """"""
        Check that URLFetch is used when fetching https resources
        """"""
        resp = MockResponse(
            'OK',
            200,
            False,
            'https://www.google.com',
            {'content-type': 'text/plain'})
        fetch_patch = patch(
            'google.appengine.api.urlfetch.fetch', return_value=resp
        )
        with fetch_patch as fetch_mock:
            import urllib3
            pool = urllib3.HTTPSConnectionPool('www.google.com', '443')
            pool.ConnectionCls = urllib3.connection.UnverifiedHTTPSConnection
            r = pool.request('GET', '/')
            self.assertEqual(r.status, 200, r.data)
            self.assertEqual(fetch_mock.call_count, 1)",,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,CVE-2019-11236,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,98,COMPLETED,"""""""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR VAR VAR VAR VAR."""""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR ..VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR, VAR, VAR, VAR, VAR, VAR): VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR.VAR(VAR.VAR(''.VAR( [""%VAR: %VAR\VAR"" % (VAR, VAR) VAR VAR, VAR VAR VAR.VAR()] + [""\VAR""]))) VAR.VAR = VAR @VAR.VAR.VAR('VAR') VAR VAR(VAR): VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR."""""" VAR = VAR( 'VAR', 200, VAR, 'VAR: {'VAR-VAR': 'VAR/VAR'}) VAR = VAR( 'VAR.VAR.VAR.VAR.VAR', VAR=VAR ) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR('VAR.VAR.VAR', '80') VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR.VAR(VAR.VAR, 1) @VAR.VAR.VAR('VAR') VAR VAR(VAR.VAR): @VAR.VAR.VAR( VAR='VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR ' 'VAR VAR VAR VAR.') VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR( 'VAR', 200, VAR, 'VAR: {'VAR-VAR': 'VAR/VAR'}) VAR = VAR( 'VAR.VAR.VAR.VAR.VAR', VAR=VAR ) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR('VAR.VAR.VAR', '443') VAR.VAR = VAR.VAR.VAR VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR.VAR(VAR.VAR, 1) ",8,1
urllib3_0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,test/test_retry.py,"import pytest

from urllib3.response import HTTPResponse
from urllib3.packages.six.moves import xrange
from urllib3.util.retry import Retry, RequestHistory
from urllib3.exceptions import (
    ConnectTimeoutError,
    MaxRetryError,
    ReadTimeoutError,
    ResponseError,
)


class TestRetry(object):

    def test_string(self):
        """""" Retry string representation looks the way we expect """"""
        retry = Retry()
        assert str(retry) == 'Retry(total=10, connect=None, read=None, redirect=None, status=None)'
        for _ in range(3):
            retry = retry.increment(method='GET')
        assert str(retry) == 'Retry(total=7, connect=None, read=None, redirect=None, status=None)'

    def test_retry_both_specified(self):
        """"""Total can win if it's lower than the connect value""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=3, total=2)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

    def test_retry_higher_total_loses(self):
        """""" A lower connect timeout than the total is honored """"""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=3)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

    def test_retry_higher_total_loses_vs_read(self):
        """""" A lower read timeout than the total is honored """"""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=2, total=3)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(method='GET', error=error)

    def test_retry_total_none(self):
        """""" if Total is none, connect error should take precedence """"""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=None)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(connect=2, total=None)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        assert not retry.is_exhausted()

    def test_retry_default(self):
        """""" If no value is specified, should retry connects 3 times """"""
        retry = Retry()
        assert retry.total == 10
        assert retry.connect is None
        assert retry.read is None
        assert retry.redirect is None

        error = ConnectTimeoutError()
        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        assert not retry.is_exhausted()

        assert Retry(0).raise_on_redirect
        assert not Retry(False).raise_on_redirect

    def test_retry_read_zero(self):
        """""" No second chances on read timeouts, by default """"""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=0)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(method='GET', error=error)
        assert e.value.reason == error

    def test_status_counter(self):
        resp = HTTPResponse(status=400)
        retry = Retry(status=2)
        retry = retry.increment(response=resp)
        retry = retry.increment(response=resp)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(response=resp)
        assert str(e.value.reason) == ResponseError.SPECIFIC_ERROR.format(status_code=400)

    def test_backoff(self):
        """""" Backoff is computed correctly """"""
        max_backoff = Retry.BACKOFF_MAX

        retry = Retry(total=100, backoff_factor=0.2)
        assert retry.get_backoff_time() == 0  # First request

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0  # First retry

        retry = retry.increment(method='GET')
        assert retry.backoff_factor == 0.2
        assert retry.total == 98
        assert retry.get_backoff_time() == 0.4  # Start backoff

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.8

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 1.6

        for _ in xrange(10):
            retry = retry.increment(method='GET')

        assert retry.get_backoff_time() == max_backoff

    def test_zero_backoff(self):
        retry = Retry()
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0

    def test_backoff_reset_after_redirect(self):
        retry = Retry(total=100, redirect=5, backoff_factor=0.2)
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.4
        redirect_response = HTTPResponse(status=302, headers={'location': 'test'})
        retry = retry.increment(method='GET', response=redirect_response)
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.4

    def test_sleep(self):
        # sleep a very small amount of time so our code coverage is happy
        retry = Retry(backoff_factor=0.0001)
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        retry.sleep()

    def test_status_forcelist(self):
        retry = Retry(status_forcelist=xrange(500, 600))
        assert not retry.is_retry('GET', status_code=200)
        assert not retry.is_retry('GET', status_code=400)
        assert retry.is_retry('GET', status_code=500)

        retry = Retry(total=1, status_forcelist=[418])
        assert not retry.is_retry('GET', status_code=400)
        assert retry.is_retry('GET', status_code=418)

        # String status codes are not matched.
        retry = Retry(total=1, status_forcelist=['418'])
        assert not retry.is_retry('GET', status_code=418)

    def test_method_whitelist_with_status_forcelist(self):
        # Falsey method_whitelist means to retry on any method.
        retry = Retry(status_forcelist=[500], method_whitelist=None)
        assert retry.is_retry('GET', status_code=500)
        assert retry.is_retry('POST', status_code=500)

        # Criteria of method_whitelist and status_forcelist are ANDed.
        retry = Retry(status_forcelist=[500], method_whitelist=['POST'])
        assert not retry.is_retry('GET', status_code=500)
        assert retry.is_retry('POST', status_code=500)

    def test_exhausted(self):
        assert not Retry(0).is_exhausted()
        assert Retry(-1).is_exhausted()
        assert Retry(1).increment(method='GET').total == 0

    @pytest.mark.parametrize('total', [-1, 0])
    def test_disabled(self, total):
        with pytest.raises(MaxRetryError):
            Retry(total).increment(method='GET')

    def test_error_message(self):
        retry = Retry(total=0)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(method='GET',
                                    error=ReadTimeoutError(None, ""/"", ""read timed out""))
        assert 'Caused by redirect' not in str(e.value)
        assert str(e.value.reason) == 'None: read timed out'

        retry = Retry(total=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment('POST', '/')
            retry = retry.increment('POST', '/')
        assert 'Caused by redirect' not in str(e.value)
        assert isinstance(e.value.reason, ResponseError)
        assert str(e.value.reason) == ResponseError.GENERIC_ERROR

        retry = Retry(total=1)
        response = HTTPResponse(status=500)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment('POST', '/', response=response)
            retry = retry.increment('POST', '/', response=response)
        assert 'Caused by redirect' not in str(e.value)
        msg = ResponseError.SPECIFIC_ERROR.format(status_code=500)
        assert str(e.value.reason) == msg

        retry = Retry(connect=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(error=ConnectTimeoutError('conntimeout'))
            retry = retry.increment(error=ConnectTimeoutError('conntimeout'))
        assert 'Caused by redirect' not in str(e.value)
        assert str(e.value.reason) == 'conntimeout'

    def test_history(self):
        retry = Retry(total=10, method_whitelist=frozenset(['GET', 'POST']))
        assert retry.history == tuple()
        connection_error = ConnectTimeoutError('conntimeout')
        retry = retry.increment('GET', '/test1', None, connection_error)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),)
        assert retry.history == history

        read_error = ReadTimeoutError(None, ""/test2"", ""read timed out"")
        retry = retry.increment('POST', '/test2', None, read_error)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),
                   RequestHistory('POST', '/test2', read_error, None, None))
        assert retry.history == history

        response = HTTPResponse(status=500)
        retry = retry.increment('GET', '/test3', response, None)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),
                   RequestHistory('POST', '/test2', read_error, None, None),
                   RequestHistory('GET', '/test3', None, 500, None))
        assert retry.history == history

    def test_retry_method_not_in_whitelist(self):
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry()
        with pytest.raises(ReadTimeoutError):
            retry.increment(method='POST', error=error)

    def test_retry_default_remove_headers_on_redirect(self):
        retry = Retry()

        assert list(retry.remove_headers_on_redirect) == ['Authorization']

    def test_retry_set_remove_headers_on_redirect(self):
        retry = Retry(remove_headers_on_redirect=['X-API-Secret'])

        assert list(retry.remove_headers_on_redirect) == ['X-API-Secret']",,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,CVE-2019-11236,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,98,COMPLETED,"VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR, ) VAR VAR(VAR): VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR() VAR VAR(VAR) == 'VAR(VAR=10, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)' VAR VAR VAR VAR(3): VAR = VAR.VAR(VAR='VAR') VAR VAR(VAR) == 'VAR(VAR=7, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)' VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=3, VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR() VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR(VAR): """""" VAR VAR VAR VAR, VAR VAR VAR VAR VAR """""" VAR = VAR() VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR VAR.VAR() VAR VAR(VAR): """""" VAR VAR VAR VAR VAR, VAR VAR VAR 3 VAR """""" VAR = VAR() VAR VAR.VAR == 10 VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR VAR(0).VAR VAR VAR VAR(VAR).VAR VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR, VAR VAR """""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR=400) VAR = VAR(VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR.VAR(VAR=400) VAR VAR(VAR): """""" VAR VAR VAR VAR """""" VAR = VAR.VAR VAR = VAR(VAR=100, VAR=0.2) VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR == 0.2 VAR VAR.VAR == 98 VAR VAR.VAR() == 0.4  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.8 VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 1.6 VAR VAR VAR VAR(10): VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == VAR VAR VAR(VAR): VAR = VAR() VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0 VAR VAR(VAR): VAR = VAR(VAR=100, VAR=5, VAR=0.2) VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.4 VAR = VAR(VAR=302, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.4 VAR VAR(VAR):  VAR = VAR(VAR=0.0001) VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR.VAR() VAR VAR(VAR): VAR = VAR(VAR=VAR(500, 600)) VAR VAR VAR.VAR('VAR', VAR=200) VAR VAR VAR.VAR('VAR', VAR=400) VAR VAR.VAR('VAR', VAR=500) VAR = VAR(VAR=1, VAR=[418]) VAR VAR VAR.VAR('VAR', VAR=400) VAR VAR.VAR('VAR', VAR=418)  VAR = VAR(VAR=1, VAR=['418']) VAR VAR VAR.VAR('VAR', VAR=418) VAR VAR(VAR):  VAR = VAR(VAR=[500], VAR=VAR) VAR VAR.VAR('VAR', VAR=500) VAR VAR.VAR('VAR', VAR=500)  VAR = VAR(VAR=[500], VAR=['VAR']) VAR VAR VAR.VAR('VAR', VAR=500) VAR VAR.VAR('VAR', VAR=500) VAR VAR(VAR): VAR VAR VAR(0).VAR() VAR VAR(-1).VAR() VAR VAR(1).VAR(VAR='VAR').VAR == 0 @VAR.VAR.VAR('VAR', [-1, 0]) VAR VAR(VAR, VAR): VAR VAR.VAR(VAR): VAR(VAR).VAR(VAR='VAR') VAR VAR(VAR): VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR='VAR', VAR=VAR(VAR, ""/"", ""VAR VAR VAR"")) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == 'VAR: VAR VAR VAR' VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR('VAR', '/') VAR = VAR.VAR('VAR', '/') VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR, VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR VAR = VAR(VAR=1) VAR = VAR(VAR=500) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR('VAR', '/', VAR=VAR) VAR = VAR.VAR('VAR', '/', VAR=VAR) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR = VAR.VAR.VAR(VAR=500) VAR VAR(VAR.VAR.VAR) == VAR VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR=VAR('VAR')) VAR = VAR.VAR(VAR=VAR('VAR')) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == 'VAR' VAR VAR(VAR): VAR = VAR(VAR=10, VAR=VAR(['VAR', 'VAR'])) VAR VAR.VAR == VAR() VAR = VAR('VAR') VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR),) VAR VAR.VAR == VAR VAR = VAR(VAR, ""/VAR"", ""VAR VAR VAR"") VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, VAR, VAR)) VAR VAR.VAR == VAR VAR = VAR(VAR=500) VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, 500, VAR)) VAR VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR(VAR): VAR = VAR() VAR VAR(VAR.VAR) == ['VAR'] VAR VAR(VAR): VAR = VAR(VAR=['VAR-VAR-VAR']) VAR VAR(VAR.VAR) == ['VAR-VAR-VAR'] ",16,1
urllib3_0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,test/with_dummyserver/test_no_ssl.py,"""""""
Test connections without the builtin ssl module

Note: Import urllib3 inside the test functions to get the importblocker to work
""""""
from ..test_no_ssl import TestWithoutSSL

from dummyserver.testcase import (
        HTTPDummyServerTestCase, HTTPSDummyServerTestCase)

import urllib3


class TestHTTPWithoutSSL(HTTPDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        pool = urllib3.HTTPConnectionPool(self.host, self.port)
        self.addCleanup(pool.close)
        r = pool.request('GET', '/')
        self.assertEqual(r.status, 200, r.data)


class TestHTTPSWithoutSSL(HTTPSDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        pool = urllib3.HTTPSConnectionPool(self.host, self.port)
        self.addCleanup(pool.close)
        try:
            pool.request('GET', '/')
        except urllib3.exceptions.SSLError as e:
            self.assertIn('SSL module is not available', str(e))",,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,CVE-2019-11236,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,98,COMPLETED,""""""" VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR ..VAR VAR VAR VAR VAR.VAR VAR ( VAR, VAR) VAR VAR VAR VAR(VAR, VAR): VAR VAR(VAR): VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR VAR(VAR, VAR): VAR VAR(VAR): VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', '/') VAR VAR.VAR.VAR VAR VAR: VAR.VAR('VAR VAR VAR VAR VAR', VAR(VAR)) ",8,1
urllib3_0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,test/with_dummyserver/test_poolmanager.py,"import unittest
import json

import pytest

from dummyserver.server import HAS_IPV6
from dummyserver.testcase import (HTTPDummyServerTestCase,
                                  IPv6HTTPDummyServerTestCase)
from urllib3.poolmanager import PoolManager
from urllib3.connectionpool import port_by_scheme
from urllib3.exceptions import MaxRetryError
from urllib3.util.retry import Retry


class TestPoolManager(HTTPDummyServerTestCase):

    def setUp(self):
        self.base_url = 'http://%s:%d' % (self.host, self.port)
        self.base_url_alt = 'http://%s:%d' % (self.host_alt, self.port)

    def test_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/' % self.base_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/' % self.base_url})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_redirect_twice(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect' % self.base_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                       self.base_url)})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_redirect_to_relative_url(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '/redirect'},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '/redirect'})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_cross_host_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        cross_host_location = '%s/echo?a=b' % self.base_url_alt
        try:
            http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': cross_host_location},
                         timeout=1, retries=0)
            self.fail(""Request succeeded instead of raising an exception like it should."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/echo?a=b' % self.base_url_alt},
                         timeout=1, retries=1)

        self.assertEqual(r._pool.host, self.host_alt)

    def test_too_many_redirects(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        try:
            r = http.request('GET', '%s/redirect' % self.base_url,
                             fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                           self.base_url)},
                             retries=1)
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        try:
            r = http.request('GET', '%s/redirect' % self.base_url,
                             fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                           self.base_url)},
                             retries=Retry(total=None, redirect=1))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

    def test_redirect_cross_host_remove_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'Authorization': 'foo'})

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('Authorization', data)

    def test_redirect_cross_host_no_remove_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'Authorization': 'foo'},
                         retries=Retry(remove_headers_on_redirect=[]))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertEqual(data['Authorization'], 'foo')

    def test_redirect_cross_host_set_removed_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'X-API-Secret': 'foo',
                                  'Authorization': 'bar'},
                         retries=Retry(remove_headers_on_redirect=['X-API-Secret']))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('X-API-Secret', data)
        self.assertEqual(data['Authorization'], 'bar')

    def test_raise_on_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                       self.base_url)},
                         retries=Retry(total=None, redirect=1, raise_on_redirect=False))

        self.assertEqual(r.status, 303)

    def test_raise_on_status(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        try:
            # the default is to raise
            r = http.request('GET', '%s/status' % self.base_url,
                             fields={'status': '500 Internal Server Error'},
                             retries=Retry(total=1, status_forcelist=range(500, 600)))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        try:
            # raise explicitly
            r = http.request('GET', '%s/status' % self.base_url,
                             fields={'status': '500 Internal Server Error'},
                             retries=Retry(total=1,
                                           status_forcelist=range(500, 600),
                                           raise_on_status=True))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        # don't raise
        r = http.request('GET', '%s/status' % self.base_url,
                         fields={'status': '500 Internal Server Error'},
                         retries=Retry(total=1,
                                       status_forcelist=range(500, 600),
                                       raise_on_status=False))

        self.assertEqual(r.status, 500)

    def test_missing_port(self):
        # Can a URL that lacks an explicit port like ':80' succeed, or
        # will all such URLs fail with an error?

        http = PoolManager()
        self.addCleanup(http.clear)

        # By globally adjusting `port_by_scheme` we pretend for a moment
        # that HTTP's default port is not 80, but is the port at which
        # our test server happens to be listening.
        port_by_scheme['http'] = self.port
        try:
            r = http.request('GET', 'http://%s/' % self.host, retries=0)
        finally:
            port_by_scheme['http'] = 80

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_headers(self):
        http = PoolManager(headers={'Foo': 'bar'})
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request('POST', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_url('GET', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_body('POST', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_url('GET', '%s/headers' % self.base_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')

        r = http.request_encode_body('GET', '%s/headers' % self.base_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')

    def test_http_with_ssl_keywords(self):
        http = PoolManager(ca_certs='REQUIRED')
        self.addCleanup(http.clear)

        r = http.request('GET', 'http://%s:%s/' % (self.host, self.port))
        self.assertEqual(r.status, 200)

    def test_http_with_ca_cert_dir(self):
        http = PoolManager(ca_certs='REQUIRED', ca_cert_dir='/nosuchdir')
        self.addCleanup(http.clear)

        r = http.request('GET', 'http://%s:%s/' % (self.host, self.port))
        self.assertEqual(r.status, 200)


@pytest.mark.skipif(
    not HAS_IPV6,
    reason='IPv6 is not supported on this system'
)
class TestIPv6PoolManager(IPv6HTTPDummyServerTestCase):

    def setUp(self):
        self.base_url = 'http://[%s]:%d' % (self.host, self.port)

    def test_ipv6(self):
        http = PoolManager()
        self.addCleanup(http.clear)
        http.request('GET', self.base_url)


if __name__ == '__main__':
    unittest.main()",,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,CVE-2019-11236,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,98,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR (VAR, VAR) VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '/VAR'}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '/VAR'}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR: VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=1) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR: VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=VAR(VAR=VAR, VAR=1)) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR', VAR) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}, VAR=VAR(VAR=[])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR(VAR['VAR'], 'VAR') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR-VAR-VAR': 'VAR', 'VAR': 'VAR'}, VAR=VAR(VAR=['VAR-VAR-VAR'])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR(VAR['VAR'], 'VAR') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=VAR(VAR=VAR, VAR=1, VAR=VAR)) VAR.VAR(VAR.VAR, 303) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR:  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600))) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR:  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600), VAR=VAR)) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600), VAR=VAR)) VAR.VAR(VAR.VAR, 500) VAR VAR(VAR):   VAR = VAR() VAR.VAR(VAR.VAR)    VAR['VAR'] = VAR.VAR VAR: VAR = VAR.VAR('VAR', 'VAR: VAR: VAR['VAR'] = 80 VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR(VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR VAR(VAR): VAR = VAR(VAR='VAR') VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', 'VAR: VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR = VAR(VAR='VAR', VAR='/VAR') VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', 'VAR: VAR.VAR(VAR.VAR, 200) @VAR.VAR.VAR( VAR VAR, VAR='VAR VAR VAR VAR VAR VAR VAR' ) VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR.VAR('VAR', VAR.VAR) VAR VAR == 'VAR': VAR.VAR() ",8,1
urllib3_0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,test/with_dummyserver/test_proxy_poolmanager.py,"import json
import socket
import unittest

import pytest

from dummyserver.testcase import HTTPDummyProxyTestCase, IPv6HTTPDummyProxyTestCase
from dummyserver.server import (
    DEFAULT_CA, DEFAULT_CA_BAD, get_unreachable_address)
from .. import TARPIT_HOST, requires_network

from urllib3._collections import HTTPHeaderDict
from urllib3.poolmanager import proxy_from_url, ProxyManager
from urllib3.exceptions import (
    MaxRetryError, SSLError, ProxyError, ConnectTimeoutError)
from urllib3.connectionpool import connection_from_url, VerifiedHTTPSConnection


class TestHTTPProxyManager(HTTPDummyProxyTestCase):

    def setUp(self):
        self.http_url = 'http://%s:%d' % (self.http_host, self.http_port)
        self.http_url_alt = 'http://%s:%d' % (self.http_host_alt,
                                              self.http_port)
        self.https_url = 'https://%s:%d' % (self.https_host, self.https_port)
        self.https_url_alt = 'https://%s:%d' % (self.https_host_alt,
                                                self.https_port)
        self.proxy_url = 'http://%s:%d' % (self.proxy_host, self.proxy_port)

    def test_basic_proxy(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)

    def test_nagle_proxy(self):
        """""" Test that proxy connections do not have TCP_NODELAY turned on """"""
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)
        hc2 = http.connection_from_host(self.http_host, self.http_port)
        conn = hc2._get_conn()
        self.addCleanup(conn.close)
        hc2._make_request(conn, 'GET', '/')
        tcp_nodelay_setting = conn.sock.getsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY)
        self.assertEqual(tcp_nodelay_setting, 0,
                         (""Expected TCP_NODELAY for proxies to be set ""
                          ""to zero, instead was %s"" % tcp_nodelay_setting))

    def test_proxy_conn_fail(self):
        host, port = get_unreachable_address()
        http = proxy_from_url('http://%s:%s/' % (host, port), retries=1, timeout=0.05)
        self.addCleanup(http.clear)
        self.assertRaises(MaxRetryError, http.request, 'GET',
                          '%s/' % self.https_url)
        self.assertRaises(MaxRetryError, http.request, 'GET',
                          '%s/' % self.http_url)

        try:
            http.request('GET', '%s/' % self.http_url)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ProxyError)

    def test_oldapi(self):
        http = ProxyManager(connection_from_url(self.proxy_url))
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)

    def test_proxy_verified(self):
        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA_BAD)
        self.addCleanup(http.clear)
        https_pool = http._new_pool('https', self.https_host,
                                    self.https_port)
        try:
            https_pool.request('GET', '/', retries=0)
            self.fail(""Didn't raise SSL error with wrong CA"")
        except MaxRetryError as e:
            self.assertIsInstance(e.reason, SSLError)
            self.assertIn('certificate verify failed', str(e.reason),
                          ""Expected 'certificate verify failed',""
                          ""instead got: %r"" % e.reason)

        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA)
        https_pool = http._new_pool('https', self.https_host,
                                    self.https_port)

        conn = https_pool._new_conn()
        self.assertEqual(conn.__class__, VerifiedHTTPSConnection)
        https_pool.request('GET', '/')  # Should succeed without exceptions.

        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA)
        https_fail_pool = http._new_pool('https', '127.0.0.1', self.https_port)

        try:
            https_fail_pool.request('GET', '/', retries=0)
            self.fail(""Didn't raise SSL invalid common name"")
        except MaxRetryError as e:
            self.assertIsInstance(e.reason, SSLError)
            self.assertIn(""doesn't match"", str(e.reason))

    def test_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/' % self.http_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/' % self.http_url})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_cross_host_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        cross_host_location = '%s/echo?a=b' % self.http_url_alt
        try:
            http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': cross_host_location},
                         timeout=1, retries=0)
            self.fail(""We don't want to follow redirects here."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/echo?a=b' % self.http_url_alt},
                         timeout=1, retries=1)
        self.assertNotEqual(r._pool.host, self.http_host_alt)

    def test_cross_protocol_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        cross_protocol_location = '%s/echo?a=b' % self.https_url
        try:
            http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': cross_protocol_location},
                         timeout=1, retries=0)
            self.fail(""We don't want to follow redirects here."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/echo?a=b' % self.https_url},
                         timeout=1, retries=1)
        self.assertEqual(r._pool.host, self.https_host)

    def test_headers(self):
        http = proxy_from_url(self.proxy_url, headers={'Foo': 'bar'},
                              proxy_headers={'Hickory': 'dickory'})
        self.addCleanup(http.clear)

        r = http.request_encode_url('GET', '%s/headers' % self.http_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.http_url_alt)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host_alt, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url_alt)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host_alt, self.https_port))

        r = http.request_encode_body('POST', '%s/headers' % self.http_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.http_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

        r = http.request_encode_body('GET', '%s/headers' % self.http_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_body('GET', '%s/headers' % self.https_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

    def test_headerdict(self):
        default_headers = HTTPHeaderDict(a='b')
        proxy_headers = HTTPHeaderDict()
        proxy_headers.add('foo', 'bar')

        http = proxy_from_url(
            self.proxy_url,
            headers=default_headers,
            proxy_headers=proxy_headers)
        self.addCleanup(http.clear)

        request_headers = HTTPHeaderDict(baz='quux')
        r = http.request('GET', '%s/headers' % self.http_url, headers=request_headers)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Baz'), 'quux')

    def test_proxy_pooling(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        for x in range(2):
            http.urlopen('GET', self.http_url)
        self.assertEqual(len(http.pools), 1)

        for x in range(2):
            http.urlopen('GET', self.http_url_alt)
        self.assertEqual(len(http.pools), 1)

        for x in range(2):
            http.urlopen('GET', self.https_url)
        self.assertEqual(len(http.pools), 2)

        for x in range(2):
            http.urlopen('GET', self.https_url_alt)
        self.assertEqual(len(http.pools), 3)

    def test_proxy_pooling_ext(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        hc1 = http.connection_from_url(self.http_url)
        hc2 = http.connection_from_host(self.http_host, self.http_port)
        hc3 = http.connection_from_url(self.http_url_alt)
        hc4 = http.connection_from_host(self.http_host_alt, self.http_port)
        self.assertEqual(hc1, hc2)
        self.assertEqual(hc2, hc3)
        self.assertEqual(hc3, hc4)

        sc1 = http.connection_from_url(self.https_url)
        sc2 = http.connection_from_host(self.https_host,
                                        self.https_port, scheme='https')
        sc3 = http.connection_from_url(self.https_url_alt)
        sc4 = http.connection_from_host(self.https_host_alt,
                                        self.https_port, scheme='https')
        self.assertEqual(sc1, sc2)
        self.assertNotEqual(sc2, sc3)
        self.assertEqual(sc3, sc4)

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_timeout(self):
        https = proxy_from_url('https://{host}'.format(host=TARPIT_HOST))
        self.addCleanup(https.clear)
        try:
            https.request('GET', self.http_url, timeout=0.001)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ConnectTimeoutError)

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_pool_timeout(self):
        https = proxy_from_url('https://{host}'.format(host=TARPIT_HOST),
                               timeout=0.001)
        self.addCleanup(https.clear)
        try:
            https.request('GET', self.http_url)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ConnectTimeoutError)

    def test_scheme_host_case_insensitive(self):
        """"""Assert that upper-case schemes and hosts are normalized.""""""
        http = proxy_from_url(self.proxy_url.upper())
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url.upper())
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url.upper())
        self.assertEqual(r.status, 200)


class TestIPv6HTTPProxyManager(IPv6HTTPDummyProxyTestCase):

    def setUp(self):
        self.http_url = 'http://%s:%d' % (self.http_host, self.http_port)
        self.http_url_alt = 'http://%s:%d' % (self.http_host_alt,
                                              self.http_port)
        self.https_url = 'https://%s:%d' % (self.https_host, self.https_port)
        self.https_url_alt = 'https://%s:%d' % (self.https_host_alt,
                                                self.https_port)
        self.proxy_url = 'http://[%s]:%d' % (self.proxy_host, self.proxy_port)

    def test_basic_ipv6_proxy(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)


if __name__ == '__main__':
    unittest.main()",,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,CVE-2019-11236,0aa3e24fcd75f1bb59ab159e9f8adb44055b2271,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,98,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR) VAR .. VAR VAR, VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR) VAR VAR.VAR VAR VAR, VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR) VAR.VAR(VAR, 'VAR', '/') VAR = VAR.VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR, 0, (""VAR VAR VAR VAR VAR VAR VAR "" ""VAR VAR, VAR VAR %VAR"" % VAR)) VAR VAR(VAR): VAR, VAR = VAR() VAR = VAR('VAR: VAR.VAR(VAR.VAR) VAR.VAR(VAR, VAR.VAR, 'VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR, VAR.VAR, 'VAR', '%VAR/' % VAR.VAR) VAR: VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) VAR VAR(VAR): VAR = VAR(VAR(VAR.VAR)) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', VAR.VAR, VAR.VAR) VAR: VAR.VAR('VAR', '/', VAR=0) VAR.VAR(""VAR'VAR VAR VAR VAR VAR VAR VAR"") VAR VAR VAR VAR: VAR.VAR(VAR.VAR, VAR) VAR.VAR('VAR VAR VAR', VAR(VAR.VAR), ""VAR 'VAR VAR VAR',"" ""VAR VAR: %VAR"" % VAR.VAR) VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR = VAR.VAR('VAR', VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR, VAR) VAR.VAR('VAR', '/')  VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR = VAR.VAR('VAR', '127.0.0.1', VAR.VAR) VAR: VAR.VAR('VAR', '/', VAR=0) VAR.VAR(""VAR'VAR VAR VAR VAR VAR VAR"") VAR VAR VAR VAR: VAR.VAR(VAR.VAR, VAR) VAR.VAR(""VAR'VAR VAR"", VAR(VAR.VAR)) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR'VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR'VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR={'VAR': 'VAR'}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR VAR(VAR): VAR = VAR(VAR='VAR') VAR = VAR() VAR.VAR('VAR', 'VAR') VAR = VAR( VAR.VAR, VAR=VAR, VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR(VAR='VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR=VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 1) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 1) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 2) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 3) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR='VAR') VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR='VAR') VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR = VAR('VAR: VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', VAR.VAR, VAR=0.001) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR = VAR('VAR: VAR=0.001) VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', VAR.VAR) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) VAR VAR(VAR): """"""VAR VAR VAR-VAR VAR VAR VAR VAR VAR."""""" VAR = VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR.VAR()) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR.VAR()) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR == 'VAR': VAR.VAR() ",8,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,dummyserver/proxy.py,"#!/usr/bin/env python
#
# Simple asynchronous HTTP proxy with tunnelling (CONNECT).
#
# GET/POST proxying based on
# http://groups.google.com/group/python-tornado/msg/7bea08e7a049cf26
#
# Copyright (C) 2012 Senko Rasic <senko.rasic@dobarkod.hr>
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the ""Software""), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.

import socket
import ssl
import sys

import tornado.gen
import tornado.httpclient
import tornado.httpserver
import tornado.ioloop
import tornado.iostream
import tornado.web

__all__ = [""ProxyHandler"", ""run_proxy""]


class ProxyHandler(tornado.web.RequestHandler):
    SUPPORTED_METHODS = [""GET"", ""POST"", ""CONNECT""]

    @tornado.gen.coroutine
    def get(self):
        def handle_response(response):
            if response.error and not isinstance(
                response.error, tornado.httpclient.HTTPError
            ):
                self.set_status(500)
                self.write(""Internal server error:\n"" + str(response.error))
                self.finish()
            else:
                self.set_status(response.code)
                for header in (
                    ""Date"",
                    ""Cache-Control"",
                    ""Server"",
                    ""Content-Type"",
                    ""Location"",
                ):
                    v = response.headers.get(header)
                    if v:
                        self.set_header(header, v)
                if response.body:
                    self.write(response.body)
                self.finish()

        upstream_ca_certs = self.application.settings.get(""upstream_ca_certs"", None)
        ssl_options = None

        if upstream_ca_certs:
            ssl_options = ssl.create_default_context(cafile=upstream_ca_certs)

        req = tornado.httpclient.HTTPRequest(
            url=self.request.uri,
            method=self.request.method,
            body=self.request.body,
            headers=self.request.headers,
            follow_redirects=False,
            allow_nonstandard_methods=True,
            ssl_options=ssl_options,
        )

        client = tornado.httpclient.AsyncHTTPClient()
        try:
            response = yield client.fetch(req)
            yield handle_response(response)
        except tornado.httpclient.HTTPError as e:
            if hasattr(e, ""response"") and e.response:
                yield handle_response(e.response)
            else:
                self.set_status(500)
                self.write(""Internal server error:\n"" + str(e))
                self.finish()

    @tornado.gen.coroutine
    def post(self):
        yield self.get()

    @tornado.gen.coroutine
    def connect(self):
        host, port = self.request.uri.split("":"")
        client = self.request.connection.stream

        @tornado.gen.coroutine
        def start_forward(reader, writer):
            while True:
                try:
                    data = yield reader.read_bytes(4096, partial=True)
                except tornado.iostream.StreamClosedError:
                    break
                if not data:
                    break
                writer.write(data)
            writer.close()

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
        upstream = tornado.iostream.IOStream(s)
        yield upstream.connect((host, int(port)))

        client.write(b""HTTP/1.0 200 Connection established\r\n\r\n"")
        fu1 = start_forward(client, upstream)
        fu2 = start_forward(upstream, client)
        yield [fu1, fu2]


def run_proxy(port, start_ioloop=True):
    """"""
    Run proxy on the specified port. If start_ioloop is True (default),
    the tornado IOLoop will be started immediately.
    """"""
    app = tornado.web.Application([(r"".*"", ProxyHandler)])
    app.listen(port)
    ioloop = tornado.ioloop.IOLoop.instance()
    if start_ioloop:
        ioloop.start()


if __name__ == ""__main__"":
    port = 8888
    if len(sys.argv) > 1:
        port = int(sys.argv[1])

    print(""Starting HTTP proxy on port %d"" % port)
    run_proxy(port)",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"                          VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR = [""VAR"", ""VAR""] VAR VAR(VAR.VAR.VAR): VAR = [""VAR"", ""VAR"", ""VAR""] @VAR.VAR.VAR VAR VAR(VAR): VAR VAR(VAR): VAR VAR.VAR VAR VAR VAR( VAR.VAR, VAR.VAR.VAR ): VAR.VAR(500) VAR.VAR(""VAR VAR VAR:\VAR"" + VAR(VAR.VAR)) VAR.VAR() VAR: VAR.VAR(VAR.VAR) VAR VAR VAR ( ""VAR"", ""VAR-VAR"", ""VAR"", ""VAR-VAR"", ""VAR"", ): VAR = VAR.VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR.VAR() VAR = VAR.VAR.VAR.VAR(""VAR"", VAR) VAR = VAR VAR VAR: VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR.VAR( VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR, VAR=VAR, VAR=VAR, ) VAR = VAR.VAR.VAR() VAR: VAR = VAR VAR.VAR(VAR) VAR VAR(VAR) VAR VAR.VAR.VAR VAR VAR: VAR VAR(VAR, ""VAR"") VAR VAR.VAR: VAR VAR(VAR.VAR) VAR: VAR.VAR(500) VAR.VAR(""VAR VAR VAR:\VAR"" + VAR(VAR)) VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR, VAR = VAR.VAR.VAR.VAR("":"") VAR = VAR.VAR.VAR.VAR @VAR.VAR.VAR VAR VAR(VAR, VAR): VAR VAR: VAR: VAR = VAR VAR.VAR(4096, VAR=VAR) VAR VAR.VAR.VAR: VAR VAR VAR VAR: VAR VAR.VAR(VAR) VAR.VAR() VAR = VAR.VAR(VAR.VAR, VAR.VAR, 0) VAR = VAR.VAR.VAR(VAR) VAR VAR.VAR((VAR, VAR(VAR))) VAR.VAR(VAR""VAR/1.0 200 VAR VAR\VAR\VAR\VAR\VAR"") VAR = VAR(VAR, VAR) VAR = VAR(VAR, VAR) VAR [VAR, VAR] VAR VAR(VAR, VAR=VAR): """""" VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR (VAR), VAR VAR VAR VAR VAR VAR VAR. """""" VAR = VAR.VAR.VAR([(VAR"".*"", VAR)]) VAR.VAR(VAR) VAR = VAR.VAR.VAR.VAR() VAR VAR: VAR.VAR() VAR VAR == ""VAR"": VAR = 8888 VAR VAR(VAR.VAR) > 1: VAR = VAR(VAR.VAR[1]) VAR(""VAR VAR VAR VAR VAR %VAR"" % VAR) VAR(VAR) ",16,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/appengine/test_urlfetch.py,"""""""These tests ensure that when running in App Engine standard with the
App Engine sandbox enabled that urllib3 appropriately uses the App
Engine-patched version of httplib to make requests.""""""

import httplib
import pytest
import StringIO
from mock import patch

from ..test_no_ssl import TestWithoutSSL


class MockResponse(object):
    def __init__(self, content, status_code, content_was_truncated, final_url, headers):

        self.content = content
        self.status_code = status_code
        self.content_was_truncated = content_was_truncated
        self.final_url = final_url
        self.header_msg = httplib.HTTPMessage(
            StringIO.StringIO(
                """".join([""%s: %s\n"" % (k, v) for k, v in headers.iteritems()] + [""\n""])
            )
        )
        self.headers = headers


@pytest.mark.usefixtures(""sandbox"")
class TestHTTP(TestWithoutSSL):
    def test_urlfetch_called_with_http(self):
        """"""Check that URLFetch is used to fetch non-https resources.""""""
        resp = MockResponse(
            ""OK"", 200, False, ""http://www.google.com"", {""content-type"": ""text/plain""}
        )
        fetch_patch = patch(""google.appengine.api.urlfetch.fetch"", return_value=resp)
        with fetch_patch as fetch_mock:
            import urllib3

            pool = urllib3.HTTPConnectionPool(""www.google.com"", ""80"")
            r = pool.request(""GET"", ""/"")
            assert r.status == 200, r.data
            assert fetch_mock.call_count == 1


@pytest.mark.usefixtures(""sandbox"")
class TestHTTPS(object):
    @pytest.mark.xfail(
        reason=""This is not yet supported by urlfetch, presence of the ssl ""
        ""module will bypass urlfetch.""
    )
    def test_urlfetch_called_with_https(self):
        """"""
        Check that URLFetch is used when fetching https resources
        """"""
        resp = MockResponse(
            ""OK"", 200, False, ""https://www.google.com"", {""content-type"": ""text/plain""}
        )
        fetch_patch = patch(""google.appengine.api.urlfetch.fetch"", return_value=resp)
        with fetch_patch as fetch_mock:
            import urllib3

            pool = urllib3.HTTPSConnectionPool(""www.google.com"", ""443"")
            pool.ConnectionCls = urllib3.connection.UnverifiedHTTPSConnection
            r = pool.request(""GET"", ""/"")
            assert r.status == 200, r.data
            assert fetch_mock.call_count == 1",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"""""""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR VAR VAR VAR VAR."""""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR ..VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR, VAR, VAR, VAR, VAR, VAR): VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR.VAR( VAR.VAR( """".VAR([""%VAR: %VAR\VAR"" % (VAR, VAR) VAR VAR, VAR VAR VAR.VAR()] + [""\VAR""]) ) ) VAR.VAR = VAR @VAR.VAR.VAR(""VAR"") VAR VAR(VAR): VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR."""""" VAR = VAR( ""VAR"", 200, VAR, ""VAR: ) VAR = VAR(""VAR.VAR.VAR.VAR.VAR"", VAR=VAR) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR(""VAR.VAR.VAR"", ""80"") VAR = VAR.VAR(""VAR"", ""/"") VAR VAR.VAR == 200, VAR.VAR VAR VAR.VAR == 1 @VAR.VAR.VAR(""VAR"") VAR VAR(VAR): @VAR.VAR.VAR( VAR=""VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR "" ""VAR VAR VAR VAR."" ) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR( ""VAR"", 200, VAR, ""VAR: ) VAR = VAR(""VAR.VAR.VAR.VAR.VAR"", VAR=VAR) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR(""VAR.VAR.VAR"", ""443"") VAR.VAR = VAR.VAR.VAR VAR = VAR.VAR(""VAR"", ""/"") VAR VAR.VAR == 200, VAR.VAR VAR VAR.VAR == 1 ",8,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/test_retry.py,"import warnings

import mock
import pytest

from urllib3.exceptions import (
    ConnectTimeoutError,
    InvalidHeader,
    MaxRetryError,
    ReadTimeoutError,
    ResponseError,
    SSLError,
)
from urllib3.packages import six
from urllib3.packages.six.moves import xrange
from urllib3.response import HTTPResponse
from urllib3.util.retry import RequestHistory, Retry


@pytest.fixture(scope=""function"", autouse=True)
def no_retry_deprecations():
    with warnings.catch_warnings(record=True) as w:
        yield
    assert len([str(x.message) for x in w if ""Retry"" in str(x.message)]) == 0


class TestRetry(object):
    def test_string(self):
        """"""Retry string representation looks the way we expect""""""
        retry = Retry()
        assert (
            str(retry)
            == ""Retry(total=10, connect=None, read=None, redirect=None, status=None)""
        )
        for _ in range(3):
            retry = retry.increment(method=""GET"")
        assert (
            str(retry)
            == ""Retry(total=7, connect=None, read=None, redirect=None, status=None)""
        )

    def test_retry_both_specified(self):
        """"""Total can win if it's lower than the connect value""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=3, total=2)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

    def test_retry_higher_total_loses(self):
        """"""A lower connect timeout than the total is honored""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=3)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

    def test_retry_higher_total_loses_vs_read(self):
        """"""A lower read timeout than the total is honored""""""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=2, total=3)
        retry = retry.increment(method=""GET"", error=error)
        retry = retry.increment(method=""GET"", error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(method=""GET"", error=error)

    def test_retry_total_none(self):
        """"""if Total is none, connect error should take precedence""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=None)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(connect=2, total=None)
        retry = retry.increment(method=""GET"", error=error)
        retry = retry.increment(method=""GET"", error=error)
        retry = retry.increment(method=""GET"", error=error)
        assert not retry.is_exhausted()

    def test_retry_default(self):
        """"""If no value is specified, should retry connects 3 times""""""
        retry = Retry()
        assert retry.total == 10
        assert retry.connect is None
        assert retry.read is None
        assert retry.redirect is None
        assert retry.other is None

        error = ConnectTimeoutError()
        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        assert not retry.is_exhausted()

        assert Retry(0).raise_on_redirect
        assert not Retry(False).raise_on_redirect

    def test_retry_other(self):
        """"""If an unexpected error is raised, should retry other times""""""
        other_error = SSLError()
        retry = Retry(connect=1)
        retry = retry.increment(error=other_error)
        retry = retry.increment(error=other_error)
        assert not retry.is_exhausted()

        retry = Retry(other=1)
        retry = retry.increment(error=other_error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=other_error)
        assert e.value.reason == other_error

    def test_retry_read_zero(self):
        """"""No second chances on read timeouts, by default""""""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=0)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(method=""GET"", error=error)
        assert e.value.reason == error

    def test_status_counter(self):
        resp = HTTPResponse(status=400)
        retry = Retry(status=2)
        retry = retry.increment(response=resp)
        retry = retry.increment(response=resp)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(response=resp)
        assert str(e.value.reason) == ResponseError.SPECIFIC_ERROR.format(
            status_code=400
        )

    def test_backoff(self):
        """"""Backoff is computed correctly""""""
        max_backoff = Retry.BACKOFF_MAX

        retry = Retry(total=100, backoff_factor=0.2)
        assert retry.get_backoff_time() == 0  # First request

        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0  # First retry

        retry = retry.increment(method=""GET"")
        assert retry.backoff_factor == 0.2
        assert retry.total == 98
        assert retry.get_backoff_time() == 0.4  # Start backoff

        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0.8

        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 1.6

        for _ in xrange(10):
            retry = retry.increment(method=""GET"")

        assert retry.get_backoff_time() == max_backoff

    def test_zero_backoff(self):
        retry = Retry()
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0

    def test_backoff_reset_after_redirect(self):
        retry = Retry(total=100, redirect=5, backoff_factor=0.2)
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0.4
        redirect_response = HTTPResponse(status=302, headers={""location"": ""test""})
        retry = retry.increment(method=""GET"", response=redirect_response)
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0.4

    def test_sleep(self):
        # sleep a very small amount of time so our code coverage is happy
        retry = Retry(backoff_factor=0.0001)
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        retry.sleep()

    def test_status_forcelist(self):
        retry = Retry(status_forcelist=xrange(500, 600))
        assert not retry.is_retry(""GET"", status_code=200)
        assert not retry.is_retry(""GET"", status_code=400)
        assert retry.is_retry(""GET"", status_code=500)

        retry = Retry(total=1, status_forcelist=[418])
        assert not retry.is_retry(""GET"", status_code=400)
        assert retry.is_retry(""GET"", status_code=418)

        # String status codes are not matched.
        retry = Retry(total=1, status_forcelist=[""418""])
        assert not retry.is_retry(""GET"", status_code=418)

    def test_allowed_methods_with_status_forcelist(self):
        # Falsey allowed_methods means to retry on any method.
        retry = Retry(status_forcelist=[500], allowed_methods=None)
        assert retry.is_retry(""GET"", status_code=500)
        assert retry.is_retry(""POST"", status_code=500)

        # Criteria of allowed_methods and status_forcelist are ANDed.
        retry = Retry(status_forcelist=[500], allowed_methods=[""POST""])
        assert not retry.is_retry(""GET"", status_code=500)
        assert retry.is_retry(""POST"", status_code=500)

    def test_exhausted(self):
        assert not Retry(0).is_exhausted()
        assert Retry(-1).is_exhausted()
        assert Retry(1).increment(method=""GET"").total == 0

    @pytest.mark.parametrize(""total"", [-1, 0])
    def test_disabled(self, total):
        with pytest.raises(MaxRetryError):
            Retry(total).increment(method=""GET"")

    def test_error_message(self):
        retry = Retry(total=0)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(
                method=""GET"", error=ReadTimeoutError(None, ""/"", ""read timed out"")
            )
        assert ""Caused by redirect"" not in str(e.value)
        assert str(e.value.reason) == ""None: read timed out""

        retry = Retry(total=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(""POST"", ""/"")
            retry = retry.increment(""POST"", ""/"")
        assert ""Caused by redirect"" not in str(e.value)
        assert isinstance(e.value.reason, ResponseError)
        assert str(e.value.reason) == ResponseError.GENERIC_ERROR

        retry = Retry(total=1)
        response = HTTPResponse(status=500)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(""POST"", ""/"", response=response)
            retry = retry.increment(""POST"", ""/"", response=response)
        assert ""Caused by redirect"" not in str(e.value)
        msg = ResponseError.SPECIFIC_ERROR.format(status_code=500)
        assert str(e.value.reason) == msg

        retry = Retry(connect=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(error=ConnectTimeoutError(""conntimeout""))
            retry = retry.increment(error=ConnectTimeoutError(""conntimeout""))
        assert ""Caused by redirect"" not in str(e.value)
        assert str(e.value.reason) == ""conntimeout""

    def test_history(self):
        retry = Retry(total=10, allowed_methods=frozenset([""GET"", ""POST""]))
        assert retry.history == tuple()
        connection_error = ConnectTimeoutError(""conntimeout"")
        retry = retry.increment(""GET"", ""/test1"", None, connection_error)
        history = (RequestHistory(""GET"", ""/test1"", connection_error, None, None),)
        assert retry.history == history

        read_error = ReadTimeoutError(None, ""/test2"", ""read timed out"")
        retry = retry.increment(""POST"", ""/test2"", None, read_error)
        history = (
            RequestHistory(""GET"", ""/test1"", connection_error, None, None),
            RequestHistory(""POST"", ""/test2"", read_error, None, None),
        )
        assert retry.history == history

        response = HTTPResponse(status=500)
        retry = retry.increment(""GET"", ""/test3"", response, None)
        history = (
            RequestHistory(""GET"", ""/test1"", connection_error, None, None),
            RequestHistory(""POST"", ""/test2"", read_error, None, None),
            RequestHistory(""GET"", ""/test3"", None, 500, None),
        )
        assert retry.history == history

    def test_retry_method_not_in_whitelist(self):
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry()
        with pytest.raises(ReadTimeoutError):
            retry.increment(method=""POST"", error=error)

    def test_retry_default_remove_headers_on_redirect(self):
        retry = Retry()

        assert list(retry.remove_headers_on_redirect) == [""authorization""]

    def test_retry_set_remove_headers_on_redirect(self):
        retry = Retry(remove_headers_on_redirect=[""X-API-Secret""])

        assert list(retry.remove_headers_on_redirect) == [""x-api-secret""]

    @pytest.mark.parametrize(""value"", [""-1"", ""+1"", ""1.0"", six.u(""\xb2"")])  # \xb2 = ^2
    def test_parse_retry_after_invalid(self, value):
        retry = Retry()
        with pytest.raises(InvalidHeader):
            retry.parse_retry_after(value)

    @pytest.mark.parametrize(
        ""value, expected"", [(""0"", 0), (""1000"", 1000), (""\t42 "", 42)]
    )
    def test_parse_retry_after(self, value, expected):
        retry = Retry()
        assert retry.parse_retry_after(value) == expected

    @pytest.mark.parametrize(""respect_retry_after_header"", [True, False])
    def test_respect_retry_after_header_propagated(self, respect_retry_after_header):

        retry = Retry(respect_retry_after_header=respect_retry_after_header)
        new_retry = retry.new()
        assert new_retry.respect_retry_after_header == respect_retry_after_header

    @pytest.mark.freeze_time(""2019-06-03 11:00:00"", tz_offset=0)
    @pytest.mark.parametrize(
        ""retry_after_header,respect_retry_after_header,sleep_duration"",
        [
            (""3600"", True, 3600),
            (""3600"", False, None),
            # Will sleep due to header is 1 hour in future
            (""Mon, 3 Jun 2019 12:00:00 UTC"", True, 3600),
            # Won't sleep due to not respecting header
            (""Mon, 3 Jun 2019 12:00:00 UTC"", False, None),
            # Won't sleep due to current time reached
            (""Mon, 3 Jun 2019 11:00:00 UTC"", True, None),
            # Won't sleep due to current time reached + not respecting header
            (""Mon, 3 Jun 2019 11:00:00 UTC"", False, None),
            # Handle all the formats in RFC 7231 Section 7.1.1.1
            (""Mon, 03 Jun 2019 11:30:12 GMT"", True, 1812),
            (""Monday, 03-Jun-19 11:30:12 GMT"", True, 1812),
            # Assume that datetimes without a timezone are in UTC per RFC 7231
            (""Mon Jun  3 11:30:12 2019"", True, 1812),
        ],
    )
    @pytest.mark.parametrize(
        ""stub_timezone"",
        [
            ""UTC"",
            ""Asia/Jerusalem"",
            None,
        ],
        indirect=True,
    )
    @pytest.mark.usefixtures(""stub_timezone"")
    def test_respect_retry_after_header_sleep(
        self, retry_after_header, respect_retry_after_header, sleep_duration
    ):
        retry = Retry(respect_retry_after_header=respect_retry_after_header)

        with mock.patch(""time.sleep"") as sleep_mock:
            # for the default behavior, it must be in RETRY_AFTER_STATUS_CODES
            response = HTTPResponse(
                status=503, headers={""Retry-After"": retry_after_header}
            )

            retry.sleep(response)

            # The expected behavior is that we'll only sleep if respecting
            # this header (since we won't have any backoff sleep attempts)
            if respect_retry_after_header and sleep_duration is not None:
                sleep_mock.assert_called_with(sleep_duration)
            else:
                sleep_mock.assert_not_called()",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR, VAR, VAR, ) VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR @VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR(): VAR VAR.VAR(VAR=VAR) VAR VAR: VAR VAR VAR([VAR(VAR.VAR) VAR VAR VAR VAR VAR ""VAR"" VAR VAR(VAR.VAR)]) == 0 VAR VAR(VAR): VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR ( VAR(VAR) == ""VAR(VAR=10, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)"" ) VAR VAR VAR VAR(3): VAR = VAR.VAR(VAR=""VAR"") VAR ( VAR(VAR) == ""VAR(VAR=7, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)"" ) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=3, VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR, VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR VAR.VAR() VAR VAR(VAR): """"""VAR VAR VAR VAR VAR, VAR VAR VAR 3 VAR"""""" VAR = VAR() VAR VAR.VAR == 10 VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR VAR(0).VAR VAR VAR VAR(VAR).VAR VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR"""""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR=400) VAR = VAR(VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR.VAR( VAR=400 ) VAR VAR(VAR): """"""VAR VAR VAR VAR"""""" VAR = VAR.VAR VAR = VAR(VAR=100, VAR=0.2) VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR == 0.2 VAR VAR.VAR == 98 VAR VAR.VAR() == 0.4  VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0.8 VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 1.6 VAR VAR VAR VAR(10): VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == VAR VAR VAR(VAR): VAR = VAR() VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0 VAR VAR(VAR): VAR = VAR(VAR=100, VAR=5, VAR=0.2) VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0.4 VAR = VAR(VAR=302, VAR={""VAR"": ""VAR""}) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0.4 VAR VAR(VAR):  VAR = VAR(VAR=0.0001) VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR.VAR() VAR VAR(VAR): VAR = VAR(VAR=VAR(500, 600)) VAR VAR VAR.VAR(""VAR"", VAR=200) VAR VAR VAR.VAR(""VAR"", VAR=400) VAR VAR.VAR(""VAR"", VAR=500) VAR = VAR(VAR=1, VAR=[418]) VAR VAR VAR.VAR(""VAR"", VAR=400) VAR VAR.VAR(""VAR"", VAR=418)  VAR = VAR(VAR=1, VAR=[""418""]) VAR VAR VAR.VAR(""VAR"", VAR=418) VAR VAR(VAR):  VAR = VAR(VAR=[500], VAR=VAR) VAR VAR.VAR(""VAR"", VAR=500) VAR VAR.VAR(""VAR"", VAR=500)  VAR = VAR(VAR=[500], VAR=[""VAR""]) VAR VAR VAR.VAR(""VAR"", VAR=500) VAR VAR.VAR(""VAR"", VAR=500) VAR VAR(VAR): VAR VAR VAR(0).VAR() VAR VAR(-1).VAR() VAR VAR(1).VAR(VAR=""VAR"").VAR == 0 @VAR.VAR.VAR(""VAR"", [-1, 0]) VAR VAR(VAR, VAR): VAR VAR.VAR(VAR): VAR(VAR).VAR(VAR=""VAR"") VAR VAR(VAR): VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR( VAR=""VAR"", VAR=VAR(VAR, ""/"", ""VAR VAR VAR"") ) VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == ""VAR: VAR VAR VAR"" VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""/"") VAR = VAR.VAR(""VAR"", ""/"") VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR, VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR VAR = VAR(VAR=1) VAR = VAR(VAR=500) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""/"", VAR=VAR) VAR = VAR.VAR(""VAR"", ""/"", VAR=VAR) VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR = VAR.VAR.VAR(VAR=500) VAR VAR(VAR.VAR.VAR) == VAR VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR=VAR(""VAR"")) VAR = VAR.VAR(VAR=VAR(""VAR"")) VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == ""VAR"" VAR VAR(VAR): VAR = VAR(VAR=10, VAR=VAR([""VAR"", ""VAR""])) VAR VAR.VAR == VAR() VAR = VAR(""VAR"") VAR = VAR.VAR(""VAR"", ""/VAR"", VAR, VAR) VAR = (VAR(""VAR"", ""/VAR"", VAR, VAR, VAR),) VAR VAR.VAR == VAR VAR = VAR(VAR, ""/VAR"", ""VAR VAR VAR"") VAR = VAR.VAR(""VAR"", ""/VAR"", VAR, VAR) VAR = ( VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), ) VAR VAR.VAR == VAR VAR = VAR(VAR=500) VAR = VAR.VAR(""VAR"", ""/VAR"", VAR, VAR) VAR = ( VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), VAR(""VAR"", ""/VAR"", VAR, 500, VAR), ) VAR VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR(VAR): VAR = VAR() VAR VAR(VAR.VAR) == [""VAR""] VAR VAR(VAR): VAR = VAR(VAR=[""VAR-VAR-VAR""]) VAR VAR(VAR.VAR) == [""VAR-VAR-VAR""] @VAR.VAR.VAR(""VAR"", [""-1"", ""+1"", ""1.0"", VAR.VAR(""\VAR"")])  VAR VAR(VAR, VAR): VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR) @VAR.VAR.VAR( ""VAR, VAR"", [(""0"", 0), (""1000"", 1000), (""\VAR "", 42)] ) VAR VAR(VAR, VAR, VAR): VAR = VAR() VAR VAR.VAR(VAR) == VAR @VAR.VAR.VAR(""VAR"", [VAR, VAR]) VAR VAR(VAR, VAR): VAR = VAR(VAR=VAR) VAR = VAR.VAR() VAR VAR.VAR == VAR @VAR.VAR.VAR(""2019-06-03 11:00:00"", VAR=0) @VAR.VAR.VAR( ""VAR,VAR,VAR"", [ (""3600"", VAR, 3600), (""3600"", VAR, VAR),  (""VAR, 3 VAR 2019 12:00:00 VAR"", VAR, 3600),  (""VAR, 3 VAR 2019 12:00:00 VAR"", VAR, VAR),  (""VAR, 3 VAR 2019 11:00:00 VAR"", VAR, VAR),  (""VAR, 3 VAR 2019 11:00:00 VAR"", VAR, VAR),  (""VAR, 03 VAR 2019 11:30:12 VAR"", VAR, 1812), (""VAR, 03-VAR-19 11:30:12 VAR"", VAR, 1812),  (""VAR VAR 3 11:30:12 2019"", VAR, 1812), ], ) @VAR.VAR.VAR( ""VAR"", [ ""VAR"", ""VAR/VAR"", VAR, ], VAR=VAR, ) @VAR.VAR.VAR(""VAR"") VAR VAR( VAR, VAR, VAR, VAR ): VAR = VAR(VAR=VAR) VAR VAR.VAR(""VAR.VAR"") VAR VAR:  VAR = VAR( VAR=503, VAR={""VAR-VAR"": VAR} ) VAR.VAR(VAR)   VAR VAR VAR VAR VAR VAR VAR: VAR.VAR(VAR) VAR: VAR.VAR() ",0,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/test_retry_deprecated.py,"# This is a copy-paste of test_retry.py with extra asserts about deprecated options. It will be removed for v2.
import warnings

import mock
import pytest

from urllib3.exceptions import (
    ConnectTimeoutError,
    InvalidHeader,
    MaxRetryError,
    ReadTimeoutError,
    ResponseError,
    SSLError,
)
from urllib3.packages import six
from urllib3.packages.six.moves import xrange
from urllib3.response import HTTPResponse
from urllib3.util.retry import RequestHistory, Retry


# TODO: Remove this entire file once deprecated Retry options are removed in v2.
@pytest.fixture(scope=""function"")
def expect_retry_deprecation():
    with warnings.catch_warnings(record=True) as w:
        yield
    assert len([str(x.message) for x in w if ""Retry"" in str(x.message)]) > 0


class TestRetry(object):
    def test_string(self):
        """"""Retry string representation looks the way we expect""""""
        retry = Retry()
        assert (
            str(retry)
            == ""Retry(total=10, connect=None, read=None, redirect=None, status=None)""
        )
        for _ in range(3):
            retry = retry.increment(method=""GET"")
        assert (
            str(retry)
            == ""Retry(total=7, connect=None, read=None, redirect=None, status=None)""
        )

    def test_retry_both_specified(self):
        """"""Total can win if it's lower than the connect value""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=3, total=2)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

    def test_retry_higher_total_loses(self):
        """"""A lower connect timeout than the total is honored""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=3)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

    def test_retry_higher_total_loses_vs_read(self):
        """"""A lower read timeout than the total is honored""""""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=2, total=3)
        retry = retry.increment(method=""GET"", error=error)
        retry = retry.increment(method=""GET"", error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(method=""GET"", error=error)

    def test_retry_total_none(self):
        """"""if Total is none, connect error should take precedence""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=None)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(connect=2, total=None)
        retry = retry.increment(method=""GET"", error=error)
        retry = retry.increment(method=""GET"", error=error)
        retry = retry.increment(method=""GET"", error=error)
        assert not retry.is_exhausted()

    def test_retry_default(self):
        """"""If no value is specified, should retry connects 3 times""""""
        retry = Retry()
        assert retry.total == 10
        assert retry.connect is None
        assert retry.read is None
        assert retry.redirect is None
        assert retry.other is None

        error = ConnectTimeoutError()
        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        assert not retry.is_exhausted()

        assert Retry(0).raise_on_redirect
        assert not Retry(False).raise_on_redirect

    def test_retry_other(self):
        """"""If an unexpected error is raised, should retry other times""""""
        other_error = SSLError()
        retry = Retry(connect=1)
        retry = retry.increment(error=other_error)
        retry = retry.increment(error=other_error)
        assert not retry.is_exhausted()

        retry = Retry(other=1)
        retry = retry.increment(error=other_error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=other_error)
        assert e.value.reason == other_error

    def test_retry_read_zero(self):
        """"""No second chances on read timeouts, by default""""""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=0)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(method=""GET"", error=error)
        assert e.value.reason == error

    def test_status_counter(self):
        resp = HTTPResponse(status=400)
        retry = Retry(status=2)
        retry = retry.increment(response=resp)
        retry = retry.increment(response=resp)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(response=resp)
        assert str(e.value.reason) == ResponseError.SPECIFIC_ERROR.format(
            status_code=400
        )

    def test_backoff(self):
        """"""Backoff is computed correctly""""""
        max_backoff = Retry.BACKOFF_MAX

        retry = Retry(total=100, backoff_factor=0.2)
        assert retry.get_backoff_time() == 0  # First request

        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0  # First retry

        retry = retry.increment(method=""GET"")
        assert retry.backoff_factor == 0.2
        assert retry.total == 98
        assert retry.get_backoff_time() == 0.4  # Start backoff

        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0.8

        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 1.6

        for _ in xrange(10):
            retry = retry.increment(method=""GET"")

        assert retry.get_backoff_time() == max_backoff

    def test_zero_backoff(self):
        retry = Retry()
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0

    def test_backoff_reset_after_redirect(self):
        retry = Retry(total=100, redirect=5, backoff_factor=0.2)
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0.4
        redirect_response = HTTPResponse(status=302, headers={""location"": ""test""})
        retry = retry.increment(method=""GET"", response=redirect_response)
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        assert retry.get_backoff_time() == 0.4

    def test_sleep(self):
        # sleep a very small amount of time so our code coverage is happy
        retry = Retry(backoff_factor=0.0001)
        retry = retry.increment(method=""GET"")
        retry = retry.increment(method=""GET"")
        retry.sleep()

    def test_status_forcelist(self):
        retry = Retry(status_forcelist=xrange(500, 600))
        assert not retry.is_retry(""GET"", status_code=200)
        assert not retry.is_retry(""GET"", status_code=400)
        assert retry.is_retry(""GET"", status_code=500)

        retry = Retry(total=1, status_forcelist=[418])
        assert not retry.is_retry(""GET"", status_code=400)
        assert retry.is_retry(""GET"", status_code=418)

        # String status codes are not matched.
        retry = Retry(total=1, status_forcelist=[""418""])
        assert not retry.is_retry(""GET"", status_code=418)

    def test_method_whitelist_with_status_forcelist(self, expect_retry_deprecation):
        # Falsey method_whitelist means to retry on any method.
        retry = Retry(status_forcelist=[500], method_whitelist=None)
        assert retry.is_retry(""GET"", status_code=500)
        assert retry.is_retry(""POST"", status_code=500)

        # Criteria of method_whitelist and status_forcelist are ANDed.
        retry = Retry(status_forcelist=[500], method_whitelist=[""POST""])
        assert not retry.is_retry(""GET"", status_code=500)
        assert retry.is_retry(""POST"", status_code=500)

    def test_exhausted(self):
        assert not Retry(0).is_exhausted()
        assert Retry(-1).is_exhausted()
        assert Retry(1).increment(method=""GET"").total == 0

    @pytest.mark.parametrize(""total"", [-1, 0])
    def test_disabled(self, total):
        with pytest.raises(MaxRetryError):
            Retry(total).increment(method=""GET"")

    def test_error_message(self):
        retry = Retry(total=0)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(
                method=""GET"", error=ReadTimeoutError(None, ""/"", ""read timed out"")
            )
        assert ""Caused by redirect"" not in str(e.value)
        assert str(e.value.reason) == ""None: read timed out""

        retry = Retry(total=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(""POST"", ""/"")
            retry = retry.increment(""POST"", ""/"")
        assert ""Caused by redirect"" not in str(e.value)
        assert isinstance(e.value.reason, ResponseError)
        assert str(e.value.reason) == ResponseError.GENERIC_ERROR

        retry = Retry(total=1)
        response = HTTPResponse(status=500)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(""POST"", ""/"", response=response)
            retry = retry.increment(""POST"", ""/"", response=response)
        assert ""Caused by redirect"" not in str(e.value)
        msg = ResponseError.SPECIFIC_ERROR.format(status_code=500)
        assert str(e.value.reason) == msg

        retry = Retry(connect=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(error=ConnectTimeoutError(""conntimeout""))
            retry = retry.increment(error=ConnectTimeoutError(""conntimeout""))
        assert ""Caused by redirect"" not in str(e.value)
        assert str(e.value.reason) == ""conntimeout""

    def test_history(self, expect_retry_deprecation):
        retry = Retry(total=10, method_whitelist=frozenset([""GET"", ""POST""]))
        assert retry.history == tuple()
        connection_error = ConnectTimeoutError(""conntimeout"")
        retry = retry.increment(""GET"", ""/test1"", None, connection_error)
        history = (RequestHistory(""GET"", ""/test1"", connection_error, None, None),)
        assert retry.history == history

        read_error = ReadTimeoutError(None, ""/test2"", ""read timed out"")
        retry = retry.increment(""POST"", ""/test2"", None, read_error)
        history = (
            RequestHistory(""GET"", ""/test1"", connection_error, None, None),
            RequestHistory(""POST"", ""/test2"", read_error, None, None),
        )
        assert retry.history == history

        response = HTTPResponse(status=500)
        retry = retry.increment(""GET"", ""/test3"", response, None)
        history = (
            RequestHistory(""GET"", ""/test1"", connection_error, None, None),
            RequestHistory(""POST"", ""/test2"", read_error, None, None),
            RequestHistory(""GET"", ""/test3"", None, 500, None),
        )
        assert retry.history == history

    def test_retry_method_not_in_whitelist(self):
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry()
        with pytest.raises(ReadTimeoutError):
            retry.increment(method=""POST"", error=error)

    def test_retry_default_remove_headers_on_redirect(self):
        retry = Retry()

        assert list(retry.remove_headers_on_redirect) == [""authorization""]

    def test_retry_set_remove_headers_on_redirect(self):
        retry = Retry(remove_headers_on_redirect=[""X-API-Secret""])

        assert list(retry.remove_headers_on_redirect) == [""x-api-secret""]

    @pytest.mark.parametrize(""value"", [""-1"", ""+1"", ""1.0"", six.u(""\xb2"")])  # \xb2 = ^2
    def test_parse_retry_after_invalid(self, value):
        retry = Retry()
        with pytest.raises(InvalidHeader):
            retry.parse_retry_after(value)

    @pytest.mark.parametrize(
        ""value, expected"", [(""0"", 0), (""1000"", 1000), (""\t42 "", 42)]
    )
    def test_parse_retry_after(self, value, expected):
        retry = Retry()
        assert retry.parse_retry_after(value) == expected

    @pytest.mark.parametrize(""respect_retry_after_header"", [True, False])
    def test_respect_retry_after_header_propagated(self, respect_retry_after_header):

        retry = Retry(respect_retry_after_header=respect_retry_after_header)
        new_retry = retry.new()
        assert new_retry.respect_retry_after_header == respect_retry_after_header

    @pytest.mark.freeze_time(""2019-06-03 11:00:00"", tz_offset=0)
    @pytest.mark.parametrize(
        ""retry_after_header,respect_retry_after_header,sleep_duration"",
        [
            (""3600"", True, 3600),
            (""3600"", False, None),
            # Will sleep due to header is 1 hour in future
            (""Mon, 3 Jun 2019 12:00:00 UTC"", True, 3600),
            # Won't sleep due to not respecting header
            (""Mon, 3 Jun 2019 12:00:00 UTC"", False, None),
            # Won't sleep due to current time reached
            (""Mon, 3 Jun 2019 11:00:00 UTC"", True, None),
            # Won't sleep due to current time reached + not respecting header
            (""Mon, 3 Jun 2019 11:00:00 UTC"", False, None),
            # Handle all the formats in RFC 7231 Section 7.1.1.1
            (""Mon, 03 Jun 2019 11:30:12 GMT"", True, 1812),
            (""Monday, 03-Jun-19 11:30:12 GMT"", True, 1812),
            # Assume that datetimes without a timezone are in UTC per RFC 7231
            (""Mon Jun  3 11:30:12 2019"", True, 1812),
        ],
    )
    @pytest.mark.parametrize(
        ""stub_timezone"",
        [
            ""UTC"",
            ""Asia/Jerusalem"",
            None,
        ],
        indirect=True,
    )
    @pytest.mark.usefixtures(""stub_timezone"")
    def test_respect_retry_after_header_sleep(
        self, retry_after_header, respect_retry_after_header, sleep_duration
    ):
        retry = Retry(respect_retry_after_header=respect_retry_after_header)

        with mock.patch(""time.sleep"") as sleep_mock:
            # for the default behavior, it must be in RETRY_AFTER_STATUS_CODES
            response = HTTPResponse(
                status=503, headers={""Retry-After"": retry_after_header}
            )

            retry.sleep(response)

            # The expected behavior is that we'll only sleep if respecting
            # this header (since we won't have any backoff sleep attempts)
            if respect_retry_after_header and sleep_duration is not None:
                sleep_mock.assert_called_with(sleep_duration)
            else:
                sleep_mock.assert_not_called()


class TestRetryDeprecations(object):
    def test_cls_get_default_method_whitelist(self, expect_retry_deprecation):
        assert Retry.DEFAULT_ALLOWED_METHODS == Retry.DEFAULT_METHOD_WHITELIST

    def test_cls_get_default_redirect_headers_blacklist(self, expect_retry_deprecation):
        assert (
            Retry.DEFAULT_REMOVE_HEADERS_ON_REDIRECT
            == Retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST
        )

    def test_cls_set_default_method_whitelist(self, expect_retry_deprecation):
        old_setting = Retry.DEFAULT_METHOD_WHITELIST
        try:
            Retry.DEFAULT_METHOD_WHITELIST = {""GET""}
            retry = Retry()
            assert retry.DEFAULT_ALLOWED_METHODS == {""GET""}
            assert retry.DEFAULT_METHOD_WHITELIST == {""GET""}
            assert retry.allowed_methods == {""GET""}
            assert retry.method_whitelist == {""GET""}

            # Test that the default can be overridden both ways
            retry = Retry(allowed_methods={""GET"", ""POST""})
            assert retry.DEFAULT_ALLOWED_METHODS == {""GET""}
            assert retry.DEFAULT_METHOD_WHITELIST == {""GET""}
            assert retry.allowed_methods == {""GET"", ""POST""}
            assert retry.method_whitelist == {""GET"", ""POST""}

            retry = Retry(method_whitelist={""POST""})
            assert retry.DEFAULT_ALLOWED_METHODS == {""GET""}
            assert retry.DEFAULT_METHOD_WHITELIST == {""GET""}
            assert retry.allowed_methods == {""POST""}
            assert retry.method_whitelist == {""POST""}
        finally:
            Retry.DEFAULT_METHOD_WHITELIST = old_setting
            assert Retry.DEFAULT_ALLOWED_METHODS == old_setting

    def test_cls_set_default_redirect_headers_blacklist(self, expect_retry_deprecation):
        old_setting = Retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST
        try:
            Retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST = {""test""}
            retry = Retry()
            assert retry.DEFAULT_REMOVE_HEADERS_ON_REDIRECT == {""test""}
            assert retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST == {""test""}
            assert retry.remove_headers_on_redirect == {""test""}
            assert retry.remove_headers_on_redirect == {""test""}

            retry = Retry(remove_headers_on_redirect={""test2""})
            assert retry.DEFAULT_REMOVE_HEADERS_ON_REDIRECT == {""test""}
            assert retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST == {""test""}
            assert retry.remove_headers_on_redirect == {""test2""}
            assert retry.remove_headers_on_redirect == {""test2""}
        finally:
            Retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST = old_setting
            assert Retry.DEFAULT_REDIRECT_HEADERS_BLACKLIST == old_setting

    @pytest.mark.parametrize(
        ""options"", [(None, None), ({""GET""}, None), (None, {""GET""}), ({""GET""}, {""GET""})]
    )
    def test_retry_allowed_methods_and_method_whitelist_error(self, options):
        with pytest.raises(ValueError) as e:
            Retry(allowed_methods=options[0], method_whitelist=options[1])
        assert str(e.value) == (
            ""Using both 'allowed_methods' and 'method_whitelist' together ""
            ""is not allowed. Instead only use 'allowed_methods'""
        )

    def test_retry_subclass_that_sets_method_whitelist(self, expect_retry_deprecation):
        class SubclassRetry(Retry):
            def __init__(self, **kwargs):
                if ""allowed_methods"" in kwargs:
                    raise AssertionError(
                        ""This subclass likely doesn't use 'allowed_methods'""
                    )

                super(SubclassRetry, self).__init__(**kwargs)

                # Since we're setting 'method_whiteist' we get fallbacks
                # within Retry.new() and Retry._is_method_retryable()
                # to use 'method_whitelist' instead of 'allowed_methods'
                self.method_whitelist = self.method_whitelist | {""POST""}

        retry = SubclassRetry()
        assert retry.method_whitelist == Retry.DEFAULT_ALLOWED_METHODS | {""POST""}
        assert retry.new(read=0).method_whitelist == retry.method_whitelist
        assert retry._is_method_retryable(""POST"")
        assert not retry._is_method_retryable(""CONNECT"")

        assert retry.new(method_whitelist={""GET""}).method_whitelist == {""GET"", ""POST""}

        # urllib3 doesn't do this during normal operation
        # so we don't want users passing in 'allowed_methods'
        # when their subclass doesn't support the option yet.
        with pytest.raises(AssertionError) as e:
            retry.new(allowed_methods={""GET""})
        assert str(e.value) == ""This subclass likely doesn't use 'allowed_methods'""",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED," VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR, VAR, VAR, ) VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR  @VAR.VAR(VAR=""VAR"") VAR VAR(): VAR VAR.VAR(VAR=VAR) VAR VAR: VAR VAR VAR([VAR(VAR.VAR) VAR VAR VAR VAR VAR ""VAR"" VAR VAR(VAR.VAR)]) > 0 VAR VAR(VAR): VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR ( VAR(VAR) == ""VAR(VAR=10, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)"" ) VAR VAR VAR VAR(3): VAR = VAR.VAR(VAR=""VAR"") VAR ( VAR(VAR) == ""VAR(VAR=7, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)"" ) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=3, VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR(VAR): """"""VAR VAR VAR VAR, VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR VAR.VAR() VAR VAR(VAR): """"""VAR VAR VAR VAR VAR, VAR VAR VAR 3 VAR"""""" VAR = VAR() VAR VAR.VAR == 10 VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR VAR(0).VAR VAR VAR VAR(VAR).VAR VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR, VAR VAR"""""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR=400) VAR = VAR(VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR.VAR( VAR=400 ) VAR VAR(VAR): """"""VAR VAR VAR VAR"""""" VAR = VAR.VAR VAR = VAR(VAR=100, VAR=0.2) VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR == 0.2 VAR VAR.VAR == 98 VAR VAR.VAR() == 0.4  VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0.8 VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 1.6 VAR VAR VAR VAR(10): VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == VAR VAR VAR(VAR): VAR = VAR() VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0 VAR VAR(VAR): VAR = VAR(VAR=100, VAR=5, VAR=0.2) VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0.4 VAR = VAR(VAR=302, VAR={""VAR"": ""VAR""}) VAR = VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR VAR.VAR() == 0.4 VAR VAR(VAR):  VAR = VAR(VAR=0.0001) VAR = VAR.VAR(VAR=""VAR"") VAR = VAR.VAR(VAR=""VAR"") VAR.VAR() VAR VAR(VAR): VAR = VAR(VAR=VAR(500, 600)) VAR VAR VAR.VAR(""VAR"", VAR=200) VAR VAR VAR.VAR(""VAR"", VAR=400) VAR VAR.VAR(""VAR"", VAR=500) VAR = VAR(VAR=1, VAR=[418]) VAR VAR VAR.VAR(""VAR"", VAR=400) VAR VAR.VAR(""VAR"", VAR=418)  VAR = VAR(VAR=1, VAR=[""418""]) VAR VAR VAR.VAR(""VAR"", VAR=418) VAR VAR(VAR, VAR):  VAR = VAR(VAR=[500], VAR=VAR) VAR VAR.VAR(""VAR"", VAR=500) VAR VAR.VAR(""VAR"", VAR=500)  VAR = VAR(VAR=[500], VAR=[""VAR""]) VAR VAR VAR.VAR(""VAR"", VAR=500) VAR VAR.VAR(""VAR"", VAR=500) VAR VAR(VAR): VAR VAR VAR(0).VAR() VAR VAR(-1).VAR() VAR VAR(1).VAR(VAR=""VAR"").VAR == 0 @VAR.VAR.VAR(""VAR"", [-1, 0]) VAR VAR(VAR, VAR): VAR VAR.VAR(VAR): VAR(VAR).VAR(VAR=""VAR"") VAR VAR(VAR): VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR( VAR=""VAR"", VAR=VAR(VAR, ""/"", ""VAR VAR VAR"") ) VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == ""VAR: VAR VAR VAR"" VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""/"") VAR = VAR.VAR(""VAR"", ""/"") VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR, VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR VAR = VAR(VAR=1) VAR = VAR(VAR=500) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""/"", VAR=VAR) VAR = VAR.VAR(""VAR"", ""/"", VAR=VAR) VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR = VAR.VAR.VAR(VAR=500) VAR VAR(VAR.VAR.VAR) == VAR VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR=VAR(""VAR"")) VAR = VAR.VAR(VAR=VAR(""VAR"")) VAR ""VAR VAR VAR"" VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == ""VAR"" VAR VAR(VAR, VAR): VAR = VAR(VAR=10, VAR=VAR([""VAR"", ""VAR""])) VAR VAR.VAR == VAR() VAR = VAR(""VAR"") VAR = VAR.VAR(""VAR"", ""/VAR"", VAR, VAR) VAR = (VAR(""VAR"", ""/VAR"", VAR, VAR, VAR),) VAR VAR.VAR == VAR VAR = VAR(VAR, ""/VAR"", ""VAR VAR VAR"") VAR = VAR.VAR(""VAR"", ""/VAR"", VAR, VAR) VAR = ( VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), ) VAR VAR.VAR == VAR VAR = VAR(VAR=500) VAR = VAR.VAR(""VAR"", ""/VAR"", VAR, VAR) VAR = ( VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), VAR(""VAR"", ""/VAR"", VAR, VAR, VAR), VAR(""VAR"", ""/VAR"", VAR, 500, VAR), ) VAR VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR=""VAR"", VAR=VAR) VAR VAR(VAR): VAR = VAR() VAR VAR(VAR.VAR) == [""VAR""] VAR VAR(VAR): VAR = VAR(VAR=[""VAR-VAR-VAR""]) VAR VAR(VAR.VAR) == [""VAR-VAR-VAR""] @VAR.VAR.VAR(""VAR"", [""-1"", ""+1"", ""1.0"", VAR.VAR(""\VAR"")])  VAR VAR(VAR, VAR): VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR) @VAR.VAR.VAR( ""VAR, VAR"", [(""0"", 0), (""1000"", 1000), (""\VAR "", 42)] ) VAR VAR(VAR, VAR, VAR): VAR = VAR() VAR VAR.VAR(VAR) == VAR @VAR.VAR.VAR(""VAR"", [VAR, VAR]) VAR VAR(VAR, VAR): VAR = VAR(VAR=VAR) VAR = VAR.VAR() VAR VAR.VAR == VAR @VAR.VAR.VAR(""2019-06-03 11:00:00"", VAR=0) @VAR.VAR.VAR( ""VAR,VAR,VAR"", [ (""3600"", VAR, 3600), (""3600"", VAR, VAR),  (""VAR, 3 VAR 2019 12:00:00 VAR"", VAR, 3600),  (""VAR, 3 VAR 2019 12:00:00 VAR"", VAR, VAR),  (""VAR, 3 VAR 2019 11:00:00 VAR"", VAR, VAR),  (""VAR, 3 VAR 2019 11:00:00 VAR"", VAR, VAR),  (""VAR, 03 VAR 2019 11:30:12 VAR"", VAR, 1812), (""VAR, 03-VAR-19 11:30:12 VAR"", VAR, 1812),  (""VAR VAR 3 11:30:12 2019"", VAR, 1812), ], ) @VAR.VAR.VAR( ""VAR"", [ ""VAR"", ""VAR/VAR"", VAR, ], VAR=VAR, ) @VAR.VAR.VAR(""VAR"") VAR VAR( VAR, VAR, VAR, VAR ): VAR = VAR(VAR=VAR) VAR VAR.VAR(""VAR.VAR"") VAR VAR:  VAR = VAR( VAR=503, VAR={""VAR-VAR"": VAR} ) VAR.VAR(VAR)   VAR VAR VAR VAR VAR VAR VAR: VAR.VAR(VAR) VAR: VAR.VAR() VAR VAR(VAR): VAR VAR(VAR, VAR): VAR VAR.VAR == VAR.VAR VAR VAR(VAR, VAR): VAR ( VAR.VAR == VAR.VAR ) VAR VAR(VAR, VAR): VAR = VAR.VAR VAR: VAR.VAR = {""VAR""} VAR = VAR() VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""}  VAR = VAR(VAR={""VAR"", ""VAR""}) VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR"", ""VAR""} VAR VAR.VAR == {""VAR"", ""VAR""} VAR = VAR(VAR={""VAR""}) VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR: VAR.VAR = VAR VAR VAR.VAR == VAR VAR VAR(VAR, VAR): VAR = VAR.VAR VAR: VAR.VAR = {""VAR""} VAR = VAR() VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR = VAR(VAR={""VAR""}) VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR VAR.VAR == {""VAR""} VAR: VAR.VAR = VAR VAR VAR.VAR == VAR @VAR.VAR.VAR( ""VAR"", [(VAR, VAR), ({""VAR""}, VAR), (VAR, {""VAR""}), ({""VAR""}, {""VAR""})] ) VAR VAR(VAR, VAR): VAR VAR.VAR(VAR) VAR VAR: VAR(VAR=VAR[0], VAR=VAR[1]) VAR VAR(VAR.VAR) == ( ""VAR VAR 'VAR' VAR 'VAR' VAR "" ""VAR VAR VAR. VAR VAR VAR 'VAR'"" ) VAR VAR(VAR, VAR): VAR VAR(VAR): VAR VAR(VAR, **VAR): VAR ""VAR"" VAR VAR: VAR VAR( ""VAR VAR VAR VAR'VAR VAR 'VAR'"" ) VAR(VAR, VAR).VAR(**VAR)    VAR.VAR = VAR.VAR | {""VAR""} VAR = VAR() VAR VAR.VAR == VAR.VAR | {""VAR""} VAR VAR.VAR(VAR=0).VAR == VAR.VAR VAR VAR.VAR(""VAR"") VAR VAR VAR.VAR(""VAR"") VAR VAR.VAR(VAR={""VAR""}).VAR == {""VAR"", ""VAR""}    VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR={""VAR""}) VAR VAR(VAR.VAR) == ""VAR VAR VAR VAR'VAR VAR 'VAR'"" ",0,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/with_dummyserver/test_chunked_transfer.py,"# -*- coding: utf-8 -*-

import pytest

from dummyserver.testcase import (
    ConnectionMarker,
    SocketDummyServerTestCase,
    consume_socket,
)
from urllib3 import HTTPConnectionPool
from urllib3.util import SKIP_HEADER
from urllib3.util.retry import Retry

# Retry failed tests
pytestmark = pytest.mark.flaky


class TestChunkedTransfer(SocketDummyServerTestCase):
    def start_chunked_handler(self):
        self.buffer = b""""

        def socket_handler(listener):
            sock = listener.accept()[0]

            while not self.buffer.endswith(b""\r\n0\r\n\r\n""):
                self.buffer += sock.recv(65536)

            sock.send(
                b""HTTP/1.1 200 OK\r\n""
                b""Content-type: text/plain\r\n""
                b""Content-Length: 0\r\n""
                b""\r\n""
            )
            sock.close()

        self._start_server(socket_handler)

    def test_chunks(self):
        self.start_chunked_handler()
        chunks = [""foo"", ""bar"", """", ""bazzzzzzzzzzzzzzzzzzzzzz""]
        with HTTPConnectionPool(self.host, self.port, retries=False) as pool:
            pool.urlopen(""GET"", ""/"", chunks, headers=dict(DNT=""1""), chunked=True)

            assert b""Transfer-Encoding"" in self.buffer
            body = self.buffer.split(b""\r\n\r\n"", 1)[1]
            lines = body.split(b""\r\n"")
            # Empty chunks should have been skipped, as this could not be distinguished
            # from terminating the transmission
            for i, chunk in enumerate([c for c in chunks if c]):
                assert lines[i * 2] == hex(len(chunk))[2:].encode(""utf-8"")
                assert lines[i * 2 + 1] == chunk.encode(""utf-8"")

    def _test_body(self, data):
        self.start_chunked_handler()
        with HTTPConnectionPool(self.host, self.port, retries=False) as pool:
            pool.urlopen(""GET"", ""/"", data, chunked=True)
            header, body = self.buffer.split(b""\r\n\r\n"", 1)

            assert b""Transfer-Encoding: chunked"" in header.split(b""\r\n"")
            if data:
                bdata = data if isinstance(data, bytes) else data.encode(""utf-8"")
                assert b""\r\n"" + bdata + b""\r\n"" in body
                assert body.endswith(b""\r\n0\r\n\r\n"")

                len_str = body.split(b""\r\n"", 1)[0]
                stated_len = int(len_str, 16)
                assert stated_len == len(bdata)
            else:
                assert body == b""0\r\n\r\n""

    def test_bytestring_body(self):
        self._test_body(b""thisshouldbeonechunk\r\nasdf"")

    def test_unicode_body(self):
        self._test_body(u""thisshouldbeonechunk\r\n"")

    def test_empty_body(self):
        self._test_body(None)

    def test_empty_string_body(self):
        self._test_body("""")

    def test_empty_iterable_body(self):
        self._test_body([])

    def _get_header_lines(self, prefix):
        header_block = self.buffer.split(b""\r\n\r\n"", 1)[0].lower()
        header_lines = header_block.split(b""\r\n"")[1:]
        return [x for x in header_lines if x.startswith(prefix)]

    def test_removes_duplicate_host_header(self):
        self.start_chunked_handler()
        chunks = [""foo"", ""bar"", """", ""bazzzzzzzzzzzzzzzzzzzzzz""]
        with HTTPConnectionPool(self.host, self.port, retries=False) as pool:
            pool.urlopen(""GET"", ""/"", chunks, headers={""Host"": ""test.org""}, chunked=True)

            host_headers = self._get_header_lines(b""host"")
            assert len(host_headers) == 1

    def test_provides_default_host_header(self):
        self.start_chunked_handler()
        chunks = [""foo"", ""bar"", """", ""bazzzzzzzzzzzzzzzzzzzzzz""]
        with HTTPConnectionPool(self.host, self.port, retries=False) as pool:
            pool.urlopen(""GET"", ""/"", chunks, chunked=True)

            host_headers = self._get_header_lines(b""host"")
            assert len(host_headers) == 1

    def test_provides_default_user_agent_header(self):
        self.start_chunked_handler()
        chunks = [""foo"", ""bar"", """", ""bazzzzzzzzzzzzzzzzzzzzzz""]
        with HTTPConnectionPool(self.host, self.port, retries=False) as pool:
            pool.urlopen(""GET"", ""/"", chunks, chunked=True)

            ua_headers = self._get_header_lines(b""user-agent"")
            assert len(ua_headers) == 1

    def test_remove_user_agent_header(self):
        self.start_chunked_handler()
        chunks = [""foo"", ""bar"", """", ""bazzzzzzzzzzzzzzzzzzzzzz""]
        with HTTPConnectionPool(self.host, self.port, retries=False) as pool:
            pool.urlopen(
                ""GET"",
                ""/"",
                chunks,
                headers={""User-Agent"": SKIP_HEADER},
                chunked=True,
            )

            ua_headers = self._get_header_lines(b""user-agent"")
            assert len(ua_headers) == 0

    def test_preserve_chunked_on_retry_after(self):
        self.chunked_requests = 0
        self.socks = []

        def socket_handler(listener):
            for _ in range(2):
                sock = listener.accept()[0]
                self.socks.append(sock)
                request = consume_socket(sock)
                if b""Transfer-Encoding: chunked"" in request.split(b""\r\n""):
                    self.chunked_requests += 1

                sock.send(
                    b""HTTP/1.1 429 Too Many Requests\r\n""
                    b""Content-Type: text/plain\r\n""
                    b""Retry-After: 1\r\n""
                    b""Content-Length: 0\r\n""
                    b""Connection: close\r\n""
                    b""\r\n""
                )

        self._start_server(socket_handler)
        with HTTPConnectionPool(self.host, self.port) as pool:
            retries = Retry(total=1)
            pool.urlopen(""GET"", ""/"", chunked=True, retries=retries)
            for sock in self.socks:
                sock.close()
        assert self.chunked_requests == 2

    def test_preserve_chunked_on_redirect(self, monkeypatch):
        self.chunked_requests = 0

        def socket_handler(listener):
            for i in range(2):
                sock = listener.accept()[0]
                request = ConnectionMarker.consume_request(sock)
                if b""Transfer-Encoding: chunked"" in request.split(b""\r\n""):
                    self.chunked_requests += 1

                if i == 0:
                    sock.sendall(
                        b""HTTP/1.1 301 Moved Permanently\r\n""
                        b""Location: /redirect\r\n\r\n""
                    )
                else:
                    sock.sendall(b""HTTP/1.1 200 OK\r\n\r\n"")
                sock.close()

        self._start_server(socket_handler)
        with ConnectionMarker.mark(monkeypatch):
            with HTTPConnectionPool(self.host, self.port) as pool:
                retries = Retry(redirect=1)
                pool.urlopen(
                    ""GET"", ""/"", chunked=True, preload_content=False, retries=retries
                )
        assert self.chunked_requests == 2

    def test_preserve_chunked_on_broken_connection(self, monkeypatch):
        self.chunked_requests = 0

        def socket_handler(listener):
            for i in range(2):
                sock = listener.accept()[0]
                request = ConnectionMarker.consume_request(sock)
                if b""Transfer-Encoding: chunked"" in request.split(b""\r\n""):
                    self.chunked_requests += 1

                if i == 0:
                    # Bad HTTP version will trigger a connection close
                    sock.sendall(b""HTTP/0.5 200 OK\r\n\r\n"")
                else:
                    sock.sendall(b""HTTP/1.1 200 OK\r\n\r\n"")
                sock.close()

        self._start_server(socket_handler)
        with ConnectionMarker.mark(monkeypatch):
            with HTTPConnectionPool(self.host, self.port) as pool:
                retries = Retry(read=1)
                pool.urlopen(
                    ""GET"", ""/"", chunked=True, preload_content=False, retries=retries
                )
            assert self.chunked_requests == 2",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED," VAR VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, ) VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR  VAR = VAR.VAR.VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = VAR"""" VAR VAR(VAR): VAR = VAR.VAR()[0] VAR VAR VAR.VAR.VAR(VAR""\VAR\VAR\VAR\VAR\VAR\VAR""): VAR.VAR += VAR.VAR(65536) VAR.VAR( VAR""VAR/1.1 200 VAR\VAR\VAR"" VAR""VAR-VAR: VAR/VAR\VAR\VAR"" VAR""VAR-VAR: 0\VAR\VAR"" VAR""\VAR\VAR"" ) VAR.VAR() VAR.VAR(VAR) VAR VAR(VAR): VAR.VAR() VAR = [""VAR"", ""VAR"", """", ""VAR""] VAR VAR(VAR.VAR, VAR.VAR, VAR=VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR, VAR=VAR(VAR=""1""), VAR=VAR) VAR VAR""VAR-VAR"" VAR VAR.VAR VAR = VAR.VAR.VAR(VAR""\VAR\VAR\VAR\VAR"", 1)[1] VAR = VAR.VAR(VAR""\VAR\VAR"")   VAR VAR, VAR VAR VAR([VAR VAR VAR VAR VAR VAR VAR]): VAR VAR[VAR * 2] == VAR(VAR(VAR))[2:].VAR(""VAR-8"") VAR VAR[VAR * 2 + 1] == VAR.VAR(""VAR-8"") VAR VAR(VAR, VAR): VAR.VAR() VAR VAR(VAR.VAR, VAR.VAR, VAR=VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR, VAR=VAR) VAR, VAR = VAR.VAR.VAR(VAR""\VAR\VAR\VAR\VAR"", 1) VAR VAR""VAR-VAR: VAR"" VAR VAR.VAR(VAR""\VAR\VAR"") VAR VAR: VAR = VAR VAR VAR(VAR, VAR) VAR VAR.VAR(""VAR-8"") VAR VAR""\VAR\VAR"" + VAR + VAR""\VAR\VAR"" VAR VAR VAR VAR.VAR(VAR""\VAR\VAR\VAR\VAR\VAR\VAR"") VAR = VAR.VAR(VAR""\VAR\VAR"", 1)[0] VAR = VAR(VAR, 16) VAR VAR == VAR(VAR) VAR: VAR VAR == VAR""0\VAR\VAR\VAR\VAR"" VAR VAR(VAR): VAR.VAR(VAR""VAR\VAR\VAR"") VAR VAR(VAR): VAR.VAR(VAR""VAR\VAR\n"") VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR): VAR.VAR("""") VAR VAR(VAR): VAR.VAR([]) VAR VAR(VAR, VAR): VAR = VAR.VAR.VAR(VAR""\VAR\VAR\VAR\VAR"", 1)[0].VAR() VAR = VAR.VAR(VAR""\VAR\VAR"")[1:] VAR [VAR VAR VAR VAR VAR VAR VAR.VAR(VAR)] VAR VAR(VAR): VAR.VAR() VAR = [""VAR"", ""VAR"", """", ""VAR""] VAR VAR(VAR.VAR, VAR.VAR, VAR=VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR, VAR={""VAR"": ""VAR.VAR""}, VAR=VAR) VAR = VAR.VAR(VAR""VAR"") VAR VAR(VAR) == 1 VAR VAR(VAR): VAR.VAR() VAR = [""VAR"", ""VAR"", """", ""VAR""] VAR VAR(VAR.VAR, VAR.VAR, VAR=VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR, VAR=VAR) VAR = VAR.VAR(VAR""VAR"") VAR VAR(VAR) == 1 VAR VAR(VAR): VAR.VAR() VAR = [""VAR"", ""VAR"", """", ""VAR""] VAR VAR(VAR.VAR, VAR.VAR, VAR=VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR, VAR=VAR) VAR = VAR.VAR(VAR""VAR-VAR"") VAR VAR(VAR) == 1 VAR VAR(VAR): VAR.VAR() VAR = [""VAR"", ""VAR"", """", ""VAR""] VAR VAR(VAR.VAR, VAR.VAR, VAR=VAR) VAR VAR: VAR.VAR( ""VAR"", ""/"", VAR, VAR={""VAR-VAR"": VAR}, VAR=VAR, ) VAR = VAR.VAR(VAR""VAR-VAR"") VAR VAR(VAR) == 0 VAR VAR(VAR): VAR.VAR = 0 VAR.VAR = [] VAR VAR(VAR): VAR VAR VAR VAR(2): VAR = VAR.VAR()[0] VAR.VAR.VAR(VAR) VAR = VAR(VAR) VAR VAR""VAR-VAR: VAR"" VAR VAR.VAR(VAR""\VAR\VAR""): VAR.VAR += 1 VAR.VAR( VAR""VAR/1.1 429 VAR VAR VAR\VAR\VAR"" VAR""VAR-VAR: VAR/VAR\VAR\VAR"" VAR""VAR-VAR: 1\VAR\VAR"" VAR""VAR-VAR: 0\VAR\VAR"" VAR""VAR: VAR\VAR\VAR"" VAR""\VAR\VAR"" ) VAR.VAR(VAR) VAR VAR(VAR.VAR, VAR.VAR) VAR VAR: VAR = VAR(VAR=1) VAR.VAR(""VAR"", ""/"", VAR=VAR, VAR=VAR) VAR VAR VAR VAR.VAR: VAR.VAR() VAR VAR.VAR == 2 VAR VAR(VAR, VAR): VAR.VAR = 0 VAR VAR(VAR): VAR VAR VAR VAR(2): VAR = VAR.VAR()[0] VAR = VAR.VAR(VAR) VAR VAR""VAR-VAR: VAR"" VAR VAR.VAR(VAR""\VAR\VAR""): VAR.VAR += 1 VAR VAR == 0: VAR.VAR( VAR""VAR/1.1 301 VAR VAR\VAR\VAR"" VAR""VAR: /VAR\VAR\VAR\VAR\VAR"" ) VAR: VAR.VAR(VAR""VAR/1.1 200 VAR\VAR\VAR\VAR\VAR"") VAR.VAR() VAR.VAR(VAR) VAR VAR.VAR(VAR): VAR VAR(VAR.VAR, VAR.VAR) VAR VAR: VAR = VAR(VAR=1) VAR.VAR( ""VAR"", ""/"", VAR=VAR, VAR=VAR, VAR=VAR ) VAR VAR.VAR == 2 VAR VAR(VAR, VAR): VAR.VAR = 0 VAR VAR(VAR): VAR VAR VAR VAR(2): VAR = VAR.VAR()[0] VAR = VAR.VAR(VAR) VAR VAR""VAR-VAR: VAR"" VAR VAR.VAR(VAR""\VAR\VAR""): VAR.VAR += 1 VAR VAR == 0:  VAR.VAR(VAR""VAR/0.5 200 VAR\VAR\VAR\VAR\VAR"") VAR: VAR.VAR(VAR""VAR/1.1 200 VAR\VAR\VAR\VAR\VAR"") VAR.VAR() VAR.VAR(VAR) VAR VAR.VAR(VAR): VAR VAR(VAR.VAR, VAR.VAR) VAR VAR: VAR = VAR(VAR=1) VAR.VAR( ""VAR"", ""/"", VAR=VAR, VAR=VAR, VAR=VAR ) VAR VAR.VAR == 2 ",8,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/with_dummyserver/test_no_ssl.py,"""""""
Test connections without the builtin ssl module

Note: Import urllib3 inside the test functions to get the importblocker to work
""""""
import pytest

import urllib3
from dummyserver.testcase import HTTPDummyServerTestCase, HTTPSDummyServerTestCase

from ..test_no_ssl import TestWithoutSSL

# Retry failed tests
pytestmark = pytest.mark.flaky


class TestHTTPWithoutSSL(HTTPDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        with urllib3.HTTPConnectionPool(self.host, self.port) as pool:
            r = pool.request(""GET"", ""/"")
            assert r.status == 200, r.data


class TestHTTPSWithoutSSL(HTTPSDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        with urllib3.HTTPSConnectionPool(
            self.host, self.port, cert_reqs=""NONE""
        ) as pool:
            try:
                pool.request(""GET"", ""/"")
            except urllib3.exceptions.SSLError as e:
                assert ""SSL module is not available"" in str(e)",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,""""""" VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR ..VAR VAR VAR  VAR = VAR.VAR.VAR VAR VAR(VAR, VAR): VAR VAR(VAR): VAR VAR.VAR(VAR.VAR, VAR.VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""/"") VAR VAR.VAR == 200, VAR.VAR VAR VAR(VAR, VAR): VAR VAR(VAR): VAR VAR.VAR( VAR.VAR, VAR.VAR, VAR=""VAR"" ) VAR VAR: VAR: VAR.VAR(""VAR"", ""/"") VAR VAR.VAR.VAR VAR VAR: VAR ""VAR VAR VAR VAR VAR"" VAR VAR(VAR) ",8,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/with_dummyserver/test_poolmanager.py,"import json
from test import LONG_TIMEOUT

import pytest

from dummyserver.server import HAS_IPV6
from dummyserver.testcase import HTTPDummyServerTestCase, IPv6HTTPDummyServerTestCase
from urllib3.connectionpool import port_by_scheme
from urllib3.exceptions import MaxRetryError, URLSchemeUnknown
from urllib3.poolmanager import PoolManager
from urllib3.util.retry import Retry

# Retry failed tests
pytestmark = pytest.mark.flaky


class TestPoolManager(HTTPDummyServerTestCase):
    @classmethod
    def setup_class(cls):
        super(TestPoolManager, cls).setup_class()
        cls.base_url = ""http://%s:%d"" % (cls.host, cls.port)
        cls.base_url_alt = ""http://%s:%d"" % (cls.host_alt, cls.port)

    def test_redirect(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/"" % self.base_url},
                redirect=False,
            )

            assert r.status == 303

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/"" % self.base_url},
            )

            assert r.status == 200
            assert r.data == b""Dummy server!""

    def test_redirect_twice(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/redirect"" % self.base_url},
                redirect=False,
            )

            assert r.status == 303

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={
                    ""target"": ""%s/redirect?target=%s/"" % (self.base_url, self.base_url)
                },
            )

            assert r.status == 200
            assert r.data == b""Dummy server!""

    def test_redirect_to_relative_url(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""/redirect""},
                redirect=False,
            )

            assert r.status == 303

            r = http.request(
                ""GET"", ""%s/redirect"" % self.base_url, fields={""target"": ""/redirect""}
            )

            assert r.status == 200
            assert r.data == b""Dummy server!""

    def test_cross_host_redirect(self):
        with PoolManager() as http:
            cross_host_location = ""%s/echo?a=b"" % self.base_url_alt
            with pytest.raises(MaxRetryError):
                http.request(
                    ""GET"",
                    ""%s/redirect"" % self.base_url,
                    fields={""target"": cross_host_location},
                    timeout=LONG_TIMEOUT,
                    retries=0,
                )

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/echo?a=b"" % self.base_url_alt},
                timeout=LONG_TIMEOUT,
                retries=1,
            )

            assert r._pool.host == self.host_alt

    def test_too_many_redirects(self):
        with PoolManager() as http:
            with pytest.raises(MaxRetryError):
                http.request(
                    ""GET"",
                    ""%s/redirect"" % self.base_url,
                    fields={
                        ""target"": ""%s/redirect?target=%s/""
                        % (self.base_url, self.base_url)
                    },
                    retries=1,
                    preload_content=False,
                )

            with pytest.raises(MaxRetryError):
                http.request(
                    ""GET"",
                    ""%s/redirect"" % self.base_url,
                    fields={
                        ""target"": ""%s/redirect?target=%s/""
                        % (self.base_url, self.base_url)
                    },
                    retries=Retry(total=None, redirect=1),
                    preload_content=False,
                )

            # Even with preload_content=False and raise on redirects, we reused the same
            # connection
            assert len(http.pools) == 1
            pool = http.connection_from_host(self.host, self.port)
            assert pool.num_connections == 1

    def test_redirect_cross_host_remove_headers(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/headers"" % self.base_url_alt},
                headers={""Authorization"": ""foo""},
            )

            assert r.status == 200

            data = json.loads(r.data.decode(""utf-8""))

            assert ""Authorization"" not in data

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/headers"" % self.base_url_alt},
                headers={""authorization"": ""foo""},
            )

            assert r.status == 200

            data = json.loads(r.data.decode(""utf-8""))

            assert ""authorization"" not in data
            assert ""Authorization"" not in data

    def test_redirect_cross_host_no_remove_headers(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/headers"" % self.base_url_alt},
                headers={""Authorization"": ""foo""},
                retries=Retry(remove_headers_on_redirect=[]),
            )

            assert r.status == 200

            data = json.loads(r.data.decode(""utf-8""))

            assert data[""Authorization""] == ""foo""

    def test_redirect_cross_host_set_removed_headers(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/headers"" % self.base_url_alt},
                headers={""X-API-Secret"": ""foo"", ""Authorization"": ""bar""},
                retries=Retry(remove_headers_on_redirect=[""X-API-Secret""]),
            )

            assert r.status == 200

            data = json.loads(r.data.decode(""utf-8""))

            assert ""X-API-Secret"" not in data
            assert data[""Authorization""] == ""bar""

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": ""%s/headers"" % self.base_url_alt},
                headers={""x-api-secret"": ""foo"", ""authorization"": ""bar""},
                retries=Retry(remove_headers_on_redirect=[""X-API-Secret""]),
            )

            assert r.status == 200

            data = json.loads(r.data.decode(""utf-8""))

            assert ""x-api-secret"" not in data
            assert ""X-API-Secret"" not in data
            assert data[""Authorization""] == ""bar""

    def test_redirect_without_preload_releases_connection(self):
        with PoolManager(block=True, maxsize=2) as http:
            r = http.request(
                ""GET"", ""%s/redirect"" % self.base_url, preload_content=False
            )
            assert r._pool.num_requests == 2
            assert r._pool.num_connections == 1
            assert len(http.pools) == 1

    def test_unknown_scheme(self):
        with PoolManager() as http:
            unknown_scheme = ""unknown""
            unknown_scheme_url = ""%s://host"" % unknown_scheme
            with pytest.raises(URLSchemeUnknown) as e:
                r = http.request(""GET"", unknown_scheme_url)
            assert e.value.scheme == unknown_scheme
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={""target"": unknown_scheme_url},
                redirect=False,
            )
            assert r.status == 303
            assert r.headers.get(""Location"") == unknown_scheme_url
            with pytest.raises(URLSchemeUnknown) as e:
                r = http.request(
                    ""GET"",
                    ""%s/redirect"" % self.base_url,
                    fields={""target"": unknown_scheme_url},
                )
            assert e.value.scheme == unknown_scheme

    def test_raise_on_redirect(self):
        with PoolManager() as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.base_url,
                fields={
                    ""target"": ""%s/redirect?target=%s/"" % (self.base_url, self.base_url)
                },
                retries=Retry(total=None, redirect=1, raise_on_redirect=False),
            )

            assert r.status == 303

    def test_raise_on_status(self):
        with PoolManager() as http:
            with pytest.raises(MaxRetryError):
                # the default is to raise
                r = http.request(
                    ""GET"",
                    ""%s/status"" % self.base_url,
                    fields={""status"": ""500 Internal Server Error""},
                    retries=Retry(total=1, status_forcelist=range(500, 600)),
                )

            with pytest.raises(MaxRetryError):
                # raise explicitly
                r = http.request(
                    ""GET"",
                    ""%s/status"" % self.base_url,
                    fields={""status"": ""500 Internal Server Error""},
                    retries=Retry(
                        total=1, status_forcelist=range(500, 600), raise_on_status=True
                    ),
                )

            # don't raise
            r = http.request(
                ""GET"",
                ""%s/status"" % self.base_url,
                fields={""status"": ""500 Internal Server Error""},
                retries=Retry(
                    total=1, status_forcelist=range(500, 600), raise_on_status=False
                ),
            )

            assert r.status == 500

    def test_missing_port(self):
        # Can a URL that lacks an explicit port like ':80' succeed, or
        # will all such URLs fail with an error?

        with PoolManager() as http:
            # By globally adjusting `port_by_scheme` we pretend for a moment
            # that HTTP's default port is not 80, but is the port at which
            # our test server happens to be listening.
            port_by_scheme[""http""] = self.port
            try:
                r = http.request(""GET"", ""http://%s/"" % self.host, retries=0)
            finally:
                port_by_scheme[""http""] = 80

            assert r.status == 200
            assert r.data == b""Dummy server!""

    def test_headers(self):
        with PoolManager(headers={""Foo"": ""bar""}) as http:
            r = http.request(""GET"", ""%s/headers"" % self.base_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""

            r = http.request(""POST"", ""%s/headers"" % self.base_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.base_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""

            r = http.request_encode_body(""POST"", ""%s/headers"" % self.base_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""

            r = http.request_encode_url(
                ""GET"", ""%s/headers"" % self.base_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""

            r = http.request_encode_body(
                ""GET"", ""%s/headers"" % self.base_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""

    def test_http_with_ssl_keywords(self):
        with PoolManager(ca_certs=""REQUIRED"") as http:
            r = http.request(""GET"", ""http://%s:%s/"" % (self.host, self.port))
            assert r.status == 200

    def test_http_with_ca_cert_dir(self):
        with PoolManager(ca_certs=""REQUIRED"", ca_cert_dir=""/nosuchdir"") as http:
            r = http.request(""GET"", ""http://%s:%s/"" % (self.host, self.port))
            assert r.status == 200

    @pytest.mark.parametrize(
        [""target"", ""expected_target""],
        [
            (""/echo_uri?q=1#fragment"", b""/echo_uri?q=1""),
            (""/echo_uri?#"", b""/echo_uri?""),
            (""/echo_uri#?"", b""/echo_uri""),
            (""/echo_uri#?#"", b""/echo_uri""),
            (""/echo_uri??#"", b""/echo_uri??""),
            (""/echo_uri?%3f#"", b""/echo_uri?%3F""),
            (""/echo_uri?%3F#"", b""/echo_uri?%3F""),
            (""/echo_uri?[]"", b""/echo_uri?%5B%5D""),
        ],
    )
    def test_encode_http_target(self, target, expected_target):
        with PoolManager() as http:
            url = ""http://%s:%d%s"" % (self.host, self.port, target)
            r = http.request(""GET"", url)
            assert r.data == expected_target


@pytest.mark.skipif(not HAS_IPV6, reason=""IPv6 is not supported on this system"")
class TestIPv6PoolManager(IPv6HTTPDummyServerTestCase):
    @classmethod
    def setup_class(cls):
        super(TestIPv6PoolManager, cls).setup_class()
        cls.base_url = ""http://[%s]:%d"" % (cls.host, cls.port)

    def test_ipv6(self):
        with PoolManager() as http:
            http.request(""GET"", self.base_url)",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR  VAR = VAR.VAR.VAR VAR VAR(VAR): @VAR VAR VAR(VAR): VAR(VAR, VAR).VAR() VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/"" % VAR.VAR}, VAR=VAR, ) VAR VAR.VAR == 303 VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/"" % VAR.VAR}, ) VAR VAR.VAR == 200 VAR VAR.VAR == VAR""VAR VAR!"" VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR"" % VAR.VAR}, VAR=VAR, ) VAR VAR.VAR == 303 VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={ ""VAR"": ""%VAR/VAR?VAR=%VAR/"" % (VAR.VAR, VAR.VAR) }, ) VAR VAR.VAR == 200 VAR VAR.VAR == VAR""VAR VAR!"" VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""/VAR""}, VAR=VAR, ) VAR VAR.VAR == 303 VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""/VAR""} ) VAR VAR.VAR == 200 VAR VAR.VAR == VAR""VAR VAR!"" VAR VAR(VAR): VAR VAR() VAR VAR: VAR = ""%VAR/VAR?VAR=VAR"" % VAR.VAR VAR VAR.VAR(VAR): VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": VAR}, VAR=VAR, VAR=0, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR?VAR=VAR"" % VAR.VAR}, VAR=VAR, VAR=1, ) VAR VAR.VAR.VAR == VAR.VAR VAR VAR(VAR): VAR VAR() VAR VAR: VAR VAR.VAR(VAR): VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={ ""VAR"": ""%VAR/VAR?VAR=%VAR/"" % (VAR.VAR, VAR.VAR) }, VAR=1, VAR=VAR, ) VAR VAR.VAR(VAR): VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={ ""VAR"": ""%VAR/VAR?VAR=%VAR/"" % (VAR.VAR, VAR.VAR) }, VAR=VAR(VAR=VAR, VAR=1), VAR=VAR, )   VAR VAR(VAR.VAR) == 1 VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR VAR.VAR == 1 VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR"" % VAR.VAR}, VAR={""VAR"": ""VAR""}, ) VAR VAR.VAR == 200 VAR = VAR.VAR(VAR.VAR.VAR(""VAR-8"")) VAR ""VAR"" VAR VAR VAR VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR"" % VAR.VAR}, VAR={""VAR"": ""VAR""}, ) VAR VAR.VAR == 200 VAR = VAR.VAR(VAR.VAR.VAR(""VAR-8"")) VAR ""VAR"" VAR VAR VAR VAR ""VAR"" VAR VAR VAR VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR"" % VAR.VAR}, VAR={""VAR"": ""VAR""}, VAR=VAR(VAR=[]), ) VAR VAR.VAR == 200 VAR = VAR.VAR(VAR.VAR.VAR(""VAR-8"")) VAR VAR[""VAR""] == ""VAR"" VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR"" % VAR.VAR}, VAR={""VAR-VAR-VAR"": ""VAR"", ""VAR"": ""VAR""}, VAR=VAR(VAR=[""VAR-VAR-VAR""]), ) VAR VAR.VAR == 200 VAR = VAR.VAR(VAR.VAR.VAR(""VAR-8"")) VAR ""VAR-VAR-VAR"" VAR VAR VAR VAR VAR[""VAR""] == ""VAR"" VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR"" % VAR.VAR}, VAR={""VAR-VAR-VAR"": ""VAR"", ""VAR"": ""VAR""}, VAR=VAR(VAR=[""VAR-VAR-VAR""]), ) VAR VAR.VAR == 200 VAR = VAR.VAR(VAR.VAR.VAR(""VAR-8"")) VAR ""VAR-VAR-VAR"" VAR VAR VAR VAR ""VAR-VAR-VAR"" VAR VAR VAR VAR VAR[""VAR""] == ""VAR"" VAR VAR(VAR): VAR VAR(VAR=VAR, VAR=2) VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR=VAR ) VAR VAR.VAR.VAR == 2 VAR VAR.VAR.VAR == 1 VAR VAR(VAR.VAR) == 1 VAR VAR(VAR): VAR VAR() VAR VAR: VAR = ""VAR"" VAR = ""%VAR: VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(""VAR"", VAR) VAR VAR.VAR.VAR == VAR VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": VAR}, VAR=VAR, ) VAR VAR.VAR == 303 VAR VAR.VAR.VAR(""VAR"") == VAR VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": VAR}, ) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): VAR VAR() VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={ ""VAR"": ""%VAR/VAR?VAR=%VAR/"" % (VAR.VAR, VAR.VAR) }, VAR=VAR(VAR=VAR, VAR=1, VAR=VAR), ) VAR VAR.VAR == 303 VAR VAR(VAR): VAR VAR() VAR VAR: VAR VAR.VAR(VAR):  VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""500 VAR VAR VAR""}, VAR=VAR(VAR=1, VAR=VAR(500, 600)), ) VAR VAR.VAR(VAR):  VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""500 VAR VAR VAR""}, VAR=VAR( VAR=1, VAR=VAR(500, 600), VAR=VAR ), )  VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""500 VAR VAR VAR""}, VAR=VAR( VAR=1, VAR=VAR(500, 600), VAR=VAR ), ) VAR VAR.VAR == 500 VAR VAR(VAR):   VAR VAR() VAR VAR:    VAR[""VAR""] = VAR.VAR VAR: VAR = VAR.VAR(""VAR"", ""VAR: VAR: VAR[""VAR""] = 80 VAR VAR.VAR == 200 VAR VAR.VAR == VAR""VAR VAR!"" VAR VAR(VAR): VAR VAR(VAR={""VAR"": ""VAR""}) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR(VAR): VAR VAR(VAR=""VAR"") VAR VAR: VAR = VAR.VAR(""VAR"", ""VAR: VAR VAR.VAR == 200 VAR VAR(VAR): VAR VAR(VAR=""VAR"", VAR=""/VAR"") VAR VAR: VAR = VAR.VAR(""VAR"", ""VAR: VAR VAR.VAR == 200 @VAR.VAR.VAR( [""VAR"", ""VAR""], [ (""/VAR?VAR=1 (""/VAR? (""/VAR (""/VAR (""/VAR?? (""/VAR?%3f (""/VAR?%3F (""/VAR?[]"", VAR""/VAR?%5B%5D""), ], ) VAR VAR(VAR, VAR, VAR): VAR VAR() VAR VAR: VAR = ""VAR: VAR = VAR.VAR(""VAR"", VAR) VAR VAR.VAR == VAR @VAR.VAR.VAR(VAR VAR, VAR=""VAR VAR VAR VAR VAR VAR VAR"") VAR VAR(VAR): @VAR VAR VAR(VAR): VAR(VAR, VAR).VAR() VAR.VAR = ""VAR: VAR VAR(VAR): VAR VAR() VAR VAR: VAR.VAR(""VAR"", VAR.VAR) ",8,1
urllib3_2d4a3fee6de2fa45eb82169361918f759269b4ec,test/with_dummyserver/test_proxy_poolmanager.py,"import json
import os.path
import shutil
import socket
import tempfile
from test import (
    LONG_TIMEOUT,
    SHORT_TIMEOUT,
    onlyPy2,
    onlyPy3,
    onlySecureTransport,
    withPyOpenSSL,
)

import pytest
import trustme

from dummyserver.server import DEFAULT_CA, HAS_IPV6, get_unreachable_address
from dummyserver.testcase import HTTPDummyProxyTestCase, IPv6HTTPDummyProxyTestCase
from urllib3._collections import HTTPHeaderDict
from urllib3.connectionpool import VerifiedHTTPSConnection, connection_from_url
from urllib3.exceptions import (
    ConnectTimeoutError,
    MaxRetryError,
    ProxyError,
    ProxySchemeUnknown,
    ProxySchemeUnsupported,
    SSLError,
)
from urllib3.poolmanager import ProxyManager, proxy_from_url
from urllib3.util.ssl_ import create_urllib3_context

from .. import TARPIT_HOST, requires_network

# Retry failed tests
pytestmark = pytest.mark.flaky


class TestHTTPProxyManager(HTTPDummyProxyTestCase):
    @classmethod
    def setup_class(cls):
        super(TestHTTPProxyManager, cls).setup_class()
        cls.http_url = ""http://%s:%d"" % (cls.http_host, cls.http_port)
        cls.http_url_alt = ""http://%s:%d"" % (cls.http_host_alt, cls.http_port)
        cls.https_url = ""https://%s:%d"" % (cls.https_host, cls.https_port)
        cls.https_url_alt = ""https://%s:%d"" % (cls.https_host_alt, cls.https_port)
        cls.proxy_url = ""http://%s:%d"" % (cls.proxy_host, cls.proxy_port)
        cls.https_proxy_url = ""https://%s:%d"" % (
            cls.proxy_host,
            cls.https_proxy_port,
        )

        # Generate another CA to test verification failure
        cls.certs_dir = tempfile.mkdtemp()
        bad_ca = trustme.CA()

        cls.bad_ca_path = os.path.join(cls.certs_dir, ""ca_bad.pem"")
        bad_ca.cert_pem.write_to_path(cls.bad_ca_path)

    @classmethod
    def teardown_class(cls):
        super(TestHTTPProxyManager, cls).teardown_class()
        shutil.rmtree(cls.certs_dir)

    def test_basic_proxy(self):
        with proxy_from_url(self.proxy_url, ca_certs=DEFAULT_CA) as http:
            r = http.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            r = http.request(""GET"", ""%s/"" % self.https_url)
            assert r.status == 200

    @onlyPy3
    def test_https_proxy(self):
        with proxy_from_url(self.https_proxy_url, ca_certs=DEFAULT_CA) as https:
            r = https.request(""GET"", ""%s/"" % self.https_url)
            assert r.status == 200

            r = https.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

    @onlyPy3
    def test_https_proxy_with_proxy_ssl_context(self):
        proxy_ssl_context = create_urllib3_context()
        proxy_ssl_context.load_verify_locations(DEFAULT_CA)
        with proxy_from_url(
            self.https_proxy_url,
            proxy_ssl_context=proxy_ssl_context,
            ca_certs=DEFAULT_CA,
        ) as https:
            r = https.request(""GET"", ""%s/"" % self.https_url)
            assert r.status == 200

            r = https.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

    @onlyPy2
    def test_https_proxy_not_supported(self):
        with proxy_from_url(self.https_proxy_url, ca_certs=DEFAULT_CA) as https:
            r = https.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            with pytest.raises(ProxySchemeUnsupported) as excinfo:
                https.request(""GET"", ""%s/"" % self.https_url)

            assert ""is not supported in Python 2"" in str(excinfo.value)

    @withPyOpenSSL
    @onlyPy3
    def test_https_proxy_pyopenssl_not_supported(self):
        with proxy_from_url(self.https_proxy_url, ca_certs=DEFAULT_CA) as https:
            r = https.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            with pytest.raises(ProxySchemeUnsupported) as excinfo:
                https.request(""GET"", ""%s/"" % self.https_url)

            assert ""isn't available on non-native SSLContext"" in str(excinfo.value)

    @onlySecureTransport
    @onlyPy3
    def test_https_proxy_securetransport_not_supported(self):
        with proxy_from_url(self.https_proxy_url, ca_certs=DEFAULT_CA) as https:
            r = https.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            with pytest.raises(ProxySchemeUnsupported) as excinfo:
                https.request(""GET"", ""%s/"" % self.https_url)

            assert ""isn't available on non-native SSLContext"" in str(excinfo.value)

    def test_https_proxy_forwarding_for_https(self):
        with proxy_from_url(
            self.https_proxy_url,
            ca_certs=DEFAULT_CA,
            use_forwarding_for_https=True,
        ) as https:
            r = https.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            r = https.request(""GET"", ""%s/"" % self.https_url)
            assert r.status == 200

    def test_nagle_proxy(self):
        """"""Test that proxy connections do not have TCP_NODELAY turned on""""""
        with ProxyManager(self.proxy_url) as http:
            hc2 = http.connection_from_host(self.http_host, self.http_port)
            conn = hc2._get_conn()
            try:
                hc2._make_request(conn, ""GET"", ""/"")
                tcp_nodelay_setting = conn.sock.getsockopt(
                    socket.IPPROTO_TCP, socket.TCP_NODELAY
                )
                assert tcp_nodelay_setting == 0, (
                    ""Expected TCP_NODELAY for proxies to be set ""
                    ""to zero, instead was %s"" % tcp_nodelay_setting
                )
            finally:
                conn.close()

    def test_proxy_conn_fail(self):
        host, port = get_unreachable_address()
        with proxy_from_url(
            ""http://%s:%s/"" % (host, port), retries=1, timeout=LONG_TIMEOUT
        ) as http:
            with pytest.raises(MaxRetryError):
                http.request(""GET"", ""%s/"" % self.https_url)
            with pytest.raises(MaxRetryError):
                http.request(""GET"", ""%s/"" % self.http_url)

            with pytest.raises(MaxRetryError) as e:
                http.request(""GET"", ""%s/"" % self.http_url)
            assert type(e.value.reason) == ProxyError

    def test_oldapi(self):
        with ProxyManager(
            connection_from_url(self.proxy_url), ca_certs=DEFAULT_CA
        ) as http:
            r = http.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            r = http.request(""GET"", ""%s/"" % self.https_url)
            assert r.status == 200

    def test_proxy_verified(self):
        with proxy_from_url(
            self.proxy_url, cert_reqs=""REQUIRED"", ca_certs=self.bad_ca_path
        ) as http:
            https_pool = http._new_pool(""https"", self.https_host, self.https_port)
            with pytest.raises(MaxRetryError) as e:
                https_pool.request(""GET"", ""/"", retries=0)
            assert isinstance(e.value.reason, SSLError)
            assert ""certificate verify failed"" in str(e.value.reason), (
                ""Expected 'certificate verify failed', instead got: %r"" % e.value.reason
            )

            http = proxy_from_url(
                self.proxy_url, cert_reqs=""REQUIRED"", ca_certs=DEFAULT_CA
            )
            https_pool = http._new_pool(""https"", self.https_host, self.https_port)

            conn = https_pool._new_conn()
            assert conn.__class__ == VerifiedHTTPSConnection
            https_pool.request(""GET"", ""/"")  # Should succeed without exceptions.

            http = proxy_from_url(
                self.proxy_url, cert_reqs=""REQUIRED"", ca_certs=DEFAULT_CA
            )
            https_fail_pool = http._new_pool(""https"", ""127.0.0.1"", self.https_port)

            with pytest.raises(MaxRetryError) as e:
                https_fail_pool.request(""GET"", ""/"", retries=0)
            assert isinstance(e.value.reason, SSLError)
            assert ""doesn't match"" in str(e.value.reason)

    def test_redirect(self):
        with proxy_from_url(self.proxy_url) as http:
            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.http_url,
                fields={""target"": ""%s/"" % self.http_url},
                redirect=False,
            )

            assert r.status == 303

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.http_url,
                fields={""target"": ""%s/"" % self.http_url},
            )

            assert r.status == 200
            assert r.data == b""Dummy server!""

    def test_cross_host_redirect(self):
        with proxy_from_url(self.proxy_url) as http:
            cross_host_location = ""%s/echo?a=b"" % self.http_url_alt
            with pytest.raises(MaxRetryError):
                http.request(
                    ""GET"",
                    ""%s/redirect"" % self.http_url,
                    fields={""target"": cross_host_location},
                    retries=0,
                )

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.http_url,
                fields={""target"": ""%s/echo?a=b"" % self.http_url_alt},
                retries=1,
            )
            assert r._pool.host != self.http_host_alt

    def test_cross_protocol_redirect(self):
        with proxy_from_url(self.proxy_url, ca_certs=DEFAULT_CA) as http:
            cross_protocol_location = ""%s/echo?a=b"" % self.https_url
            with pytest.raises(MaxRetryError):
                http.request(
                    ""GET"",
                    ""%s/redirect"" % self.http_url,
                    fields={""target"": cross_protocol_location},
                    retries=0,
                )

            r = http.request(
                ""GET"",
                ""%s/redirect"" % self.http_url,
                fields={""target"": ""%s/echo?a=b"" % self.https_url},
                retries=1,
            )
            assert r._pool.host == self.https_host

    def test_headers(self):
        with proxy_from_url(
            self.proxy_url,
            headers={""Foo"": ""bar""},
            proxy_headers={""Hickory"": ""dickory""},
            ca_certs=DEFAULT_CA,
        ) as http:

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.http_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host,
                self.http_port,
            )

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.http_url_alt)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host_alt,
                self.http_port,
            )

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.https_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") is None
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.https_host,
                self.https_port,
            )

            r = http.request_encode_body(""POST"", ""%s/headers"" % self.http_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host,
                self.http_port,
            )

            r = http.request_encode_url(
                ""GET"", ""%s/headers"" % self.http_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host,
                self.http_port,
            )

            r = http.request_encode_url(
                ""GET"", ""%s/headers"" % self.https_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""
            assert returned_headers.get(""Hickory"") is None
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.https_host,
                self.https_port,
            )

            r = http.request_encode_body(
                ""GET"", ""%s/headers"" % self.http_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host,
                self.http_port,
            )

            r = http.request_encode_body(
                ""GET"", ""%s/headers"" % self.https_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""
            assert returned_headers.get(""Hickory"") is None
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.https_host,
                self.https_port,
            )

    @onlyPy3
    def test_https_headers(self):
        with proxy_from_url(
            self.https_proxy_url,
            headers={""Foo"": ""bar""},
            proxy_headers={""Hickory"": ""dickory""},
            ca_certs=DEFAULT_CA,
        ) as http:

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.http_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host,
                self.http_port,
            )

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.http_url_alt)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.http_host_alt,
                self.http_port,
            )

            r = http.request_encode_body(
                ""GET"", ""%s/headers"" % self.https_url, headers={""Baz"": ""quux""}
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") is None
            assert returned_headers.get(""Baz"") == ""quux""
            assert returned_headers.get(""Hickory"") is None
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.https_host,
                self.https_port,
            )

    def test_https_headers_forwarding_for_https(self):
        with proxy_from_url(
            self.https_proxy_url,
            headers={""Foo"": ""bar""},
            proxy_headers={""Hickory"": ""dickory""},
            ca_certs=DEFAULT_CA,
            use_forwarding_for_https=True,
        ) as http:

            r = http.request_encode_url(""GET"", ""%s/headers"" % self.https_url)
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Hickory"") == ""dickory""
            assert returned_headers.get(""Host"") == ""%s:%s"" % (
                self.https_host,
                self.https_port,
            )

    def test_headerdict(self):
        default_headers = HTTPHeaderDict(a=""b"")
        proxy_headers = HTTPHeaderDict()
        proxy_headers.add(""foo"", ""bar"")

        with proxy_from_url(
            self.proxy_url, headers=default_headers, proxy_headers=proxy_headers
        ) as http:
            request_headers = HTTPHeaderDict(baz=""quux"")
            r = http.request(
                ""GET"", ""%s/headers"" % self.http_url, headers=request_headers
            )
            returned_headers = json.loads(r.data.decode())
            assert returned_headers.get(""Foo"") == ""bar""
            assert returned_headers.get(""Baz"") == ""quux""

    def test_proxy_pooling(self):
        with proxy_from_url(self.proxy_url, cert_reqs=""NONE"") as http:
            for x in range(2):
                http.urlopen(""GET"", self.http_url)
            assert len(http.pools) == 1

            for x in range(2):
                http.urlopen(""GET"", self.http_url_alt)
            assert len(http.pools) == 1

            for x in range(2):
                http.urlopen(""GET"", self.https_url)
            assert len(http.pools) == 2

            for x in range(2):
                http.urlopen(""GET"", self.https_url_alt)
            assert len(http.pools) == 3

    def test_proxy_pooling_ext(self):
        with proxy_from_url(self.proxy_url) as http:
            hc1 = http.connection_from_url(self.http_url)
            hc2 = http.connection_from_host(self.http_host, self.http_port)
            hc3 = http.connection_from_url(self.http_url_alt)
            hc4 = http.connection_from_host(self.http_host_alt, self.http_port)
            assert hc1 == hc2
            assert hc2 == hc3
            assert hc3 == hc4

            sc1 = http.connection_from_url(self.https_url)
            sc2 = http.connection_from_host(
                self.https_host, self.https_port, scheme=""https""
            )
            sc3 = http.connection_from_url(self.https_url_alt)
            sc4 = http.connection_from_host(
                self.https_host_alt, self.https_port, scheme=""https""
            )
            assert sc1 == sc2
            assert sc2 != sc3
            assert sc3 == sc4

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_timeout(self):
        with proxy_from_url(""https://{host}"".format(host=TARPIT_HOST)) as https:
            with pytest.raises(MaxRetryError) as e:
                https.request(""GET"", self.http_url, timeout=SHORT_TIMEOUT)
            assert type(e.value.reason) == ConnectTimeoutError

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_pool_timeout(self):
        with proxy_from_url(
            ""https://{host}"".format(host=TARPIT_HOST), timeout=SHORT_TIMEOUT
        ) as https:
            with pytest.raises(MaxRetryError) as e:
                https.request(""GET"", self.http_url)
            assert type(e.value.reason) == ConnectTimeoutError

    def test_scheme_host_case_insensitive(self):
        """"""Assert that upper-case schemes and hosts are normalized.""""""
        with proxy_from_url(self.proxy_url.upper(), ca_certs=DEFAULT_CA) as http:
            r = http.request(""GET"", ""%s/"" % self.http_url.upper())
            assert r.status == 200

            r = http.request(""GET"", ""%s/"" % self.https_url.upper())
            assert r.status == 200

    @pytest.mark.parametrize(
        ""url, error_msg"",
        [
            (
                ""127.0.0.1"",
                ""Proxy URL had no scheme, should start with http:// or https://"",
            ),
            (
                ""localhost:8080"",
                ""Proxy URL had no scheme, should start with http:// or https://"",
            ),
            (
                ""ftp://google.com"",
                ""Proxy URL had unsupported scheme ftp, should use http:// or https://"",
            ),
        ],
    )
    def test_invalid_schema(self, url, error_msg):
        with pytest.raises(ProxySchemeUnknown, match=error_msg):
            proxy_from_url(url)


@pytest.mark.skipif(not HAS_IPV6, reason=""Only runs on IPv6 systems"")
class TestIPv6HTTPProxyManager(IPv6HTTPDummyProxyTestCase):
    @classmethod
    def setup_class(cls):
        HTTPDummyProxyTestCase.setup_class()
        cls.http_url = ""http://%s:%d"" % (cls.http_host, cls.http_port)
        cls.http_url_alt = ""http://%s:%d"" % (cls.http_host_alt, cls.http_port)
        cls.https_url = ""https://%s:%d"" % (cls.https_host, cls.https_port)
        cls.https_url_alt = ""https://%s:%d"" % (cls.https_host_alt, cls.https_port)
        cls.proxy_url = ""http://[%s]:%d"" % (cls.proxy_host, cls.proxy_port)

    def test_basic_ipv6_proxy(self):
        with proxy_from_url(self.proxy_url, ca_certs=DEFAULT_CA) as http:
            r = http.request(""GET"", ""%s/"" % self.http_url)
            assert r.status == 200

            r = http.request(""GET"", ""%s/"" % self.https_url)
            assert r.status == 200


class TestHTTPSProxyVerification:
    @onlyPy3
    def test_https_proxy_hostname_verification(self, no_localhost_san_server):
        bad_server = no_localhost_san_server
        bad_proxy_url = ""https://%s:%s"" % (bad_server.host, bad_server.port)

        # An exception will be raised before we contact the destination domain.
        test_url = ""testing.com""
        with proxy_from_url(bad_proxy_url, ca_certs=bad_server.ca_certs) as https:
            with pytest.raises(MaxRetryError) as e:
                https.request(""GET"", ""http://%s/"" % test_url)
            assert isinstance(e.value.reason, SSLError)
            assert ""hostname 'localhost' doesn't match"" in str(e.value.reason)

            with pytest.raises(MaxRetryError) as e:
                https.request(""GET"", ""https://%s/"" % test_url)
            assert isinstance(e.value.reason, SSLError)
            assert ""hostname 'localhost' doesn't match"" in str(
                e.value.reason
            ) or ""Hostname mismatch"" in str(e.value.reason)",,2d4a3fee6de2fa45eb82169361918f759269b4ec,CVE-2021-33503,2d4a3fee6de2fa45eb82169361918f759269b4ec,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR.VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR ( VAR, VAR, VAR, VAR, VAR, VAR, ) VAR VAR VAR VAR VAR VAR.VAR VAR VAR, VAR, VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR, VAR, VAR, ) VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR.VAR VAR VAR VAR .. VAR VAR, VAR  VAR = VAR.VAR.VAR VAR VAR(VAR): @VAR VAR VAR(VAR): VAR(VAR, VAR).VAR() VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR, VAR.VAR, )  VAR.VAR = VAR.VAR() VAR = VAR.VAR() VAR.VAR = VAR.VAR.VAR(VAR.VAR, ""VAR.VAR"") VAR.VAR.VAR(VAR.VAR) @VAR VAR VAR(VAR): VAR(VAR, VAR).VAR() VAR.VAR(VAR.VAR) VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 @VAR VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 @VAR VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR) VAR VAR( VAR.VAR, VAR=VAR, VAR=VAR, ) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 @VAR VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR ""VAR VAR VAR VAR VAR 2"" VAR VAR(VAR.VAR) @VAR @VAR VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR ""VAR'VAR VAR VAR VAR-VAR VAR"" VAR VAR(VAR.VAR) @VAR @VAR VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR ""VAR'VAR VAR VAR VAR-VAR VAR"" VAR VAR(VAR.VAR) VAR VAR(VAR): VAR VAR( VAR.VAR, VAR=VAR, VAR=VAR, ) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR"""""" VAR VAR(VAR.VAR) VAR VAR: VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR: VAR.VAR(VAR, ""VAR"", ""/"") VAR = VAR.VAR.VAR( VAR.VAR, VAR.VAR ) VAR VAR == 0, ( ""VAR VAR VAR VAR VAR VAR VAR "" ""VAR VAR, VAR VAR %VAR"" % VAR ) VAR: VAR.VAR() VAR VAR(VAR): VAR, VAR = VAR() VAR VAR( ""VAR: ) VAR VAR: VAR VAR.VAR(VAR): VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR(VAR): VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR(VAR.VAR.VAR) == VAR VAR VAR(VAR): VAR VAR( VAR(VAR.VAR), VAR=VAR ) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR VAR(VAR): VAR VAR( VAR.VAR, VAR=""VAR"", VAR=VAR.VAR ) VAR VAR: VAR = VAR.VAR(""VAR"", VAR.VAR, VAR.VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR=0) VAR VAR(VAR.VAR.VAR, VAR) VAR ""VAR VAR VAR"" VAR VAR(VAR.VAR.VAR), ( ""VAR 'VAR VAR VAR', VAR VAR: %VAR"" % VAR.VAR.VAR ) VAR = VAR( VAR.VAR, VAR=""VAR"", VAR=VAR ) VAR = VAR.VAR(""VAR"", VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR VAR.VAR == VAR VAR.VAR(""VAR"", ""/"")  VAR = VAR( VAR.VAR, VAR=""VAR"", VAR=VAR ) VAR = VAR.VAR(""VAR"", ""127.0.0.1"", VAR.VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""/"", VAR=0) VAR VAR(VAR.VAR.VAR, VAR) VAR ""VAR'VAR VAR"" VAR VAR(VAR.VAR.VAR) VAR VAR(VAR): VAR VAR(VAR.VAR) VAR VAR: VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/"" % VAR.VAR}, VAR=VAR, ) VAR VAR.VAR == 303 VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/"" % VAR.VAR}, ) VAR VAR.VAR == 200 VAR VAR.VAR == VAR""VAR VAR!"" VAR VAR(VAR): VAR VAR(VAR.VAR) VAR VAR: VAR = ""%VAR/VAR?VAR=VAR"" % VAR.VAR VAR VAR.VAR(VAR): VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": VAR}, VAR=0, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR?VAR=VAR"" % VAR.VAR}, VAR=1, ) VAR VAR.VAR.VAR != VAR.VAR VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = ""%VAR/VAR?VAR=VAR"" % VAR.VAR VAR VAR.VAR(VAR): VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": VAR}, VAR=0, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""%VAR/VAR?VAR=VAR"" % VAR.VAR}, VAR=1, ) VAR VAR.VAR.VAR == VAR.VAR VAR VAR(VAR): VAR VAR( VAR.VAR, VAR={""VAR"": ""VAR""}, VAR={""VAR"": ""VAR""}, VAR=VAR, ) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) @VAR VAR VAR(VAR): VAR VAR( VAR.VAR, VAR={""VAR"": ""VAR""}, VAR={""VAR"": ""VAR""}, VAR=VAR, ) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR={""VAR"": ""VAR""} ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") VAR VAR VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR VAR(VAR): VAR VAR( VAR.VAR, VAR={""VAR"": ""VAR""}, VAR={""VAR"": ""VAR""}, VAR=VAR, VAR=VAR, ) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/VAR"" % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""%VAR:%VAR"" % ( VAR.VAR, VAR.VAR, ) VAR VAR(VAR): VAR = VAR(VAR=""VAR"") VAR = VAR() VAR.VAR(""VAR"", ""VAR"") VAR VAR( VAR.VAR, VAR=VAR, VAR=VAR ) VAR VAR: VAR = VAR(VAR=""VAR"") VAR = VAR.VAR( ""VAR"", ""%VAR/VAR"" % VAR.VAR, VAR=VAR ) VAR = VAR.VAR(VAR.VAR.VAR()) VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR.VAR(""VAR"") == ""VAR"" VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=""VAR"") VAR VAR: VAR VAR VAR VAR(2): VAR.VAR(""VAR"", VAR.VAR) VAR VAR(VAR.VAR) == 1 VAR VAR VAR VAR(2): VAR.VAR(""VAR"", VAR.VAR) VAR VAR(VAR.VAR) == 1 VAR VAR VAR VAR(2): VAR.VAR(""VAR"", VAR.VAR) VAR VAR(VAR.VAR) == 2 VAR VAR VAR VAR(2): VAR.VAR(""VAR"", VAR.VAR) VAR VAR(VAR.VAR) == 3 VAR VAR(VAR): VAR VAR(VAR.VAR) VAR VAR: VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR VAR == VAR VAR VAR == VAR VAR VAR == VAR VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR( VAR.VAR, VAR.VAR, VAR=""VAR"" ) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR( VAR.VAR, VAR.VAR, VAR=""VAR"" ) VAR VAR == VAR VAR VAR != VAR VAR VAR == VAR @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR VAR(""VAR: VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", VAR.VAR, VAR=VAR) VAR VAR(VAR.VAR.VAR) == VAR @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR VAR( ""VAR: ) VAR VAR: VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", VAR.VAR) VAR VAR(VAR.VAR.VAR) == VAR VAR VAR(VAR): """"""VAR VAR VAR-VAR VAR VAR VAR VAR VAR."""""" VAR VAR(VAR.VAR.VAR(), VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR.VAR()) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR.VAR()) VAR VAR.VAR == 200 @VAR.VAR.VAR( ""VAR, VAR"", [ ( ""127.0.0.1"", ""VAR VAR VAR VAR VAR, VAR VAR VAR VAR: ), ( ""VAR:8080"", ""VAR VAR VAR VAR VAR, VAR VAR VAR VAR: ), ( ""VAR: ""VAR VAR VAR VAR VAR VAR, VAR VAR VAR: ), ], ) VAR VAR(VAR, VAR, VAR): VAR VAR.VAR(VAR, VAR=VAR): VAR(VAR) @VAR.VAR.VAR(VAR VAR, VAR=""VAR VAR VAR VAR VAR"") VAR VAR(VAR): @VAR VAR VAR(VAR): VAR.VAR() VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR.VAR = ""VAR: VAR VAR(VAR): VAR VAR(VAR.VAR, VAR=VAR) VAR VAR: VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR = VAR.VAR(""VAR"", ""%VAR/"" % VAR.VAR) VAR VAR.VAR == 200 VAR VAR: @VAR VAR VAR(VAR, VAR): VAR = VAR VAR = ""VAR:  VAR = ""VAR.VAR"" VAR VAR(VAR, VAR=VAR.VAR) VAR VAR: VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""VAR: VAR VAR(VAR.VAR.VAR, VAR) VAR ""VAR 'VAR' VAR'VAR VAR"" VAR VAR(VAR.VAR.VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(""VAR"", ""VAR: VAR VAR(VAR.VAR.VAR, VAR) VAR ""VAR 'VAR' VAR'VAR VAR"" VAR VAR( VAR.VAR.VAR ) VAR ""VAR VAR"" VAR VAR(VAR.VAR.VAR) ",8,1
urllib3_9b76785331243689a9d52cef3db05ef7462cb02d,dummyserver/proxy.py,"#!/usr/bin/env python
#
# Simple asynchronous HTTP proxy with tunnelling (CONNECT).
#
# GET/POST proxying based on
# http://groups.google.com/group/python-tornado/msg/7bea08e7a049cf26
#
# Copyright (C) 2012 Senko Rasic <senko.rasic@dobarkod.hr>
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the ""Software""), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.

import sys
import socket

import tornado.httpserver
import tornado.ioloop
import tornado.iostream
import tornado.web
import tornado.httpclient

__all__ = ['ProxyHandler', 'run_proxy']


class ProxyHandler(tornado.web.RequestHandler):
    SUPPORTED_METHODS = ['GET', 'POST', 'CONNECT']

    @tornado.web.asynchronous
    def get(self):

        def handle_response(response):
            if response.error and not isinstance(response.error,
                                                 tornado.httpclient.HTTPError):
                self.set_status(500)
                self.write('Internal server error:\n' + str(response.error))
                self.finish()
            else:
                self.set_status(response.code)
                for header in ('Date', 'Cache-Control', 'Server',
                               'Content-Type', 'Location'):
                    v = response.headers.get(header)
                    if v:
                        self.set_header(header, v)
                if response.body:
                    self.write(response.body)
                self.finish()

        req = tornado.httpclient.HTTPRequest(
            url=self.request.uri,
            method=self.request.method, body=self.request.body,
            headers=self.request.headers, follow_redirects=False,
            allow_nonstandard_methods=True)

        client = tornado.httpclient.AsyncHTTPClient()
        try:
            client.fetch(req, handle_response)
        except tornado.httpclient.HTTPError as e:
            if hasattr(e, 'response') and e.response:
                self.handle_response(e.response)
            else:
                self.set_status(500)
                self.write('Internal server error:\n' + str(e))
                self.finish()

    @tornado.web.asynchronous
    def post(self):
        return self.get()

    @tornado.web.asynchronous
    def connect(self):
        host, port = self.request.uri.split(':')
        client = self.request.connection.stream

        def read_from_client(data):
            upstream.write(data)

        def read_from_upstream(data):
            client.write(data)

        def client_close(data=None):
            if upstream.closed():
                return
            if data:
                upstream.write(data)
            upstream.close()

        def upstream_close(data=None):
            if client.closed():
                return
            if data:
                client.write(data)
            client.close()

        def start_tunnel():
            client.read_until_close(client_close, read_from_client)
            upstream.read_until_close(upstream_close, read_from_upstream)
            client.write(b'HTTP/1.0 200 Connection established\r\n\r\n')

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
        upstream = tornado.iostream.IOStream(s)
        upstream.connect((host, int(port)), start_tunnel)


def run_proxy(port, start_ioloop=True):
    """"""
    Run proxy on the specified port. If start_ioloop is True (default),
    the tornado IOLoop will be started immediately.
    """"""
    app = tornado.web.Application([
        (r'.*', ProxyHandler),
    ])
    app.listen(port)
    ioloop = tornado.ioloop.IOLoop.instance()
    if start_ioloop:
        ioloop.start()


if __name__ == '__main__':
    port = 8888
    if len(sys.argv) > 1:
        port = int(sys.argv[1])

    print(""Starting HTTP proxy on port %d"" % port)
    run_proxy(port)",,9b76785331243689a9d52cef3db05ef7462cb02d,CVE-2019-11236,9b76785331243689a9d52cef3db05ef7462cb02d,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,70,COMPLETED,"                          VAR VAR VAR VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR = ['VAR', 'VAR'] VAR VAR(VAR.VAR.VAR): VAR = ['VAR', 'VAR', 'VAR'] @VAR.VAR.VAR VAR VAR(VAR): VAR VAR(VAR): VAR VAR.VAR VAR VAR VAR(VAR.VAR, VAR.VAR.VAR): VAR.VAR(500) VAR.VAR('VAR VAR VAR:\VAR' + VAR(VAR.VAR)) VAR.VAR() VAR: VAR.VAR(VAR.VAR) VAR VAR VAR ('VAR', 'VAR-VAR', 'VAR', 'VAR-VAR', 'VAR'): VAR = VAR.VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR.VAR() VAR = VAR.VAR.VAR( VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR, VAR=VAR) VAR = VAR.VAR.VAR() VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR.VAR VAR VAR: VAR VAR(VAR, 'VAR') VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR: VAR.VAR(500) VAR.VAR('VAR VAR VAR:\VAR' + VAR(VAR)) VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR, VAR = VAR.VAR.VAR.VAR(':') VAR = VAR.VAR.VAR.VAR VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR=VAR): VAR VAR.VAR(): VAR VAR VAR: VAR.VAR(VAR) VAR.VAR() VAR VAR(VAR=VAR): VAR VAR.VAR(): VAR VAR VAR: VAR.VAR(VAR) VAR.VAR() VAR VAR(): VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR'VAR/1.0 200 VAR VAR\VAR\VAR\VAR\VAR') VAR = VAR.VAR(VAR.VAR, VAR.VAR, 0) VAR = VAR.VAR.VAR(VAR) VAR.VAR((VAR, VAR(VAR)), VAR) VAR VAR(VAR, VAR=VAR): """""" VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR (VAR), VAR VAR VAR VAR VAR VAR VAR. """""" VAR = VAR.VAR.VAR([ (VAR'.*', VAR), ]) VAR.VAR(VAR) VAR = VAR.VAR.VAR.VAR() VAR VAR: VAR.VAR() VAR VAR == 'VAR': VAR = 8888 VAR VAR(VAR.VAR) > 1: VAR = VAR(VAR.VAR[1]) VAR(""VAR VAR VAR VAR VAR %VAR"" % VAR) VAR(VAR) ",16,1
urllib3_9b76785331243689a9d52cef3db05ef7462cb02d,test/appengine/test_urlfetch.py,"""""""These tests ensure that when running in App Engine standard with the
App Engine sandbox enabled that urllib3 appropriately uses the App
Engine-patched version of httplib to make requests.""""""

import httplib
import StringIO
import unittest

from mock import patch
import pytest

from ..test_no_ssl import TestWithoutSSL


class MockResponse(object):
    def __init__(self, content, status_code, content_was_truncated, final_url,
                 headers):

        self.content = content
        self.status_code = status_code
        self.content_was_truncated = content_was_truncated
        self.final_url = final_url
        self.header_msg = httplib.HTTPMessage(StringIO.StringIO(''.join(
            [""%s: %s\n"" % (k, v) for k, v in headers.iteritems()] + [""\n""])))
        self.headers = headers


@pytest.mark.usefixtures('sandbox')
class TestHTTP(TestWithoutSSL):
    def test_urlfetch_called_with_http(self):
        """"""Check that URLFetch is used to fetch non-https resources.""""""
        resp = MockResponse(
            'OK',
            200,
            False,
            'http://www.google.com',
            {'content-type': 'text/plain'})
        fetch_patch = patch(
            'google.appengine.api.urlfetch.fetch', return_value=resp
        )
        with fetch_patch as fetch_mock:
            import urllib3
            pool = urllib3.HTTPConnectionPool('www.google.com', '80')
            r = pool.request('GET', '/')
            self.assertEqual(r.status, 200, r.data)
            self.assertEqual(fetch_mock.call_count, 1)


@pytest.mark.usefixtures('sandbox')
class TestHTTPS(unittest.TestCase):
    @pytest.mark.xfail(
        reason='This is not yet supported by urlfetch, presence of the ssl '
               'module will bypass urlfetch.')
    def test_urlfetch_called_with_https(self):
        """"""
        Check that URLFetch is used when fetching https resources
        """"""
        resp = MockResponse(
            'OK',
            200,
            False,
            'https://www.google.com',
            {'content-type': 'text/plain'})
        fetch_patch = patch(
            'google.appengine.api.urlfetch.fetch', return_value=resp
        )
        with fetch_patch as fetch_mock:
            import urllib3
            pool = urllib3.HTTPSConnectionPool('www.google.com', '443')
            pool.ConnectionCls = urllib3.connection.UnverifiedHTTPSConnection
            r = pool.request('GET', '/')
            self.assertEqual(r.status, 200, r.data)
            self.assertEqual(fetch_mock.call_count, 1)",,9b76785331243689a9d52cef3db05ef7462cb02d,CVE-2019-11236,9b76785331243689a9d52cef3db05ef7462cb02d,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,70,COMPLETED,"""""""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR VAR VAR VAR VAR."""""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR ..VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR, VAR, VAR, VAR, VAR, VAR): VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR.VAR(VAR.VAR(''.VAR( [""%VAR: %VAR\VAR"" % (VAR, VAR) VAR VAR, VAR VAR VAR.VAR()] + [""\VAR""]))) VAR.VAR = VAR @VAR.VAR.VAR('VAR') VAR VAR(VAR): VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR."""""" VAR = VAR( 'VAR', 200, VAR, 'VAR: {'VAR-VAR': 'VAR/VAR'}) VAR = VAR( 'VAR.VAR.VAR.VAR.VAR', VAR=VAR ) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR('VAR.VAR.VAR', '80') VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR.VAR(VAR.VAR, 1) @VAR.VAR.VAR('VAR') VAR VAR(VAR.VAR): @VAR.VAR.VAR( VAR='VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR ' 'VAR VAR VAR VAR.') VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR( 'VAR', 200, VAR, 'VAR: {'VAR-VAR': 'VAR/VAR'}) VAR = VAR( 'VAR.VAR.VAR.VAR.VAR', VAR=VAR ) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR('VAR.VAR.VAR', '443') VAR.VAR = VAR.VAR.VAR VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR.VAR(VAR.VAR, 1) ",8,1
urllib3_9b76785331243689a9d52cef3db05ef7462cb02d,test/test_retry.py,"import pytest

from urllib3.response import HTTPResponse
from urllib3.packages.six.moves import xrange
from urllib3.util.retry import Retry, RequestHistory
from urllib3.exceptions import (
    ConnectTimeoutError,
    MaxRetryError,
    ReadTimeoutError,
    ResponseError,
)


class TestRetry(object):

    def test_string(self):
        """""" Retry string representation looks the way we expect """"""
        retry = Retry()
        assert str(retry) == 'Retry(total=10, connect=None, read=None, redirect=None, status=None)'
        for _ in range(3):
            retry = retry.increment(method='GET')
        assert str(retry) == 'Retry(total=7, connect=None, read=None, redirect=None, status=None)'

    def test_retry_both_specified(self):
        """"""Total can win if it's lower than the connect value""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=3, total=2)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

    def test_retry_higher_total_loses(self):
        """""" A lower connect timeout than the total is honored """"""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=3)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

    def test_retry_higher_total_loses_vs_read(self):
        """""" A lower read timeout than the total is honored """"""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=2, total=3)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(method='GET', error=error)

    def test_retry_total_none(self):
        """""" if Total is none, connect error should take precedence """"""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=None)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(connect=2, total=None)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        assert not retry.is_exhausted()

    def test_retry_default(self):
        """""" If no value is specified, should retry connects 3 times """"""
        retry = Retry()
        assert retry.total == 10
        assert retry.connect is None
        assert retry.read is None
        assert retry.redirect is None

        error = ConnectTimeoutError()
        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        assert not retry.is_exhausted()

        assert Retry(0).raise_on_redirect
        assert not Retry(False).raise_on_redirect

    def test_retry_read_zero(self):
        """""" No second chances on read timeouts, by default """"""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=0)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(method='GET', error=error)
        assert e.value.reason == error

    def test_status_counter(self):
        resp = HTTPResponse(status=400)
        retry = Retry(status=2)
        retry = retry.increment(response=resp)
        retry = retry.increment(response=resp)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(response=resp)
        assert str(e.value.reason) == ResponseError.SPECIFIC_ERROR.format(status_code=400)

    def test_backoff(self):
        """""" Backoff is computed correctly """"""
        max_backoff = Retry.BACKOFF_MAX

        retry = Retry(total=100, backoff_factor=0.2)
        assert retry.get_backoff_time() == 0  # First request

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0  # First retry

        retry = retry.increment(method='GET')
        assert retry.backoff_factor == 0.2
        assert retry.total == 98
        assert retry.get_backoff_time() == 0.4  # Start backoff

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.8

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 1.6

        for _ in xrange(10):
            retry = retry.increment(method='GET')

        assert retry.get_backoff_time() == max_backoff

    def test_zero_backoff(self):
        retry = Retry()
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0

    def test_backoff_reset_after_redirect(self):
        retry = Retry(total=100, redirect=5, backoff_factor=0.2)
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.4
        redirect_response = HTTPResponse(status=302, headers={'location': 'test'})
        retry = retry.increment(method='GET', response=redirect_response)
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.4

    def test_sleep(self):
        # sleep a very small amount of time so our code coverage is happy
        retry = Retry(backoff_factor=0.0001)
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        retry.sleep()

    def test_status_forcelist(self):
        retry = Retry(status_forcelist=xrange(500, 600))
        assert not retry.is_retry('GET', status_code=200)
        assert not retry.is_retry('GET', status_code=400)
        assert retry.is_retry('GET', status_code=500)

        retry = Retry(total=1, status_forcelist=[418])
        assert not retry.is_retry('GET', status_code=400)
        assert retry.is_retry('GET', status_code=418)

        # String status codes are not matched.
        retry = Retry(total=1, status_forcelist=['418'])
        assert not retry.is_retry('GET', status_code=418)

    def test_method_whitelist_with_status_forcelist(self):
        # Falsey method_whitelist means to retry on any method.
        retry = Retry(status_forcelist=[500], method_whitelist=None)
        assert retry.is_retry('GET', status_code=500)
        assert retry.is_retry('POST', status_code=500)

        # Criteria of method_whitelist and status_forcelist are ANDed.
        retry = Retry(status_forcelist=[500], method_whitelist=['POST'])
        assert not retry.is_retry('GET', status_code=500)
        assert retry.is_retry('POST', status_code=500)

    def test_exhausted(self):
        assert not Retry(0).is_exhausted()
        assert Retry(-1).is_exhausted()
        assert Retry(1).increment(method='GET').total == 0

    @pytest.mark.parametrize('total', [-1, 0])
    def test_disabled(self, total):
        with pytest.raises(MaxRetryError):
            Retry(total).increment(method='GET')

    def test_error_message(self):
        retry = Retry(total=0)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(method='GET',
                                    error=ReadTimeoutError(None, ""/"", ""read timed out""))
        assert 'Caused by redirect' not in str(e.value)
        assert str(e.value.reason) == 'None: read timed out'

        retry = Retry(total=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment('POST', '/')
            retry = retry.increment('POST', '/')
        assert 'Caused by redirect' not in str(e.value)
        assert isinstance(e.value.reason, ResponseError)
        assert str(e.value.reason) == ResponseError.GENERIC_ERROR

        retry = Retry(total=1)
        response = HTTPResponse(status=500)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment('POST', '/', response=response)
            retry = retry.increment('POST', '/', response=response)
        assert 'Caused by redirect' not in str(e.value)
        msg = ResponseError.SPECIFIC_ERROR.format(status_code=500)
        assert str(e.value.reason) == msg

        retry = Retry(connect=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(error=ConnectTimeoutError('conntimeout'))
            retry = retry.increment(error=ConnectTimeoutError('conntimeout'))
        assert 'Caused by redirect' not in str(e.value)
        assert str(e.value.reason) == 'conntimeout'

    def test_history(self):
        retry = Retry(total=10, method_whitelist=frozenset(['GET', 'POST']))
        assert retry.history == tuple()
        connection_error = ConnectTimeoutError('conntimeout')
        retry = retry.increment('GET', '/test1', None, connection_error)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),)
        assert retry.history == history

        read_error = ReadTimeoutError(None, ""/test2"", ""read timed out"")
        retry = retry.increment('POST', '/test2', None, read_error)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),
                   RequestHistory('POST', '/test2', read_error, None, None))
        assert retry.history == history

        response = HTTPResponse(status=500)
        retry = retry.increment('GET', '/test3', response, None)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),
                   RequestHistory('POST', '/test2', read_error, None, None),
                   RequestHistory('GET', '/test3', None, 500, None))
        assert retry.history == history

    def test_retry_method_not_in_whitelist(self):
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry()
        with pytest.raises(ReadTimeoutError):
            retry.increment(method='POST', error=error)

    def test_retry_default_remove_headers_on_redirect(self):
        retry = Retry()

        assert list(retry.remove_headers_on_redirect) == ['authorization']

    def test_retry_set_remove_headers_on_redirect(self):
        retry = Retry(remove_headers_on_redirect=['x-api-secret'])

        assert list(retry.remove_headers_on_redirect) == ['x-api-secret']",,9b76785331243689a9d52cef3db05ef7462cb02d,CVE-2019-11236,9b76785331243689a9d52cef3db05ef7462cb02d,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,70,COMPLETED,"VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR, ) VAR VAR(VAR): VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR() VAR VAR(VAR) == 'VAR(VAR=10, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)' VAR VAR VAR VAR(3): VAR = VAR.VAR(VAR='VAR') VAR VAR(VAR) == 'VAR(VAR=7, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)' VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=3, VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR() VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR(VAR): """""" VAR VAR VAR VAR, VAR VAR VAR VAR VAR """""" VAR = VAR() VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR VAR.VAR() VAR VAR(VAR): """""" VAR VAR VAR VAR VAR, VAR VAR VAR 3 VAR """""" VAR = VAR() VAR VAR.VAR == 10 VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR VAR(0).VAR VAR VAR VAR(VAR).VAR VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR, VAR VAR """""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR=400) VAR = VAR(VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR.VAR(VAR=400) VAR VAR(VAR): """""" VAR VAR VAR VAR """""" VAR = VAR.VAR VAR = VAR(VAR=100, VAR=0.2) VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR == 0.2 VAR VAR.VAR == 98 VAR VAR.VAR() == 0.4  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.8 VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 1.6 VAR VAR VAR VAR(10): VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == VAR VAR VAR(VAR): VAR = VAR() VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0 VAR VAR(VAR): VAR = VAR(VAR=100, VAR=5, VAR=0.2) VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.4 VAR = VAR(VAR=302, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.4 VAR VAR(VAR):  VAR = VAR(VAR=0.0001) VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR.VAR() VAR VAR(VAR): VAR = VAR(VAR=VAR(500, 600)) VAR VAR VAR.VAR('VAR', VAR=200) VAR VAR VAR.VAR('VAR', VAR=400) VAR VAR.VAR('VAR', VAR=500) VAR = VAR(VAR=1, VAR=[418]) VAR VAR VAR.VAR('VAR', VAR=400) VAR VAR.VAR('VAR', VAR=418)  VAR = VAR(VAR=1, VAR=['418']) VAR VAR VAR.VAR('VAR', VAR=418) VAR VAR(VAR):  VAR = VAR(VAR=[500], VAR=VAR) VAR VAR.VAR('VAR', VAR=500) VAR VAR.VAR('VAR', VAR=500)  VAR = VAR(VAR=[500], VAR=['VAR']) VAR VAR VAR.VAR('VAR', VAR=500) VAR VAR.VAR('VAR', VAR=500) VAR VAR(VAR): VAR VAR VAR(0).VAR() VAR VAR(-1).VAR() VAR VAR(1).VAR(VAR='VAR').VAR == 0 @VAR.VAR.VAR('VAR', [-1, 0]) VAR VAR(VAR, VAR): VAR VAR.VAR(VAR): VAR(VAR).VAR(VAR='VAR') VAR VAR(VAR): VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR='VAR', VAR=VAR(VAR, ""/"", ""VAR VAR VAR"")) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == 'VAR: VAR VAR VAR' VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR('VAR', '/') VAR = VAR.VAR('VAR', '/') VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR, VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR VAR = VAR(VAR=1) VAR = VAR(VAR=500) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR('VAR', '/', VAR=VAR) VAR = VAR.VAR('VAR', '/', VAR=VAR) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR = VAR.VAR.VAR(VAR=500) VAR VAR(VAR.VAR.VAR) == VAR VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR=VAR('VAR')) VAR = VAR.VAR(VAR=VAR('VAR')) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == 'VAR' VAR VAR(VAR): VAR = VAR(VAR=10, VAR=VAR(['VAR', 'VAR'])) VAR VAR.VAR == VAR() VAR = VAR('VAR') VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR),) VAR VAR.VAR == VAR VAR = VAR(VAR, ""/VAR"", ""VAR VAR VAR"") VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, VAR, VAR)) VAR VAR.VAR == VAR VAR = VAR(VAR=500) VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, 500, VAR)) VAR VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR(VAR): VAR = VAR() VAR VAR(VAR.VAR) == ['VAR'] VAR VAR(VAR): VAR = VAR(VAR=['VAR-VAR-VAR']) VAR VAR(VAR.VAR) == ['VAR-VAR-VAR'] ",16,1
urllib3_9b76785331243689a9d52cef3db05ef7462cb02d,test/with_dummyserver/test_no_ssl.py,"""""""
Test connections without the builtin ssl module

Note: Import urllib3 inside the test functions to get the importblocker to work
""""""
from ..test_no_ssl import TestWithoutSSL

from dummyserver.testcase import (
        HTTPDummyServerTestCase, HTTPSDummyServerTestCase)

import urllib3


class TestHTTPWithoutSSL(HTTPDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        pool = urllib3.HTTPConnectionPool(self.host, self.port)
        self.addCleanup(pool.close)
        r = pool.request('GET', '/')
        self.assertEqual(r.status, 200, r.data)


class TestHTTPSWithoutSSL(HTTPSDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        pool = urllib3.HTTPSConnectionPool(self.host, self.port)
        self.addCleanup(pool.close)
        try:
            pool.request('GET', '/')
        except urllib3.exceptions.SSLError as e:
            self.assertIn('SSL module is not available', str(e))",,9b76785331243689a9d52cef3db05ef7462cb02d,CVE-2019-11236,9b76785331243689a9d52cef3db05ef7462cb02d,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,70,COMPLETED,""""""" VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR ..VAR VAR VAR VAR VAR.VAR VAR ( VAR, VAR) VAR VAR VAR VAR(VAR, VAR): VAR VAR(VAR): VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR VAR(VAR, VAR): VAR VAR(VAR): VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', '/') VAR VAR.VAR.VAR VAR VAR: VAR.VAR('VAR VAR VAR VAR VAR', VAR(VAR)) ",8,1
urllib3_9b76785331243689a9d52cef3db05ef7462cb02d,test/with_dummyserver/test_poolmanager.py,"import unittest
import json

import pytest

from dummyserver.server import HAS_IPV6
from dummyserver.testcase import (HTTPDummyServerTestCase,
                                  IPv6HTTPDummyServerTestCase)
from urllib3.poolmanager import PoolManager
from urllib3.connectionpool import port_by_scheme
from urllib3.exceptions import MaxRetryError
from urllib3.util.retry import Retry


class TestPoolManager(HTTPDummyServerTestCase):

    def setUp(self):
        self.base_url = 'http://%s:%d' % (self.host, self.port)
        self.base_url_alt = 'http://%s:%d' % (self.host_alt, self.port)

    def test_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/' % self.base_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/' % self.base_url})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_redirect_twice(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect' % self.base_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                       self.base_url)})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_redirect_to_relative_url(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '/redirect'},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '/redirect'})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_cross_host_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        cross_host_location = '%s/echo?a=b' % self.base_url_alt
        try:
            http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': cross_host_location},
                         timeout=1, retries=0)
            self.fail(""Request succeeded instead of raising an exception like it should."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/echo?a=b' % self.base_url_alt},
                         timeout=1, retries=1)

        self.assertEqual(r._pool.host, self.host_alt)

    def test_too_many_redirects(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        try:
            r = http.request('GET', '%s/redirect' % self.base_url,
                             fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                           self.base_url)},
                             retries=1)
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        try:
            r = http.request('GET', '%s/redirect' % self.base_url,
                             fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                           self.base_url)},
                             retries=Retry(total=None, redirect=1))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

    def test_redirect_cross_host_remove_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'Authorization': 'foo'})

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('Authorization', data)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'authorization': 'foo'})

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('authorization', data)
        self.assertNotIn('Authorization', data)

    def test_redirect_cross_host_no_remove_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'Authorization': 'foo'},
                         retries=Retry(remove_headers_on_redirect=[]))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertEqual(data['Authorization'], 'foo')

    def test_redirect_cross_host_set_removed_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'X-API-Secret': 'foo',
                                  'Authorization': 'bar'},
                         retries=Retry(remove_headers_on_redirect=['X-API-Secret']))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('X-API-Secret', data)
        self.assertEqual(data['Authorization'], 'bar')

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'x-api-secret': 'foo',
                                  'authorization': 'bar'},
                         retries=Retry(remove_headers_on_redirect=['X-API-Secret']))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('x-api-secret', data)
        self.assertNotIn('X-API-Secret', data)

        self.assertEqual(data['Authorization'], 'bar')

    def test_raise_on_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                       self.base_url)},
                         retries=Retry(total=None, redirect=1, raise_on_redirect=False))

        self.assertEqual(r.status, 303)

    def test_raise_on_status(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        try:
            # the default is to raise
            r = http.request('GET', '%s/status' % self.base_url,
                             fields={'status': '500 Internal Server Error'},
                             retries=Retry(total=1, status_forcelist=range(500, 600)))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        try:
            # raise explicitly
            r = http.request('GET', '%s/status' % self.base_url,
                             fields={'status': '500 Internal Server Error'},
                             retries=Retry(total=1,
                                           status_forcelist=range(500, 600),
                                           raise_on_status=True))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        # don't raise
        r = http.request('GET', '%s/status' % self.base_url,
                         fields={'status': '500 Internal Server Error'},
                         retries=Retry(total=1,
                                       status_forcelist=range(500, 600),
                                       raise_on_status=False))

        self.assertEqual(r.status, 500)

    def test_missing_port(self):
        # Can a URL that lacks an explicit port like ':80' succeed, or
        # will all such URLs fail with an error?

        http = PoolManager()
        self.addCleanup(http.clear)

        # By globally adjusting `port_by_scheme` we pretend for a moment
        # that HTTP's default port is not 80, but is the port at which
        # our test server happens to be listening.
        port_by_scheme['http'] = self.port
        try:
            r = http.request('GET', 'http://%s/' % self.host, retries=0)
        finally:
            port_by_scheme['http'] = 80

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_headers(self):
        http = PoolManager(headers={'Foo': 'bar'})
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request('POST', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_url('GET', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_body('POST', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_url('GET', '%s/headers' % self.base_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')

        r = http.request_encode_body('GET', '%s/headers' % self.base_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')

    def test_http_with_ssl_keywords(self):
        http = PoolManager(ca_certs='REQUIRED')
        self.addCleanup(http.clear)

        r = http.request('GET', 'http://%s:%s/' % (self.host, self.port))
        self.assertEqual(r.status, 200)

    def test_http_with_ca_cert_dir(self):
        http = PoolManager(ca_certs='REQUIRED', ca_cert_dir='/nosuchdir')
        self.addCleanup(http.clear)

        r = http.request('GET', 'http://%s:%s/' % (self.host, self.port))
        self.assertEqual(r.status, 200)


@pytest.mark.skipif(
    not HAS_IPV6,
    reason='IPv6 is not supported on this system'
)
class TestIPv6PoolManager(IPv6HTTPDummyServerTestCase):

    def setUp(self):
        self.base_url = 'http://[%s]:%d' % (self.host, self.port)

    def test_ipv6(self):
        http = PoolManager()
        self.addCleanup(http.clear)
        http.request('GET', self.base_url)


if __name__ == '__main__':
    unittest.main()",,9b76785331243689a9d52cef3db05ef7462cb02d,CVE-2019-11236,9b76785331243689a9d52cef3db05ef7462cb02d,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,70,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR (VAR, VAR) VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '/VAR'}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '/VAR'}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR: VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=1) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR: VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=VAR(VAR=VAR, VAR=1)) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR', VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR', VAR) VAR.VAR('VAR', VAR) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}, VAR=VAR(VAR=[])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR(VAR['VAR'], 'VAR') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR-VAR-VAR': 'VAR', 'VAR': 'VAR'}, VAR=VAR(VAR=['VAR-VAR-VAR'])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR(VAR['VAR'], 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR-VAR-VAR': 'VAR', 'VAR': 'VAR'}, VAR=VAR(VAR=['VAR-VAR-VAR'])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR(VAR['VAR'], 'VAR') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=VAR(VAR=VAR, VAR=1, VAR=VAR)) VAR.VAR(VAR.VAR, 303) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR:  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600))) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR:  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600), VAR=VAR)) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600), VAR=VAR)) VAR.VAR(VAR.VAR, 500) VAR VAR(VAR):   VAR = VAR() VAR.VAR(VAR.VAR)    VAR['VAR'] = VAR.VAR VAR: VAR = VAR.VAR('VAR', 'VAR: VAR: VAR['VAR'] = 80 VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR(VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR VAR(VAR): VAR = VAR(VAR='VAR') VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', 'VAR: VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR = VAR(VAR='VAR', VAR='/VAR') VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', 'VAR: VAR.VAR(VAR.VAR, 200) @VAR.VAR.VAR( VAR VAR, VAR='VAR VAR VAR VAR VAR VAR VAR' ) VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR.VAR('VAR', VAR.VAR) VAR VAR == 'VAR': VAR.VAR() ",8,1
urllib3_9b76785331243689a9d52cef3db05ef7462cb02d,test/with_dummyserver/test_proxy_poolmanager.py,"import json
import socket
import unittest

import pytest

from dummyserver.testcase import HTTPDummyProxyTestCase, IPv6HTTPDummyProxyTestCase
from dummyserver.server import (
    DEFAULT_CA, DEFAULT_CA_BAD, get_unreachable_address)
from .. import TARPIT_HOST, requires_network

from urllib3._collections import HTTPHeaderDict
from urllib3.poolmanager import proxy_from_url, ProxyManager
from urllib3.exceptions import (
    MaxRetryError, SSLError, ProxyError, ConnectTimeoutError)
from urllib3.connectionpool import connection_from_url, VerifiedHTTPSConnection


class TestHTTPProxyManager(HTTPDummyProxyTestCase):

    def setUp(self):
        self.http_url = 'http://%s:%d' % (self.http_host, self.http_port)
        self.http_url_alt = 'http://%s:%d' % (self.http_host_alt,
                                              self.http_port)
        self.https_url = 'https://%s:%d' % (self.https_host, self.https_port)
        self.https_url_alt = 'https://%s:%d' % (self.https_host_alt,
                                                self.https_port)
        self.proxy_url = 'http://%s:%d' % (self.proxy_host, self.proxy_port)

    def test_basic_proxy(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)

    def test_nagle_proxy(self):
        """""" Test that proxy connections do not have TCP_NODELAY turned on """"""
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)
        hc2 = http.connection_from_host(self.http_host, self.http_port)
        conn = hc2._get_conn()
        self.addCleanup(conn.close)
        hc2._make_request(conn, 'GET', '/')
        tcp_nodelay_setting = conn.sock.getsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY)
        self.assertEqual(tcp_nodelay_setting, 0,
                         (""Expected TCP_NODELAY for proxies to be set ""
                          ""to zero, instead was %s"" % tcp_nodelay_setting))

    def test_proxy_conn_fail(self):
        host, port = get_unreachable_address()
        http = proxy_from_url('http://%s:%s/' % (host, port), retries=1, timeout=0.05)
        self.addCleanup(http.clear)
        self.assertRaises(MaxRetryError, http.request, 'GET',
                          '%s/' % self.https_url)
        self.assertRaises(MaxRetryError, http.request, 'GET',
                          '%s/' % self.http_url)

        try:
            http.request('GET', '%s/' % self.http_url)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ProxyError)

    def test_oldapi(self):
        http = ProxyManager(connection_from_url(self.proxy_url))
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)

    def test_proxy_verified(self):
        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA_BAD)
        self.addCleanup(http.clear)
        https_pool = http._new_pool('https', self.https_host,
                                    self.https_port)
        try:
            https_pool.request('GET', '/', retries=0)
            self.fail(""Didn't raise SSL error with wrong CA"")
        except MaxRetryError as e:
            self.assertIsInstance(e.reason, SSLError)
            self.assertIn('certificate verify failed', str(e.reason),
                          ""Expected 'certificate verify failed',""
                          ""instead got: %r"" % e.reason)

        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA)
        https_pool = http._new_pool('https', self.https_host,
                                    self.https_port)

        conn = https_pool._new_conn()
        self.assertEqual(conn.__class__, VerifiedHTTPSConnection)
        https_pool.request('GET', '/')  # Should succeed without exceptions.

        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA)
        https_fail_pool = http._new_pool('https', '127.0.0.1', self.https_port)

        try:
            https_fail_pool.request('GET', '/', retries=0)
            self.fail(""Didn't raise SSL invalid common name"")
        except MaxRetryError as e:
            self.assertIsInstance(e.reason, SSLError)
            self.assertIn(""doesn't match"", str(e.reason))

    def test_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/' % self.http_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/' % self.http_url})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_cross_host_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        cross_host_location = '%s/echo?a=b' % self.http_url_alt
        try:
            http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': cross_host_location},
                         timeout=1, retries=0)
            self.fail(""We don't want to follow redirects here."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/echo?a=b' % self.http_url_alt},
                         timeout=1, retries=1)
        self.assertNotEqual(r._pool.host, self.http_host_alt)

    def test_cross_protocol_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        cross_protocol_location = '%s/echo?a=b' % self.https_url
        try:
            http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': cross_protocol_location},
                         timeout=1, retries=0)
            self.fail(""We don't want to follow redirects here."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/echo?a=b' % self.https_url},
                         timeout=1, retries=1)
        self.assertEqual(r._pool.host, self.https_host)

    def test_headers(self):
        http = proxy_from_url(self.proxy_url, headers={'Foo': 'bar'},
                              proxy_headers={'Hickory': 'dickory'})
        self.addCleanup(http.clear)

        r = http.request_encode_url('GET', '%s/headers' % self.http_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.http_url_alt)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host_alt, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url_alt)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host_alt, self.https_port))

        r = http.request_encode_body('POST', '%s/headers' % self.http_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.http_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

        r = http.request_encode_body('GET', '%s/headers' % self.http_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_body('GET', '%s/headers' % self.https_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

    def test_headerdict(self):
        default_headers = HTTPHeaderDict(a='b')
        proxy_headers = HTTPHeaderDict()
        proxy_headers.add('foo', 'bar')

        http = proxy_from_url(
            self.proxy_url,
            headers=default_headers,
            proxy_headers=proxy_headers)
        self.addCleanup(http.clear)

        request_headers = HTTPHeaderDict(baz='quux')
        r = http.request('GET', '%s/headers' % self.http_url, headers=request_headers)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Baz'), 'quux')

    def test_proxy_pooling(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        for x in range(2):
            http.urlopen('GET', self.http_url)
        self.assertEqual(len(http.pools), 1)

        for x in range(2):
            http.urlopen('GET', self.http_url_alt)
        self.assertEqual(len(http.pools), 1)

        for x in range(2):
            http.urlopen('GET', self.https_url)
        self.assertEqual(len(http.pools), 2)

        for x in range(2):
            http.urlopen('GET', self.https_url_alt)
        self.assertEqual(len(http.pools), 3)

    def test_proxy_pooling_ext(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        hc1 = http.connection_from_url(self.http_url)
        hc2 = http.connection_from_host(self.http_host, self.http_port)
        hc3 = http.connection_from_url(self.http_url_alt)
        hc4 = http.connection_from_host(self.http_host_alt, self.http_port)
        self.assertEqual(hc1, hc2)
        self.assertEqual(hc2, hc3)
        self.assertEqual(hc3, hc4)

        sc1 = http.connection_from_url(self.https_url)
        sc2 = http.connection_from_host(self.https_host,
                                        self.https_port, scheme='https')
        sc3 = http.connection_from_url(self.https_url_alt)
        sc4 = http.connection_from_host(self.https_host_alt,
                                        self.https_port, scheme='https')
        self.assertEqual(sc1, sc2)
        self.assertNotEqual(sc2, sc3)
        self.assertEqual(sc3, sc4)

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_timeout(self):
        https = proxy_from_url('https://{host}'.format(host=TARPIT_HOST))
        self.addCleanup(https.clear)
        try:
            https.request('GET', self.http_url, timeout=0.001)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ConnectTimeoutError)

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_pool_timeout(self):
        https = proxy_from_url('https://{host}'.format(host=TARPIT_HOST),
                               timeout=0.001)
        self.addCleanup(https.clear)
        try:
            https.request('GET', self.http_url)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ConnectTimeoutError)

    def test_scheme_host_case_insensitive(self):
        """"""Assert that upper-case schemes and hosts are normalized.""""""
        http = proxy_from_url(self.proxy_url.upper())
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url.upper())
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url.upper())
        self.assertEqual(r.status, 200)


class TestIPv6HTTPProxyManager(IPv6HTTPDummyProxyTestCase):

    def setUp(self):
        self.http_url = 'http://%s:%d' % (self.http_host, self.http_port)
        self.http_url_alt = 'http://%s:%d' % (self.http_host_alt,
                                              self.http_port)
        self.https_url = 'https://%s:%d' % (self.https_host, self.https_port)
        self.https_url_alt = 'https://%s:%d' % (self.https_host_alt,
                                                self.https_port)
        self.proxy_url = 'http://[%s]:%d' % (self.proxy_host, self.proxy_port)

    def test_basic_ipv6_proxy(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)


if __name__ == '__main__':
    unittest.main()",,9b76785331243689a9d52cef3db05ef7462cb02d,CVE-2019-11236,9b76785331243689a9d52cef3db05ef7462cb02d,https://github.com/urllib3/urllib3,NVD_GIT_REPOBASED,70,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR) VAR .. VAR VAR, VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR) VAR VAR.VAR VAR VAR, VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR) VAR.VAR(VAR, 'VAR', '/') VAR = VAR.VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR, 0, (""VAR VAR VAR VAR VAR VAR VAR "" ""VAR VAR, VAR VAR %VAR"" % VAR)) VAR VAR(VAR): VAR, VAR = VAR() VAR = VAR('VAR: VAR.VAR(VAR.VAR) VAR.VAR(VAR, VAR.VAR, 'VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR, VAR.VAR, 'VAR', '%VAR/' % VAR.VAR) VAR: VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) VAR VAR(VAR): VAR = VAR(VAR(VAR.VAR)) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', VAR.VAR, VAR.VAR) VAR: VAR.VAR('VAR', '/', VAR=0) VAR.VAR(""VAR'VAR VAR VAR VAR VAR VAR VAR"") VAR VAR VAR VAR: VAR.VAR(VAR.VAR, VAR) VAR.VAR('VAR VAR VAR', VAR(VAR.VAR), ""VAR 'VAR VAR VAR',"" ""VAR VAR: %VAR"" % VAR.VAR) VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR = VAR.VAR('VAR', VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR, VAR) VAR.VAR('VAR', '/')  VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR = VAR.VAR('VAR', '127.0.0.1', VAR.VAR) VAR: VAR.VAR('VAR', '/', VAR=0) VAR.VAR(""VAR'VAR VAR VAR VAR VAR VAR"") VAR VAR VAR VAR: VAR.VAR(VAR.VAR, VAR) VAR.VAR(""VAR'VAR VAR"", VAR(VAR.VAR)) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR'VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR'VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR={'VAR': 'VAR'}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR VAR(VAR): VAR = VAR(VAR='VAR') VAR = VAR() VAR.VAR('VAR', 'VAR') VAR = VAR( VAR.VAR, VAR=VAR, VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR(VAR='VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR=VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 1) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 1) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 2) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 3) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR='VAR') VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR='VAR') VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR = VAR('VAR: VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', VAR.VAR, VAR=0.001) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR = VAR('VAR: VAR=0.001) VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', VAR.VAR) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) VAR VAR(VAR): """"""VAR VAR VAR-VAR VAR VAR VAR VAR VAR."""""" VAR = VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR.VAR()) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR.VAR()) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR == 'VAR': VAR.VAR() ",8,1
urllib3_a74c9cfbaed9f811e7563cfc3dce894928e0221a,dummyserver/proxy.py,"#!/usr/bin/env python
#
# Simple asynchronous HTTP proxy with tunnelling (CONNECT).
#
# GET/POST proxying based on
# http://groups.google.com/group/python-tornado/msg/7bea08e7a049cf26
#
# Copyright (C) 2012 Senko Rasic <senko.rasic@dobarkod.hr>
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the ""Software""), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED ""AS IS"", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.

import sys
import socket

import tornado.httpserver
import tornado.ioloop
import tornado.iostream
import tornado.web
import tornado.httpclient

__all__ = ['ProxyHandler', 'run_proxy']


class ProxyHandler(tornado.web.RequestHandler):
    SUPPORTED_METHODS = ['GET', 'POST', 'CONNECT']

    @tornado.web.asynchronous
    def get(self):

        def handle_response(response):
            if response.error and not isinstance(response.error,
                                                 tornado.httpclient.HTTPError):
                self.set_status(500)
                self.write('Internal server error:\n' + str(response.error))
                self.finish()
            else:
                self.set_status(response.code)
                for header in ('Date', 'Cache-Control', 'Server',
                               'Content-Type', 'Location'):
                    v = response.headers.get(header)
                    if v:
                        self.set_header(header, v)
                if response.body:
                    self.write(response.body)
                self.finish()

        req = tornado.httpclient.HTTPRequest(
            url=self.request.uri,
            method=self.request.method, body=self.request.body,
            headers=self.request.headers, follow_redirects=False,
            allow_nonstandard_methods=True)

        client = tornado.httpclient.AsyncHTTPClient()
        try:
            client.fetch(req, handle_response)
        except tornado.httpclient.HTTPError as e:
            if hasattr(e, 'response') and e.response:
                self.handle_response(e.response)
            else:
                self.set_status(500)
                self.write('Internal server error:\n' + str(e))
                self.finish()

    @tornado.web.asynchronous
    def post(self):
        return self.get()

    @tornado.web.asynchronous
    def connect(self):
        host, port = self.request.uri.split(':')
        client = self.request.connection.stream

        def read_from_client(data):
            upstream.write(data)

        def read_from_upstream(data):
            client.write(data)

        def client_close(data=None):
            if upstream.closed():
                return
            if data:
                upstream.write(data)
            upstream.close()

        def upstream_close(data=None):
            if client.closed():
                return
            if data:
                client.write(data)
            client.close()

        def start_tunnel():
            client.read_until_close(client_close, read_from_client)
            upstream.read_until_close(upstream_close, read_from_upstream)
            client.write(b'HTTP/1.0 200 Connection established\r\n\r\n')

        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM, 0)
        upstream = tornado.iostream.IOStream(s)
        upstream.connect((host, int(port)), start_tunnel)


def run_proxy(port, start_ioloop=True):
    """"""
    Run proxy on the specified port. If start_ioloop is True (default),
    the tornado IOLoop will be started immediately.
    """"""
    app = tornado.web.Application([
        (r'.*', ProxyHandler),
    ])
    app.listen(port)
    ioloop = tornado.ioloop.IOLoop.instance()
    if start_ioloop:
        ioloop.start()


if __name__ == '__main__':
    port = 8888
    if len(sys.argv) > 1:
        port = int(sys.argv[1])

    print(""Starting HTTP proxy on port %d"" % port)
    run_proxy(port)",,a74c9cfbaed9f811e7563cfc3dce894928e0221a,CVE-2020-7212,a74c9cfbaed9f811e7563cfc3dce894928e0221a,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"                          VAR VAR VAR VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR VAR.VAR VAR = ['VAR', 'VAR'] VAR VAR(VAR.VAR.VAR): VAR = ['VAR', 'VAR', 'VAR'] @VAR.VAR.VAR VAR VAR(VAR): VAR VAR(VAR): VAR VAR.VAR VAR VAR VAR(VAR.VAR, VAR.VAR.VAR): VAR.VAR(500) VAR.VAR('VAR VAR VAR:\VAR' + VAR(VAR.VAR)) VAR.VAR() VAR: VAR.VAR(VAR.VAR) VAR VAR VAR ('VAR', 'VAR-VAR', 'VAR', 'VAR-VAR', 'VAR'): VAR = VAR.VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR.VAR() VAR = VAR.VAR.VAR( VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR.VAR.VAR, VAR=VAR, VAR=VAR) VAR = VAR.VAR.VAR() VAR: VAR.VAR(VAR, VAR) VAR VAR.VAR.VAR VAR VAR: VAR VAR(VAR, 'VAR') VAR VAR.VAR: VAR.VAR(VAR.VAR) VAR: VAR.VAR(500) VAR.VAR('VAR VAR VAR:\VAR' + VAR(VAR)) VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR VAR.VAR() @VAR.VAR.VAR VAR VAR(VAR): VAR, VAR = VAR.VAR.VAR.VAR(':') VAR = VAR.VAR.VAR.VAR VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR): VAR.VAR(VAR) VAR VAR(VAR=VAR): VAR VAR.VAR(): VAR VAR VAR: VAR.VAR(VAR) VAR.VAR() VAR VAR(VAR=VAR): VAR VAR.VAR(): VAR VAR VAR: VAR.VAR(VAR) VAR.VAR() VAR VAR(): VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR'VAR/1.0 200 VAR VAR\VAR\VAR\VAR\VAR') VAR = VAR.VAR(VAR.VAR, VAR.VAR, 0) VAR = VAR.VAR.VAR(VAR) VAR.VAR((VAR, VAR(VAR)), VAR) VAR VAR(VAR, VAR=VAR): """""" VAR VAR VAR VAR VAR VAR. VAR VAR VAR VAR (VAR), VAR VAR VAR VAR VAR VAR VAR. """""" VAR = VAR.VAR.VAR([ (VAR'.*', VAR), ]) VAR.VAR(VAR) VAR = VAR.VAR.VAR.VAR() VAR VAR: VAR.VAR() VAR VAR == 'VAR': VAR = 8888 VAR VAR(VAR.VAR) > 1: VAR = VAR(VAR.VAR[1]) VAR(""VAR VAR VAR VAR VAR %VAR"" % VAR) VAR(VAR) ",16,1
urllib3_a74c9cfbaed9f811e7563cfc3dce894928e0221a,test/appengine/test_urlfetch.py,"""""""These tests ensure that when running in App Engine standard with the
App Engine sandbox enabled that urllib3 appropriately uses the App
Engine-patched version of httplib to make requests.""""""

import httplib
import StringIO
import unittest

from mock import patch
import pytest

from ..test_no_ssl import TestWithoutSSL


class MockResponse(object):
    def __init__(self, content, status_code, content_was_truncated, final_url,
                 headers):

        self.content = content
        self.status_code = status_code
        self.content_was_truncated = content_was_truncated
        self.final_url = final_url
        self.header_msg = httplib.HTTPMessage(StringIO.StringIO(''.join(
            [""%s: %s\n"" % (k, v) for k, v in headers.iteritems()] + [""\n""])))
        self.headers = headers


@pytest.mark.usefixtures('sandbox')
class TestHTTP(TestWithoutSSL):
    def test_urlfetch_called_with_http(self):
        """"""Check that URLFetch is used to fetch non-https resources.""""""
        resp = MockResponse(
            'OK',
            200,
            False,
            'http://www.google.com',
            {'content-type': 'text/plain'})
        fetch_patch = patch(
            'google.appengine.api.urlfetch.fetch', return_value=resp
        )
        with fetch_patch as fetch_mock:
            import urllib3
            pool = urllib3.HTTPConnectionPool('www.google.com', '80')
            r = pool.request('GET', '/')
            self.assertEqual(r.status, 200, r.data)
            self.assertEqual(fetch_mock.call_count, 1)


@pytest.mark.usefixtures('sandbox')
class TestHTTPS(unittest.TestCase):
    @pytest.mark.xfail(
        reason='This is not yet supported by urlfetch, presence of the ssl '
               'module will bypass urlfetch.')
    def test_urlfetch_called_with_https(self):
        """"""
        Check that URLFetch is used when fetching https resources
        """"""
        resp = MockResponse(
            'OK',
            200,
            False,
            'https://www.google.com',
            {'content-type': 'text/plain'})
        fetch_patch = patch(
            'google.appengine.api.urlfetch.fetch', return_value=resp
        )
        with fetch_patch as fetch_mock:
            import urllib3
            pool = urllib3.HTTPSConnectionPool('www.google.com', '443')
            pool.ConnectionCls = urllib3.connection.UnverifiedHTTPSConnection
            r = pool.request('GET', '/')
            self.assertEqual(r.status, 200, r.data)
            self.assertEqual(fetch_mock.call_count, 1)",,a74c9cfbaed9f811e7563cfc3dce894928e0221a,CVE-2020-7212,a74c9cfbaed9f811e7563cfc3dce894928e0221a,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"""""""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR VAR VAR VAR VAR VAR."""""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR ..VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR, VAR, VAR, VAR, VAR, VAR): VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR VAR.VAR = VAR.VAR(VAR.VAR(''.VAR( [""%VAR: %VAR\VAR"" % (VAR, VAR) VAR VAR, VAR VAR VAR.VAR()] + [""\VAR""]))) VAR.VAR = VAR @VAR.VAR.VAR('VAR') VAR VAR(VAR): VAR VAR(VAR): """"""VAR VAR VAR VAR VAR VAR VAR VAR-VAR VAR."""""" VAR = VAR( 'VAR', 200, VAR, 'VAR: {'VAR-VAR': 'VAR/VAR'}) VAR = VAR( 'VAR.VAR.VAR.VAR.VAR', VAR=VAR ) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR('VAR.VAR.VAR', '80') VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR.VAR(VAR.VAR, 1) @VAR.VAR.VAR('VAR') VAR VAR(VAR.VAR): @VAR.VAR.VAR( VAR='VAR VAR VAR VAR VAR VAR VAR, VAR VAR VAR VAR ' 'VAR VAR VAR VAR.') VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR( 'VAR', 200, VAR, 'VAR: {'VAR-VAR': 'VAR/VAR'}) VAR = VAR( 'VAR.VAR.VAR.VAR.VAR', VAR=VAR ) VAR VAR VAR VAR: VAR VAR VAR = VAR.VAR('VAR.VAR.VAR', '443') VAR.VAR = VAR.VAR.VAR VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR.VAR(VAR.VAR, 1) ",8,1
urllib3_a74c9cfbaed9f811e7563cfc3dce894928e0221a,test/test_retry.py,"import pytest

from urllib3.response import HTTPResponse
from urllib3.packages.six.moves import xrange
from urllib3.util.retry import Retry, RequestHistory
from urllib3.exceptions import (
    ConnectTimeoutError,
    MaxRetryError,
    ReadTimeoutError,
    ResponseError,
)


class TestRetry(object):

    def test_string(self):
        """""" Retry string representation looks the way we expect """"""
        retry = Retry()
        assert str(retry) == 'Retry(total=10, connect=None, read=None, redirect=None, status=None)'
        for _ in range(3):
            retry = retry.increment(method='GET')
        assert str(retry) == 'Retry(total=7, connect=None, read=None, redirect=None, status=None)'

    def test_retry_both_specified(self):
        """"""Total can win if it's lower than the connect value""""""
        error = ConnectTimeoutError()
        retry = Retry(connect=3, total=2)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

    def test_retry_higher_total_loses(self):
        """""" A lower connect timeout than the total is honored """"""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=3)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

    def test_retry_higher_total_loses_vs_read(self):
        """""" A lower read timeout than the total is honored """"""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=2, total=3)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(method='GET', error=error)

    def test_retry_total_none(self):
        """""" if Total is none, connect error should take precedence """"""
        error = ConnectTimeoutError()
        retry = Retry(connect=2, total=None)
        retry = retry.increment(error=error)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(error=error)
        assert e.value.reason == error

        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(connect=2, total=None)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        retry = retry.increment(method='GET', error=error)
        assert not retry.is_exhausted()

    def test_retry_default(self):
        """""" If no value is specified, should retry connects 3 times """"""
        retry = Retry()
        assert retry.total == 10
        assert retry.connect is None
        assert retry.read is None
        assert retry.redirect is None

        error = ConnectTimeoutError()
        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        with pytest.raises(MaxRetryError):
            retry.increment(error=error)

        retry = Retry(connect=1)
        retry = retry.increment(error=error)
        assert not retry.is_exhausted()

        assert Retry(0).raise_on_redirect
        assert not Retry(False).raise_on_redirect

    def test_retry_read_zero(self):
        """""" No second chances on read timeouts, by default """"""
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry(read=0)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(method='GET', error=error)
        assert e.value.reason == error

    def test_status_counter(self):
        resp = HTTPResponse(status=400)
        retry = Retry(status=2)
        retry = retry.increment(response=resp)
        retry = retry.increment(response=resp)
        with pytest.raises(MaxRetryError) as e:
            retry.increment(response=resp)
        assert str(e.value.reason) == ResponseError.SPECIFIC_ERROR.format(status_code=400)

    def test_backoff(self):
        """""" Backoff is computed correctly """"""
        max_backoff = Retry.BACKOFF_MAX

        retry = Retry(total=100, backoff_factor=0.2)
        assert retry.get_backoff_time() == 0  # First request

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0  # First retry

        retry = retry.increment(method='GET')
        assert retry.backoff_factor == 0.2
        assert retry.total == 98
        assert retry.get_backoff_time() == 0.4  # Start backoff

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.8

        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 1.6

        for _ in xrange(10):
            retry = retry.increment(method='GET')

        assert retry.get_backoff_time() == max_backoff

    def test_zero_backoff(self):
        retry = Retry()
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0

    def test_backoff_reset_after_redirect(self):
        retry = Retry(total=100, redirect=5, backoff_factor=0.2)
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.4
        redirect_response = HTTPResponse(status=302, headers={'location': 'test'})
        retry = retry.increment(method='GET', response=redirect_response)
        assert retry.get_backoff_time() == 0
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        assert retry.get_backoff_time() == 0.4

    def test_sleep(self):
        # sleep a very small amount of time so our code coverage is happy
        retry = Retry(backoff_factor=0.0001)
        retry = retry.increment(method='GET')
        retry = retry.increment(method='GET')
        retry.sleep()

    def test_status_forcelist(self):
        retry = Retry(status_forcelist=xrange(500, 600))
        assert not retry.is_retry('GET', status_code=200)
        assert not retry.is_retry('GET', status_code=400)
        assert retry.is_retry('GET', status_code=500)

        retry = Retry(total=1, status_forcelist=[418])
        assert not retry.is_retry('GET', status_code=400)
        assert retry.is_retry('GET', status_code=418)

        # String status codes are not matched.
        retry = Retry(total=1, status_forcelist=['418'])
        assert not retry.is_retry('GET', status_code=418)

    def test_method_whitelist_with_status_forcelist(self):
        # Falsey method_whitelist means to retry on any method.
        retry = Retry(status_forcelist=[500], method_whitelist=None)
        assert retry.is_retry('GET', status_code=500)
        assert retry.is_retry('POST', status_code=500)

        # Criteria of method_whitelist and status_forcelist are ANDed.
        retry = Retry(status_forcelist=[500], method_whitelist=['POST'])
        assert not retry.is_retry('GET', status_code=500)
        assert retry.is_retry('POST', status_code=500)

    def test_exhausted(self):
        assert not Retry(0).is_exhausted()
        assert Retry(-1).is_exhausted()
        assert Retry(1).increment(method='GET').total == 0

    @pytest.mark.parametrize('total', [-1, 0])
    def test_disabled(self, total):
        with pytest.raises(MaxRetryError):
            Retry(total).increment(method='GET')

    def test_error_message(self):
        retry = Retry(total=0)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(method='GET',
                                    error=ReadTimeoutError(None, ""/"", ""read timed out""))
        assert 'Caused by redirect' not in str(e.value)
        assert str(e.value.reason) == 'None: read timed out'

        retry = Retry(total=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment('POST', '/')
            retry = retry.increment('POST', '/')
        assert 'Caused by redirect' not in str(e.value)
        assert isinstance(e.value.reason, ResponseError)
        assert str(e.value.reason) == ResponseError.GENERIC_ERROR

        retry = Retry(total=1)
        response = HTTPResponse(status=500)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment('POST', '/', response=response)
            retry = retry.increment('POST', '/', response=response)
        assert 'Caused by redirect' not in str(e.value)
        msg = ResponseError.SPECIFIC_ERROR.format(status_code=500)
        assert str(e.value.reason) == msg

        retry = Retry(connect=1)
        with pytest.raises(MaxRetryError) as e:
            retry = retry.increment(error=ConnectTimeoutError('conntimeout'))
            retry = retry.increment(error=ConnectTimeoutError('conntimeout'))
        assert 'Caused by redirect' not in str(e.value)
        assert str(e.value.reason) == 'conntimeout'

    def test_history(self):
        retry = Retry(total=10, method_whitelist=frozenset(['GET', 'POST']))
        assert retry.history == tuple()
        connection_error = ConnectTimeoutError('conntimeout')
        retry = retry.increment('GET', '/test1', None, connection_error)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),)
        assert retry.history == history

        read_error = ReadTimeoutError(None, ""/test2"", ""read timed out"")
        retry = retry.increment('POST', '/test2', None, read_error)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),
                   RequestHistory('POST', '/test2', read_error, None, None))
        assert retry.history == history

        response = HTTPResponse(status=500)
        retry = retry.increment('GET', '/test3', response, None)
        history = (RequestHistory('GET', '/test1', connection_error, None, None),
                   RequestHistory('POST', '/test2', read_error, None, None),
                   RequestHistory('GET', '/test3', None, 500, None))
        assert retry.history == history

    def test_retry_method_not_in_whitelist(self):
        error = ReadTimeoutError(None, ""/"", ""read timed out"")
        retry = Retry()
        with pytest.raises(ReadTimeoutError):
            retry.increment(method='POST', error=error)

    def test_retry_default_remove_headers_on_redirect(self):
        retry = Retry()

        assert list(retry.remove_headers_on_redirect) == ['authorization']

    def test_retry_set_remove_headers_on_redirect(self):
        retry = Retry(remove_headers_on_redirect=['X-API-Secret'])

        assert list(retry.remove_headers_on_redirect) == ['x-api-secret']",,a74c9cfbaed9f811e7563cfc3dce894928e0221a,CVE-2020-7212,a74c9cfbaed9f811e7563cfc3dce894928e0221a,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR, ) VAR VAR(VAR): VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR() VAR VAR(VAR) == 'VAR(VAR=10, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)' VAR VAR VAR VAR(3): VAR = VAR.VAR(VAR='VAR') VAR VAR(VAR) == 'VAR(VAR=7, VAR=VAR, VAR=VAR, VAR=VAR, VAR=VAR)' VAR VAR(VAR): """"""VAR VAR VAR VAR VAR'VAR VAR VAR VAR VAR VAR"""""" VAR = VAR() VAR = VAR(VAR=3, VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR() VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=3) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR(VAR): """""" VAR VAR VAR VAR, VAR VAR VAR VAR VAR """""" VAR = VAR() VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR.VAR.VAR == VAR VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=2, VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR VAR.VAR() VAR VAR(VAR): """""" VAR VAR VAR VAR VAR, VAR VAR VAR 3 VAR """""" VAR = VAR() VAR VAR.VAR == 10 VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR = VAR() VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR): VAR.VAR(VAR=VAR) VAR = VAR(VAR=1) VAR = VAR.VAR(VAR=VAR) VAR VAR VAR.VAR() VAR VAR(0).VAR VAR VAR VAR(VAR).VAR VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR, VAR VAR """""" VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR=400) VAR = VAR(VAR=2) VAR = VAR.VAR(VAR=VAR) VAR = VAR.VAR(VAR=VAR) VAR VAR.VAR(VAR) VAR VAR: VAR.VAR(VAR=VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR.VAR(VAR=400) VAR VAR(VAR): """""" VAR VAR VAR VAR """""" VAR = VAR.VAR VAR = VAR(VAR=100, VAR=0.2) VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR == 0.2 VAR VAR.VAR == 98 VAR VAR.VAR() == 0.4  VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.8 VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 1.6 VAR VAR VAR VAR(10): VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == VAR VAR VAR(VAR): VAR = VAR() VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0 VAR VAR(VAR): VAR = VAR(VAR=100, VAR=5, VAR=0.2) VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.4 VAR = VAR(VAR=302, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR.VAR() == 0 VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR VAR.VAR() == 0.4 VAR VAR(VAR):  VAR = VAR(VAR=0.0001) VAR = VAR.VAR(VAR='VAR') VAR = VAR.VAR(VAR='VAR') VAR.VAR() VAR VAR(VAR): VAR = VAR(VAR=VAR(500, 600)) VAR VAR VAR.VAR('VAR', VAR=200) VAR VAR VAR.VAR('VAR', VAR=400) VAR VAR.VAR('VAR', VAR=500) VAR = VAR(VAR=1, VAR=[418]) VAR VAR VAR.VAR('VAR', VAR=400) VAR VAR.VAR('VAR', VAR=418)  VAR = VAR(VAR=1, VAR=['418']) VAR VAR VAR.VAR('VAR', VAR=418) VAR VAR(VAR):  VAR = VAR(VAR=[500], VAR=VAR) VAR VAR.VAR('VAR', VAR=500) VAR VAR.VAR('VAR', VAR=500)  VAR = VAR(VAR=[500], VAR=['VAR']) VAR VAR VAR.VAR('VAR', VAR=500) VAR VAR.VAR('VAR', VAR=500) VAR VAR(VAR): VAR VAR VAR(0).VAR() VAR VAR(-1).VAR() VAR VAR(1).VAR(VAR='VAR').VAR == 0 @VAR.VAR.VAR('VAR', [-1, 0]) VAR VAR(VAR, VAR): VAR VAR.VAR(VAR): VAR(VAR).VAR(VAR='VAR') VAR VAR(VAR): VAR = VAR(VAR=0) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR='VAR', VAR=VAR(VAR, ""/"", ""VAR VAR VAR"")) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == 'VAR: VAR VAR VAR' VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR('VAR', '/') VAR = VAR.VAR('VAR', '/') VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR, VAR) VAR VAR(VAR.VAR.VAR) == VAR.VAR VAR = VAR(VAR=1) VAR = VAR(VAR=500) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR('VAR', '/', VAR=VAR) VAR = VAR.VAR('VAR', '/', VAR=VAR) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR = VAR.VAR.VAR(VAR=500) VAR VAR(VAR.VAR.VAR) == VAR VAR = VAR(VAR=1) VAR VAR.VAR(VAR) VAR VAR: VAR = VAR.VAR(VAR=VAR('VAR')) VAR = VAR.VAR(VAR=VAR('VAR')) VAR 'VAR VAR VAR' VAR VAR VAR(VAR.VAR) VAR VAR(VAR.VAR.VAR) == 'VAR' VAR VAR(VAR): VAR = VAR(VAR=10, VAR=VAR(['VAR', 'VAR'])) VAR VAR.VAR == VAR() VAR = VAR('VAR') VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR),) VAR VAR.VAR == VAR VAR = VAR(VAR, ""/VAR"", ""VAR VAR VAR"") VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, VAR, VAR)) VAR VAR.VAR == VAR VAR = VAR(VAR=500) VAR = VAR.VAR('VAR', '/VAR', VAR, VAR) VAR = (VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, VAR, VAR), VAR('VAR', '/VAR', VAR, 500, VAR)) VAR VAR.VAR == VAR VAR VAR(VAR): VAR = VAR(VAR, ""/"", ""VAR VAR VAR"") VAR = VAR() VAR VAR.VAR(VAR): VAR.VAR(VAR='VAR', VAR=VAR) VAR VAR(VAR): VAR = VAR() VAR VAR(VAR.VAR) == ['VAR'] VAR VAR(VAR): VAR = VAR(VAR=['VAR-VAR-VAR']) VAR VAR(VAR.VAR) == ['VAR-VAR-VAR'] ",16,1
urllib3_a74c9cfbaed9f811e7563cfc3dce894928e0221a,test/with_dummyserver/test_no_ssl.py,"""""""
Test connections without the builtin ssl module

Note: Import urllib3 inside the test functions to get the importblocker to work
""""""
from ..test_no_ssl import TestWithoutSSL

from dummyserver.testcase import (
        HTTPDummyServerTestCase, HTTPSDummyServerTestCase)

import urllib3


class TestHTTPWithoutSSL(HTTPDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        pool = urllib3.HTTPConnectionPool(self.host, self.port)
        self.addCleanup(pool.close)
        r = pool.request('GET', '/')
        self.assertEqual(r.status, 200, r.data)


class TestHTTPSWithoutSSL(HTTPSDummyServerTestCase, TestWithoutSSL):
    def test_simple(self):
        pool = urllib3.HTTPSConnectionPool(self.host, self.port, cert_reqs=""NONE"")
        self.addCleanup(pool.close)
        try:
            pool.request('GET', '/')
        except urllib3.exceptions.SSLError as e:
            self.assertIn('SSL module is not available', str(e))",,a74c9cfbaed9f811e7563cfc3dce894928e0221a,CVE-2020-7212,a74c9cfbaed9f811e7563cfc3dce894928e0221a,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,""""""" VAR VAR VAR VAR VAR VAR VAR VAR: VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR ..VAR VAR VAR VAR VAR.VAR VAR ( VAR, VAR) VAR VAR VAR VAR(VAR, VAR): VAR VAR(VAR): VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '/') VAR.VAR(VAR.VAR, 200, VAR.VAR) VAR VAR(VAR, VAR): VAR VAR(VAR): VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR=""VAR"") VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', '/') VAR VAR.VAR.VAR VAR VAR: VAR.VAR('VAR VAR VAR VAR VAR', VAR(VAR)) ",8,1
urllib3_a74c9cfbaed9f811e7563cfc3dce894928e0221a,test/with_dummyserver/test_poolmanager.py,"import unittest
import json

import pytest

from dummyserver.server import HAS_IPV6
from dummyserver.testcase import (HTTPDummyServerTestCase,
                                  IPv6HTTPDummyServerTestCase)
from urllib3.poolmanager import PoolManager
from urllib3.connectionpool import port_by_scheme
from urllib3.exceptions import MaxRetryError
from urllib3.util.retry import Retry


class TestPoolManager(HTTPDummyServerTestCase):

    def setUp(self):
        self.base_url = 'http://%s:%d' % (self.host, self.port)
        self.base_url_alt = 'http://%s:%d' % (self.host_alt, self.port)

    def test_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/' % self.base_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/' % self.base_url})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_redirect_twice(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect' % self.base_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                       self.base_url)})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_redirect_to_relative_url(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '/redirect'},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '/redirect'})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_cross_host_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        cross_host_location = '%s/echo?a=b' % self.base_url_alt
        try:
            http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': cross_host_location},
                         timeout=1, retries=0)
            self.fail(""Request succeeded instead of raising an exception like it should."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/echo?a=b' % self.base_url_alt},
                         timeout=1, retries=1)

        self.assertEqual(r._pool.host, self.host_alt)

    def test_too_many_redirects(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        try:
            r = http.request('GET', '%s/redirect' % self.base_url,
                             fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                           self.base_url)},
                             retries=1)
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        try:
            r = http.request('GET', '%s/redirect' % self.base_url,
                             fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                           self.base_url)},
                             retries=Retry(total=None, redirect=1))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

    def test_redirect_cross_host_remove_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'Authorization': 'foo'})

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('Authorization', data)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'authorization': 'foo'})

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('authorization', data)
        self.assertNotIn('Authorization', data)

    def test_redirect_cross_host_no_remove_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'Authorization': 'foo'},
                         retries=Retry(remove_headers_on_redirect=[]))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertEqual(data['Authorization'], 'foo')

    def test_redirect_cross_host_set_removed_headers(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'X-API-Secret': 'foo',
                                  'Authorization': 'bar'},
                         retries=Retry(remove_headers_on_redirect=['X-API-Secret']))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('X-API-Secret', data)
        self.assertEqual(data['Authorization'], 'bar')

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'x-api-secret': 'foo',
                                  'authorization': 'bar'},
                         retries=Retry(remove_headers_on_redirect=['X-API-Secret']))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('x-api-secret', data)
        self.assertNotIn('X-API-Secret', data)
        self.assertEqual(data['Authorization'], 'bar')

    def test_raise_on_redirect(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/redirect?target=%s/' % (self.base_url,
                                                                       self.base_url)},
                         retries=Retry(total=None, redirect=1, raise_on_redirect=False))

        self.assertEqual(r.status, 303)

    def test_raise_on_status(self):
        http = PoolManager()
        self.addCleanup(http.clear)

        try:
            # the default is to raise
            r = http.request('GET', '%s/status' % self.base_url,
                             fields={'status': '500 Internal Server Error'},
                             retries=Retry(total=1, status_forcelist=range(500, 600)))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        try:
            # raise explicitly
            r = http.request('GET', '%s/status' % self.base_url,
                             fields={'status': '500 Internal Server Error'},
                             retries=Retry(total=1,
                                           status_forcelist=range(500, 600),
                                           raise_on_status=True))
            self.fail(""Failed to raise MaxRetryError exception, returned %r"" % r.status)
        except MaxRetryError:
            pass

        # don't raise
        r = http.request('GET', '%s/status' % self.base_url,
                         fields={'status': '500 Internal Server Error'},
                         retries=Retry(total=1,
                                       status_forcelist=range(500, 600),
                                       raise_on_status=False))

        self.assertEqual(r.status, 500)

    def test_missing_port(self):
        # Can a URL that lacks an explicit port like ':80' succeed, or
        # will all such URLs fail with an error?

        http = PoolManager()
        self.addCleanup(http.clear)

        # By globally adjusting `port_by_scheme` we pretend for a moment
        # that HTTP's default port is not 80, but is the port at which
        # our test server happens to be listening.
        port_by_scheme['http'] = self.port
        try:
            r = http.request('GET', 'http://%s/' % self.host, retries=0)
        finally:
            port_by_scheme['http'] = 80

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_headers(self):
        http = PoolManager(headers={'Foo': 'bar'})
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request('POST', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_url('GET', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_body('POST', '%s/headers' % self.base_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')

        r = http.request_encode_url('GET', '%s/headers' % self.base_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')

        r = http.request_encode_body('GET', '%s/headers' % self.base_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')

    def test_http_with_ssl_keywords(self):
        http = PoolManager(ca_certs='REQUIRED')
        self.addCleanup(http.clear)

        r = http.request('GET', 'http://%s:%s/' % (self.host, self.port))
        self.assertEqual(r.status, 200)

    def test_http_with_ca_cert_dir(self):
        http = PoolManager(ca_certs='REQUIRED', ca_cert_dir='/nosuchdir')
        self.addCleanup(http.clear)

        r = http.request('GET', 'http://%s:%s/' % (self.host, self.port))
        self.assertEqual(r.status, 200)


@pytest.mark.skipif(
    not HAS_IPV6,
    reason='IPv6 is not supported on this system'
)
class TestIPv6PoolManager(IPv6HTTPDummyServerTestCase):

    def setUp(self):
        self.base_url = 'http://[%s]:%d' % (self.host, self.port)

    def test_ipv6(self):
        http = PoolManager()
        self.addCleanup(http.clear)
        http.request('GET', self.base_url)


if __name__ == '__main__':
    unittest.main()",,a74c9cfbaed9f811e7563cfc3dce894928e0221a,CVE-2020-7212,a74c9cfbaed9f811e7563cfc3dce894928e0221a,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR (VAR, VAR) VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR VAR VAR.VAR.VAR VAR VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '/VAR'}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '/VAR'}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR: VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=1) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR: VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=VAR(VAR=VAR, VAR=1)) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR', VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR', VAR) VAR.VAR('VAR', VAR) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}, VAR=VAR(VAR=[])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR(VAR['VAR'], 'VAR') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR-VAR-VAR': 'VAR', 'VAR': 'VAR'}, VAR=VAR(VAR=['VAR-VAR-VAR'])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR(VAR['VAR'], 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR-VAR-VAR': 'VAR', 'VAR': 'VAR'}, VAR=VAR(VAR=['VAR-VAR-VAR'])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR(VAR['VAR'], 'VAR') VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=%VAR/' % (VAR.VAR, VAR.VAR)}, VAR=VAR(VAR=VAR, VAR=1, VAR=VAR)) VAR.VAR(VAR.VAR, 303) VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR:  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600))) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR VAR:  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600), VAR=VAR)) VAR.VAR(""VAR VAR VAR VAR VAR, VAR %VAR"" % VAR.VAR) VAR VAR: VAR  VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '500 VAR VAR VAR'}, VAR=VAR(VAR=1, VAR=VAR(500, 600), VAR=VAR)) VAR.VAR(VAR.VAR, 500) VAR VAR(VAR):   VAR = VAR() VAR.VAR(VAR.VAR)    VAR['VAR'] = VAR.VAR VAR: VAR = VAR.VAR('VAR', 'VAR: VAR: VAR['VAR'] = 80 VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR(VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR VAR(VAR): VAR = VAR(VAR='VAR') VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', 'VAR: VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR = VAR(VAR='VAR', VAR='/VAR') VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', 'VAR: VAR.VAR(VAR.VAR, 200) @VAR.VAR.VAR( VAR VAR, VAR='VAR VAR VAR VAR VAR VAR VAR' ) VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR() VAR.VAR(VAR.VAR) VAR.VAR('VAR', VAR.VAR) VAR VAR == 'VAR': VAR.VAR() ",8,1
urllib3_a74c9cfbaed9f811e7563cfc3dce894928e0221a,test/with_dummyserver/test_proxy_poolmanager.py,"import json
import socket
import unittest

import pytest

from dummyserver.testcase import HTTPDummyProxyTestCase, IPv6HTTPDummyProxyTestCase
from dummyserver.server import (
    DEFAULT_CA, DEFAULT_CA_BAD, get_unreachable_address)
from .. import TARPIT_HOST, requires_network

from urllib3._collections import HTTPHeaderDict
from urllib3.poolmanager import proxy_from_url, ProxyManager
from urllib3.exceptions import (
    MaxRetryError, SSLError, ProxyError, ConnectTimeoutError)
from urllib3.connectionpool import connection_from_url, VerifiedHTTPSConnection


class TestHTTPProxyManager(HTTPDummyProxyTestCase):

    def setUp(self):
        self.http_url = 'http://%s:%d' % (self.http_host, self.http_port)
        self.http_url_alt = 'http://%s:%d' % (self.http_host_alt,
                                              self.http_port)
        self.https_url = 'https://%s:%d' % (self.https_host, self.https_port)
        self.https_url_alt = 'https://%s:%d' % (self.https_host_alt,
                                                self.https_port)
        self.proxy_url = 'http://%s:%d' % (self.proxy_host, self.proxy_port)

    def test_basic_proxy(self):
        http = proxy_from_url(self.proxy_url, ca_certs=DEFAULT_CA)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)

    def test_nagle_proxy(self):
        """""" Test that proxy connections do not have TCP_NODELAY turned on """"""
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)
        hc2 = http.connection_from_host(self.http_host, self.http_port)
        conn = hc2._get_conn()
        self.addCleanup(conn.close)
        hc2._make_request(conn, 'GET', '/')
        tcp_nodelay_setting = conn.sock.getsockopt(socket.IPPROTO_TCP, socket.TCP_NODELAY)
        self.assertEqual(tcp_nodelay_setting, 0,
                         (""Expected TCP_NODELAY for proxies to be set ""
                          ""to zero, instead was %s"" % tcp_nodelay_setting))

    def test_proxy_conn_fail(self):
        host, port = get_unreachable_address()
        http = proxy_from_url('http://%s:%s/' % (host, port), retries=1, timeout=0.05)
        self.addCleanup(http.clear)
        self.assertRaises(MaxRetryError, http.request, 'GET',
                          '%s/' % self.https_url)
        self.assertRaises(MaxRetryError, http.request, 'GET',
                          '%s/' % self.http_url)

        try:
            http.request('GET', '%s/' % self.http_url)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ProxyError)

    def test_oldapi(self):
        http = ProxyManager(connection_from_url(self.proxy_url), ca_certs=DEFAULT_CA)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)

    def test_proxy_verified(self):
        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA_BAD)
        self.addCleanup(http.clear)
        https_pool = http._new_pool('https', self.https_host,
                                    self.https_port)
        try:
            https_pool.request('GET', '/', retries=0)
            self.fail(""Didn't raise SSL error with wrong CA"")
        except MaxRetryError as e:
            self.assertIsInstance(e.reason, SSLError)
            self.assertIn('certificate verify failed', str(e.reason),
                          ""Expected 'certificate verify failed',""
                          ""instead got: %r"" % e.reason)

        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA)
        https_pool = http._new_pool('https', self.https_host,
                                    self.https_port)

        conn = https_pool._new_conn()
        self.assertEqual(conn.__class__, VerifiedHTTPSConnection)
        https_pool.request('GET', '/')  # Should succeed without exceptions.

        http = proxy_from_url(self.proxy_url, cert_reqs='REQUIRED',
                              ca_certs=DEFAULT_CA)
        https_fail_pool = http._new_pool('https', '127.0.0.1', self.https_port)

        try:
            https_fail_pool.request('GET', '/', retries=0)
            self.fail(""Didn't raise SSL invalid common name"")
        except MaxRetryError as e:
            self.assertIsInstance(e.reason, SSLError)
            self.assertIn(""doesn't match"", str(e.reason))

    def test_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/' % self.http_url},
                         redirect=False)

        self.assertEqual(r.status, 303)

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/' % self.http_url})

        self.assertEqual(r.status, 200)
        self.assertEqual(r.data, b'Dummy server!')

    def test_cross_host_redirect(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        cross_host_location = '%s/echo?a=b' % self.http_url_alt
        try:
            http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': cross_host_location},
                         timeout=1, retries=0)
            self.fail(""We don't want to follow redirects here."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/echo?a=b' % self.http_url_alt},
                         timeout=1, retries=1)
        self.assertNotEqual(r._pool.host, self.http_host_alt)

    def test_cross_protocol_redirect(self):
        http = proxy_from_url(self.proxy_url, ca_certs=DEFAULT_CA)
        self.addCleanup(http.clear)

        cross_protocol_location = '%s/echo?a=b' % self.https_url
        try:
            http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': cross_protocol_location},
                         timeout=1, retries=0)
            self.fail(""We don't want to follow redirects here."")

        except MaxRetryError:
            pass

        r = http.request('GET', '%s/redirect' % self.http_url,
                         fields={'target': '%s/echo?a=b' % self.https_url},
                         timeout=1, retries=1)
        self.assertEqual(r._pool.host, self.https_host)

    def test_headers(self):
        http = proxy_from_url(self.proxy_url, headers={'Foo': 'bar'},
                              proxy_headers={'Hickory': 'dickory'},
                              ca_certs=DEFAULT_CA)
        self.addCleanup(http.clear)

        r = http.request_encode_url('GET', '%s/headers' % self.http_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.http_url_alt)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host_alt, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

        r = http.request_encode_body('POST', '%s/headers' % self.http_url)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.http_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_url('GET', '%s/headers' % self.https_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

        r = http.request_encode_body('GET', '%s/headers' % self.http_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertEqual(returned_headers.get('Hickory'), 'dickory')
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.http_host, self.http_port))

        r = http.request_encode_body('GET', '%s/headers' % self.https_url, headers={'Baz': 'quux'})
        returned_headers = json.loads(r.data.decode())
        self.assertIsNone(returned_headers.get('Foo'))
        self.assertEqual(returned_headers.get('Baz'), 'quux')
        self.assertIsNone(returned_headers.get('Hickory'))
        self.assertEqual(returned_headers.get('Host'),
                         '%s:%s' % (self.https_host, self.https_port))

    def test_headerdict(self):
        default_headers = HTTPHeaderDict(a='b')
        proxy_headers = HTTPHeaderDict()
        proxy_headers.add('foo', 'bar')

        http = proxy_from_url(
            self.proxy_url,
            headers=default_headers,
            proxy_headers=proxy_headers)
        self.addCleanup(http.clear)

        request_headers = HTTPHeaderDict(baz='quux')
        r = http.request('GET', '%s/headers' % self.http_url, headers=request_headers)
        returned_headers = json.loads(r.data.decode())
        self.assertEqual(returned_headers.get('Foo'), 'bar')
        self.assertEqual(returned_headers.get('Baz'), 'quux')

    def test_proxy_pooling(self):
        http = proxy_from_url(self.proxy_url, cert_reqs='NONE')
        self.addCleanup(http.clear)

        for x in range(2):
            http.urlopen('GET', self.http_url)
        self.assertEqual(len(http.pools), 1)

        for x in range(2):
            http.urlopen('GET', self.http_url_alt)
        self.assertEqual(len(http.pools), 1)

        for x in range(2):
            http.urlopen('GET', self.https_url)
        self.assertEqual(len(http.pools), 2)

        for x in range(2):
            http.urlopen('GET', self.https_url_alt)
        self.assertEqual(len(http.pools), 3)

    def test_proxy_pooling_ext(self):
        http = proxy_from_url(self.proxy_url)
        self.addCleanup(http.clear)

        hc1 = http.connection_from_url(self.http_url)
        hc2 = http.connection_from_host(self.http_host, self.http_port)
        hc3 = http.connection_from_url(self.http_url_alt)
        hc4 = http.connection_from_host(self.http_host_alt, self.http_port)
        self.assertEqual(hc1, hc2)
        self.assertEqual(hc2, hc3)
        self.assertEqual(hc3, hc4)

        sc1 = http.connection_from_url(self.https_url)
        sc2 = http.connection_from_host(self.https_host,
                                        self.https_port, scheme='https')
        sc3 = http.connection_from_url(self.https_url_alt)
        sc4 = http.connection_from_host(self.https_host_alt,
                                        self.https_port, scheme='https')
        self.assertEqual(sc1, sc2)
        self.assertNotEqual(sc2, sc3)
        self.assertEqual(sc3, sc4)

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_timeout(self):
        https = proxy_from_url('https://{host}'.format(host=TARPIT_HOST))
        self.addCleanup(https.clear)
        try:
            https.request('GET', self.http_url, timeout=0.001)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ConnectTimeoutError)

    @pytest.mark.timeout(0.5)
    @requires_network
    def test_https_proxy_pool_timeout(self):
        https = proxy_from_url('https://{host}'.format(host=TARPIT_HOST),
                               timeout=0.001)
        self.addCleanup(https.clear)
        try:
            https.request('GET', self.http_url)
            self.fail(""Failed to raise retry error."")
        except MaxRetryError as e:
            self.assertEqual(type(e.reason), ConnectTimeoutError)

    def test_scheme_host_case_insensitive(self):
        """"""Assert that upper-case schemes and hosts are normalized.""""""
        http = proxy_from_url(self.proxy_url.upper(), ca_certs=DEFAULT_CA)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url.upper())
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url.upper())
        self.assertEqual(r.status, 200)


class TestIPv6HTTPProxyManager(IPv6HTTPDummyProxyTestCase):

    def setUp(self):
        self.http_url = 'http://%s:%d' % (self.http_host, self.http_port)
        self.http_url_alt = 'http://%s:%d' % (self.http_host_alt,
                                              self.http_port)
        self.https_url = 'https://%s:%d' % (self.https_host, self.https_port)
        self.https_url_alt = 'https://%s:%d' % (self.https_host_alt,
                                                self.https_port)
        self.proxy_url = 'http://[%s]:%d' % (self.proxy_host, self.proxy_port)

    def test_basic_ipv6_proxy(self):
        http = proxy_from_url(self.proxy_url, ca_certs=DEFAULT_CA)
        self.addCleanup(http.clear)

        r = http.request('GET', '%s/' % self.http_url)
        self.assertEqual(r.status, 200)

        r = http.request('GET', '%s/' % self.https_url)
        self.assertEqual(r.status, 200)


if __name__ == '__main__':
    unittest.main()",,a74c9cfbaed9f811e7563cfc3dce894928e0221a,CVE-2020-7212,a74c9cfbaed9f811e7563cfc3dce894928e0221a,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR) VAR .. VAR VAR, VAR VAR VAR.VAR VAR VAR VAR VAR.VAR VAR VAR, VAR VAR VAR.VAR VAR ( VAR, VAR, VAR, VAR) VAR VAR.VAR VAR VAR, VAR VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): """""" VAR VAR VAR VAR VAR VAR VAR VAR VAR VAR """""" VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR) VAR.VAR(VAR, 'VAR', '/') VAR = VAR.VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR, 0, (""VAR VAR VAR VAR VAR VAR VAR "" ""VAR VAR, VAR VAR %VAR"" % VAR)) VAR VAR(VAR): VAR, VAR = VAR() VAR = VAR('VAR: VAR.VAR(VAR.VAR) VAR.VAR(VAR, VAR.VAR, 'VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR, VAR.VAR, 'VAR', '%VAR/' % VAR.VAR) VAR: VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) VAR VAR(VAR): VAR = VAR(VAR(VAR.VAR), VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', VAR.VAR, VAR.VAR) VAR: VAR.VAR('VAR', '/', VAR=0) VAR.VAR(""VAR'VAR VAR VAR VAR VAR VAR VAR"") VAR VAR VAR VAR: VAR.VAR(VAR.VAR, VAR) VAR.VAR('VAR VAR VAR', VAR(VAR.VAR), ""VAR 'VAR VAR VAR',"" ""VAR VAR: %VAR"" % VAR.VAR) VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR = VAR.VAR('VAR', VAR.VAR, VAR.VAR) VAR = VAR.VAR() VAR.VAR(VAR.VAR, VAR) VAR.VAR('VAR', '/')  VAR = VAR(VAR.VAR, VAR='VAR', VAR=VAR) VAR = VAR.VAR('VAR', '127.0.0.1', VAR.VAR) VAR: VAR.VAR('VAR', '/', VAR=0) VAR.VAR(""VAR'VAR VAR VAR VAR VAR VAR"") VAR VAR VAR VAR: VAR.VAR(VAR.VAR, VAR) VAR.VAR(""VAR'VAR VAR"", VAR(VAR.VAR)) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}, VAR=VAR) VAR.VAR(VAR.VAR, 303) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/' % VAR.VAR}) VAR.VAR(VAR.VAR, 200) VAR.VAR(VAR.VAR, VAR'VAR VAR!') VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR'VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR=VAR) VAR.VAR(VAR.VAR) VAR = '%VAR/VAR?VAR=VAR' % VAR.VAR VAR: VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': VAR}, VAR=1, VAR=0) VAR.VAR(""VAR VAR'VAR VAR VAR VAR VAR VAR."") VAR VAR: VAR VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR?VAR=VAR' % VAR.VAR}, VAR=1, VAR=1) VAR.VAR(VAR.VAR.VAR, VAR.VAR) VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR={'VAR': 'VAR'}, VAR={'VAR': 'VAR'}, VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': 'VAR'}) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR')) VAR.VAR(VAR.VAR('VAR'), '%VAR:%VAR' % (VAR.VAR, VAR.VAR)) VAR VAR(VAR): VAR = VAR(VAR='VAR') VAR = VAR() VAR.VAR('VAR', 'VAR') VAR = VAR( VAR.VAR, VAR=VAR, VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR(VAR='VAR') VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR=VAR) VAR = VAR.VAR(VAR.VAR.VAR()) VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR.VAR(VAR.VAR('VAR'), 'VAR') VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR='VAR') VAR.VAR(VAR.VAR) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 1) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 1) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 2) VAR VAR VAR VAR(2): VAR.VAR('VAR', VAR.VAR) VAR.VAR(VAR(VAR.VAR), 3) VAR VAR(VAR): VAR = VAR(VAR.VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR='VAR') VAR = VAR.VAR(VAR.VAR) VAR = VAR.VAR(VAR.VAR, VAR.VAR, VAR='VAR') VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) VAR.VAR(VAR, VAR) @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR = VAR('VAR: VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', VAR.VAR, VAR=0.001) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) @VAR.VAR.VAR(0.5) @VAR VAR VAR(VAR): VAR = VAR('VAR: VAR=0.001) VAR.VAR(VAR.VAR) VAR: VAR.VAR('VAR', VAR.VAR) VAR.VAR(""VAR VAR VAR VAR VAR."") VAR VAR VAR VAR: VAR.VAR(VAR(VAR.VAR), VAR) VAR VAR(VAR): """"""VAR VAR VAR-VAR VAR VAR VAR VAR VAR."""""" VAR = VAR(VAR.VAR.VAR(), VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR.VAR()) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR.VAR()) VAR.VAR(VAR.VAR, 200) VAR VAR(VAR): VAR VAR(VAR): VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR.VAR = 'VAR: VAR.VAR) VAR.VAR = 'VAR: VAR VAR(VAR): VAR = VAR(VAR.VAR, VAR=VAR) VAR.VAR(VAR.VAR) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR('VAR', '%VAR/' % VAR.VAR) VAR.VAR(VAR.VAR, 200) VAR VAR == 'VAR': VAR.VAR() ",8,1
urllib3_adb358f8e06865406d1f05e581a16cbea2136fbc,test/with_dummyserver/test_poolmanager.py,"        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'authorization': 'foo'})

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('authorization', data)
        self.assertNotIn('Authorization', data)

        r = http.request('GET', '%s/redirect' % self.base_url,
                         fields={'target': '%s/headers' % self.base_url_alt},
                         headers={'x-api-secret': 'foo',
                                  'authorization': 'bar'},
                         retries=Retry(remove_headers_on_redirect=['X-API-Secret']))

        self.assertEqual(r.status, 200)

        data = json.loads(r.data.decode('utf-8'))

        self.assertNotIn('x-api-secret', data)
        self.assertNotIn('X-API-Secret', data)
        self.assertEqual(data['Authorization'], 'bar')
",,adb358f8e06865406d1f05e581a16cbea2136fbc,CVE-2018-25091,adb358f8e06865406d1f05e581a16cbea2136fbc,https://github.com/urllib3/urllib3,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR': 'VAR'}) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR', VAR) VAR.VAR('VAR', VAR) VAR = VAR.VAR('VAR', '%VAR/VAR' % VAR.VAR, VAR={'VAR': '%VAR/VAR' % VAR.VAR}, VAR={'VAR-VAR-VAR': 'VAR', 'VAR': 'VAR'}, VAR=VAR(VAR=['VAR-VAR-VAR'])) VAR.VAR(VAR.VAR, 200) VAR = VAR.VAR(VAR.VAR.VAR('VAR-8')) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR('VAR-VAR-VAR', VAR) VAR.VAR(VAR['VAR'], 'VAR') ",8,1
vim_85b6747abc15a7a81086db31289cf1b8b17e6cb1,src/testdir/test_ex_mode.vim,"func Test_ex_mode_large_indent()
  new
  set ts=500 ai
  call setline(1, ""\t"")
  exe ""normal gQi\<CR>.""
  set ts=8 noai
  bwipe!
endfunc

",,85b6747abc15a7a81086db31289cf1b8b17e6cb1,CVE-2022-0359,85b6747abc15a7a81086db31289cf1b8b17e6cb1,https://github.com/vim/vim,NVD_DIRECT_COMMIT,1337,COMPLETED,"VAR VAR() VAR VAR VAR=500 VAR VAR VAR(1, ""\VAR"") VAR ""VAR VAR\<VAR>."" VAR VAR=8 VAR VAR! VAR ",16,1
xwiki-platform_7ca56e40cf79a468cea54d3480b6b403f259f9ae,xwiki-platform-core/xwiki-platform-wexwiki-platform-web-templates/src/main/resources/templates/documentTags.vm,"  #set ($viewTagUrl = $xwiki.getURL('Main.Tags', 'view', ""do=viewTag&amp;tag=$!{escapetool.url($tag)}""))
  ## Note that the form_token parameter needs to be kept before the xredirect parameter since the JS code might replace the latter
  ## All that would need a cleaner fix in the javascript of tags.
  #set ($deleteTagUrl = $doc.getURL('view', ""xpage=documentTags&amp;xaction=delete&amp;tag=$!{escapetool.url($tag)}&amp;form_token=$!{escapetool.url($services.csrf.token)}&amp;xredirect=${xredirect}""))
<span class=""tag-wrapper"">
  <span class=""tag""><a href=""$viewTagUrl"">$!{escapetool.xml($tag)}</a></span>
  #if($hasedit)<span class=""separator"">[</span><a href=""$deleteTagUrl"" class=""tag-tool tag-delete"" title=""$services.localization.render('core.tags.remove.tooltip')"">X</a><span class=""separator"">]</span>#end
</span>
    #if ($services.csrf.isTokenValid($request.get('form_token')))
        #if($xwiki.tag)
            #set($result = $xwiki.tag.removeTagFromDocument($tag, $doc.fullName))
            #if($result == 'OK' && ""$!{request.ajax}"" != '')
                #set ($discard= $response.setStatus(200))
                #set($responseMessage = 'OK')
            #elseif($result == 'NO_EFFECT')
                #set ($discard= $response.setStatus(409))
                #set($responseMessage = $services.localization.render('core.tags.remove.error.notFound', [$tag]))
            #elseif($result == 'NOT_ALLOWED')
                #set ($discard= $response.setStatus(403))
                #set($responseMessage = $services.localization.render('core.tags.remove.error.notAllowed', [$tag]))
            #elseif($result == 'FAILED')
                #set ($discard= $response.setStatus(500))
                #set($responseMessage = $services.localization.render('core.tags.remove.error.failed', [$tag]))
            #end
        #else
            #set ($discard= $response.setStatus(501))
            #set ($responseMessage = ""Tag plugin is missing"")
        #set ($discard= $response.setStatus(401))
        #set($responseMessage = $services.localization.render('core.tags.remove.error.notAllowed', [$tag]))
    #end
    #if(""$!{request.ajax}"" != '')
        $!responseMessage
    #elseif(""$!{request.xredirect}"" != '')
        $response.sendRedirect($request.xredirect)
    #if ($services.csrf.isTokenValid($request.get('form_token')))
        #if($xwiki.tag)
            #set($oldTags = $xwiki.tag.getTagsFromDocument($doc.fullName))
            #set($result = $xwiki.tag.addTagsToDocument($tag, $doc.fullName))
            #if($result == 'OK' && ""$!{request.ajax}"" != '')
                #set($newTags = $xwiki.tag.getTagsFromDocument($doc.fullName))
                #set($discard = $newTags.removeAll($oldTags))
                #foreach($t in $newTags)
                    #if($t != '' && !$oldTags.contains($t))
                        #displayTag($t)
                    #end
            #elseif($result == 'NO_EFFECT')
                $response.setStatus(409)
                #set($tagErrorMessage = $services.localization.render('core.tags.add.error.alreadySet', [$tag]))
            #elseif($result == 'NOT_ALLOWED')
                $response.setStatus(403)
                #set($tagErrorMessage = $services.localization.render('core.tags.add.error.notAllowed', [$tag]))
            #elseif($result == 'FAILED')
                $response.setStatus(500)
                #set($tagErrorMessage = $services.localization.render('core.tags.add.error.failed', [$tag]))
            #if(""$!{request.ajax}"" != '')
                $tagErrorMessage
            #elseif(""$!{request.xredirect}"" != '')
                $response.sendRedirect($request.xredirect)
            #end
        #else
            #set ($discard= $response.setStatus(501))
            #set ($responseMessage = ""Tag plugin is missing"")
        #set ($discard= $response.setStatus(401))
        #set($responseMessage = $services.localization.render('core.tags.add.error.notAllowed', [$tag]))
## Note that the form_token parameter needs to be kept before the xredirect parameter since the JS code might replace the latter
## All that would need a cleaner fix in the javascript of tags.
<form action=""$doc.getURL('view', ""xpage=documentTags&amp;xaction=add&amp;form_token=$!{escapetool.url($services.csrf.token)}&amp;xredirect=${xredirect}"")"" method=""post"" class=""tag-add-form"">","<span class=""tag-wrapper""><span class=""tag""><a href=""$xwiki.getURL('Main.Tags', 'view', ""do=viewTag&amp;tag=$!{escapetool.url($tag)}"")"">$!{escapetool.xml($tag)}</a></span>#if($hasedit)<span class=""separator"">[</span><a href=""$doc.getURL('view', ""xpage=documentTags&amp;xaction=delete&amp;tag=$!{escapetool.url($tag)}&amp;xredirect=${xredirect}"")"" class=""tag-tool tag-delete"" title=""$services.localization.render('core.tags.remove.tooltip')"">X</a><span class=""separator"">]</span>#end</span>
    #if($xwiki.tag)
        #set($result = $xwiki.tag.removeTagFromDocument($tag, $doc.fullName))
        #if($result == 'OK' && ""$!{request.ajax}"" != '')
            $response.setStatus(200)
            #set($responseMessage = 'OK')
        #elseif($result == 'NO_EFFECT')
            $response.setStatus(409)
            #set($responseMessage = $services.localization.render('core.tags.remove.error.notFound', [$tag]))
        #elseif($result == 'NOT_ALLOWED')
            $response.setStatus(403)
            #set($responseMessage = $services.localization.render('core.tags.remove.error.notAllowed', [$tag]))
        #elseif($result == 'FAILED')
            $response.setStatus(500)
            #set($responseMessage = $services.localization.render('core.tags.remove.error.failed', [$tag]))
        #end
        #if(""$!{request.ajax}"" != '')
            $!responseMessage
        #elseif(""$!{request.xredirect}"" != '')
            $response.sendRedirect($request.xredirect)
        ## TODO
    #if($xwiki.tag)
        #set($oldTags = $xwiki.tag.getTagsFromDocument($doc.fullName))
        #set($result = $xwiki.tag.addTagsToDocument($tag, $doc.fullName))
        #if($result == 'OK' && ""$!{request.ajax}"" != '')
            #set($newTags = $xwiki.tag.getTagsFromDocument($doc.fullName))
            #set($discard = $newTags.removeAll($oldTags))
            #foreach($t in $newTags)
                #if($t != '' && !$oldTags.contains($t))
                    #displayTag($t)
        #elseif($result == 'NO_EFFECT')
            $response.setStatus(409)
            #set($tagErrorMessage = $services.localization.render('core.tags.add.error.alreadySet', [$tag]))
        #elseif($result == 'NOT_ALLOWED')
            $response.setStatus(403)
            #set($tagErrorMessage = $services.localization.render('core.tags.add.error.notAllowed', [$tag]))
        #elseif($result == 'FAILED')
            $response.setStatus(500)
            #set($tagErrorMessage = $services.localization.render('core.tags.add.error.failed', [$tag]))
        #end
        #if(""$!{request.ajax}"" != '')
            $tagErrorMessage
        #elseif(""$!{request.xredirect}"" != '')
            $response.sendRedirect($request.xredirect)
        ## TODO
<form action=""$doc.getURL('view', ""xpage=documentTags&amp;xaction=add&amp;xredirect=${xredirect}"")"" method=""post"" class=""tag-add-form"">
      ## CSRF prevention
    <div class=""hidden""><input type=""hidden"" name=""form_token"" value=""$!{services.csrf.getToken()}"" /></div>",7ca56e40cf79a468cea54d3480b6b403f259f9ae,CVE-2022-36095,7ca56e40cf79a468cea54d3480b6b403f259f9ae,https://github.com/xwiki/xwiki-platform,NVD_DIRECT_COMMIT,1337,COMPLETED,"    <VAR VAR=""VAR-VAR""> <VAR VAR=""VAR""><VAR VAR=""$VAR"">$!{VAR.VAR($VAR)}</VAR></VAR>  </VAR>                        $!VAR  $VAR.VAR($VAR.VAR)             $VAR.VAR(409)   $VAR.VAR(403)   $VAR.VAR(500)   $VAR  $VAR.VAR($VAR.VAR)         <VAR VAR=""$VAR.VAR('VAR', ""VAR=VAR&VAR;VAR=VAR&VAR;VAR=$!{VAR.VAR($VAR.VAR.VAR)}&VAR;VAR=${VAR}"")"" VAR=""VAR"" VAR=""VAR-VAR-VAR""> <VAR VAR=""VAR-VAR""><VAR VAR=""VAR""><VAR VAR=""$VAR.VAR('VAR.VAR', 'VAR', ""VAR=VAR&VAR;VAR=$!{VAR.VAR($VAR)}"")"">$!{VAR.VAR($VAR)}</VAR></VAR>    $VAR.VAR(200)   $VAR.VAR(409)   $VAR.VAR(403)   $VAR.VAR(500)    $!VAR  $VAR.VAR($VAR.VAR)            $VAR.VAR(409)   $VAR.VAR(403)   $VAR.VAR(500)    $VAR  $VAR.VAR($VAR.VAR)  <VAR VAR=""$VAR.VAR('VAR', ""VAR=VAR&VAR;VAR=VAR&VAR;VAR=${VAR}"")"" VAR=""VAR"" VAR=""VAR-VAR-VAR"">  <VAR VAR=""VAR""><VAR VAR=""VAR"" VAR=""VAR"" VAR=""$!{VAR.VAR.VAR()}"" /></VAR>",0,1
